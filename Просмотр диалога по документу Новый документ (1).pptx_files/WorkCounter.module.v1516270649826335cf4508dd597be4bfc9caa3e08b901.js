define("js!SBIS3.ENGINE.WorkCounter",["Core/EventBus","Core/RightsManager","Core/constants","Core/UserInfo","Core/defaultRenders","js!WS.Data/Source/SbisService","i18n!SBIS3.ENGINE.WorkCounter"],function(e,t,n,r,o,i){if("undefined"!=typeof window)global.requirejs(["Core/core-init"],function(u){u.addCallback(function(){if("undefined"!=typeof window&&-1!==window.location.hostname.search("reg.tensor.ru"))return;e.globalChannel().once("bootupReady",function(){e.channel("navigation").subscribe("onReady",function(e,t,n){if("left"===t&&n)u(n),c(n),s(n),a(n),l(n),f(n),g(n),d(n)});function u(e){if("__сбис__физики"!==r.get("ЛогинКлиента"))require(["js!SBIS3.EDO.EdoCounters"],function(t){var n=-1===window.location.href.indexOf("mydoc.html");if(t&&t.updateCounters)t.updateCounters(n);e.registerCounter(["documents"],function(){t.nerasp_count().addCallback(function(t){if(!t)return;e.setCounter({event:"registry-Undistr"},{counter:t.getRawData()||""})})}),e.registerCounter(["work","deeds"],function(){t.task_count().addCallback(function(t){var n=t.getRow();e.setCounter({event:"registry-FromMe"},{counter:n.get("FromMe")||"",title:rk("Количество задач в обработке")+": "+n.get("FromMe")}),e.setCounter({event:"registry-OnControl"},{counter:n.get("OnCtrl")||"",title:rk("Всего")+": "+n.get("OnCtrl")}),e.setCounter({event:"registry-UndistrServRec"},{counter:n.get("Unalloc")||"",title:rk("Всего")+": "+n.get("Unalloc")})})})})}function c(e){require(["js!SBIS3.Socnet.GroupNavHelper"],function(t){if("__сбис__физики"===r.get("ЛогинКлиента"))t.updateGroupCounter(null,e);else e.registerCounter(["contacts"],function(){t.updateGroupCounter(null,e),t.createServerSubscribe&&t.createServerSubscribe(e)})})}function s(e){require(["js!SBIS3.Socnet.AnswersNavHelper"],function(t){t.createServerSubscribe(e)})}function a(e){require(["js!SBIS3.Socnet.DiscussionsNavHelper"],function(t){t.createServerSubscribe(e)})}function l(e){if(n.modules["Основные средства"]&&e.hasEvent("myProfile_capital")&&t.getRights(["Мое имущество"])["Мое имущество"]>0)e.registerCounter(["myProfile"],function(){new i({endpoint:"Capital"}).call("getMyBalance",{}).addCallback(function(t){e.setCounter({url:"/myCapital.html",event:"myProfile_capital"},{counter:t.getScalar()})})})}function f(r){if(n.modules["Авансовые отчеты"]&&r.hasEvent("myProfile_debt")&&t.getRights(["Мой подотчет"])["Мой подотчет"]>0)r.registerCounter(["myProfile"],function(){t(-2),e.channel("navigation").subscribe("updateImprestCounters",function(e,n){t(n)}.bind(this));function t(e){new i({endpoint:"АвансОтчет"}).call("getFaceDebt",{face:null,org:e}).addCallback(function(e){if(e=e.getScalar(),!!e){var t=o.real(e.toFixed(0),0,true),n=t>0?rk("Я должен"):rk("Мне должны");r.setCounter({url:"/ExpRepTotal.html",event:"myProfile_debt"},{counter:t,title:n})}})}})}function g(t){if(n.modules.Instructions)require(["js!SBIS3.Instructions.Navigation.Helpers"],function(n){t.registerCounter(["myProfile"],function(){n.updateSelfInstructionsCounters(t)}),e.serverChannel("instructions.usercounterschange").subscribe("onMessage",function(e,r){if("8ccc7f2b-b3fc-4af8-a56b-9c2b373c57ab"===r||r&&"8ccc7f2b-b3fc-4af8-a56b-9c2b373c57ab"===r.objType)n.updateSelfInstructionsCounters(t)})})}function d(t){function r(){t.registerCounter(["contacts"],function(){new i({endpoint:"Meeting"}).call("CountMeet",{}).addCallback(function(e){if(e=e.getRow(),!!e){var n=e.get("CountStart"),r=e.get("CountNotAnswer"),o=[],i=[];if(r+n>0){if(n)o.push(n),i.push(rk("запланировано")+": "+n);if(r)o.push(r),i.push(rk("не ответил")+": "+r);t.setCounter({url:"/meetings.html",event:"work_meetings_service"},{counter:o.join("|"),title:i.reverse().join(" ")})}}})})}if(e.channel("navigation").subscribe("onNavigate",function(e,t,n){if("onClickMeeting"===n)require(["Core/helpers/fast-control-helpers"],function(e){e.showFloatArea({template:"js!SBIS3.Meetings.ReestrMeetingForUser",isStack:true,animationLength:150})})}),e.channel("MeetingsChannel").subscribe("onUpdateMeetingCounter",r),n.modules["Совещания"]&&t.hasEvent("work_meetings_service"))r();e.serverChannel("meeting.count").subscribe("onMessage",function(){r()})}})})})});
//# sourceMappingURL=WorkCounter.module.js.map