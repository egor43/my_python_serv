define("Lib/Control/Control.compatible",["Core/ControlBatchUpdater","Core/constants","Core/helpers/generate-helpers","Core/helpers/random-helpers","Core/helpers/Function/forAliveOnly","Core/core-instance","Core/IoC","Core/core-merge","Core/ContextBinder","Core/helpers/Object/find","Core/CommandDispatcher","Core/helpers/Hcontrol/isElementVisible","Core/helpers/Hcontrol/focusControl","View/Runner","View/Runner/common","Core/Deferred"],function(t,e,i,n,o,s,r,a,h,l,c,f,u,d,_){var p,g;t.registerDelayedAction("Control.focus",u,"FocusActions");function C(t){return t.substr(0,1).toUpperCase()+t.substr(1)}function y(t){for(var e={},i=t.length-1;i>=0;i--)for(var n in t[i]){if("element"===n||"parent"===n||"logicParent"===n||"parentEnabled"===n)continue;if("object"===typeof t[i][n]&&t[i][n]){if(!e[n])e[n]=Array.isArray(t[i][n])?[]:{};e[n]=a(e[n],t[i][n],{rec:false})}else e[n]=t[i][n]}return e=Object.create(e),e}return{_needFocusOnActivated:function(){var t=e.browser.isMobilePlatform,i=this._getOption("focusOnActivatedOnMobiles");return!t||void 0===i||i},_modifyOptions:function(t){if("undefined"!==typeof window&&t&&t["__$config"]&&window.componentOptions&&window.componentOptions.indexOf(t["__$config"])>-1){var e=[];if(this&&this._dotTplFn&&this._dotTplFn.stable&&!this._dotTplFn.fixed){var i=t.parent;while(i&&i._dotTplFn&&i._dotTplFn.stable)e.push(i._options),i=i._parent;if(e.length>0){var n=this._dotTplFn;this._dotTplFn=function(){return n.apply(y(e),arguments)},this._dotTplFn.fixed=true,this._dotTplFn.stable=true}this._fixMyOption(e,t,t,0)}}if(t&&!t.hasOwnProperty("logicParent"))t.logicParent=null;if(t&&!t.hasOwnProperty("parentEnabled"))t.parentEnabled=true;return t},_fixMyOption:function(t,e,i,n){if(n>3)return;for(var o in i)if("function"===typeof i[o]){if(i[o].fromSerializer)(function(t,e,n){i[o]=function(){return t.apply(y([n].concat(e)),_.addArgument(d.Run,arguments))}})(i[o],t,e)}else if("element"===o||"parent"===o||"logicParent"===o)continue;else if("object"===typeof i[o])this._fixMyOption(t,e,i[o],n+1)},_runInBatchUpdate:function(e,i,n){return t._runInBatchUpdate(e,this,i,n)},_runInBatchUpdateOpts:function(e){var i=t;return i.ensureBatchUpdate(e.hint||"Control._runInBatchUpdateOpts"),i._runInBatchUpdateOpts(e)},_createBatchUpdateWrapper:function(e,i,n){var o=this;return function(){var s=t;return s.ensureBatchUpdate(e||"Control._runInBatchUpdateOpts"),s._runInBatchUpdate(e,n?this:o,i,arguments)}},_haveBatchUpdate:function(){var e=t;return e.haveBatchUpdate()||e.haveApplyUpdateInProcess()},_needForceOnResizeHandler:function(){return t.haveApplyUpdateInProcess()},_runBatchDelayedFunc:function(e,i){var n;if(this._haveBatchUpdate())t.addDelayedFunc(e,this,i);else n=i.apply(this);return n},_needRecalkInvisible:function(){return false},_getBatchUpdateData:function(){return this._batchUpdateData},_setBatchUpdateData:function(t){this._batchUpdateData=t},_haveAutoSize:function(){return true},runInPropertiesUpdate:function(t,e){var i;try{this._propertiesChangedLock++,i=t.apply(this,e||[])}finally{if(this._propertiesChangedLock--,0===this._propertiesChangedLock&&0!==this._propertiesChangedCnt)this._propertiesChangedCnt=0,this._notify("onPropertiesChanged")}return i},_notifyOnPropertyChanged:function(t){if(this._notify("onPropertyChanged",t),this._propertiesChangedLock>0)this._propertiesChangedCnt++;else this._notify("onPropertiesChanged")},getId:function(){if(!this._id)if(this._isCorrectContainer()){var t=this._id=this._container[0].id;if(!t||""===t)this._id=this._container[0].id=n.randomId()}else this._id=n.randomId();return this._id},getName:function(){if(this._hasOption("name"))return this._getOption("name");else return this._$name=this._options.name=i.randomId("name-"),this._$name},getParentWindow:function(){try{return this.getParentByClass("Lib/Control/Window/Window")}catch(t){return}},_invalidateParentCache:function(){var t=this.getParent();while(t){if(t._childsMapIdCache)delete t._childsMapIdCache[this.getId()],delete t._childsMapNameCache[this.getName()];t=t.getParent()}},getParentByClass:function(t){if(!t)throw new Error("Control.getParentByClass - искомый класс не определен");return this.findParent(function(e){if("string"==typeof t)return s.instanceOfModule(e,t);else return e instanceof t})},_isContainerInsideParent:function(){return this._getOption("isContainerInsideParent")},_$tabindex:-1,getTabindex:function(){var t=this._getOption("tabindex");return void 0===t?-1:+t},setTabindex:function(t,e){var i=this.getParent();if(!e&&i)i.changeControlTabIndex(this,t);else this._setOption("tabindex",t);this._baseTabIndex=t},getTooltip:function(){return this._getOption("tooltip")},_alterTooltipText:function(t){return t},_callOnFocusInside:function(){var t=this.getParent();while(t){if(t.isActive())t._notify("onFocusInside",{to:this});t=t.getParent()}},_getExtendedTooltipModifiers:function(){return""},isActive:function(){return this._isControlActive},_updateActiveStyles:function(){var t=this._isControlActive;if(this._isCorrectContainer())this._container.toggleClass("ws-control-inactive",!t).toggleClass("ws-has-focus",t)},setContainer:function(t){if(this._container&&this._container[0])this._container[0].wsControl=void 0;this._container=$(t),this._container[0].wsControl=this},_getElementToFocus:function(){return this._container},findParent:function(t){if("function"!=typeof t)throw new Error("Control.findParent - требуется передать функцию-фильтр");var e=this;do{e=e.getParent()}while(e&&!t(e));return e},getParent:function(){return this._parent},getTopParent:function(){var t=this;while(t.getParent()&&!s.instanceOfModule(t.getParent(),"SBIS3.ONLINE.OnlineBaseInnerMinCoreView"))t=t.getParent();return t},getParentByName:function(t){return this.findParent(function(e){return"function"===typeof e.getName&&e.getName()==t})},getLinkedContext:function(){return this._context},addOwnedContext:function(t){if(!this._ownedContexts)this._ownedContexts=[];this._ownedContexts.push(t)},_isCorrectContainer:function(){return void 0!==this._container&&"jquery"in this._container&&1==this._container.length&&!this._container[0].startTag},_onResizeHandler:function(){},_onActionHandler:function(t){switch(t.type){case"click":if(this._shouldUseClickByTap()&&g&&g!==t.target)return;p=true;var e=t.originalEvent;if(void 0===e)e=t;if(!e.ClickEventIsReady){if(this._getOption("activableByClick"))e.ClickEventIsReady=true;this._onClickHandler(t)}break;case"touchstart":if(this._checkClickByTap){if(this._shouldUseClickByTap())g=t.target;this._clickState.stage="start",g=t.target,setTimeout(o(function(){if("start"===this._clickState.stage)g=null},this),this._clickState.timeout),this._clickState.touchCount=0,this._clickState.timeStart=new Date}break;case"touchmove":if(this._checkClickByTap&&"move"!=this._clickState.stage){if(this._clickState.touchCount>=this._maxTouchCount)this._clickState.stage="move";this._clickState.touchCount++}break;case"touchend":if(this._checkClickByTap){var i=new Date-this._clickState.timeStart;if("start"===this._clickState.stage&&i<this._maxTouchTime)p=false,clearTimeout(this._clickState.timer),this._clickState.timer=setTimeout(function(){if(!p&&(this._getOption("fix165c4103")||this._shouldUseClickByTap()))g.click();g=null}.bind(this),this._clickState.timeout);this._clickState.stage="end"}}},_shouldUseClickByTap:function(){return e.browser.retailOffline||e.compatibility.touch&&e.browser.chrome&&navigator&&navigator.userAgent.indexOf("Windows")>-1},_onClickHandler:function(t){if(this._getOption("activableByClick"))if(t.stopPropagation(),!this._isControlActive)this.setActive(true);this._notify("onClick",t)},_initKeyboardMonitor:function(t){var e=this;(t||e._container).keydown(function(t){var i=e._notify("onKeyPressed",t);if(t.which in e._keysWeHandle&&false!==i&&e._isAcceptKeyEvents()){var n=e._keyboardHover(t);if(!n)return t.preventDefault(),t.stopPropagation(),false;return n}})},_keyboardHover:function(t){},_isAcceptKeyEvents:function(){return this.isEnabled()},isEnabled:function(){return this._getOption("enabled")},show:function(){this._setVisibility(true)},hide:function(){this._setVisibility(false)},toggle:function(t){if(arguments.length>0)this._setVisibility(!!t);else this._setVisibility(!this._isVisible)},_setVisibility:function(e){var i,n,o=!e;if(this._isVisible!==e){if(this._notify("onBeforeVisibilityChange",e),this._isVisible=e,this._setOption("visible",this._isVisible),this._isCorrectContainer()){if(this._container.hasClass("ws-hidden")!==o)this._container.toggleClass("ws-hidden",o);if(n=this._getLinkedLabel&&this._getLinkedLabel(),n)if(i=this._container.parent(),i.hasClass("ws-labeled-control"))i.toggleClass("ws-hidden",o);else n.toggleClass("ws-hidden",o)}if(this._notifyOnPropertyChanged("visible"),this.isInitialized()){var s=t;if(e&&s._needDelayedRecalk(this))s._doDelayedRecalk(this);else this._notifyOnSizeChanged&&this._notifyOnSizeChanged(this,this)}this._notify("onAfterVisibilityChange",e)}},isVisibleWithParents:function(){var t=this,e=this.isVisible()&&f(this.getContainer());while(t&&e)e=t.isVisible(),t=t.getParent();return e},setAllowChangeEnable:function(t){this._setOption("allowChangeEnable",!!t)},isAllowChangeEnable:function(){return this._getOption("allowChangeEnable")},_setEnabled:function(t){if(t=!!t,this._enabledApplied!==t)if(this._enabledApplied=t,this._isCorrectContainer())this._container.toggleClass("ws-enabled",t).toggleClass("ws-disabled",!t)},setEnabled:function(t){this._prevEnabled=void 0,t=!!t;var e=this;if(h.getBindingsForControl(this).forEach(function(i){l(i.bindings,function(i){if("enabled"===i.propName){if(e.getLinkedContext().hasFieldWithParents(i.fieldName))t=!!e.getLinkedContext().getValue(i.fieldName);else t=!!i.nonExistentValue;return true}})}),this._getOption("allowChangeEnable")&&t!==this._getOption("enabled"))this._setOption("enabled",t),this._setEnabled(t)},getOwner:function(t){var e=null,i,n,o,s;if(this._owner)e=this._owner;else if(this._getOption("owner")){if(this._getOption("owner").indexOf&&-1!==this._getOption("owner").indexOf("/"))i=this._getOption("owner").split("/"),n=i[1],o=i[0];else n=this._getOption("owner");try{if(o)s=this.getParentByName(o);else do{s=(s||this).getParent()}while(s&&!s.hasChildControlByName(n));this._owner=e=s.getChildControlByName(n)}catch(e){if(!t)r.resolve("ILogger").log("Control",'Некорректно задано св-во owner или отсутствует owner c именем "'+n+'"')}}return e},getContainer:function(){return this._container},sendCommand:function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift(this,t),c.sendCommand.apply(c,e)},canAcceptFocus:function(){return this.isVisible()&&this.isEnabled()&&this.getTabindex()&&f(this.getContainer())},setUserData:function(t,e){if(!this._userData)this._userData={};this._userData[t]=e},getUserData:function(t){return this._userData&&this._userData[t]},getProperty:function(t){var e=C(t),i="get"+e,n="function"===typeof this[i],o="is"+e,s="function"===typeof this[o],r,a;if(n)r=this[i]();else if(s)r=this[o]();else if(this._hasOption(t))r=this._getOption(t);else throw a='Метод getProperty вызвали для несуществующего свойства "'+t+'" (не определено соответствующего ему метода '+i+" или "+o+' и нет опции с именем "'+t+'"',new Error(a);return r},setProperty:function(t,e){var i="set"+C(t),n,o=void 0;if("function"===typeof this[i])o=this[i](e);else if(this._hasOption(t))this._setOption(t,e);else throw n='Метод setProperty вызвали для несуществующего свойства "'+t+'" (не определено соответствующего ему метода '+i+' и нет опции с именем "'+t+'"',new Error(n);return o},setProperties:function(t){this.runInPropertiesUpdate(function(){var e;if(t.hasOwnProperty("allowChangeEnable"))e=t.allowChangeEnable,delete t.allowChangeEnable;if(true===e)this.setProperty("allowChangeEnable",true);for(var i in t)if(t.hasOwnProperty(i))this.setProperty(i,t[i]);if(false===e)this.setProperty("allowChangeEnable",false)})},destroy:function(){if(this._ownedContexts){for(var t=0;t<this._ownedContexts.length;t++)if(!this._ownedContexts[t].isDestroyed())this._ownedContexts[t].destroy();this._ownedContexts=[]}}}});
//# sourceMappingURL=Control.compatible.js.map