(function() {
   var availableDict = {"en-US":true},
      langMatch = String(typeof document === 'undefined' ? '' : document.cookie).match(/lang=([A-z-]+)/),
      langName = langMatch ? langMatch[1] : 'ru-RU',
      langModule = 'text!Zametki/lang/' + langName + '/' + langName + '.json';
   if (langName in availableDict) {
      define('Zametki_localization', ['Core/i18n', langModule], function(i18n, data) {
         if (data){
            i18n.setDict(JSON.parse(data), langModule, langName);
         }
      });
   } else {
      define('Zametki_localization', function() {});
   }
})();

define('js!SBIS3.Notes.AccordionWrapper',['Zametki_localization'],function(){'use strict';var n=null;return{setAccordion:function(r){n=r;},getAccordion:function(){return n;}};});
define('js!SBIS3.Notes.PanelData',['Zametki_localization'],function(){'use strict';var t=[];return{set:function(n){if(t.length){if(!t.filter(function(t){return t.containerId===n.containerId;}).length)t.push(n);}else t.push(n);},getTop:function(){return t.length?t[t.length-1]:null;},setTopHider:function(t){if(t){var n=this.getTop();if(n)n.hider=t;}},setTopDocument:function(t,n){if(t){var e=this.getTop();if(e)e.document=t,e.record=n;}},getTopDocument:function(){var t=this.getTop();return t&&t.document?t.document:null;},getTopDocumentRecord:function(){var t=this.getTop();return t&&t.record?t.record:null;},getById:function(n){if(t.length){var e=t.filter(function(t){return t.containerId===n;});return e.length?e[0]:null;}else return null;},remove:function(n){if(t.length){var e=t.filter(function(t){return t.containerId===n;});if(e){if(e.hider)e.hider.destroy();t=t.filter(function(t){return t.containerId!==n;});}}},getDataFromStr:function(t){var n=t.split('-#-');return{type:n[1],id:n[0],title:n[2]};},getCount:function(){return t.length;}};});
define('js!SBIS3.Notes.Loader',['Core/core-instance','Core/moduleStubs','Core/ParallelDeferred','Core/Deferred','Core/constants','Core/EventBus','Core/core-ready','WS.Data/Query/Query','WS.Data/Source/SbisService','WS.Data/Entity/Record','Zametki_localization'],function(e,n,t,o,a,i,r,l,s,c){'use strict';if('undefined'===typeof window)return;var d,u,f,g,h,m,b=null,p=true,C=null,y=new o(),v,w=false,N=true;r.addCallback(function(e){return $(_),e;});function S(){var e=$('.edo-Dialog-head__first-line').closest('.ws-sticky-header__wrapper'),n=e?$(e).find('.ws-notes-hider-container'):null;return n?n.attr('data-notes-info'):null;}function P(e){if(!e.altKey||e.keyCode!=='N'.charCodeAt(0))return;if(e.stopPropagation(),e.preventDefault(),!D(location.pathname)||S()||$('.ws-panelNotes-hider').length)i.channel('ChannelUserAccount').notify('onAddNote',{text:A()});}function A(){var e='';if(window.getSelection){var n,t=window.getSelection(),o=t.rangeCount?t.getRangeAt(0).cloneContents():null,a=o?o.querySelectorAll('a.LinkDecorator__linkWrap'):null;if(a&&a.length){for(n=0;n<a.length;n++)a[n].innerText=a[n].href;e=o.textContent;}else if(a=o?o.querySelectorAll('img.LinkDecorator__image'):null,a&&a.length){for(n=0;n<a.length;n++)a[n].innerText=a[n].alt;e=o.textContent;}else e=t.toString();if(!e){var i=window.getSelection().anchorNode;if(i&&i.value)e=i.value.substring(i.selectionStart,i.selectionEnd);}}else if(document.selection&&'Control'!==document.selection.type)e=document.selection.createRange().text;return e;}function _(){if(a.$body.hasClass('ws-webshot'))return;if(document.addEventListener)document.addEventListener('keydown',P,true);if(I(location.pathname)){if(u=R(location.pathname,'notes\\.html$'),!u)i.globalChannel().once('bootupReady',L);i.channel('ChannelUserAccount').subscribe('onAddNote',H);}}function I(e){return['obj/(?!Meeting/)','cncard\\.html$','PartitionTableNew\\.html$','MeetingDialog\\.html$','null-reports\\.html$','carry\\.html$','presto\\.html$','accountCard\\.html$','clientCard\\.html$','account/','webinars/'].every(function(n){return!R(e,n);});}function R(e,n){return new RegExp('^/(?:debug/)?'+n,'ig').test(e);}function D(e){return!$('#accordionBg').length&&!$('[data-component="SBIS3.Navigation.Navigation"]').length||R(e,'opendoc\\.html$');}function k(e){v=e;}function T(){return v;}function B(e){require(['SBIS3.CONTROLS/Utils/InformationPopupManager'],function(n){n.showMessageDialog({status:'error',message:e.message});});}function H(e,n){U().addCallbacks(function(){i.channel('NoteCommands').notify('Create',n);},B);}function M(e){if(f)f.cancel(),f=null;require(['Core/UserInfo'],function(e){if('__сбис__биллинг'===e.get('ЛогинКлиента'))O(0);}),x(e).addCallback(function(e){var n=e&&e.getAll(),t=n&&n.getMetaData().total||0;if(y.addCallback(function(e){i.channel('NoteCommands').notify('setHiderVisible',t>0),i.channel('NoteCommands').notify('setHiderCount',t),i.channel('NoteCommands').notify('setHiderFletching',!!(n&&n.getCount()));}),n&&n.getCount())U();return{notes:n,count:t};});}function x(e){if(!f)if(f=new o(),D(location.pathname)&&T())E(T(),D(location.pathname));else{var n=new c({adapter:'adapter.sbis',format:[{name:'PageUrl',type:'string'},{name:'showHidden',type:'boolean'}]});n.set('PageUrl',location.href),n.set('showHidden',e?null:false);var t=new s({endpoint:{contract:'Note',address:'/notes/service/'},binding:{query:'GetPinnedNotesList'}}),a=new l().where(n);f.dependOn(t.query(a).addErrback(function(e){d=e;}));}return f;}function E(e,n,t){var o=new s({endpoint:{contract:'Note',address:'/notes/service/'},binding:{query:'GetPinnedNotesList'}}),a=new c({adapter:'adapter.sbis',format:[{name:'PageUrl',type:'string'},{name:'showHidden',type:'boolean'},{name:'PanelObject',type:'string'},{name:'PanelTitle',type:'string'},{name:'PanelId',type:'string'}]});if(a.set('PanelObject',e.type),a.set('PanelTitle',e.title),a.set('PanelId',''+e.id),!n)a.set('PageUrl',location.href),a.set('showHidden',t?null:false);var i=new l().where(a);(f=o.query(i)).addCallback(function(n){var o=n.getAll(),a=o&&o.getMetaData().total||0;if(h=a,o&&o.getCount())g=o,U(e,t);return{notes:o,count:a};});}function L(){if(require(['js!SBIS3.Notes.PanelData'],function(n){function t(e){var n=e?'#'+e._id:'.edo-Dialog-head__first-line',t=$(n).closest('.ws-sticky-header__wrapper'),o=$(t).find('.ws-notes-hider-container').attr('data-notes-info');if(o){var a=o.split('-#-');return{id:a[0],type:a[1],title:a[2],canEdit:a.length>3&&'true'===a[3],containerId:e?e._id:null};}else return null;}if(i&&i.serverChannel)i.serverChannel('notes.note').subscribe('onMessage',function(e,n){if(!m&&n){var t=n.at(0);if(t){var o=t.get('EventType');if('Create'===o||'RemoveHiding'===o)U(null,true);}}});if(!i||!i.channel)return;var a=i.channel('NotesEvents');function r(e){a.notify('onPanelOpened',e._target);}function l(e){a.notify('onPanelResize',e._target);}function s(e){a.notify('onPanelClosed',e._target._id);}function c(){a.notify('onAfterPanelShow');}function d(e,t,o){if(e&&e.id){if(e.external&&n.getById(e.containerId)){if(t&&!o)return;}else n.set(e);if(!m)E(e,t);else i.channel('NoteCommands').notify('Reload',e);}}function u(o,a,i){var r=t(a);if(r){if(n.getById(r.containerId))return;if(d(r,i),a)if(e.instanceOfModule(a,'Deprecated/Controls/RecordFloatArea/RecordFloatArea')||e.instanceOfModule(a,'Deprecated/Controls/RecordArea/RecordArea'));else{var l=function(e){return'floatAreaCloseButton'!==e.getName()&&'floatAreaMaximizeButton'!==e.getName();},s=a.getChildControls(void 0,false,l)[0],c=s.getLinkedContext().getValue('record');n.setTopDocument(s,c);}}else if(o--,o>0)setTimeout(function(){u(o,a,i);},500);}if(i.globalChannel().subscribe('onFloatAreaCreating',function(e,n){if(!n._options.isStack)return;n.subscribe('onReady',r),n.subscribe('onChangeMaximizeState',l),n.subscribe('onAfterClose',s),n.subscribe('onAfterShow',c),n.subscribe('onDestroy',function(e){a.notify('onPanelClosed',e._target._id),n.unsubscribe('onReady',r),n.unsubscribe('onChangeMaximizeState',l),n.unsubscribe('onAfterClose',s),n.unsubscribe('onAfterShow',c);});}),a.subscribe('onPanelOpened',function(e,n){u(15,n);}),a.subscribe('onPanelClosed',function(e,t){var o=n.getById(t);if(o)if(n.remove(t),n.getTop()){if(n.getTop().hider)n.getTop().hider.restoreState();else i.channel('NoteCommands').notify('restorePanelHiderState',n.getTop().containerId);i.channel('NoteCommands').notify('Reload');}else i.channel('NoteCommands').notify('RemovePanelNotes',o.id);}),a.subscribe('onExtendedHiderOpened',function(e){var n=new o();if(!m)U(null,true);n.callback(),e.setResult(n);}),a.subscribe('onPanelNotesHiderLoaded',function(e,t,o,a){if(n.getTop())if(n.getTop().hider)n.getTop().hider.fakeToggleState();else if(!n.getById(t.containerId))i.channel('NoteCommands').notify('setPanelHiderFakeState',n.getTop().containerId);if(t.external=true,!m&&o){if(n.getById(t.containerId))return;n.set(t),k(t);}else d(t,D(location.pathname),a);}),D(location.pathname))i.channel('NoteCommands').notify('ResendHiderLoadedEvent'),u(15,null,true);}),!D(location.pathname))if(m);else M(false);i.channel('informers').subscribe('onCreateInformerPanel',function(){O(1);}),i.channel('navigation').subscribe('onReady',function(e,n,t){if('left'==n)require(['js!SBIS3.Notes.AccordionWrapper'],function(e){e.setAccordion(t);});}),i.channel('navigation').subscribe('onNavigate',function(e,n,t,o,a){if('AddNote'!==t)if(t===b)return;else b=t;if(N&&!a)N=false;else if('AddNote'===t&&a)i.channel('ChannelUserAccount').notify('onAddNote');else if(!a)q();});}function O(e){require(['js!SBIS3.Notes.Hider'],function(n){var t=document.createElement('div');if(document.body.appendChild(t),C=new n({name:'Hider',element:t,onPanel:false,showNotes:false}),e)C.hiderProcess(e);y.callback(C);});}function q(){if(m)i.channel('NoteCommands').notify('Reload');else M();}function U(a,r){if(d)return o.fail(d);if(m)return m;if(u)return m=o.success();return m=new o(),new t({steps:{modules:n.requireModule(['SBIS3.Notes.DynamicNotesView']),data:x(r)}}).done().getResult().addCallback(function(n){var t=n.modules[0],o=n.data.notes||g,l=n.data.count||h,s=document.createElement('div');if(e.instanceOfModule(o,'WS.Data/Source/DataSet'))o=o.getAll();document.body.appendChild(s),new t({name:'Notes',element:s,notes:o,count:l,showHidden:r,isOpenDoc:D(location.pathname),errorOnLoading:!!d,errorOnLoadingMessage:d&&d.message,handlers:{onReallyReady:function(){if(r)i.channel('NoteCommands').notify('setNotesList',this._controls.notes.getNotes());if(a)this._initSharedNotesChannel();m.callback();}}});}),m;}return{reload:q};});