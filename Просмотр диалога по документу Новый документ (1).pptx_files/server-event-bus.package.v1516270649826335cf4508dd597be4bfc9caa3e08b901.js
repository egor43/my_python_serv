(function() {
   var availableDict = {"en-US":true,"ru-RU":true},
      langMatch = String(typeof document === 'undefined' ? '' : document.cookie).match(/lang=([A-z-]+)/),
      langName = langMatch ? langMatch[1] : 'ru-RU',
      langModule = 'text!WS.Core/lang/' + langName + '/' + langName + '.json';
   if (langName in availableDict) {
      define('WS.Core_localization', ['Core/i18n', langModule], function(i18n, data) {
         if (data){
            i18n.setDict(JSON.parse(data), langModule, langName);
         }
      });
   } else {
      define('WS.Core_localization', function() {});
   }
})();

define('Lib/ServerEvent/class/logger/WatchDogAggregator',['require','exports','WS.Core_localization'],function(o,r){'use strict';return function(){function o(o){if(void 0===o)o=[];this.container=o;}return o.prototype.reg=function(o){this.container.push(o);},o.prototype.logStomp=function(o){for(var r=0,n=this.container;r<n.length;r++){var t=n[r];try{t.logStomp(o);}catch(o){var e='name'in t.constructor?t.constructor['name']:'';console.error('Error logStomp in watcher '+e+':',o.message);}}},o.prototype.logEvent=function(o,r,n){for(var t=0,e=this.container;t<e.length;t++){var c=e[t];try{c.logEvent(o,r,n);}catch(o){var i='name'in c.constructor?c.constructor['name']:'';console.error('Error logEvent in watcher '+i+':',o.message);}}},o.prototype.logConnect=function(o){for(var r=0,n=this.container;r<n.length;r++){var t=n[r];try{if(!t['logConnect'])continue;t.logConnect(o);}catch(o){var e='name'in t.constructor?t.constructor['name']:'';console.error('Error logConnect in watcher '+e+':',o.message);}}},o.prototype.logDisconnect=function(o){for(var r=0,n=this.container;r<n.length;r++){var t=n[r];try{if(!t['logDisconnect'])continue;t.logDisconnect(o);}catch(o){var e='name'in t.constructor?t.constructor['name']:'';console.error('Error logDisconnect in watcher '+e+':',o.message);}}},o;}();});
define('Lib/ServerEvent/class/Constants',['require','exports','WS.Core_localization'],function(n,E){'use strict';var t;return function(n){var E;(function(n){n['GLOBAL']='global',n['CLIENT']='client',n['USER']='user';}(E=n.CHANNEL_SCOPE||(n.CHANNEL_SCOPE={})),n.DELIVERY_COMMON='common',n.DELIVERY_HOST='host',n.DELIVERY_EXCLUSIVE_PAGE='page',n.ERR_MSG_RABBIT_OFF='Can\'t create RabbitMQ channel',n.ERR_MSG_EMPTY_SID='sid not found',n.ERR_MSG_HASH_401='!hash not found');}(t||(t={})),t;});
define('Lib/ServerEvent/class/Subscribe',['require','exports','tslib','Lib/ServerEvent/class/Constants','WS.Core_localization'],function(e,t,n,r){'use strict';var i=function(){function e(e,t){this.channelName=e,this.type=t;}return e.prototype.hash=function(){var e=this.isChanneled()?'ch':'cm';return this.channelName+'::'+e+'::'+this.getDeliveryType();},e.prototype.getDeliveryType=function(){return this.type;},e.prototype.getChannelName=function(){return this.channelName;},e.create=function(e,t,n,i){if(void 0===t)t=false;if(void 0===n)n=false;if(void 0===i)i=r.CHANNEL_SCOPE.GLOBAL;var u=n?r.DELIVERY_EXCLUSIVE_PAGE:r.DELIVERY_COMMON;if(!t)return new o(e,u);return new s(e,u,i);},e;}(),o=function(e){n.__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.channeled=false,t;}return t.prototype.isChanneled=function(){return false;},t;}(i),s=function(e){n.__extends(t,e);function t(t,n,r){var i=e.call(this,t,n)||this;return i.scope=r,i.channeled=true,i;}return t.prototype.isChanneled=function(){return true;},t.prototype.hash=function(){return e.prototype.hash.call(this)+'::'+this.scope;},t.prototype.getScope=function(){return this.scope;},t;}(i);return i;});
define('Lib/ServerEvent/class/SubscribeContainer',['require','exports','Lib/ServerEvent/native/HashedCounter','WS.Core_localization'],function(e,n,t){'use strict';return function(){function e(){this.common=new t(false),this.channeled=new t();}return e.prototype.add=function(e){if(e.isChanneled())return this.channeled.add(e);this.common.add(e);},e.prototype.remove=function(e){if(e.isChanneled())return this.channeled.remove(e);this.common.remove(e);},e.prototype.has=function(e){return this.common.has(e)||this.channeled.has(e);},e.prototype.all=function(){var e=this,n=[];return this.channeled.getSubscribes().forEach(function(t){for(var o=0;o<e.channeled.getCount(t);o++)n.push(t);}),this.common.getSubscribes().concat(n);},e.prototype.clear=function(){this.common.clear(),this.channeled.clear();},e.prototype.removeByName=function(e){return this.common.removeByName(e).concat(this.channeled.removeByName(e));},e.prototype.hasCommon=function(e){if(!e)return this.common.getSubscribes().length>0;return this.common.hasByName(e);},e.prototype.hasChanneled=function(e){if(!e)return this.channeled.getSubscribes().length>0;return this.channeled.hasByName(e);},e;}();});
define('Lib/ServerEvent/class/ConnectOptions',['require','exports','WS.Core_localization'],function(t,o){'use strict';return function(){function t(t,o,s,e,i,n,r){if(void 0===r)r=false;this.sid=t,this.hash=o,this.protocol=s,this.domain=e,this.stompPath=i,this.exchange=n,this.__isDesktop=r;}return t.prototype.getUrl=function(){return this.protocol+'//'+this.domain+this.stompPath+'s-'+this.sid+'/info?t='+new Date().valueOf();},t.prototype.isDesktop=function(){return this.__isDesktop;},t.prototype.getWebSocketUrl=function(){return('http:'===this.protocol?'ws:':'wss:')+'//'+this.domain+this.stompPath+'s-'+this.sid+'/';},t.prototype.getStompPath=function(){return this.stompPath;},t.createForDesktop=function(o,s,e){var i=e.indexOf('https://')>-1?'https:':'http:',n=e.replace('https://','').replace('http://','');return new t(o,s,i,n,'/stomp/',n,true);},t.createByLocation=function(o,s,e){var i='stomp-';if(location.host.split('.').length<3)i='stomp.';return new t(o,s,location.protocol,''+i+location.host,e,location.hostname);},t;}();});
define('Lib/ServerEvent/class/DeviceEnv',['require','exports','Core/Deferred','Transport/XHRTransport','Lib/ServerEvent/class/Constants','Lib/ServerEvent/class/ConnectOptions','WS.Core_localization'],function(r,n,t,e,a,o){'use strict';function c(){return document.cookie.split('; ').filter(function(r){return'sid='==r.substr(0,4);}).map(function(r){return r.substr(4);}).pop();}return function(){function r(){}return r.getConnectData=function(n){if(!n)n=Math.round(10000*Math.random());var a=new t();return new e({url:'/!hash/',method:'GET',dataType:'json'}).execute().addCallback(function(r){a.callback(r.result);}).addErrback(function(t){if(404===t.httpError)return void a.errback(t);setTimeout(function(){r.getConnectData(n+Math.round(10000*Math.random())).addCallback(function(r){a.callback(r);});},n);}),a;},r.getOptions=function(){var n=new t();return r.getConnectData().addCallbacks(function(r){var t=r.sid;if(!t)t=c();if(!t)throw new Error(a.ERR_MSG_EMPTY_SID);if(!r.user)return new Error(a.ERR_MSG_HASH_401);var e;if(!!r.url)e=o.createForDesktop(t,r.user,r.url);var i='/stomp/';if(!!r.path)i=r.path;if(r.domain)e=new o(t,r.user,location.protocol,r.domain,i,r.exchange);if(!e)e=o.createByLocation(t,r.user,i);n.callback(e);},function(r){n.errback(r);}),n;},r;}();});
define('Lib/ServerEvent/class/RabbitEnv',['require','exports','Core/Deferred','Transport/XHRTransport','Lib/ServerEvent/class/Constants','WS.Core_localization'],function(r,e,t,n,a){'use strict';return function(){function r(r){this.watcher=r;}return r.prototype.up=function(r){var e=this,n=new t();return this.tryCreateChannel(r).addCallback(function(r){n.callback(r);}).addErrback(function(t){if(t.message==a.ERR_MSG_RABBIT_OFF)return void n.errback(t);setTimeout(function(){e.up(r).addCallback(function(r){n.callback(r);});},5000);}),n;},r.prototype.tryCreateChannel=function(r){var e=this,t=r.getUrl();return new n({url:t,method:'GET',dataType:'json'}).execute().addErrback(function(r){return e.watcher.logConnect({message:'error get info',url:t,err:r}),r;}).addCallback(function(e){if(!e.websocket)return new Error(a.ERR_MSG_RABBIT_OFF);return r.hash;});},r;}();});
define('Lib/ServerEvent/class/creator/CreatorWorker',['require','exports','Core/Deferred','Core/detection','Core/UserInfo','Core/moduleStubs','Core/LocalStorageNative','WS.Core_localization'],function(e,r,t,n,i,o,s){'use strict';return function(){function e(e){this.connectOptions=e,this.sid=e.sid;var r=i.get('ЛогинПользователя')||'';this.isGuestAccess=r.indexOf('__сбис__гость__')>-1;}return e.prototype.isAvailableInEnv=function(e){if(e)return false;return!(n.isMobileAndroid||n.isMobileSafari||n.isIE12)&&'undefined'!=typeof Promise;},e.prototype.build=function(e){var r=this,n=new t();return o.require(['Lib/ServerEvent/worker-connect/WorkerBuilder','Lib/ServerEvent/class/transport/WorkerTransport']).addCallback(function(t){var i=t[0],o=t[1];return r.realBuild(e,i,n,o),i;}),n;},e.prototype.realBuild=function(e,r,t,n){var i=!this.isGuestAccess,o=false;if('true'==s.getItem('shared-bus-ack'))o=true;r.createConnection(this.getWorkerType(),this.connectOptions.getWebSocketUrl(),this.connectOptions.exchange,this.sid,e,i,o).addCallback(function(e){t.callback(new n(e));}).addErrback(function(e){t.errback(e),console.warn(e);});},e;}();});
define('Lib/ServerEvent/class/creator/CreatorSharedWorker',['require','exports','tslib','Lib/ServerEvent/class/creator/CreatorWorker','Core/UserInfo','Core/detection','WS.Core_localization'],function(e,r,t,n,o,i){'use strict';var a=5996298,s=window&&window.location&&'fix-online.sbis.ru'===window.location.host;return function(e){t.__extends(r,e);function r(){return null!==e&&e.apply(this,arguments)||this;}return r.prototype.isAvailableInEnv=function(r){if(r)return false;var t=parseInt(o.get('ИдентификаторКлиента')),n=parseInt(o.get('ИдентификаторПользователя')),l=s&&3===t&&n===a;return e.prototype.isAvailableInEnv.call(this,r)&&'undefined'!=typeof SharedWorker&&(l||!i.chrome);},r.prototype.getWorkerType=function(){return'SharedWorker';},r;}(n);});
define('Lib/ServerEvent/class/transport/Constants',['require','exports','WS.Core_localization'],function(E,e){'use strict';return{LS_PREFIX:'SEB',CHECK_MIN_INTERVAL:4000,RECONNECT_INTERVAL:10000,KEY_ACTUAL_DATE:'actual-date',KEY_TRY_CREATE_MAIN:'reconnect-main-time',KEY_SUBSCRIBE:'SEB.subscribe',KEY_UNSUBSCRIBE:'SEB.unsubscribe',KEY_MAINREADY:'SEB.iammain'};});
define('Lib/ServerEvent/class/creator/CreatorLocalWebSocket',['require','exports','Core/Deferred','Core/detection','Core/UserInfo','Core/moduleStubs','Lib/Storage/LocalStorage','Lib/ServerEvent/class/transport/Constants','WS.Core_localization'],function(e,t,r,n,a,o,c,i){'use strict';return function(){function e(e){this.connectOptions=e,this.ls=new c('SEB'),this.sid=e.sid;var t=a.get('ЛогинПользователя')||'';this.isGuestAccess=t.indexOf('__сбис__гость__')>-1;}return e.prototype.isAvailableInEnv=function(e){if(e)return false;return!(n.isMobileAndroid||n.isMobileSafari)&&!n.safari11&&!this.connectOptions.isDesktop();},e.prototype.build=function(e){var t=this;return this.chooseTransportConstructor().addCallback(function(r){return t.createTransport(r,e);});},e.prototype.createTransport=function(e,t){var n=this,a=new r();return this.getResources().addCallback(function(){if('LocalSlaveTransport'===e.getLocalName())return void a.callback(new e());n.connect().addCallbacks(function(r){if('LocalPageTransport'!=e.getLocalName()&&'LocalMainTransport'!=e.getLocalName())return;a.callback(new e(r,n.sid,t,!n.isGuestAccess,n.connectOptions.exchange));},function(e){a.errback(e);});}),a;},e.prototype.chooseTransportConstructor=function(){var e=this.ls.getItem(i.KEY_ACTUAL_DATE);if(!e)return o.require('Lib/ServerEvent/class/transport/LocalMainTransport').createDependent().addCallback(function(e){return e[0];});var t=new Date(e+2*i.CHECK_MIN_INTERVAL);if(t<new Date()||isNaN(t.valueOf()))return o.require('Lib/ServerEvent/class/transport/LocalMainTransport').createDependent().addCallback(function(e){return e[0];});return o.require('Lib/ServerEvent/class/transport/LocalSlaveTransport').createDependent().addCallback(function(e){return e[0];});},e.prototype.connect=function(){var t=new r();try{this.getWebSocket(this.connectOptions.getWebSocketUrl()).addCallback(function(r){var n=Stomp.over(r);n.heartbeat.outgoing=e.STOMP_HEARTBEAT_OUT_TIME,n.heartbeat.incoming=e.STOMP_HEARTBEAT_IN_TIME,n.debug=function(){},n.connect(e.LOGIN,e.PASSWORD,function(){t.callback(n);},function(e){if(t.isReady())return console.warn(e);t.errback(e);});}).addErrback(function(e){t.errback(e);});}catch(e){t.errback(e);}return t;},e.STOMP_HEARTBEAT_OUT_TIME=60000,e.STOMP_HEARTBEAT_IN_TIME=0,e.LOGIN='stomp_user',e.PASSWORD='stomp_user',e;}();});
define('Lib/ServerEvent/class/creator/CreatorWebSocket',['require','exports','tslib','Core/moduleStubs','Lib/ServerEvent/class/creator/CreatorLocalWebSocket','WS.Core_localization'],function(e,r,t,n,o){'use strict';return function(e){t.__extends(r,e);function r(){return null!==e&&e.apply(this,arguments)||this;}return r.prototype.getWebSocket=function(e){return n.require('Lib/ServerEvent/native/SockjsEmulator').addCallback(function(r){return new(0,r[0])(e);}).createDependent();},r.prototype.getResources=function(){return n.require('Lib/ServerEvent/resources/stomp');},r;}(o);});
define('Lib/ServerEvent/class/creator/CreatorSockJs',['require','exports','tslib','Core/Deferred','Core/moduleStubs','Lib/ServerEvent/class/creator/CreatorLocalWebSocket','WS.Core_localization'],function(e,r,t,s,n,o){'use strict';return function(e){t.__extends(r,e);function r(){return null!==e&&e.apply(this,arguments)||this;}return r.prototype.getResources=function(){var e=this;return n.require(['Lib/ServerEvent/resources/stomp','Lib/ServerEvent/resources/sockjs-1.0.3']).addCallback(function(r){return e.SockJS=r[1],r;});},r.prototype.getWebSocket=function(e){var r=['xhr-streaming'];try{return s.success(new this.SockJS(e.replace('wss:','https:').replace('ws:','http:'),null,{transports:r,debug:function(){},stompLogger:function(){}}));}catch(e){return s.fail(e);}},r;}(o);});
define('Lib/ServerEvent/class/creator/CreatorExclusive',['require','exports','Core/Deferred','Core/detection','Core/UserInfo','Core/moduleStubs','WS.Core_localization'],function(e,t,r,n,o,c){'use strict';return function(){function e(e){this.connectOptions=e,this.sid=e.sid;var t=o.get('ЛогинПользователя')||'';this.isGuestAccess=t.indexOf('__сбис__гость__')>-1;}return e.prototype.getWebSocket=function(e){return c.require('Lib/ServerEvent/native/SockjsEmulator').addCallback(function(t){return new(0,t[0])(e,void 0,true);}).createDependent();},e.prototype.getResources=function(){return c.require('Lib/ServerEvent/resources/stomp').createDependent();},e.prototype.isAvailableInEnv=function(e){var t=n.isMobileAndroid||n.isMobileSafari;return e||t||n.safari11||this.connectOptions.isDesktop();},e.prototype.build=function(e){var t=this;return c.require('Lib/ServerEvent/class/transport/LocalPageTransport').createDependent().addCallback(function(r){var n=r[0];return t.createTransport(n,e);}).createDependent();},e.prototype.createTransport=function(e,t){var n=this,o=new r();return this.getResources().addCallback(function(){n.connect().addCallbacks(function(r){o.callback(new e(r,n.sid,t,false,n.connectOptions.exchange));},function(e){o.errback(e);});}),o;},e.prototype.connect=function(){var t=new r();try{this.getWebSocket(this.connectOptions.getWebSocketUrl()).addCallback(function(r){var n=Stomp.over(r);n.heartbeat.outgoing=e.STOMP_HEARTBEAT_OUT_TIME,n.heartbeat.incoming=e.STOMP_HEARTBEAT_IN_TIME,n.debug=function(){},n.connect(e.LOGIN,e.PASSWORD,function(){t.callback(n);},function(e){if(t.isReady())return console.warn(e);t.errback(e);});}).addErrback(function(e){t.errback(e);});}catch(e){t.errback(e);}return t;},e.STOMP_HEARTBEAT_OUT_TIME=60000,e.STOMP_HEARTBEAT_IN_TIME=0,e.LOGIN='stomp_user',e.PASSWORD='stomp_user',e;}();});
define('Lib/ServerEvent/class/creator/CreatorExclusiveSockJs',['require','exports','tslib','Core/Deferred','Core/moduleStubs','Lib/ServerEvent/class/creator/CreatorExclusive','WS.Core_localization'],function(e,r,t,s,n,o){'use strict';return function(e){t.__extends(r,e);function r(){return null!==e&&e.apply(this,arguments)||this;}return r.prototype.getResources=function(){var e=this;return n.require(['Lib/ServerEvent/resources/stomp','Lib/ServerEvent/resources/sockjs-1.0.3']).addCallback(function(r){return e.SockJS=r[1],r;});},r.prototype.getWebSocket=function(e){var r=['xhr-streaming'];try{return s.success(new this.SockJS(e.replace('wss:','https:').replace('ws:','http:'),null,{transports:r,debug:function(){},stompLogger:function(){}}));}catch(e){return s.fail(e);}},r;}(o);});
define('Lib/ServerEvent/class/Notifier',['require','exports','Core/EventBus','Lib/ServerEvent/ResponseConverter','Lib/ServerEvent/class/logger/WatchDogAggregator','WS.Core_localization'],function(e,t,r,i,n){'use strict';var s;return function(e){e['READY']='onready',e['DISCONNECT']='ondisconnect';}(s||(s={})),function(){function e(e){if(this.watcher=e,this.readyStatuses={},!e)this.watcher=new n();}return e.prototype.setWatcher=function(e){this.watcher=e;},e.prototype.fire=function(e,t,n){if(this.isSkip(e,t))return;var s;if(n)s=i(n);this.watcher.logEvent(e,t,s),r.channel(e).notify(t,s,n);},e.prototype.isSkip=function(e,t){if(t!==s.READY&&t!==s.DISCONNECT)return false;if(t===s.READY&&this.readyStatuses[e])return true;if(t===s.READY)this.readyStatuses[e]=true;if(t===s.DISCONNECT)this.readyStatuses[e]=false;return false;},e;}();});
define('Lib/ServerEvent/class/transport/Transport',['require','exports','Lib/ServerEvent/class/logger/WatchDogAggregator','WS.Core_localization'],function(e,t,r){'use strict';return function(){function e(){this.watcher=new r(),this.messageHandler=this.messageHandler.bind(this);}return e.prototype.messageHandler=function(e){if(!('event-type'in e.headers))return;var t=e.headers['event-type'].toLocaleLowerCase();this.watcher.logStomp(e),this.delivery.deliver(t,'onmessage',e.body);},e.prototype.destructor=function(){this.delivery&&this.delivery.destroy();},e.prototype.setDelivery=function(e){this.delivery=e;},e.prototype.setWatchDog=function(e){this.watcher=e;},e;}();});
define('Lib/ServerEvent/class/transport/LocalPageTransport',['require','exports','tslib','Lib/ServerEvent/class/Constants','Lib/ServerEvent/class/transport/Transport','Lib/ServerEvent/class/SubscribeContainer','Lib/ServerEvent/native/AckSender','Core/LocalStorageNative','Lib/ServerEvent/native/EventStorage/ConnectorIE','WS.Core_localization'],function(e,t,s,i,n,r,a,o,c){'use strict';function h(e,t,s,i){return t+'-'+s+'-'+e+(i?'-'+i:'');}return function(e){s.__extends(t,e);function t(s,i,n,h,u,d){if(void 0===h)h=true;if(void 0===d)d=false;var l=e.call(this)||this;if(l.stomp=s,l.sid=i,l.hash=n,l.persistent=h,l.exchangeName=u,l.isAck=d,l.subscribes=new r(),l.onclose=function(){},l.hasCommon=false,l.guid=o.getItem('SEB.GUID'),!l.guid)l.guid=t.generateGUID(),o.setItem('SEB.GUID',l.guid);if(!h)l.guid=l.guid+Math.floor(10000*Math.random());return l.ackSender=new a(d),l.ackSender.start(),s.ws.addEventListener('close',function(e){l.onclose(e);}),l.eventStore=c.connect().addCallback(function(e){return e.getWriter();}),l;}return t.getLocalName=function(){return'LocalPageTransport';},t.prototype.messageHandler=function(t){e.prototype.messageHandler.call(this,t),this.ackSender.push(t),this.eventStore.addCallback(function(e){return e.write(t),e;});},t.prototype.subscribe=function(e){if(e.isChanneled())return this.subscribeChanneled(e);if(!this.hasCommon)this.hasCommon=true,this.stomp.subscribe('/exchange/'+this.exchangeName+':'+this.hash,this.messageHandler,this.createHeader());this.subscribes.add(e),this.delivery.deliver(e.getChannelName(),'onready');},t.prototype.subscribeChanneled=function(e){if(this.subscribes.has(e))return this.subscribes.add(e),void this.delivery.deliver(e.getChannelName(),'onready');this.subscribes.add(e);var t=e.getChannelName(),s;if(e.getScope()===i.CHANNEL_SCOPE.USER)t=(s=this.sid.split('-')[1]||'')+'$'+e.getChannelName();if(e.getScope()===i.CHANNEL_SCOPE.CLIENT)t=(s=this.sid.split('-')[0]||'')+'$'+e.getChannelName();this.stomp.subscribe('/exchange/'+this.exchangeName+'.channel/'+t,this.messageHandler,this.createChanneledHeader(e,s)),this.delivery.deliver(e.getChannelName(),'onready');},t.prototype.unsubscribe=function(e){if(this.subscribes.remove(e),!e.isChanneled())return;if(this.subscribes.has(e))return;var t;switch(e.getScope()){case i.CHANNEL_SCOPE.USER:t=this.sid.split('-')[1]||'';break;case i.CHANNEL_SCOPE.CLIENT:t=this.sid.split('-')[0]||'';}this.stomp.unsubscribe(h(e.getChannelName(),this.guid,this.hash,t)),this.delivery.deliver(e.getChannelName(),'ondisconnect');},t.prototype.destructor=function(){if(this.callDisconnect(),e.prototype.destructor.call(this),this.ackSender.stop(),3==this.stomp.ws.readyState||2==this.stomp.ws.readyState)return;this.stomp.ws.close(1000);},t.prototype.setDisconnectHandler=function(e){var t=this;this.onclose=function(){t.destructor(),e();};},t.prototype.close=function(){this.destructor();},t.prototype.callDisconnect=function(){var e=this,t=function(t){e.delivery.deliver(t,'ondisconnect');};this.subscribes.all().forEach(t);},t.prototype.createHeader=function(){var e={receipt:this.hash,id:this.guid+'-'+this.hash,persistent:this.persistent,'auto-delete':!this.persistent};if(this.isAck)e['prefetch-count']=10,e['ack']='client';return e;},t.prototype.createChanneledHeader=function(e,t){var s=h(e.getChannelName(),this.guid,this.hash,t),i={receipt:this.hash,id:s,persistent:this.persistent,'auto-delete':!this.persistent};if(this.isAck)i['prefetch-count']=10,i['ack']='client';return i;},t.generateGUID=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1);}return e()+e()+'-'+e()+'-'+e()+'-'+e()+'-'+e()+e()+e();},t;}(n);});
define('Lib/ServerEvent/class/transport/WorkerTransport',['require','exports','tslib','Lib/ServerEvent/class/transport/Transport','Lib/ServerEvent/class/SubscribeContainer','WS.Core_localization'],function(e,n,t,s,o){'use strict';return function(e){t.__extends(n,e);function n(n){var t=e.call(this)||this;return t.connect=n,t.subscribes=new o(),n.onmessage=t.messageHandler,t.unloadWindow=t.unloadWindow.bind(t),window.addEventListener('unload',t.unloadWindow),t;}return n.getLocalName=function(){return'WorkerTransport';},n.prototype.subscribe=function(e){if(this.subscribes.add(e),!e.isChanneled())this.connect.subscribe(e.getChannelName());else this.connect.subscribeChanneled(e.getChannelName(),e.getScope());this.delivery.deliver(e.getChannelName(),'onready');},n.prototype.unsubscribe=function(e){if(this.subscribes.remove(e),this.subscribes.has(e))return;if(this.delivery.deliver(e.getChannelName(),'ondisconnect'),!e.isChanneled())return;this.connect.unsubscribeChanneled(e.getChannelName(),e.getScope());},n.prototype.destructor=function(){window.removeEventListener('unload',this.unloadWindow),this.callDisconnect(),this.connect.destructor(),e.prototype.destructor.call(this);},n.prototype.setDisconnectHandler=function(e){var n=this;this.connect.onwebsocketclose=function(t){n.destructor(),e();};},n.prototype.unloadWindow=function(){this.close();},n.prototype.close=function(){for(var e=0,n=this.subscribes.all();e<n.length;e++){var t=n[e];this.unsubscribe(t);}this.destructor(),this.connect.onwebsocketclose=function(){};},n.prototype.callDisconnect=function(){var e=this,n=function(n){e.delivery.deliver(n,'ondisconnect');};this.subscribes.all().forEach(n);},n;}(s);});
define('Lib/ServerEvent/class/deliver/LSEventDeliver',['require','exports','Lib/TabMessage/TabMessage','WS.Core_localization'],function(e,t,n){'use strict';return function(){function e(t){this.notifier=t,this.onmessageHandler=this.onmessageHandler.bind(this),this.taber=new n(),this.taber.subscribe(e.ON_MESSAGE,this.onmessageHandler);}return e.prototype.onmessageHandler=function(e,t){this.notifier.fire(t.channelName,t.eventName,t.rawData);},e.prototype.deliver=function(t,n,s){this.notifier.fire(t,n,s),this.taber.notify(e.ON_MESSAGE,{channelName:t,eventName:n,rawData:s});},e.prototype.destroy=function(){this.taber.unsubscribe(e.ON_MESSAGE,this.onmessageHandler);},e.ON_MESSAGE='servereventbus_onmessage',e;}();});
define('Lib/ServerEvent/class/deliver/PageEventDeliver',['require','exports','WS.Core_localization'],function(e,t){'use strict';return function(){function e(e){this.notifier=e;}return e.prototype.deliver=function(e,t,i){this.notifier.fire(e,t,i);},e.prototype.destroy=function(){},e;}();});
define('Lib/ServerEvent/class/deliver/DeliveryChooser',['require','exports','Core/Deferred','Lib/ServerEvent/class/Notifier','Lib/ServerEvent/class/transport/LocalPageTransport','Lib/ServerEvent/class/transport/WorkerTransport','Lib/ServerEvent/class/deliver/LSEventDeliver','Lib/ServerEvent/class/deliver/PageEventDeliver','WS.Core_localization'],function(e,r,t,n,s,i,c,o){'use strict';var v=new n();return function(){function e(e){this.watcher=e,v.setWatcher(e);}return e.prototype.choose=function(e){if(e instanceof i||e instanceof s)return t.success(new o(v));return t.success(new c(v));},e;}();});
define('Lib/ServerEvent/class/transport/TransportChooser',['require','exports','Core/Deferred','Lib/ServerEvent/class/logger/WatchDogAggregator','Lib/ServerEvent/class/RabbitEnv','Lib/ServerEvent/class/creator/CreatorSharedWorker','Lib/ServerEvent/class/creator/CreatorWebSocket','Lib/ServerEvent/class/creator/CreatorSockJs','Lib/ServerEvent/class/creator/CreatorExclusive','Lib/ServerEvent/class/creator/CreatorExclusiveSockJs','Lib/ServerEvent/class/deliver/DeliveryChooser','WS.Core_localization'],function(e,r,t,n,o,i,s,c,a,l,u){'use strict';return function(){function e(e,r,t,o){if(void 0===r)r=function(e){return e;};if(void 0===t)t=false;if(void 0===o)o=new n();this.connectOptions=e,this.onclose=r,this.isExclusive=t,this.watcher=o,this.builders=[],this.deliveryChooser=new u(o);for(var v=0,d=[i,s,c,a,l];v<d.length;v++){var h=new(0,d[v])(this.connectOptions);if(!h.isAvailableInEnv(this.isExclusive))continue;this.builders.push(h);}}return e.prototype.destructor=function(){var e=this;this.defStrategy&&this.defStrategy.addCallback(function(r){e.watcher&&e.watcher.logDisconnect('Manual disconnect'),r.close();});},e.prototype.choose=function(){var e=this;if(this.defStrategy)return this.defStrategy.createDependent();return this.defStrategy=this.build(),this.defStrategy.addCallback(function(r){return r.setDisconnectHandler(function(r){e.defStrategy=void 0,e.onclose(r);}),r.setWatchDog(e.watcher),e.deliveryChooser.choose(r).addCallback(function(e){r.setDelivery(e);}),r;}),this.defStrategy.createDependent();},e.prototype.build=function(){var e=this;return new o(this.watcher).up(this.connectOptions).addCallback(function(r){return e.createTransport(r);});},e.prototype.createTransport=function(e){for(var r=new t(),n=function(t){r.addErrback(function(){return t.build(e);});},o=0,i=this.builders;o<i.length;o++)n(i[o]);return r.addErrback(function(e){return console.error('No one server event bus transport choice.'),e;}),r.errback(),r;},e;}();});
define('Lib/ServerEvent/DebugUtils',['require','exports','Core/moduleStubs','WS.Core_localization'],function(e,n,t){'use strict';function r(){if('function'!==typeof Promise)return;var e=function(e){var n='';if(e['headers']&&e['headers']['event-type'])n=e['headers']['event-type'];console.log('[EventLog]',new Date(e.timestamp).toLocaleString(),n,e);},n=function(n,t){n.query(t).then(function(n){n.forEach(e);});},r;window['sharedBusLog']=function(e){if(r)return void n(r,e);t.require(['Lib/ServerEvent/native/EventStorage/Connector']).addCallback(function(t){t[0].connect().then(function(t){r=t.getReader(),n(r,e);});});};}var o=false;function i(){if(o)return;o=true,t.require(['Lib/ServerEvent/Bus','Lib/ServerEvent/class/logger/ConsoleWatchDog']).addCallback(function(e){var n=e[0],t=e[1];n['addWatchDog'](new t());});}return{attachDebugFn:function(){if(!window)return;r(),window['sharedBusWatch']=i;}};});
define('Lib/ServerEvent/class/transport/ExclusiveProxy',['require','exports','Lib/ServerEvent/class/Constants','Core/Deferred','Core/LocalStorageNative','Lib/ServerEvent/class/DeviceEnv','Lib/ServerEvent/class/transport/TransportChooser','Lib/ServerEvent/DebugUtils','WS.Core_localization'],function(t,e,r,n,s,o,i,c){'use strict';var a=function(){function t(){this.message='Need subscribe connect to subscribe',this.name='SubscrideExclusiveError';}return t;}();return function(){function t(t,e){this.transport=t,this.isExclusive=e;}return t.init=function(e,r,a){if(void 0===e)e=false;var u=new n(),p;return o.getOptions().addCallback(function(t){return p=t,new i(t,r,e,a).choose();}).addCallback(function(r){try{if(c.attachDebugFn(),a.logConnect({options:p,transport:r.constructor.getLocalName()}),window&&'true'===s.getItem('shared-bus-debug'))window['sharedBusWatch']();}catch(t){}u.callback(new t(r,e));}).addErrback(function(t){return u.errback(t),t;}),u;},t.prototype.subscribe=function(t){if(t.getDeliveryType()!==r.DELIVERY_COMMON&&!this.isExclusive)throw new a();this.transport.subscribe(t);},t.prototype.unsubscribe=function(t){this.transport.unsubscribe(t);},t.prototype.setDelivery=function(t){this.transport.setDelivery(t);},t.prototype.setDisconnectHandler=function(t){this.transport.setDisconnectHandler(t);},t.prototype.close=function(){this.transport.close(),this.transport=void 0;},t.prototype.setWatchDog=function(t){this.transport.setWatchDog(t);},t;}();});
define('Lib/ServerEvent/class/logger/ConnectWatchDog',['require','exports','WS.Core_localization'],function(o,n){'use strict';return function(){function o(){}return o.prototype.logStomp=function(o){},o.prototype.logEvent=function(o,n,t){},o.prototype.logConnect=function(o){console.log('[STOMP][Connect]['+new Date().toLocaleString()+']',o);},o.prototype.logDisconnect=function(o){console.log('[STOMP][Disconnect]['+new Date().toLocaleString()+']',o);},o;}();});
define('Lib/ServerEvent/class/logger/Bit',['require','exports','Transport/RPCJSON','Core/UserInfo','WS.Core_localization'],function(t,e,n,i){'use strict';var s='sbis.page.ping',r='/test_client_service/service/',c='ClientEventTest.Record',o=6*60*1000,a=function(){function t(t,e){if(void 0===e)e=Date.now();this.num=t,this.timestamp=e;}return t.compare=function(t,e){if(t.num>e.num)return 1;if(t.num<e.num)return-1;return 0;},t;}();return function(){function t(e){var n=this;if(this.pings=[],!window)return;this.tabId=t.generateID(),this.appendPing=this.appendPing.bind(this),this.detectAfterReconnect=this.detectAfterReconnect.bind(this),e.serverChannel(s).subscribe('onready',function(){n.lastConnect=Date.now();}),e.serverChannel(s).subscribe('onmessage',this.appendPing),e.serverChannel(s).subscribe('ondisconnect',function(){if(n.lastDisconnect=Date.now(),n.detectMode)clearTimeout(n.detectMode);n.detectMode=setTimeout(n.detectAfterReconnect,o);});}return t.prototype.appendPing=function(t,e){if(this.detectMode)return void this.pings.push(new a(e));if(this.lastPingNum+1==e)return void(this.lastPingNum=e);if(0==e)return void(this.lastPingNum=0);if(0==this.lastPingNum)return void(this.lastPingNum=e);var s=i.get('ИдентификаторПользователя');if(this.lastPingNum+1<e)(o=new n({serviceUrl:r,async:true})).callMethod(c,{data:{m:'skip',userId:s,tab:this.tabId,last:this.lastPingNum,current:e,detected:Date.now(),connect:this.lastConnect,disconnect:this.lastDisconnect}});if(this.lastPingNum+1>e){var o=new n({serviceUrl:r,async:true});o.callMethod(c,{data:{m:'wrong order',userId:s,tab:this.tabId,last:this.lastPingNum,current:e,detected:Date.now(),connect:this.lastConnect,disconnect:this.lastDisconnect}});}this.lastPingNum=e;},t.prototype.detectAfterReconnect=function(){if(0===this.pings.length)return;for(var t=i.get('ИдентификаторПользователя'),e=this.pings.sort(a.compare),s=e.shift(),o=0,u=e;o<u.length;o++){var d=u[o];if(s.num+1===d.num){s=d;continue;}var h={m:'skip',userId:t,tab:this.tabId,last:s.num,current:d.num,detected:d.timestamp,connect:this.lastConnect,disconnect:this.lastDisconnect};try{new n({serviceUrl:r,async:true}).callMethod(c,{data:h});}catch(t){}}this.pings=[],this.lastPingNum=s.num,this.detectMode=void 0;},t.generateID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1);}return t()+t();},t;}();});
define('Lib/ServerEvent/Bus',['require','exports','Core/Deferred','Core/EventBus','Core/UserInfo','Core/LocalStorageNative','Lib/ServerEvent/class/logger/WatchDogAggregator','Lib/ServerEvent/class/Constants','Lib/ServerEvent/class/Subscribe','Lib/ServerEvent/class/SubscribeContainer','Lib/ServerEvent/class/transport/ExclusiveProxy','Lib/ServerEvent/class/logger/ConnectWatchDog','Lib/ServerEvent/class/logger/Bit','WS.Core_localization'],function(e,r,s,t,i,n,c,o,a,u,b,h,l){'use strict';var f=parseInt(i.get('ИдентификаторКлиента')),v=false;if([3].indexOf(f)>-1)n.setItem('shared-bus-ack','true'),v=true;else n.removeItem('shared-bus-ack');var d=function(){function e(e){if(void 0===e)e='Это приложение не имеет серверных событий';this.message=e;}return e;}(),C=new(function(){function e(){this.subscribes=new u(),this.isExclusive=false,this.watcher=new c([new h()]),this.initDeferred=new s(),this.subscribe=this.subscribeInit.bind(this),this.closeChannel=this.closeChannel.bind(this),this.closeTransportBehavior=this.closeTransportBehavior.bind(this);}return e.prototype.subscribe=function(e){},e.prototype.subscribeClear=function(e,r){if(this.subscribes.has(r))return;this.subscribes.add(r);try{e.subscribe(r);}catch(e){if('SubscrideExclusiveError'!==e.name)throw e;this.isExclusive=true,this.reconnect();}},e.prototype.subscribeBeforeReconnect=function(e){if(this.subscribes.has(e))return;this.subscribes.add(e);},e.prototype.subscribeDeferred=function(e){var r=this;this.initDeferred.addCallback(function(s){return r.subscribeClear(s,e),s;});},e.prototype.subscribeInit=function(e){var r=this;this.subscribe=this.subscribeDeferred,this.subscribeDeferred(e);try{b.init(this.isExclusive||e.getDeliveryType()!==o.DELIVERY_COMMON,this.closeTransportBehavior,this.watcher).addCallback(function(e){if(r.subscribe=r.subscribeClear.bind(r,e),v&&!r.bitSensor)r.bitSensor=new l(t);r.initDeferred.callback(e);}).addErrback(function(s){if(404===s.httpError)r.initDeferred=void 0,console.warn(new d().message),r.subscribe=function(){};console.warn('Не удалось подписаться на '+e.getChannelName());});}catch(e){this.subscribe=function(){};}},e.prototype.addWatchDog=function(e){this.watcher.reg(e);},e.prototype.closeTransportBehavior=function(e){this.watcher.logDisconnect(e),this.reInit();},e.prototype.reInit=function(){this.initDeferred=new s(),this.subscribe=this.subscribeInit;var e=this.subscribes.all();this.subscribes.clear();for(var r=0,t=e;r<t.length;r++){var i=t[r];this.subscribe(i);}},e.prototype.reconnect=function(){var e=this;if(!this.initDeferred)return this.reInit();this.initDeferred.addCallbacks(function(r){return e.subscribe=e.subscribeBeforeReconnect.bind(e),r.close(),r;},function(){e.reInit();});},e.prototype.closeChannel=function(e){var r=this;this.initDeferred.addCallback(function(s){for(var t=0,i=r.subscribes.removeByName(e);t<i.length;t++){var n=i[t];s.unsubscribe(n);}return s;});},e;}())(),p=[],E=[o.CHANNEL_SCOPE.GLOBAL,o.CHANNEL_SCOPE.USER,o.CHANNEL_SCOPE.CLIENT];function g(e,r){var s=e.toLocaleLowerCase(),i=t.channel(s);if(-1==p.indexOf(s))i.setEventQueueSize('onready',1),p.push(s);var n=r||{};return setTimeout(function(){if(!n.isChanneled)return void C.subscribe(a.create(s,n.isChanneled,n.exclusive));for(var e=0,r=n.scopes||E;e<r.length;e++){var t=r[e];C.subscribe(a.create(s,n.isChanneled,n.exclusive,t));}},0),i;}return g['reconnect']=function(){C.reconnect();},g['close']=function(e){C.closeChannel(e);},g['SCOPE']=o.CHANNEL_SCOPE,t['addWatchDog']=function(e){C.addWatchDog(e);},t['serverChannel']=g,t;});
define('Lib/ServerEvent/class/logger/ConfirmLogger',['require','exports','WS.Core_localization'],function(t,n){'use strict';return function(){function t(){this.data=new Map();}return t.prototype.send=function(t,n){var e=this.data.get(t);if(e=e||{},!(n in e))e[n]={send:0,confirm:0};e[n]['send']++,this.data.set(t,e);},t.prototype.confirm=function(t,n){var e=this.data.get(t);if(e=e||{},!(n in e))e[n]={send:0,confirm:0};e[n]['confirm']++,this.data.set(t,e);},t.prototype.stat=function(){var t=[];return this.data.forEach(function(n){t.push(n);}),t;},t;}();});
define('Lib/ServerEvent/class/logger/ConsoleWatchDog',['require','exports','WS.Core_localization'],function(o,e){'use strict';return function(){function o(){}return o.prototype.logStomp=function(o){console.log('[STOMP]',o);},o.prototype.logEvent=function(o,e,n){console.log('[ServerEvent]['+o+']['+e+']',n);},o;}();});
define('Lib/ServerEvent/class/transport/LocalMainTransport',['require','exports','Lib/ServerEvent/class/transport/Constants','Lib/ServerEvent/class/transport/LocalPageTransport','Lib/TabMessage/TabMessage','Lib/ServerEvent/class/Subscribe','Lib/Storage/LocalStorage','Core/LocalStorageNative','WS.Core_localization'],function(t,e,s,r,i,n,a,o){'use strict';return function(){function t(t,e,c,u,b){if(void 0===u)u=true;var h=this;this.stomp=t,this.sid=e,this.hash=c,this.persistent=u,this.exchangeName=b,this.ls=new a(s.LS_PREFIX),this.taber=new i(),this.isAloneMain=true,this.fixMain();var l=Date.now();this.taber.notify(s.KEY_MAINREADY,l);var p=function(t,e){if(e<l)return;h.taber.unsubscribe(s.KEY_MAINREADY,p),h.isAloneMain=false,h.close(),h.disconnectCallback('Detect later main.');};this.taber.subscribe(s.KEY_MAINREADY,p),this.ls.removeItem(s.KEY_TRY_CREATE_MAIN),this.mainChecker=setInterval(function(){h.fixMain();},s.CHECK_MIN_INTERVAL);var f=false;if('true'==o.getItem('shared-bus-ack'))f=true;this.transport=new r(t,e,c,u,b,f),this.subFromTaber=function(t,e){h.subscribe(n.create(e.channelName,e.channeled,false,e.scope));},this.unsubFromTaber=function(t,e){h.unsubscribe(n.create(e.channelName,e.channeled,false,e.scope));},this.taber.subscribe(s.KEY_SUBSCRIBE,this.subFromTaber),this.taber.subscribe(s.KEY_UNSUBSCRIBE,this.unsubFromTaber),window&&window.addEventListener('unload',function(){h.close();});}return t.prototype.fixMain=function(){this.ls.setItem(s.KEY_ACTUAL_DATE,Date.now());},t.getLocalName=function(){return'LocalMainTransport';},t.prototype.subscribe=function(t){this.transport.subscribe(t);},t.prototype.unsubscribe=function(t){this.transport.unsubscribe(t);},t.prototype.destructor=function(){if(this.taber)this.taber.unsubscribe(s.KEY_SUBSCRIBE,this.subFromTaber),this.taber.unsubscribe(s.KEY_UNSUBSCRIBE,this.unsubFromTaber),this.taber=void 0;if(this.isAloneMain)this.ls.removeItem(s.KEY_ACTUAL_DATE);clearInterval(this.mainChecker);},t.prototype.setDisconnectHandler=function(t){var e=this;this.disconnectCallback=t,this.transport.setDisconnectHandler(function(s){e.destructor(),t(s);});},t.prototype.close=function(){this.transport.close(),this.destructor();},t.prototype.setDelivery=function(t){this.transport.setDelivery(t);},t.prototype.setWatchDog=function(t){this.transport.setWatchDog(t);},t;}();});
define('Lib/ServerEvent/class/transport/LocalSlaveTransport',['require','exports','tslib','Lib/ServerEvent/class/transport/Constants','Lib/ServerEvent/class/transport/Transport','Lib/ServerEvent/class/SubscribeContainer','Lib/TabMessage/TabMessage','Lib/Storage/LocalStorage','WS.Core_localization'],function(t,e,n,r,s,i,a,o){'use strict';return function(t){n.__extends(e,t);function e(){var e=t.call(this)||this;return e.ls=new o(r.LS_PREFIX),e.taber=new a(),e.subscribes=new i(),e.minInterval=2*r.CHECK_MIN_INTERVAL+Math.floor(Math.random()*r.RECONNECT_INTERVAL),e.setDisconnectHandler(function(){}),e.subMainReady=function(){if(!e.subscribes.hasChanneled())return;e.destructor(),e.disconnectCallback('Reconnect to resubscribe');},e.taber.subscribe(r.KEY_MAINREADY,e.subMainReady),e.unloadWindow=e.unloadWindow.bind(e),window.addEventListener('unload',e.unloadWindow),e;}return e.getLocalName=function(){return'LocalSlaveTransport';},e.prototype.subscribe=function(t){this.subscribes.add(t),this.taber.notify(r.KEY_SUBSCRIBE,t);},e.prototype.unsubscribe=function(t){this.subscribes.remove(t),this.taber.notify(r.KEY_UNSUBSCRIBE,t);},e.prototype.destructor=function(){try{throw new Error();}catch(t){console.warn(t.trace);}if(this.taber.unsubscribe(r.KEY_MAINREADY,this.subMainReady),this.mainChecker)clearInterval(this.mainChecker),this.mainChecker=void 0;this.taber=void 0,window.removeEventListener('unload',this.unloadWindow),t.prototype.destructor.call(this);},e.prototype.setDisconnectHandler=function(t){var e=this;if(this.disconnectCallback=t,this.mainChecker)clearInterval(this.mainChecker);this.mainChecker=setInterval(function(){if(e.ls.getItem(r.KEY_ACTUAL_DATE)+e.minInterval>Date.now())return;if((e.ls.getItem(r.KEY_TRY_CREATE_MAIN)||0)+r.RECONNECT_INTERVAL>Date.now())return;e.ls.setItem(r.KEY_TRY_CREATE_MAIN,Date.now()),e.destructor(),t('Main is dead');},this.minInterval);},e.prototype.unloadWindow=function(){this.close();},e.prototype.close=function(){for(var t=0,e=this.subscribes.all();t<e.length;t++){var n=e[t];this.taber.notify(r.KEY_UNSUBSCRIBE,n);}this.destructor();},e;}(s);});
define('Lib/ServerEvent/worker-connect/Constants',['require','exports','WS.Core_localization'],function(e,n){'use strict';var r;return function(e){var n;(function(e){e['CONNECT']='connect',e['ERROR']='error',e['READY']='ready',e['MESSAGE']='message',e['CLOSE']='close',e['HANDSHAKE']='handshake',e['WEBSOCKET_CLOSE']='websocket.close';}(n=e.SW_MESSAGES||(e.SW_MESSAGES={})));}(r||(r={})),r;});
define('Lib/ServerEvent/worker-connect/messages/Page',['require','exports','tslib','WS.Core_localization'],function(n,e,t){'use strict';var r;return function(n){var e=function(){function n(n){this.command=n;}return n;}();n.PortMessage=e;var r=function(n){t.__extends(e,n);function e(){return n.call(this,'disconnect')||this;}return e;}(e);n.PmDisconnect=r;var s=function(n){t.__extends(e,n);function e(e,t,r,s,i,c){if(void 0===c)c=false;var u=n.call(this,'connect')||this;return u.url=e,u.exchangeName=t,u.sid=r,u.hash=s,u.persist=i,u.ack=c,u;}return e;}(e);n.PmConnect=s;var i=function(n){t.__extends(e,n);function e(e){var t=n.call(this,'subscribe')||this;return t.eventName=e,t;}return e;}(e);n.PmSubscribe=i;var c=function(n){t.__extends(e,n);function e(e,t){var r=n.call(this,'subscribe.channel')||this;return r.eventName=e,r.person=t,r;}return e;}(e);n.PmSubChanneled=c;var u=function(n){t.__extends(e,n);function e(e){var t=n.call(this,'unsubscribe')||this;return t.eventName=e,t;}return e;}(e);n.PmUnsubscribe=u;var a=function(n){t.__extends(e,n);function e(e,t){var r=n.call(this,'unsubscribe.channel')||this;return r.eventName=e,r.person=t,r;}return e;}(e);n.PmUnsubChanneled=a;}(r||(r={})),r;});
define('Lib/ServerEvent/worker-connect/SwConnect',['require','exports','Lib/ServerEvent/worker-connect/Constants','Lib/ServerEvent/worker-connect/messages/Page','Lib/ServerEvent/class/Constants','WS.Core_localization'],function(e,t,n,o,r){'use strict';var s;return function(e){var t=function(){function e(e,t){this._onmessage=function(){},this._onready=function(){},this._ondisconnect=function(){},this._onwebsocketclose=function(){},this._connect=e,this._connect.port1.onmessage=this.messageHandler.bind(this),this.clientId=t&&t.split('-')[0]||'',this.userId=t&&t.split('-')[1]||'';}return e.prototype.subscribe=function(e){this._connect.port1.postMessage(new o.PmSubscribe(e));},e.prototype.subscribeChanneled=function(e,t){var n;switch(t){case r.CHANNEL_SCOPE.USER:n=this.userId;break;case r.CHANNEL_SCOPE.CLIENT:n=this.clientId;}this._connect.port1.postMessage(new o.PmSubChanneled(e,n));},e.prototype.unsubscribeChanneled=function(e,t){var n;switch(t){case r.CHANNEL_SCOPE.USER:n=this.userId;break;case r.CHANNEL_SCOPE.CLIENT:n=this.clientId;}this._connect.port1.postMessage(new o.PmUnsubChanneled(e,n));},Object.defineProperty(e.prototype,'onmessage',{set:function(e){if(!(e instanceof Function))return void(this._onmessage=function(){});this._onmessage=e;},enumerable:true,configurable:true}),Object.defineProperty(e.prototype,'onready',{set:function(e){if(!(e instanceof Function))return void(this._onready=function(){});this._onready=e;},enumerable:true,configurable:true}),Object.defineProperty(e.prototype,'ondisconnect',{set:function(e){if(!(e instanceof Function))return void(this._ondisconnect=function(){});this._ondisconnect=e;},enumerable:true,configurable:true}),Object.defineProperty(e.prototype,'onwebsocketclose',{set:function(e){if(!(e instanceof Function))return void(this._onwebsocketclose=function(){});this._onwebsocketclose=e;},enumerable:true,configurable:true}),Object.defineProperty(e.prototype,'connect',{get:function(){return this._connect;},enumerable:true,configurable:true}),e.prototype.messageHandler=function(e){if(!(e&&e.data&&e.data.type))return;if(e.data.type==n.SW_MESSAGES.WEBSOCKET_CLOSE)return this._onwebsocketclose();if(!(e&&e.data&&e.data.headers&&e.data.headers['event-type']))return;var t=e.data.headers['event-type'].toLocaleLowerCase();if(e.data.type==n.SW_MESSAGES.CLOSE)return this._ondisconnect(t);if(e.data.type==n.SW_MESSAGES.READY)return this._onready(t);if(e.data.type!=n.SW_MESSAGES.MESSAGE)return;this._onmessage(e.data.message);},e.prototype.closePort=function(){this._connect.port1.postMessage(new o.PmDisconnect()),this._connect.port1.close();},e.prototype.destructor=function(){this.closePort(),this._connect=void 0;},e;}();e.Connect=t;var s=function(){function e(e){this.channel=e;}return e.prototype.connect=function(e,n,r,s,c,i){var a=this;return new Promise(function(t,u){a.channel.port1.onmessage=function(e){var n=e.data;if('error'==n.type)return u(e.data.message);if(a.channel.port1.onmessage=void 0,'connect'==n.type)t(a.channel);},a.channel.port1.postMessage(new o.PmConnect(e,n,r,s,c,i));}).then(function(e){return new t(e,r);});},e;}();e.Connector=s;}(s||(s={})),s;});
define('Lib/ServerEvent/worker-connect/WorkerBuilder',['require','exports','tslib','Core/Deferred','Lib/ServerEvent/worker-connect/SwConnect','WS.Core_localization'],function(e,r,n,t,o){'use strict';var i=317.35,s=function(){return this||(0,eval)('this');}(),a='/ws/';if(window&&window['service']&&window['service']['wsRoot'])a='/'==(a=window['service']['wsRoot'])[a.length-1]?a:a+'/';var c=a+'lib/ServerEvent/worker/',u=c+'event-bus-shared.worker.js?v='+i,h=c+'event-bus-web.worker.js',f=function(){function e(e){if(this.worker=e,e instanceof SharedWorker)this.postMessage=this._postSharedWorker;}return e.prototype.postMessage=function(e,r){return this.worker.postMessage(e,r);},e.prototype._postSharedWorker=function(e,r){return this.worker.port.postMessage(e,r);},e.prototype.terminate=function(){return this.worker.terminate();},e;}(),w=function(e){n.__extends(r,e);function r(r,n){var t=e.call(this,'handshake')||this;return t.port=r,t.debug=n,t;}return r;}(function(){function e(e){this.command=e;}return e;}()),k=function(){function e(e){this.sw=e,this.channel=new MessageChannel();}return e.prototype.shake=function(){var e=this;return new Promise(function(r,n){e.channel.port1.onmessage=function(n){var t=n.data;if(e.channel.port1.onmessage=void 0,'handshake'==t.type)r(e.channel);};var t;if(d.IsDebugPort)t=true;e.sw.postMessage(new w(e.channel.port2,t),[e.channel.port2]);});},e;}(),v=function(){function e(){}return e.getWorkerContainer=function(r){var n;switch(r){case e.SHARED_WORKER:n=e.getSharedWorker;break;case e.WORKER:default:n=e.getWorker;}return n().then(function(e){return new f(e);});},e.getSharedWorker=function(){var e=u;if(!('SharedWorker'in s))return Promise.reject(new ReferenceError('SharedWorker is not support.'));var r=new SharedWorker(e);return r.port.start(),Promise.resolve(r);},e.getWorker=function(){var e=h;if(!('Worker'in s))return Promise.reject(new ReferenceError('Worker is not support.'));return Promise.resolve(new Worker(e));},e.TIMEOUT=5000,e.STATE_INSTALLING='installing',e.STATE_INSTALLINED='installed',e.STATE_ACTIVATING='activating',e.STATE_ACTIVATED='activated',e.STATE_REDUNDANT='redundant',e.WORKER='worker',e.SHARED_WORKER='SharedWorker',e.SERVICE_WORKER='ServiceWorker',e;}(),d=function(){function e(){}return e.createConnection=function(e,r,n,i,s,a,c){var u=new t();return v.getWorkerContainer(e).then(function(e){return new k(e).shake().then(function(e){return e;});}).then(function(e){return new o.Connector(e).connect(r,n,i,s,a,c);}).then(function(e){u.callback(e);}).catch(function(e){u.errback(e);}),u;},e.IsDebugPort=false,e.IsDebugEB=false,e;}();return d;});
define('Lib/ServerEvent/worker-connect/messages/Sw',['require','exports','WS.Core_localization'],function(e,r){'use strict';return SwMessage;});