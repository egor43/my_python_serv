(function() {
   var availableDict = {"en-US":true},
      langMatch = String(typeof document === 'undefined' ? '' : document.cookie).match(/lang=([A-z-]+)/),
      langName = langMatch ? langMatch[1] : 'ru-RU',
      langModule = 'text!SBIS3.Plugin/lang/' + langName + '/' + langName + '.json';
   if (langName in availableDict) {
      define('SBIS3.Plugin_localization', ['Core/i18n', langModule], function(i18n, data) {
         if (data){
            i18n.setDict(JSON.parse(data), langModule, langName);
         }
      });
   } else {
      define('SBIS3.Plugin_localization', function() {});
   }
})();

define('js!SBIS3.Plugin/components/SbisPluginLocalStorage',['Lib/Storage/LocalStorage','SBIS3.Plugin_localization'],function(n){return new n('SBIS3.Plugin',true);});
define('js!SBIS3.Plugin/Source/Error/SbisPluginError',['Core/core-extend','SBIS3.Plugin_localization'],function(r){function t(r){if(this.message=r,Error.captureStackTrace)Error.captureStackTrace(this);else this.stack=new Error(r).stack||'';}return r.classicExtend(t,Error),t.prototype.toString=function(){return this.stack||this.message;},t;});
define('js!SBIS3.Plugin/Source/Error/ConnectionError',['Core/core-extend','js!SBIS3.Plugin/Source/Error/SbisPluginError','SBIS3.Plugin_localization'],function(E,N){'use strict';function O(E,N,R){R=R||O.detailStrings[N]||O.detailStrings.UNKNOWN_ERROR,this.type=E,this.description=N,this.errorType=N,this.constructor.superclass.constructor.call(this,R);}return O.errorsType={USER_CANCELLED:'USER_CANCELLED',SILENT_MODE:'SILENT_MODE',INTERNAL_SERVER_ERROR:'INTERNAL_SERVER_ERROR',INTERNAL_CLIENT_ERROR:'INTERNAL_CLIENT_ERROR',INTERACTION_ERROR:'INTERACTION_ERROR'},O.detailTypes={OLD_FLASH_PLAYER:'OLD_FLASH_PLAYER',UNABLE_TO_CONNECT:'UNABLE_TO_CONNECT',OPEN:'OPEN',CLOSE:'CLOSE',IS_MOBILE:'IS_MOBILE',COMMUNICATION_ERROR:'COMMUNICATION_ERROR',UNKNOWN_ERROR:'UNKNOWN_ERROR',UNKNOWN_SERVER_ERROR:'UNKNOWN_SERVER_ERROR',UNKNOWN_RECEIVER:'UNKNOWN_RECEIVER',NO_RESPONSE_DURING:'NO_RESPONSE_DURING',PLUGIN_NOT_INIT:'PLUGIN_NOT_INIT',BAD_ENDPOINT_REQUEST:'BAD_ENDPOINT_REQUEST',SERVER_CLOSE_CONNECTION:'SERVER_CLOSE_CONNECTION',CLOSE_CONNECTION:'CLOSE_CONNECTION',UNSUPPORTED_PLATFORM:'UNSUPPORTED_PLATFORM',NMH:'NMH',CERTIFICATE_NOT_INSTALLED:'CERTIFICATE_NOT_INSTALLED',OLD_VERSION_UPDATE_DOWNLOADED:'OLD_VERSION_UPDATE_DOWNLOADED',SEND_AFTER_CLOSE_CONNECTION:'SEND_AFTER_CLOSE_CONNECTION',INSTALL_NMH_EXTENSION:'INSTALL_NMH_EXTENSION',AUTHENTICATION_FAILED:'AUTHENTICATION_FAILED',PROVIDER_UNSUPPORTED:'PROVIDER_UNSUPPORTED',REQUEST_NOT_RECOGNIZED:'REQUEST_NOT_RECOGNIZED',NO_RIGHTS_FOR_EXECUTE:'NO_RIGHTS_FOR_EXECUTE'},O.errorPriorities={NMH:1,OLD_FLASH_PLAYER:2,CERTIFICATE_NOT_INSTALLED:3,CLOSE_CONNECTION:4,UNABLE_TO_CONNECT:5},O.detailStrings={OLD_FLASH_PLAYER:rk('Требуется Flash Player')+' >= 19.0.0',UNABLE_TO_CONNECT:rk('Не удалось подключиться к СБИС Плагин. Проверьте, что он включен и ничего не блокирует его работу.'),OPEN:rk('WebSocket - соединение устанавливается'),CLOSE:rk('WebSocket - соединение закрыто'),IS_MOBILE:rk('Вы используете мобильную версию браузера'),COMMUNICATION_ERROR:rk('Произошла ошибка при взаимодействии со СБИС Плагин'),UNKNOWN_ERROR:rk('Неизвестная ошибка'),UNKNOWN_SERVER_ERROR:rk('На сервере произошла неизвестная ошибка.'),UNKNOWN_RECEIVER:rk('Неизвестный получатель ответа'),NO_RESPONSE_DURING:rk('Не удалось получить ответ за разумное время'),PLUGIN_NOT_INIT:rk('Запрашиваемое расширение не может быть инициализировано'),BAD_ENDPOINT_REQUEST:rk('Указан неправильный формат адреса расширения СБИС Плагин (необходимо "pluginName-pluginVersion")'),SERVER_CLOSE_CONNECTION:rk('СБИС Плагин закрыл соединение'),CLOSE_CONNECTION:rk('Подключение к СБИС Плагин закрылось. Проверьте, что он включен и ничего не блокирует его работу.'),UNSUPPORTED_PLATFORM:rk('Операционная система не поддерживается'),NMH:rk('Не удалось подключиться к СБИС Плагин. Не удалось инициализировать соединение через расширение SbisPlugin Extension. Разрешите его использование в настройках браузера'),CERTIFICATE_NOT_INSTALLED:rk('Не удалось подключиться к СБИС Плагин. Проверьте, что он включен и ничего не блокирует его работу.'),OLD_VERSION_UPDATE_DOWNLOADED:rk('Необходимо установить скачанное обновление СБИС Плагин'),SEND_AFTER_CLOSE_CONNECTION:rk('Отправка команды после destroy. Необходимо создать сервис'),INSTALL_NMH_EXTENSION:rk('Рекомендуем установить расширение для работы со СБИС Плагин'),AUTHENTICATION_FAILED:rk('Не удалось провести процедуру аутентификации'),PROVIDER_UNSUPPORTED:rk('Данный протокол не поддерживается СБИС Плагин'),REQUEST_NOT_RECOGNIZED:rk('Запрос не распознан'),NO_RIGHTS_FOR_EXECUTE:rk('Недостаточно прав для вызова метода СБИС Плагин')},O.getTopPriorityError=function(E){return E=E||[],E.sort(function(E,N){return O.errorPriorities[E.errorType]-O.errorPriorities[N.errorType];}),E[0];},O.createFromNativeError=function(E){if(!(E instanceof N)){var R=E.message,_=E.error_code;return new O(O.detailTypes.COMMUNICATION_ERROR,_||O.detailTypes.COMMUNICATION_ERROR,R||O.detailTypes.UNKNOWN_SERVER_ERROR);}else return E;},E.classicExtend(O,N),O;});
define('js!SBIS3.Plugin/Source/Helper/SPConstants',['i18n!SBIS3.Plugin/Source/Helper/SPConstants','SBIS3.Plugin_localization'],function(){'use strict';return{readyState:{UNKNOWN:-1,CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},readyStateText:{'-1':'UNKNOWN',0:'CONNECTING',1:'OPEN',2:'CLOSING',3:'CLOSED'},connectionMode:{ONE_CONNECTION_SERIAL:1,ONE_CONNECTION_BREAK:2},protocolName:{OLD_PROTOCOL:'js!SBIS3.Plugin/Source/Protocol/SbisPlugin',NEW_PROTOCOL:'js!SBIS3.Plugin/Source/Protocol/Sbis3Plugin'},shortProtocolName:{'js!SBIS3.Plugin/Source/Protocol/SbisPlugin':'SbisPlugin','js!SBIS3.Plugin/Source/Protocol/Sbis3Plugin':'Sbis3Plugin'},showModes:{ALWAYS:'always',RUN_ONCE:'runOnce',SILENT:'silent'},transportName:{EXTERNAL:'js!SBIS3.Plugin/Source/Transport/resources/WebSocketExternal',WEBSOCKET:'js!SBIS3.Plugin/Source/Transport/resources/WebSocketNative',NMH:'js!SBIS3.Plugin/Source/Transport/resources/NmhWebSocket',FLASH:'js!SBIS3.Plugin/Source/Transport/resources/WebSocket'},eventBusChannel:{SbisPluginEvent:'SbisPluginEvent',SpecialErrors:'SbisPluginSpecialErrorChannel',ConnectionManager:'SbisPluginCMChannel',ServiceManager:'SbisPluginSMChannel',Ping:'SbisPluginPingChannel'},maxDuplicateServiceCount:100,defaultQueryTimeout:60000};});
define('js!SBIS3.Plugin/Source/Helper/EnvMixin/SystemInfoMixin',['SBIS3.Plugin_localization'],function(){return{browserType:function(){var e={isChrome:false,isIE:false,isFirefox:false,isOpera:false,isYandex:false,isAmigo:false,isEdge:false,isSbis:false};if('undefined'!==typeof navigator){var i=navigator.userAgent;if(/chrome/i.test(i)&&!/opr/i.test(i)&&!/yabrowser/i.test(i)&&!/amigo/i.test(i)&&!/edge/i.test(i)&&!/sbis/i.test(i))e.isChrome=true;else if(/msie/i.test(i)|/trident/i.test(i)&&!/opera/i.test(i))e.isIE=true;else if(/firefox/i.test(i))e.isFirefox=true;else if(/opera|opr/i.test(i))e.isOpera=true;else if(/yabrowser/i.test(i))e.isYandex=true;else if(/amigo/i.test(i))e.isAmigo=true;else if(/edge/i.test(i))e.isEdge=true;else if(/sbis/i.test(i))e.isSbis=true;}return e;}(),osType:function(){var e={isWindow:false,isLinux:false,isMac:false};if('undefined'!==typeof navigator){var i=navigator.userAgent;if(/\bMac\s+OS\s+X\b/.test(i))e.isMac=true;else if(-1!==i.indexOf('Linux'))e.isLinux=true;else if(/Win/i.test(i))e.isWindow=true;}return e;}()};});
define('js!SBIS3.Plugin/Source/Helper/EnvMixin/PluginMigrateMixin',['js!SBIS3.Plugin/components/SbisPluginLocalStorage','Core/helpers/generate-helpers','Core/helpers/Object/find','browser!js!SBIS3.Plugin/Source/Helper/EnvMixin/SystemInfoMixin','SBIS3.Plugin_localization'],function(i,e,n,r){'use strict';var t=function(){if('undefined'!==typeof navigator){var e=i.getItem('SbisPlugin');if(e)return e=JSON.parse(e),e.hasOwnProperty('wsPort')&&e.hasOwnProperty('wssPort');}return false;}(),s=function(){var i=t?'Sbis3Plugin/':'SbisPlugin/';function s(){var e=['wi.sbis.ru','platform-','dev-','test-','localhost','fix-','dev.','test.','fix.','rc-','rc.'];if('undefined'!==typeof location&&!r.browserType.isSbis){var t=location.host,s=n(e,function(i){return-1!==t.indexOf(i);});if(!s)s=/:\d+$/.test(t);if(s)return'http://test-update.sbis.ru/'+i;}return'http://update.sbis.ru/'+i+'master/';}function u(){var i=e.randomId('?');if(navigator){if(-1!==navigator.appVersion.indexOf('Linux'))return'linux/sbis3plugin-setup.sh'+i;if(-1!==navigator.appVersion.indexOf('Mac'))return'darwin/sbis3plugin-setup.pkg'+i;if(-1!==navigator.appVersion.indexOf('Win')&&t)return'win32/sbis3plugin-setup.exe'+i+'&FixForIE=.exe';}return'SbisPlugin.exe'+i+'&FixForIE=.exe';}return s()+u();}();return{isUseNewPlugin:t,sbisPluginPath:s};});
define('js!SBIS3.Plugin/Source/Helper/Environment',['Core/core-extend','Core/Deferred','Core/constants','Core/moduleStubs','js!SBIS3.Plugin/components/SbisPluginLocalStorage','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Helper/EnvMixin/PluginMigrateMixin','browser!js!SBIS3.Plugin/Source/Helper/EnvMixin/SystemInfoMixin','SBIS3.Plugin_localization'],function(e,o,r,i,t,n,s,l,a){'use strict';var u=function(){if(this._availableProtocols=[],this._defaultProtocol='',this.isUseNewPlugin)this._availableProtocols.push(s.protocolName.NEW_PROTOCOL),this._defaultProtocol=s.protocolName.NEW_PROTOCOL;else if(this.osType.isWindow)this._availableProtocols.push(s.protocolName.OLD_PROTOCOL),this._defaultProtocol=s.protocolName.OLD_PROTOCOL,this._availableProtocols.push(s.protocolName.NEW_PROTOCOL);};u.prototype.getAvailableProtocols=function(){return this._availableProtocols;},u.prototype.isProtocolAvailable=function(e){return this._availableProtocols.indexOf(e)>-1;},u.prototype.getDefaultProtocol=function(){return this._defaultProtocol;},u.prototype.setDefaultProtocol=function(e){this._defaultProtocol=e;},u.prototype.validateEnvironment=function(){if(this._isMobilePlatform())return new n(n.errorsType.INTERNAL_CLIENT_ERROR,n.detailTypes.IS_MOBILE);else if(!this._isOSAvailable())return new n(n.errorsType.INTERNAL_CLIENT_ERROR,n.detailTypes.UNSUPPORTED_PLATFORM);return null;},u.prototype.getConnectionMode=function(){return s.connectionMode.ONE_CONNECTION_BREAK;},u.prototype.isOnline=function(){if(location.hostname.match(/^([\S]+\.)*(sbis\.ru|tensor\.ru)$/gi))return o.success(true);if(window.hasOwnProperty('page'))return o.success(false);if(u.browserType.isSbis)return o.success(false);return i.require(['js!WS.Data/Source/SbisService']).addCallback(function(e){return new e({endpoint:'Retail'}).call('Online',{}).addCallback(function(e){return e.getScalar();});});},u.prototype._isMobilePlatform=function(){var e=t.getItem('SbisPlugin');if(e)if(e=JSON.parse(e),e.hasOwnProperty('isMobileCheck')&&!e.isMobileCheck)return false;return r.browser.isMobileIOS||r.browser.isMobileAndroid||r.browser.isWPMobilePlatform||r.browser.isMobileSafari;},u.prototype._isOSAvailable=function(){var e=t.getItem('SbisPlugin');if(e)if(e=JSON.parse(e),e.hasOwnProperty('isOSCheck')&&!e.isOSCheck)return true;if(navigator&&-1===navigator.appVersion.indexOf('Win')&&-1===navigator.appVersion.indexOf('Mac')&&-1===navigator.appVersion.indexOf('Linux'))return false;if((a.osType.isMac||a.osType.isLinux)&&!l.isUseNewPlugin)return false;return true;};var c=e.mixin(u,[l,a]);return c.prototype.isUseNewPlugin=l.isUseNewPlugin,c.prototype.sbisPluginPath=l.sbisPluginPath,c.prototype.browserType=a.browserType,c.prototype.osType=a.osType,new c();});
define('js!SBIS3.Plugin/Source/Diagnostic',['Core/core-merge','Core/IoC','Core/core-instance','js!SBIS3.Plugin/components/SbisPluginLocalStorage','Core/moduleStubs','Core/Date','SBIS3.Plugin_localization'],function(e,t,o,n,i){'use strict';var r=function(){return this||(0,eval)('this');}();r.SPDebug=function(){if(n)if(arguments.length){var e=!!arguments[0];if(n.setItem('SbisPluginServiceDebug',e),c)c._isDebugEnabled=e;}else return n.getItem('SbisPluginServiceDebug');},r.SPDiagnostic=function(){if(c)return c.getDiagnosticInfo();},r.SPRegularStack=function(){if(c)return c.getRegularStack();};var c,a=function(){this._isDebugEnabled=SPDebug(),this.isDebugLogEnabled=false,this._connectionInfo={},this._connectionAttempts=0,this._connectionReadyState=-1,this._diagnosticInfo={LocalService:{total:0,services:{}},ServiceManager:{services:{}},Connection:{}},this._regularStack=[];var e=n.getItem('SbisPlugin');if(e)e=JSON.parse(e),this.isDebugLogEnabled=e.isDebugLogEnabled||this.isDebugLogEnabled;};return a.prototype.info=function(e,o,n){var i=new Date(),c='['+i.strftime('%H:%M:%S:%J')+']'+' | INFO  | '+e+' (Method: '+o+')';if(this._regularStack.length>=100)this._regularStack.splice(0,1);if(this._regularStack.push({date:i,message:c+': '+n}),t.resolve('ILogger').info(c,n),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.info(c,n);},a.prototype.debug=function(e,o,n){if(this._isDebugEnabled){var i='['+new Date().strftime('%H:%M:%S:%J')+']'+' | DEBUG | '+e+' (Method: '+o+')';if(t.resolve('ILogger').log(i,n),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.log(i,n);}},a.prototype.error=function(e,n,i){var c=new Date(),a='['+c.strftime('%H:%M:%S:%J')+']'+' | ERROR | '+e+' (Method: '+n+')';if(this._regularStack.length>=100)this._regularStack.splice(0,1);if(i instanceof Error){if(o.instanceOfModule(i,'SBIS3.Plugin/Source/Error/SbisPluginError')){if(t.resolve('ILogger').log(a,i.message),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.log(a,i.message);}else if(t.resolve('ILogger').error(a,i.message,i),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.error(a,i.message,i);this._regularStack.push({date:c,message:a+': '+i.message});}else if(this._regularStack.push({date:c,message:a+': '+i}),t.resolve('ILogger').log(a,i),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.log(a,i);},a.prototype.changeReadyState=function(e){this._connectionReadyState=e;},a.prototype.changeLocalServiceInfo=function(e){this._diagnosticInfo.LocalService.total++,this._diagnosticInfo.LocalService.services[e]?this._diagnosticInfo.LocalService.services[e]++:this._diagnosticInfo.LocalService.services[e]=1;},a.prototype.changeConnectionInfo=function(t){if(t)e(this._connectionInfo,t);},a.prototype.addConnectionAttempt=function(){this._connectionAttempts++;},a.prototype.getDiagnosticInfo=function(){var e=this;return i.require(['js!SBIS3.Plugin/Source/ServiceManager/ServiceManager']).addCallback(function(t){var o=t[0];e._diagnosticInfo.ServiceManager.services=o.getDiagnosticInfo();}),e._diagnosticInfo.Connection=e._connectionInfo,e._diagnosticInfo.Connection.readyState=e._connectionReadyState,e._diagnosticInfo.Connection.attempts=e._connectionAttempts,e._diagnosticInfo;},a.prototype.getReadyState=function(){return this._connectionReadyState;},a.prototype.isSbisPluginRunning=function(){return n.getItem('isPluginRunning')||false;},a.prototype.setRunningFlag=function(e){n.setItem('isPluginRunning',e);},a.prototype.getTransportName=function(){return this._connectionInfo.transport||null;},a.prototype.getRegularStack=function(){return this._regularStack.sort(function(e,t){return+e.date-+t.date;}),this._regularStack.map(function(e){return e.message;}).join('\n');},c=new a(),c;});
define('js!SBIS3.Plugin/Source/Error/ParamsValidationError',['Core/core-extend','js!SBIS3.Plugin/Source/Error/SbisPluginError','SBIS3.Plugin_localization'],function(N,_){'use strict';function O(N,_){_=_||O.detailStrings[N],this.type=O.errorsType.INTERNAL_CLIENT_ERROR,this.description=N,this.errorType=N,this.constructor.superclass.constructor.call(this,_);}return O.errorsType={INTERNAL_CLIENT_ERROR:'INTERNAL_CLIENT_ERROR'},O.detailTypes={UNKNOWN_FUNCTION:'UNKNOWN_FUNCTION',UNKNOWN_FUNCTION_RESULT:'UNKNOWN_FUNCTION_RESULT',UNKNOWN_FUNCTION_PARAMS:'UNKNOWN_FUNCTION_PARAMS',UNKNOWN_OBJECT_ID:'UNKNOWN_OBJECT_ID',UNKNOWN_RESPONSE_TYPE:'UNKNOWN_RESPONSE_TYPE',WRONG_ARGUMENTS_NUMBER:'WRONG_ARGUMENTS_NUMBER',WRONG_ARGUMENT_TYPE:'WRONG_ARGUMENT_TYPE',FUNCTION_NOT_FOUND:'FUNCTION_NOT_FOUND',AMBIGUOUS_MATCH_EXCEPTION:'AMBIGUOUS_MATCH_EXCEPTION'},O.detailStrings={UNKNOWN_FUNCTION:rk('Неизвестное название функции'),UNKNOWN_FUNCTION_RESULT:rk('Неизвестный результат функции'),UNKNOWN_FUNCTION_PARAMS:rk('Неизвестные параметры функции'),UNKNOWN_OBJECT_ID:rk('Неизвестный идентификатор объекта'),UNKNOWN_RESPONSE_TYPE:rk('Неизвестный тип ответа'),WRONG_ARGUMENTS_NUMBER:rk('Неверное количество аргументов'),WRONG_ARGUMENT_TYPE:rk('Неверный тип аргумента'),FUNCTION_NOT_FOUND:rk('Не найдена функция соотвествующая параметрам'),AMBIGUOUS_MATCH_EXCEPTION:rk('Двусмысленное представляение метода')},N.classicExtend(O,_),O;});
define('js!SBIS3.Plugin/Source/Helper/SPCustomEvent',['SBIS3.Plugin_localization'],function(){'use strict';return{create:function(e,t){if(document.createEvent&&window.CustomEvent&&!window.opera){var n=document.createEvent('CustomEvent');if(n.initCustomEvent)n.initCustomEvent(e,false,false,t);else n=new CustomEvent(e,{bubbles:false,cancelable:false,detail:t});return n;}else return{type:e,bubbles:false,cancelable:false,detail:t};}};});
define('js!SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin',['Core/EventBus','browser!js!SBIS3.Plugin/Source/Error/ParamsValidationError','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPCustomEvent','SBIS3.Plugin_localization'],function(e,n,t,i){'use strict';return{_inspectEvents:function(r){if('call'===r.type||'event'===r.type){var a=r.answer||r.data;if(void 0===a)return;if(a.channelName){var s=a.channelName,o=a.eventName,u=a.data||[],c=e.channel('SbisPluginChannel');if('string'!==typeof s||'string'!==typeof o||s.length<=0||o.length<=0)return void t.error('SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin','_inspectEvents',new n(n.detailTypes.UNKNOWN_FUNCTION));if(t.debug('SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin','_inspectEvents','Вызов канала '+s+' с событием '+o),'SbisPluginChannel'===s&&c.hasEventHandlers(o))c.notify.apply(c,[o].concat(u));if(e.channel(s).notify.apply(e.channel(s),[o].concat(u)),t.isDebugLogEnabled)window.dispatchEvent(i.create('onSbisPluginLogEvent',{type:'event',datetime:new Date().toISOString(),channelName:s,eventName:o,data:u}));}return true;}return false;}};});
define('js!SBIS3.Plugin/Source/ServiceManager/Service',['browser!js!SBIS3.Plugin/Source/Helper/Environment','SBIS3.Plugin_localization'],function(t){'use strict';var o=function(t,o){var i=o.endpoint,n=i.address.split('-');this.guid=t,this._protocol=null,this.plugin=null,this.endpoint=i,this.name=n[0],this.version=n[1],this.options=o.options||{},this.customTimeout=o.options.queryTimeout,this.parentID=null,this.methodCount={},this.wasProtocolChanged=false,this.options.debug=this.options.debug||null;};return o.prototype.getProtocol=function(){var o=this._protocol;if(!o)o=t.getDefaultProtocol(),this.setProtocol(o);return o;},o.prototype.setProtocol=function(t){this._protocol=t;},o.prototype.setPlugin=function(t){return this.plugin=t;},o.prototype.isEndpointCorrect=function(){if(!this.endpoint||!this.endpoint.address)return false;var t=this.endpoint.address;if(!t)t='';if('string'!==typeof t)t=t.toString();var o=t.split('-');if(o.length>1)o={name:o[0],version:o[1]};return o.name&&o.version;},o;});
define('js!SBIS3.Plugin/Source/Error/SpecialTypeError',['Core/core-extend','js!SBIS3.Plugin/Source/Error/SbisPluginError','SBIS3.Plugin_localization'],function(r,E){function e(r,E,e){this.type=r,this.queryId=e,this.constructor.superclass.constructor.call(this,E);}return e.errorsType={PROVIDER_UNSUPPORTED:'PROVIDER_UNSUPPORTED',POOL_NOT_AVAILABLE:'POOL_NOT_AVAILABLE',TOKEN_NOT_VALID:'TOKEN_NOT_VALID',LOW_ACCESS_LEVEL:'LOW_ACCESS_LEVEL'},r.classicExtend(e,E),e;});
define("tmpl!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/ProgressBar"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],a={};a["js!SBIS3.CONTROLS/ProgressBar"]=e[1];var t=function e(t,o,l,i,s){function n(){}var c=0,u=void 0!==r&&r?r:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var g="string"==typeof l?l:"",p=void 0===a?void 0:a,P={id:[],def:void 0},v=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,t),m=this&&this.includedTemplates?this.includedTemplates:{},L=u.getMarkupGenerator(i);try{var S=L.joinElements([L.createTag("div",{class:"LocalService-PluginLoadPopup"},[L.createTag("div",{class:"LocalService-PluginLoadPopup__content"},[L.createTag("div",{class:"LocalService-PluginLoadPopup__info"},[L.createTag("label",{"data-lmchild":"label",class:"ws-Label"},[L.createTag("span",{"data-lmchild":"label-title",class:"ws-Label-title",name:"Label"},[],{},P,this)],{},P,this)],{},P,this),L.createTag("div",{class:"progress-content"},[L.createControl("wsControl","ws:SBIS3.CONTROLS/ProgressBar",{name:"pluginLoadProgress",visible:"true"},{class:"controls-ProgressBar_align-right",name:"pluginLoadProgress",sbisname:"pluginLoadProgress"},{data:t,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},l,p,m,u.config,d)],{},P,this)],{},P,this)],o,P,this)],g,P);P.def&&(S=L.chain(S,P,o),P=void 0)}catch(e){u.templateError("resources/SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad.tmpl",e,t)}return S||""};return t.includedFunctions={},t.stable=!0,t.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad"}},t});
if(typeof window !== "undefined" && window.atob){define("css!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad", function() {var style = document.createElement("style"),head = document.head || document.getElementsByTagName("head")[0];style.type = "text/css";style.appendChild(document.createTextNode(".controls-NotificationPopup__header_icon.LocalService-PluginLoadPopup__header_icon-processIcon{background:url(/resources/SBIS3.Plugin/components/Dialogs/PluginLoad/resources/load.v1516270649826335cf4508dd597be4bfc9caa3e08b901.gif);background-size:cover}.LocalService-PluginLoadPopup{margin:0}.LocalService-PluginLoadPopup .LocalService-PluginLoadPopup__content{display:inline-block;float:left;margin:8px;margin-top:0;width:330px}.LocalService-PluginLoadPopup .LocalService-PluginLoadPopup__content .LocalService-PluginLoadPopup__info{height:16px;padding-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-right:10px;margin-left:4px}.LocalService-PluginLoadPopup .LocalService-PluginLoadPopup__content .controls-ProgressBar_align-right .controls-ProgressBar__line{margin-right:50px}.LocalService-PluginLoadPopup .LocalService-PluginLoadPopup__content .controls-ProgressBar__line{margin-left:3px}.LocalService-PluginLoadPopup .LocalService-PluginLoadPopup__content .controls-ProgressBar__line .controls-ProgressBar__value{right:-35px;font-size:11px}"));head.appendChild(style);});}
define('js!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad',['Core/Deferred','Core/moduleStubs','tmpl!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad','css!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad','SBIS3.CONTROLS/ProgressBar','i18n!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad','SBIS3.Plugin_localization'],function(o,n,e){var i,r,s,t,a,u,l;function d(){return n.require(['browser!SBIS3.CONTROLS/Utils/NotificationStackManager','browser!SBIS3.CONTROLS/NotificationPopup']).addCallback(function(n){var u=n[0],l=n[1],d=new o();if(r)return d.callback(),d;return r=true,i=new l({element:$('<div></div>'),caption:rk('Загрузка расширений СБИС Плагин'),icon:'icon-24 LocalService-PluginLoadPopup__header_icon-processIcon',bodyTemplate:e,closeButton:true}),t=i.getChildControlByName('pluginLoadProgress'),a=i.getContainer().find('[name=Label]'),i.subscribeTo(i,'onClose',function(){s=true;}),u.showNotification(i,true),d;});}function c(o,n){if(!(o in u)){if(s)b();u[o]={progress:0,total:n||1},l++;}}function f(o,n){if(u[o].finished)u[o].progress=1,u[o].total=1;else u[o].progress=n>u[o].progress?n:u[o].progress;if(!t)return;var e=0,i=0;for(var r in u){if(!u.hasOwnProperty(r))continue;e+=u[r].progress,i+=u[r].total;}if(i>0)e=100*e/ i;else e=0;P(o,e);}function g(o){u[o].finished=true,f(o);}function P(o,n){var e=0;for(var r in u){if(!u.hasOwnProperty(r))continue;if(u[r].finished)e++;}if(a.text(l>1?rk('Загружено')+': '+e+'/'+l:o),t.setProgress(n),e===l)i.close(),b();}function b(){if(i=null,r=false,s=false,t)t.setProgress(0);if(t=null,a)a.text('');a=null,u={},l=0;}return b(),{subscribeOnProgress:function(o){if(!o)return;o.subscribe('downloadProgress',this._downloadProgress),o.subscribe('downloadFinished',this._downloadFinished),o.subscribe('onClose',function(o){if(!i)return;i.close(),b();});},unsubscribeOnProgress:function(o){if(!o)return;o.unsubscribe('downloadProgress',this._downloadProgress),o.unsubscribe('downloadFinished',this._downloadFinished);},_downloadProgress:function(o,n){var e=n.Name,i=n.BytesReceived,r=n.TotalBytesToReceive;if(r>0)c(e,r),d().addCallback(function(){f(e,i);});},_downloadFinished:function(o,n){var e=n.Name;c(e),g(e);}};});
define('js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionsConfig',['browser!js!SBIS3.Plugin/Source/Helper/SPConstants','SBIS3.Plugin_localization'],function(o){'use strict';var r=function(){this._configs=[];};r.prototype.getTopPriorityProtocol=function(o){return o=this._compareProtocols(o),o[0];},r.prototype.addConfig=function(o){this._configs.push(o);},r.prototype.getConfigs=function(o){if(o)return this._configs.filter(function(r){return o.indexOf(r.protocol)>-1;});else return this._configs;},r.prototype.getConfigByProtocol=function(o){for(var r=0;r<this._configs.length;r++)if(this._configs[r].protocol===o)return this._configs[r];},r.prototype._sortConfigsByPriority=function(){var o=this._configs;o.sort(function(o,r){return o.priority-r.priority;}),o.forEach(function(o){o.availableTransports.sort(function(o,r){return o.priority-r.priority;});}),this._configs=o;},r.prototype._compareProtocols=function(o){var r=this;return o.sort(function(o,t){var i=r.getConfigByProtocol(o),n=r.getConfigByProtocol(t);return i.priority-n.priority;});};var t=new r();return t.addConfig({protocol:o.protocolName.NEW_PROTOCOL,host:'127.0.0.1',wsPort:8201,wssPort:9208,priority:2,availableTransports:[{name:o.transportName.WEBSOCKET,priority:1},{name:o.transportName.NMH,priority:2},{name:o.transportName.FLASH,priority:3}]}),t.addConfig({protocol:o.protocolName.OLD_PROTOCOL,host:'127.0.0.1',wsPort:8181,wssPort:8484,priority:1,availableTransports:[{name:o.transportName.WEBSOCKET,priority:1},{name:o.transportName.NMH,priority:2},{name:o.transportName.FLASH,priority:3}]}),t._sortConfigsByPriority(),t;});
define('js!SBIS3.Plugin/Source/Transport/Connector',['js!WS.Data/Di','Core/Abstract','Core/Deferred','js!WS.Data/Entity/OptionsMixin','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization'],function(e,o,n,t,r,c){'use strict';var i=function(){return this||(0,eval)('this');}(),s='127.0.0.1',a='SBIS3.Plugin/Source/Transport/Connector',_=o.extend({_moduleName:a,_$debug:false,_$mode:null,_$port:null,_$transport:null,_$host:null,_webSocket:null,_connectorReadyDef:null,constructor:function(e){_.superclass.constructor.call(this,e),c.addConnectionAttempt(),this._connectorReadyDef=new n(),this._createConnection(),this._publish('onopen','onmessage','onerror','onclose');},send:function(e){var o=this;this._connectorReadyDef.addCallback(function(){if(o._webSocket)o._webSocket.send(e);else o.onerror(new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.CLOSE_CONNECTION));}).addErrback(function(e){o.onerror(e);});},setConfig:function(e){e.port=e.port||e[e.mode],t.constructor.call(this,e);},getConfig:function(){return t._getOptions.call(this);},getState:function(){if(this._webSocket)return this._webSocket.readyState;else return-1;},close:function(){if(this._webSocket)c.info(a,'close','Закрываем соединение, sessionId: '+this._webSocket.getId()+' порт '+this._$port),this._webSocket.close();},onopen:function(){},onmessage:function(){},onerror:function(){},onclose:function(){},_createConnection:function(){var e=this,o={},n=this._$mode,t=this._$port,i=this._$host,s=this._$transport;try{if(c.info(a,'_createConnection','Создаем соединение (режим: '+n+' порт '+t+')'),o=new s(n+'://'+i+':'+t),o.isBlocked)return void setTimeout(function(){c.error(a,'_createConnection','Невозможно установить соединение, (режим: '+n+' порт '+t+')');var o=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.UNABLE_TO_CONNECT);if(!e._connectorReadyDef.isReady())e._connectorReadyDef.errback(o);e.onerror(o);},0);c.info(a,'_createConnection','Устанавливаем таймаут подключения, (режим: '+n+' порт '+t+')');var _=setTimeout(function(){c.info(a,'_createConnection','Не удалось подключиться за отведенное время. Ручное закрытие соединения, (режим: '+n+' порт '+t+')'),o.onclose();},20000);o.onopen=function(){if(clearTimeout(_),c.info(a,'_createConnection','Соединение установлено, sessionId: '+o.getId()+' порт '+t),e._webSocket=o,!e._connectorReadyDef.isReady())e._connectorReadyDef.callback();e.onopen();},o.onmessage=function(o){e.onmessage(o.data);},o.onerror=function(n){var t=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.CLOSE_CONNECTION);if(c.info(a,'_createConnection','onerror::sessionId: '+o.getId()+', error: '+t.message),!e._connectorReadyDef.isReady())e._connectorReadyDef.errback(t);e.onerror(t);},o.onclose=function(){var n=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.UNABLE_TO_CONNECT);if(clearTimeout(_),c.info(a,'_createConnection','Соединение закрыто, sessionId: '+o.getId()+', порт '+t),e._webSocket)e._webSocket.close();if(!e._connectorReadyDef.isReady())e._connectorReadyDef.errback(n);e.onclose(n);};}catch(o){c.error(a,'_createConnection','Невозможно установить соединение, порт '+t);var f=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.UNABLE_TO_CONNECT);if(!e._connectorReadyDef.isReady())e._connectorReadyDef.errback(f);e.onerror(f);}}});return e.register(a,_,{single:true}),_;});
define('js!SBIS3.Plugin/Source/Transport/Initializer',['Core/moduleStubs','Core/Deferred','Core/ParallelDeferred','js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Transport/Connector','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Helper/Environment','SBIS3.Plugin_localization'],function(r,e,n,o,t,a,i,s){'use strict';var c=19,u='ws',l='wss',f=location.protocol.match('https')?l:u,p=new o(o.errorsType.INTERNAL_CLIENT_ERROR,o.detailTypes.CERTIFICATE_NOT_INSTALLED),d='SBIS3.Plugin/Source/Transport/TransportSelecting/InitializerNew',b={};b[i.transportName.WEBSOCKET]={canExec:function(){return'undefined'!=typeof WebSocket;},verify:function(n,o,s,c){var l=new e();return r.require([i.transportName.WEBSOCKET]).addCallback(function(r){var e=r[0],f=n===u?s:c;a.changeConnectionInfo({transport:i.transportName.WEBSOCKET,mode:n,port:f});var p=new t({mode:n,host:o,port:f,transport:e});p.onopen=function(){!l.isReady()&&l.callback(p);},p.onerror=function(r){!l.isReady()&&l.errback(r);},p.onclose=function(r){!l.isReady()&&l.errback(r);};}).addErrback(function(){l.errback(p);}),l;}},b[i.transportName.FLASH]={canExec:function(){var r=navigator.userAgent,e,n;if(s.browserType.isChrome)e=55,n=/Chrome[\/\s](\d+\.\d+)/;else if(s.browserType.isFirefox)e=55,n=/Firefox[\/\s](\d+\.\d+)/;if(e){var o=r.match(n);return(o&&o[1])<e;}else return true;},verify:function(n,l,f,d){return r.require(['browser!js!SBIS3.Plugin/Source/Transport/resources/SwfObject']).addCallback(function(n){var d=n[0],b=new e();if(0===d().getFlashPlayerVersion().major)b.errback(p);else if(d().getFlashPlayerVersion().major<c)if(s.browserType.isEdge||s.browserType.isOpera||s.browserType.isYandex)b.errback(new o(o.errorsType.INTERNAL_CLIENT_ERROR,o.detailTypes.OLD_FLASH_PLAYER));else b.errback(p);else r.require([i.transportName.FLASH]).addCallback(function(r){var e=r[0];a.changeConnectionInfo({transport:i.transportName.FLASH,mode:u,port:f}),function(){return this||(0,eval)('this');}().SbisPluginTransport=e,e.initialize(function(r){if(r.success){var n=new t({mode:u,host:l,port:f,transport:e});n.onopen=function(){!b.isReady()&&b.callback(n);},n.onerror=function(r){!b.isReady()&&b.errback(r);},n.onclose=function(r){!b.isReady()&&b.errback(r);};}else b.errback(p);});}).addErrback(function(){b.errback(p);});return b;});}},b[i.transportName.NMH]={canExec:function(){return s.browserType.isChrome||s.browserType.isAmigo||s.browserType.isFirefox;},verify:function(n,s,c,l){return r.require([i.transportName.NMH]).addCallback(function(r){var n=r[0],l=new e();return a.changeConnectionInfo({transport:i.transportName.NMH,mode:u,port:c}),n.initialize(function(r){if(r.success){var e=new t({mode:u,host:s,port:c,transport:n});e.onopen=function(){!l.isReady()&&l.callback(e);},e.onerror=function(r){!l.isReady()&&l.errback(r);},e.onclose=function(r){!l.isReady()&&l.errback(r);};}else l.errback(new o(o.errorsType.INTERNAL_CLIENT_ERROR,o.detailTypes.NMH));}),l;});}};var S=function(){};return S.initializeConnection=function(r){var t=r.host,s=r.wsPort,c=r.wssPort,u=r.protocol,l=r.availableTransports,p=new n({maxRunningCount:1,stopOnFirstError:false}),S=new e();return l=l.filter(function(r){var e=r.name,n=b.hasOwnProperty(e)&&b[e].canExec();if(n)a.info(d,'initializeConnection','Транспорт '+e+' доступен для подключения по протоколу '+i.shortProtocolName[u]);return n;}),l.forEach(function(r){p.push(function(){var n=r.name;if(!S.isReady())return a.info(d,'initializeConnection','Попытка поключения через '+n+' по протоколу '+i.shortProtocolName[u]),b[n].verify(f,t,s,c).addCallback(function(r){a.info(d,'initializeConnection','Выбран транспорт '+n+' для подключения по протоколу '+i.shortProtocolName[u]),a.changeConnectionInfo({transport:n,mode:r._$mode,port:r._$port}),S.callback(r);});else return e.success();});}),p.done().getResult().addCallback(function(r){if(!S.isReady()){a.error(d,'initializeConnection','Не удалось подключиться ни по одному транспорту по протоколу '+i.shortProtocolName[u]);var e=[];for(var n in r)if(r.hasOwnProperty(n)){var t=r[n];if(t instanceof Error&&!(t instanceof o))throw t;e[n]=t;}S.errback(o.getTopPriorityError(e));}}),S;},S;});
define('js!SBIS3.Plugin/Source/Transport/ConnectionManager/Connection',['Core/Deferred','Core/core-clone','browser!js!SBIS3.Plugin/Source/Transport/Initializer','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Transport/Connector','SBIS3.Plugin_localization'],function(e,n,o,r,t,i,c){'use strict';var a='SBIS3.Plugin/Source/Transport/ConnectionManager/Connection',s=function(e){this._readyDef=null,this._connector=null,this._initialize(n(e));};return s.prototype.isReady=function(){return this._readyDef.createDependent();},s.prototype.send=function(e){var n=this;return n.isReady().addCallback(function(){return n._connector.send(e);});},s.prototype.close=function(){var e=this;return e.isReady().addCallback(function(){return e._connector.close();});},s.prototype.onopen=function(){},s.prototype.onmessage=function(){},s.prototype.onerror=function(){},s.prototype.onclose=function(){},s.prototype._onOpen=function(){this.onopen();},s.prototype._onMessage=function(e){this.onmessage(e);},s.prototype._onError=function(e){this.onerror(e);},s.prototype._onClose=function(e){this.onclose(e);},s.prototype._initialize=function(n){var c=this;if(!c._readyDef)r.debug(a,'_initialize','Инициализация соединения по протоколу '+t.shortProtocolName[n.protocol]),c._readyDef=o.initializeConnection(n).addCallback(function(s){var l=new e(),u=c._killTimerRun(s,l),p=function(e){return t.shortProtocolName[n.protocol]+' (режим: '+e._$mode+' порт: '+e._$port+')';},f=function(e){if(u){var n;if(e=JSON.parse(e),'call'===e.type||'event'===e.type)if(n=e.answer||e.data,'connected'===n.eventName)y(l);else if('needReconnect'===n.eventName)C(l,n.data);}},d=function(){clearTimeout(u),u=null;var e=new i(i.errorsType.INTERNAL_CLIENT_ERROR,i.detailTypes.CLOSE_CONNECTION);!l.isReady()&&l.errback(e);},_=function(){clearTimeout(u),u=null;var e=new i(i.errorsType.INTERNAL_CLIENT_ERROR,i.detailTypes.UNABLE_TO_CONNECT);!l.isReady()&&l.errback(e);},y=function(e){r.info(a,'_initialize','Перехвачено событие "connected" для соединения по протоколу '+p(s)),e.callback(),c._onOpen();},C=function(e,t){if(r.info(a,'_initialize','Перехвачено событие "needReconnect" для соединения по протоколу '+p(s)),!t.hasOwnProperty('Port'))return void r.info(a,'_initialize','Порт переподключения не указан '+p(s));clearTimeout(u);var i=parseInt(t.Port,10),l=s.getConfig();if(i!==l.port){if(n.wsPort===l.port)n.wsPort=i;else if(n.wssPort===l.port)n.wssPort=i;c._closeConnectorSilently(s),o.initializeConnection(n).addCallback(function(e){(s=e).onmessage=f,s.onerror=d,s.onclose=_;}),u=c._killTimerRun(s,e),r.info(a,'_initialize','Переподключаемся к порту '+i+' для соединения по протоколу '+p(s));}else r.info(a,'_initialize','Остаемся на порту '+i+' для соединения по протоколу '+p(s)),e.callback();};return l.addCallback(function(){clearTimeout(u),u=null,c._connector=s,c._connector.onmessage=c._onMessage.bind(c),c._connector.onerror=c._onError.bind(c),c._connector.onclose=c._onClose.bind(c),r.changeConnectionInfo({mode:s._$mode,port:s._$port});}).addErrback(function(e){return r.info(a,'_initialize','События "connected" и "needReconnect" не были перехвачены для соединения по протоколу '+p(s)),s.close(),e;}),s.onmessage=f,s.onerror=d,s.onclose=_,l;});},s.prototype._closeConnectorSilently=function(e){var n=function(){};e.onmessage=n,e.onerror=n,e.onclose=n,e.close();},s.prototype._killTimerRun=function(e,n){return setTimeout(function(){if(e.getState()===t.readyState.OPEN)n.callback();else if(!n.isReady()){var o=new i(i.errorsType.UNABLE_TO_CONNECT,i.errorsType.UNABLE_TO_CONNECT,'isReady(): события connected и needReconnect не пришли');n.errback(o);}},10000);},s;});
define('js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionManager',['Core/Deferred','Core/ParallelDeferred','Core/EventBus','browser!js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionsConfig','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Helper/Environment','browser!js!SBIS3.Plugin/Source/Transport/ConnectionManager/Connection','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization'],function(n,o,e,t,r,i,a,c,s){'use strict';var u='SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionManager',l=function(){this._connectionManagerChannel=e.channel(c.eventBusChannel.ConnectionManager),this._connections={},this._warmUpDef=this._warmUp();};return l.prototype.isConnectionReady=function(n){var o=this;return this.onWarmUpReady().addBoth(function(){var e=i.getConnectionMode();if(!n&&e===c.connectionMode.ONE_CONNECTION_BREAK||e===c.connectionMode.ONE_CONNECTION_SERIAL)n=i.getDefaultProtocol();return o._getConnection(n);});},l.prototype.onWarmUpReady=function(){if(!this._warmUpDef||this._warmUpDef&&this._warmUpDef.isReady()&&!this._warmUpDef.isSuccessful())this._warmUpDef=this._warmUp();return this._warmUpDef.createDependent();},l.prototype.send=function(n,o){return this.isConnectionReady(o).addCallback(function(o){return s.debug(u,'send','Отправка сообщения: '+n),o.send(n);});},l.prototype._onOpen=function(n){s.info(u,'_onOpen','Открыто соединение по протоколу '+c.shortProtocolName[n]),this._connectionManagerChannel.notify('onopen',n);},l.prototype._onMessage=function(n,o){s.debug(u,'_onMessage','Получено сообщение: '+o),this._connectionManagerChannel.notify('onmessage',o);},l.prototype._onError=function(n,o){this._removeConnection(n),this._connectionManagerChannel.notify('onerror',n,o);},l.prototype._onClose=function(n,o){if(s.info(u,'_onClose','Закрыто соединение по протоколу '+c.shortProtocolName[n]),s.changeReadyState(c.readyState.CLOSED),this._removeConnection(n),this._warmUpDef&&this._warmUpDef.isReady())this._warmUpDef=null;this._connectionManagerChannel.notify('onclose',null,o);},l.prototype._warmUp=function(){var o=this,e=i.getAvailableProtocols(),a=t.getConfigs(e);s.changeReadyState(c.readyState.UNKNOWN);var l=i.validateEnvironment();if(l instanceof Error)return n.fail(l);return s.debug(u,'_warmUp','Запуск прогрева соединений'),this._serialConnection(a).addCallback(function(n){s.changeReadyState(c.readyState.CONNECTING);var e=Object.keys(o._connections),a;if(e.length){a=t.getTopPriorityProtocol(e);for(var l in o._connections){if(!o._connections.hasOwnProperty(l))continue;if(l!==a)o._removeConnection(l);else s.info(u,'_warmUp','Выбрано приоритетное подключение '+c.shortProtocolName[l]),o._setPublicHandlersForConnection(l),s.changeReadyState(c.readyState.OPEN),s.setRunningFlag(true);}i.setDefaultProtocol(a);}else{s.changeReadyState(c.readyState.CLOSED),s.setRunningFlag(false);var f=[],_;for(var h in n){if(!n.hasOwnProperty(h))continue;var p=n[h];if(p instanceof r)f.push(p);}return _=r.getTopPriorityError(f),_||new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.CERTIFICATE_NOT_INSTALLED);}}).addErrback(function(n){return s.error(u,'_warmUp',n),n;});},l.prototype._serialConnection=function(e){var t=this,r=new o({maxRunningCount:1,stopOnFirstError:false}),a=i.getConnectionMode()===c.connectionMode.ONE_CONNECTION_BREAK,l;return s.debug(u,'_serialConnection','Прогрев через последовательное подключение'+a?' с остановкой на первом успешном':''),e.forEach(function(o){r.push(function(){if(a&&l)return n.success();return t._getConnection(o).addCallback(function(n){if(a)l=true;return n;});});}),r.done().getResult();},l.prototype._getConnection=function(o){if(o&&'string'===typeof o)o=t.getConfigByProtocol(o);var e=this,r=o.protocol,i=new n();if(this._hasConnection(r))i.callback(this._connections[r]);else{s.info(u,'_getConnection','Создаем подключение по протоколу '+c.shortProtocolName[r]);var l=new a(o);this._addConnection(r,l),l.isReady().addCallback(function(){i.callback(l);}).addErrback(function(n){s.error(u,'_getConnection','Не удалось создать подключение по протоколу '+c.shortProtocolName[r]),e._removeConnection(r),i.errback(n);});}return i;},l.prototype._addConnection=function(n,o){this._connections[n]=o;},l.prototype._removeConnection=function(n){if(this._connections.hasOwnProperty(n))s.debug(u,'_removeConnection','Удаляем подключение по протоколу '+c.shortProtocolName[n]),this._connections[n].close(),delete this._connections[n];},l.prototype._hasConnection=function(n){return this._connections[n];},l.prototype._setPublicHandlersForConnection=function(n){var o=this._connections[n];if(o)o.onopen=this._onOpen.bind(this,n),o.onmessage=this._onMessage.bind(this,n),o.onerror=this._onError.bind(this,n),o.onclose=this._onClose.bind(this,n);},new l();});
define('js!SBIS3.Plugin/Source/Helper/UserDataManager',['Core/constants','js!SBIS3.Plugin/components/SbisPluginLocalStorage','Core/cookie','SBIS3.Plugin_localization'],function(e,n,t){'use strict';var r={getAccountId:function(){if(e.isBrowserPlatform){var n='',o='';try{if(userInfo&&userInfo.hasOwnProperty('ИдентификаторПользователя')){if(!userInfo['ИдентификаторПользователя'])throw new Error('userID not found');var s=userInfo['ИдентификаторПользователя'].toString(16);n=r._padStr(s,8,'0');}else throw new Error('userInfo not found');}catch(e){if(o=t.get('s3su'),o)n=o.split('-')[1];}return n?n+'@'+location.host:'';}},wasPluginInstalled:function(){var e=1000*60*60*24*3,t=+new Date()-e;return n.getItem('lastSPTime')>t;},updatePluginRunTime:function(){n.setItem('lastSPTime',+new Date());},_padStr:function(e,n,t){if(n>>=0,t=t||' ',e.length>n)return e;else{if(n-=e.length,n>t.length)for(var r=n/t.length,o=1;o<r;o++)t+=t;return t.slice(0,n)+e;}}};return r;});
define('js!SBIS3.Plugin/Source/Transport/ConnectionManager/Ping',['js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionManager','Core/EventBus','Core/Deferred','js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Helper/UserDataManager','SBIS3.Plugin_localization'],function(e,n,t,i,o,s){'use strict';var r=5000,a=60*r,u=6*a,l=60000,g=function(){this._userPingInterval=null,this._autoPingInterval=null,this._autoPingIntervalFixIncrease=null,this._pingChannel=n.channel(o.eventBusChannel.Ping),this._connectionManagerChannel=n.channel(o.eventBusChannel.ConnectionManager),this._connectionManagerChannel.subscribe('onopen',this._onConnectionManagerOpen.bind(this)),this._connectionManagerChannel.subscribe('onclose',this._onConnectionManagerClose.bind(this)),this._lastRunningResult=void 0;};return g.prototype.setLongPeriod=function(e){g.period.LONG_PERIOD=e;},g.prototype.restoreLongPeriod=function(){g.period.LONG_PERIOD=60*g.period.SHORT_PERIOD;},g.prototype.getRunningState=function(){return this.getLastRunningResult().addBoth(function(){return i.isSbisPluginRunning();});},g.prototype.getLastRunningResult=function(){if(void 0===this._lastRunningResult){var n=this;return e.onWarmUpReady().addCallback(function(){return n._lastRunningResult=true,n.restoreLongPeriod(),n._pingChannel.notify('onReady'),n._lastRunningResult;}).addErrback(function(e){if(n._lastRunningResult=e,s.wasPluginInstalled())n.startAutoWithFixedIncrease(2*g.period.SHORT_PERIOD);else n.startAuto(g.period.LONG_PERIOD);return n._lastRunningResult;});}else return t.success(i.isSbisPluginRunning()||this._lastRunningResult);},g.prototype.start=function(e){if(!this._userPingInterval)this._userPingInterval=this._getTimeout(e,{mode:g.pingMode.Fixed});},g.prototype.startAuto=function(e){if(!this._autoPingInterval){if(e>u)e=u;this._autoPingInterval=this._getTimeout(e,{mode:g.pingMode.MultipleIncrease,increaseValue:2});}},g.prototype.startAutoWithFixedIncrease=function(e){if(!this._autoPingIntervalFixIncrease)if(e>l)this.stopAutoWithFixedIncrease(),this.startAuto(g.period.LONG_PERIOD);else this._autoPingIntervalFixIncrease=this._getTimeout(e,{mode:g.pingMode.FixedIncrease,increaseValue:g.period.SHORT_PERIOD});},g.prototype.stop=function(){if(this._userPingInterval)clearTimeout(this._userPingInterval);this._userPingInterval=null;},g.prototype.stopAuto=function(){if(this._autoPingInterval)clearTimeout(this._autoPingInterval);this._autoPingInterval=null;},g.prototype.stopAutoWithFixedIncrease=function(){if(this._autoPingIntervalFixIncrease)clearTimeout(this._autoPingIntervalFixIncrease);this._autoPingIntervalFixIncrease=null;},g.prototype._getTimeout=function(n,t){var o=this,s=t&&t.mode;return s=s||g.pingMode.Fixed,n=n||g.period.SHORT_PERIOD,setTimeout(function(){i.debug('SBIS3.Plugin/Source/Transport/ConnectionManager/Ping','start',' > PING(mode: '+s+', increaseValue: '+t.increaseValue+'): '+n+' ms.'),e.onWarmUpReady().addCallback(function(){if(o._lastRunningResult=true,o.restoreLongPeriod(),o._pingChannel.notify('onReady'),s===g.pingMode.Fixed)o.stop();else if(s===g.pingMode.MultipleIncrease)o.stopAuto();else if(s===g.pingMode.FixedIncrease)o.stopAutoWithFixedIncrease();}).addErrback(function(e){if(o._lastRunningResult=e,s===g.pingMode.Fixed)o.stop(),o.start(n);else if(s===g.pingMode.MultipleIncrease)o.stopAuto(),o.startAuto(n*(t.increaseValue||2));else if(s===g.pingMode.FixedIncrease)o.stopAutoWithFixedIncrease(),o.startAutoWithFixedIncrease(n+t.increaseValue);});},n);},g.prototype._onConnectionManagerOpen=function(){this._lastRunningResult=true,this.restoreLongPeriod(),s.updatePluginRunTime();},g.prototype._onConnectionManagerClose=function(e,n,t){if(this._lastRunningResult=t,s.wasPluginInstalled())this.startAutoWithFixedIncrease(2*g.period.SHORT_PERIOD);else this.startAuto(g.period.LONG_PERIOD);},g.period={SHORT_PERIOD:r,LONG_PERIOD:a},g.pingMode={Fixed:1,MultipleIncrease:2,FixedIncrease:3},new g();});
define('js!SBIS3.Plugin/Source/ServiceManager/ServiceManager',['Core/EventBus','Core/moduleStubs','Core/Deferred','Core/IoC','browser!js!SBIS3.Plugin/Source/ServiceManager/Service','browser!js!SBIS3.Plugin/Source/Error/SpecialTypeError','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','js!SBIS3.Plugin/Source/Transport/ConnectionManager/Ping','SBIS3.Plugin_localization'],function(e,r,n,i,t,o,s,c,a,u,v){'use strict';var h=function(){this._services={},this._isSubscribedOnUpdateEvent=false,this._coreService=null,this._sbisPluginEvent=e.channel(s.eventBusChannel.SbisPluginEvent),this._specialTypesEventBus=e.channel(s.eventBusChannel.SpecialErrors),this._connectionManagerChannel=e.channel(s.eventBusChannel.ConnectionManager),this._serviceManagerChannel=e.channel(s.eventBusChannel.ServiceManager,{strictMode:true}),this._serviceManagerChannel.publish('onopen','onerror','onclose'),this._connectionManagerChannel.subscribe('onopen',this._onConnectionManagerOpen.bind(this)),this._connectionManagerChannel.subscribe('onerror',this._onConnectionManagerError.bind(this)),this._connectionManagerChannel.subscribe('onclose',this._onConnectionManagerClose.bind(this)),this._specialTypesEventBus.subscribe(o.errorsType.PROVIDER_UNSUPPORTED,this._onProviderUnsupported.bind(this)),this._sbisPluginEvent.subscribe('extensionUnloaded',this._onExtensionUnloaded.bind(this)),this._sbisPluginEvent.subscribe('updateStarted',this._onUpdateStarted.bind(this)),a.subscribeOnProgress(this._sbisPluginEvent);};return h.prototype.addService=function(e,r){if(!this.hasService(e))this._checkInCreatedServices(r.endpoint),this._services[e]=new t(e,r);},h.prototype.isServiceReady=function(e){if(!this.hasService(e))return n.fail(new u(u.errorsType.INTERACTION_ERROR,u.detailTypes.COMMUNICATION_ERROR,u.detailStrings.SEND_AFTER_CLOSE_CONNECTION));var i=this.getService(e),t=i.getProtocol();if(!i.isEndpointCorrect())return n.fail(new u(u.errorsType.INTERACTION_ERROR,u.detailTypes.PLUGIN_NOT_INIT,u.detailStrings.BAD_ENDPOINT_REQUEST));if(t===s.protocolName.OLD_PROTOCOL)return r.require(['js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport']).addCallback(function(r){return r[0]._initExtension(e);});return n.success();},h.prototype.getObjectId=function(e){if(this.hasService(e)){var r=this.getService(e).plugin;return r&&r.objectID||null;}else return null;},h.prototype.getService=function(e){return this._services[e];},h.prototype.getDiagnosticInfo=function(){var e={};for(var r in this._services){if(!this._services.hasOwnProperty(r))continue;var n=this._services[r];e[r]={guid:n.guid,config:{endpoint:n.endpoint,options:n.options},methodCount:n.methodCount,protocol:n.getProtocol(),wasProtocolChanged:n.wasProtocolChanged,parentID:n.parentID,plugin:n.plugin};}return e;},h.prototype.getState=function(e){if(!this.hasService(e))return s.readyState.CLOSED;else return c.getReadyState();},h.prototype.hasService=function(e){return this._services.hasOwnProperty(e);},h.prototype.removeService=function(e){if(this.hasService(e)){for(var r in this._services)if(this._services[r].parentID===e)this.removeService(r);delete this._services[e],this._serviceManagerChannel.notify('onclose',e);}},h.prototype.removeAllServices=function(e,r){for(var n in this._services){if(!this._services.hasOwnProperty(n))continue;if(e){if(this.getService(n).getProtocol()===e){if(r)this._serviceManagerChannel.notify('onerror',n,r);this.removeService(n);}}else{if(r)this._serviceManagerChannel.notify('onerror',n,r);this.removeService(n);}}},h.prototype.setQueryTimeout=function(e,r){if(this.hasService(e)&&r)this.getService(e).customTimeout=r;},h.prototype._checkInCreatedServices=function(e){var r=0;if(Object.keys(this._services).length<s.maxDuplicateServiceCount)return;for(var n in this._services){if(!this._services.hasOwnProperty(n))continue;if(this._services[n].endpoint.address===e.address)r++;}if(r>=s.maxDuplicateServiceCount)i.resolve('ILogger').warn('SBIS3.Plugin/Source/ServiceManager/ServiceManager','Потенциальная утечка памяти. На странице уже создано '+s.maxDuplicateServiceCount+' или более экземпляров LocalService с endpoint.address == '+e.address+'. Убедитесь, что для невостребованных сервисов вызывается destroy');},h.prototype._onExtensionUnloaded=function(e,r){if(!r.hasOwnProperty('Guid'))return void c.error('SBIS3.Plugin/Source/ServiceManager/ServiceManager','_onExtensionUnloaded','Не указан идентификатор объекта');var n=r.Guid;c.debug('SBIS3.Plugin/Source/ServiceManager/ServiceManager','_onExtensionUnloaded','Удаляем сервис из обработки: objectId='+n);for(var i in this._services)if(this._services.hasOwnProperty(i))if(this.getObjectId(i)===n)this.removeService(i);},h.prototype._onUpdateStarted=function(){v.setLongPeriod(30000);},h.prototype._onProviderUnsupported=function(e,r){var n=this.getService(r);n.wasProtocolChanged=true,n.setProtocol(s.protocolName.OLD_PROTOCOL);},h.prototype._onConnectionManagerOpen=function(){for(var e in this._services){if(!this._services.hasOwnProperty(e))continue;this._serviceManagerChannel.notify('onopen',e);}},h.prototype._onConnectionManagerError=function(e,r,n){this._isSubscribedOnUpdateEvent=false,this._coreService=null,this.removeAllServices(r,n);},h.prototype._onConnectionManagerClose=function(e,r){this._isSubscribedOnUpdateEvent=false,this._coreService=null,this.removeAllServices(r);},h.prototype._subscribeToUpdateEvent=function(){if(!this._isSubscribedOnUpdateEvent&&!this._coreService){this._isSubscribedOnUpdateEvent=true;var e=this;r.require(['browser!js!SBIS3.Plugin/Source/LocalService']).addCallback(function(r){var n=r[0];e._coreService=new n({endpoint:{address:'CoreService-1.0.0.0',contract:'CoreService'},options:{mode:s.showModes.SILENT}}),e._coreService.call('SubscribeToUpdateEvent',{}).addErrback(function(){e._isSubscribedOnUpdateEvent=false,e._coreService.destroy(),e._coreService=null;});});}},new h();});
define('js!SBIS3.Plugin/Source/Helper/ExecutionTimeout',['Core/Deferred','js!SBIS3.Plugin/Source/Error/ConnectionError','js!SBIS3.Plugin/Source/Helper/SPConstants','SBIS3.Plugin_localization'],function(e,r,t){'use strict';return{setMethodExecutionTimeout:function(n,i,u){var o=new e(),a=function(){if(!o.isReady()){var e=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.COMMUNICATION_ERROR,r.detailStrings.NO_RESPONSE_DURING+' ('+a.time/1000+' сек.) method description: '+u);o.errback(e);}},c=setTimeout(a,i||t.defaultQueryTimeout);return a.time=i||t.defaultQueryTimeout,n.addCallback(function(e){return!o.isReady()&&o.callback(e),e;}).addErrback(function(e){return!o.isReady()&&o.errback(e),e;}).addBoth(function(e){return clearTimeout(c),e;}),o;}};});
define('js!SBIS3.Plugin/Source/QueryManager/Query',['js!SBIS3.Plugin/Source/Helper/SPConstants','SBIS3.Plugin_localization'],function(t){'use strict';var e=function(t,e,i){this.deferred=i,this.queryId=t.queryID||t.queryId,this._timeoutHandler=null,this._timeout=null,this.serviceGuid=e,this.info=t.info,this.options=t.options,this._data=t.data;};return e.prototype.getDataString=function(){return JSON.stringify(this._data);},e.prototype.success=function(t){if(!this.deferred.isReady())this.deferred.callback(t);},e.prototype.fail=function(t){if(!this.deferred.isReady())this.deferred.errback(t);},e.prototype.getWaitingTime=function(){return this._timeoutHandler.time;},e.prototype.extendWaitingTime=function(t){this.clearTimeout(),this._timeoutHandler.originalTimeout=this._timeoutHandler.time,this._timeoutHandler.time=t;var e=setTimeout(this._timeoutHandler,this._timeoutHandler.time);this.setTimeout(e);},e.prototype.returnWaitingTime=function(){this.clearTimeout(),this._timeoutHandler.time=this._timeoutHandler.originalTimeout?this._timeoutHandler.originalTimeout:this._timeoutHandler.time?this._timeoutHandler.time:e._queryTimeout;var t=setTimeout(this._timeoutHandler,this._timeoutHandler.time);this.setTimeout(t);},e.prototype.setTimeout=function(t,e){if(t)this._timeout=t;if(e)this._timeoutHandler=e;},e.prototype.clearTimeout=function(){clearTimeout(this._timeout);},e._queryTimeout=t.defaultQueryTimeout,e;});
define('js!SBIS3.Plugin/components/SbisPluginLocalStorageTemporary',['Lib/Storage/LocalStorage','Core/constants','SBIS3.Plugin_localization'],function(e,n){if(n.isBrowserPlatform){var t=new e(),o=(t.getItem('ws-store-always-keys')||[]).filter(function(e){return'SBIS3.Plugin/SbisPluginToken'!==e;});t.setItem('ws-store-always-keys',o);}return new e('SBIS3.Plugin');});
define('js!SBIS3.Plugin/Source/Authenticate',['js!WS.Data/Source/SbisService','js!SBIS3.Plugin/components/SbisPluginLocalStorageTemporary','js!SBIS3.Plugin/Source/Helper/UserDataManager','Core/Deferred','Core/IoC','Core/helpers/generate-helpers','Core/moduleStubs','SBIS3.Plugin_localization'],function(e,r,n,t,o,i,u){'use strict';return{_defAuth:null,getClientId:function(){var e=r.getItem('SbisPluginClientId');if(!e)e=i.createGUID(),r.setItem('SbisPluginClientId',e);return e;},getTokenKey:function(){var e='SbisPluginToken',r=n.getAccountId();if(''!==r)e+='-'+r;return e;},getToken:function(){return r.getItem(this.getTokenKey());},setToken:function(e){r.setItem(this.getTokenKey(),e);},removeToken:function(){r.removeItem(this.getTokenKey());},prepareToken:function(){var e=this,r=new t(),n=this.getToken();if(n)r.callback(n);else{if(this._defAuth)return this._defAuth;this._defAuth=r,r.addErrback(function(r){return e._defAuth=null,r;}),this.getAccessTokenOnline(r);}return r;},getAccessTokenOnline:function(r){var n=this;this._getManagersForQuery().addCallback(function(t){var u=t[0],c=t[1],s=i.createGUID(),a=n.getClientId();u.addService(s,{endpoint:{address:'CoreService-1.0.0.0',contract:'CoreService'},options:{}}),c.call(s,'getHardwareId',{version:'1.0'}).addCallbacks(function(t){new e({endpoint:'САП',provider:'source.provider.sbis-business-logic'}).call('RegisterHttpClient',{HttpClientID:a,PluginID:t}).addCallbacks(function(){c.call(s,'getAccessTokenOnline',{clientId:a,domain:location.host,hwVersion:'1.0'}).addCallbacks(function(e){return n.setToken(e),u.removeService(s),r.callback(e),n._defAuth=null,e;},function(e){return o.resolve('ILogger').log('SBIS3.Plugin/Source/Authenticate.requestToken.getAccessTokenOnline','Error: '+e.message),r.errback(e),e;});},function(e){return o.resolve('ILogger').log('SBIS3.Plugin/Source/Authenticate.requestToken.RegisterHttpClient','Error: '+e.message),r.errback(e),e;});},function(e){return o.resolve('ILogger').log('SBIS3.Plugin/Source/Authenticate.requestToken.getHardwareId','Error: '+e.message),r.errback(e),e;});}).addErrback(function(e){o.resolve('ILogger').log('SBIS3.Plugin/Source/Authenticate.getAccessTokenOnline._getManagersForQuery','Error: '+e.message),r.errback(e);});},_getManagersForQuery:function(){return u.require(['js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','js!SBIS3.Plugin/Source/QueryManager/QueryManager']);}};});
define('js!SBIS3.Plugin/Source/QueryManager/Mixin/SpecialTypesMixin',['Core/Deferred','Core/EventBus','browser!js!SBIS3.Plugin/Source/Error/SpecialTypeError','browser!js!SBIS3.Plugin/Source/Authenticate','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Helper/Environment','SBIS3.Plugin_localization'],function(e,r,n,t,s,o,i){'use strict';return{_inspectSpecialTypes:function(p){var E=this,T=new e(),a,S,R,_;if(!(p instanceof n))return T.errback(p);if(a=p.queryId,S=this.getQuery(a),p.type===n.errorsType.PROVIDER_UNSUPPORTED){if(i.osType.isMac||i.osType.isLinux)return R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.PLUGIN_NOT_INIT),T.errback(R);r.channel(o.eventBusChannel.SpecialErrors).notify(n.errorsType.PROVIDER_UNSUPPORTED,S.serviceGuid),T.dependOn(this.repeatQuery(S));}else if(p.type===n.errorsType.POOL_NOT_AVAILABLE)return R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.PLUGIN_NOT_INIT),T.errback(R);else if(p.type===n.errorsType.LOW_ACCESS_LEVEL){var u=t.getToken();if(u&&''!==u&&S._data.accessToken&&''!==S._data.accessToken)return _=s.detailStrings.NO_RIGHTS_FOR_EXECUTE+' (Метод: '+S.info.method+')',R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.NO_RIGHTS_FOR_EXECUTE,_),T.errback(R),T;t.prepareToken().addCallbacks(function(){S.options.attemptSend++,T.dependOn(E.repeatQuery(S,{attemptSend:S.options.attemptSend}));},function(e){R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.AUTHENTICATION_FAILED,e.message),T.errback(R);});}else if(p.type===n.errorsType.TOKEN_NOT_VALID)if(t.removeToken(),0===S.options.attemptSend)S.options.attemptSend++,T.dependOn(this.repeatQuery(S,{attemptSend:S.options.attemptSend}));else return _=s.detailStrings.NO_RIGHTS_FOR_EXECUTE+' (при повторном вызове метода: '+S.info.method+')',R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.NO_RIGHTS_FOR_EXECUTE,_),T.errback(R),T;else T.errback(p);return T;}};});
define('js!SBIS3.Plugin/Source/QueryManager/Mixin/DeferredQueryMixin',['Core/EventBus','js!SBIS3.Plugin/Source/Helper/SPConstants','js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization'],function(e,n,i){'use strict';var r='SBIS3.Plugin/Source/QueryManager/Mixin/DeferredQueryMixin';return{$constructor:function(){this._sbisPluginEvent=e.channel(n.eventBusChannel.SbisPluginEvent),this._sbisPluginEvent.subscribe('messageEnqueued',this._onMessageEnqueued.bind(this)),this._sbisPluginEvent.subscribe('messageDequeued',this._onMessageDequeued.bind(this)),this._sbisPluginEvent.subscribe('downloadProgress',this._onDownloadProgress.bind(this)),this._sbisPluginEvent.subscribe('request.not_recognized',this._onRequestNotRecognized.bind(this));},_onMessageEnqueued:function(e,n){var i=this.getQuery(n.QueryId);if(!i)return;i.extendWaitingTime(5*60*1000);},_onMessageDequeued:function(e,n){var i=this.getQuery(n.QueryId);if(!i)return;i.returnWaitingTime();},_onDownloadProgress:function(e,n){var i=n.Name.split('-')[0],r=this._queries;for(var s in r){if(!r.hasOwnProperty(s))continue;var t=this.getQuery(s);t.clearTimeout(),t.setTimeout(t._timeoutHandler,t._timeoutHandler.time);}},_onRequestNotRecognized:function(e,n){try{var s=JSON.parse(n.request),t=s.queryID||s.queryId,u=this.getQuery(t);i.info(r,'_onRequestNotRecognized','Запрос с queryId = '+t+' не распознан');var o=new ConnectionError(ConnectionError.errorsType.INTERNAL_SERVER_ERROR,ConnectionError.detailTypes.REQUEST_NOT_RECOGNIZED);u.clearTimeout(),u.fail(o);}catch(e){i.error(r,'_onRequestNotRecognized','Запрос не распознан: '+n.request);}}};});
define('js!SBIS3.Plugin/Source/QueryManager/Mixin/ServiceManagerEventMixin',['Core/EventBus','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPCustomEvent','SBIS3.Plugin_localization'],function(e,r,n,i,s){'use strict';return{$constructor:function(){this._serviceManagerChannel=e.channel(n.eventBusChannel.ServiceManager),this._serviceManagerChannel.subscribe('onclose',this._onServiceClose.bind(this));},_onServiceClose:function(e,n){for(var t in this._queries){if(!this._queries.hasOwnProperty(t))continue;var o=this.getQuery(t);if(o.serviceGuid===n){o.clearTimeout();var a=new r(r.errorsType.INTERACTION_ERROR,r.detailTypes.CLOSE_CONNECTION,'СБИС Плагин закрыл соединение. Работа с плагинами невозможна, запустите СБИС Плагин и перезагрузите страницу.');if(o.fail(a),i.isDebugLogEnabled)window.dispatchEvent(s.create('onSbisPluginLogEvent',{type:'error',datetime:new Date().toISOString(),queryID:t,data:{message:a.message,type:a.type,detailType:a.description}}));}}}};});
define('js!SBIS3.Plugin/Source/QueryManager/QueryManager',['Core/moduleStubs','Core/EventBus','Core/Deferred','Core/core-extend','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','browser!js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionManager','browser!js!SBIS3.Plugin/Source/QueryManager/Query','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/SpecialTypesMixin','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/DeferredQueryMixin','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/ServiceManagerEventMixin','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPCustomEvent','SBIS3.Plugin_localization'],function(e,r,n,t,i,o,a,u,s,c,d,l,g,p,y){'use strict';var S=function(){return this||(0,eval)('this');}(),v='js!SBIS3.Plugin/Source/QueryManager/QueryManager',f,I=function(){this._queries={},this._connectionManagerChannel=r.channel(i.eventBusChannel.ConnectionManager),this._connectionManagerChannel.subscribe('onmessage',this._onConnectionManagerMessage.bind(this));};return I.prototype.isReady=function(){return a.onWarmUpReady();},I.prototype.call=function(e,r,t,u){var s=this;return a.onWarmUpReady().addCallback(function(){var a=o.getService(e),c=new n();if('destroy'===r)if(c.addBoth(function(r){return o.removeService(e),r;}),a.getProtocol()===i.protocolName.OLD_PROTOCOL)if(r='releasePlugin',a&&a.plugin)t=[a.plugin.objectID];else return c.callback(),c;else r='BaseExtension.destroy',t={serviceGuid:e};return p.debug(v,'call','Вызов метода: '+r),c.dependOn(s._sendData(a,r,t,u)),c;});},I.prototype.repeatQuery=function(e,r){var t=e.serviceGuid,i=e.info,a=i.method,u=i.params,s=new n(),c=o.getService(t);return e.clearTimeout(),p.debug(v,'repeatQuery','Повторный запрос для queryId: '+e.queryId+', service: '+t+(c?'('+c.endpoint.address+')':'')),s.dependOn(this.call(t,a,u,r)),s;},I.prototype.getQuery=function(e){return this._queries[e];},I.prototype.addQuery=function(e,r){this._queries[e]=r;},I.prototype.removeQuery=function(e){var r=this._queries[e];if(r)r.clearTimeout(),delete this._queries[e];},I.prototype._getProtocolByService=function(r){var n=r.getProtocol();return e.require([n]).addCallback(function(e){return e[0];});},I.prototype._sendData=function(e,r,t,i){var o=e.guid,u=this;return u._getProtocolByService(e).addCallback(function(s){return s.preparePacket(e,r,t,i).addCallback(function(t){var i=new n(),s=u._makeQuery(t,o,i);if(e.methodCount.hasOwnProperty(r)?e.methodCount[r]++:e.methodCount[r]=1,p.isDebugLogEnabled)if(window.dispatchEvent(y.create('onSbisPluginLogEvent',{type:'call',datetime:new Date().toISOString(),queryID:s.queryId,data:{moduleName:e.plugin?e.plugin.name:e.endpoint.address,method:s.info.method,params:s.info.params,objectID:s._data.objectID||''}})),S.LocalService&&S.LocalService.sbisLogsTraceEndpoint)S.LocalService.sbisLogsTraceEndpoint(s.queryId);return a.send(s.getDataString(),null).addErrback(function(e){i.errback(e);}),i;});});},I.prototype._onConnectionManagerMessage=function(r,n){var t=this,i=JSON.parse(n);if(!this._inspectEvents(i)){var a=i.queryID||i.queryId,u=this.getQuery(a);if(!u)return void p.error(v,'_onConnectionManagerMessage','Запрос с queryId = '+a+' отсутствует');var c=u.serviceGuid,d,l;if(!o.hasService(c))return void u.fail(new s(s.errorsType.INTERACTION_ERROR,s.detailTypes.COMMUNICATION_ERROR,'Сервис с guid == '+c+' уже уничтожен'));l=(d=o.getService(c)).getProtocol(),e.require([l]).addCallback(function(e){return e[0].receiveAnswer(i,d).addErrback(function(e){return t._inspectSpecialTypes(e);}).addCallback(function(e){return t.removeQuery(a),u.success(e),i;}).addErrback(function(e){return t.removeQuery(a),u.fail(e),e;}).addBoth(function(e){if(p.isDebugLogEnabled){var r='answer',n=e;if(e instanceof Error)r='error',n={message:e.message,type:e.type,detailType:e.description};window.dispatchEvent(y.create('onSbisPluginLogEvent',{type:r,datetime:new Date().toISOString(),queryID:a,data:n}));}return e;});});}},I.prototype._makeQuery=function(e,r,n){var t=this,i=o.getService(r),a=i&&i.customTimeout,c=new u(e,r,n),d=function(){if(!n.isReady()){var r=new s(s.errorsType.INTERNAL_CLIENT_ERROR,s.detailTypes.COMMUNICATION_ERROR,s.detailStrings.NO_RESPONSE_DURING+' ('+d.time/1000+' сек.) queryID: '+e.queryID);if(p.isDebugLogEnabled)window.dispatchEvent(y.create('onSbisPluginLogEvent',{type:'error',datetime:new Date().toISOString(),queryID:c.queryId,data:{message:r.message,type:r.type,detailType:r.description}}));t.removeQuery(e.queryID),n.errback(r);}},l=setTimeout(d,a||u._queryTimeout);return d.time=a||u._queryTimeout,c.setTimeout(l,d),t.addQuery(e.queryID,c),c;},I.prototype._inspectSpecialTypes=function(e){return n.success(e);},I.prototype._inspectEvents=function(e){return false;},f=t.mixin(I,[c,d,l,g]),new f();});
define('js!SBIS3.Plugin/Source/Provider/SbisPlugin',['js!WS.Data/Di','js!WS.Data/Source/Provider/IRpc','js!WS.Data/Entity/OptionsMixin','Core/Abstract','browser!js!SBIS3.Plugin/Source/QueryManager/QueryManager','SBIS3.Plugin_localization'],function(i,n,r,t,e){'use strict';var u='SBIS3.Plugin/Source/Provider/SbisPlugin',o=t.extend([n,r],{_moduleName:u,_$guid:'',_$endpoint:null,constructor:function i(n){this._$endpoint={},r.constructor.call(this,n);},getEndpoint:function(){return this._$endpoint;},call:function(i,n,r){if(r)return e.call(this._$guid,i,n);else return e.call(this._$guid,i,{Params:n});}});return i.register(u,o),o;});
define('js!SBIS3.Plugin/Source/LocalService',['js!WS.Data/Di','js!WS.Data/Source/SbisService','Core/moduleStubs','Core/Deferred','Core/EventBus','Core/IoC','Core/helpers/generate-helpers','Core/core-instance','Core/constants','Core/core-merge','js!SBIS3.Plugin/components/SbisPluginLocalStorage','browser!js!SBIS3.Plugin/Source/Helper/Environment','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Error/ParamsValidationError','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin','browser!js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','js!SBIS3.Plugin/Source/Helper/ExecutionTimeout','js!WS.Data/Adapter/Sbis','browser!js!SBIS3.Plugin/Source/Provider/SbisPlugin','SBIS3.Plugin_localization'],function(e,r,n,i,o,t,s,a,c,u,l,d,g,h,S,f,p,b,_){'use strict';if(!c.isBrowserPlatform)return t.resolve('ILogger').log('SBIS3.Plugin/Source/LocalService','Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!'),null;var v=function(){return this||(0,eval)('this');}();v.LocalService={logger:{},diagnostic:{modules:{}},sbisLogsTraceEndpoint:function(e){}};var P='SBIS3.Plugin/Source/LocalService',y='SBIS3.Plugin/Source/Provider/SbisPlugin';if('undefined'!==typeof window&&(window.hasOwnProperty('page')||window.hasOwnProperty('isRetailProduct')&&!d.isOnline))o.channel('SbisServiceOfflineChannel').subscribe('onMessage',function(e,r){h.debug(P,'_subscribeOnOfflineChannel','Data: '+r);try{var n={};if('string'===typeof r)n=JSON.parse(r);else if('object'===typeof r)n=r;p._inspectEvents(n);}catch(e){h.error(P,'_subscribeOnOfflineChannel','Не удалось получить данные из SbisServiceOfflineChannel: '+e.message);}});var w=r.extend({_moduleName:P,_$adapter:'adapter.json',_$provider:y,_$options:{mode:g.showModes.RUN_ONCE,debug:false,queryTimeout:60000},_$handlers:{onError:null},errorsType:{},errorsDetailType:{},_guid:'',_channel:null,readyState:g.readyState,constructor:function(r){var n=this;this._guid=s.createGUID(),u(this.errorsType,S.errorsType),u(this.errorsType,f.errorsType),u(this.errorsDetailType,S.detailTypes),u(this.errorsDetailType,f.detailTypes),this._channel=o.channel({strictMode:true}),this._serviceManagerChannel=o.channel(g.eventBusChannel.ServiceManager,{strictMode:true}),this._channel.publish('onopen','onerror','onclose'),this._serviceManagerChannel.publish('onopen','onerror','onclose'),this._onclose=this._onclose.bind(this),this._onerror=this._onerror.bind(this),this._serviceManagerChannel.subscribe('onclose',this._onclose),this._serviceManagerChannel.subscribe('onerror',this._onerror),r.options=r.options||{},r.options.debug=r.options.debug||v.SPDebug();var i=r.endpoint.hasOwnProperty('address')?r.endpoint.address.split('-'):[],t=i.length>1?i[0]:'';if('undefined'!==typeof window&&(window.hasOwnProperty('page')||window.hasOwnProperty('isRetailProduct')&&!d.isOnline&&'FileSystem'!==t)){var a=l.getItem('SbisPluginExclude'),c=[];if(a&&'string'===typeof a)try{c=JSON.parse(a);}catch(e){c=[];}else c=[];if(c.indexOf(t)<0){if(''!==t)r.endpoint.address='/service/?pool='+t;r.provider='source.provider.sbis-business-logic';}}if(h.changeLocalServiceInfo(r.endpoint.address),w.superclass.constructor.call(this,r),'string'===typeof this._$provider)this._$provider=e.resolve(this._$provider,{guid:this._guid,endpoint:r.endpoint});var p={endpoint:n._$endpoint,options:n._$options};b.addService(n._guid,p);},once:function(e,r,n){this._channel.once(e,r,n);},subscribe:function(e,r,n){this._channel.subscribe(e,r,n);},unsubscribe:function(e,r,n){this._channel.unsubscribe(e,r,n);},call:function(e,r){if(!c.isBrowserPlatform)return i.fail('Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!');var n=this,o=new i();return this.isReady().addCallbacks(function(){if(n._$provider._moduleName!==y)o.dependOn(_.setMethodExecutionTimeout(n._callViaProvider(e,r),n._$options.queryTimeout,n.getEndpoint().contract+'.'+e).addErrback(function(e){return S.createFromNativeError(e);}));else o.dependOn(n._callViaProvider(e,r));},function(e){o.errback(e);}),o;},isReady:function(){if(!c.isBrowserPlatform)return i.fail('Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!');var e=d.validateEnvironment();if(e instanceof Error)return i.fail(e);var r=this;if(r._$provider._moduleName!==y)return i.success();return n.require(['js!SBIS3.Plugin/Source/Transport/ConnectionManager/Ping']).addCallback(function(e){var n=e[0],o=new i();return n.getLastRunningResult().addCallback(function(){return b.isServiceReady(r._guid);}).addCallback(function(e){return o.callback(),e;}).addErrback(function(e){if(e.message=rk(e.message),'function'===typeof r._$handlers.onError)r._$handlers.onError();o.dependOn(r._showError(e));}),o;});},isRunning:function(){if(!c.isBrowserPlatform)return i.fail('Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!');return n.require(['browser!js!SBIS3.Plugin/Source/Transport/ConnectionManager/Ping']).addCallback(function(e){return e[0].getRunningState();});},getState:function(){return b.getState(this._guid);},destroy:function(){var e=this.call('destroy',{});return this._channel.destroy(),this._destroyed=true,e;},getGuid:function(){return this._guid;},getObjectId:function(){return b.getObjectId(this._guid);},setProvider:function(r){if('string'===typeof r)this._$provider=e.resolve(r,{guid:this._guid});else this._$provider=r;},setQueryTimeout:function(e){if('number'!==typeof e||isNaN(e)||!isFinite(e)||e<=1000)return-1;b.setQueryTimeout(this._guid,e);},_callViaProvider:function(e,r){var n=this,i=this.getAdapter();return n._$provider.call(e,i.serialize(r),true).addCallbacks(function(e){return n.__getDataSetInstance({rawData:e,itemsProperty:void 0,totalProperty:'n'});}.bind(n),function(e){return h.debug(P,'call',e.description+' '+e.message),e;});},__getDataSetInstance:function(e){if('string'===typeof this._$adapter&&'adapter.json'===this._$adapter||'object'===typeof this._$adapter&&a.instanceOfModule(this._$adapter,'WS.Data/Adapter/Json'))return e.rawData;else return this._getDataSetInstance(e);},_showError:function(e){if(!c.isBrowserPlatform)return i.fail('Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!');var r=this,o=h.getTransportName(),t=r._$options.mode;return n.require(['browser!js!SBIS3.Plugin/Source/Helper/DialogsManager']).addCallback(function(n){var s=n[0],a=new i();if(o===g.transportName.EXTERNAL)return i.fail(e);if(e.description in s.installDialogTemplates)return a.dependOn(s.showError(e,t)).addCallback(function(n){if(n)return r.isReady();else return e;}),a;else return i.fail(e);});},_onclose:function(e,r){if(this._guid===r)e.cancelBubble(),h.debug(P,'_onclose',r),this._serviceManagerChannel.unsubscribe('onclose',this._onclose),this._serviceManagerChannel.unsubscribe('onerror',this._onerror),this._channel.notify('onclose',r);},_onerror:function(e,r,n){if(this._guid===r){e.cancelBubble();try{if('string'===typeof n)n=JSON.parse(n);}catch(e){return void h.debug(P,'_onerror','cant parse, guid: '+r+'; message: '+n);}h.debug(P,'_onerror','error.description || error'),this._serviceManagerChannel.unsubscribe('onerror',this._onerror),this._channel.notify('onerror',n);}}});return e.register(P,w),w.subscribe=function(e,r,n){if(e=e.toLowerCase(),'onconnect'===e)o.channel(g.eventBusChannel.ConnectionManager).subscribe('onopen',r,n);else if('ondisconnect'===e)o.channel(g.eventBusChannel.ConnectionManager).subscribe('onclose',r,n);else if('onerror'===e)o.channel(g.eventBusChannel.ConnectionManager).subscribe('onerror',r,n);},w;});
(function(){var availableDict={'en-US':true},langMatch=String(typeof document==='undefined'?'':document.cookie).match(/lang=([A-z-]+)/),langName=langMatch?langMatch[1]:'ru-RU',langModule='text!SBIS3.Plugin/lang/'+langName+'/'+langName+'.json';if(langName in availableDict){define('SBIS3.Plugin_localization',['Core/i18n',langModule,'SBIS3.Plugin_localization'],function(i18n,data){if(data){i18n.setDict(JSON.parse(data),langModule,langName);}});}else{define('SBIS3.Plugin_localization',['SBIS3.Plugin_localization'],function(){});}}());define('js!SBIS3.Plugin/components/SbisPluginLocalStorage',['Lib/Storage/LocalStorage','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(n){return new n('SBIS3.Plugin',true);});define('js!SBIS3.Plugin/Source/Error/SbisPluginError',['Core/core-extend','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(r){function t(r){if(this.message=r,Error.captureStackTrace)Error.captureStackTrace(this);else this.stack=new Error(r).stack||'';}return r.classicExtend(t,Error),t.prototype.toString=function(){return this.stack||this.message;},t;});define('js!SBIS3.Plugin/Source/Error/ConnectionError',['Core/core-extend','js!SBIS3.Plugin/Source/Error/SbisPluginError','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(E,N){'use strict';function O(E,N,R){R=R||O.detailStrings[N]||O.detailStrings.UNKNOWN_ERROR,this.type=E,this.description=N,this.errorType=N,this.constructor.superclass.constructor.call(this,R);}return O.errorsType={USER_CANCELLED:'USER_CANCELLED',SILENT_MODE:'SILENT_MODE',INTERNAL_SERVER_ERROR:'INTERNAL_SERVER_ERROR',INTERNAL_CLIENT_ERROR:'INTERNAL_CLIENT_ERROR',INTERACTION_ERROR:'INTERACTION_ERROR'},O.detailTypes={OLD_FLASH_PLAYER:'OLD_FLASH_PLAYER',UNABLE_TO_CONNECT:'UNABLE_TO_CONNECT',OPEN:'OPEN',CLOSE:'CLOSE',IS_MOBILE:'IS_MOBILE',COMMUNICATION_ERROR:'COMMUNICATION_ERROR',UNKNOWN_ERROR:'UNKNOWN_ERROR',UNKNOWN_SERVER_ERROR:'UNKNOWN_SERVER_ERROR',UNKNOWN_RECEIVER:'UNKNOWN_RECEIVER',NO_RESPONSE_DURING:'NO_RESPONSE_DURING',PLUGIN_NOT_INIT:'PLUGIN_NOT_INIT',BAD_ENDPOINT_REQUEST:'BAD_ENDPOINT_REQUEST',SERVER_CLOSE_CONNECTION:'SERVER_CLOSE_CONNECTION',CLOSE_CONNECTION:'CLOSE_CONNECTION',UNSUPPORTED_PLATFORM:'UNSUPPORTED_PLATFORM',NMH:'NMH',CERTIFICATE_NOT_INSTALLED:'CERTIFICATE_NOT_INSTALLED',OLD_VERSION_UPDATE_DOWNLOADED:'OLD_VERSION_UPDATE_DOWNLOADED',SEND_AFTER_CLOSE_CONNECTION:'SEND_AFTER_CLOSE_CONNECTION',INSTALL_NMH_EXTENSION:'INSTALL_NMH_EXTENSION',AUTHENTICATION_FAILED:'AUTHENTICATION_FAILED',PROVIDER_UNSUPPORTED:'PROVIDER_UNSUPPORTED',REQUEST_NOT_RECOGNIZED:'REQUEST_NOT_RECOGNIZED',NO_RIGHTS_FOR_EXECUTE:'NO_RIGHTS_FOR_EXECUTE'},O.errorPriorities={NMH:1,OLD_FLASH_PLAYER:2,CERTIFICATE_NOT_INSTALLED:3,CLOSE_CONNECTION:4,UNABLE_TO_CONNECT:5},O.detailStrings={OLD_FLASH_PLAYER:rk('Требуется Flash Player')+' >= 19.0.0',UNABLE_TO_CONNECT:rk('Не удалось подключиться к СБИС Плагин. Проверьте, что он включен и ничего не блокирует его работу.'),OPEN:rk('WebSocket - соединение устанавливается'),CLOSE:rk('WebSocket - соединение закрыто'),IS_MOBILE:rk('Вы используете мобильную версию браузера'),COMMUNICATION_ERROR:rk('Произошла ошибка при взаимодействии со СБИС Плагин'),UNKNOWN_ERROR:rk('Неизвестная ошибка'),UNKNOWN_SERVER_ERROR:rk('На сервере произошла неизвестная ошибка.'),UNKNOWN_RECEIVER:rk('Неизвестный получатель ответа'),NO_RESPONSE_DURING:rk('Не удалось получить ответ за разумное время'),PLUGIN_NOT_INIT:rk('Запрашиваемое расширение не может быть инициализировано'),BAD_ENDPOINT_REQUEST:rk('Указан неправильный формат адреса расширения СБИС Плагин (необходимо "pluginName-pluginVersion")'),SERVER_CLOSE_CONNECTION:rk('СБИС Плагин закрыл соединение'),CLOSE_CONNECTION:rk('Подключение к СБИС Плагин закрылось. Проверьте, что он включен и ничего не блокирует его работу.'),UNSUPPORTED_PLATFORM:rk('Операционная система не поддерживается'),NMH:rk('Не удалось подключиться к СБИС Плагин. Не удалось инициализировать соединение через расширение SbisPlugin Extension. Разрешите его использование в настройках браузера'),CERTIFICATE_NOT_INSTALLED:rk('Не удалось подключиться к СБИС Плагин. Проверьте, что он включен и ничего не блокирует его работу.'),OLD_VERSION_UPDATE_DOWNLOADED:rk('Необходимо установить скачанное обновление СБИС Плагин'),SEND_AFTER_CLOSE_CONNECTION:rk('Отправка команды после destroy. Необходимо создать сервис'),INSTALL_NMH_EXTENSION:rk('Рекомендуем установить расширение для работы со СБИС Плагин'),AUTHENTICATION_FAILED:rk('Не удалось провести процедуру аутентификации'),PROVIDER_UNSUPPORTED:rk('Данный протокол не поддерживается СБИС Плагин'),REQUEST_NOT_RECOGNIZED:rk('Запрос не распознан'),NO_RIGHTS_FOR_EXECUTE:rk('Недостаточно прав для вызова метода СБИС Плагин')},O.getTopPriorityError=function(E){return E=E||[],E.sort(function(E,N){return O.errorPriorities[E.errorType]-O.errorPriorities[N.errorType];}),E[0];},O.createFromNativeError=function(E){if(!(E instanceof N)){var R=E.message,_=E.error_code;return new O(O.detailTypes.COMMUNICATION_ERROR,_||O.detailTypes.COMMUNICATION_ERROR,R||O.detailTypes.UNKNOWN_SERVER_ERROR);}else return E;},E.classicExtend(O,N),O;});define('js!SBIS3.Plugin/Source/Helper/SPConstants',['i18n!SBIS3.Plugin/Source/Helper/SPConstants','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(){'use strict';return{readyState:{UNKNOWN:-1,CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},readyStateText:{'-1':'UNKNOWN',0:'CONNECTING',1:'OPEN',2:'CLOSING',3:'CLOSED'},connectionMode:{ONE_CONNECTION_SERIAL:1,ONE_CONNECTION_BREAK:2},protocolName:{OLD_PROTOCOL:'js!SBIS3.Plugin/Source/Protocol/SbisPlugin',NEW_PROTOCOL:'js!SBIS3.Plugin/Source/Protocol/Sbis3Plugin'},shortProtocolName:{'js!SBIS3.Plugin/Source/Protocol/SbisPlugin':'SbisPlugin','js!SBIS3.Plugin/Source/Protocol/Sbis3Plugin':'Sbis3Plugin'},showModes:{ALWAYS:'always',RUN_ONCE:'runOnce',SILENT:'silent'},transportName:{EXTERNAL:'js!SBIS3.Plugin/Source/Transport/resources/WebSocketExternal',WEBSOCKET:'js!SBIS3.Plugin/Source/Transport/resources/WebSocketNative',NMH:'js!SBIS3.Plugin/Source/Transport/resources/NmhWebSocket',FLASH:'js!SBIS3.Plugin/Source/Transport/resources/WebSocket'},eventBusChannel:{SbisPluginEvent:'SbisPluginEvent',SpecialErrors:'SbisPluginSpecialErrorChannel',ConnectionManager:'SbisPluginCMChannel',ServiceManager:'SbisPluginSMChannel',Ping:'SbisPluginPingChannel'},maxDuplicateServiceCount:100,defaultQueryTimeout:60000};});define('js!SBIS3.Plugin/Source/Helper/EnvMixin/SystemInfoMixin',['SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(){return{browserType:function(){var e={isChrome:false,isIE:false,isFirefox:false,isOpera:false,isYandex:false,isAmigo:false,isEdge:false,isSbis:false};if('undefined'!==typeof navigator){var i=navigator.userAgent;if(/chrome/i.test(i)&&!/opr/i.test(i)&&!/yabrowser/i.test(i)&&!/amigo/i.test(i)&&!/edge/i.test(i)&&!/sbis/i.test(i))e.isChrome=true;else if(/msie/i.test(i)|/trident/i.test(i)&&!/opera/i.test(i))e.isIE=true;else if(/firefox/i.test(i))e.isFirefox=true;else if(/opera|opr/i.test(i))e.isOpera=true;else if(/yabrowser/i.test(i))e.isYandex=true;else if(/amigo/i.test(i))e.isAmigo=true;else if(/edge/i.test(i))e.isEdge=true;else if(/sbis/i.test(i))e.isSbis=true;}return e;}(),osType:function(){var e={isWindow:false,isLinux:false,isMac:false};if('undefined'!==typeof navigator){var i=navigator.userAgent;if(/\bMac\s+OS\s+X\b/.test(i))e.isMac=true;else if(-1!==i.indexOf('Linux'))e.isLinux=true;else if(/Win/i.test(i))e.isWindow=true;}return e;}()};});define('js!SBIS3.Plugin/Source/Helper/EnvMixin/PluginMigrateMixin',['js!SBIS3.Plugin/components/SbisPluginLocalStorage','Core/helpers/generate-helpers','Core/helpers/Object/find','browser!js!SBIS3.Plugin/Source/Helper/EnvMixin/SystemInfoMixin','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(i,e,n,r){'use strict';var t=function(){if('undefined'!==typeof navigator){var e=i.getItem('SbisPlugin');if(e)return e=JSON.parse(e),e.hasOwnProperty('wsPort')&&e.hasOwnProperty('wssPort');}return false;}(),s=function(){var i=t?'Sbis3Plugin/':'SbisPlugin/';function s(){var e=['wi.sbis.ru','platform-','dev-','test-','localhost','fix-','dev.','test.','fix.','rc-','rc.'];if('undefined'!==typeof location&&!r.browserType.isSbis){var t=location.host,s=n(e,function(i){return-1!==t.indexOf(i);});if(!s)s=/:\d+$/.test(t);if(s)return'http://test-update.sbis.ru/'+i;}return'http://update.sbis.ru/'+i+'master/';}function u(){var i=e.randomId('?');if(navigator){if(-1!==navigator.appVersion.indexOf('Linux'))return'linux/sbis3plugin-setup.sh'+i;if(-1!==navigator.appVersion.indexOf('Mac'))return'darwin/sbis3plugin-setup.pkg'+i;if(-1!==navigator.appVersion.indexOf('Win')&&t)return'win32/sbis3plugin-setup.exe'+i+'&FixForIE=.exe';}return'SbisPlugin.exe'+i+'&FixForIE=.exe';}return s()+u();}();return{isUseNewPlugin:t,sbisPluginPath:s};});define('js!SBIS3.Plugin/Source/Helper/Environment',['Core/core-extend','Core/Deferred','Core/constants','Core/moduleStubs','js!SBIS3.Plugin/components/SbisPluginLocalStorage','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Helper/EnvMixin/PluginMigrateMixin','browser!js!SBIS3.Plugin/Source/Helper/EnvMixin/SystemInfoMixin','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,o,r,i,t,n,s,l,a){'use strict';var u=function(){if(this._availableProtocols=[],this._defaultProtocol='',this.isUseNewPlugin)this._availableProtocols.push(s.protocolName.NEW_PROTOCOL),this._defaultProtocol=s.protocolName.NEW_PROTOCOL;else if(this.osType.isWindow)this._availableProtocols.push(s.protocolName.OLD_PROTOCOL),this._defaultProtocol=s.protocolName.OLD_PROTOCOL,this._availableProtocols.push(s.protocolName.NEW_PROTOCOL);};u.prototype.getAvailableProtocols=function(){return this._availableProtocols;},u.prototype.isProtocolAvailable=function(e){return this._availableProtocols.indexOf(e)>-1;},u.prototype.getDefaultProtocol=function(){return this._defaultProtocol;},u.prototype.setDefaultProtocol=function(e){this._defaultProtocol=e;},u.prototype.validateEnvironment=function(){if(this._isMobilePlatform())return new n(n.errorsType.INTERNAL_CLIENT_ERROR,n.detailTypes.IS_MOBILE);else if(!this._isOSAvailable())return new n(n.errorsType.INTERNAL_CLIENT_ERROR,n.detailTypes.UNSUPPORTED_PLATFORM);return null;},u.prototype.getConnectionMode=function(){return s.connectionMode.ONE_CONNECTION_BREAK;},u.prototype.isOnline=function(){if(location.hostname.match(/^([\S]+\.)*(sbis\.ru|tensor\.ru)$/gi))return o.success(true);if(window.hasOwnProperty('page'))return o.success(false);if(u.browserType.isSbis)return o.success(false);return i.require(['js!WS.Data/Source/SbisService']).addCallback(function(e){return new e({endpoint:'Retail'}).call('Online',{}).addCallback(function(e){return e.getScalar();});});},u.prototype._isMobilePlatform=function(){var e=t.getItem('SbisPlugin');if(e)if(e=JSON.parse(e),e.hasOwnProperty('isMobileCheck')&&!e.isMobileCheck)return false;return r.browser.isMobileIOS||r.browser.isMobileAndroid||r.browser.isWPMobilePlatform||r.browser.isMobileSafari;},u.prototype._isOSAvailable=function(){var e=t.getItem('SbisPlugin');if(e)if(e=JSON.parse(e),e.hasOwnProperty('isOSCheck')&&!e.isOSCheck)return true;if(navigator&&-1===navigator.appVersion.indexOf('Win')&&-1===navigator.appVersion.indexOf('Mac')&&-1===navigator.appVersion.indexOf('Linux'))return false;if((a.osType.isMac||a.osType.isLinux)&&!l.isUseNewPlugin)return false;return true;};var c=e.mixin(u,[l,a]);return c.prototype.isUseNewPlugin=l.isUseNewPlugin,c.prototype.sbisPluginPath=l.sbisPluginPath,c.prototype.browserType=a.browserType,c.prototype.osType=a.osType,new c();});define('js!SBIS3.Plugin/Source/Diagnostic',['Core/core-merge','Core/IoC','Core/core-instance','js!SBIS3.Plugin/components/SbisPluginLocalStorage','Core/moduleStubs','Core/Date','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,t,o,n,i){'use strict';var r=function(){return this||(0,eval)('this');}();r.SPDebug=function(){if(n)if(arguments.length){var e=!!arguments[0];if(n.setItem('SbisPluginServiceDebug',e),c)c._isDebugEnabled=e;}else return n.getItem('SbisPluginServiceDebug');},r.SPDiagnostic=function(){if(c)return c.getDiagnosticInfo();},r.SPRegularStack=function(){if(c)return c.getRegularStack();};var c,a=function(){this._isDebugEnabled=SPDebug(),this.isDebugLogEnabled=false,this._connectionInfo={},this._connectionAttempts=0,this._connectionReadyState=-1,this._diagnosticInfo={LocalService:{total:0,services:{}},ServiceManager:{services:{}},Connection:{}},this._regularStack=[];var e=n.getItem('SbisPlugin');if(e)e=JSON.parse(e),this.isDebugLogEnabled=e.isDebugLogEnabled||this.isDebugLogEnabled;};return a.prototype.info=function(e,o,n){var i=new Date(),c='['+i.strftime('%H:%M:%S:%J')+']'+' | INFO  | '+e+' (Method: '+o+')';if(this._regularStack.length>=100)this._regularStack.splice(0,1);if(this._regularStack.push({date:i,message:c+': '+n}),t.resolve('ILogger').info(c,n),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.info(c,n);},a.prototype.debug=function(e,o,n){if(this._isDebugEnabled){var i='['+new Date().strftime('%H:%M:%S:%J')+']'+' | DEBUG | '+e+' (Method: '+o+')';if(t.resolve('ILogger').log(i,n),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.log(i,n);}},a.prototype.error=function(e,n,i){var c=new Date(),a='['+c.strftime('%H:%M:%S:%J')+']'+' | ERROR | '+e+' (Method: '+n+')';if(this._regularStack.length>=100)this._regularStack.splice(0,1);if(i instanceof Error){if(o.instanceOfModule(i,'SBIS3.Plugin/Source/Error/SbisPluginError')){if(t.resolve('ILogger').log(a,i.message),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.log(a,i.message);}else if(t.resolve('ILogger').error(a,i.message,i),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.error(a,i.message,i);this._regularStack.push({date:c,message:a+': '+i.message});}else if(this._regularStack.push({date:c,message:a+': '+i}),t.resolve('ILogger').log(a,i),r.LocalService&&r.LocalService.logger&&r.LocalService.logger.log)r.LocalService.logger.log(a,i);},a.prototype.changeReadyState=function(e){this._connectionReadyState=e;},a.prototype.changeLocalServiceInfo=function(e){this._diagnosticInfo.LocalService.total++,this._diagnosticInfo.LocalService.services[e]?this._diagnosticInfo.LocalService.services[e]++:this._diagnosticInfo.LocalService.services[e]=1;},a.prototype.changeConnectionInfo=function(t){if(t)e(this._connectionInfo,t);},a.prototype.addConnectionAttempt=function(){this._connectionAttempts++;},a.prototype.getDiagnosticInfo=function(){var e=this;return i.require(['js!SBIS3.Plugin/Source/ServiceManager/ServiceManager']).addCallback(function(t){var o=t[0];e._diagnosticInfo.ServiceManager.services=o.getDiagnosticInfo();}),e._diagnosticInfo.Connection=e._connectionInfo,e._diagnosticInfo.Connection.readyState=e._connectionReadyState,e._diagnosticInfo.Connection.attempts=e._connectionAttempts,e._diagnosticInfo;},a.prototype.getReadyState=function(){return this._connectionReadyState;},a.prototype.isSbisPluginRunning=function(){return n.getItem('isPluginRunning')||false;},a.prototype.setRunningFlag=function(e){n.setItem('isPluginRunning',e);},a.prototype.getTransportName=function(){return this._connectionInfo.transport||null;},a.prototype.getRegularStack=function(){return this._regularStack.sort(function(e,t){return+e.date-+t.date;}),this._regularStack.map(function(e){return e.message;}).join('\n');},c=new a(),c;});define('js!SBIS3.Plugin/Source/Error/ParamsValidationError',['Core/core-extend','js!SBIS3.Plugin/Source/Error/SbisPluginError','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(N,_){'use strict';function O(N,_){_=_||O.detailStrings[N],this.type=O.errorsType.INTERNAL_CLIENT_ERROR,this.description=N,this.errorType=N,this.constructor.superclass.constructor.call(this,_);}return O.errorsType={INTERNAL_CLIENT_ERROR:'INTERNAL_CLIENT_ERROR'},O.detailTypes={UNKNOWN_FUNCTION:'UNKNOWN_FUNCTION',UNKNOWN_FUNCTION_RESULT:'UNKNOWN_FUNCTION_RESULT',UNKNOWN_FUNCTION_PARAMS:'UNKNOWN_FUNCTION_PARAMS',UNKNOWN_OBJECT_ID:'UNKNOWN_OBJECT_ID',UNKNOWN_RESPONSE_TYPE:'UNKNOWN_RESPONSE_TYPE',WRONG_ARGUMENTS_NUMBER:'WRONG_ARGUMENTS_NUMBER',WRONG_ARGUMENT_TYPE:'WRONG_ARGUMENT_TYPE',FUNCTION_NOT_FOUND:'FUNCTION_NOT_FOUND',AMBIGUOUS_MATCH_EXCEPTION:'AMBIGUOUS_MATCH_EXCEPTION'},O.detailStrings={UNKNOWN_FUNCTION:rk('Неизвестное название функции'),UNKNOWN_FUNCTION_RESULT:rk('Неизвестный результат функции'),UNKNOWN_FUNCTION_PARAMS:rk('Неизвестные параметры функции'),UNKNOWN_OBJECT_ID:rk('Неизвестный идентификатор объекта'),UNKNOWN_RESPONSE_TYPE:rk('Неизвестный тип ответа'),WRONG_ARGUMENTS_NUMBER:rk('Неверное количество аргументов'),WRONG_ARGUMENT_TYPE:rk('Неверный тип аргумента'),FUNCTION_NOT_FOUND:rk('Не найдена функция соотвествующая параметрам'),AMBIGUOUS_MATCH_EXCEPTION:rk('Двусмысленное представляение метода')},N.classicExtend(O,_),O;});define('js!SBIS3.Plugin/Source/Helper/SPCustomEvent',['SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(){'use strict';return{create:function(e,t){if(document.createEvent&&window.CustomEvent&&!window.opera){var n=document.createEvent('CustomEvent');if(n.initCustomEvent)n.initCustomEvent(e,false,false,t);else n=new CustomEvent(e,{bubbles:false,cancelable:false,detail:t});return n;}else return{type:e,bubbles:false,cancelable:false,detail:t};}};});define('js!SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin',['Core/EventBus','browser!js!SBIS3.Plugin/Source/Error/ParamsValidationError','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPCustomEvent','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,n,t,i){'use strict';return{_inspectEvents:function(r){if('call'===r.type||'event'===r.type){var a=r.answer||r.data;if(void 0===a)return;if(a.channelName){var s=a.channelName,o=a.eventName,u=a.data||[],c=e.channel('SbisPluginChannel');if('string'!==typeof s||'string'!==typeof o||s.length<=0||o.length<=0)return void t.error('SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin','_inspectEvents',new n(n.detailTypes.UNKNOWN_FUNCTION));if(t.debug('SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin','_inspectEvents','Вызов канала '+s+' с событием '+o),'SbisPluginChannel'===s&&c.hasEventHandlers(o))c.notify.apply(c,[o].concat(u));if(e.channel(s).notify.apply(e.channel(s),[o].concat(u)),t.isDebugLogEnabled)window.dispatchEvent(i.create('onSbisPluginLogEvent',{type:'event',datetime:new Date().toISOString(),channelName:s,eventName:o,data:u}));}return true;}return false;}};});define('js!SBIS3.Plugin/Source/ServiceManager/Service',['browser!js!SBIS3.Plugin/Source/Helper/Environment','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(t){'use strict';var o=function(t,o){var i=o.endpoint,n=i.address.split('-');this.guid=t,this._protocol=null,this.plugin=null,this.endpoint=i,this.name=n[0],this.version=n[1],this.options=o.options||{},this.customTimeout=o.options.queryTimeout,this.parentID=null,this.methodCount={},this.wasProtocolChanged=false,this.options.debug=this.options.debug||null;};return o.prototype.getProtocol=function(){var o=this._protocol;if(!o)o=t.getDefaultProtocol(),this.setProtocol(o);return o;},o.prototype.setProtocol=function(t){this._protocol=t;},o.prototype.setPlugin=function(t){return this.plugin=t;},o.prototype.isEndpointCorrect=function(){if(!this.endpoint||!this.endpoint.address)return false;var t=this.endpoint.address;if(!t)t='';if('string'!==typeof t)t=t.toString();var o=t.split('-');if(o.length>1)o={name:o[0],version:o[1]};return o.name&&o.version;},o;});define('js!SBIS3.Plugin/Source/Error/SpecialTypeError',['Core/core-extend','js!SBIS3.Plugin/Source/Error/SbisPluginError','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(r,E){function e(r,E,e){this.type=r,this.queryId=e,this.constructor.superclass.constructor.call(this,E);}return e.errorsType={PROVIDER_UNSUPPORTED:'PROVIDER_UNSUPPORTED',POOL_NOT_AVAILABLE:'POOL_NOT_AVAILABLE',TOKEN_NOT_VALID:'TOKEN_NOT_VALID',LOW_ACCESS_LEVEL:'LOW_ACCESS_LEVEL'},r.classicExtend(e,E),e;});define('js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionsConfig',['browser!js!SBIS3.Plugin/Source/Helper/SPConstants','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(o){'use strict';var r=function(){this._configs=[];};r.prototype.getTopPriorityProtocol=function(o){return o=this._compareProtocols(o),o[0];},r.prototype.addConfig=function(o){this._configs.push(o);},r.prototype.getConfigs=function(o){if(o)return this._configs.filter(function(r){return o.indexOf(r.protocol)>-1;});else return this._configs;},r.prototype.getConfigByProtocol=function(o){for(var r=0;r<this._configs.length;r++)if(this._configs[r].protocol===o)return this._configs[r];},r.prototype._sortConfigsByPriority=function(){var o=this._configs;o.sort(function(o,r){return o.priority-r.priority;}),o.forEach(function(o){o.availableTransports.sort(function(o,r){return o.priority-r.priority;});}),this._configs=o;},r.prototype._compareProtocols=function(o){var r=this;return o.sort(function(o,t){var i=r.getConfigByProtocol(o),n=r.getConfigByProtocol(t);return i.priority-n.priority;});};var t=new r();return t.addConfig({protocol:o.protocolName.NEW_PROTOCOL,host:'127.0.0.1',wsPort:8201,wssPort:9208,priority:2,availableTransports:[{name:o.transportName.WEBSOCKET,priority:1},{name:o.transportName.NMH,priority:2},{name:o.transportName.FLASH,priority:3}]}),t.addConfig({protocol:o.protocolName.OLD_PROTOCOL,host:'127.0.0.1',wsPort:8181,wssPort:8484,priority:1,availableTransports:[{name:o.transportName.WEBSOCKET,priority:1},{name:o.transportName.NMH,priority:2},{name:o.transportName.FLASH,priority:3}]}),t._sortConfigsByPriority(),t;});define('js!SBIS3.Plugin/Source/Transport/Connector',['js!WS.Data/Di','Core/Abstract','Core/Deferred','js!WS.Data/Entity/OptionsMixin','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,o,n,t,r,c){'use strict';var i=function(){return this||(0,eval)('this');}(),s='127.0.0.1',a='SBIS3.Plugin/Source/Transport/Connector',_=o.extend({_moduleName:a,_$debug:false,_$mode:null,_$port:null,_$transport:null,_$host:null,_webSocket:null,_connectorReadyDef:null,constructor:function(e){_.superclass.constructor.call(this,e),c.addConnectionAttempt(),this._connectorReadyDef=new n(),this._createConnection(),this._publish('onopen','onmessage','onerror','onclose');},send:function(e){var o=this;this._connectorReadyDef.addCallback(function(){if(o._webSocket)o._webSocket.send(e);else o.onerror(new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.CLOSE_CONNECTION));}).addErrback(function(e){o.onerror(e);});},setConfig:function(e){e.port=e.port||e[e.mode],t.constructor.call(this,e);},getConfig:function(){return t._getOptions.call(this);},getState:function(){if(this._webSocket)return this._webSocket.readyState;else return-1;},close:function(){if(this._webSocket)c.info(a,'close','Закрываем соединение, sessionId: '+this._webSocket.getId()+' порт '+this._$port),this._webSocket.close();},onopen:function(){},onmessage:function(){},onerror:function(){},onclose:function(){},_createConnection:function(){var e=this,o={},n=this._$mode,t=this._$port,i=this._$host,s=this._$transport;try{if(c.info(a,'_createConnection','Создаем соединение (режим: '+n+' порт '+t+')'),o=new s(n+'://'+i+':'+t),o.isBlocked)return void setTimeout(function(){c.error(a,'_createConnection','Невозможно установить соединение, (режим: '+n+' порт '+t+')');var o=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.UNABLE_TO_CONNECT);if(!e._connectorReadyDef.isReady())e._connectorReadyDef.errback(o);e.onerror(o);},0);c.info(a,'_createConnection','Устанавливаем таймаут подключения, (режим: '+n+' порт '+t+')');var _=setTimeout(function(){c.info(a,'_createConnection','Не удалось подключиться за отведенное время. Ручное закрытие соединения, (режим: '+n+' порт '+t+')'),o.onclose();},20000);o.onopen=function(){if(clearTimeout(_),c.info(a,'_createConnection','Соединение установлено, sessionId: '+o.getId()+' порт '+t),e._webSocket=o,!e._connectorReadyDef.isReady())e._connectorReadyDef.callback();e.onopen();},o.onmessage=function(o){e.onmessage(o.data);},o.onerror=function(n){var t=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.CLOSE_CONNECTION);if(c.info(a,'_createConnection','onerror::sessionId: '+o.getId()+', error: '+t.message),!e._connectorReadyDef.isReady())e._connectorReadyDef.errback(t);e.onerror(t);},o.onclose=function(){var n=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.UNABLE_TO_CONNECT);if(clearTimeout(_),c.info(a,'_createConnection','Соединение закрыто, sessionId: '+o.getId()+', порт '+t),e._webSocket)e._webSocket.close();if(!e._connectorReadyDef.isReady())e._connectorReadyDef.errback(n);e.onclose(n);};}catch(o){c.error(a,'_createConnection','Невозможно установить соединение, порт '+t);var f=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.UNABLE_TO_CONNECT);if(!e._connectorReadyDef.isReady())e._connectorReadyDef.errback(f);e.onerror(f);}}});return e.register(a,_,{single:true}),_;});define('js!SBIS3.Plugin/Source/Transport/Initializer',['Core/moduleStubs','Core/Deferred','Core/ParallelDeferred','js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Transport/Connector','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Helper/Environment','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(r,e,n,o,t,a,i,s){'use strict';var c=19,u='ws',l='wss',f=location.protocol.match('https')?l:u,p=new o(o.errorsType.INTERNAL_CLIENT_ERROR,o.detailTypes.CERTIFICATE_NOT_INSTALLED),d='SBIS3.Plugin/Source/Transport/TransportSelecting/InitializerNew',b={};b[i.transportName.WEBSOCKET]={canExec:function(){return'undefined'!=typeof WebSocket;},verify:function(n,o,s,c){var l=new e();return r.require([i.transportName.WEBSOCKET]).addCallback(function(r){var e=r[0],f=n===u?s:c;a.changeConnectionInfo({transport:i.transportName.WEBSOCKET,mode:n,port:f});var p=new t({mode:n,host:o,port:f,transport:e});p.onopen=function(){!l.isReady()&&l.callback(p);},p.onerror=function(r){!l.isReady()&&l.errback(r);},p.onclose=function(r){!l.isReady()&&l.errback(r);};}).addErrback(function(){l.errback(p);}),l;}},b[i.transportName.FLASH]={canExec:function(){var r=navigator.userAgent,e,n;if(s.browserType.isChrome)e=55,n=/Chrome[\/\s](\d+\.\d+)/;else if(s.browserType.isFirefox)e=55,n=/Firefox[\/\s](\d+\.\d+)/;if(e){var o=r.match(n);return(o&&o[1])<e;}else return true;},verify:function(n,l,f,d){return r.require(['browser!js!SBIS3.Plugin/Source/Transport/resources/SwfObject']).addCallback(function(n){var d=n[0],b=new e();if(0===d().getFlashPlayerVersion().major)b.errback(p);else if(d().getFlashPlayerVersion().major<c)if(s.browserType.isEdge||s.browserType.isOpera||s.browserType.isYandex)b.errback(new o(o.errorsType.INTERNAL_CLIENT_ERROR,o.detailTypes.OLD_FLASH_PLAYER));else b.errback(p);else r.require([i.transportName.FLASH]).addCallback(function(r){var e=r[0];a.changeConnectionInfo({transport:i.transportName.FLASH,mode:u,port:f}),function(){return this||(0,eval)('this');}().SbisPluginTransport=e,e.initialize(function(r){if(r.success){var n=new t({mode:u,host:l,port:f,transport:e});n.onopen=function(){!b.isReady()&&b.callback(n);},n.onerror=function(r){!b.isReady()&&b.errback(r);},n.onclose=function(r){!b.isReady()&&b.errback(r);};}else b.errback(p);});}).addErrback(function(){b.errback(p);});return b;});}},b[i.transportName.NMH]={canExec:function(){return s.browserType.isChrome||s.browserType.isAmigo||s.browserType.isFirefox;},verify:function(n,s,c,l){return r.require([i.transportName.NMH]).addCallback(function(r){var n=r[0],l=new e();return a.changeConnectionInfo({transport:i.transportName.NMH,mode:u,port:c}),n.initialize(function(r){if(r.success){var e=new t({mode:u,host:s,port:c,transport:n});e.onopen=function(){!l.isReady()&&l.callback(e);},e.onerror=function(r){!l.isReady()&&l.errback(r);},e.onclose=function(r){!l.isReady()&&l.errback(r);};}else l.errback(new o(o.errorsType.INTERNAL_CLIENT_ERROR,o.detailTypes.NMH));}),l;});}};var S=function(){};return S.initializeConnection=function(r){var t=r.host,s=r.wsPort,c=r.wssPort,u=r.protocol,l=r.availableTransports,p=new n({maxRunningCount:1,stopOnFirstError:false}),S=new e();return l=l.filter(function(r){var e=r.name,n=b.hasOwnProperty(e)&&b[e].canExec();if(n)a.info(d,'initializeConnection','Транспорт '+e+' доступен для подключения по протоколу '+i.shortProtocolName[u]);return n;}),l.forEach(function(r){p.push(function(){var n=r.name;if(!S.isReady())return a.info(d,'initializeConnection','Попытка поключения через '+n+' по протоколу '+i.shortProtocolName[u]),b[n].verify(f,t,s,c).addCallback(function(r){a.info(d,'initializeConnection','Выбран транспорт '+n+' для подключения по протоколу '+i.shortProtocolName[u]),a.changeConnectionInfo({transport:n,mode:r._$mode,port:r._$port}),S.callback(r);});else return e.success();});}),p.done().getResult().addCallback(function(r){if(!S.isReady()){a.error(d,'initializeConnection','Не удалось подключиться ни по одному транспорту по протоколу '+i.shortProtocolName[u]);var e=[];for(var n in r)if(r.hasOwnProperty(n)){var t=r[n];if(t instanceof Error&&!(t instanceof o))throw t;e[n]=t;}S.errback(o.getTopPriorityError(e));}}),S;},S;});define('js!SBIS3.Plugin/Source/Transport/ConnectionManager/Connection',['Core/Deferred','Core/core-clone','browser!js!SBIS3.Plugin/Source/Transport/Initializer','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Transport/Connector','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,n,o,r,t,i,c){'use strict';var a='SBIS3.Plugin/Source/Transport/ConnectionManager/Connection',s=function(e){this._readyDef=null,this._connector=null,this._initialize(n(e));};return s.prototype.isReady=function(){return this._readyDef.createDependent();},s.prototype.send=function(e){var n=this;return n.isReady().addCallback(function(){return n._connector.send(e);});},s.prototype.close=function(){var e=this;return e.isReady().addCallback(function(){return e._connector.close();});},s.prototype.onopen=function(){},s.prototype.onmessage=function(){},s.prototype.onerror=function(){},s.prototype.onclose=function(){},s.prototype._onOpen=function(){this.onopen();},s.prototype._onMessage=function(e){this.onmessage(e);},s.prototype._onError=function(e){this.onerror(e);},s.prototype._onClose=function(e){this.onclose(e);},s.prototype._initialize=function(n){var c=this;if(!c._readyDef)r.debug(a,'_initialize','Инициализация соединения по протоколу '+t.shortProtocolName[n.protocol]),c._readyDef=o.initializeConnection(n).addCallback(function(s){var l=new e(),u=c._killTimerRun(s,l),p=function(e){return t.shortProtocolName[n.protocol]+' (режим: '+e._$mode+' порт: '+e._$port+')';},f=function(e){if(u){var n;if(e=JSON.parse(e),'call'===e.type||'event'===e.type)if(n=e.answer||e.data,'connected'===n.eventName)y(l);else if('needReconnect'===n.eventName)C(l,n.data);}},d=function(){clearTimeout(u),u=null;var e=new i(i.errorsType.INTERNAL_CLIENT_ERROR,i.detailTypes.CLOSE_CONNECTION);!l.isReady()&&l.errback(e);},_=function(){clearTimeout(u),u=null;var e=new i(i.errorsType.INTERNAL_CLIENT_ERROR,i.detailTypes.UNABLE_TO_CONNECT);!l.isReady()&&l.errback(e);},y=function(e){r.info(a,'_initialize','Перехвачено событие "connected" для соединения по протоколу '+p(s)),e.callback(),c._onOpen();},C=function(e,t){if(r.info(a,'_initialize','Перехвачено событие "needReconnect" для соединения по протоколу '+p(s)),!t.hasOwnProperty('Port'))return void r.info(a,'_initialize','Порт переподключения не указан '+p(s));clearTimeout(u);var i=parseInt(t.Port,10),l=s.getConfig();if(i!==l.port){if(n.wsPort===l.port)n.wsPort=i;else if(n.wssPort===l.port)n.wssPort=i;c._closeConnectorSilently(s),o.initializeConnection(n).addCallback(function(e){(s=e).onmessage=f,s.onerror=d,s.onclose=_;}),u=c._killTimerRun(s,e),r.info(a,'_initialize','Переподключаемся к порту '+i+' для соединения по протоколу '+p(s));}else r.info(a,'_initialize','Остаемся на порту '+i+' для соединения по протоколу '+p(s)),e.callback();};return l.addCallback(function(){clearTimeout(u),u=null,c._connector=s,c._connector.onmessage=c._onMessage.bind(c),c._connector.onerror=c._onError.bind(c),c._connector.onclose=c._onClose.bind(c),r.changeConnectionInfo({mode:s._$mode,port:s._$port});}).addErrback(function(e){return r.info(a,'_initialize','События "connected" и "needReconnect" не были перехвачены для соединения по протоколу '+p(s)),s.close(),e;}),s.onmessage=f,s.onerror=d,s.onclose=_,l;});},s.prototype._closeConnectorSilently=function(e){var n=function(){};e.onmessage=n,e.onerror=n,e.onclose=n,e.close();},s.prototype._killTimerRun=function(e,n){return setTimeout(function(){if(e.getState()===t.readyState.OPEN)n.callback();else if(!n.isReady()){var o=new i(i.errorsType.UNABLE_TO_CONNECT,i.errorsType.UNABLE_TO_CONNECT,'isReady(): события connected и needReconnect не пришли');n.errback(o);}},10000);},s;});define('js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionManager',['Core/Deferred','Core/ParallelDeferred','Core/EventBus','browser!js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionsConfig','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Helper/Environment','browser!js!SBIS3.Plugin/Source/Transport/ConnectionManager/Connection','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(n,o,e,t,r,i,a,c,s){'use strict';var u='SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionManager',l=function(){this._connectionManagerChannel=e.channel(c.eventBusChannel.ConnectionManager),this._connections={},this._warmUpDef=this._warmUp();};return l.prototype.isConnectionReady=function(n){var o=this;return this.onWarmUpReady().addBoth(function(){var e=i.getConnectionMode();if(!n&&e===c.connectionMode.ONE_CONNECTION_BREAK||e===c.connectionMode.ONE_CONNECTION_SERIAL)n=i.getDefaultProtocol();return o._getConnection(n);});},l.prototype.onWarmUpReady=function(){if(!this._warmUpDef||this._warmUpDef&&this._warmUpDef.isReady()&&!this._warmUpDef.isSuccessful())this._warmUpDef=this._warmUp();return this._warmUpDef.createDependent();},l.prototype.send=function(n,o){return this.isConnectionReady(o).addCallback(function(o){return s.debug(u,'send','Отправка сообщения: '+n),o.send(n);});},l.prototype._onOpen=function(n){s.info(u,'_onOpen','Открыто соединение по протоколу '+c.shortProtocolName[n]),this._connectionManagerChannel.notify('onopen',n);},l.prototype._onMessage=function(n,o){s.debug(u,'_onMessage','Получено сообщение: '+o),this._connectionManagerChannel.notify('onmessage',o);},l.prototype._onError=function(n,o){this._removeConnection(n),this._connectionManagerChannel.notify('onerror',n,o);},l.prototype._onClose=function(n,o){if(s.info(u,'_onClose','Закрыто соединение по протоколу '+c.shortProtocolName[n]),s.changeReadyState(c.readyState.CLOSED),this._removeConnection(n),this._warmUpDef&&this._warmUpDef.isReady())this._warmUpDef=null;this._connectionManagerChannel.notify('onclose',null,o);},l.prototype._warmUp=function(){var o=this,e=i.getAvailableProtocols(),a=t.getConfigs(e);s.changeReadyState(c.readyState.UNKNOWN);var l=i.validateEnvironment();if(l instanceof Error)return n.fail(l);return s.debug(u,'_warmUp','Запуск прогрева соединений'),this._serialConnection(a).addCallback(function(n){s.changeReadyState(c.readyState.CONNECTING);var e=Object.keys(o._connections),a;if(e.length){a=t.getTopPriorityProtocol(e);for(var l in o._connections){if(!o._connections.hasOwnProperty(l))continue;if(l!==a)o._removeConnection(l);else s.info(u,'_warmUp','Выбрано приоритетное подключение '+c.shortProtocolName[l]),o._setPublicHandlersForConnection(l),s.changeReadyState(c.readyState.OPEN),s.setRunningFlag(true);}i.setDefaultProtocol(a);}else{s.changeReadyState(c.readyState.CLOSED),s.setRunningFlag(false);var f=[],_;for(var h in n){if(!n.hasOwnProperty(h))continue;var p=n[h];if(p instanceof r)f.push(p);}return _=r.getTopPriorityError(f),_||new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.CERTIFICATE_NOT_INSTALLED);}}).addErrback(function(n){return s.error(u,'_warmUp',n),n;});},l.prototype._serialConnection=function(e){var t=this,r=new o({maxRunningCount:1,stopOnFirstError:false}),a=i.getConnectionMode()===c.connectionMode.ONE_CONNECTION_BREAK,l;return s.debug(u,'_serialConnection','Прогрев через последовательное подключение'+a?' с остановкой на первом успешном':''),e.forEach(function(o){r.push(function(){if(a&&l)return n.success();return t._getConnection(o).addCallback(function(n){if(a)l=true;return n;});});}),r.done().getResult();},l.prototype._getConnection=function(o){if(o&&'string'===typeof o)o=t.getConfigByProtocol(o);var e=this,r=o.protocol,i=new n();if(this._hasConnection(r))i.callback(this._connections[r]);else{s.info(u,'_getConnection','Создаем подключение по протоколу '+c.shortProtocolName[r]);var l=new a(o);this._addConnection(r,l),l.isReady().addCallback(function(){i.callback(l);}).addErrback(function(n){s.error(u,'_getConnection','Не удалось создать подключение по протоколу '+c.shortProtocolName[r]),e._removeConnection(r),i.errback(n);});}return i;},l.prototype._addConnection=function(n,o){this._connections[n]=o;},l.prototype._removeConnection=function(n){if(this._connections.hasOwnProperty(n))s.debug(u,'_removeConnection','Удаляем подключение по протоколу '+c.shortProtocolName[n]),this._connections[n].close(),delete this._connections[n];},l.prototype._hasConnection=function(n){return this._connections[n];},l.prototype._setPublicHandlersForConnection=function(n){var o=this._connections[n];if(o)o.onopen=this._onOpen.bind(this,n),o.onmessage=this._onMessage.bind(this,n),o.onerror=this._onError.bind(this,n),o.onclose=this._onClose.bind(this,n);},new l();});define('js!SBIS3.Plugin/Source/Helper/UserDataManager',['Core/constants','js!SBIS3.Plugin/components/SbisPluginLocalStorage','Core/cookie','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,n,t){'use strict';var r={getAccountId:function(){if(e.isBrowserPlatform){var n='',o='';try{if(userInfo&&userInfo.hasOwnProperty('ИдентификаторПользователя')){if(!userInfo['ИдентификаторПользователя'])throw new Error('userID not found');var s=userInfo['ИдентификаторПользователя'].toString(16);n=r._padStr(s,8,'0');}else throw new Error('userInfo not found');}catch(e){if(o=t.get('s3su'),o)n=o.split('-')[1];}return n?n+'@'+location.host:'';}},wasPluginInstalled:function(){var e=1000*60*60*24*3,t=+new Date()-e;return n.getItem('lastSPTime')>t;},updatePluginRunTime:function(){n.setItem('lastSPTime',+new Date());},_padStr:function(e,n,t){if(n>>=0,t=t||' ',e.length>n)return e;else{if(n-=e.length,n>t.length)for(var r=n/t.length,o=1;o<r;o++)t+=t;return t.slice(0,n)+e;}}};return r;});define('js!SBIS3.Plugin/Source/Transport/ConnectionManager/Ping',['js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionManager','Core/EventBus','Core/Deferred','js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Helper/UserDataManager','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,n,t,i,o,s){'use strict';var r=5000,a=60*r,u=6*a,l=60000,g=function(){this._userPingInterval=null,this._autoPingInterval=null,this._autoPingIntervalFixIncrease=null,this._pingChannel=n.channel(o.eventBusChannel.Ping),this._connectionManagerChannel=n.channel(o.eventBusChannel.ConnectionManager),this._connectionManagerChannel.subscribe('onopen',this._onConnectionManagerOpen.bind(this)),this._connectionManagerChannel.subscribe('onclose',this._onConnectionManagerClose.bind(this)),this._lastRunningResult=void 0;};return g.prototype.setLongPeriod=function(e){g.period.LONG_PERIOD=e;},g.prototype.restoreLongPeriod=function(){g.period.LONG_PERIOD=60*g.period.SHORT_PERIOD;},g.prototype.getRunningState=function(){return this.getLastRunningResult().addBoth(function(){return i.isSbisPluginRunning();});},g.prototype.getLastRunningResult=function(){if(void 0===this._lastRunningResult){var n=this;return e.onWarmUpReady().addCallback(function(){return n._lastRunningResult=true,n.restoreLongPeriod(),n._pingChannel.notify('onReady'),n._lastRunningResult;}).addErrback(function(e){if(n._lastRunningResult=e,s.wasPluginInstalled())n.startAutoWithFixedIncrease(2*g.period.SHORT_PERIOD);else n.startAuto(g.period.LONG_PERIOD);return n._lastRunningResult;});}else return t.success(i.isSbisPluginRunning()||this._lastRunningResult);},g.prototype.start=function(e){if(!this._userPingInterval)this._userPingInterval=this._getTimeout(e,{mode:g.pingMode.Fixed});},g.prototype.startAuto=function(e){if(!this._autoPingInterval){if(e>u)e=u;this._autoPingInterval=this._getTimeout(e,{mode:g.pingMode.MultipleIncrease,increaseValue:2});}},g.prototype.startAutoWithFixedIncrease=function(e){if(!this._autoPingIntervalFixIncrease)if(e>l)this.stopAutoWithFixedIncrease(),this.startAuto(g.period.LONG_PERIOD);else this._autoPingIntervalFixIncrease=this._getTimeout(e,{mode:g.pingMode.FixedIncrease,increaseValue:g.period.SHORT_PERIOD});},g.prototype.stop=function(){if(this._userPingInterval)clearTimeout(this._userPingInterval);this._userPingInterval=null;},g.prototype.stopAuto=function(){if(this._autoPingInterval)clearTimeout(this._autoPingInterval);this._autoPingInterval=null;},g.prototype.stopAutoWithFixedIncrease=function(){if(this._autoPingIntervalFixIncrease)clearTimeout(this._autoPingIntervalFixIncrease);this._autoPingIntervalFixIncrease=null;},g.prototype._getTimeout=function(n,t){var o=this,s=t&&t.mode;return s=s||g.pingMode.Fixed,n=n||g.period.SHORT_PERIOD,setTimeout(function(){i.debug('SBIS3.Plugin/Source/Transport/ConnectionManager/Ping','start',' > PING(mode: '+s+', increaseValue: '+t.increaseValue+'): '+n+' ms.'),e.onWarmUpReady().addCallback(function(){if(o._lastRunningResult=true,o.restoreLongPeriod(),o._pingChannel.notify('onReady'),s===g.pingMode.Fixed)o.stop();else if(s===g.pingMode.MultipleIncrease)o.stopAuto();else if(s===g.pingMode.FixedIncrease)o.stopAutoWithFixedIncrease();}).addErrback(function(e){if(o._lastRunningResult=e,s===g.pingMode.Fixed)o.stop(),o.start(n);else if(s===g.pingMode.MultipleIncrease)o.stopAuto(),o.startAuto(n*(t.increaseValue||2));else if(s===g.pingMode.FixedIncrease)o.stopAutoWithFixedIncrease(),o.startAutoWithFixedIncrease(n+t.increaseValue);});},n);},g.prototype._onConnectionManagerOpen=function(){this._lastRunningResult=true,this.restoreLongPeriod(),s.updatePluginRunTime();},g.prototype._onConnectionManagerClose=function(e,n,t){if(this._lastRunningResult=t,s.wasPluginInstalled())this.startAutoWithFixedIncrease(2*g.period.SHORT_PERIOD);else this.startAuto(g.period.LONG_PERIOD);},g.period={SHORT_PERIOD:r,LONG_PERIOD:a},g.pingMode={Fixed:1,MultipleIncrease:2,FixedIncrease:3},new g();});define('js!SBIS3.Plugin/Source/ServiceManager/ServiceManager',['Core/EventBus','Core/moduleStubs','Core/Deferred','Core/IoC','browser!js!SBIS3.Plugin/Source/ServiceManager/Service','browser!js!SBIS3.Plugin/Source/Error/SpecialTypeError','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','js!SBIS3.Plugin/Source/Transport/ConnectionManager/Ping','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,n,i,t,o,s,c,a,u,v){'use strict';var h=function(){this._services={},this._isSubscribedOnUpdateEvent=false,this._coreService=null,this._sbisPluginEvent=e.channel(s.eventBusChannel.SbisPluginEvent),this._specialTypesEventBus=e.channel(s.eventBusChannel.SpecialErrors),this._connectionManagerChannel=e.channel(s.eventBusChannel.ConnectionManager),this._serviceManagerChannel=e.channel(s.eventBusChannel.ServiceManager,{strictMode:true}),this._serviceManagerChannel.publish('onopen','onerror','onclose'),this._connectionManagerChannel.subscribe('onopen',this._onConnectionManagerOpen.bind(this)),this._connectionManagerChannel.subscribe('onerror',this._onConnectionManagerError.bind(this)),this._connectionManagerChannel.subscribe('onclose',this._onConnectionManagerClose.bind(this)),this._specialTypesEventBus.subscribe(o.errorsType.PROVIDER_UNSUPPORTED,this._onProviderUnsupported.bind(this)),this._sbisPluginEvent.subscribe('extensionUnloaded',this._onExtensionUnloaded.bind(this)),this._sbisPluginEvent.subscribe('updateStarted',this._onUpdateStarted.bind(this)),a.subscribeOnProgress(this._sbisPluginEvent);};return h.prototype.addService=function(e,r){if(!this.hasService(e))this._checkInCreatedServices(r.endpoint),this._services[e]=new t(e,r);},h.prototype.isServiceReady=function(e){if(!this.hasService(e))return n.fail(new u(u.errorsType.INTERACTION_ERROR,u.detailTypes.COMMUNICATION_ERROR,u.detailStrings.SEND_AFTER_CLOSE_CONNECTION));var i=this.getService(e),t=i.getProtocol();if(!i.isEndpointCorrect())return n.fail(new u(u.errorsType.INTERACTION_ERROR,u.detailTypes.PLUGIN_NOT_INIT,u.detailStrings.BAD_ENDPOINT_REQUEST));if(t===s.protocolName.OLD_PROTOCOL)return r.require(['js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport']).addCallback(function(r){return r[0]._initExtension(e);});return n.success();},h.prototype.getObjectId=function(e){if(this.hasService(e)){var r=this.getService(e).plugin;return r&&r.objectID||null;}else return null;},h.prototype.getService=function(e){return this._services[e];},h.prototype.getDiagnosticInfo=function(){var e={};for(var r in this._services){if(!this._services.hasOwnProperty(r))continue;var n=this._services[r];e[r]={guid:n.guid,config:{endpoint:n.endpoint,options:n.options},methodCount:n.methodCount,protocol:n.getProtocol(),wasProtocolChanged:n.wasProtocolChanged,parentID:n.parentID,plugin:n.plugin};}return e;},h.prototype.getState=function(e){if(!this.hasService(e))return s.readyState.CLOSED;else return c.getReadyState();},h.prototype.hasService=function(e){return this._services.hasOwnProperty(e);},h.prototype.removeService=function(e){if(this.hasService(e)){for(var r in this._services)if(this._services[r].parentID===e)this.removeService(r);delete this._services[e],this._serviceManagerChannel.notify('onclose',e);}},h.prototype.removeAllServices=function(e,r){for(var n in this._services){if(!this._services.hasOwnProperty(n))continue;if(e){if(this.getService(n).getProtocol()===e){if(r)this._serviceManagerChannel.notify('onerror',n,r);this.removeService(n);}}else{if(r)this._serviceManagerChannel.notify('onerror',n,r);this.removeService(n);}}},h.prototype.setQueryTimeout=function(e,r){if(this.hasService(e)&&r)this.getService(e).customTimeout=r;},h.prototype._checkInCreatedServices=function(e){var r=0;if(Object.keys(this._services).length<s.maxDuplicateServiceCount)return;for(var n in this._services){if(!this._services.hasOwnProperty(n))continue;if(this._services[n].endpoint.address===e.address)r++;}if(r>=s.maxDuplicateServiceCount)i.resolve('ILogger').warn('SBIS3.Plugin/Source/ServiceManager/ServiceManager','Потенциальная утечка памяти. На странице уже создано '+s.maxDuplicateServiceCount+' или более экземпляров LocalService с endpoint.address == '+e.address+'. Убедитесь, что для невостребованных сервисов вызывается destroy');},h.prototype._onExtensionUnloaded=function(e,r){if(!r.hasOwnProperty('Guid'))return void c.error('SBIS3.Plugin/Source/ServiceManager/ServiceManager','_onExtensionUnloaded','Не указан идентификатор объекта');var n=r.Guid;c.debug('SBIS3.Plugin/Source/ServiceManager/ServiceManager','_onExtensionUnloaded','Удаляем сервис из обработки: objectId='+n);for(var i in this._services)if(this._services.hasOwnProperty(i))if(this.getObjectId(i)===n)this.removeService(i);},h.prototype._onUpdateStarted=function(){v.setLongPeriod(30000);},h.prototype._onProviderUnsupported=function(e,r){var n=this.getService(r);n.wasProtocolChanged=true,n.setProtocol(s.protocolName.OLD_PROTOCOL);},h.prototype._onConnectionManagerOpen=function(){for(var e in this._services){if(!this._services.hasOwnProperty(e))continue;this._serviceManagerChannel.notify('onopen',e);}},h.prototype._onConnectionManagerError=function(e,r,n){this._isSubscribedOnUpdateEvent=false,this._coreService=null,this.removeAllServices(r,n);},h.prototype._onConnectionManagerClose=function(e,r){this._isSubscribedOnUpdateEvent=false,this._coreService=null,this.removeAllServices(r);},h.prototype._subscribeToUpdateEvent=function(){if(!this._isSubscribedOnUpdateEvent&&!this._coreService){this._isSubscribedOnUpdateEvent=true;var e=this;r.require(['browser!js!SBIS3.Plugin/Source/LocalService']).addCallback(function(r){var n=r[0];e._coreService=new n({endpoint:{address:'CoreService-1.0.0.0',contract:'CoreService'},options:{mode:s.showModes.SILENT}}),e._coreService.call('SubscribeToUpdateEvent',{}).addErrback(function(){e._isSubscribedOnUpdateEvent=false,e._coreService.destroy(),e._coreService=null;});});}},new h();});define('js!SBIS3.Plugin/Source/Helper/ExecutionTimeout',['Core/Deferred','js!SBIS3.Plugin/Source/Error/ConnectionError','js!SBIS3.Plugin/Source/Helper/SPConstants','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,t){'use strict';return{setMethodExecutionTimeout:function(n,i,u){var o=new e(),a=function(){if(!o.isReady()){var e=new r(r.errorsType.INTERNAL_CLIENT_ERROR,r.detailTypes.COMMUNICATION_ERROR,r.detailStrings.NO_RESPONSE_DURING+' ('+a.time/1000+' сек.) method description: '+u);o.errback(e);}},c=setTimeout(a,i||t.defaultQueryTimeout);return a.time=i||t.defaultQueryTimeout,n.addCallback(function(e){return!o.isReady()&&o.callback(e),e;}).addErrback(function(e){return!o.isReady()&&o.errback(e),e;}).addBoth(function(e){return clearTimeout(c),e;}),o;}};});define('js!SBIS3.Plugin/Source/QueryManager/Query',['js!SBIS3.Plugin/Source/Helper/SPConstants','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(t){'use strict';var e=function(t,e,i){this.deferred=i,this.queryId=t.queryID||t.queryId,this._timeoutHandler=null,this._timeout=null,this.serviceGuid=e,this.info=t.info,this.options=t.options,this._data=t.data;};return e.prototype.getDataString=function(){return JSON.stringify(this._data);},e.prototype.success=function(t){if(!this.deferred.isReady())this.deferred.callback(t);},e.prototype.fail=function(t){if(!this.deferred.isReady())this.deferred.errback(t);},e.prototype.getWaitingTime=function(){return this._timeoutHandler.time;},e.prototype.extendWaitingTime=function(t){this.clearTimeout(),this._timeoutHandler.originalTimeout=this._timeoutHandler.time,this._timeoutHandler.time=t;var e=setTimeout(this._timeoutHandler,this._timeoutHandler.time);this.setTimeout(e);},e.prototype.returnWaitingTime=function(){this.clearTimeout(),this._timeoutHandler.time=this._timeoutHandler.originalTimeout?this._timeoutHandler.originalTimeout:this._timeoutHandler.time?this._timeoutHandler.time:e._queryTimeout;var t=setTimeout(this._timeoutHandler,this._timeoutHandler.time);this.setTimeout(t);},e.prototype.setTimeout=function(t,e){if(t)this._timeout=t;if(e)this._timeoutHandler=e;},e.prototype.clearTimeout=function(){clearTimeout(this._timeout);},e._queryTimeout=t.defaultQueryTimeout,e;});define('js!SBIS3.Plugin/components/SbisPluginLocalStorageTemporary',['Lib/Storage/LocalStorage','Core/constants','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,n){if(n.isBrowserPlatform){var t=new e(),o=(t.getItem('ws-store-always-keys')||[]).filter(function(e){return'SBIS3.Plugin/SbisPluginToken'!==e;});t.setItem('ws-store-always-keys',o);}return new e('SBIS3.Plugin');});define('js!SBIS3.Plugin/Source/Authenticate',['js!WS.Data/Source/SbisService','js!SBIS3.Plugin/components/SbisPluginLocalStorageTemporary','js!SBIS3.Plugin/Source/Helper/UserDataManager','Core/Deferred','Core/IoC','Core/helpers/generate-helpers','Core/moduleStubs','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,n,t,o,i,u){'use strict';return{_defAuth:null,getClientId:function(){var e=r.getItem('SbisPluginClientId');if(!e)e=i.createGUID(),r.setItem('SbisPluginClientId',e);return e;},getTokenKey:function(){var e='SbisPluginToken',r=n.getAccountId();if(''!==r)e+='-'+r;return e;},getToken:function(){return r.getItem(this.getTokenKey());},setToken:function(e){r.setItem(this.getTokenKey(),e);},removeToken:function(){r.removeItem(this.getTokenKey());},prepareToken:function(){var e=this,r=new t(),n=this.getToken();if(n)r.callback(n);else{if(this._defAuth)return this._defAuth;this._defAuth=r,r.addErrback(function(r){return e._defAuth=null,r;}),this.getAccessTokenOnline(r);}return r;},getAccessTokenOnline:function(r){var n=this;this._getManagersForQuery().addCallback(function(t){var u=t[0],c=t[1],s=i.createGUID(),a=n.getClientId();u.addService(s,{endpoint:{address:'CoreService-1.0.0.0',contract:'CoreService'},options:{}}),c.call(s,'getHardwareId',{version:'1.0'}).addCallbacks(function(t){new e({endpoint:'САП',provider:'source.provider.sbis-business-logic'}).call('RegisterHttpClient',{HttpClientID:a,PluginID:t}).addCallbacks(function(){c.call(s,'getAccessTokenOnline',{clientId:a,domain:location.host,hwVersion:'1.0'}).addCallbacks(function(e){return n.setToken(e),u.removeService(s),r.callback(e),n._defAuth=null,e;},function(e){return o.resolve('ILogger').log('SBIS3.Plugin/Source/Authenticate.requestToken.getAccessTokenOnline','Error: '+e.message),r.errback(e),e;});},function(e){return o.resolve('ILogger').log('SBIS3.Plugin/Source/Authenticate.requestToken.RegisterHttpClient','Error: '+e.message),r.errback(e),e;});},function(e){return o.resolve('ILogger').log('SBIS3.Plugin/Source/Authenticate.requestToken.getHardwareId','Error: '+e.message),r.errback(e),e;});}).addErrback(function(e){o.resolve('ILogger').log('SBIS3.Plugin/Source/Authenticate.getAccessTokenOnline._getManagersForQuery','Error: '+e.message),r.errback(e);});},_getManagersForQuery:function(){return u.require(['js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','js!SBIS3.Plugin/Source/QueryManager/QueryManager']);}};});define('js!SBIS3.Plugin/Source/QueryManager/Mixin/SpecialTypesMixin',['Core/Deferred','Core/EventBus','browser!js!SBIS3.Plugin/Source/Error/SpecialTypeError','browser!js!SBIS3.Plugin/Source/Authenticate','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Helper/Environment','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,n,t,s,o,i){'use strict';return{_inspectSpecialTypes:function(p){var E=this,T=new e(),a,S,R,_;if(!(p instanceof n))return T.errback(p);if(a=p.queryId,S=this.getQuery(a),p.type===n.errorsType.PROVIDER_UNSUPPORTED){if(i.osType.isMac||i.osType.isLinux)return R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.PLUGIN_NOT_INIT),T.errback(R);r.channel(o.eventBusChannel.SpecialErrors).notify(n.errorsType.PROVIDER_UNSUPPORTED,S.serviceGuid),T.dependOn(this.repeatQuery(S));}else if(p.type===n.errorsType.POOL_NOT_AVAILABLE)return R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.PLUGIN_NOT_INIT),T.errback(R);else if(p.type===n.errorsType.LOW_ACCESS_LEVEL){var u=t.getToken();if(u&&''!==u&&S._data.accessToken&&''!==S._data.accessToken)return _=s.detailStrings.NO_RIGHTS_FOR_EXECUTE+' (Метод: '+S.info.method+')',R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.NO_RIGHTS_FOR_EXECUTE,_),T.errback(R),T;t.prepareToken().addCallbacks(function(){S.options.attemptSend++,T.dependOn(E.repeatQuery(S,{attemptSend:S.options.attemptSend}));},function(e){R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.AUTHENTICATION_FAILED,e.message),T.errback(R);});}else if(p.type===n.errorsType.TOKEN_NOT_VALID)if(t.removeToken(),0===S.options.attemptSend)S.options.attemptSend++,T.dependOn(this.repeatQuery(S,{attemptSend:S.options.attemptSend}));else return _=s.detailStrings.NO_RIGHTS_FOR_EXECUTE+' (при повторном вызове метода: '+S.info.method+')',R=new s(s.errorsType.INTERNAL_SERVER_ERROR,s.detailTypes.NO_RIGHTS_FOR_EXECUTE,_),T.errback(R),T;else T.errback(p);return T;}};});define('js!SBIS3.Plugin/Source/QueryManager/Mixin/DeferredQueryMixin',['Core/EventBus','js!SBIS3.Plugin/Source/Helper/SPConstants','js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,n,i){'use strict';var r='SBIS3.Plugin/Source/QueryManager/Mixin/DeferredQueryMixin';return{$constructor:function(){this._sbisPluginEvent=e.channel(n.eventBusChannel.SbisPluginEvent),this._sbisPluginEvent.subscribe('messageEnqueued',this._onMessageEnqueued.bind(this)),this._sbisPluginEvent.subscribe('messageDequeued',this._onMessageDequeued.bind(this)),this._sbisPluginEvent.subscribe('downloadProgress',this._onDownloadProgress.bind(this)),this._sbisPluginEvent.subscribe('request.not_recognized',this._onRequestNotRecognized.bind(this));},_onMessageEnqueued:function(e,n){var i=this.getQuery(n.QueryId);if(!i)return;i.extendWaitingTime(5*60*1000);},_onMessageDequeued:function(e,n){var i=this.getQuery(n.QueryId);if(!i)return;i.returnWaitingTime();},_onDownloadProgress:function(e,n){var i=n.Name.split('-')[0],r=this._queries;for(var s in r){if(!r.hasOwnProperty(s))continue;var t=this.getQuery(s);t.clearTimeout(),t.setTimeout(t._timeoutHandler,t._timeoutHandler.time);}},_onRequestNotRecognized:function(e,n){try{var s=JSON.parse(n.request),t=s.queryID||s.queryId,u=this.getQuery(t);i.info(r,'_onRequestNotRecognized','Запрос с queryId = '+t+' не распознан');var o=new ConnectionError(ConnectionError.errorsType.INTERNAL_SERVER_ERROR,ConnectionError.detailTypes.REQUEST_NOT_RECOGNIZED);u.clearTimeout(),u.fail(o);}catch(e){i.error(r,'_onRequestNotRecognized','Запрос не распознан: '+n.request);}}};});define('js!SBIS3.Plugin/Source/QueryManager/Mixin/ServiceManagerEventMixin',['Core/EventBus','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPCustomEvent','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,n,i,s){'use strict';return{$constructor:function(){this._serviceManagerChannel=e.channel(n.eventBusChannel.ServiceManager),this._serviceManagerChannel.subscribe('onclose',this._onServiceClose.bind(this));},_onServiceClose:function(e,n){for(var t in this._queries){if(!this._queries.hasOwnProperty(t))continue;var o=this.getQuery(t);if(o.serviceGuid===n){o.clearTimeout();var a=new r(r.errorsType.INTERACTION_ERROR,r.detailTypes.CLOSE_CONNECTION,'СБИС Плагин закрыл соединение. Работа с плагинами невозможна, запустите СБИС Плагин и перезагрузите страницу.');if(o.fail(a),i.isDebugLogEnabled)window.dispatchEvent(s.create('onSbisPluginLogEvent',{type:'error',datetime:new Date().toISOString(),queryID:t,data:{message:a.message,type:a.type,detailType:a.description}}));}}}};});define('js!SBIS3.Plugin/Source/QueryManager/QueryManager',['Core/moduleStubs','Core/EventBus','Core/Deferred','Core/core-extend','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','browser!js!SBIS3.Plugin/Source/Transport/ConnectionManager/ConnectionManager','browser!js!SBIS3.Plugin/Source/QueryManager/Query','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/SpecialTypesMixin','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/DeferredQueryMixin','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/ServiceManagerEventMixin','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Helper/SPCustomEvent','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,n,t,i,o,a,u,s,c,d,l,g,p,y){'use strict';var S=function(){return this||(0,eval)('this');}(),v='js!SBIS3.Plugin/Source/QueryManager/QueryManager',f,I=function(){this._queries={},this._connectionManagerChannel=r.channel(i.eventBusChannel.ConnectionManager),this._connectionManagerChannel.subscribe('onmessage',this._onConnectionManagerMessage.bind(this));};return I.prototype.isReady=function(){return a.onWarmUpReady();},I.prototype.call=function(e,r,t,u){var s=this;return a.onWarmUpReady().addCallback(function(){var a=o.getService(e),c=new n();if('destroy'===r)if(c.addBoth(function(r){return o.removeService(e),r;}),a.getProtocol()===i.protocolName.OLD_PROTOCOL)if(r='releasePlugin',a&&a.plugin)t=[a.plugin.objectID];else return c.callback(),c;else r='BaseExtension.destroy',t={serviceGuid:e};return p.debug(v,'call','Вызов метода: '+r),c.dependOn(s._sendData(a,r,t,u)),c;});},I.prototype.repeatQuery=function(e,r){var t=e.serviceGuid,i=e.info,a=i.method,u=i.params,s=new n(),c=o.getService(t);return e.clearTimeout(),p.debug(v,'repeatQuery','Повторный запрос для queryId: '+e.queryId+', service: '+t+(c?'('+c.endpoint.address+')':'')),s.dependOn(this.call(t,a,u,r)),s;},I.prototype.getQuery=function(e){return this._queries[e];},I.prototype.addQuery=function(e,r){this._queries[e]=r;},I.prototype.removeQuery=function(e){var r=this._queries[e];if(r)r.clearTimeout(),delete this._queries[e];},I.prototype._getProtocolByService=function(r){var n=r.getProtocol();return e.require([n]).addCallback(function(e){return e[0];});},I.prototype._sendData=function(e,r,t,i){var o=e.guid,u=this;return u._getProtocolByService(e).addCallback(function(s){return s.preparePacket(e,r,t,i).addCallback(function(t){var i=new n(),s=u._makeQuery(t,o,i);if(e.methodCount.hasOwnProperty(r)?e.methodCount[r]++:e.methodCount[r]=1,p.isDebugLogEnabled)if(window.dispatchEvent(y.create('onSbisPluginLogEvent',{type:'call',datetime:new Date().toISOString(),queryID:s.queryId,data:{moduleName:e.plugin?e.plugin.name:e.endpoint.address,method:s.info.method,params:s.info.params,objectID:s._data.objectID||''}})),S.LocalService&&S.LocalService.sbisLogsTraceEndpoint)S.LocalService.sbisLogsTraceEndpoint(s.queryId);return a.send(s.getDataString(),null).addErrback(function(e){i.errback(e);}),i;});});},I.prototype._onConnectionManagerMessage=function(r,n){var t=this,i=JSON.parse(n);if(!this._inspectEvents(i)){var a=i.queryID||i.queryId,u=this.getQuery(a);if(!u)return void p.error(v,'_onConnectionManagerMessage','Запрос с queryId = '+a+' отсутствует');var c=u.serviceGuid,d,l;if(!o.hasService(c))return void u.fail(new s(s.errorsType.INTERACTION_ERROR,s.detailTypes.COMMUNICATION_ERROR,'Сервис с guid == '+c+' уже уничтожен'));l=(d=o.getService(c)).getProtocol(),e.require([l]).addCallback(function(e){return e[0].receiveAnswer(i,d).addErrback(function(e){return t._inspectSpecialTypes(e);}).addCallback(function(e){return t.removeQuery(a),u.success(e),i;}).addErrback(function(e){return t.removeQuery(a),u.fail(e),e;}).addBoth(function(e){if(p.isDebugLogEnabled){var r='answer',n=e;if(e instanceof Error)r='error',n={message:e.message,type:e.type,detailType:e.description};window.dispatchEvent(y.create('onSbisPluginLogEvent',{type:r,datetime:new Date().toISOString(),queryID:a,data:n}));}return e;});});}},I.prototype._makeQuery=function(e,r,n){var t=this,i=o.getService(r),a=i&&i.customTimeout,c=new u(e,r,n),d=function(){if(!n.isReady()){var r=new s(s.errorsType.INTERNAL_CLIENT_ERROR,s.detailTypes.COMMUNICATION_ERROR,s.detailStrings.NO_RESPONSE_DURING+' ('+d.time/1000+' сек.) queryID: '+e.queryID);if(p.isDebugLogEnabled)window.dispatchEvent(y.create('onSbisPluginLogEvent',{type:'error',datetime:new Date().toISOString(),queryID:c.queryId,data:{message:r.message,type:r.type,detailType:r.description}}));t.removeQuery(e.queryID),n.errback(r);}},l=setTimeout(d,a||u._queryTimeout);return d.time=a||u._queryTimeout,c.setTimeout(l,d),t.addQuery(e.queryID,c),c;},I.prototype._inspectSpecialTypes=function(e){return n.success(e);},I.prototype._inspectEvents=function(e){return false;},f=t.mixin(I,[c,d,l,g]),new f();});define('js!SBIS3.Plugin/Source/Provider/SbisPlugin',['js!WS.Data/Di','js!WS.Data/Source/Provider/IRpc','js!WS.Data/Entity/OptionsMixin','Core/Abstract','browser!js!SBIS3.Plugin/Source/QueryManager/QueryManager','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(i,n,r,t,e){'use strict';var u='SBIS3.Plugin/Source/Provider/SbisPlugin',o=t.extend([n,r],{_moduleName:u,_$guid:'',_$endpoint:null,constructor:function i(n){this._$endpoint={},r.constructor.call(this,n);},getEndpoint:function(){return this._$endpoint;},call:function(i,n,r){if(r)return e.call(this._$guid,i,n);else return e.call(this._$guid,i,{Params:n});}});return i.register(u,o),o;});define('js!SBIS3.Plugin/Source/LocalService',['js!WS.Data/Di','js!WS.Data/Source/SbisService','Core/moduleStubs','Core/Deferred','Core/EventBus','Core/IoC','Core/helpers/generate-helpers','Core/core-instance','Core/constants','Core/core-merge','js!SBIS3.Plugin/components/SbisPluginLocalStorage','browser!js!SBIS3.Plugin/Source/Helper/Environment','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Diagnostic','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Error/ParamsValidationError','browser!js!SBIS3.Plugin/Source/QueryManager/Mixin/InspectEventMixin','browser!js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','js!SBIS3.Plugin/Source/Helper/ExecutionTimeout','js!WS.Data/Adapter/Sbis','browser!js!SBIS3.Plugin/Source/Provider/SbisPlugin','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,n,i,o,t,s,a,c,u,l,d,g,h,S,f,p,b,_){'use strict';if(!c.isBrowserPlatform)return t.resolve('ILogger').log('SBIS3.Plugin/Source/LocalService','Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!'),null;var v=function(){return this||(0,eval)('this');}();v.LocalService={logger:{},diagnostic:{modules:{}},sbisLogsTraceEndpoint:function(e){}};var P='SBIS3.Plugin/Source/LocalService',y='SBIS3.Plugin/Source/Provider/SbisPlugin';if('undefined'!==typeof window&&(window.hasOwnProperty('page')||window.hasOwnProperty('isRetailProduct')&&!d.isOnline))o.channel('SbisServiceOfflineChannel').subscribe('onMessage',function(e,r){h.debug(P,'_subscribeOnOfflineChannel','Data: '+r);try{var n={};if('string'===typeof r)n=JSON.parse(r);else if('object'===typeof r)n=r;p._inspectEvents(n);}catch(e){h.error(P,'_subscribeOnOfflineChannel','Не удалось получить данные из SbisServiceOfflineChannel: '+e.message);}});var w=r.extend({_moduleName:P,_$adapter:'adapter.json',_$provider:y,_$options:{mode:g.showModes.RUN_ONCE,debug:false,queryTimeout:60000},_$handlers:{onError:null},errorsType:{},errorsDetailType:{},_guid:'',_channel:null,readyState:g.readyState,constructor:function(r){var n=this;this._guid=s.createGUID(),u(this.errorsType,S.errorsType),u(this.errorsType,f.errorsType),u(this.errorsDetailType,S.detailTypes),u(this.errorsDetailType,f.detailTypes),this._channel=o.channel({strictMode:true}),this._serviceManagerChannel=o.channel(g.eventBusChannel.ServiceManager,{strictMode:true}),this._channel.publish('onopen','onerror','onclose'),this._serviceManagerChannel.publish('onopen','onerror','onclose'),this._onclose=this._onclose.bind(this),this._onerror=this._onerror.bind(this),this._serviceManagerChannel.subscribe('onclose',this._onclose),this._serviceManagerChannel.subscribe('onerror',this._onerror),r.options=r.options||{},r.options.debug=r.options.debug||v.SPDebug();var i=r.endpoint.hasOwnProperty('address')?r.endpoint.address.split('-'):[],t=i.length>1?i[0]:'';if('undefined'!==typeof window&&(window.hasOwnProperty('page')||window.hasOwnProperty('isRetailProduct')&&!d.isOnline&&'FileSystem'!==t)){var a=l.getItem('SbisPluginExclude'),c=[];if(a&&'string'===typeof a)try{c=JSON.parse(a);}catch(e){c=[];}else c=[];if(c.indexOf(t)<0){if(''!==t)r.endpoint.address='/service/?pool='+t;r.provider='source.provider.sbis-business-logic';}}if(h.changeLocalServiceInfo(r.endpoint.address),w.superclass.constructor.call(this,r),'string'===typeof this._$provider)this._$provider=e.resolve(this._$provider,{guid:this._guid,endpoint:r.endpoint});var p={endpoint:n._$endpoint,options:n._$options};b.addService(n._guid,p);},once:function(e,r,n){this._channel.once(e,r,n);},subscribe:function(e,r,n){this._channel.subscribe(e,r,n);},unsubscribe:function(e,r,n){this._channel.unsubscribe(e,r,n);},call:function(e,r){if(!c.isBrowserPlatform)return i.fail('Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!');var n=this,o=new i();return this.isReady().addCallbacks(function(){if(n._$provider._moduleName!==y)o.dependOn(_.setMethodExecutionTimeout(n._callViaProvider(e,r),n._$options.queryTimeout,n.getEndpoint().contract+'.'+e).addErrback(function(e){return S.createFromNativeError(e);}));else o.dependOn(n._callViaProvider(e,r));},function(e){o.errback(e);}),o;},isReady:function(){if(!c.isBrowserPlatform)return i.fail('Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!');var e=d.validateEnvironment();if(e instanceof Error)return i.fail(e);var r=this;if(r._$provider._moduleName!==y)return i.success();return n.require(['js!SBIS3.Plugin/Source/Transport/ConnectionManager/Ping']).addCallback(function(e){var n=e[0],o=new i();return n.getLastRunningResult().addCallback(function(){return b.isServiceReady(r._guid);}).addCallback(function(e){return o.callback(),e;}).addErrback(function(e){if(e.message=rk(e.message),'function'===typeof r._$handlers.onError)r._$handlers.onError();o.dependOn(r._showError(e));}),o;});},isRunning:function(){if(!c.isBrowserPlatform)return i.fail('Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!');return n.require(['browser!js!SBIS3.Plugin/Source/Transport/ConnectionManager/Ping']).addCallback(function(e){return e[0].getRunningState();});},getState:function(){return b.getState(this._guid);},destroy:function(){var e=this.call('destroy',{});return this._channel.destroy(),this._destroyed=true,e;},getGuid:function(){return this._guid;},getObjectId:function(){return b.getObjectId(this._guid);},setProvider:function(r){if('string'===typeof r)this._$provider=e.resolve(r,{guid:this._guid});else this._$provider=r;},setQueryTimeout:function(e){if('number'!==typeof e||isNaN(e)||!isFinite(e)||e<=1000)return-1;b.setQueryTimeout(this._guid,e);},_callViaProvider:function(e,r){var n=this,i=this.getAdapter();return n._$provider.call(e,i.serialize(r),true).addCallbacks(function(e){return n.__getDataSetInstance({rawData:e,itemsProperty:void 0,totalProperty:'n'});}.bind(n),function(e){return h.debug(P,'call',e.description+' '+e.message),e;});},__getDataSetInstance:function(e){if('string'===typeof this._$adapter&&'adapter.json'===this._$adapter||'object'===typeof this._$adapter&&a.instanceOfModule(this._$adapter,'WS.Data/Adapter/Json'))return e.rawData;else return this._getDataSetInstance(e);},_showError:function(e){if(!c.isBrowserPlatform)return i.fail('Код модуля SBIS3.Plugin/Source/LocalService должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!');var r=this,o=h.getTransportName(),t=r._$options.mode;return n.require(['browser!js!SBIS3.Plugin/Source/Helper/DialogsManager']).addCallback(function(n){var s=n[0],a=new i();if(o===g.transportName.EXTERNAL)return i.fail(e);if(e.description in s.installDialogTemplates)return a.dependOn(s.showError(e,t)).addCallback(function(n){if(n)return r.isReady();else return e;}),a;else return i.fail(e);});},_onclose:function(e,r){if(this._guid===r)e.cancelBubble(),h.debug(P,'_onclose',r),this._serviceManagerChannel.unsubscribe('onclose',this._onclose),this._serviceManagerChannel.unsubscribe('onerror',this._onerror),this._channel.notify('onclose',r);},_onerror:function(e,r,n){if(this._guid===r){e.cancelBubble();try{if('string'===typeof n)n=JSON.parse(n);}catch(e){return void h.debug(P,'_onerror','cant parse, guid: '+r+'; message: '+n);}h.debug(P,'_onerror','error.description || error'),this._serviceManagerChannel.unsubscribe('onerror',this._onerror),this._channel.notify('onerror',n);}}});return e.register(P,w),w.subscribe=function(e,r,n){if(e=e.toLowerCase(),'onconnect'===e)o.channel(g.eventBusChannel.ConnectionManager).subscribe('onopen',r,n);else if('ondisconnect'===e)o.channel(g.eventBusChannel.ConnectionManager).subscribe('onclose',r,n);else if('onerror'===e)o.channel(g.eventBusChannel.ConnectionManager).subscribe('onerror',r,n);},w;});define('js!SBIS3.Plugin.Source.LocalService',['js!SBIS3.Plugin/Source/LocalService','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e){'use strict';return e;});define('js!SBIS3.Plugin/Source/Protocol/Mixin/SpecialTypesMixin',['browser!js!SBIS3.Plugin/Source/Error/SpecialTypeError','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(r){'use strict';return{_getSpecialTypeError:function(e){var n=e&&e.data&&e.data.errorType||e.answer&&e.answer.errorType,o=e&&e.data&&e.data.error||e.answer&&e.answer.error;if(r.errorsType.hasOwnProperty(n))return new r(r.errorsType[n],o,e.queryId||e.queryID);else return null;}};});define('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport',['Core/moduleStubs','Core/Deferred','js!WS.Data/Di','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,n){'use strict';return{_initExtension:function(n){return e.require(['browser!js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Diagnostic']).addCallback(function(i){var t=i[0],o=i[1],c=i[2],s=new r(),a,u;if(!t.hasService(n))return s.errback(new o(o.errorsType.INTERNAL_SERVER_ERROR,o.detailTypes.CLOSE_CONNECTION));if(a=t.getService(n),a.initExtensionDef)return a.initExtensionDef.createDependent();if(a.initExtensionDef=s.createDependent(),u=a.plugin,u)return s.callback(u),s;var S=a.name,l=a.version;return c.debug('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','_initExtension','Получаем экземпляр класса '+S+'-'+l),e.require(['browser!js!SBIS3.Plugin/Source/QueryManager/QueryManager']).addCallback(function(e){e[0].call(n,'getPlugin',[S,l]).addCallbacks(function(e){if(e){if(c.debug('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','_initExtension','Плагин '+S+'-'+l+' успешно создан'),'object'==typeof e)a.plugin=e;s.callback(e);}else s.errback(new o(o.errorsType.INTERNAL_SERVER_ERROR,o.detailTypes.PLUGIN_NOT_INIT));},function(e){c.error('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','_initExtension',o.detailStrings.CLOSE),c.error('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','_initExtension',e.message),s.errback(e);});}),s;});},_inspectInnerServices:function(e,r,i){var t=this,o=Array.isArray?Array.isArray:$.isArray;if('object'===typeof e&&!o(e)){for(var c in e)if(e.hasOwnProperty(c)){var s=e[c];e[c]=t._inspectInnerServices(s,r,i);}var a=r.plugin;if(e&&e.objectID&&a&&a.objectID){var u={endpoint:r.endpoint,options:r.options},S=n.resolve('SBIS3.Plugin/Source/LocalService',u);S.setProvider('SBIS3.Plugin/Source/Provider/SbisPlugin');var l=S._guid,d;i.addService(l,u),(d=i.getService(l)).setProtocol(r.getProtocol()),d.plugin=e,d.parentID=r.guid,e.call=S.call.bind(S),e.getState=S.getState.bind(S),e.readyState=S.readyState,e.getObjectId=S.getObjectId.bind(S);}return e;}else if(o(e)){var g=e||[];return g.forEach(function(e,n){g[n]=t._inspectInnerServices(e,r,i);}),g||[];}return e;}};});define('js!SBIS3.Plugin/Source/Protocol/Sbis3Plugin',['Core/Deferred','Core/IoC','Core/helpers/generate-helpers','Transport/RPCJSON','Core/core-merge','browser!js!SBIS3.Plugin/Source/Authenticate','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Protocol/Mixin/SpecialTypesMixin','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,o,t,a,n,i,s){'use strict';var c={preparePacket:function(r,i,s,c){var l=new e({silent:true}),u=r.endpoint,p=r.name,R=r.version,S=u.contract,d=i,g=i.split('.');if(g.length>1)S=g[0],d=g[1];var y=t.jsonRpcPreparePacket(S+'.'+d,s),E=o.createGUID(),N={queryID:E,info:{moduleName:p,moduleVersion:R,objectName:S,method:d,params:s},options:{attemptSend:0},data:{serviceGuid:r.guid,protoVersion:1,queryId:E,accessToken:n.getToken(),moduleName:p,moduleVersion:R,query:y.reqBody}};if(c)a(N.options,c);return l.callback(N),l;},receiveAnswer:function(o){var t=o.type,a=new e({silent:true});if('answer'===t)try{var n=JSON.parse(o.data);if('object'===typeof n)n=n.result;a.callback(n);}catch(p){if(!(p instanceof Error||a.isReady())){var s=new i(i.errorsType.INTERNAL_CLIENT_ERROR,i.detailTypes.COMMUNICATION_ERROR,p);a.errback(s);}}else if('error'===t){var c,l,u=this._getSpecialTypeError(o);if(u)a.errback(u);else{try{if('RPC_ERROR'===o.data.errorType){var p=JSON.parse(o.data.error).error;c=p.message,l=p.data.error_code,l+='';}else c=o.data.error,l='';}catch(e){r.resolve('ILogger').error('SBIS3.Plugin/Source/Protocol/SbisPlugin.receiveAnswer','При разборе ответа произошла ошибка: '+e.message);}s=new i(i.errorsType.INTERNAL_SERVER_ERROR,l||i.detailTypes.COMMUNICATION_ERROR,c||o.error||i.detailTypes.UNKNOWN_SERVER_ERROR),a.errback(s);}}return a;},_getSpecialTypeError:function(e){return null;}};return a(c,s),c;});define('js!SBIS3.Plugin/Source/Protocol/SbisPlugin',['Core/Deferred','Core/helpers/generate-helpers','Core/core-merge','browser!js!SBIS3.Plugin/Source/Authenticate','browser!js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','browser!js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','browser!js!SBIS3.Plugin/Source/Protocol/Mixin/SpecialTypesMixin','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Error/ParamsValidationError','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,r,t,a,n,i,s,l,o){'use strict';var c={preparePacket:function(r,t,a,n){var s=this,o=r.plugin;switch(t){case'getPlugin':case'releasePlugin':case'runUpdate':return this._preparePacket(null,t,a,null,n);default:var c;if(!o)c=i._initExtension(r.guid);else c=e.success(o);return c.addCallback(function(r){if(!r){var i=new l(l.errorsType.INTERACTION_ERROR,l.detailTypes.SERVER_CLOSE_CONNECTION,'СБИС Плагин закрыл соединение. Необходимо перезагрузить страницу.');return e.fail(i);}return s._checkMethod(r,t,a).addCallback(function(e){return s._preparePacket(r,t,e.params,e.paramsType,n);});});}},_preparePacket:function(n,i,s,l,o){var c=new e({silent:true}),u=r.createGUID(),p=n?n.objectID:void 0,f={queryID:u,info:{method:i,params:s},options:{attemptSend:0},data:{type:'call',queryID:u,accessToken:a.getToken(),method:i,objectID:p,Params:s,ParamsType:l}};if(o)t(f.options,o);return c.callback(f),c;},_checkMethod:function(r,t,a){var n=this,i=new e({silent:true}),s=[],l=Array.isArray?Array.isArray:$.isArray,c;if(r.methods.hasOwnProperty(t))c=r.methods[t]||[];else{var u=new o(o.detailTypes.FUNCTION_NOT_FOUND,'Метод '+t+' не найден');return i.errback(u);}if(!l(a)&&Object.keys(a).length>=0){for(var p in a)if(a.hasOwnProperty(p))s.push(a[p]);}else if(l(a))s=a;return n._callObjMethod(r,t,c,s).addCallbacks(function(e){i.callback(e);},function(e){i.errback(e);}),i;},_callObjMethod:function(r,t,a,n){var i=[],s=[],l=n.length,c,u,p,f=new e(),h,d;for(u=0,p=n.length;u<p;u++){var _=n[u],g=typeof _;if('undefined'===g||'function'===g||'number'===g&&(isNaN(_)||_===-1/0||_===1/0)){h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s);var y=new o(o.detailTypes.WRONG_ARGUMENT_TYPE,o.detailTypes.WRONG_ARGUMENT_TYPE+' Неподдерживаемый аргумент "'+_+'". Вызов: '+d+'. Доступные сигнатуры: '+h);return f.errback(y);}if('object'===g&&_ instanceof Array)g='array';i.push(_),s.push(g);}var T=0,E=void 0,S=0;if(a.forEach(function(e){if(e.length>T)T=e.length;if(void 0==E||e.length<E)if(!e.length)S++,E=0;else{for(c=0,p=e.length;c<p;c++)if(e[c].hasDefaultValue)break;E=c;}}),E>l||T<l)return h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s),y=new o(o.detailTypes.WRONG_ARGUMENTS_NUMBER,'Неверное количество аргументов. Вызов: '+d+'. Доступные сигнатуры: '+h),f.errback(y);if(0===l&&S>1)return h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s),y=new o(o.detailTypes.AMBIGUOUS_MATCH_EXCEPTION,'Двусмысленное представляение метода. Вызов: '+d+'. Доступные сигнатуры: '+h),f.errback(y);var N=null;for(c=0,p=a.length;c<p;c++){var R=a[c];if(0===l&&(!R.length||R[0].hasDefaultValue)){N=R;break;}else if(R.length>=l){var O=false;for(u=0;u<R.length&&!O;u++)if(u+1>l&&!R[u].hasDefaultValue||u+1<=l&&s[u]&&R[u].jsName!==s[u])O=true;if(!O)if(null===N)N=R;else return h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s),y=new o(o.detailTypes.AMBIGUOUS_MATCH_EXCEPTION,'Двусмысленное представляение метода. Вызов: '+d+'. Доступные сигнатуры: '+h),f.errback(y);}}if(null===N)return h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s),y=new o(o.detailTypes.FUNCTION_NOT_FOUND,'Не найдена функция соотвествующая параметрам. Вызов: '+d+'. Доступные сигнатуры: '+h),f.errback(y);return f.callback({params:i,paramsType:N}),f;},receiveAnswer:function(r,t){var a=r.type,s=r.answer,o=new e(),c;if('answer'===a)if(s&&'object'===typeof s)try{if(c=this._getSpecialTypeError(r),c)o.errback(c);else{s=this._parseAnswer(o,s);var u=i._inspectInnerServices(s,t,n);o.callback(u);}}catch(f){if(!(f instanceof Error||o.isReady())){var p=new l(l.errorsType.INTERNAL_CLIENT_ERROR,l.detailTypes.COMMUNICATION_ERROR,f);o.errback(p);}}else o.callback(s);else if('error'===a)if(c=this._getSpecialTypeError(r),c)o.errback(c);else{var f=new l(l.errorsType.INTERNAL_SERVER_ERROR,r.errorType||l.detailTypes.COMMUNICATION_ERROR,r.error||l.detailTypes.UNKNOWN_SERVER_ERROR);o.errback(f);}return o;},_getExpectedSignatures:function(e,r){var t='';return r.forEach(function(r){var a=r.reduce(function(e,r){return e=''!==e?e+', ':e,e+(r?r.jsName:'');},'');t=''!==t?t+' | ':t,t+=e+'('+a+')';}),t;},_getCalledSignature:function(e,r){return e+'('+r.reduce(function(e,r){return e=''!==e?e+', ':e,e+r;},'')+')';},_parseAnswer:function(e,r){var t=r.type,a=this;if(delete r.type,'object'===t&&'JsonObject'===r.name)delete r.name;if('object'===t){var n=r.objectID,i={},s={};for(var c in r){if(!r.hasOwnProperty(c))continue;var u=r[c];if(u&&'object'===typeof u)if('method'===u.type){if(!u.parametersType){var p=new o(o.detailTypes.UNKNOWN_FUNCTION_PARAMS);throw e.errback(p),p;}var f=c.split('@')[0];if(s[f])s[f].push(u.parametersType);else s[f]=[u.parametersType];}else i[c]=a._parseAnswer(e,u);else i[c]=u;}if(n)if(!s.length)i['methods']=s;return i;}else if('array'===t){var h=r.array||[];return h.forEach(function(r,t){h[t]=a._parseAnswer(e,r);}),r.array||[];}else if('error'===t)throw p=new l(l.errorsType.INTERNAL_SERVER_ERROR,r.errorType||l.detailTypes.COMMUNICATION_ERROR,r.error||l.detailTypes.UNKNOWN_SERVER_ERROR),e.errback(p),p;else return r;},_getSpecialTypeError:function(e){return null;}};return t(c,s),c;});define('js!SBIS3.Plugin/Source/Transport/resources/WebSocketNative',['Core/Deferred','js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization','SBIS3.Plugin_localization'],function(e,o){'use strict';if('undefined'===typeof window)return null;var n=0,t=function(e){try{var o=new WebSocket(e);if(o.__id=n++,o.getId=function(){return this.__id;},3===o.readyState)t.logger.log('SbisPluginTransport не может создать соединение через Native WebSocket');}catch(e){return t.logger.log('SbisPluginTransport не может создать соединение через Native WebSocket, заблокировано политиками безопасности'),{isBlocked:true};}return o;};t.initialize=function(e,o){i(e,o);},t.logger={log:function(e){o.debug('WEBSOCKET','log',e);},error:function(e){o.error('WEBSOCKET','log',e);},info:function(e){o.info('WEBSOCKET','log',e);}};function i(o,n){t.logger.log('SbisPluginTransport попытка подключения по Native WebSocket:'+o);try{var i=new WebSocket(o),r=setTimeout(function(){i.onclose();},5000),c=new e({silent:true});if(c.addCallbacks(function(){n({success:true});},function(){n({success:false});}).addBoth(function(){clearTimeout(r);}),i.onopen=function(e){if(!c.isReady())c.callback();i.close();},i.onerror=function(e){if(!c.isReady())c.errback();},i.onclose=function(e){if(!c.isReady())c.errback();},3==i.readyState)t.logger.log('SbisPluginTransport не может создать соединение через Native WebSocket');}catch(e){t.logger.log('SbisPluginTransport не может создать соединение через Native WebSocket, заблокировано политиками безопасности'),n({success:false});}}return t;});
define('js!SBIS3.Plugin/Source/Helper/DialogsManager',['Core/moduleStubs','Core/Deferred','Core/constants','browser!js!SBIS3.Plugin/Source/Helper/SPConstants','browser!js!SBIS3.Plugin/Source/Helper/Environment','browser!js!SBIS3.Plugin/components/SbisPluginLocalStorage','browser!js!SBIS3.Plugin/components/SbisPluginLocalStorageTemporary','SBIS3.Plugin_localization'],function(e,s,o,i,t,n,r){'use strict';var a={installDialogTemplates:{OLD_FLASH_PLAYER:{caption:rk('Обновите Adobe Flash Player'),description:rk('Для работы')+' <a href="https://help.sbis.ru/help/start/teh_terms/sbisplugin/mes_flash/" target="_blank" class="PM__helpLink controls-Link">'+rk('требуется последняя версия Adobe Flash Player')+'</a> 19 '+rk('или выше'),downloadLink:'https://get.adobe.com/flashplayer/?loc=ru',buttonCaption:rk('Скачать'),openNewTab:/Windows NT 6.[23]/.test(navigator.appVersion)&&o.browser.isIE,about:null},CLOSE_CONNECTION:{caption:rk('Запустите СБИС Плагин'),description:null,downloadLink:t.sbisPluginPath,buttonCaption:rk('Скачать'),openNewTab:/Windows NT 6.[23]/.test(navigator.appVersion)&&o.browser.isIE,about:null},UNABLE_TO_CONNECT:{caption:rk('Установите СБИС Плагин'),description:rk('Вам необходимо')+' <a href="https://help.sbis.ru/help/start/teh_terms/sbisplugin/mes_inst/" target="_blank" class="PM__helpLink controls-Link">'+rk('включить либо установить')+'</a> '+rk('СБИС Плагин'),downloadLink:t.sbisPluginPath,buttonCaption:rk('Скачать'),openNewTab:/Windows NT 6.[23]/.test(navigator.appVersion)&&o.browser.isIE,about:null},NMH:{caption:rk('Не удалось запустить необходимое расширение браузера'),description:'1. <a href="https://help.sbis.ru/help/start/teh_terms/sbisplugin/mes_plug/">'+rk('Установите')+'</a> '+rk('или')+' <a href="https://help.sbis.ru/help/start/teh_terms/sbisplugin/set/plugin/">'+rk('разрешите использование')+'</a> '+rk('расширения SbisPlugin Extension в настройках браузера')+'<br/> 2. '+rk('Обновите страницу')+'<br/> 3. '+rk('Установите СБИС Плагин'),downloadLink:t.browserType.isFirefox?'https://addons.mozilla.org/ru/firefox/addon/sbisplugin-extension/':'https://chrome.google.com/webstore/detail/pbcgcpeifkdjijdjambaakmhhpkfgoec',buttonCaption:rk('Установить расширение'),openNewTab:/Windows NT 6.[23]/.test(navigator.appVersion)&&o.browser.isIE,about:rk('Для полноценной работы, пожалуйста, выполните следующие шаги')+':'},CERTIFICATE_NOT_INSTALLED:{caption:rk('Установите СБИС Плагин, разрешите установку сертификата'),description:rk('Не удалось инициализировать соединение через WebSocket. Установите последнюю версию СБИС Плагин. Разрешите установку сертификата при установке.'),downloadLink:t.sbisPluginPath,buttonCaption:rk('Скачать'),openNewTab:/Windows NT 6.[23]/.test(navigator.appVersion)&&o.browser.isIE,about:null},OLD_VERSION_UPDATE_DOWNLOADED:{caption:rk('Установите СБИС Плагин'),description:rk('Обновление для СБИС Плагина уже скачано, для корректной работы')+' '+'<a href="https://help.sbis.ru/help/start/teh_terms/sbisplugin/install/" target="_blank" class="PM__helpLink controls-Link">'+rk('необходимо его установить')+'</a>.',downloadLink:t.sbisPluginPath,buttonCaption:rk('Скачать'),openNewTab:/Windows NT 6.[23]/.test(navigator.appVersion)&&o.browser.isIE,about:null},INSTALL_NMH_EXTENSION:{caption:rk('Рекомендуем установить расширение для работы со СБИС Плагин'),downloadLink:t.browserType.isFirefox?'https://addons.mozilla.org/ru/firefox/addon/sbisplugin-extension/':'https://chrome.google.com/webstore/detail/pbcgcpeifkdjijdjambaakmhhpkfgoec',buttonCaption:rk('Скачать'),openNewTab:/Windows NT 6.[23]/.test(navigator.appVersion)&&o.browser.isIE,about:rk('Расширение SBIS Plugin Extension предоставляет дополнительный канал связи для подключения к СБИС Плагин')}},showInstallDialog:function(o,t){var n=a.installDialogTemplates[o.description];return e.require(['browser!js!SBIS3.Plugin/components/Dialogs/PluginSetup/SetupDialogRender']).addCallback(function(e){var l=e[0];if(!t||l.isDialogOpened||t===i.showModes.SILENT||t===i.showModes.RUN_ONCE&&r.getItem('isSbisPluginSetupDialogRunOnce')||a.isSetupDialogDisabled()&&t!==i.showModes.ALWAYS)return s.success(!t||false);return l.isDialogOpened=true,new l(n,o).show(n,o);});},showError:function(e,s){return a.showInstallDialog(e,s);},isSbisPluginSetupDialogClosed:function(){return r.getItem('isSbisPluginSetupDialogRunOnce')||false;},isSetupDialogDisabled:function(){var e=n.getItem('isSbisPluginSetupDialogDisabled');return e?+e:false;}};return a;});
define('js!SBIS3.Plugin/Source/Helper/Helper',['Core/constants','Core/IoC','browser!js!SBIS3.Plugin/Source/Helper/Environment','browser!js!SBIS3.Plugin/Source/Helper/DialogsManager','browser!js!SBIS3.Plugin/Source/Helper/UserDataManager','browser!js!SBIS3.Plugin/Source/Helper/SPCustomEvent','browser!js!SBIS3.Plugin/Source/Diagnostic','i18n!SBIS3.Plugin/Source/Helper/Helper','SBIS3.Plugin_localization'],function(e,r,i,o,s,l,n){'use strict';if(!e.isBrowserPlatform)return r.resolve('ILogger').log('SBIS3.Plugin/Source/Helper/Helper','Код модуля SBIS3.Plugin/Source/Helper/Helper должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser!'),null;return{downloadLink:i.sbisPluginPath,isSetupDialogDisabled:o.isSetupDialogDisabled,isMobilePlatform:i._isMobilePlatform,isOSAvailable:i._isOSAvailable,browserType:i.browserType,osType:i.osType,isSbisPluginSetupDialogClosed:o.isSbisPluginSetupDialogClosed,isSbisPluginRunning:n.isSbisPluginRunning,showError:o.showError,createCustomEvent:l.create,getAccountId:s.getAccountId,isOnline:i.isOnline};});
define("tmpl!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelectorRender/ScanDeviceSelectorRender",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Button/IconButton"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={};n["js!SBIS3.CONTROLS/Button/IconButton"]=e[1];var o=function e(o,r,c,i,a){function l(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var S={};a&&a.isSetts&&(S=a.fullContext||{});var d="string"==typeof c?c:"",p=void 0===n?void 0:n,v={id:[],def:void 0},m=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},f=u.getMarkupGenerator(i);try{var h=f.joinElements([f.createTag("div",{class:"sbis3plugin-attachTo-scan"},[f.createTag("div",{class:"sbis3plugin-attachTo-scan__text",title:""+global.rk("Выбрать сканер")},[f.createText(" "+global.rk("Скан")+" "),f.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{name:"scanSelectorButton",className:"sbis3plugin-attachTo-scan__button",icon:"sprite:icon-16 icon-primary icon-View",tooltip:global.rk("Выбрать сканер"),command:"openScanDeviceSelectorMenu"},{name:"scanSelectorButton",sbisname:"scanSelectorButton"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},c,p,g,u.config,S)],{},v,this),f.createTag("div",{class:"sbis3plugin-attachTo-scan__popup-menu"},[],{},v,this)],r,v,this)],d,v);v.def&&(h=f.chain(h,v,r),v=void 0)}catch(e){u.templateError("resources/SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelectorRender/ScanDeviceSelectorRender.tmpl",e,o)}return h||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelectorRender/ScanDeviceSelectorRender"}},o});
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];};return function(e,r){t(e,r);function o(){this.constructor=e;}e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileGetter/FileGetter',['require','exports','browser!Lib/File/ResourceGetter/IResourceGetterBase','Core/core-functions','SBIS3.Plugin_localization'],function(t,e,r,o){'use strict';return function(t){__extends(e,t);function e(e){if(void 0===e)e={};var r=t.call(this,e)||this;return r.getterMeta=o.clone(e),r.filterGetterMeta(),r;}return e.prototype.destroy=function(){if(this._downloader)this._downloader.destroy(),this._downloader=null;},e.prototype.filterGetterMeta=function(){},e;}(r);});
define('js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/FileDownloader',['require','exports','Core/Deferred','SBIS3.Plugin_localization'],function(e,o,n){'use strict';return function(){function e(e){this.downloader=e;}return e.prototype.subscribe=function(e,o,n){this.downloader.subscribe(e,o,n);},e.prototype.download=function(e){return n.success();},e.prototype.destroy=function(){return this.downloader.destroy();},e;}();});
define('js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatelessExtension',['require','exports','Core/Deferred','js!WS.Data/Entity/OptionsMixin','Core/EventBus','Core/IoC','browser!js!SBIS3.Plugin/Source/LocalService','Core/constants','SBIS3.Plugin_localization'],function(e,i,t,n,s,o,r,c){'use strict';if(!c.isBrowserPlatform)return o.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/ExtensionBase/StatelessExtension','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(){function e(e){this._queries={},this.serviceEventList=['onClose','onError','onOpen'],this.eventList=[],this._$endpoint={},this._$options={},this._$binding={},n.constructor.call(this,e),this.channel=s.channel('SbisPluginEvent'),this._connect();}return e.prototype.call=function(e,i){return this.service.call(e,i);},e.prototype.destroy=function(){if(this._queries={},!this.service.isDestroyed())this.service.destroy();this.service=null;},e.prototype.isReady=function(){var e=new t();return e.dependOn(this.service.isReady()),e;},e.prototype.subscribe=function(e,i,t){var n=this;if(this.eventList.indexOf(e)>-1)this._subscribeToEvent(e,function(e,s){var o=s.UploadGuid||s.Guid;if(n._queries[o])i.call(t||this,s);});if(this.serviceEventList.indexOf(e)>-1)this._subscribeToPlugin(e,i,t);},e.prototype.setQueryTimeout=function(e){if(this.service)this.service.setQueryTimeout(e);},e.prototype._connect=function(){var e=this,i=new r({endpoint:e._$endpoint,options:e._$options,binding:e._$binding});e.service=i;},e.prototype._subscribeToEvent=function(e,i,t){this.channel.subscribe(e,i,t);},e.prototype._unsubscribeFromEvent=function(e,i,t){this.channel.unsubscribe(e,i,t);},e.prototype._subscribeToPlugin=function(e,i,t){this.service.subscribe(e,i,t);},e;}();});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];};return function(t,n){e(t,n);function o(){this.constructor=t;}t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/Scanner',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatelessExtension','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,t,n,o,r){'use strict';if(!r.isBrowserPlatform)return o.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Scanner','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(e){__extends(t,e);function t(t){var n=this,o={};if(o.endpoint={address:'Scanner-1.0.0.17',contract:'Scanner'},o.options=t||{mode:'always'},!o.options.hasOwnProperty('queryTimeout'))o.options.queryTimeout=600000;return n=e.call(this,o)||this,n;}return t.prototype.getDeviceNames=function(){return this.call('getDeviceNames',{});},t.prototype.getLastSelectedDevice=function(){return this.call('getLastSelectedDevice',{});},t.prototype.scan=function(){return this.call('scan',{});},t.prototype.deleteAll=function(){return this.call('deleteAll',{});},t.prototype.selectDevice=function(e){return this.call('selectDevice',e||{});},t.prototype.getScansFileName=function(e){return this.call('getScansFileName',e||{saveScansOption:0});},t.prototype._callUploadMethod=function(e){return this.scan();},t.prototype._callDownloadMethod=function(e){return this.getScansFileName(e);},t;}(n);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n;}||function(e,n){for(var t in n)if(n.hasOwnProperty(t))e[t]=n[t];};return function(n,t){e(n,t);function r(){this.constructor=n;}n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/ScannerDownloader',['require','exports','Core/Deferred','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/FileDownloader','browser!js!SBIS3.Plugin/components/Extensions/Scanner','SBIS3.Plugin_localization'],function(e,n,t,r,o){'use strict';return function(e){__extends(n,e);function n(){var n=e.call(this,new o())||this;return n.downloader.setQueryTimeout(10*60*1000),n;}return n.prototype.download=function(e){e=e||{saveScansOption:0};var n=this.downloader;return n.getDeviceNames().addCallback(function(r){if(!r.length)return t.fail(rk('Сканеров не обнаружено'));return n.getLastSelectedDevice().addCallback(function(o){var a=new t();if(!o)a.dependOn(n.selectDevice({scannerName:r[0]}));else a.callback();return a.addCallback(function(){return n.scan().addCallback(function(t){if(t)return n.getScansFileName(e);else return[];});}),a;});});},n;}(r);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];};return function(t,n){e(t,n);function o(){this.constructor=t;}t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileGetter/ScannerGetter',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileGetter/FileGetter','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/ScannerDownloader','browser!Lib/File/LocalFileLink','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,t,n,o,r,i,s){'use strict';if(!s.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/FileGetter/ScannerGetter','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this;}return t.prototype.getFiles=function(){var e={saveScansOption:this.saveScansOption},t=this;if(!t._downloader)t._downloader=new o(),t._downloader.subscribe('onClose',function(){delete t._downloader;});return t._downloader.download(e).addCallback(function(e){return e.map(function(e){return new r(e,t.getterMeta);});});},t.prototype.getGUID=function(){return this.guid;},t.prototype.filterGetterMeta=function(){this.guid=this.getterMeta.guid||'',delete this.getterMeta.guid,this.saveScansOption=this.getterMeta.saveScansOption||0,delete this.getterMeta.saveScansOption;},t;}(n);});
define('js!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelector',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileGetter/ScannerGetter','browser!js!SBIS3.Plugin/components/Extensions/Scanner','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(n,e,t,s,i,o){'use strict';if(!o.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelector','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(){function n(n){this.scannerOptions=n.scannerOptions;}return n.prototype.getList=function(){return this.checkScannerExtensionCreated(this.scannerOptions),this._scannerExtension.getDeviceNames().addCallback(function(n){return n.map(function(n){return new t({guid:n});});});},n.prototype.getLastSelectedDevice=function(){return this.checkScannerExtensionCreated(this.scannerOptions),this._scannerExtension.getLastSelectedDevice();},n.prototype.setLastSelectedDevice=function(n){return this.checkScannerExtensionCreated(this.scannerOptions),this._scannerExtension.selectDevice(n);},n.prototype.destroy=function(){if(this._scannerExtension)this._scannerExtension.destroy(),this._scannerExtension=null;},n.prototype.checkScannerExtensionCreated=function(n){var e=this;if(!this._scannerExtension)this._scannerExtension=new s(n),this._scannerExtension.isReady().addCallback(function(){e._scannerExtension.subscribe('onClose',function(){e.destroy();});}).addErrback(function(){e.destroy();});},n;}();});
if(typeof window !== "undefined" && window.atob){define("css!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelectorRender/ScanDeviceSelectorRender", function() {var style = document.createElement("style"),head = document.head || document.getElementsByTagName("head")[0];style.type = "text/css";style.appendChild(document.createTextNode(".sbis3plugin-attachTo-scan .sbis3plugin-attachTo-scan__button{float:right}.sbis3plugin-attachTo-scan__lastSelectedDevice .controls-MenuItem__text{font-weight:700}"));head.appendChild(style);});}
define('js!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelectorRender/ScanDeviceSelectorRender',['js!SBIS3.CORE.CompoundControl','tmpl!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelectorRender/ScanDeviceSelectorRender','SBIS3.CONTROLS/Menu/ContextMenu','browser!js!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelector','Core/CommandDispatcher','Core/ParallelDeferred','Core/IoC','Core/constants','SBIS3.CONTROLS/Button/IconButton','css!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelectorRender/ScanDeviceSelectorRender','SBIS3.Plugin_localization'],function(e,t,n,c,r,i,o,s){if(!s.isBrowserPlatform)return o.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelectorRender/ScanDeviceSelectorRender','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;var a=e.extend({_dotTplFn:t,$protected:{_modifyOptions:function(){var e=a.superclass._modifyOptions.apply(this,arguments);return e.activableByClick=false,e;},_popupMenu:null,_scanDeviceSelector:null,_parentMenuChannel:null},$constructor:function(){var e=this,t=e.getContainer().find('.sbis3plugin-attachTo-scan__popup-menu'),n=e.getParent(),c=n.getParent();this._parentMenuChannel=c._getChannel(),r.declareCommand(this,'openScanDeviceSelectorMenu',function(){var r=new i();return r.push(e.getScanGettersList()),r.push(e.getLastSelectedDevice()),r.done().getResult().addBoth(function(r){if(r instanceof Error)return o.resolve('ILogger').error('ScanDeviceSelectorRender',r),true;var i=r[0],s=r[1],a=e._createItemsByScanGettersList(i,s);if(!e._popupMenu)e._popupMenu=e._createPopupMenu(t,a,n,c);else e._popupMenu.setItems(a);if(!i.length)e._popupMenu.setEnabled(false);else e._popupMenu.setEnabled(true);e._popupMenu.show();}),true;});},init:function(){a.superclass.init.call(this);},destroy:function(){if(this._popupMenu)this._popupMenu.destroy(),this._popupMenu=null;if(this._scanDeviceSelector)this._scanDeviceSelector.destroy(),this._scanDeviceSelector=null;a.superclass.destroy.call(this);},getScanGettersList:function(){return this._checkScanDeviceSelectorCreated(),this._scanDeviceSelector.getList();},getLastSelectedDevice:function(){return this._checkScanDeviceSelectorCreated(),this._scanDeviceSelector.getLastSelectedDevice();},setLastSelectedDevice:function(e){return this._checkScanDeviceSelectorCreated(),this._scanDeviceSelector.setLastSelectedDevice(e);},_createItemsByScanGettersList:function(e,t){if(!e.length)return[{id:'',title:rk('Нет подключенных устройств')}];return e.map(function(e){var n=e.getGUID(),c={id:n,title:n};if(t&&n==t)c.className='sbis3plugin-attachTo-scan__lastSelectedDevice';return c;});},_createPopupMenu:function(e,t,c,r){var i=this,s=c.getContainer();return new n({element:e,items:t,idProperty:'id',displayProperty:'title',horizontalAlign:{side:'left'},verticalAlign:{offset:-4,side:'top'},corner:'tr',target:s,targetPart:true,parent:r,closeByExternalOver:true,handlers:{onMenuItemActivate:function(e,t){i.setLastSelectedDevice({scannerName:t}).addCallback(function(){i.getContainer().click();}).addErrback(function(e){o.resolve('ILogger').error('ScanDeviceSelectorRender',e);});}}});},_checkScanDeviceSelectorCreated:function(){if(!this._scanDeviceSelector)this._scanDeviceSelector=new c({scannerOptions:{mode:'always'}});}});return a;});
define('js!SBIS3.Plugin',['js!SBIS3.Plugin/Source/LocalService','SBIS3.Plugin_localization'],function(e){'use strict';return e;});
define('js!SBIS3.Plugin/Source/Protocol/Mixin/SpecialTypesMixin',['browser!js!SBIS3.Plugin/Source/Error/SpecialTypeError','SBIS3.Plugin_localization'],function(r){'use strict';return{_getSpecialTypeError:function(e){var n=e&&e.data&&e.data.errorType||e.answer&&e.answer.errorType,o=e&&e.data&&e.data.error||e.answer&&e.answer.error;if(r.errorsType.hasOwnProperty(n))return new r(r.errorsType[n],o,e.queryId||e.queryID);else return null;}};});
define('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport',['Core/moduleStubs','Core/Deferred','js!WS.Data/Di','SBIS3.Plugin_localization'],function(e,r,n){'use strict';return{_initExtension:function(n){return e.require(['browser!js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Diagnostic']).addCallback(function(i){var t=i[0],o=i[1],c=i[2],s=new r(),a,u;if(!t.hasService(n))return s.errback(new o(o.errorsType.INTERNAL_SERVER_ERROR,o.detailTypes.CLOSE_CONNECTION));if(a=t.getService(n),a.initExtensionDef)return a.initExtensionDef.createDependent();if(a.initExtensionDef=s.createDependent(),u=a.plugin,u)return s.callback(u),s;var S=a.name,l=a.version;return c.debug('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','_initExtension','Получаем экземпляр класса '+S+'-'+l),e.require(['browser!js!SBIS3.Plugin/Source/QueryManager/QueryManager']).addCallback(function(e){e[0].call(n,'getPlugin',[S,l]).addCallbacks(function(e){if(e){if(c.debug('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','_initExtension','Плагин '+S+'-'+l+' успешно создан'),'object'==typeof e)a.plugin=e;s.callback(e);}else s.errback(new o(o.errorsType.INTERNAL_SERVER_ERROR,o.detailTypes.PLUGIN_NOT_INIT));},function(e){c.error('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','_initExtension',o.detailStrings.CLOSE),c.error('js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','_initExtension',e.message),s.errback(e);});}),s;});},_inspectInnerServices:function(e,r,i){var t=this,o=Array.isArray?Array.isArray:$.isArray;if('object'===typeof e&&!o(e)){for(var c in e)if(e.hasOwnProperty(c)){var s=e[c];e[c]=t._inspectInnerServices(s,r,i);}var a=r.plugin;if(e&&e.objectID&&a&&a.objectID){var u={endpoint:r.endpoint,options:r.options},S=n.resolve('SBIS3.Plugin/Source/LocalService',u);S.setProvider('SBIS3.Plugin/Source/Provider/SbisPlugin');var l=S._guid,d;i.addService(l,u),(d=i.getService(l)).setProtocol(r.getProtocol()),d.plugin=e,d.parentID=r.guid,e.call=S.call.bind(S),e.getState=S.getState.bind(S),e.readyState=S.readyState,e.getObjectId=S.getObjectId.bind(S);}return e;}else if(o(e)){var g=e||[];return g.forEach(function(e,n){g[n]=t._inspectInnerServices(e,r,i);}),g||[];}return e;}};});
define('js!SBIS3.Plugin/Source/Protocol/Sbis3Plugin',['Core/Deferred','Core/IoC','Core/helpers/generate-helpers','Transport/RPCJSON','Core/core-merge','browser!js!SBIS3.Plugin/Source/Authenticate','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Protocol/Mixin/SpecialTypesMixin','SBIS3.Plugin_localization'],function(e,r,o,t,a,n,i,s){'use strict';var c={preparePacket:function(r,i,s,c){var l=new e({silent:true}),u=r.endpoint,p=r.name,R=r.version,S=u.contract,d=i,g=i.split('.');if(g.length>1)S=g[0],d=g[1];var y=t.jsonRpcPreparePacket(S+'.'+d,s),E=o.createGUID(),N={queryID:E,info:{moduleName:p,moduleVersion:R,objectName:S,method:d,params:s},options:{attemptSend:0},data:{serviceGuid:r.guid,protoVersion:1,queryId:E,accessToken:n.getToken(),moduleName:p,moduleVersion:R,query:y.reqBody}};if(c)a(N.options,c);return l.callback(N),l;},receiveAnswer:function(o){var t=o.type,a=new e({silent:true});if('answer'===t)try{var n=JSON.parse(o.data);if('object'===typeof n)n=n.result;a.callback(n);}catch(p){if(!(p instanceof Error||a.isReady())){var s=new i(i.errorsType.INTERNAL_CLIENT_ERROR,i.detailTypes.COMMUNICATION_ERROR,p);a.errback(s);}}else if('error'===t){var c,l,u=this._getSpecialTypeError(o);if(u)a.errback(u);else{try{if('RPC_ERROR'===o.data.errorType){var p=JSON.parse(o.data.error).error;c=p.message,l=p.data.error_code,l+='';}else c=o.data.error,l='';}catch(e){r.resolve('ILogger').error('SBIS3.Plugin/Source/Protocol/SbisPlugin.receiveAnswer','При разборе ответа произошла ошибка: '+e.message);}s=new i(i.errorsType.INTERNAL_SERVER_ERROR,l||i.detailTypes.COMMUNICATION_ERROR,c||o.error||i.detailTypes.UNKNOWN_SERVER_ERROR),a.errback(s);}}return a;},_getSpecialTypeError:function(e){return null;}};return a(c,s),c;});
define('js!SBIS3.Plugin/Source/Protocol/SbisPlugin',['Core/Deferred','Core/helpers/generate-helpers','Core/core-merge','browser!js!SBIS3.Plugin/Source/Authenticate','browser!js!SBIS3.Plugin/Source/ServiceManager/ServiceManager','browser!js!SBIS3.Plugin/Source/Protocol/OldExtensionsSupport','browser!js!SBIS3.Plugin/Source/Protocol/Mixin/SpecialTypesMixin','browser!js!SBIS3.Plugin/Source/Error/ConnectionError','browser!js!SBIS3.Plugin/Source/Error/ParamsValidationError','SBIS3.Plugin_localization'],function(e,r,t,a,n,i,s,l,o){'use strict';var c={preparePacket:function(r,t,a,n){var s=this,o=r.plugin;switch(t){case'getPlugin':case'releasePlugin':case'runUpdate':return this._preparePacket(null,t,a,null,n);default:var c;if(!o)c=i._initExtension(r.guid);else c=e.success(o);return c.addCallback(function(r){if(!r){var i=new l(l.errorsType.INTERACTION_ERROR,l.detailTypes.SERVER_CLOSE_CONNECTION,'СБИС Плагин закрыл соединение. Необходимо перезагрузить страницу.');return e.fail(i);}return s._checkMethod(r,t,a).addCallback(function(e){return s._preparePacket(r,t,e.params,e.paramsType,n);});});}},_preparePacket:function(n,i,s,l,o){var c=new e({silent:true}),u=r.createGUID(),p=n?n.objectID:void 0,f={queryID:u,info:{method:i,params:s},options:{attemptSend:0},data:{type:'call',queryID:u,accessToken:a.getToken(),method:i,objectID:p,Params:s,ParamsType:l}};if(o)t(f.options,o);return c.callback(f),c;},_checkMethod:function(r,t,a){var n=this,i=new e({silent:true}),s=[],l=Array.isArray?Array.isArray:$.isArray,c;if(r.methods.hasOwnProperty(t))c=r.methods[t]||[];else{var u=new o(o.detailTypes.FUNCTION_NOT_FOUND,'Метод '+t+' не найден');return i.errback(u);}if(!l(a)&&Object.keys(a).length>=0){for(var p in a)if(a.hasOwnProperty(p))s.push(a[p]);}else if(l(a))s=a;return n._callObjMethod(r,t,c,s).addCallbacks(function(e){i.callback(e);},function(e){i.errback(e);}),i;},_callObjMethod:function(r,t,a,n){var i=[],s=[],l=n.length,c,u,p,f=new e(),h,d;for(u=0,p=n.length;u<p;u++){var _=n[u],g=typeof _;if('undefined'===g||'function'===g||'number'===g&&(isNaN(_)||_===-1/0||_===1/0)){h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s);var y=new o(o.detailTypes.WRONG_ARGUMENT_TYPE,o.detailTypes.WRONG_ARGUMENT_TYPE+' Неподдерживаемый аргумент "'+_+'". Вызов: '+d+'. Доступные сигнатуры: '+h);return f.errback(y);}if('object'===g&&_ instanceof Array)g='array';i.push(_),s.push(g);}var T=0,E=void 0,S=0;if(a.forEach(function(e){if(e.length>T)T=e.length;if(void 0==E||e.length<E)if(!e.length)S++,E=0;else{for(c=0,p=e.length;c<p;c++)if(e[c].hasDefaultValue)break;E=c;}}),E>l||T<l)return h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s),y=new o(o.detailTypes.WRONG_ARGUMENTS_NUMBER,'Неверное количество аргументов. Вызов: '+d+'. Доступные сигнатуры: '+h),f.errback(y);if(0===l&&S>1)return h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s),y=new o(o.detailTypes.AMBIGUOUS_MATCH_EXCEPTION,'Двусмысленное представляение метода. Вызов: '+d+'. Доступные сигнатуры: '+h),f.errback(y);var N=null;for(c=0,p=a.length;c<p;c++){var R=a[c];if(0===l&&(!R.length||R[0].hasDefaultValue)){N=R;break;}else if(R.length>=l){var O=false;for(u=0;u<R.length&&!O;u++)if(u+1>l&&!R[u].hasDefaultValue||u+1<=l&&s[u]&&R[u].jsName!==s[u])O=true;if(!O)if(null===N)N=R;else return h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s),y=new o(o.detailTypes.AMBIGUOUS_MATCH_EXCEPTION,'Двусмысленное представляение метода. Вызов: '+d+'. Доступные сигнатуры: '+h),f.errback(y);}}if(null===N)return h=this._getExpectedSignatures(t,a),d=this._getCalledSignature(t,s),y=new o(o.detailTypes.FUNCTION_NOT_FOUND,'Не найдена функция соотвествующая параметрам. Вызов: '+d+'. Доступные сигнатуры: '+h),f.errback(y);return f.callback({params:i,paramsType:N}),f;},receiveAnswer:function(r,t){var a=r.type,s=r.answer,o=new e(),c;if('answer'===a)if(s&&'object'===typeof s)try{if(c=this._getSpecialTypeError(r),c)o.errback(c);else{s=this._parseAnswer(o,s);var u=i._inspectInnerServices(s,t,n);o.callback(u);}}catch(f){if(!(f instanceof Error||o.isReady())){var p=new l(l.errorsType.INTERNAL_CLIENT_ERROR,l.detailTypes.COMMUNICATION_ERROR,f);o.errback(p);}}else o.callback(s);else if('error'===a)if(c=this._getSpecialTypeError(r),c)o.errback(c);else{var f=new l(l.errorsType.INTERNAL_SERVER_ERROR,r.errorType||l.detailTypes.COMMUNICATION_ERROR,r.error||l.detailTypes.UNKNOWN_SERVER_ERROR);o.errback(f);}return o;},_getExpectedSignatures:function(e,r){var t='';return r.forEach(function(r){var a=r.reduce(function(e,r){return e=''!==e?e+', ':e,e+(r?r.jsName:'');},'');t=''!==t?t+' | ':t,t+=e+'('+a+')';}),t;},_getCalledSignature:function(e,r){return e+'('+r.reduce(function(e,r){return e=''!==e?e+', ':e,e+r;},'')+')';},_parseAnswer:function(e,r){var t=r.type,a=this;if(delete r.type,'object'===t&&'JsonObject'===r.name)delete r.name;if('object'===t){var n=r.objectID,i={},s={};for(var c in r){if(!r.hasOwnProperty(c))continue;var u=r[c];if(u&&'object'===typeof u)if('method'===u.type){if(!u.parametersType){var p=new o(o.detailTypes.UNKNOWN_FUNCTION_PARAMS);throw e.errback(p),p;}var f=c.split('@')[0];if(s[f])s[f].push(u.parametersType);else s[f]=[u.parametersType];}else i[c]=a._parseAnswer(e,u);else i[c]=u;}if(n)if(!s.length)i['methods']=s;return i;}else if('array'===t){var h=r.array||[];return h.forEach(function(r,t){h[t]=a._parseAnswer(e,r);}),r.array||[];}else if('error'===t)throw p=new l(l.errorsType.INTERNAL_SERVER_ERROR,r.errorType||l.detailTypes.COMMUNICATION_ERROR,r.error||l.detailTypes.UNKNOWN_SERVER_ERROR),e.errback(p),p;else return r;},_getSpecialTypeError:function(e){return null;}};return t(c,s),c;});
define('js!SBIS3.Plugin/Source/Transport/resources/NmhWebSocket',['js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization'],function(e){'use strict';if('undefined'===typeof window)return null;var t=0,r={},o=function(e){var n=this;n.url=e,n.__id=t++,r[n.__id]=n,n.readyState=o.NONE,setTimeout(function(){n.open(n.url);},0),this.onopen,this.onclose,this.onmessage,this.onerror;function a(e,t,r){if(e!=n.__id&&-1!=e)return;switch(t){case'connect':if(n.readyState!=o.CONNECTING)return void o.logger.error('commandParser: id='+n.__id+', cmd='+t+', readyState='+n.readyState+', get unknown request');if(n.readyState=o.OPEN,n.onopen)n.onopen();break;case'disconnect':if(n.readyState!=o.OPEN&&n.readyState!=o.CLOSING)return void o.logger.error('commandParser: id='+n.__id+', cmd='+t+', readyState='+n.readyState+', get unknown request');var a=n.readyState==o.CLOSING;if(n.readyState=o.CLOSED,n.onclose)n.onclose(a);break;case'message':if(n.readyState!=o.OPEN)return void o.logger.error('commandParser: id='+n.__id+', cmd='+t+', readyState='+n.readyState+', get unknown request');if(n.onmessage)n.onmessage({type:'message',data:r});break;case'error':if(n.readyState!=o.CONNECTING&&n.readyState!=o.OPEN&&n.readyState!=o.CLOSING)return void o.logger.error('commandParser: id='+n.__id+', cmd='+t+', readyState='+n.readyState+', get unknown request');if(n.readyState=o.CLOSING,n.onerror)n.onerror({type:'error',message:JSON.stringify({type:'INTERNAL_SERVER_ERROR',description:'UNABLE_TO_CONNECT'})});if(n.onclose)n.onclose(true);}}function i(e){if(e.source!=window)return;if(e.data.type&&'FROM_CONTENT_SCRIPT_TO_WEB_PAGE'==e.data.type)a(e.data.id,e.data.cmd,e.data.data);}window.addEventListener('message',i),window.onbeforeunload=function(){n.close();};};o.NONE=-1,o.CONNECTING=0,o.OPEN=1,o.CLOSING=2,o.CLOSED=3,o.logger={log:function(t){e.debug('NMH','log',t);},error:function(t){e.error('NMH','log',t);},info:function(t){e.info('NMH','log',t);}},o.initialize=function(e){o.callbackFn=e,n();};function n(){if(!document.getElementById('nmhContainer')){var e=document.createElement('link');e.id='nmhContainer',e.rel='chrome-webstore-item',e.href='https://chrome.google.com/webstore/detail/pbcgcpeifkdjijdjambaakmhhpkfgoec',document.head.appendChild(e);}if(window.sbisPluginExtensionInfo)return void o.callbackFn({success:true,id:'nmhWebSocket'});if('undefined'==typeof chrome)o.logger.log('Fail: It\'s not chrome'),o.callbackFn({success:false,id:'nmhWebSocket'});else if(!chrome.app.isInstalled)try{chrome.webstore.install('https://chrome.google.com/webstore/detail/pbcgcpeifkdjijdjambaakmhhpkfgoec',a,i);}catch(e){o.logger.log('Fail app install: '+e),o.callbackFn({success:false,id:'nmhWebSocket'});}}function a(){o.callbackFn({success:true,id:'nmhWebSocket'});}function i(){o.callbackFn({success:false,id:'nmhWebSocket'});}return o.prototype.getId=function(){return this.__id;},o.prototype.open=function(e){if(this.readyState!=o.NONE)return o.logger.error('INVALID_STATE_ERR: Web Socket connection is already open, id='+this.__id+', readyState='+this.readyState),false;var t=false;if('undefined'!==typeof window)t=window.SPDebug();return window.postMessage({type:'FROM_WEB_PAGE_TO_CONTENT_SCRIPT',id:this.__id,cmd:'configure',data:JSON.stringify({debug:t})},'*'),this.readyState=o.CONNECTING,window.postMessage({type:'FROM_WEB_PAGE_TO_CONTENT_SCRIPT',id:this.__id,cmd:'connect',data:e},'*'),true;},o.prototype.send=function(e){if(this.readyState!=o.OPEN)return o.logger.error('INVALID_STATE_ERR: Web Socket connection has not been established, id='+this.__id+', readyState='+this.readyState),false;if('string'!=typeof e)return o.logger.error('INVALID_STATE_ERR: Web Socket message is invalid, id='+this.__id+', typeof='+typeof e),false;return window.postMessage({type:'FROM_WEB_PAGE_TO_CONTENT_SCRIPT',id:this.__id,cmd:'message',data:e},'*'),true;},o.prototype.close=function(){if(this.readyState!=o.OPEN)return o.logger.error('INVALID_STATE_ERR: Web Socket connection has not been established, id='+this.__id+', readyState='+this.readyState),false;return this.readyState=o.CLOSING,window.postMessage({type:'FROM_WEB_PAGE_TO_CONTENT_SCRIPT',id:this.__id,cmd:'disconnect'},'*'),true;},o;});
define('js!SBIS3.Plugin/Source/Transport/resources/SwfObject',['SBIS3.Plugin_localization'],function(){if('undefined'===typeof window)return null;var e=function(){var e='A'+['ctiv'].concat('bject').join('eXO'),t=function(){return this||(0,eval)('this');}()[e];if(t)return function e(i){return new t(i);};}();function t(){var i='undefined',n='object',r='Shockwave Flash',a='ShockwaveFlash.ShockwaveFlash',o='application/x-shockwave-flash',s='SWFObjectExprInst',l='onreadystatechange',f=window,u=document,d=navigator,c=false,p=[],v=[],y=[],h=[],m,g,w,b,E=false,C=false,S,T,A=true,N=false,O=function(){var t=typeof u.getElementById!==i&&typeof u.getElementsByTagName!==i&&typeof u.createElement!==i,s=d.userAgent.toLowerCase(),l=d.platform.toLowerCase(),f=l?/win/.test(l):/win/.test(s),p=l?/mac/.test(l):/mac/.test(s),v=/webkit/.test(s)?parseFloat(s.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,'$1')):false,y='Microsoft Internet Explorer'===d.appName,h=[0,0,0],m=null;if(typeof d.plugins!==i&&typeof d.plugins[r]===n){if(m=d.plugins[r].description,m&&typeof d.mimeTypes!==i&&d.mimeTypes[o]&&d.mimeTypes[o].enabledPlugin)c=true,y=false,m=m.replace(/^.*\s+(\S+\s+\S+$)/,'$1'),h[0]=X(m.replace(/^(.*)\..*$/,'$1')),h[1]=X(m.replace(/^.*\.(.*)\s.*$/,'$1')),h[2]=/[a-zA-Z]/.test(m)?X(m.replace(/^.*[a-zA-Z]+(.*)$/,'$1')):0;}else if(e)try{var g=e(a);if(g)if(m=g.GetVariable('$version'),m)y=true,h=[X((m=m.split(' ')[1].split(','))[0]),X(m[1]),X(m[2])];}catch(e){}return{w3:t,pv:h,wk:v,ie:y,win:f,mac:p};}(),k=function(){if(!O.w3)return;if(typeof u.readyState!==i&&('complete'===u.readyState||'interactive'===u.readyState)||typeof u.readyState===i&&(u.getElementsByTagName('body')[0]||u.body))B();if(!E){if(typeof u.addEventListener!==i)u.addEventListener('DOMContentLoaded',B,false);if(O.ie)if(u.attachEvent(l,function e(){if('complete'===u.readyState)u.detachEvent(l,e),B();}),f==top)(function e(){if(E)return;try{u.documentElement.doScroll('left');}catch(t){return void setTimeout(e,0);}B();}());if(O.wk)(function e(){if(E)return;if(!/loaded|complete/.test(u.readyState))return void setTimeout(e,0);B();}());}}();function B(){if(E||!document.getElementsByTagName('body')[0])return;try{var e,t=z('span');t.style.display='none',(e=u.getElementsByTagName('body')[0].appendChild(t)).parentNode.removeChild(e),e=null,t=null;}catch(e){return;}E=true;for(var i=p.length,n=0;n<i;n++)p[n]();}function I(e){if(E)e();else p[p.length]=e;}function L(e){if(typeof f.addEventListener!==i)f.addEventListener('load',e,false);else if(typeof u.addEventListener!==i)u.addEventListener('load',e,false);else if(typeof f.attachEvent!==i)Z(f,'onload',e);else if('function'===typeof f.onload){var t=f.onload;f.onload=function(){t(),e();};}else f.onload=e;}function P(){var e=u.getElementsByTagName('body')[0],t=z(n);t.setAttribute('style','visibility: hidden;'),t.setAttribute('type',o);var r=e.appendChild(t);if(r){var a=0;(function n(){if(typeof r.GetVariable!==i)try{var o=r.GetVariable('$version');if(o)o=o.split(' ')[1].split(','),O.pv=[X(o[0]),X(o[1]),X(o[2])];}catch(e){O.pv=[8,0,0];}else if(a<10)return a++,void setTimeout(n,10);e.removeChild(t),r=null,x();}());}else x();}function x(){var e=v.length;if(e>0)for(var t=0;t<e;t++){var n=v[t].id,r=v[t].callbackFn,a={success:false,id:n};if(O.pv[0]>0){var o=J(n);if(o)if(Q(v[t].swfVersion)&&!(O.wk&&O.wk<312)){if(K(n,true),r)a.success=true,a.ref=F(n),a.id=n,r(a);}else if(v[t].expressInstall&&$()){var s={};if(s.data=v[t].expressInstall,s.width=o.getAttribute('width')||'0',s.height=o.getAttribute('height')||'0',o.getAttribute('class'))s.styleclass=o.getAttribute('class');if(o.getAttribute('align'))s.align=o.getAttribute('align');for(var l={},f=o.getElementsByTagName('param'),u=f.length,d=0;d<u;d++)if('movie'!==f[d].getAttribute('name').toLowerCase())l[f[d].getAttribute('name')]=f[d].getAttribute('value');M(s,l,n,r);}else if(j(o),r)r(a);}else if(K(n,true),r){var c=F(n);if(c&&typeof c.SetVariable!==i)a.success=true,a.ref=c,a.id=c.id;r(a);}}}p[0]=function(){if(c)P();else x();};function F(e){var t=null,r=J(e);if(r&&'OBJECT'===r.nodeName.toUpperCase())if(typeof r.SetVariable!==i)t=r;else t=r.getElementsByTagName(n)[0]||r;return t;}function $(){return!C&&Q('6.0.65')&&(O.win||O.mac)&&!(O.wk&&O.wk<312);}function M(e,t,n,r){var a=J(n);if(n=G(n),C=true,w=r||null,b={success:false,id:n},a){if('OBJECT'===a.nodeName.toUpperCase())m=U(a),g=null;else m=a,g=n;if(e.id=s,typeof e.width===i||!/%$/.test(e.width)&&X(e.width)<310)e.width='310';if(typeof e.height===i||!/%$/.test(e.height)&&X(e.height)<137)e.height='137';var o=O.ie?'ActiveX':'PlugIn',l='MMredirectURL='+encodeURIComponent(f.location.toString().replace(/&/g,'%26'))+'&MMplayerType='+o+'&MMdoctitle='+encodeURIComponent(u.title.slice(0,47)+' - Flash Player Installation');if(typeof t.flashvars!==i)t.flashvars+='&'+l;else t.flashvars=l;if(O.ie&&4!=a.readyState){var d=z('div');n+='SWFObjectNew',d.setAttribute('id',n),a.parentNode.insertBefore(d,a),a.style.display='none',H(a);}V(e,t,n);}}function j(e){if(O.ie&&4!=e.readyState){e.style.display='none';var t=z('div');e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(U(e),t),H(e);}else e.parentNode.replaceChild(U(e),e);}function U(e){var t=z('div');if(O.win&&O.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(n)[0];if(i){var r=i.childNodes;if(r)for(var a=r.length,o=0;o<a;o++)if(!(1==r[o].nodeType&&'PARAM'===r[o].nodeName)&&!(8==r[o].nodeType))t.appendChild(r[o].cloneNode(true));}}return t;}function R(e,t){var i=z('div');return i.innerHTML='<object classid=\'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\'><param name=\'movie\' value=\''+e+'\'>'+t+'</object>',i.firstChild;}function V(e,t,r){var a,s=J(r);if(r=G(r),O.wk&&O.wk<312)return a;if(s){var l=O.ie?z('div'):z(n),f,u,d;if(typeof e.id===i)e.id=r;for(d in t)if(t.hasOwnProperty(d)&&'movie'!==d.toLowerCase())D(l,d,t[d]);if(O.ie)l=R(e.data,l.innerHTML);for(f in e)if(e.hasOwnProperty(f))if(u=f.toLowerCase(),'styleclass'===u)l.setAttribute('class',e[f]);else if('classid'!==u&&'data'!==u)l.setAttribute(f,e[f]);if(O.ie)y[y.length]=e.id;else l.setAttribute('type',o),l.setAttribute('data',e.data);s.parentNode.replaceChild(l,s),a=l;}return a;}function D(e,t,i){var n=z('param');n.setAttribute('name',t),n.setAttribute('value',i),e.appendChild(n);}function H(e){var t=J(e);if(t&&'OBJECT'===t.nodeName.toUpperCase())if(O.ie)t.style.display='none',function e(){if(4==t.readyState){for(var i in t)if(t.hasOwnProperty(i)&&'function'===typeof t[i])t[i]=null;t.parentNode.removeChild(t);}else setTimeout(e,10);}();else t.parentNode.removeChild(t);}function W(e){return e&&e.nodeType&&1===e.nodeType;}function G(e){return W(e)?e.id:e;}function J(e){if(W(e))return e;var t=null;try{t=u.getElementById(e);}catch(e){}return t;}function z(e){return u.createElement(e);}function X(e){return parseInt(e,10);}function Z(e,t,i){e.attachEvent(t,i),h[h.length]=[e,t,i];}function Q(e){e+='';var t=O.pv,i=e.split('.');return i[0]=X(i[0]),i[1]=X(i[1])||0,i[2]=X(i[2])||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]?true:false;}function q(e,t,n,r){var a=u.getElementsByTagName('head')[0];if(!a)return;var o='string'===typeof n?n:'screen';if(r)S=null,T=null;if(!S||T!=o){var s=z('style');if(s.setAttribute('type','text/css'),s.setAttribute('media',o),S=a.appendChild(s),O.ie&&typeof u.styleSheets!==i&&u.styleSheets.length>0)S=u.styleSheets[u.styleSheets.length-1];T=o;}if(S)if(typeof S.addRule!==i)S.addRule(e,t);else if(typeof u.createTextNode!==i)S.appendChild(u.createTextNode(e+' {'+t+'}'));}function K(e,t){if(!A)return;var i=t?'visible':'hidden',n=J(e);if(E&&n)n.style.visibility=i;else if('string'===typeof e)q('#'+e,'visibility:'+i);}function Y(e){return null!==/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!==i?encodeURIComponent(e):e;}var _=function(){if(O.ie)window.attachEvent('onunload',function(){for(var e=h.length,i=0;i<e;i++)h[i][0].detachEvent(h[i][1],h[i][2]);for(var n=y.length,r=0;r<n;r++)H(y[r]);for(var a in O)if(O.hasOwnProperty(a))O[a]=null;O=null;for(var o in t)if(t.hasOwnProperty&&t.hasOwnProperty(o))t[o]=null;t=null;});}();return{registerObject:function(e,t,i,n){if(O.w3&&e&&t){var r={};r.id=e,r.swfVersion=t,r.expressInstall=i,r.callbackFn=n,v[v.length]=r,K(e,false);}else if(n)n({success:false,id:e});},getObjectById:function(e){if(O.w3)return F(e);},embedSWF:function(e,t,r,a,o,s,l,f,u,d){var c=G(t),p={success:false,id:c};if(O.w3&&!(O.wk&&O.wk<312)&&e&&t&&r&&a&&o)K(c,false),I(function(){r+='',a+='';var v={};if(u&&typeof u===n)for(var y in u)if(u.hasOwnProperty(y))v[y]=u[y];v.data=e,v.width=r,v.height=a;var h={};if(f&&typeof f===n)for(var m in f)if(f.hasOwnProperty(m))h[m]=f[m];if(l&&typeof l===n)for(var g in l)if(l.hasOwnProperty(g)){var w=N?encodeURIComponent(g):g,b=N?encodeURIComponent(l[g]):l[g];if(typeof h.flashvars!==i)h.flashvars+='&'+w+'='+b;else h.flashvars=w+'='+b;}if(Q(o)){var E=V(v,h,t);if(v.id==c)K(c,true);p.success=true,p.ref=E,p.id=E.id;}else if(s&&$())return v.data=s,void M(v,h,t,d);else K(c,true);if(d)d(p);});else if(d)d(p);},switchOffAutoHideShow:function(){A=false;},enableUriEncoding:function(e){N=typeof e===i?true:e;},ua:O,getFlashPlayerVersion:function(){return{major:O.pv[0],minor:O.pv[1],release:O.pv[2]};},hasFlashPlayerVersion:Q,createSWF:function(e,t,i){if(O.w3)return V(e,t,i);else return;},showExpressInstall:function(e,t,i,n){if(O.w3&&$())M(e,t,i,n);},removeSWF:function(e){if(O.w3)H(e);},createCSS:function(e,t,i,n){if(O.w3)q(e,t,i,n);},addDomLoadEvent:I,addLoadEvent:L,getQueryParamValue:function(e){var t=u.location.search||u.location.hash;if(t){if(/\?/.test(t))t=t.split('?')[1];if(!e)return Y(t);for(var i=t.split('&'),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf('='))==e)return Y(i[n].substring(i[n].indexOf('=')+1));}return'';},expressInstallCallback:function(){if(C){var e=J(s);if(e&&m){if(e.parentNode.replaceChild(m,e),g)if(K(g,true),O.ie)m.style.display='block';if(w)w(b);}C=false;}},version:'2.3'};}var i=null;return function(){return i||(i=t());};});
define('js!SBIS3.Plugin/Source/Transport/resources/WebSocket',['browser!js!SBIS3.Plugin/Source/Transport/resources/SwfObject','Core/constants','js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization'],function(e,t,i){'use strict';if('undefined'===typeof window)return null;var n=function(e,t,i,l,s){var a=this;if(a.url=e,a.__id=n.__nextId++,n.__instances[a.__id]=a,a.readyState=n.CONNECTING,a.bufferedAmount=0,a.__events={},!t)t=[];else if('string'==typeof t)t=[t];a.__createTask=setTimeout(function(){n.__addTask(function(){a.__createTask=null,n.__flash.create(a.__id,e,t,i||null,l||0,s||null,0==a.__id?4000:1500);});},0);};return n.prototype.getId=function(){return this.__id;},n.prototype.send=function(e){if(this.readyState==n.CONNECTING)return n.logger.error('INVALID_STATE_ERR: Web Socket connection has not been established'),false;var t=n.__flash.send(this.__id,encodeURIComponent(e));if(t<0)return true;else return this.bufferedAmount+=t,false;},n.prototype.close=function(){if(this.__createTask)return clearTimeout(this.__createTask),this.__createTask=null,void(this.readyState=n.CLOSED);if(this.readyState==n.CLOSED||this.readyState==n.CLOSING)return;this.readyState=n.CLOSING,n.__flash.close(this.__id);},n.prototype.addEventListener=function(e,t){if(!(e in this.__events))this.__events[e]=[];this.__events[e].push(t);},n.prototype.removeEventListener=function(e,t){if(!(e in this.__events))return;for(var i=this.__events[e],n=i.length-1;n>=0;--n)if(i[n]===t){i.splice(n,1);break;}},n.prototype.dispatchEvent=function(e){for(var t=this.__events[e.type]||[],i=0;i<t.length;++i)t[i](e);var n=this['on'+e.type];if(n)n.apply(this,[e]);},n.prototype.__handleEvent=function(e){if('readyState'in e)this.readyState=e.readyState;if('protocol'in e)this.protocol=e.protocol;var t;if('open'==e.type||'error'==e.type)t=this.__createSimpleEvent(e.type);else if('close'==e.type)(t=this.__createSimpleEvent('close')).wasClean=e.wasClean?true:false,t.code=e.code,t.reason=e.reason;else if('message'==e.type){var i=decodeURIComponent(e.message);t=this.__createMessageEvent('message',i);}else throw new Error('Unknown event type: '+e.type);this.dispatchEvent(t);},n.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent('Event');return t.initEvent(e,false,false),t;}else return{type:e,bubbles:false,cancelable:false};},n.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera)try{var i=new MessageEvent('message',{bubbles:false,cancelable:false,data:t,source:window});return i;}catch(e){if((i=document.createEvent('MessageEvent')).initMessageEvent)return i.initMessageEvent('message',false,false,t,null,null,window,null),i;throw new Error('Can\'t create message event, for event type: '+flashEvent.type);}else return{type:e,data:t,bubbles:false,cancelable:false};},n.CONNECTING=0,n.OPEN=1,n.CLOSING=2,n.CLOSED=3,n.__isFlashImplementation=true,n.__initialized=false,n.__flash=null,n.__instances={},n.__tasks=[],n.__nextId=0,n.__initTimeout=void 0,n.__initCallbacks=[],n.__initTimeoutFired=false,n.__initializeCalled=false,n.logger={log:function(e){i.debug('FLASH','log',e);},error:function(e){i.error('FLASH','log',e);},info:function(e){i.info('FLASH','log',e);}},n.loadFlashPolicyFile=function(e){n.__addTask(function(){n.__flash.loadManualPolicyFile(e);});},n.initialize=function(e){$(document).ready(function(){n.__initialize(e);});},n.__ready=function(e){if(n.logger.log('Calling __ready',true),clearTimeout(n.__initTimeout),n.__initTimeout=void 0,n.__initTimeoutFired=true,n.logger.log('e.ref.create = '+e.ref.create,true),n.logger.log('__initializeCalled = '+n.__initializeCalled,true),!e.ref.create||!n.__initializeCalled)e.success=false,e.blocked=true,$('html').find('#sbisPluginFlash').remove();n.logger.log('Flash instance '+(e.success?'':'not ')+'created',true);for(var t=0,i=n.__initCallbacks.length;t<i;t++)n.__initCallbacks[t](e);n.__initCallbacks=[];},n.__callback=function(e,t,i){if(n.logger.log('Embed flash callback'),e.success){if(e.ref.create)n.logger.log('Embed flash success',true),t(e);else if(n.logger.log('Embed flash success but instance not created',true),n.__initCallbacks.push(t),i&&!n.__initTimeout){n.logger.log('Timeout 4s to create instance',true);var l=n.__ready.bind(void 0,e);n.__initTimeout=setTimeout(l,4000),n.__tasks.push(l);}}else n.logger.log('Embed flash error'),t(e);},n.__initialize=function(i){if(n.__initialized&&n.__initializeCalled)return(r={ref:document.getElementById('sbisPluginFlash')}).success=r.ref?true:false,void n.__callback(r,i,n.__initTimeoutFired);n.logger.log('Initialize flash'),n.__initialized=true;var l=document.createElement('div');if(l.id='sbisPluginContainer',l.style.position='absolute',n.__isFlashLite())l.style.left='0px',l.style.top='0px';else l.style.left='-100px',l.style.top='-100px';var s=$('html');if(!s.find('#sbisPluginFlash').length){var a=document.createElement('div');a.id='sbisPluginFlash',l.appendChild(a),s.append(l),n.logger.log('Embed flash'),e().embedSWF(t.resourceRoot+'SBIS3.Plugin/Source/Transport/resources/WebSocketMain'+(t.buildnumber?'.v'+t.buildnumber:'')+'.swf','sbisPluginFlash','10','10','16.0.0',null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:'always'},null,function(e){n.logger.log('Calling callback from embedSWF',true),n.__callback(e,i,true);});}else{var r={ref:document.getElementById('sbisPluginFlash')};r.success=r.ref?true:false,n.logger.log('Calling callback from existing SWF',true),n.__callback(r,i,true);}},n.__onFlashInitialized=function(){n.logger.log('Calling __onFlashInitialized',true),setTimeout(function(){n.logger.log('sbisPluginFlash Container: '+document.getElementById('sbisPluginFlash'),true),n.__flash=document.getElementById('sbisPluginFlash'),n.__flash.setCallerUrl(location.href),n.__flash.setDebug('undefined'!==typeof window?window.SPDebug&&window.SPDebug():false),n.__initializeCalled=true;for(var e=0;e<n.__tasks.length;++e)n.__tasks[e]();n.__tasks=[];},0);},n.__onFlashEvent=function(){return setTimeout(function(){try{for(var e=n.__flash.receiveEvents(),t=0;t<e.length;++t)n.__instances[e[t].webSocketId].__handleEvent(e[t]);}catch(e){n.logger.error(e);}},0),true;},n.__log=function(e){n.logger.log(decodeURIComponent(e));},n.__error=function(e){if(e=decodeURIComponent(e),/Error #2048/.test(e))n.logger.info(e);else n.logger.error(e);},n.__addTask=function(e){if(n.__flash)e();else n.__tasks.push(e);},n.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return false;var e=window.navigator.mimeTypes['application/x-shockwave-flash'];if(!e||!e.enabledPlugin||!e.enabledPlugin.filename)return false;return e.enabledPlugin.filename.match(/flashlite/i)?true:false;},n;});
define('js!SBIS3.Plugin/Source/Transport/resources/WebSocketExternal',['SBIS3.Plugin_localization'],function(){'use strict';if('undefined'===typeof window)return null;var e=false,t={},n=1,i=function(e){var s=this;s.url=e,s.__id=n++,t[s.__id]=s,s.readyState=i.CONNECTING,s.__events={},setTimeout(function(){s.readyState=i.OPEN,t[s.__id].dispatchEvent(r('open'));},0);};i.prototype.getId=function(){return this.__id;},i.prototype.send=function(e){if(this.readyState==i.CONNECTING)return i.logger.error('INVALID_STATE_ERR: Web Socket connection has not been established'),false;return window.external.sendMessage(document.body.id||'undefined',this.__id,e);},i.prototype.close=function(){var e=this;if(this.readyState==i.CLOSED||this.readyState==i.CLOSING)return;this.readyState=i.CLOSING,setTimeout(function(){e.readyState=i.CLOSED,t[e.__id].dispatchEvent(r('close'));},0);},i.prototype.addEventListener=function(e,t){if(!(e in this.__events))this.__events[e]=[];this.__events[e].push(t);},i.prototype.removeEventListener=function(e,t){if(!(e in this.__events))return;for(var n=this.__events[e],i=n.length-1;i>=0;--i)if(n[i]===t){n.splice(i,1);break;}},i.prototype.dispatchEvent=function(e){for(var t=this.__events[e.type]||[],n=0;n<t.length;++n)t[n](e);var i=this['on'+e.type];if(i)i.apply(this,[e]);},i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.__isWindowExternalImplementation=true,i.logger={log:function(){},error:function(){},info:function(){}},i.initialize=function(t){if(window.external&&'sendMessage'in window.external)e=true,window.processAnswer=s;t({success:e,id:'webSocketExternal',ref:void 0});};function s(e,n){t[e].dispatchEvent(o('message',n));}function r(e){if(document.createEvent&&window.Event){var t=document.createEvent('Event');return t.initEvent(e,false,false),t;}else return{type:e,bubbles:false,cancelable:false};}function o(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent('MessageEvent');if(n.initMessageEvent)n.initMessageEvent(e,false,false,t,null,null,window,null);else n=new MessageEvent(e,{bubbles:false,cancelable:false,data:t,source:window});return n;}else return{type:e,data:t,bubbles:false,cancelable:false};}return i;});
define('js!SBIS3.Plugin/Source/Transport/resources/WebSocketNative',['Core/Deferred','js!SBIS3.Plugin/Source/Diagnostic','SBIS3.Plugin_localization'],function(e,o){'use strict';if('undefined'===typeof window)return null;var n=0,t=function(e){try{var o=new WebSocket(e);if(o.__id=n++,o.getId=function(){return this.__id;},3===o.readyState)t.logger.log('SbisPluginTransport не может создать соединение через Native WebSocket');}catch(e){return t.logger.log('SbisPluginTransport не может создать соединение через Native WebSocket, заблокировано политиками безопасности'),{isBlocked:true};}return o;};t.initialize=function(e,o){i(e,o);},t.logger={log:function(e){o.debug('WEBSOCKET','log',e);},error:function(e){o.error('WEBSOCKET','log',e);},info:function(e){o.info('WEBSOCKET','log',e);}};function i(o,n){t.logger.log('SbisPluginTransport попытка подключения по Native WebSocket:'+o);try{var i=new WebSocket(o),r=setTimeout(function(){i.onclose();},5000),c=new e({silent:true});if(c.addCallbacks(function(){n({success:true});},function(){n({success:false});}).addBoth(function(){clearTimeout(r);}),i.onopen=function(e){if(!c.isReady())c.callback();i.close();},i.onerror=function(e){if(!c.isReady())c.errback();},i.onclose=function(e){if(!c.isReady())c.errback();},3==i.readyState)t.logger.log('SbisPluginTransport не может создать соединение через Native WebSocket');}catch(e){t.logger.log('SbisPluginTransport не может создать соединение через Native WebSocket, заблокировано политиками безопасности'),n({success:false});}}return t;});
define('js!SBIS3.Plugin/Source/Transport/resources/WebSocketQt',['Core/constants','Core/helpers/collection-helpers','Core/helpers/helpers','SBIS3.Plugin_localization'],function(e,t,n){'use strict';if('undefined'===typeof window)return null;var r=false,i=null,s={},a=[],o=0,c=function(e){var t=this;t.url=e,t.__id=o++,s[t.__id]=t,t.readyState=c.CONNECTING,t.__events={},t.__createTask=setTimeout(function(){b(function(){if(t.__createTask=null,i.version<'1.1.0.0')i.create(t.__id,e,location.href);else if(t.__id=i.create(),t.__id)s[t.__id]=t;else t.readyState=c.CLOSED;});},0);};c.prototype.getId=function(){return this.__id;},c.prototype.send=function(e){if(this.readyState==c.CONNECTING)return c.logger.error('INVALID_STATE_ERR: Web Socket connection has not been established'),false;return i.send(this.__id,e)<0;},c.prototype.close=function(){if(this.__createTask)return clearTimeout(this.__createTask),this.__createTask=null,void(this.readyState=c.CLOSED);if(this.readyState==c.CLOSED||this.readyState==c.CLOSING)return;if(this.readyState=c.CLOSING,i.version<'1.1.0.0')i.close(this.__id);else i.destroy(this.__id);},c.prototype.addEventListener=function(e,t){if(!(e in this.__events))this.__events[e]=[];this.__events[e].push(t);},c.prototype.removeEventListener=function(e,t){if(!(e in this.__events))return;for(var n=this.__events[e],r=n.length-1;r>=0;--r)if(n[r]===t){n.splice(r,1);break;}},c.prototype.dispatchEvent=function(e){for(var t=this.__events[e.type]||[],n=0;n<t.length;++n)t[n](e);var r=this['on'+e.type];if(r)r.apply(this,[e]);},c.CONNECTING=0,c.OPEN=1,c.CLOSING=2,c.CLOSED=3,c.__isQtImplementation=true,c.logger={log:function(){},error:function(){},info:function(){}},c.initialize=function(e){l(e);};function l(t){var s={success:false,id:'sbisPluginQt',idClient:'sbisPluginClient',ref:void 0},o=function(e){s.success=false,s.blocked=e,t(s);};if(r)return s.ref=document.getElementById(s.id),s.success=s.ref?true:false,void t(s);else if(e.browser.chrome||e.browser.operaChrome)return void o();var c=document.createElement('div'),l='';if($(c).css({width:'1px',height:'1px',position:'absolute',top:'-100px',left:'-100px'}),e.browser.isIE)l='<object id="'+s.id+'" classid="CLSID:AD7BA4D6-DE06-4D5D-BA2B-E1FD7BEE1E8F" width="0" height="0"></object>';else l='<object id="'+s.id+'" type="application/x-sbis-websockets" width="0" height="0"></object>',l+='<object id="'+s.idClient+'" type="application/x-sbis-plugin-client" width="0" height="0"><param name="onload" value="pluginLoaded"/></object>';if(!$('html').find('#sbisPluginContainer').length)$('html').get(0).appendChild(c),c.id='sbisPluginContainer',c.innerHTML=l;if(e.browser.isIE)try{n.axo('npSbisPluginClient.SbisPluginClient');}catch(e){return o();}else{var u='application/x-sbis-websockets',f='application/x-sbis-plugin-client',d=true,v=true;if(navigator.plugins.refresh(),!(navigator.mimeTypes[u]&&navigator.mimeTypes[u].enabledPlugin))d=false;if(!(navigator.mimeTypes[f]&&navigator.mimeTypes[f].enabledPlugin))v=false;if(!d&&!v)return o();}setTimeout(function(){var n=null,c=null;if(e.browser.isIE)s.ref=document.getElementById(s.id);else n=document.getElementById(s.id),c=document.getElementById(s.idClient);if(!e.browser.isIE&&!n.create&&!c.create)return o(true);if(!e.browser.isIE&&n.create)s.ref=n;if(!e.browser.isIE&&c.create)s.ref=c,s.id=s.idClient;if(r=true,i=s.ref,i.version)if(i.version<'1.1.0.0')y();else _(i,'event',m);else return o();for(var l=0;l<a.length;++l)a[l]();a=[],s.success=true,t(s);},0);}function u(e,t){var n=s[e];switch(t){case'HostLookup':case'Connecting':n.readyState=c.CONNECTING;break;case'Connected':n.readyState=c.OPEN;break;case'Closing':n.readyState=c.CLOSING;break;case'Unconnected':n.readyState=c.CLOSED;}}function f(e){s[e].dispatchEvent(h('open'));}function d(e){s[e].dispatchEvent(h('close'));}function v(e,n){var r=[];(function e(t){var n=t.indexOf('}{');if(n>-1)r.push(t.substring(0,n+1)),e(t.substring(n+1,t.length));else r.push(t);}(n),t.forEach(r,function(t){s[e].dispatchEvent(g('message',t));}));}function p(e,t){s[e].dispatchEvent(E('error',t));}function h(e){if(document.createEvent&&window.Event){var t=document.createEvent('Event');return t.initEvent(e,false,false),t;}else return{type:e,bubbles:false,cancelable:false};}function g(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent('MessageEvent');if(n.initMessageEvent)n.initMessageEvent(e,false,false,t,null,null,window,null);else n=new MessageEvent(e,{bubbles:false,cancelable:false,data:t,source:window});return n;}else return{type:e,data:t,bubbles:false,cancelable:false};}function E(e,t){if(document.createEvent&&window.ErrorEvent&&!window.opera){var n=document.createEvent('ErrorEvent');if(n.initErrorEvent)n.initErrorEvent(e,false,false,t,null,null);else n=new ErrorEvent(e,{bubbles:false,cancelable:false,message:t});return n;}else return{type:e,message:t,bubbles:false,cancelable:false};}function b(e){if(i)e();else a.push(e);}function y(){setInterval(function(){var n=i&&(e.browser.isIE||i.readEvents)&&i.readEvents();try{if(n&&'string'===typeof n)if(n=JSON.parse(n),Array.isArray(n))t.forEach(n,function(e){try{switch(e=JSON.parse(e),e.type){case'open':f(e.target);break;case'close':d(e.target);break;case'state':u(e.target,e.event);break;case'error':p(e.target,e.event);break;case'message':v(e.target,e.event);}}catch(e){c.logger.error(e);}});}catch(e){c.logger.error(e);}},200);}function _(e,t,n){if(e.attachEvent)e.attachEvent('on'+t,n);else e.addEventListener(t,n,false);}function m(){var n=setInterval(function(){var r=i&&(e.browser.isIE||i.readEvents)&&i.readEvents();try{if(r&&'string'===typeof r)if(r=JSON.parse(r),Array.isArray(r)){if(0==r.length)return void clearInterval(n);t.forEach(r,function(e){try{switch(e=JSON.parse(e),e.type){case'open':f(e.target);break;case'close':d(e.target);break;case'state':u(e.target,e.event);break;case'error':p(e.target,e.event);break;case'message':v(e.target,e.event);}}catch(e){c.logger.error(e);}});}else return void clearInterval(n);}catch(e){return c.logger.error(e),void clearInterval(n);}},10);}return c;});
define('js!SBIS3.Plugin/Source/Transport/resources/WebSocketQtChannel',['Core/helpers/generate-helpers','SBIS3.Plugin_localization'],function(e){'use strict';if('undefined'===typeof window)return null;var t=false,n={};function r(e,t){n[e].dispatchEvent(l('message',t));}function i(e,t){for(var r in n)if(n.hasOwnProperty(r))n[r].dispatchEvent(f('error',t));}function s(){for(var e in n)if(n.hasOwnProperty(e))n[e].readyState=a.OPEN,n[e].dispatchEvent(c('open'));}function o(){for(var e in n)if(n.hasOwnProperty(e))n[e].readyState=a.CLOSE,n[e].dispatchEvent(c('close'));}var a=function(t){var r=this;r.url=t,r.__id=e.createGUID(),n[r.__id]=r,r.readyState=a.CONNECTING,r.__events={},setTimeout(function(){window.qtWebChannel.objects.dispatcher.state(function(e){if(e<2||e>3)window.qtWebChannel.objects.dispatcher.open();else r.readyState=a.OPEN,n[r.__id].dispatchEvent(c('open'));});},0);};a.prototype.getId=function(){return this.__id;},a.prototype.send=function(e){var t=this;if(this.readyState==a.CONNECTING)return a.logger.error('INVALID_STATE_ERR: Web Socket connection has not been established'),false;return window.qtWebChannel.objects.dispatcher.send(t.__id,e);},a.prototype.close=function(){var e=this;if(this.readyState==a.CLOSED||this.readyState==a.CLOSING)return;this.readyState=a.CLOSING,setTimeout(function(){window.qtWebChannel.objects.dispatcher.close();},0);},a.prototype.addEventListener=function(e,t){if(!(e in this.__events))this.__events[e]=[];this.__events[e].push(t);},a.prototype.removeEventListener=function(e,t){if(!(e in this.__events))return;for(var n=this.__events[e],r=n.length-1;r>=0;--r)if(n[r]===t){n.splice(r,1);break;}},a.prototype.dispatchEvent=function(e){for(var t=this.__events[e.type]||[],n=0;n<t.length;++n)t[n](e);var r=this['on'+e.type];if(r)r.apply(this,[e]);},a.CONNECTING=0,a.OPEN=1,a.CLOSING=2,a.CLOSED=3,a.logger={log:function(){},error:function(){},info:function(){}},a.initialize=function(e){if('undefined'===typeof window.qtWebChannel)return void e({success:false,id:'webSocketQtChannel',ref:void 0});if(!t)window.qtWebChannel.objects.dispatcher.message.connect(r),window.qtWebChannel.objects.dispatcher.error.connect(i),window.qtWebChannel.objects.dispatcher.opened.connect(s),window.qtWebChannel.objects.dispatcher.closed.connect(o);t=true,e({success:true,id:'webSocketQtChannel',ref:void 0});};function c(e){if(document.createEvent&&window.Event){var t=document.createEvent('Event');return t.initEvent(e,false,false),t;}else return{type:e,bubbles:false,cancelable:false};}function l(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent('MessageEvent');if(n.initMessageEvent)n.initMessageEvent(e,false,false,t,null,null,window,null);else n=new MessageEvent(e,{bubbles:false,cancelable:false,data:t,source:window});return n;}else return{type:e,data:t,bubbles:false,cancelable:false};}function f(e,t){if(document.createEvent&&window.ErrorEvent&&!window.opera){var n=document.createEvent('ErrorEvent');if(n.initErrorEvent)n.initErrorEvent(e,false,false,t,null,null);else n=new ErrorEvent(e,{bubbles:false,cancelable:false,message:t});return n;}else return{type:e,message:t,bubbles:false,cancelable:false};}return a;});
define("tmpl!SBIS3.Plugin/components/Dialogs/PluginSetup/DisableSetupAction/DisableSetupAction",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/CheckBox"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={};i["js!SBIS3.CONTROLS/CheckBox"]=e[1];var o=function e(o,n,l,r,c){function a(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var p={};c&&c.isSetts&&(p=c.fullContext||{});var S="string"==typeof l?l:"",g=void 0===i?void 0:i,d={id:[],def:void 0},v=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},b=u.getMarkupGenerator(r);try{var h=b.joinElements([b.createTag("div",{class:"LocalService-PluginSetupDialog__DisableSetupAction"},[u.getter(o,["alwaysMode"])?[b.createTag("div",{class:"icon-16 icon-Alert icon-error"},[],{},d,this),b.createText("&nbsp;&nbsp;"+global.rk("Данное действие невозможно без СБИС Плагин")+" ")]:[b.createControl("wsControl","ws:SBIS3.CONTROLS/CheckBox",{caption:global.rk("Больше не показывать"),name:"LocalService-PluginSetupDialog__checkbox"},{class:"LocalService-PluginSetupDialog__checkbox",name:"LocalService-PluginSetupDialog__checkbox",sbisname:"LocalService-PluginSetupDialog__checkbox"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},l,g,m,u.config,p)]],n,d,this)],S,d);d.def&&(h=b.chain(h,d,n),d=void 0)}catch(e){u.templateError("resources/SBIS3.Plugin/components/Dialogs/PluginSetup/DisableSetupAction/DisableSetupAction.tmpl",e,o)}return h||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Plugin/components/Dialogs/PluginSetup/DisableSetupAction/DisableSetupAction"}},o});
define('js!SBIS3.Plugin/components/Dialogs/PluginSetup/DisableSetupAction/DisableSetupAction',['js!SBIS3.CORE.CompoundControl','tmpl!SBIS3.Plugin/components/Dialogs/PluginSetup/DisableSetupAction/DisableSetupAction','SBIS3.CONTROLS/CheckBox','SBIS3.Plugin_localization'],function(n,e){return n.extend({_dotTplFn:e,_$protected:{_options:{alwaysMode:null}}});});
define("tmpl!SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Link","js!SBIS3.Plugin/components/Dialogs/PluginSetup/DisableSetupAction/DisableSetupAction","js!SBIS3.CONTROLS/Button"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],a={};a["js!SBIS3.CONTROLS/Link"]=e[1],a["js!SBIS3.Plugin/components/Dialogs/PluginSetup/DisableSetupAction/DisableSetupAction"]=e[2],a["js!SBIS3.CONTROLS/Button"]=e[3];var i=function e(i,r,o,l,n){function c(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var g={};n&&n.isSetts&&(g=n.fullContext||{});var p="string"==typeof o?o:"",S=void 0===a?void 0:a,d={id:[],def:void 0},v=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),m=this&&this.includedTemplates?this.includedTemplates:{},P=u.getMarkupGenerator(l);try{var _=P.joinElements([P.createTag("div",{class:"LocalService-PluginSetupDialog"},[P.createTag("div",{class:"LocalService-PluginSetupDialog__head "+u.wrapUndef(u.utils.escape(u.getter(i,["isNMHDialog"])?"":"LocalService-PluginSetupDialog__head__cutted"))},[P.createTag("div",{},[P.createText(" "+u.wrapUndef(u.utils.escape(u.getter(i,["about"])||u.getter(i,["_defaultAbout"])))+" "),P.createTag("br",{},[],{},d,this),P.createTag("span",{id:"LocalService-PluginSetupDialog__description"},[P.createText(""+u.wrapUndef(u.Sanitize.apply(void 0,[u.getDecorators().sanitize.apply(void 0,[u.getter(i,["description"])])])))],{},d,this)],{},d,this)],{},d,this),P.createTag("div",{class:"LocalService-PluginSetupDialog__body"},[P.createTag("img",{src:""+u.wrapUndef(u.utils.escape(u.getter(i,["imageContent"])))},[],{},d,this),P.createTag("div",{class:"details_strings"},[P.createTag("div",{},[P.createText(global.rk("СБИС Плагин — это незаменимый инструмент для работы с")+" "),P.createTag("span",{id:"LocalService-ProductName"},[P.createText(""+u.wrapUndef(u.utils.escape(u.getter(i,["productName"]))))],{},d,this),P.createText(""+global.rk(".")),P.createTag("br",{},[],{},d,this),P.createText(" "+global.rk("Он обеспечивает")+": ")],{},d,this),P.createTag("ul",{},[P.createTag("li",{},[P.createText(" "+global.rk("оповещение о новых событиях")+" ")],{},d,this),P.createTag("li",{},[P.createText(" "+global.rk("использование электронной подписи, шифрование")+" ")],{},d,this),P.createTag("li",{},[P.createText(" "+global.rk("работу с вложенными документами")+" ")],{},d,this)],{},d,this),P.createTag("div",{},[P.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"Link",caption:global.rk("LocalService@@Подробнее"),href:"http://help.sbis.ru/help/start/teh_terms/sbisplugin/",inNewTab:!0},{class:"position",name:"Link",sbisname:"Link"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},o,S,m,u.config,g),P.createText(" "+global.rk("о всех возможностях СБИС Плагин")+". ")],{},d,this)],{},d,this)],{},d,this),P.createTag("div",{class:"LocalService-PluginSetupDialog__footer"},[P.createTag("table",{class:"LocalService-PluginSetupDialog__actionBar"},[P.createTag("tr",{},[P.createTag("td",{class:"LocalService-PluginSetupDialog__actionBar__leftSide"},[u.getter(i,["canDisable"])?[P.createControl("wsControl","ws:SBIS3.Plugin/components/Dialogs/PluginSetup/DisableSetupAction/DisableSetupAction",{alwaysMode:u.getter(i,["alwaysMode"])},{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},o,S,m,u.config,g)]:P.createText("")],{},d,this),P.createTag("td",{class:"LocalService-PluginSetupDialog__actionBar__rightSide"},[P.createControl("wsControl","ws:SBIS3.CONTROLS/Button",{name:"LocalService-PluginSetupDialog__Download",caption:u.getter(i,["buttonCaption"]),primary:!0,command:"downloadBtnActivated"},{class:"LocalService-PluginSetupDialog__btn",name:"LocalService-PluginSetupDialog__Download",sbisname:"LocalService-PluginSetupDialog__Download"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},o,S,m,u.config,g),!0===u.getter(i,["isNMHDialog"])?[P.createControl("wsControl","ws:SBIS3.CONTROLS/Button",{name:"LocalService-PluginSetupDialog__Refresh",caption:global.rk("Обновить страницу"),command:"refreshBtnActivated",enabled:!1},{class:"LocalService-PluginSetupDialog__btn",name:"LocalService-PluginSetupDialog__Refresh",sbisname:"LocalService-PluginSetupDialog__Refresh"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},o,S,m,u.config,g),P.createControl("wsControl","ws:SBIS3.CONTROLS/Button",{name:"LocalService-PluginSetupDialog__SetupPlugin",caption:global.rk("Установить СБИС Плагин"),enabled:!1},{class:"LocalService-PluginSetupDialog__btn",name:"LocalService-PluginSetupDialog__SetupPlugin",sbisname:"LocalService-PluginSetupDialog__SetupPlugin"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},o,S,m,u.config,g)]:P.createText("")],{},d,this)],{},d,this)],{},d,this)],{},d,this)],r,d,this)],p,d);d.def&&(_=P.chain(_,d,r),d=void 0)}catch(e){u.templateError("resources/SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup.tmpl",e,i)}return _||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup"}},i});
if(typeof window !== "undefined" && window.atob){define("css!SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup", function() {var style = document.createElement("style"),head = document.head || document.getElementsByTagName("head")[0];style.type = "text/css";style.appendChild(document.createTextNode(".LocalService-PluginSetupDialog__head{position:relative;padding-top:10px}.LocalService-PluginSetupDialog__head__cutted{width:38rem}.LocalService-PluginSetupDialog__head>div{margin-left:20px}.LocalService-PluginSetupDialog__body{position:relative;padding-top:20px;padding-bottom:20px}.LocalService-PluginSetupDialog__body img{position:absolute;left:20px;top:20px}.LocalService-PluginSetupDialog__body .details_strings{display:inline-block;margin-left:110px;padding-right:20px}.LocalService-PluginSetupDialog__body .details_strings ul{margin-left:30px}.LocalService-PluginSetupDialog__body .details_strings ul li{list-style-type:disc}.LocalService-PluginSetupDialog__footer{position:relative}.LocalService-PluginSetupDialog__footer .LocalService-PluginSetupDialog__actionBar{width:100%}.LocalService-PluginSetupDialog__footer .LocalService-PluginSetupDialog__actionBar .LocalService-PluginSetupDialog__actionBar__leftSide{text-align:left}.LocalService-PluginSetupDialog__footer .LocalService-PluginSetupDialog__actionBar .LocalService-PluginSetupDialog__actionBar__leftSide .LocalService-PluginSetupDialog__DisableSetupAction{margin-left:20px;margin-bottom:10px;padding-right:11px}.LocalService-PluginSetupDialog__footer .LocalService-PluginSetupDialog__actionBar .LocalService-PluginSetupDialog__actionBar__rightSide{text-align:right}.LocalService-PluginSetupDialog__footer .LocalService-PluginSetupDialog__actionBar .LocalService-PluginSetupDialog__actionBar__rightSide .LocalService-PluginSetupDialog__btn{margin-right:20px;margin-bottom:10px}"));head.appendChild(style);});}
define('js!SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup',['js!SBIS3.CORE.CompoundControl','tmpl!SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup','js!SBIS3.Plugin/components/Dialogs/PluginSetup/DisableSetupAction/DisableSetupAction','SBIS3.CONTROLS/Button','css!SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup','SBIS3.CONTROLS/Link','i18n!SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup','SBIS3.Plugin_localization'],function(l,t){var u;return u=l.extend({_dotTplFn:t,$protected:{_options:{_defaultAbout:rk('Сейчас вы работаете в режиме ограниченной функциональности'),about:'',description:'',imageContent:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAABGCAYAAABxLuKEAAAK9klEQVR42uWcC1BU5xXHr69EbaImmUabVydt4tSJM06bxiStk7Y+2mmbGKOisAsimhgbUaMmakRZ9sFDQQSFUlRQ0SCKb3yDbxQVFUVUoCIIiMDyWh7LY4F/z3fXld2Fhd27i+ym38yZwZG9e+/vnvM//+/ju5fjuhp/lvTlxJJB3HTJcE4km0kRyYnllygecWJFPUWrfYZczYnkhZxIcYETyyI4kdSNc5W8w18LuybhQ9Kb+zsdxFk6jnORbaMvK+O/0FUBhwwtrHK6lu3cNMl4/trYNVo0nBYN4JxlH9KBouigFQ4Lw2TIKynztxCgj/hrNQ/KssFE1ZXS8IZDZ4h5GXSDrtONm/TtkK6hiOXziGbuTxZIO0DyPM7FZz43STLEdPmIpGIi+P8DpQ1OLlXJDO5TycD2Quu8ijRFdl3IgQfPCcSIpREODkeWxjnJPqYM6dPGhbUwF1mUUE15Z0k4fPaew2jvKPRyZM1hgszk5KlPcZGMpXQS3H1+4RmCtUdScPB6Fv6kiEFvN19HLalKzsl7AlHppc0WMZGy4oD93P0gDt+HUlUtkjIe4K8BP6LvDEeFQz7n/Tn9ON4NihRKaw/4/srNuJiVj4YmDS5lF+DTwDg8R8AcDoyITKCTZBjHq7EN/MrLXwfB/+BFtLYCTZpm3M4vweSQeDzv4e+AWiN1YmAibHFAJrpTQ/fgcWUN2GhuacFDZRWcw/ahv6PBcZVtII2hSZaNDjhyeSQOkQDrRiulT2VdPdz/cwDPz/R3JBE+z8Dk2+qALDNW7TkDDWWL/mik0vLcegzPzfRzFAHOJzDyWsu7kK/JrvPZ2l24W6iE8Wih7FkZfwYvzF7tCBmjZhnTbOkHf7tiEyYGxWHYvGD0MfIsby8KQ1zKHR6E8WClte7YZQz9Jtj+BVhIR2Ilk3gzCzuTb2KC33b+QnWOt7ebAkt3JqGKtKWjwUR5y/mbBHCDfcMR2qrH+8WgsESJ3KJSrE1IxieyrXh5ThD/f2MJVmrOI5gazOvsvnIHo37YyIP8SYHpS+Yt/HgKqqurUVmlQmr2Q3jFJeGDVZvwy4XrsY2yoqm52SSceoKTkJaNMdKt9umShYJhpTPqh0jcelCAmpoaPkrKK3AiLRPztx5B+MmrUFbXobPB4CTezsEEmkJ0R8fqTxaB6SEzmm/RzXomYFgM8AjAtzHHUFFZ9RQOi7zHpUgjYJW1anQ1WFldyHyIL9bFY8CsAKthsHnbyGWRcIs4gOAjl3EiPQe7qRm8teAZgmHx68VhOHL9ngEYXTQ2NvKdqKvBphCpD4ogCt8vqJ33oVJk5+FCn193/ApOEozc0kpomlugUjfg8+Bdz66UdMEc7bTQeBSWlrUDo1ar0WJk9kwNZgozCkoxe2MCBn0VaB4QsgofSqIRfDSFn9XfL66AulFjcDPCT6YKm5LYYgL5xvwQbEy82mHWaDQas7JG18pzSiowf9txDJnTNZzfr9yEfVcyUFFT16FvyioqwxsLQp+t+Brfub/578Dt3MJ2YBoaGswGo3PIxVU1WB53CoM7yRxWOptPpaKMOmIT6VS7DKQymkKT2u7pSmJ5W5ix7CDdcxoqVbUBmLq6OrPLSd8hq+oaEHAouUPNeWUufVf8aSgrKlFbW0ca1R7MjuR0DLRGzLsE4yLVhhlwPpZE4XR6drusaSY/Y0nW6OAwUd50+gbfadpcdwDcI/ajlKwBO7aKZSWJvP4oqlBh+Hfh3exjRDIC4/MkpNp/m4DEVuwWbjuK4rIKAzD19fUWg9Ef+67exc/o7rPuM1YRgwJy3MbdT1+nvo46bP0yh2VgnoTIdAa9tzQC8ZfS25WUkKzRH8wIjpFtwc2cAoPjVlczHdOCaWlpxcFrmXjdM8SsDLcODF9OPh3AkZnUn5mU6ln5j426U5NVYNhnq8kwGpdpFd2AehJ4NgrKVBjvuw19xJ1ntu26EsuQjuDoA9L7/dc81/Htu0zPEVviaTrVnaYm1JKgt2UMgalvQB1ljXTvWbzy1WrD0hcKxywwprKmk+z555pYpGbl8SeuX07WDq0oa/hupztubZ0ax2/+F6OWRZh142zrY1ykncMx0h7WZlcfOI8iZbmBp7HFYHA0enCyC4vhGrYX/WfIuzwv24MRmQFGdxJP7tLvvDbi7O1sEmKV9s7W1lqlM8ZwWAayEt2bko6R34eZfdNsC6arcmoXUnLECiyi2Xd+sdJgimCroYPDVhLfXRRq1jmZDceiKYGL1GI4r80LxuHUO/xils7T2BJMRn4JPKgLDprlb/Y5cWKZjcF05GnMiElBsZQ1pU+F2NruxC9VUKYkZz7ElOBdGDLb3/LzEslsCMbictLGQHcFtiRdJc+hzRrWcq0Z6sYmHEy9hz94bybBVQg6Jz46KyuLZ9cWl5M2RizegIeUNVpPUycYSk19IyKTUvH2whD0EUmFQ+lKcywGI7CcelF4xZ4U7Gl456tuwLLYRNITPyuBmAHHYjACy4kvKUr7u0/WbBqNZsRdjfIaNT4P2om+YqkNoXRSVoIWqqyAM3HNDl5rmKcxR4TZbPleYSlGLAnrHiDG2aMTZcEreAK/vJ+rDHsu3TLL09Q1NOHQ9Uy8ylbyuh2KUWkJByMVrDUfeEXyps/UFIEtb5aoahF0+CIG21RPLGjlgsEIFGEWg8l37Ey+1aEAs7XazCIlvok+jBc9egCKLgSDEagzLGPGSKJ4x9qudMifXLiXx4vsAHdFz0GxHozl5fSbJRtwKiOnHZQK6jq7LmXgjwSN6VCPQrEajIXlNHRuIGIvphvMsNnPj8pVWHc0Be99H45eIp+eh2IVGAvL6QUPXwQfSeE1RL8VMz1ZsuME3qTJpl0AsRkYM2w5M2XMsepvJmKTwKv3C+AcuhsvCZkE2jUYV7l2Ct/Fl7j/ex/ylJVPS4htVjx6IxufSKPR301uf1CsB9O1CE/wjUFabhFfNrqdDZGJqRi+eD16i3zsE8oTMM1WgzEhwiOXhiPpdg4Pg18uaGrC4u3H8fM5a+wXCAtnSaug7azmiPCwuUH4MTmdXzthJcR2jH8WGGt6wdq+wLDtrPI824CRGixMBSYk88sEDMqtvMcYtTzCvkvHEEw+x4nkZ220afjpJHHh1qOUIdV8CbG/O7/lGewYQJ6C8TlHYBQbbAWmL3WpycFxvN1n++8CEy5SSQU6FhQW073Xc1QCLjbZPDTDl9+amph+HznF5VhAWfPSlwGOB4UJ71QvJ46bLPkV56IoswYK28TMHhaNPpeGlOx8TA+N7/lJoHAw5dw/2INcE1e/yD8kaQWY1+eHQLr/PHZdvoNxihgbLFL3JBjvGO2jf+xhUZH0L/x7DwRAGfTlGszamAD/Q8n8Fnhr1mnsIFsquGkrx2sfFtU9XiySbaILbbFo2/wMP347qUfkIbyp23ktljkqlFYS3ei2x4t1D6SLJKPpoq5ZCubdJeGGuysFrtPYAZgb3DSvj9q/IYS9wkAsE9GFPbD+SVSZo0HJJW1xM/1mEJZGIvm/rIbjSGCcJQ84p1WeRiVkCo5UTHCuWao5DlVOTFNY+bBMMfkmEOMxU9KfHPFoyp7Ngl9tYNdZQ93H2TuK1xSzX6yjL8jj2Ut25GMJUjQBUj6LLSPdmyE+Sm6aZAs3dcU4/tosfhWT4ejFG54vvnuVmy6ZTGUWTJl0mn/5jlheTbA0tv4zrg0mgRoCUc2L6nTJGYoQbor3FG7iiqFa86bzKabH/wBmtEcEJPAfawAAAABJRU5ErkJggg==',productName:'',buttonCaption:'',canDisable:true,alwaysMode:false}}}),u;});
define('js!SBIS3.Plugin/components/Dialogs/PluginSetup/SetupDialogRender',['Core/Abstract','js!SBIS3.CORE.Dialog','Core/WindowManager','js!SBIS3.Plugin/Source/Helper/Environment','js!SBIS3.Plugin/Source/Error/ConnectionError','js!SBIS3.Plugin/components/SbisPluginLocalStorage','browser!js!SBIS3.Plugin/components/SbisPluginLocalStorageTemporary','Core/Deferred','Core/EventBus','js!SBIS3.Plugin/Source/Transport/ConnectionManager/Ping','Core/IoC','SBIS3.CONTROLS/Utils/InformationPopupManager','Core/CommandDispatcher','js!SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup','SBIS3.Plugin_localization'],function(e,n,o,i,t,r,a,l,s,u,c,g,d){var p='SBIS3.Plugin/components/Dialogs/PluginSetup/SetupDialogRender',S=e.extend({constructor:function(){this._pingChannel=s.channel('SbisPluginPingChannel');},show:function(e,s){var g=this,f=new l(),h={description:e.description||'',productName:i.browserType.isSbis?rk('приложением'):location.hostname,buttonCaption:e.buttonCaption,about:rk(e.about)||'',isNMHDialog:s.description===t.detailTypes.NMH,canDisable:true,alwaysMode:false},m;return new n({template:'js!SBIS3.Plugin/components/Dialogs/PluginSetup/PluginSetup',caption:rk(e.caption)||'',opener:o.getActiveWindow(),resizable:false,width:'auto',componentOptions:h,handlers:{onBeforeShow:function(){d.declareCommand(this,'downloadBtnActivated',function(){if(!e.downloadLink)return;if(s.description===t.detailTypes.NMH||s.description===t.detailTypes.INSTALL_NMH_EXTENSION){var n=null;if(s.description===t.detailTypes.NMH)n={downloadButton:this.getChildControlByName('LocalService-PluginSetupDialog__Download'),refreshButton:this.getChildControlByName('LocalService-PluginSetupDialog__Refresh')};return void g._installNmh(e.downloadLink,n);}var o=new l({silent:true});if(setTimeout(function(){o.callback(false);},2000),e.openNewTab){if('undefined'!==typeof window)window.open(e.downloadLink);}else{var r=$('<a href='+e.downloadLink+' download></a>');if(i.browserType.isFirefox)this.getContainer().append(r);r.click(function(e){e.stopPropagation(true);}),r[0].click();}});},onAfterShow:function(){var e=this;S.isDialogOpened=true,u.start(),g._pingChannel.subscribe('onReady',function(n){S.isDialogOpened=false,e.close(true);});},onAfterClose:function(e,n){try{r.setItem('isSbisPluginSetupDialogDisabled',+this.getChildControlByName('LocalService-PluginSetupDialog__checkbox').isChecked());}catch(e){}if(S.isDialogOpened=false,!n)c.resolve('ILogger').log(p,'Пользователь закрыл диалог с ошибкой'),a.setItem('isSbisPluginSetupDialogRunOnce',true);else a.removeItem('isSbisPluginSetupDialogRunOnce');u.stop(),m=n;},onDestroy:function(){f.callback(m);}}}),f;},_installNmh:function(e,n){var o=this;if(location.hostname.match(/tensor.ru/)||i.browserType.isFirefox){var t=$('<a target="_blank" href='+e+' inst></a>');if(t.click(function(e){e.stopPropagation(true);}),i.browserType.isFirefox){var r=$('body');t.attr('type','hidden'),r.append(t);}if(t[0].click(),i.browserType.isFirefox)t.remove();g.showConfirmDialog({message:rk('После установки расширения требуется перезагрузить страницу и повторить действие. Перезагрузить?')},function(){location.reload(true);});}else chrome.webstore.install(e,function(){o._nmhSuccessCallback(n);},o._nmhFailureCallback);},_nmhSuccessCallback:function(e){c.resolve('ILogger').log(p,rk('Расширение SBIS Plugin Extension установлено')),setTimeout(function(){if(S.isDialogOpened)if(e)e.downloadButton.setEnabled(false),e.downloadButton.setPrimary(false),e.refreshButton.setEnabled(true),e.refreshButton.setPrimary(true),d.declareCommand(e.refreshButton,'refreshBtnActivated',function(){location.reload(true);});else g.showConfirmDialog({message:rk('Расширение SBIS Plugin Extension установлено. Требуется перегрузить страницу и повторить действие. Перегрузить?')},function(){location.reload(true);});},500);},_nmhFailureCallback:function(){c.resolve('ILogger').error(p,rk('Установка расширения SBIS Plugin Extension не удалась'));}});return S.isDialogOpened=false,S;});
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n;}||function(t,n){for(var e in n)if(n.hasOwnProperty(e))t[e]=n[e];};return function(n,e){t(n,e);function o(){this.constructor=n;}n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/AccountService',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatelessExtension','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(t,n,e,o,i){'use strict';if(!i.isBrowserPlatform)return o.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/AccountService','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(t){__extends(n,t);function n(n){var e=this,o={};return o.endpoint={address:'AccountService-1.1.0.9',contract:'AccountService'},o.options=n||{mode:'silent'},e=t.call(this,o)||this,e;}return n.prototype.login=function(t){return this.call('Login',t||{});},n.prototype.logout=function(t){return this.call('Logout',t||{});},n.prototype.updateAccountOptionsAsync=function(t){return this.call('UpdateAccountOptionsAsync',t||{});},n.prototype.updateAccountOptions=function(t){return this.call('UpdateAccountOptions',t||{});},n.prototype.removeAccount=function(t){return this.call('RemoveAccount',t||{});},n.prototype.removeAccountAsync=function(t){return this.call('RemoveAccountAsync',t||{});},n.prototype.reauthorizeAccountAsync=function(t){return this.call('ReauthorizeAccountAsync',t||{});},n.prototype.reauthorizeAccountAsyncWithoutDelay=function(t){return this.call('ReauthorizeAccountAsyncWithoutDelay',t||{});},n.prototype.getAccounts=function(t){return this.call('GetAccounts',t||{});},n.prototype.getAccount=function(t){return this.call('GetAccount',t||{});},n.prototype.autentificateByPassword=function(t){return this.call('AutentificateByPassword',t||{});},n.prototype.createValidation=function(t){return this.call('CreateValidation',t||{});},n.prototype.autentificateWithValidationCode=function(t){return this.call('AutentificateWithValidationCode',t||{});},n.prototype.autentificateByCertificate=function(t){return this.call('AutentificateByCertificate',t||{});},n.prototype.getOptionValue=function(t){return this.call('GetOptionValue',t||{});},n.prototype.setOptionValue=function(t){return this.call('SetOptionValue',t||{});},n.prototype.resetSettings=function(t){return this.call('ResetSettings',t||{});},n.prototype.saveSettings=function(t){return this.call('SaveSettings',t||{});},n;}(e);});
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n];};return function(e,n){t(e,n);function o(){this.constructor=e;}e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/Clipboard',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatelessExtension','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(t,e,n,o,r){'use strict';if(!r.isBrowserPlatform)return o.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Clipboard','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(t){__extends(e,t);function e(e){var n=this,o={};return o.endpoint={address:'Clipboard-1.0.0.13',contract:'Clipboard'},o.options=e||{mode:'silent'},n=t.call(this,o)||this,n;}return e.prototype.getContentType=function(){return this.call('getContentType',{});},e.prototype.getFileList=function(){return this.call('getFileList',{});},e.prototype.getFsEntriesList=function(){return this.call('getFsEntriesList',{});},e.prototype.clearClipboard=function(){return this.call('clearClipboard',{});},e.prototype.getText=function(){return this.call('getText',{});},e.prototype.getRtf=function(){return this.call('getRtf',{});},e.prototype.getHtml=function(){return this.call('getHtml',{});},e.prototype.getCsv=function(){return this.call('getCsv',{});},e.prototype.getImagePngBase64=function(){return this.call('getImagePngBase64',{});},e.prototype.getImageAsPNGFile=function(){return this.call('getImageAsPNGFile',{});},e.prototype.setFileList=function(t){return this.call('setFileList',t||{});},e.prototype.setText=function(t){return this.call('setText',t||{});},e.prototype.setRtf=function(t){return this.call('setRtf',t||{});},e.prototype.setHtml=function(t){return this.call('setHtml',t||{});},e.prototype.setCsv=function(t){return this.call('setCsv',t||{});},e.prototype.setImagePngBase64=function(t){return this.call('setImagePngBase64',t||{});},e.prototype._callDownloadMethod=function(t){return this.getFileList();},e;}(n);});
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n;}||function(t,n){for(var e in n)if(n.hasOwnProperty(e))t[e]=n[e];};return function(n,e){t(n,e);function o(){this.constructor=n;}n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatefulExtension',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatelessExtension','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(t,n,e,o,r){'use strict';if(!r.isBrowserPlatform)return o.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/ExtensionBase/StatefulExtension','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(t){__extends(n,t);function n(){var n=null!==t&&t.apply(this,arguments)||this;return n._stateHandlers={},n;}return n.prototype.callStateHandler=function(t,n){var e=t.UploadGuid||t.uploadId||t.Guid,o=this._stateHandlers[e];if(o&&'function'==typeof o)o(t);else if(n&&o&&'object'==typeof o&&o.hasOwnProperty(n))o[n](t);},n.prototype.setStateHandlers=function(t,n,e){if(n&&'function'==typeof n)this._stateHandlers[t]=function(t){return n(t,e);};else if(n&&'object'==typeof n){this._stateHandlers[t]={};var o=function(o){if(!n.hasOwnProperty(o))return'continue';r._stateHandlers[t][o]=function(t){return n[o](t,e);};},r=this;for(var s in n)o(s);}},n;}(e);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var o in t)if(t.hasOwnProperty(o))e[o]=t[o];};return function(t,o){e(t,o);function n(){this.constructor=t;}t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n());};}();define('js!SBIS3.Plugin/components/Extensions/Dialogs',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatefulExtension','Core/Deferred','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,t,o,n,i,s){'use strict';if(!s.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Dialogs','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(e){__extends(t,e);function t(t){var o=this,n={};return n.endpoint={address:'Dialogs-1.0.0.12',contract:'Dialogs'},n.options=t||{mode:'silent'},o=e.call(this,n)||this,o._subscribeToEvent('openFileDialogResult',o._onOpenFileDialogResult,o),o;}return t.prototype.openFileDialog=function(e){var t=new n(),o=this;return o.call('openFileDialog',e||{}).addCallbacks(function(e){o._queries[e]=t;},function(e){t.errback(e);}),t;},t.prototype.destroy=function(){return this._unsubscribeFromEvent('openFileDialogResult',this._onOpenFileDialogResult,this),e.prototype.destroy.call(this);},t.prototype._onOpenFileDialogResult=function(e,t){if(this._queries[t.DialogGuid])this._queries[t.DialogGuid].callback(t),delete this._queries[t.DialogGuid];},t;}(o);});
define('js!SBIS3.Plugin/components/Extensions/ExtensionBase/IExtension',['require','exports','SBIS3.Plugin_localization'],function(e,n){'use strict';Object.defineProperty(n,'__esModule',{value:true});});
define('js!SBIS3.Plugin/components/Extensions/ExtensionBase/IQuery',['require','exports','SBIS3.Plugin_localization'],function(e,n){'use strict';Object.defineProperty(n,'__esModule',{value:true});});
define('js!SBIS3.Plugin/components/Extensions/ExtensionBase/IStateHandler',['require','exports','SBIS3.Plugin_localization'],function(e,n){'use strict';Object.defineProperty(n,'__esModule',{value:true});});
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t;}||function(n,t){for(var e in t)if(t.hasOwnProperty(e))n[e]=t[e];};return function(t,e){n(t,e);function o(){this.constructor=t;}t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/FileLink',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatelessExtension','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(n,t,e,o,r){'use strict';if(!r.isBrowserPlatform)return o.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/FileLink','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(n){__extends(t,n);function t(t){var e=this,o={};return o.endpoint={address:'FileLink-1.0.0.14',contract:'FileLink'},o.options=t||{mode:'silent'},e=n.call(this,o)||this,e;}return t.prototype.openLink=function(n){return this.call('OpenLink',n);},t;}(e);});
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var o in e)if(e.hasOwnProperty(o))t[o]=e[o];};return function(e,o){t(e,o);function n(){this.constructor=e;}e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n());};}();define('js!SBIS3.Plugin/components/Extensions/FileLoader/BLUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatefulExtension','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(t,e,o,n,r){'use strict';if(!r.isBrowserPlatform)return n.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/FileLoader/BLUploader','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(t){__extends(e,t);function e(e){var o=this,n={};return n.endpoint={address:'FileLoader-0.0.0.74',contract:'FileLoader'},n.options=e||{mode:'silent'},o=t.call(this,n)||this,o;}return e.prototype.uploadFile=function(t){return this.call('uploadFile',t||{});},e.prototype.uploadZipFile=function(t){return this.call('uploadZipFile',t||{});},e;}(o);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o;}||function(e,o){for(var t in o)if(o.hasOwnProperty(t))e[t]=o[t];};return function(o,t){e(o,t);function r(){this.constructor=o;}o.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r());};}();define('js!SBIS3.Plugin/components/Extensions/FileLoader/FileStorageUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatefulExtension','Core/Deferred','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,o,t,r,i,n){'use strict';if(!n.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/FileLoader/FileStorageUploader','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(e){__extends(o,e);function o(o){var t=this,r={};return r.endpoint={address:'FileLoader-0.0.0.74',contract:'FileLoader'},r.options=o||{mode:'silent'},t=e.call(this,r)||this,t._subscribeToEvent('uploadToBigFileStorageEvent',t._onUploadToBigFileStorageEvent,t),t._subscribeToEvent('uploadToBigFileStorageError',t._onUploadToBigFileStorageError,t),t._subscribeToEvent('uploadToBigFileError',t._onUploadToBigFileError,t),t;}return o.prototype.uploadToBigFileStorageV1=function(e,o,t){var i=new r(),n=this;return n.call('uploadToBigFileStorageV1',e||{}).addCallbacks(function(r){if(n._queries[r]=i,o)t=t||e.fileName,n.setStateHandlers(r,o,t);},function(e){i.errback(e);}),i;},o.prototype.destroy=function(){return this._unsubscribeFromEvent('uploadToBigFileStorageEvent',this._onUploadToBigFileStorageEvent,this),this._unsubscribeFromEvent('uploadToBigFileStorageError',this._onUploadToBigFileStorageError,this),this._unsubscribeFromEvent('uploadToBigFileError',this._onUploadToBigFileError,this),e.prototype.destroy.call(this);},o.prototype._onUploadToBigFileStorageEvent=function(e,o){if(this._queries[o.UploadGuid])this._queries[o.UploadGuid].callback(o),delete this._queries[o.UploadGuid],delete this._stateHandlers[o.UploadGuid];},o.prototype._onUploadToBigFileError=function(e,o){this.callStateHandler(o);},o.prototype._onUploadToBigFileStorageError=function(e,o){if(this._queries[o.UploadGuid]){var t=new Error(o.Message);t.originalData=o,this._queries[o.UploadGuid].errback(t),delete this._queries[o.UploadGuid],delete this._stateHandlers[o.UploadGuid];}},o;}(t);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o;}||function(e,o){for(var r in o)if(o.hasOwnProperty(r))e[r]=o[r];};return function(o,r){e(o,r);function t(){this.constructor=o;}o.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t());};}();define('js!SBIS3.Plugin/components/Extensions/FileLoader/FileTransferUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatefulExtension','Core/Deferred','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,o,r,t,n,i){'use strict';if(!i.isBrowserPlatform)return n.resolve('ILogger').log('js!SBIS3.Plugin/components/Extensions/FileLoader/FileTransferUploader','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(e){__extends(o,e);function o(o){var r=this,t={};return t.endpoint={address:'FileLoader-0.0.0.74',contract:'FileLoader'},t.options=o||{mode:'silent'},r=e.call(this,t)||this,r._subscribeToEvent('uploadFileToFileTransferCompleteEvent',r._onUploadFileToFileTransferCompleteEvent,r),r._subscribeToEvent('uploadFileToFileTransferFatalErrorEvent',r._onUploadFileToFileTransferFatalErrorEvent,r),r._subscribeToEvent('uploadChunkToFileTransferEvent',r._onUploadChunkToFileTransferEvent,r),r;}return o.prototype.uploadToFileTransfer=function(e,o,r){var n=new t(),i=this;return i.call('uploadToFileTransfer',e||{}).addCallbacks(function(t){if(i._queries[t]=n,o)r=r||e.fileName,i.setStateHandlers(t,o,r);},function(e){n.errback(e);}),n;},o.prototype._onUploadFileToFileTransferCompleteEvent=function(e,o){if(this._queries[o.UploadGuid])this._queries[o.UploadGuid].callback(o),delete this._queries[o.UploadGuid],delete this._stateHandlers[o.UploadGuid];},o.prototype._onUploadChunkToFileTransferEvent=function(e,o){this.callStateHandler(o,'uploadChunkToFileTransferEvent');},o.prototype._onUploadFileToFileTransferFatalErrorEvent=function(e,o){if(this._queries[o.UploadGuid]){var r=new Error(o.Message);r.originalData=o,this._queries[o.UploadGuid].errback(r),delete this._queries[o.UploadGuid],delete this._stateHandlers[o.UploadGuid];}},o;}(r);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o;}||function(e,o){for(var t in o)if(o.hasOwnProperty(t))e[t]=o[t];};return function(o,t){e(o,t);function r(){this.constructor=o;}o.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r());};}();define('js!SBIS3.Plugin/components/Extensions/FileLoader/HFUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatefulExtension','Core/Deferred','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,o,t,r,i,n){'use strict';if(!n.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/FileLoader/HFUploader','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(e){__extends(o,e);function o(o){var t=this,r={};return r.endpoint={address:'FileLoader-0.0.0.74',contract:'FileLoader'},r.options=o||{mode:'silent'},t=e.call(this,r)||this,t._subscribeToEvent('uploadToBigFileStorageEvent',t._onUploadToBigFileStorageEvent,t),t._subscribeToEvent('uploadToBigFileStorageError',t._onUploadToBigFileStorageError,t),t._subscribeToEvent('uploadToBigFileError',t._onUploadToBigFileError,t),t;}return o.prototype.uploadToFileStorage=function(e,o,t){var i=new r(),n=this;return n.call('uploadToFileStorage',e||{}).addCallbacks(function(r){if(n._queries[r]=i,o)t=t||e.fileName,n.setStateHandlers(r,o,t);},function(e){i.errback(e);}),i;},o.prototype.uploadToBigFileStorage=function(e,o,t){var i=new r(),n=this;return n.call('uploadToBigFileStorage',e||{}).addCallbacks(function(r){if(n._queries[r]=i,o)t=t||e.fileName,n.setStateHandlers(r,o,t);},function(e){i.errback(e);}),i;},o.prototype.destroy=function(){return this._unsubscribeFromEvent('uploadToBigFileStorageEvent',this._onUploadToBigFileStorageEvent,this),this._unsubscribeFromEvent('uploadToBigFileStorageError',this._onUploadToBigFileStorageError,this),this._unsubscribeFromEvent('uploadToBigFileError',this._onUploadToBigFileError,this),e.prototype.destroy.call(this);},o.prototype._onUploadToBigFileStorageEvent=function(e,o){if(this._queries[o.UploadGuid])this._queries[o.UploadGuid].callback(o),delete this._queries[o.UploadGuid],delete this._stateHandlers[o.UploadGuid];},o.prototype._onUploadToBigFileError=function(e,o){if(this._queries[o.UploadGuid]){var t=new Error(o.Message);t.originalData=o,this._queries[o.UploadGuid].errback(t),delete this._queries[o.UploadGuid],delete this._stateHandlers[o.UploadGuid];}},o.prototype._onUploadToBigFileStorageError=function(e,o){this.callStateHandler(o);},o;}(t);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o;}||function(e,o){for(var t in o)if(o.hasOwnProperty(t))e[t]=o[t];};return function(o,t){e(o,t);function i(){this.constructor=o;}o.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i());};}();define('js!SBIS3.Plugin/components/Extensions/FileLoader/SBISDiskUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatefulExtension','Core/Deferred','Core/ParallelDeferred','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,o,t,i,s,r,n){'use strict';if(!n.isBrowserPlatform)return r.resolve('ILogger').log('js!SBIS3.Plugin/components/Extensions/FileLoader/SBISDiskUploader','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(e){__extends(o,e);function o(o){var t=this,i={};return i.endpoint={address:'FileLoader-0.0.0.74',contract:'FileLoader'},i.options=o||{mode:'silent'},t=e.call(this,i)||this,t._subscribeToEvent('uploadToSbisDiskCompleteEvent',t._onUploadToSbisDiskCompleteEvent,t),t._subscribeToEvent('uploadToSbisDiskErrorEvent',t._onUploadToSbisDiskErrorEvent,t),t._subscribeToEvent('uploadToSbisDiskFatalErrorEvent',t._onUploadToSbisDiskFatalErrorEvent,t),t._subscribeToEvent('uploadToSbisDiskTopFolderCreatedEvent',t._onUploadToSbisDiskTopFolderCreatedEvent,t),t._subscribeToEvent('uploadedChunkEvent',t._onUploadedChunkEvent,t),t;}return o.prototype.uploadToSbisDisk=function(e,o,t){var s=new i(),r=this;return r.call('uploadToSbisDisk',e||{}).addCallbacks(function(i){if(r._queries[i]=s,o)t=t||e.fileName,r.setStateHandlers(i,o,t);},function(e){s.errback(e);}),s;},o.prototype.updateToSbisDisk=function(e){var o=new i(),t=this;return t.call('updateToSbisDisk',e||{}).addCallbacks(function(e){t._queries[e]=o;},function(e){o.errback(e);}),o;},o.prototype.uploadFolderToSbisDisk=function(e,o,t){var s=new i(),r=this;return r.call('uploadFolderToSbisDisk',e||{}).addCallbacks(function(i){if(r._queries[i]=s,o)t=t||e.fileName,r.setStateHandlers(i,o,t);},function(e){s.errback(e);}),s;},o.prototype.cancelUploadToSbisDisk=function(e){var o;if(e instanceof i)e={uploadGuid:o=this._getGuidByQuery(e)};else o=e[Object.keys(e)[0]];return delete this._queries[o],delete this._stateHandlers[o],this.call('cancelUploadToSbisDisk',e||{});},o.prototype.cancelAllUploadsToSbisDisk=function(){var e=new s();for(var o in this._queries){if(!this._queries.hasOwnProperty(o))continue;e.push(this.cancelUploadToSbisDisk({uploadGuid:o}));}return e.done().getResult();},o.prototype.uploadToSbisDiskInfo=function(e){return this.call('uploadToSbisDiskInfo',e||{});},o.prototype.destroy=function(){return this._unsubscribeFromEvent('uploadToSbisDiskCompleteEvent',this._onUploadToSbisDiskCompleteEvent,this),this._unsubscribeFromEvent('uploadToSbisDiskErrorEvent',this._onUploadToSbisDiskErrorEvent,this),this._unsubscribeFromEvent('uploadToSbisDiskFatalErrorEvent',this._onUploadToSbisDiskFatalErrorEvent,this),this._unsubscribeFromEvent('uploadToSbisDiskTopFolderCreatedEvent',this._onUploadToSbisDiskTopFolderCreatedEvent,this),this._unsubscribeFromEvent('uploadedChunkEvent',this._onUploadedChunkEvent,this),e.prototype.destroy.call(this);},o.prototype._onUploadToSbisDiskCompleteEvent=function(e,o){if(this._queries[o.UploadGuid])this._queries[o.UploadGuid].callback(o),delete this._queries[o.UploadGuid],delete this._stateHandlers[o.UploadGuid];},o.prototype._onUploadToSbisDiskFatalErrorEvent=function(e,o){if(this._queries[o.UploadGuid]){var t=new Error(o.Message);t.originalData=o,this._queries[o.UploadGuid].errback(t),delete this._queries[o.UploadGuid],delete this._stateHandlers[o.UploadGuid];}},o.prototype._onUploadToSbisDiskTopFolderCreatedEvent=function(e,o){this.callStateHandler(o,'uploadToSbisDiskTopFolderCreatedEvent');},o.prototype._onUploadToSbisDiskErrorEvent=function(e,o){this.callStateHandler(o,'uploadToSbisDiskErrorEvent');},o.prototype._onUploadedChunkEvent=function(e,o){this.callStateHandler(o,'uploadedChunkEvent');},o.prototype._getGuidByQuery=function(e){for(var o in this._queries){if(!this._queries.hasOwnProperty(o))continue;if(this._queries[o]==e)return o;}},o;}(t);});
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];};return function(e,i){t(e,i);function r(){this.constructor=e;}e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r());};}();define('js!SBIS3.Plugin/components/Extensions/FileSystem',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatefulExtension','Core/Deferred','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(t,e,i,r,n,o){'use strict';if(!o.isBrowserPlatform)return n.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/FileSystem','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(t){__extends(e,t);function e(e){var i=this,r={};return r.endpoint={address:'FileSystem-1.0.0.66',contract:'FileSystem'},r.options=e||{mode:'silent'},i=t.call(this,r)||this,i.eventList=['fileSystemWatcherEvent'],i._subscribeToEvent('fileSystemWatcherEvent',i._fileSystemWatcherEventHanlder,i),i;}return e.prototype.getAbsolutePath=function(t){return this.call('getAbsolutePath',t||{});},e.prototype.getDirectories=function(t){return this.call('getDirectories',t||{});},e.prototype.getDirectoriesWithoutSubDirs=function(t){return this.call('getDirectoriesWithoutSubDirs',t||{});},e.prototype.getDirectoriesInfo=function(t){return this.call('getDirectories',t||{});},e.prototype.getDirectoriesSubDirs=function(t){return this.call('getDirectoriesSubDirs',t||{});},e.prototype.getFile=function(t){return this.call('getFile',t||{});},e.prototype.getFileData=function(t){return this.call('getFileData',t||{});},e.prototype.getFileInfo=function(t){return this.call('getFileInfo',t||{});},e.prototype.getFileMimeType=function(t){return this.call('getFileMimeType',t||{});},e.prototype.getFiles=function(t){return this.call('getFiles',t||{});},e.prototype.getFilesAndDirectories=function(t){return this.call('getFilesAndDirectories',t||{});},e.prototype.getFilesAndDirectoriesWithoutSubDirs=function(t){return this.call('getFilesAndDirectoriesWithoutSubDirs',t||{});},e.prototype.getIcon=function(t){return this.call('getIcon',t||{});},e.prototype.getLocation=function(t){return this.call('getLocation',t||{});},e.prototype.getRootDirectories=function(t){return this.call('getRootDirectories',t||{});},e.prototype.getThumbnail=function(t){return this.call('getThumbnail',t||{});},e.prototype.getThumbnailCutted=function(t){return this.call('getThumbnailCutted',t||{});},e.prototype.getThumbnailCuttedList=function(t){return this.call('getThumbnailCutted',t||{});},e.prototype.getThumbnailList=function(t){return this.call('getThumbnailList',t||{});},e.prototype.isDirectoryExists=function(t){return this.call('isDirectoryExists',t||{});},e.prototype.isPathExists=function(t){return this.call('isPathExists',t||{});},e.prototype.setFileSystemWatcher=function(t,e){var i=new r(),n=this;return n.call('setFileSystemWatcher',t||{}).addCallbacks(function(t){if(n._queries[t]=i,e)n._stateHandlers[t]=e;i.callback(t);},function(t){i.errback(t);}),i;},e.prototype.deleteFileSystemWatcher=function(t){if(t.guidFileSystemWatchers){var e=this;t.guidFileSystemWatchers.forEach(function(t){delete e._queries[t],delete e._stateHandlers[t];});}return this.call('deleteFileSystemWatcher',t||{});},e.prototype._fileSystemWatcherEventHanlder=function(t,e){this.callStateHandler(e);},e;}(i);});
define('js!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/IDeviceSelector',['require','exports','SBIS3.Plugin_localization'],function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:true});});
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t;}||function(n,t){for(var o in t)if(t.hasOwnProperty(o))n[o]=t[o];};return function(t,o){n(t,o);function e(){this.constructor=t;}t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/ClipboardDownloader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/FileDownloader','browser!js!SBIS3.Plugin/components/Extensions/Clipboard','SBIS3.Plugin_localization'],function(n,t,o,e){'use strict';return function(n){__extends(t,n);function t(){return n.call(this,new e())||this;}return t.prototype.download=function(n){return this.downloader.getFileList();},t;}(o);});
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o;}||function(n,o){for(var t in o)if(o.hasOwnProperty(t))n[t]=o[t];};return function(o,t){n(o,t);function e(){this.constructor=o;}o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/DialogsDownloader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/FileDownloader','browser!js!SBIS3.Plugin/components/Extensions/Dialogs','SBIS3.Plugin_localization'],function(n,o,t,e){'use strict';return function(n){__extends(o,n);function o(){return n.call(this,new e())||this;}return o.prototype.download=function(n){return this.downloader.openFileDialog(n);},o;}(t);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n;}||function(e,n){for(var t in n)if(n.hasOwnProperty(t))e[t]=n[t];};return function(n,t){e(n,t);function o(){this.constructor=n;}n.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileGetter/ClipboardGetter',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileGetter/FileGetter','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/ClipboardDownloader','browser!Lib/File/LocalFileLink','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,n,t,o,r,i,s){'use strict';if(!s.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/FileGetter/ClipboardGetter','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(e){__extends(n,e);function n(){return null!==e&&e.apply(this,arguments)||this;}return n.prototype.getFiles=function(){var e=this,n={};if(!e._downloader)e._downloader=new o(),e._downloader.subscribe('onClose',function(){delete e._downloader;});return e._downloader.download(n).addCallback(function(e){return e.map(function(e){return new r(e,{});});});},n;}(t);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];};return function(t,n){e(t,n);function o(){this.constructor=t;}t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileGetter/DialogsGetter',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileGetter/FileGetter','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileDownloader/DialogsDownloader','browser!Lib/File/LocalFileLink','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,t,n,o,r,i,s){'use strict';if(!s.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/FileGetter/DialogsGetter','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this;}return t.prototype.getFiles=function(){var e=this,t={extensions:this.extensions,multiple:this.multiSelect};if(!e._downloader)e._downloader=new o(),e._downloader.subscribe('onClose',function(){delete e._downloader;});return e._downloader.download(t).addCallback(function(t){return t.Result.map(function(t){return new r(t,e.getterMeta);});});},t.prototype.filterGetterMeta=function(){this.multiSelect=this.getterMeta.multiSelect||false,delete this.getterMeta.multiSelect,this.extensions=this.getterMeta.extensions||[],delete this.getterMeta.extensions;},t;}(n);});
define('js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileUploader',['require','exports','Core/Deferred','SBIS3.Plugin_localization'],function(e,r,t){'use strict';return function(){function e(e){this.uploader=e;}return e.prototype.subscribe=function(e,r,t){this.uploader.subscribe(e,r,t);},e.prototype.upload=function(e,r,o){return t.success();},e.prototype.destroy=function(){return this.uploader.destroy();},e;}();});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];};return function(t,n){e(t,n);function r(){this.constructor=t;}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/BL_FileUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileUploader','browser!js!SBIS3.Plugin/components/Extensions/FileLoader/BLUploader','SBIS3.Plugin_localization'],function(e,t,n,r){'use strict';return function(e){__extends(t,e);function t(){return e.call(this,new r())||this;}return t.prototype.upload=function(e){var n=t.prepareParams(e);return this.uploader.uploadFile(n);},t.prepareParams=function(e){var t={};return t.Params=e,t;},t;}(n);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];};return function(t,r){e(t,r);function n(){this.constructor=t;}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileStorage_FileUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileUploader','browser!js!SBIS3.Plugin/components/Extensions/FileLoader/FileStorageUploader','SBIS3.Plugin_localization'],function(e,t,r,n){'use strict';return function(e){__extends(t,e);function t(){return e.call(this,new n())||this;}return t.prototype.upload=function(e,r,n){var o=t.prepareParams(e);return this.uploader.uploadToBigFileStorageV1(o,r,n);},t.prepareParams=function(e){var t={};return t.Params=JSON.stringify(e),t;},t;}(r);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r;}||function(e,r){for(var n in r)if(r.hasOwnProperty(n))e[n]=r[n];};return function(r,n){e(r,n);function t(){this.constructor=r;}r.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileTransfer_FileUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileUploader','browser!js!SBIS3.Plugin/components/Extensions/FileLoader/FileTransferUploader','SBIS3.Plugin_localization'],function(e,r,n,t){'use strict';return function(e){__extends(r,e);function r(){return e.call(this,new t())||this;}return r.prototype.upload=function(e,n,t){var o=r.prepareParams(e);return this.uploader.uploadToFileTransfer(o,n,t);},r.prepareParams=function(e){return{parameters:JSON.stringify(e)};},r;}(n);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];};return function(t,n){e(t,n);function r(){this.constructor=t;}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/HF_FileUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileUploader','browser!js!SBIS3.Plugin/components/Extensions/FileLoader/HFUploader','SBIS3.Plugin_localization'],function(e,t,n,r){'use strict';return function(e){__extends(t,e);function t(){return e.call(this,new r())||this;}return t.prototype.upload=function(e,n,r){var o=t.prepareParams(e);return this.uploader.uploadToBigFileStorage(o,n,r);},t.prepareParams=function(e){var t={};return t.Params=JSON.stringify(e),t;},t;}(n);});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r;}||function(e,r){for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];};return function(r,t){e(r,t);function n(){this.constructor=r;}r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n());};}();define('js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/SBISDisk_FileUploader',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileUploader','browser!js!SBIS3.Plugin/components/Extensions/FileLoader/SBISDiskUploader','SBIS3.Plugin_localization'],function(e,r,t,n){'use strict';var o=/\.[a-zA-Z0-9]+$/;return function(e){__extends(r,e);function r(){return e.call(this,new n())||this;}return r.prototype.upload=function(e,t,n){var i=r.prepareParams(e),s=JSON.parse(i.Params).fileName;if(o.test(s))return this.uploader.uploadToSbisDisk(i,t,n);else return this.uploader.uploadFolderToSbisDisk(i,t,n);},r.prepareParams=function(e){var r={};return r.Params=JSON.stringify(e),r;},r;}(t);});
define('js!SBIS3.Plugin/components/Extensions/Integration/Source/SbisPluginSource',['require','exports','Core/Deferred','js!WS.Data/Source/Base','js!WS.Data/Entity/Model','browser!Lib/File/LocalFileLink','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(e,o,r,n,i,t,u,l){'use strict';if(!l.isBrowserPlatform)return u.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/Source/SbisPluginSource','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return n.extend({_moduleName:'SBIS3.Plugin/components/Extensions/Source/SbisPluginSource',_uploader:null,_$uploaderType:null,create:function(e,o){var n=this._getFileLinkProp(e);if('fileLink'!=n)e.fileLink=e[n],delete e[n];var i=e.fileLink,t=this._getUploadParams(e);if(!this._uploader){var u=this;if(!this._$uploaderType)return r.fail('Wrong uploaderType option');this._uploader=new this._$uploaderType(),this._uploader.subscribe('onClose',function(){u._uploader.destroy(),u._uploader=null;});}return this._uploader.upload(t,o,i).addCallback(this.onUpload);},onUpload:function(e){return new i({rawData:e});},subscribe:function(e,o,r){this._uploader.subscribe(e,o,r);},destroy:function(){if(this._uploader)this._uploader.destroy(),this._uploader=null;},_getUploadParams:function(e){return e;},_getFileLinkProp:function(e){var o=null;for(var r in e){if(!e.hasOwnProperty(r))continue;if(!o&&e[r]&&e[r]instanceof t)o=r;}return o;}});});
define('js!SBIS3.Plugin/components/Extensions/Integration/Source/BL_SbisPluginSource',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/BL_FileUploader','browser!js!SBIS3.Plugin/components/Extensions/Integration/Source/SbisPluginSource','Core/core-merge','js!WS.Data/Entity/Model','Core/IoC','Core/constants','browser!js!SBIS3.Plugin/Source/Helper/UserDataManager','SBIS3.Plugin_localization'],function(e,r,o,n,t,s,i,a,c){'use strict';if(!a.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/Source/BL_SbisPluginSource','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;var l=n.extend({_moduleName:'SBIS3.Plugin/components/Extensions/Source/BL_SbisPluginSource',_$uploaderType:o,constructor:function(e){if(e=e||{},e.endpoint&&e.endpoint.address&&'/service/'==e.endpoint.address)e.endpoint.address=location.protocol+'//'+location.host+e.endpoint.address+'sbis-rpc-service300.dll';l.superclass.constructor.call(this,e);},onUpload:function(e){if((e=JSON.parse(e)).hasOwnProperty('error'))return new Error(e.error);return new s({rawData:e.result});},_getUploadParams:function(e){var r={},o=e.fileLink,n=o.getMeta()||{};if(r.targetURL=this._$endpoint.address||location.protocol+'//'+location.host+'/service/sbis-rpc-service300.dll',r.method=this._$endpoint.contract+'.'+this._$binding.create,r.AccountID=c.getAccountId(),r.fileName=o.getLink(),r.fileParams={},r.postName='file1',r=t(r,n),!r.requestParams)r.requestParams={};return r;}});return l;});
define('js!SBIS3.Plugin/components/Extensions/Integration/Source/FileStorage_SbisPluginSource',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileStorage_FileUploader','browser!js!SBIS3.Plugin/components/Extensions/Integration/Source/SbisPluginSource','Core/core-merge','Core/IoC','Core/constants','browser!js!SBIS3.Plugin/Source/Helper/UserDataManager','SBIS3.Plugin_localization'],function(e,n,o,r,t,i,s,l){'use strict';if(!s.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/Source/FileStorage_SbisPluginSource','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return r.extend({_moduleName:'SBIS3.Plugin/components/Extensions/Source/FileStorage_SbisPluginSource',_$uploaderType:o,_getUploadParams:function(e){var n=t({},e),o={},r=n.fileLink,i=r.getMeta()||{};return delete n.fileLink,o.targetURL=this._$endpoint.address,o.AccountID=l.getAccountId(),o.fileName=r.getLink(),o=t(o,i),o=t(o,n),o;}});});
define('js!SBIS3.Plugin/components/Extensions/Integration/Source/FileTransfer_SbisPluginSource',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/FileTransfer_FileUploader','browser!js!SBIS3.Plugin/components/Extensions/Integration/Source/SbisPluginSource','Core/core-merge','Core/IoC','Core/constants','browser!js!SBIS3.Plugin/Source/Helper/UserDataManager','SBIS3.Plugin_localization'],function(e,n,r,o,i,s,t,l){'use strict';if(!t.isBrowserPlatform)return s.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/Source/FileTransfer_SbisPluginSource','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return o.extend({_moduleName:'SBIS3.Plugin/components/Extensions/Source/FileTransfer_SbisPluginSource',_$uploaderType:r,_getUploadParams:function(e){var n=i({},e),r={},o=n.fileLink,s=o.getMeta()||{};return delete n.fileLink,r.targetURL=this._$endpoint.address,r.AccountID=l.getAccountId(),r.fileName=o.getLink(),r=i(r,s),r=i(r,n),r;}});});
define('js!SBIS3.Plugin/components/Extensions/Integration/Source/HF_SbisPluginSource',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/HF_FileUploader','browser!js!SBIS3.Plugin/components/Extensions/Integration/Source/SbisPluginSource','Core/core-merge','Core/IoC','Core/constants','browser!js!SBIS3.Plugin/Source/Helper/UserDataManager','SBIS3.Plugin_localization'],function(e,n,o,r,t,i,s,u){'use strict';if(!s.isBrowserPlatform)return i.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/Source/HF_SbisPluginSource','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return r.extend({_moduleName:'SBIS3.Plugin/components/Extensions/Source/HF_SbisPluginSource',_$uploaderType:o,_getUploadParams:function(e){var n=t({},e),o={},r=n.fileLink,i=r.getMeta()||{};return delete n.fileLink,o.targetURL=this._$endpoint.address,o.AccountID=u.getAccountId(),o.fileName=r.getLink(),o=t(o,i),o=t(o,n),o;}});});
define('js!SBIS3.Plugin/components/Extensions/Integration/Source/SBISDisk_SbisPluginSource',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/Integration/FileUploader/SBISDisk_FileUploader','browser!js!SBIS3.Plugin/components/Extensions/Integration/Source/SbisPluginSource','Core/core-merge','Core/IoC','Core/constants','browser!js!SBIS3.Plugin/Source/Helper/UserDataManager','SBIS3.Plugin_localization'],function(e,n,o,i,r,t,s,S){'use strict';if(!s.isBrowserPlatform)return t.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/Integration/Source/SBISDisk_SbisPluginSource','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return i.extend({_moduleName:'SBIS3.Plugin/components/Extensions/Source/SBISDisk_SbisPluginSource',_$uploaderType:o,_getUploadParams:function(e){var n=r({},e),o={},i=n.fileLink,t=i.getMeta()||{};if(delete n.fileLink,o.targetURL=location.protocol+'//'+location.host+'/disk/api/v1/',this._$endpoint&&this._$endpoint.address&&this._$endpoint.address)o.targetURL+=this._$endpoint.address;return o.AccountID=S.getAccountId(),o.fileName=i.getLink(),o=r(o,t),o=r(o,n),o;}});});
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n;}||function(t,n){for(var e in n)if(n.hasOwnProperty(e))t[e]=n[e];};return function(n,e){t(n,e);function o(){this.constructor=n;}n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o());};}();define('js!SBIS3.Plugin/components/Extensions/SystemInfo',['require','exports','browser!js!SBIS3.Plugin/components/Extensions/ExtensionBase/StatelessExtension','Core/IoC','Core/constants','SBIS3.Plugin_localization'],function(t,n,e,o,r){'use strict';if(!r.isBrowserPlatform)return o.resolve('ILogger').log('SBIS3.Plugin/components/Extensions/SystemInfo','Код модулей SBIS3.Plugin должен исполняться только на стороне клиента. Подключите этот модуль через плагин browser'),null;return function(t){__extends(n,t);function n(n){var e=this,o={};return o.endpoint={address:'SystemInfo-1.0.0.5',contract:'SystemInfo'},o.options=n||{mode:'silent'},e=t.call(this,o)||this,e;}return n.prototype.getMachineName=function(t){return this.call('getMachineName',t||{});},n.prototype.getHardwareId=function(t){return this.call('getHardwareId',t||{});},n;}(e);});