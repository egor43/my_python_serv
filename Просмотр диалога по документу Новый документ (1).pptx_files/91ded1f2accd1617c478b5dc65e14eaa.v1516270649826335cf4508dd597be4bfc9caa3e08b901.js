/*
deps: "js!SBIS3.Contacts.DialogView","js!SBIS3.Contacts.SendViewDialog"
theme: 
*/
(function(){
define("css!Lib/Control/AreaAbstract/AreaAbstract", "");
define("css!SBIS3.Contacts.DialogView", "");
define("css!WSControls/Buttons/resources/ButtonBase", "");
define("css!SBIS3.CONTROLS/Link/Link", "");
define("css!SBIS3.CONTROLS/InformationPopup/InformationPopup", "");
define("css!Deprecated/Controls/ModalOverlay/ModalOverlay", "");
define("css!SBIS3.CONTROLS/Button/Button", "");
define("css!SBIS3.ENGINE.LinkValidator", "");
define("css!SBIS3.Contacts.NotificationFooter/NotificationFooter", "");
define("css!SBIS3.Contacts.MessageInformer/MessageInformer", "");
define("css!SBIS3.CONTROLS/SubmitPopup/SubmitPopup", "");
define("css!Controls/ConfirmationWindow/Dialog/Dialog", "");
define("css!SBIS3.CONTROLS/NotificationPopup/NotificationPopup", "");
define("css!SBIS3.CONTROLS/Button/IconButton/IconButton", "");
define("css!SBIS3.DOCVIEW.signs", "");
define("css!Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager", "");
define("css!SBIS3.DOCVIEW.Preview", "");
define("css!SBIS3.CONTROLS/ProgressBar/ProgressBar", "");
define("css!SBIS3.Plugin/components/Dialogs/PluginLoad/PluginLoad", "");
define("css!SBIS3.DOCVIEW.List/resources/diskClassic/DiskClassic", "");
define("css!SBIS3.DOCVIEW.List/resources/classic/Classic", "");
define("css!SBIS3.DOCVIEW.List/resources/bigPreview/BigPreview", "");
define("css!SBIS3.CONTROLS/Tree/CompositeView/TreeCompositeView", "");
define("css!SBIS3.CONTROLS/CompositeView/CompositeView", "");
define("css!SBIS3.CONTROLS/Tree/View/TreeView", "");
define("css!SBIS3.CONTROLS/Tree/DataGridView/TreeDataGridView", "");
define("css!SBIS3.CONTROLS/Menu/MenuItem/MenuItem", "");
define("css!SBIS3.CONTROLS/Menu/Menu", "");
define("css!SBIS3.CONTROLS/BreadCrumbs/BreadCrumbs", "");
define("css!SBIS3.CONTROLS/FloatArea/FloatArea", "");
define("css!SBIS3.CONTROLS/DataGridView/DataGridView", "");
define("css!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup", "");
define("css!SBIS3.CONTROLS/ListView/ListView", "");
define("css!SBIS3.CONTROLS/Paging/Paging", "");
define("css!SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragNDropMixin", "");
define("css!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar", "");
define("css!SBIS3.CONTROLS/ListView/resources/DragMove/DragMove", "");
define("css!SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell", "");
define("css!SBIS3.CONTROLS/ComponentBinder/ScrollPagingController", "");
define("css!SBIS3.CONTROLS/ScrollContainer/ScrollContainer", "");
define("css!SBIS3.CONTROLS/ScrollContainer/Scrollbar/Scrollbar", "");
define("css!Lib/FloatAreaManager/FloatAreaManager", "");
define("css!SBIS3.CONTROLS/Button/BackButton/BackButton", "");
define("css!SBIS3.DOCVIEW.List", "");
define("css!SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/RichEditorRoundToolbar", "");
define("css!SBIS3.CONTROLS/RichEditor/Components/ToolbarBase/RichEditorToolbarBase", "");
define("css!SBIS3.CONTROLS/StylesPanelNew/StylesPanelNew", "");
define("css!SBIS3.CONTROLS/Button/ToggleButton/resources/ToggleButton__square", "");
define("css!SBIS3.CONTROLS/ComboBox/ComboBox", "");
define("css!SBIS3.CONTROLS/TextBox/TextBox", "");
define("css!Controls/Input/resources/InputRender/InputRender", "");
define("css!SBIS3.CONTROLS/Radio/Group/RadioGroup", "");
define("css!SBIS3.CONTROLS/Radio/Button/RadioButton", "");
define("css!SBIS3.CONTROLS/CheckBox/CheckBox", "");
define("css!SBIS3.CONTROLS/Menu/MenuIcon/MenuIcon", "");
define("css!SBIS3.CONTROLS/RichEditor/Components/Toolbar/RichEditorToolbar", "");
define("css!SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel", "");
define("css!SBIS3.CONTROLS/Menu/MenuButton/MenuButton", "");
define("css!SBIS3.CORE.RichContentStyles", "");
define("css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/RichTextArea", "");
define("css!SBIS3.CONTROLS/Commands/CommandsButton", "");
define("css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel", "");
define("css!SBIS3.CONTROLS/TextArea/TextArea", "");
define("css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog", "");
define("css!SBIS3.Contacts.EditInPlaceMixin/styles/EditorAbove", "");
define("css!SBIS3.Activity.ActivityHelper/ActivityHelper", "");
define("css!SBIS3.Contacts.ServiceMessageBase/ServiceMessage", "");
define("css!SBIS3.Contacts.Models.MiniBaseModel/styles/PersonPhoto", "");
define("css!SBIS3.Contacts.Models.MiniBaseModel/styles/PersonEmployment", "");
define("css!SBIS3.Contacts.FileViewerMini/FileViewer", "");
define("css!SBIS3.Contacts.Models.MiniMessageModel/styles/Message", "");
define("css!SBIS3.Engine.ClipboardNative", "");
define("css!SBIS3.Contacts.ServiceMessage/ServiceMessage", "");
define("css!SBIS3.Contacts.Models.MiniBaseModel/styles/FolderItem", "");
define("css!SBIS3.Contacts.Mixins.Interface.MiniThemeMessagesBase/ThemeMessages", "");
define("css!SBIS3.EDO2.RulesSelector", "");
define("css!SBIS3.CONTROLS/Commands/CommandsSeparator", "");
define("css!SBIS3.Plugin/components/Extensions/Integration/DeviceSelector/ScanDeviceSelectorRender/ScanDeviceSelectorRender", "");
define("css!Lib/Control/FloatArea/FloatArea", "");
define("css!Deprecated/Controls/ProgressBar/ProgressBar", "");
define("css!Deprecated/Controls/LoadingIndicator/LoadingIndicator", "");
define("css!SBIS3.DOCVIEW.BufferList", "");
define("css!SBIS3.CONTROLS/Menu/MenuLink/MenuLink", "");
define("css!SBIS3.DOCVIEW.AttachTo", "");
define("css!SBIS3.CONTROLS/Suggest/Suggest", "");
define("css!SBIS3.CONTROLS/FieldLink/FieldLink", "");
define("css!SBIS3.CONTROLS/Suggest/SuggestTextBox/SuggestTextBox", "");
define("css!SBIS3.CONTROLS/FieldLink/Link/FieldLink_Link", "");
define("css!Contacts.Mini/Models/styles/PersonMiniItem", "");
define("css!SBIS3.Contacts.Models.MiniBaseModel/styles/PersonItem", "");
define("css!SBIS3.Contacts.WhomFieldInternal/Internal", "");
define("css!SBIS3.Contacts.Popup/Popup", "");
define("css!SBIS3.Contacts.SendMessageInternal.PopupSendingMessage/Popup", "");
define("css!SBIS3.CONTROLS/SelectorButton/SelectorButton", "");
define("css!SBIS3.Contacts.SendMessageInternal/Internal", "");
define("css!SBIS3.Contacts.Mixins.Services.Executor.CheckReceiversLimits/CheckReceiversLimits", "");
define("css!SBIS3.CONTROLS/SearchForm/SearchForm", "");
define("css!SBIS3.Contacts.MessagesSendViewBase/Base", "");
define("css!Tags/SimpleList", "");
define("css!SBIS3.Contacts.btnFolderTheme/MoveToFolder", "");
define("css!SBIS3.Contacts.Models.MiniBaseModel/styles/MemberItem", "");
define("css!SBIS3.Contacts.MiniHeaderMembers/HeaderMembers", "");
define("css!SBIS3.Contacts.HeaderDialog/Dialog", "");
define("css!SBIS3.CONTROLS/OperationsPanel/OperationsPanel", "");
define("css!SBIS3.Contacts.FileViewerSlider/Slider", "");
define("css!SBIS3.Contacts.FileViewerButton/Button", "");
define("css!SBIS3.Contacts.SendViewDialog/Dialog", "");
})();

(function(){"use strict";var e=function(){return this||(0,eval)("this")}(),r=/http[s]?:\/\//;(e.define||e.requirejs&&e.requirejs.define||requirejsVars.define)("text",["module"],function(e){var n,t,i,o,s,a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f="undefined"!==typeof location&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,p=f&&(location.port||void 0),d={},v=e.config&&e.config()||{};function m(e,r){return void 0===e||""===e?r:e}function h(e,r,n,t){if(r===t)return true;else if(e===n)if("http"===e)return m(r,"80")===m(t,"80");else if("https"===e)return m(r,"443")===m(t,"443");return false}if(n={version:"2.0.15",strip:function(e){if(e){var r=(e=e.replace(a,"")).match(u);if(r)e=r[1]}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,r,n;if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;return e},parseName:function(e){var r,n,t,i=false,o=e.lastIndexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");if(-1!==o&&(!s||o>1))r=e.substring(0,o),n=e.substring(o+1);else r=e;if(t=n||r,o=t.indexOf("!"),-1!==o)if(i="strip"===t.substring(o+1),t=t.substring(0,o),n)n=t;else r=t;return{moduleName:r,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,r,t,i){var o,s,a,u=n.xdRegExp.exec(e);if(!u)return true;return o=u[2],s=u[3],s=s.split(":"),a=s[1],s=s[0],(!o||o===r)&&(!s||s.toLowerCase()===t.toLowerCase())&&(!a&&!s||h(o,a,r,i))},finishLoad:function(e,r,t,i){if(t=r?n.strip(t):t,v.isBuild)d[e]=t;i(t)},load:function(e,r,t,i){if(i&&i.isBuild&&!i.inlineText)return void t();v.isBuild=i&&i.isBuild;var o=n.parseName(e),s=o.moduleName+(o.ext?"."+o.ext:""),a=r.toUrl(s),u=v.useXhr||n.useXhr;if(0===a.indexOf("empty:"))return void t();if(!f||u(a,l,c,p))n.get(a,function(r){n.finishLoad(e,o.strip,r,t)},function(e){if(t.error)t.error(e)});else r([s],function(e){n.finishLoad(o.moduleName+"."+o.ext,o.strip,e,t)})},write:function(e,r,t,i){if(d.hasOwnProperty(r)){var o=n.jsEscape(d[r]);t.asModule(e+"!"+r,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,r,t,i,o){var s=n.parseName(r),a=s.ext?"."+s.ext:"",u=s.moduleName+a,f=t.toUrl(s.moduleName+a)+".js";n.load(u,t,function(r){var t=function(e){return i(f,e)};t.asModule=function(e,r){return i.asModule(e,f,r)},n.write(e,u,t,o)},o)}},"node"===v.env||!v.env&&"undefined"!==typeof process&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])t=require.nodeRequire?require.nodeRequire("fs"):require("fs"),n.get=function(e,n,i){try{if(r.test(e)){var o=(process.domain&&process.domain.req&&process.domain.req||{}).headers||{},s=o["x-forwarded-proto"]||o["x-forwarded-protocol"]||"http";s=s.split(",")[0];var a=require("url").parse(e);require(s).get({host:a.host,port:a.port,path:a.path,headers:{host:o.host,cookie:o.cookie}},function(e){var r="";e.setEncoding("utf8"),e.on("data",function(e){r+=e}),e.on("end",function(){n(r)}),e.on("error",function(e){i(e)})}).on("error",function(e){i(e)})}else{var u=t.readFileSync(e,"utf8");if("\ufeff"===u[0])u=u.substring(1);n(u)}}catch(e){if(i)i(e)}};else if("xhr"===v.env||!v.env&&n.createXhr())n.get=function(e,r,t,i){var o=n.createXhr(),s;if(o.open("GET",e,true),i)for(s in i)if(i.hasOwnProperty(s))o.setRequestHeader(s.toLowerCase(),i[s]);if(v.onXhr)v.onXhr(o,e);o.onreadystatechange=function(n){var i,s;if(4===o.readyState){if(i=o.status||0,i>399&&i<600){if(s=new Error(e+" HTTP status: "+i),s.xhr=o,t)t(s)}else r(o.responseText);if(v.onXhrComplete)v.onXhrComplete(o,e)}},o.send(null)};else if("rhino"===v.env||!v.env&&"undefined"!==typeof Packages&&"undefined"!==typeof java)n.get=function(e,r){var n,t,i="utf-8",o=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),u="";try{if(n=new java.lang.StringBuffer,t=a.readLine(),t&&t.length()&&65279===t.charAt(0))t=t.substring(1);if(null!==t)n.append(t);while(null!==(t=a.readLine()))n.append(s),n.append(t);u=String(n.toString())}finally{a.close()}r(u)};else if("xpconnect"===v.env||!v.env&&"undefined"!==typeof Components&&Components.classes&&Components.interfaces)i=Components.classes,o=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in i,n.get=function(e,r){var n,t,a,u={};if(s)e=e.replace(/\//g,"\\");a=new FileUtils.File(e);try{(n=i["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream)).init(a,1,0,false),(t=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream)).init(n,"utf-8",n.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),t.readString(n.available(),u),t.close(),n.close(),r(u.value)}catch(e){throw new Error((a&&a.path||"")+": "+e)}};else n.get=function(e,r){r(TextRequest(e))};return n})})();
//# sourceMappingURL=text.js.map
define("native-css",[],function(){if("undefined"==typeof window)return{load:function(e,t,n){n()}};var e=window.self!==window.top,t=document.getElementsByTagName("head")[0],n=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,r=false,i=true;if(n[1]||n[7])r=parseInt(n[1])<6||parseInt(n[7])<=9;else if(n[2]||n[8])i=false;else if(n[4])r=parseInt(n[4])<18;var o={};o.pluginBuilder="./css-builder";var s,l,u=function(){(s=document.createElement("style")).setAttribute("type","text/css"),t.appendChild(s),l=s.styleSheet||s.sheet},f=0,a=[],c,d=function(t){if(l.addImport(t),e)setTimeout(function(){h()},10);else s.onload=function(){h()};if(f++,31==f)u(),f=0},h=function(){c();var e=a.shift();if(!e)return void(c=null);c=e[1],d(e[0])},p=function(e,t){if(!l||!l.addImport)u();if(l&&l.addImport)if(c)a.push([e,t]);else d(e),c=t;else{s.textContent='@import "'+e+'";';var n=setInterval(function(){try{s.sheet.cssRules,clearInterval(n),t()}catch(e){}},10)}},m=function(e){for(var t=0;t<document.styleSheets.length;t++){var n=document.styleSheets[t];if(n.href&&n.href.substr(-e.length)===e)return true}return false},v=function(e,n){var r=document.createElement("link");if(r.type="text/css",r.rel="stylesheet",i)r.onload=function(){r.onload=function(){},setTimeout(n,7)},r.onerror=function(){r.onerror=function(){},setTimeout(n,7)};else var o=setInterval(function(){if(m(r.href))return clearInterval(o),n()},10);r.href=e,t.appendChild(r)};return o.normalize=function(e,t){if(".css"==e.substr(e.length-4,4))e=e.substr(0,e.length-4);return t(e)},o.load=function(e,t,n,i){var o=t.toUrl(e+".css");if(m(o))n();else(r?p:v)(o,n)},o});
//# sourceMappingURL=native-css.js.map
define("text!Core/resources/availableLanguage.json", function(){ return "{\n  \"ru-RU\": \"Русский (Россия)\",\n  \"en-US\": \"English (USA)\"\n}";});
define("text!Core/resources/deprecatedModules.json", function(){ return "{\n   \"SBIS3.CONTROLS.AbstractLongOperationsProducer\": \"SBIS3.CONTROLS/LongOperations/AbstractProducer\",\n   \"SBIS3.CONTROLS.Accordion\": \"SBIS3.CONTROLS/Accordion\",\n   \"SBIS3.CONTROLS.Action.Action\": \"SBIS3.CONTROLS/Action\",\n   \"SBIS3.CONTROLS.Action.DialogMixin\": \"SBIS3.CONTROLS/Action/Mixin/DialogMixin\",\n   \"SBIS3.CONTROLS.Action.List.InteractiveMove\": \"SBIS3.CONTROLS/Action/List/InteractiveMove\",\n   \"SBIS3.CONTROLS.Action.List.ListMixin\": \"SBIS3.CONTROLS/Action/List/Mixin/ListMixin\",\n   \"SBIS3.CONTROLS.Action.List.Move\": \"SBIS3.CONTROLS/Action/List/Move\",\n   \"SBIS3.CONTROLS.Action.List.ReorderMove\": \"SBIS3.CONTROLS/Action/List/ReorderMove\",\n   \"SBIS3.CONTROLS.Action.List.Save\": \"SBIS3.CONTROLS/Action/List/Save\",\n   \"SBIS3.CONTROLS.Action.List.Sum\": \"SBIS3.CONTROLS/Action/List/Sum\",\n   \"SBIS3.CONTROLS.Action.OpenDialog\": \"SBIS3.CONTROLS/Action/OpenDialog\",\n   \"SBIS3.CONTROLS.Action.OpenEditDialog\": \"SBIS3.CONTROLS/Action/List/OpenEditDialog\",\n   \"SBIS3.CONTROLS.Action.Save\": \"SBIS3.CONTROLS/Action/Save\",\n   \"SBIS3.CONTROLS.Action.SelectorAction\": \"SBIS3.CONTROLS/Action/SelectorAction\",\n   \"SBIS3.CONTROLS.ActionBase\": \"SBIS3.CONTROLS/Action/ActionBase\",\n   \"SBIS3.CONTROLS.ActiveMultiSelectable\": \"SBIS3.CONTROLS/Mixins/ActiveMultiSelectable\",\n   \"SBIS3.CONTROLS.ActiveSelectable\": \"SBIS3.CONTROLS/Mixins/ActiveSelectable\",\n   \"SBIS3.CONTROLS.AdditionalFilterParams\": \"SBIS3.CONTROLS/Filter/Button/AdditionalParams\",\n   \"SBIS3.CONTROLS.ArraySimpleValuesUtil\": \"SBIS3.CONTROLS/Utils/ArraySimpleValuesUtil\",\n   \"SBIS3.CONTROLS.BackButton\": \"SBIS3.CONTROLS/Button/BackButton\",\n   \"SBIS3.CONTROLS.BreadCrumbs\": \"SBIS3.CONTROLS/BreadCrumbs\",\n   \"SBIS3.CONTROLS.BreadCrumbsController\": \"SBIS3.CONTROLS/ComponentBinder/BreadCrumbsController\",\n   \"SBIS3.CONTROLS.Browser\": \"SBIS3.CONTROLS/Browser\",\n   \"SBIS3.CONTROLS.Browser/design/DesignPlugin\": \"SBIS3.CONTROLS/Browser/design/designPlugin\",\n   \"SBIS3.CONTROLS.Button\": \"SBIS3.CONTROLS/Button\",\n   \"SBIS3.CONTROLS.Button/Button.compatible\": \"SBIS3.CONTROLS/Button/Button.compatible\",\n   \"SBIS3.CONTROLS.ButtonBase\": \"SBIS3.CONTROLS/Button/ButtonGroup/ButtonBase\",\n   \"SBIS3.CONTROLS.ButtonGroup\": \"SBIS3.CONTROLS/Button/ButtonGroup\",\n   \"SBIS3.CONTROLS.ButtonGroupBase\": \"SBIS3.CONTROLS/Button/ButtonGroup/ButtonGroupBase\",\n   \"SBIS3.CONTROLS.ButtonGroupBaseDS\": \"SBIS3.CONTROLS/Button/ButtonGroup/ButtonGroupBaseDS\",\n   \"SBIS3.CONTROLS.Calendar\": \"SBIS3.CONTROLS/Calendar\",\n   \"SBIS3.CONTROLS.CheckBox\": \"SBIS3.CONTROLS/CheckBox\",\n   \"SBIS3.CONTROLS.CheckBoxGroup\": \"SBIS3.CONTROLS/CheckBox/Group\",\n   \"SBIS3.CONTROLS.CheckBoxGroupBase\": \"SBIS3.CONTROLS/CheckBox/Group/GroupBase\",\n   \"SBIS3.CONTROLS.Checkable\": \"SBIS3.CONTROLS/Mixins/Checkable\",\n   \"SBIS3.CONTROLS.ChooserMixin\": \"SBIS3.CONTROLS/Mixins/ChooserMixin\",\n   \"SBIS3.CONTROLS.Clickable\": \"SBIS3.CONTROLS/Mixins/Clickable\",\n   \"SBIS3.CONTROLS.ClockPicker\": \"SBIS3.CONTROLS/Date/TimePicker/ClockPicker\",\n   \"SBIS3.CONTROLS.ColorPicker\": \"SBIS3.CONTROLS/ColorPicker\",\n   \"SBIS3.CONTROLS.ColorRadioButtonNew\": \"SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew\",\n   \"SBIS3.CONTROLS.ColorStyle\": \"SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/ColorStyle\",\n   \"SBIS3.CONTROLS.ColumnsController\": \"SBIS3.CONTROLS/Controllers/ColumnsController\",\n   \"SBIS3.CONTROLS.ColumnsEditor\": \"SBIS3.CONTROLS/Browser/ColumnsEditor/Editor\",\n   \"SBIS3.CONTROLS.ColumnsEditorArea\": \"SBIS3.CONTROLS/Browser/ColumnsEditor/Editing/Area\",\n   \"SBIS3.CONTROLS.ColumnsEditorUtils\": \"SBIS3.CONTROLS/Browser/ColumnsEditor/Preset/Unit\",\n   \"SBIS3.CONTROLS.ComboBox\": \"SBIS3.CONTROLS/ComboBox\",\n   \"SBIS3.CONTROLS.CommandsButton\": \"SBIS3.CONTROLS/Commands/CommandsButton\",\n   \"SBIS3.CONTROLS.CommandsSeparator\": \"SBIS3.CONTROLS/Commands/CommandsSeparator\",\n   \"SBIS3.CONTROLS.CommonHandlers\": \"SBIS3.CONTROLS/ListView/resources/CommonHandlers\",\n   \"SBIS3.CONTROLS.ComponentBinder\": \"SBIS3.CONTROLS/ComponentBinder\",\n   \"SBIS3.CONTROLS.CompositeView\": \"SBIS3.CONTROLS/CompositeView\",\n   \"SBIS3.CONTROLS.CompositeViewMixin\": \"SBIS3.CONTROLS/Mixins/CompositeViewMixin\",\n   \"SBIS3.CONTROLS.CompoundControl\": \"SBIS3.CONTROLS/CompoundControl\",\n   \"SBIS3.CONTROLS.CompoundFocusMixin\": \"SBIS3.CONTROLS/Mixins/CompoundFocusMixin\",\n   \"SBIS3.CONTROLS.ContainerModel\": \"SBIS3.CONTROLS/Layouts/ContainerPosition/ContainerModel\",\n   \"SBIS3.CONTROLS.ContextMenu\": \"SBIS3.CONTROLS/Menu/ContextMenu\",\n   \"SBIS3.CONTROLS.Control\": \"SBIS3.CONTROLS/Control\",\n   \"SBIS3.CONTROLS.ControlHierarchyManager\": \"SBIS3.CONTROLS/ControlHierarchyManager\",\n   \"SBIS3.CONTROLS.ControlsValidators\": \"SBIS3.CONTROLS/Utils/ControlsValidators\",\n   \"SBIS3.CONTROLS.CursorListNavigation\": \"SBIS3.CONTROLS/Controllers/CursorListNavigation\",\n   \"SBIS3.CONTROLS.DSMixin\": \"SBIS3.CONTROLS/Mixins/DSMixin\",\n   \"SBIS3.CONTROLS.DataBindMixin\": \"SBIS3.CONTROLS/Mixins/DataBindMixin\",\n   \"SBIS3.CONTROLS.DataGridView\": \"SBIS3.CONTROLS/DataGridView\",\n   \"SBIS3.CONTROLS.DataGridView/design/DesignPlugin\": \"SBIS3.CONTROLS/DataGridView/design/DesignPlugin\",\n   \"SBIS3.CONTROLS.DateBox\": \"SBIS3.CONTROLS/Date/Box\",\n   \"SBIS3.CONTROLS.DatePicker\": \"SBIS3.CONTROLS/Date/Picker\",\n   \"SBIS3.CONTROLS.DateRange\": \"SBIS3.CONTROLS/Date/Range\",\n   \"SBIS3.CONTROLS.DateRangeBig\": \"SBIS3.CONTROLS/Date/RangeBig\",\n   \"SBIS3.CONTROLS.DateRangeBigChoose\": \"SBIS3.CONTROLS/Date/RangeBigChoose\",\n   \"SBIS3.CONTROLS.DateRangeBigChoose.DateRangePicker\": \"SBIS3.CONTROLS/Date/RangeBigChoose/resources/DateRangePicker\",\n   \"SBIS3.CONTROLS.DateRangeBigChoose.MonthRangePicker\": \"SBIS3.CONTROLS/Date/RangeBigChoose/resources/MonthRangePicker\",\n   \"SBIS3.CONTROLS.DateRangeBigChoose.MonthView\": \"SBIS3.CONTROLS/Date/RangeBigChoose/resources/MonthView\",\n   \"SBIS3.CONTROLS.DateRangeBigChoose.ScrollWatcher\": \"SBIS3.CONTROLS/Date/RangeBigChoose/resources/ScrollWatcher\",\n   \"SBIS3.CONTROLS.DateRangeBigChoose.Validators\": \"SBIS3.CONTROLS/Date/RangeBigChoose/resources/Validators\",\n   \"SBIS3.CONTROLS.DateRangeBigChoosePickerMixin\": \"SBIS3.CONTROLS/Mixins/DateRangeBigChoosePickerMixin\",\n   \"SBIS3.CONTROLS.DateRangeChoose\": \"SBIS3.CONTROLS/Date/RangeChoose\",\n   \"SBIS3.CONTROLS.DateRangeChoosePickerMixin\": \"SBIS3.CONTROLS/Mixins/DateRangeChoosePickerMixin\",\n   \"SBIS3.CONTROLS.DateRangeMixin\": \"SBIS3.CONTROLS/Mixins/DateRangeMixin\",\n   \"SBIS3.CONTROLS.DateRangeRelationController\": \"SBIS3.CONTROLS/ComponentBinder/DateRangeRelationController\",\n   \"SBIS3.CONTROLS.DateRangeSlider\": \"SBIS3.CONTROLS/Date/RangeSlider\",\n   \"SBIS3.CONTROLS.DateRangeSliderBase\": \"SBIS3.CONTROLS/Date/RangeSliderBase\",\n   \"SBIS3.CONTROLS.DateRangeSliderBig\": \"SBIS3.CONTROLS/Date/RangeSliderBig\",\n   \"SBIS3.CONTROLS.DecorableMixin\": \"SBIS3.CONTROLS/Mixins/DecorableMixin\",\n   \"SBIS3.CONTROLS.Dialog\": \"SBIS3.CONTROLS/Dialog\",\n   \"SBIS3.CONTROLS.DialogActionBase\": \"SBIS3.CONTROLS/Action/DialogActionBase\",\n   \"SBIS3.CONTROLS.DialogSelector\": \"SBIS3.CONTROLS/Dialog/DialogSelector\",\n   \"SBIS3.CONTROLS.DragAndDropMixin\": \"SBIS3.CONTROLS/Mixins/DragAndDropMixin\",\n   \"SBIS3.CONTROLS.DragEntity.Entity\": \"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Entity\",\n   \"SBIS3.CONTROLS.DragEntity.List\": \"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/List\",\n   \"SBIS3.CONTROLS.DragEntity.Row\": \"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Row\",\n   \"SBIS3.CONTROLS.DragNDropMixin\": \"SBIS3.CONTROLS/Mixins/DragNDropMixin\",\n   \"SBIS3.CONTROLS.DragObject\": \"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragObject\",\n   \"SBIS3.CONTROLS.DropdownList\": \"SBIS3.CONTROLS/DropdownList\",\n   \"SBIS3.CONTROLS.DropdownListMixin\": \"SBIS3.CONTROLS/Mixins/DropdownListMixin\",\n   \"SBIS3.CONTROLS.EditAtPlace\": \"SBIS3.CONTROLS/EditAtPlace\",\n   \"SBIS3.CONTROLS.EditAtPlaceGroup\": \"SBIS3.CONTROLS/EditAtPlace/EditAtPlaceGroup\",\n   \"SBIS3.CONTROLS.EditAtPlaceMixin\": \"SBIS3.CONTROLS/Mixins/EditAtPlaceMixin\",\n   \"SBIS3.CONTROLS.EditInPlace\": \"SBIS3.CONTROLS/ListView/resources/EditInPlace/EditInPlace\",\n   \"SBIS3.CONTROLS.EditInPlaceBaseController\": \"SBIS3.CONTROLS/ListView/resources/EditInPlaceBaseController/EditInPlaceBaseController\",\n   \"SBIS3.CONTROLS.EditInPlaceClickController\": \"SBIS3.CONTROLS/ListView/resources/EditInPlaceClickController/EditInPlaceClickController\",\n   \"SBIS3.CONTROLS.EditInPlaceHoverController\": \"SBIS3.CONTROLS/ListView/resources/EditInPlaceHoverController/EditInPlaceHoverController\",\n   \"SBIS3.CONTROLS.Expandable\": \"SBIS3.CONTROLS/Mixins/Expandable\",\n   \"SBIS3.CONTROLS.FastDataFilter\": \"SBIS3.CONTROLS/Filter/FastData\",\n   \"SBIS3.CONTROLS.FieldLink\": \"SBIS3.CONTROLS/FieldLink\",\n   \"SBIS3.CONTROLS.FieldLink.Link\": \"SBIS3.CONTROLS/FieldLink/Link\",\n   \"SBIS3.CONTROLS.FieldLinkItemsCollection\": \"SBIS3.CONTROLS/FieldLink/resources/ItemsCollection\",\n   \"SBIS3.CONTROLS.FilterButton\": \"SBIS3.CONTROLS/Filter/Button\",\n   \"SBIS3.CONTROLS.FilterButton.FilterLine\": \"SBIS3.CONTROLS/Filter/Button/Line\",\n   \"SBIS3.CONTROLS.FilterButton.FilterToStringUtil\": \"SBIS3.CONTROLS/Filter/Button/Utils/FilterToStringUtil\",\n   \"SBIS3.CONTROLS.FilterButtonArea\": \"SBIS3.CONTROLS/Filter/Button/Area\",\n   \"SBIS3.CONTROLS.FilterController\": \"SBIS3.CONTROLS/ComponentBinder/FilterController\",\n   \"SBIS3.CONTROLS.FilterDropdown\": \"SBIS3.CONTROLS/Filter/Button/Dropdown\",\n   \"SBIS3.CONTROLS.FilterHistory\": \"SBIS3.CONTROLS/Filter/Button/History\",\n   \"SBIS3.CONTROLS.FilterHistoryController\": \"SBIS3.CONTROLS/Filter/HistoryController\",\n   \"SBIS3.CONTROLS.FilterHistoryControllerUntil\": \"SBIS3.CONTROLS/Filter/HistoryController/FilterHistoryControllerUntil\",\n   \"SBIS3.CONTROLS.FilterHistoryView\": \"SBIS3.CONTROLS/Filter/HistoryView\",\n   \"SBIS3.CONTROLS.FilterLink\": \"SBIS3.CONTROLS/Filter/Button/Link\",\n   \"SBIS3.CONTROLS.FilterMixin\": \"SBIS3.CONTROLS/Mixins/FilterMixin\",\n   \"SBIS3.CONTROLS.FilterPanel\": \"SBIS3.CONTROLS/Filter/FilterPanel\",\n   \"SBIS3.CONTROLS.FilterPanel/\": \"SBIS3.CONTROLS/Filter/Panel/FilterPanel.module.js\",\n   \"SBIS3.CONTROLS.FilterPanelBoolean\": \"SBIS3.CONTROLS/Filter/Panel/components/Boolean\",\n   \"SBIS3.CONTROLS.FilterPanelChooser.Base\": \"SBIS3.CONTROLS/Filter/Panel/components/Chooser/Base\",\n   \"SBIS3.CONTROLS.FilterPanelChooser.BaseList\": \"SBIS3.CONTROLS/Filter/Panel/components/Chooser/BaseList\",\n   \"SBIS3.CONTROLS.FilterPanelChooser.DetailsList\": \"SBIS3.CONTROLS/Filter/Panel/components/Chooser/DetailsList\",\n   \"SBIS3.CONTROLS.FilterPanelChooser.DictionaryList\": \"SBIS3.CONTROLS/Filter/Panel/components/Chooser/DictionaryList\",\n   \"SBIS3.CONTROLS.FilterPanelChooser.FavoritesList\": \"SBIS3.CONTROLS/Filter/Panel/components/Chooser/FavoritesList\",\n   \"SBIS3.CONTROLS.FilterPanelChooser.FieldLink\": \"SBIS3.CONTROLS/Filter/Panel/components/Chooser/FieldLink\",\n   \"SBIS3.CONTROLS.FilterPanelChooser.List\": \"SBIS3.CONTROLS/Filter/Panel/components/Chooser/List\",\n   \"SBIS3.CONTROLS.FilterPanelChooser.RadioGroup\": \"SBIS3.CONTROLS/Filter/Panel/components/Chooser/RadioGroup\",\n   \"SBIS3.CONTROLS.FilterPanelDataRange\": \"SBIS3.CONTROLS/Filter/Panel/components/DataRange\",\n   \"SBIS3.CONTROLS.FilterPanelItem\": \"SBIS3.CONTROLS/Filter/Panel/components/PanelItem\",\n   \"SBIS3.CONTROLS.FilterSelect\": \"SBIS3.CONTROLS/Filter/Button/Select\",\n   \"SBIS3.CONTROLS.FilterText\": \"SBIS3.CONTROLS/Filter/Button/Text\",\n   \"SBIS3.CONTROLS.FloatArea\": \"SBIS3.CONTROLS/FloatArea\",\n   \"SBIS3.CONTROLS.FloatAreaSelector\": \"SBIS3.CONTROLS/FloatArea/FloatAreaSelector\",\n   \"SBIS3.CONTROLS.FontStyle\": \"SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle\",\n   \"SBIS3.CONTROLS.FormController\": \"SBIS3.CONTROLS/FormController\",\n   \"SBIS3.CONTROLS.FormWidgetMixin\": \"SBIS3.CONTROLS/Mixins/FormWidgetMixin\",\n   \"SBIS3.CONTROLS.FormattedTextBox\": \"SBIS3.CONTROLS/FormattedTextBox\",\n   \"SBIS3.CONTROLS.FormattedTextBoxBase\": \"SBIS3.CONTROLS/FormattedTextBox/FormattedTextBoxBase\",\n   \"SBIS3.CONTROLS.GenericLongOperationsProducer\": \"SBIS3.CONTROLS/LongOperations/GenericProducer/GenericLongOperationsProducer\",\n   \"SBIS3.CONTROLS.HierarchySelection\": \"SBIS3.CONTROLS/ListView/resources/MassSelectionController/resources/HierarchySelection\",\n   \"SBIS3.CONTROLS.HighCharts\": \"SBIS3.CONTROLS/HighCharts\",\n   \"SBIS3.CONTROLS.HighChartsLight\": \"SBIS3.CONTROLS/HighChartsLight\",\n   \"SBIS3.CONTROLS.HistoryController\": \"SBIS3.CONTROLS/History/HistoryController\",\n   \"SBIS3.CONTROLS.HistoryList\": \"SBIS3.CONTROLS/History/HistoryList\",\n   \"SBIS3.CONTROLS.IFilterItem\": \"SBIS3.CONTROLS/Filter/Panel/resources/IFilterItem\",\n   \"SBIS3.CONTROLS.IItemsControl\": \"SBIS3.CONTROLS/Interfaces/IItemsControl\",\n   \"SBIS3.CONTROLS.IListNavigation\": \"SBIS3.CONTROLS/Controllers/IListNavigation\",\n   \"SBIS3.CONTROLS.ILongOperationsHistoricalProducer\": \"SBIS3.CONTROLS/LongOperations/IHistoricalProducer/ILongOperationsHistoricalProducer\",\n   \"SBIS3.CONTROLS.ILongOperationsProducer\": \"SBIS3.CONTROLS/LongOperations/IProducer\",\n   \"SBIS3.CONTROLS.ISaveStrategy\": \"SBIS3.CONTROLS/Action/Save/SaveStrategy/ISaveStrategy\",\n   \"SBIS3.CONTROLS.IStorage\": \"SBIS3.CONTROLS/Interfaces/IStorage\",\n   \"SBIS3.CONTROLS.ITargetRelativePositionAdapter\": \"SBIS3.CONTROLS/Layouts/ContainerPosition/ITargetRelativePositionAdapter\",\n   \"SBIS3.CONTROLS.ITextValue\": \"SBIS3.CONTROLS/Mixins/ITextValue\",\n   \"SBIS3.CONTROLS.IconButton\": \"SBIS3.CONTROLS/Button/IconButton\",\n   \"SBIS3.CONTROLS.IconMixin\": \"SBIS3.CONTROLS/Mixins/IconMixin\",\n   \"SBIS3.CONTROLS.Image\": \"SBIS3.CONTROLS/Image\",\n   \"SBIS3.CONTROLS.Image.CropPlugin\": \"SBIS3.CONTROLS/Image/CropPlugin/CropPlugin\",\n   \"SBIS3.CONTROLS.Image.EditDialog\": \"SBIS3.CONTROLS/Image/resources/EditDialog/EditDialog\",\n   \"SBIS3.CONTROLS.ImitateEvents\": \"SBIS3.CONTROLS/Utils/ImitateEvents\",\n   \"SBIS3.CONTROLS.InformationPopup\": \"SBIS3.CONTROLS/InformationPopup\",\n   \"SBIS3.CONTROLS.ItemActionsGroup\": \"SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup\",\n   \"SBIS3.CONTROLS.ItemsControlMixin\": \"SBIS3.CONTROLS/Mixins/ItemsControlMixin\",\n   \"SBIS3.CONTROLS.ItemsMoveController\": \"SBIS3.CONTROLS/Controllers/ItemsMoveController\",\n   \"SBIS3.CONTROLS.ItemsToolbar\": \"SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar\",\n   \"SBIS3.CONTROLS.Label\": \"SBIS3.CONTROLS/Label\",\n   \"SBIS3.CONTROLS.Label.compatibility\": \"SBIS3.CONTROLS/Label/resources/Label.compatibility\",\n   \"SBIS3.CONTROLS.Link\": \"SBIS3.CONTROLS/Link\",\n   \"SBIS3.CONTROLS.LinkFieldController\": \"SBIS3.CONTROLS/Link/LinkFieldController\",\n   \"SBIS3.CONTROLS.List.Remove\": \"SBIS3.CONTROLS/Action/List/Remove\",\n   \"SBIS3.CONTROLS.ListView\": \"SBIS3.CONTROLS/ListView\",\n   \"SBIS3.CONTROLS.ListView.DragMove\": \"SBIS3.CONTROLS/ListView/resources/DragMove/DragMove\",\n   \"SBIS3.CONTROLS.ListView.Mover\": \"SBIS3.CONTROLS/ListView/resources/Mover\",\n   \"SBIS3.CONTROLS.ListView/resources/SwipeHandlers\": \"SBIS3.CONTROLS/ListView/resources/SwipeHandlers\",\n   \"SBIS3.CONTROLS.LoadingIndicator\": \"SBIS3.CONTROLS/LoadingIndicator\",\n   \"SBIS3.CONTROLS.LongOperationEntry\": \"SBIS3.CONTROLS/LongOperations/Entry/LongOperationEntry\",\n   \"SBIS3.CONTROLS.LongOperationHistory\": \"SBIS3.CONTROLS/LongOperations/History\",\n   \"SBIS3.CONTROLS.LongOperationHistoryItem\": \"SBIS3.CONTROLS/LongOperations/HistoryItem/LongOperationHistoryItem\",\n   \"SBIS3.CONTROLS.LongOperations.AbstractProducer\": \"SBIS3.CONTROLS/LongOperations/AbstractProducer\",\n   \"SBIS3.CONTROLS.LongOperations.Const\": \"SBIS3.CONTROLS/LongOperations/Const\",\n   \"SBIS3.CONTROLS.LongOperations.Entry\": \"SBIS3.CONTROLS/LongOperations/Entry\",\n   \"SBIS3.CONTROLS.LongOperations.GenericProducer\": \"SBIS3.CONTROLS/LongOperations/GenericProducer\",\n   \"SBIS3.CONTROLS.LongOperations.HistoryItem\": \"SBIS3.CONTROLS/LongOperations/HistoryItem\",\n   \"SBIS3.CONTROLS.LongOperations.IHistoricalProducer\": \"SBIS3.CONTROLS/LongOperations/IHistoricalProducer\",\n   \"SBIS3.CONTROLS.LongOperations.IProducer\": \"SBIS3.CONTROLS/LongOperations/IProducer\",\n   \"SBIS3.CONTROLS.LongOperations.Manager\": \"SBIS3.CONTROLS/LongOperations/Manager\",\n   \"SBIS3.CONTROLS.LongOperations.ManagerLib\": \"SBIS3.CONTROLS/LongOperations/ManagerLib\",\n   \"SBIS3.CONTROLS.LongOperations.TabKey\": \"SBIS3.CONTROLS/LongOperations/TabKey\",\n   \"SBIS3.CONTROLS.LongOperations.Tools.Bunch\": \"SBIS3.CONTROLS/LongOperations/Tools/Bunch\",\n   \"SBIS3.CONTROLS.LongOperations.Tools.CallsPool\": \"SBIS3.CONTROLS/LongOperations/Tools/CallsPool\",\n   \"SBIS3.CONTROLS.LongOperations.Tools.Postloader\": \"SBIS3.CONTROLS/LongOperations/Tools/Postloader\",\n   \"SBIS3.CONTROLS.LongOperations.Tools.ProtectedScope\": \"SBIS3.CONTROLS/LongOperations/Tools/ProtectedScope\",\n   \"SBIS3.CONTROLS.LongOperations.Tools.TabCalls\": \"SBIS3.CONTROLS/LongOperations/Tools/TabCalls\",\n   \"SBIS3.CONTROLS.LongOperationsConst\": \"SBIS3.CONTROLS/LongOperations/Const/LongOperationsConst\",\n   \"SBIS3.CONTROLS.LongOperationsFilter\": \"SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter\",\n   \"SBIS3.CONTROLS.LongOperationsList\": \"SBIS3.CONTROLS/LongOperations/List\",\n   \"SBIS3.CONTROLS.LongOperationsList/resources/DataSource\": \"SBIS3.CONTROLS/LongOperations/List/resources/DataSource\",\n   \"SBIS3.CONTROLS.LongOperationsManager\": \"SBIS3.CONTROLS/LongOperations/Manager/LongOperationsManager\",\n   \"SBIS3.CONTROLS.LongOperationsPopup\": \"SBIS3.CONTROLS/LongOperations/Popup\",\n   \"SBIS3.CONTROLS.LongOperationsRegistry\": \"SBIS3.CONTROLS/LongOperations/Registry\",\n   \"SBIS3.CONTROLS.MassAmountSelector\": \"SBIS3.CONTROLS/OperationsPanel/Print/MassAmountSelector\",\n   \"SBIS3.CONTROLS.MassSelectionController\": \"SBIS3.CONTROLS/ListView/resources/MassSelectionController/MassSelectionController\",\n   \"SBIS3.CONTROLS.MassSelectionHierarchyController\": \"SBIS3.CONTROLS/ListView/resources/MassSelectionController/MassSelectionHierarchyController\",\n   \"SBIS3.CONTROLS.Menu\": \"SBIS3.CONTROLS/Menu\",\n   \"SBIS3.CONTROLS.MenuButton\": \"SBIS3.CONTROLS/Menu/MenuButton\",\n   \"SBIS3.CONTROLS.MenuButtonMixin\": \"SBIS3.CONTROLS/Mixins/MenuButtonMixin\",\n   \"SBIS3.CONTROLS.MenuIcon\": \"SBIS3.CONTROLS/Menu/MenuIcon\",\n   \"SBIS3.CONTROLS.MenuItem\": \"SBIS3.CONTROLS/Menu/MenuItem\",\n   \"SBIS3.CONTROLS.MenuLink\": \"SBIS3.CONTROLS/Menu/MenuLink\",\n   \"SBIS3.CONTROLS.MergeAction\": \"SBIS3.CONTROLS/Action/MergeAction\",\n   \"SBIS3.CONTROLS.MergeDialogTemplate\": \"SBIS3.CONTROLS/OperationsPanel/Merge/DialogTemplate\",\n   \"SBIS3.CONTROLS.MissSpell\": \"SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell\",\n   \"SBIS3.CONTROLS.MoneyTextBox\": \"SBIS3.CONTROLS/MoneyTextBox\",\n   \"SBIS3.CONTROLS.MonthPicker\": \"SBIS3.CONTROLS/Date/MonthPicker\",\n   \"SBIS3.CONTROLS.MonthView\": \"SBIS3.CONTROLS/Date/MonthView\",\n   \"SBIS3.CONTROLS.MoveDialogTemplate\": \"SBIS3.CONTROLS/OperationsPanel/Move/resources/MoveDialogTemplate\",\n   \"SBIS3.CONTROLS.MultiSelectable\": \"SBIS3.CONTROLS/Mixins/MultiSelectable\",\n   \"SBIS3.CONTROLS.NotificationPopup\": \"SBIS3.CONTROLS/NotificationPopup\",\n   \"SBIS3.CONTROLS.NumberTextBox\": \"SBIS3.CONTROLS/NumberTextBox\",\n   \"SBIS3.CONTROLS.NumberTextBox/NumberTextBox/resources/FormatText\": \"SBIS3.CONTROLS/NumberTextBox/resources/FormatText\",\n   \"SBIS3.CONTROLS.OpenDialogAction\": \"SBIS3.CONTROLS/Action/OpenDialogAction\",\n   \"SBIS3.CONTROLS.OperationDelete\": \"SBIS3.CONTROLS/OperationsPanel/Delete\",\n   \"SBIS3.CONTROLS.OperationMerge\": \"SBIS3.CONTROLS/OperationsPanel/Merge\",\n   \"SBIS3.CONTROLS.OperationMove\": \"SBIS3.CONTROLS/OperationsPanel/Move\",\n   \"SBIS3.CONTROLS.OperationPrint\": \"SBIS3.CONTROLS/OperationsPanel/Print\",\n   \"SBIS3.CONTROLS.OperationSum\": \"SBIS3.CONTROLS/OperationsPanel/Sum\",\n   \"SBIS3.CONTROLS.OperationUnload\": \"SBIS3.CONTROLS/OperationsPanel/Unload\",\n   \"SBIS3.CONTROLS.OperationsMark\": \"SBIS3.CONTROLS/OperationsPanel/Mark\",\n   \"SBIS3.CONTROLS.OperationsPanel\": \"SBIS3.CONTROLS/OperationsPanel\",\n   \"SBIS3.CONTROLS.OperationsPanelButton\": \"SBIS3.CONTROLS/OperationsPanel/PanelButton/OperationsPanelButton\",\n   \"SBIS3.CONTROLS.Pager\": \"SBIS3.CONTROLS/Pager\",\n   \"SBIS3.CONTROLS.PagerMore\": \"SBIS3.CONTROLS/Pager/More\",\n   \"SBIS3.CONTROLS.Paging\": \"SBIS3.CONTROLS/Paging\",\n   \"SBIS3.CONTROLS.PagingController\": \"SBIS3.CONTROLS/ComponentBinder/PagingController\",\n   \"SBIS3.CONTROLS.Panel\": \"SBIS3.CONTROLS/Panel\",\n   \"SBIS3.CONTROLS.Panel/design/DesignPlugin\": \"SBIS3.CONTROLS/Panel/design/DesignPlugin\",\n   \"SBIS3.CONTROLS.PasswordTextBox\": \"SBIS3.CONTROLS/PasswordTextBox\",\n   \"SBIS3.CONTROLS.PhoneCall\": \"SBIS3.CONTROLS/PhoneTextBox/PhoneCall\",\n   \"SBIS3.CONTROLS.PhoneTextBox\": \"SBIS3.CONTROLS/PhoneTextBox\",\n   \"SBIS3.CONTROLS.PickerMixin\": \"SBIS3.CONTROLS/Mixins/PickerMixin\",\n   \"SBIS3.CONTROLS.PopupMixin\": \"SBIS3.CONTROLS/Mixins/PopupMixin\",\n   \"SBIS3.CONTROLS.PrintButton\": \"SBIS3.CONTROLS/OperationsPanel/Print/PrintButton\",\n   \"SBIS3.CONTROLS.PrintDialogTemplate\": \"SBIS3.CONTROLS/PrintDialogTemplate\",\n   \"SBIS3.CONTROLS.PrintUnloadBase\": \"SBIS3.CONTROLS/OperationsPanel/Print/PrintUnloadBase\",\n   \"SBIS3.CONTROLS.ProcessStateIndicator\": \"SBIS3.CONTROLS/ProcessStateIndicator\",\n   \"SBIS3.CONTROLS.ProgressBar\": \"SBIS3.CONTROLS/ProgressBar\",\n   \"SBIS3.CONTROLS.RadioButton\": \"SBIS3.CONTROLS/Radio/Button\",\n   \"SBIS3.CONTROLS.RadioButtonBase\": \"SBIS3.CONTROLS/Radio/Button/RadioButtonBase\",\n   \"SBIS3.CONTROLS.RadioGroup\": \"SBIS3.CONTROLS/Radio/Group\",\n   \"SBIS3.CONTROLS.RadioGroupBase\": \"SBIS3.CONTROLS/Radio/Group/RadioGroupBase\",\n   \"SBIS3.CONTROLS.RangeMixin\": \"SBIS3.CONTROLS/Mixins/RangeMixin\",\n   \"SBIS3.CONTROLS.RangeSelectableViewMixin\": \"SBIS3.CONTROLS/Mixins/RangeSelectableViewMixin\",\n   \"SBIS3.CONTROLS.RichEditor\": \"SBIS3.CONTROLS/RichEditor\",\n   \"SBIS3.CONTROLS.RichEditor.CodeSampleDialog\": \"SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog\",\n   \"SBIS3.CONTROLS.RichEditor.ImageOptionsPanel\": \"SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel\",\n   \"SBIS3.CONTROLS.RichEditor.ImagePanel\": \"SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel\",\n   \"SBIS3.CONTROLS.RichEditor.ImagePropertiesDialog\": \"SBIS3.CONTROLS/RichEditor/Components/ImagePropertiesDialog\",\n   \"SBIS3.CONTROLS.RichEditorRoundToolbar\": \"SBIS3.CONTROLS/RichEditor/Components/RoundToolbar\",\n   \"SBIS3.CONTROLS.RichEditorRoundToolbar/resources/config\": \"SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/resources/config\",\n   \"SBIS3.CONTROLS.RichEditorRoundToolbar/resources/handlers\": \"SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/resources/handlers\",\n   \"SBIS3.CONTROLS.RichEditorToolbar\": \"SBIS3.CONTROLS/RichEditor/Components/Toolbar\",\n   \"SBIS3.CONTROLS.RichEditorToolbar/resources/config\": \"SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/config\",\n   \"SBIS3.CONTROLS.RichEditorToolbar/resources/handlers\": \"SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/handlers\",\n   \"SBIS3.CONTROLS.RichEditorToolbarBase\": \"SBIS3.CONTROLS/RichEditor/Components/ToolbarBase\",\n   \"SBIS3.CONTROLS.RichTextArea\": \"SBIS3.CONTROLS/RichEditor/Components/RichTextArea\",\n   \"SBIS3.CONTROLS.RichTextArea/resources/smiles\": \"SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/smiles\",\n   \"SBIS3.CONTROLS.SBISClientsGlobalConfigStorage\": \"SBIS3.CONTROLS/Storages/SBIS/SBISClientsGlobalConfigStorage\",\n   \"SBIS3.CONTROLS.SBISHistoryStorage\": \"SBIS3.CONTROLS/Storages/SBIS/SBISHistoryStorage\",\n   \"SBIS3.CONTROLS.SBISStorageAdapter\": \"SBIS3.CONTROLS/Storages/SBIS/SBISStorageAdapter\",\n   \"SBIS3.CONTROLS.SBISUserConfigStorage\": \"SBIS3.CONTROLS/Storages/SBIS/SBISUserConfigStorage\",\n   \"SBIS3.CONTROLS.SaveStrategy.Base\": \"SBIS3.CONTROLS/Action/Save/SaveStrategy/Base\",\n   \"SBIS3.CONTROLS.SaveStrategy.Sbis\": \"SBIS3.CONTROLS/Action/Save/SaveStrategy/Sbis\",\n   \"SBIS3.CONTROLS.SbisMenu\": \"SBIS3.CONTROLS/Menu/SbisMenu\",\n   \"SBIS3.CONTROLS.ScrollContainer\": \"SBIS3.CONTROLS/ScrollContainer\",\n   \"SBIS3.CONTROLS.ScrollPagingController\": \"SBIS3.CONTROLS/ComponentBinder/ScrollPagingController\",\n   \"SBIS3.CONTROLS.ScrollUtil\": \"SBIS3.CONTROLS/Utils/ScrollUtil\",\n   \"SBIS3.CONTROLS.ScrollWatcher\": \"SBIS3.CONTROLS/Utils/ScrollWatcher\",\n   \"SBIS3.CONTROLS.Scrollbar\": \"SBIS3.CONTROLS/ScrollContainer/Scrollbar\",\n   \"SBIS3.CONTROLS.SearchController\": \"SBIS3.CONTROLS/ComponentBinder/SearchController\",\n   \"SBIS3.CONTROLS.SearchForm\": \"SBIS3.CONTROLS/SearchForm\",\n   \"SBIS3.CONTROLS.SearchMixin\": \"SBIS3.CONTROLS/Mixins/SearchMixin\",\n   \"SBIS3.CONTROLS.Selectable\": \"SBIS3.CONTROLS/Mixins/Selectable\",\n   \"SBIS3.CONTROLS.Selection\": \"SBIS3.CONTROLS/ListView/resources/MassSelectionController/resources/Selection\",\n   \"SBIS3.CONTROLS.SelectionDialog\": \"SBIS3.CONTROLS/Action/resources/SelectionDialog\",\n   \"SBIS3.CONTROLS.SelectorButton\": \"SBIS3.CONTROLS/SelectorButton\",\n   \"SBIS3.CONTROLS.SelectorController\": \"SBIS3.CONTROLS/Action/Selector/SelectorController\",\n   \"SBIS3.CONTROLS.SelectorMixin\": \"SBIS3.CONTROLS/Mixins/SelectorMixin\",\n   \"SBIS3.CONTROLS.SelectorWrapper\": \"SBIS3.CONTROLS/Action/Selector/SelectorWrapper\",\n   \"SBIS3.CONTROLS.SessionStorage\": \"SBIS3.CONTROLS/Storages/SessionStorage\",\n   \"SBIS3.CONTROLS.Slider\": \"SBIS3.CONTROLS/Slider\",\n   \"SBIS3.CONTROLS.SliderInput\": \"SBIS3.CONTROLS/Slider/Input\",\n   \"SBIS3.CONTROLS.Spoiler\": \"SBIS3.CONTROLS/Spoiler\",\n   \"SBIS3.CONTROLS.StateButton\": \"SBIS3.CONTROLS/Button/StateButton\",\n   \"SBIS3.CONTROLS.StylesPanelNew\": \"SBIS3.CONTROLS/StylesPanelNew\",\n   \"SBIS3.CONTROLS.SubmitPopup\": \"SBIS3.CONTROLS/SubmitPopup\",\n   \"SBIS3.CONTROLS.Suggest\": \"SBIS3.CONTROLS/Suggest\",\n   \"SBIS3.CONTROLS.SuggestMixin\": \"SBIS3.CONTROLS/Mixins/SuggestMixin\",\n   \"SBIS3.CONTROLS.SuggestShowAll\": \"SBIS3.CONTROLS/Suggest/SuggestShowAll\",\n   \"SBIS3.CONTROLS.SuggestTextBox\": \"SBIS3.CONTROLS/Suggest/SuggestTextBox\",\n   \"SBIS3.CONTROLS.SuggestTextBoxMixin\": \"SBIS3.CONTROLS/Mixins/SuggestTextBoxMixin\",\n   \"SBIS3.CONTROLS.SuggestView\": \"SBIS3.CONTROLS/Suggest/SuggestView\",\n   \"SBIS3.CONTROLS.SumDialogTemplate\": \"SBIS3.CONTROLS/Action/List/resources/SumDialogTemplate\",\n   \"SBIS3.CONTROLS.SwitchableArea\": \"SBIS3.CONTROLS/SwitchableArea\",\n   \"SBIS3.CONTROLS.Switcher\": \"SBIS3.CONTROLS/Switcher\",\n   \"SBIS3.CONTROLS.SwitcherDouble\": \"SBIS3.CONTROLS/Switcher/Double\",\n   \"SBIS3.CONTROLS.SyncSelectionMixin\": \"SBIS3.CONTROLS/Mixins/SyncSelectionMixin\",\n   \"SBIS3.CONTROLS.TabButton\": \"SBIS3.CONTROLS/Tab/Button\",\n   \"SBIS3.CONTROLS.TabButtons\": \"SBIS3.CONTROLS/Tab/Buttons\",\n   \"SBIS3.CONTROLS.TabControl\": \"SBIS3.CONTROLS/Tab/Control\",\n   \"SBIS3.CONTROLS.TagSelector\": \"SBIS3.CONTROLS/TagSelector\",\n   \"SBIS3.CONTROLS.TargetRelativePositionModel\": \"SBIS3.CONTROLS/Layouts/ContainerPosition/TargetRelativePositionModel\",\n   \"SBIS3.CONTROLS.TextArea\": \"SBIS3.CONTROLS/TextArea\",\n   \"SBIS3.CONTROLS.TextBox\": \"SBIS3.CONTROLS/TextBox\",\n   \"SBIS3.CONTROLS.TextBoxBase\": \"SBIS3.CONTROLS/TextBox/TextBoxBase\",\n   \"SBIS3.CONTROLS.TextBoxUtils\": \"SBIS3.CONTROLS/TextBox/resources/TextBoxUtils\",\n   \"SBIS3.CONTROLS.TimeHeader\": \"SBIS3.CONTROLS/Date/TimePicker/TimeHeader\",\n   \"SBIS3.CONTROLS.TimeInterval\": \"SBIS3.CONTROLS/Date/TimeInterval\",\n   \"SBIS3.CONTROLS.TimePicker\": \"SBIS3.CONTROLS/Date/TimePicker\",\n   \"SBIS3.CONTROLS.TimePickerUtils\": \"SBIS3.CONTROLS/Date/TimePicker/TimePickerUtils\",\n   \"SBIS3.CONTROLS.TitleManager\": \"SBIS3.CONTROLS/TitleManager\",\n   \"SBIS3.CONTROLS.ToSourceModel\": \"SBIS3.CONTROLS/Utils/ToSourceModel\",\n   \"SBIS3.CONTROLS.ToggleButton\": \"SBIS3.CONTROLS/Button/ToggleButton\",\n   \"SBIS3.CONTROLS.Toolbar\": \"SBIS3.CONTROLS/Toolbar\",\n   \"SBIS3.CONTROLS.ToolbarBase\": \"SBIS3.CONTROLS/Toolbar/ToolbarBase\",\n   \"SBIS3.CONTROLS.ToolbarOnline\": \"SBIS3.CONTROLS/Toolbar/Online\",\n   \"SBIS3.CONTROLS.Tooltip\": \"SBIS3.CONTROLS/Tooltip\",\n   \"SBIS3.CONTROLS.TouchKeyboardHelper\": \"SBIS3.CONTROLS/Utils/TouchKeyboardHelper\",\n   \"SBIS3.CONTROLS.TreeCompositeView\": \"SBIS3.CONTROLS/Tree/CompositeView\",\n   \"SBIS3.CONTROLS.TreeDataGridView\": \"SBIS3.CONTROLS/Tree/DataGridView\",\n   \"SBIS3.CONTROLS.TreeMixin\": \"SBIS3.CONTROLS/Mixins/TreeMixin\",\n   \"SBIS3.CONTROLS.TreeMixinDS\": \"SBIS3.CONTROLS/Mixins/TreeMixinDS\",\n   \"SBIS3.CONTROLS.TreeView\": \"SBIS3.CONTROLS/Tree/View\",\n   \"SBIS3.CONTROLS.TreeViewMixin\": \"SBIS3.CONTROLS/Mixins/TreeViewMixin\",\n   \"SBIS3.CONTROLS.UnitEditor\": \"SBIS3.CONTROLS/UnitEditor\",\n   \"SBIS3.CONTROLS.UnloadButton\": \"SBIS3.CONTROLS/OperationsPanel/Unload/Button\",\n   \"SBIS3.CONTROLS.Utils.ConfigByClasses\": \"SBIS3.CONTROLS/Utils/ConfigByClasses\",\n   \"SBIS3.CONTROLS.Utils.Contains\": \"SBIS3.CONTROLS/Utils/Contains\",\n   \"SBIS3.CONTROLS.Utils.DataProcessor\": \"SBIS3.CONTROLS/Utils/DataProcessor\",\n   \"SBIS3.CONTROLS.Utils.DataSetToXMLSerializer\": \"SBIS3.CONTROLS/Utils/DataSetToXmlSerializer\",\n   \"SBIS3.CONTROLS.Utils.DateUtil\": \"SBIS3.CONTROLS/Utils/DateUtil\",\n   \"SBIS3.CONTROLS.Utils.GetTextWidth\": \"SBIS3.CONTROLS/Utils/GetTextWidth\",\n   \"SBIS3.CONTROLS.Utils.HtmlDecorators\": \"SBIS3.CONTROLS/Utils/HtmlDecorators/HtmlDecorators\",\n   \"SBIS3.CONTROLS.Utils.HtmlDecorators.AbstractDecorator\": \"SBIS3.CONTROLS/Utils/HtmlDecorators/AbstractDecorator\",\n   \"SBIS3.CONTROLS.Utils.HtmlDecorators.ColorMarkDecorator\": \"SBIS3.CONTROLS/Utils/HtmlDecorators/ColorMarkDecorator\",\n   \"SBIS3.CONTROLS.Utils.HtmlDecorators.DateFormatDecorator\": \"SBIS3.CONTROLS/Utils/HtmlDecorators/DateFormatDecorator\",\n   \"SBIS3.CONTROLS.Utils.HtmlDecorators.HighlightDecorator\": \"SBIS3.CONTROLS/Utils/HtmlDecorators/HighlightDecorator\",\n   \"SBIS3.CONTROLS.Utils.HtmlDecorators.LadderDecorator\": \"SBIS3.CONTROLS/Utils/HtmlDecorators/LadderDecorator\",\n   \"SBIS3.CONTROLS.Utils.IfEnabled\": \"SBIS3.CONTROLS/Utils/IfEnabled\",\n   \"SBIS3.CONTROLS.Utils.ImageUtil\": \"SBIS3.CONTROLS/Utils/ImageUtil\",\n   \"SBIS3.CONTROLS.Utils.InformationPopupManager\": \"SBIS3.CONTROLS/Utils/InformationPopupManager\",\n   \"SBIS3.CONTROLS.Utils.IsChildControl\": \"SBIS3.CONTROLS/Utils/IsChildControl\",\n   \"SBIS3.CONTROLS.Utils.ItemsSelection\": \"SBIS3.CONTROLS/Utils/ItemsSelectionUtil\",\n   \"SBIS3.CONTROLS.Utils.KbLayoutRevertObserver\": \"SBIS3.CONTROLS/Utils/KbLayoutRevert/KbLayoutRevertObserver\",\n   \"SBIS3.CONTROLS.Utils.KbLayoutRevertUtil\": \"SBIS3.CONTROLS/Utils/KbLayoutRevert/KbLayoutRevertUtil\",\n   \"SBIS3.CONTROLS.Utils.LinkUtil\": \"SBIS3.CONTROLS/Utils/LinkUtil\",\n   \"SBIS3.CONTROLS.Utils.LinkWrap\": \"SBIS3.CONTROLS/Utils/LinkWrapUtils\",\n   \"SBIS3.CONTROLS.Utils.NotificationStackManager\": \"SBIS3.CONTROLS/Utils/NotificationStackManager\",\n   \"SBIS3.CONTROLS.Utils.NumberTextBoxUtil\": \"SBIS3.CONTROLS/Utils/NumberTextBoxUtil\",\n   \"SBIS3.CONTROLS.Utils.OpenDialog\": \"SBIS3.CONTROLS/Action/Utils/OpenDialogUtil\",\n   \"SBIS3.CONTROLS.Utils.PrintDialogHTMLView\": \"SBIS3.CONTROLS/Utils/PrintDialogHTMLView\",\n   \"SBIS3.CONTROLS.Utils.Query\": \"SBIS3.CONTROLS/Utils/QueryUtil\",\n   \"SBIS3.CONTROLS.Utils.RecordSetUtil\": \"SBIS3.CONTROLS/Utils/RecordSetUtil\",\n   \"SBIS3.CONTROLS.Utils.RichTextAreaUtil\": \"SBIS3.CONTROLS/Utils/RichTextAreaUtil/RichTextAreaUtil\",\n   \"SBIS3.CONTROLS.Utils.Sanitize\": \"SBIS3.CONTROLS/Utils/Sanitize\",\n   \"SBIS3.CONTROLS.Utils.SearchMixin\": \"SBIS3.CONTROLS/Mixins/SearchMixin/SearchMixinUtil\",\n   \"SBIS3.CONTROLS.Utils.SourceUtil\": \"SBIS3.CONTROLS/Utils/SourceUtil\",\n   \"SBIS3.CONTROLS.Utils.TemplateUtil\": \"SBIS3.CONTROLS/Utils/TemplateUtil\",\n   \"SBIS3.CONTROLS.Utils.TitleUtil\": \"SBIS3.CONTROLS/Utils/TitleUtil\",\n   \"SBIS3.CONTROLS.Utils.TreeDataReload\": \"SBIS3.CONTROLS/Utils/TreeDataReload\",\n   \"SBIS3.CONTROLS.Utils.WrapFileOpener\": \"SBIS3.CONTROLS/Utils/WrapFileOpener\",\n   \"SBIS3.CONTROLS.ViewSourceMixin\": \"SBIS3.CONTROLS/Mixins/ViewSourceMixin\",\n   \"SBIS3.CONTROLS.VirtualScrollController\": \"SBIS3.CONTROLS/ListView/resources/VirtualScrollController\",\n   \"SBIS3.CONTROLS.WaitIndicator\": \"SBIS3.CONTROLS/WaitIndicator\",\n   \"SBIS3.CONTROLS.hierarchyMixin\": \"SBIS3.CONTROLS/Mixins/hierarchyMixin\",\n   \"SBIS3.CORE.Accordion\": \"Deprecated/Controls/Accordion/Accordion\",\n   \"SBIS3.CORE.Accordion/design/DesignPlugin\": \"Deprecated/Controls/Accordion/design/DesignPlugin\",\n   \"SBIS3.CORE.AccordionCollapsePlugin\": \"Deprecated/Controls/Accordion/plugins/Collapse-plugin\",\n   \"SBIS3.CORE.AreaAbstract\": \"Lib/Control/AreaAbstract/AreaAbstract\",\n   \"SBIS3.CORE.AreaAbstract/AreaAbstract.compatible\": \"Lib/Control/AreaAbstract/AreaAbstract.compatible\",\n   \"SBIS3.CORE.AtPlaceEditPlugin\": \"Deprecated/Controls/TableView/plugins/AtPlaceEdit-plugin\",\n   \"SBIS3.CORE.AttributeCfgParser\": \"Lib/Control/AttributeCfgParser/AttributeCfgParser\",\n   \"SBIS3.CORE.BaseCompatible\": \"Lib/Control/BaseCompatible/BaseCompatible\",\n   \"SBIS3.CORE.BaseCompatible/Mixins/WsCompatibleConstructor\": \"Lib/Control/BaseCompatible/Mixins/WsCompatibleConstructor\",\n   \"SBIS3.CORE.BreakClickBySelectMixin\": \"Lib/Mixins/BreakClickBySelectMixin\",\n   \"SBIS3.CORE.Button\": \"Deprecated/Controls/Button/Button\",\n   \"SBIS3.CORE.ButtonAbstract\": \"Deprecated/Controls/ButtonAbstract/ButtonAbstract\",\n   \"SBIS3.CORE.Cache\": \"Lib/Cache/Cache\",\n   \"SBIS3.CORE.CameraWindow\": \"Lib/Control/FileCamLoader/resources/CameraWindow/CameraWindow\",\n   \"SBIS3.CORE.CloseButton\": \"Deprecated/Controls/CloseButton/CloseButton\",\n   \"SBIS3.CORE.CollapsingNavigation\": \"Lib/CollapsingNavigation/CollapsingNavigation\",\n   \"SBIS3.CORE.ColorMarkPlugin\": \"Deprecated/Controls/TableView/plugins/ColorMark-plugin\",\n   \"SBIS3.CORE.CompoundActiveFixMixin\": \"Lib/Mixins/CompoundActiveFixMixin\",\n   \"SBIS3.CORE.CompoundControl\": \"Lib/Control/CompoundControl/CompoundControl\",\n   \"SBIS3.CORE.Control\": \"Lib/Control/Control\",\n   \"SBIS3.CORE.Control/Control.compatible\": \"Lib/Control/Control.compatible\",\n   \"SBIS3.CORE.Control/ControlGoodCode\": \"Lib/Control/ControlGoodCode\",\n   \"SBIS3.CORE.CopyPlugin\": \"Deprecated/Controls/DataViewAbstract/plugins/Copy-plugin\",\n   \"SBIS3.CORE.CoreValidators\": \"Lib/CoreValidators/CoreValidators\",\n   \"SBIS3.CORE.CropPlugin\": \"Deprecated/Controls/FieldImage/plugins/FieldImageCrop-plugin\",\n   \"SBIS3.CORE.CustomType\": \"Lib/Type/CustomType\",\n   \"SBIS3.CORE.CustomView\": \"Deprecated/Controls/CustomView/CustomView\",\n   \"SBIS3.CORE.DataBoundMixin\": \"Lib/Mixins/DataBoundMixin\",\n   \"SBIS3.CORE.DataViewAbstract\": \"Deprecated/Controls/DataViewAbstract/DataViewAbstract\",\n   \"SBIS3.CORE.DateRange\": \"Deprecated/Controls/DateRange/DateRange\",\n   \"SBIS3.CORE.DateRange/design/DesignPlugin\": \"Deprecated/Controls/DateRange/design/DesignPlugin\",\n   \"SBIS3.CORE.DateRangeChoose\": \"Deprecated/Controls/DateRangeChoose/DateRangeChoose\",\n   \"SBIS3.CORE.DateRangeChoose/design/DesignPlugin\": \"Deprecated/Controls/DateRangeChoose/design/DateRangeChoose\",\n   \"SBIS3.CORE.Dialog\": \"Lib/Control/Dialog/Dialog\",\n   \"SBIS3.CORE.DialogAlert\": \"Deprecated/Controls/DialogAlert/DialogAlert\",\n   \"SBIS3.CORE.DialogConfirm\": \"Deprecated/Controls/DialogConfirm/DialogConfirm\",\n   \"SBIS3.CORE.DialogRecord\": \"Deprecated/Controls/DialogRecord/DialogRecord\",\n   \"SBIS3.CORE.DialogSelector\": \"Deprecated/Controls/DialogSelector/DialogSelector\",\n   \"SBIS3.CORE.DragAndDropPlugin\": \"Deprecated/Controls/DragAndDropPlugin/DragAndDropPlugin\",\n   \"SBIS3.CORE.FieldAbstract\": \"Deprecated/Controls/FieldAbstract/FieldAbstract\",\n   \"SBIS3.CORE.FieldCheckbox\": \"Deprecated/Controls/FieldCheckbox/FieldCheckbox\",\n   \"SBIS3.CORE.FieldCheckbox/design/DesignPlugin\": \"Deprecated/Controls/FieldCheckbox/design/DesignPlugin\",\n   \"SBIS3.CORE.FieldCheckbox/design/design\": \"Deprecated/Controls/FieldCheckbox/design/design\",\n   \"SBIS3.CORE.FieldDate\": \"Deprecated/Controls/FieldDate/FieldDate\",\n   \"SBIS3.CORE.FieldDate/design/DesignPlugin\": \"Deprecated/Controls/FieldDate/design/DesignPlugin\",\n   \"SBIS3.CORE.FieldDate/resources/ext/jquery.ui.datepicker-local\": \"Deprecated/Controls/FieldDate/resources/ext/jquery.ui.datepicker-local\",\n   \"SBIS3.CORE.FieldDatePicker\": \"Deprecated/Controls/FieldDatePicker/FieldDatePicker\",\n   \"SBIS3.CORE.FieldDropDownExtendedHover\": \"Deprecated/Controls/PathFilter/resources/FieldDropDownExtendedHover\",\n   \"SBIS3.CORE.FieldDropdown\": \"Deprecated/Controls/FieldDropdown/FieldDropdown\",\n   \"SBIS3.CORE.FieldDropdown/design/DesignPlugin\": \"Deprecated/Controls/FieldDropdown/design/DesignPlugin\",\n   \"SBIS3.CORE.FieldEditAtPlace\": \"Deprecated/Controls/FieldEditAtPlace/FieldEditAtPlace\",\n   \"SBIS3.CORE.FieldEditAtPlace/design/DesignPlugin\": \"Deprecated/Controls/FieldEditAtPlace/design/DesignPlugin\",\n   \"SBIS3.CORE.FieldEditAtPlace/design/design\": \"Deprecated/Controls/FieldEditAtPlace/design/design\",\n   \"SBIS3.CORE.FieldFormatAbstract\": \"Deprecated/Controls/FieldFormatAbstract/FieldFormatAbstract\",\n   \"SBIS3.CORE.FieldFormatAbstract/design/DesignPlugin\": \"Deprecated/Controls/FieldFormatAbstract/design/DesignPlugin\",\n   \"SBIS3.CORE.FieldImage\": \"Deprecated/Controls/FieldImage/FieldImage\",\n   \"SBIS3.CORE.FieldInteger\": \"Deprecated/Controls/FieldInteger/FieldInteger\",\n   \"SBIS3.CORE.FieldLabel\": \"Deprecated/Controls/FieldLabel/FieldLabel\",\n   \"SBIS3.CORE.FieldLabel/design/DesignPlugin\": \"Deprecated/Controls/FieldLabel/design/DesignPlugin\",\n   \"SBIS3.CORE.FieldLink\": \"Deprecated/Controls/FieldLink/FieldLink\",\n   \"SBIS3.CORE.FieldLink/design/DesignPlugin\": \"Deprecated/Controls/FieldLink/design/DesignPlugin\",\n   \"SBIS3.CORE.FieldLink/design/design\": \"Deprecated/Controls/FieldLink/design/design\",\n   \"SBIS3.CORE.FieldMask\": \"Deprecated/Controls/FieldMask/FieldMask\",\n   \"SBIS3.CORE.FieldMoney\": \"Deprecated/Controls/FieldMoney/FieldMoney\",\n   \"SBIS3.CORE.FieldMonth\": \"Deprecated/Controls/FieldMonth/FieldMonth\",\n   \"SBIS3.CORE.FieldNumeric\": \"Deprecated/Controls/FieldNumeric/FieldNumeric\",\n   \"SBIS3.CORE.FieldNumeric/design/DesignPlugin\": \"Deprecated/Controls/FieldNumeric/design/DesignPlugin\",\n   \"SBIS3.CORE.FieldRadio\": \"Deprecated/Controls/FieldRadio/FieldRadio\",\n   \"SBIS3.CORE.FieldRadio/design/DesignPlugin\": \"Deprecated/Controls/FieldRadio/design/DesignPlugin\",\n   \"SBIS3.CORE.FieldRadio/resources/ext/ui.checkbox\": \"Deprecated/Controls/FieldRadio/resources/ext/ui.checkbox\",\n   \"SBIS3.CORE.FieldString\": \"Deprecated/Controls/FieldString/FieldString\",\n   \"SBIS3.CORE.FieldText\": \"Deprecated/Controls/FieldText/FieldText\",\n   \"SBIS3.CORE.FieldText/resources/Autosize-plugin\": \"Deprecated/Controls/FieldText/resources/Autosize-plugin\",\n   \"SBIS3.CORE.FileBrowse\": \"Lib/Control/FileBrowse/FileBrowse\",\n   \"SBIS3.CORE.FileButton\": \"Lib/Control/FileButton/FileButton\",\n   \"SBIS3.CORE.FileButton/design/DesignPlugin\": \"Lib/Control/FileButton/design/DesignPlugin\",\n   \"SBIS3.CORE.FileCam\": \"Lib/Control/FileCam/FileCam\",\n   \"SBIS3.CORE.FileCamLoader\": \"Lib/Control/FileCamLoader/FileCamLoader\",\n   \"SBIS3.CORE.FileCamLoader/resources/canvasToBlob\": \"Lib/Control/FileCamLoader/resources/canvasToBlob\",\n   \"SBIS3.CORE.FileClipboard\": \"Lib/Control/FileClipboard/FileClipboard\",\n   \"SBIS3.CORE.FileClipboardLoader\": \"Lib/Control/FileClipboardLoader/FileClipboardLoader\",\n   \"SBIS3.CORE.FileLoader\": \"Lib/Control/FileLoader/FileLoader\",\n   \"SBIS3.CORE.FileLoaderAbstract\": \"Lib/Control/FileLoaderAbstract/FileLoaderAbstract\",\n   \"SBIS3.CORE.FileScanLoader\": \"Lib/Control/FileScanLoader/FileScanLoader\",\n   \"SBIS3.CORE.FileScaner\": \"Lib/Control/FileScaner/FileScaner\",\n   \"SBIS3.CORE.FileStorageLoader\": \"Lib/Control/FileStorageLoader/FileStorageLoader\",\n   \"SBIS3.CORE.FilterButton\": \"Deprecated/Controls/FilterButton/FilterButton\",\n   \"SBIS3.CORE.FilterButton/design/design\": \"Deprecated/Controls/FilterButton/design/design\",\n   \"SBIS3.CORE.FilterButtonArea\": \"Deprecated/Controls/FilterButton/FilterButtonArea/FilterButtonArea\",\n   \"SBIS3.CORE.FilterButtonHistory\": \"Deprecated/Controls/FilterButton/FilterButtonHistory/FilterButtonHistory\",\n   \"SBIS3.CORE.FilterController\": \"Deprecated/Controls/FilterController/FilterController\",\n   \"SBIS3.CORE.FilterFloatArea\": \"Deprecated/Controls/FilterFloatArea/FilterFloatArea\",\n   \"SBIS3.CORE.FilterView\": \"Deprecated/Controls/FilterView/FilterView\",\n   \"SBIS3.CORE.FiltersArea\": \"Deprecated/Controls/FiltersArea/FiltersArea\",\n   \"SBIS3.CORE.FiltersDialog\": \"Deprecated/Controls/FiltersDialog/FiltersDialog\",\n   \"SBIS3.CORE.FiltersWindow\": \"Deprecated/Controls/FiltersWindow/FiltersWindow\",\n   \"SBIS3.CORE.FloatArea\": \"Lib/Control/FloatArea/FloatArea\",\n   \"SBIS3.CORE.FloatAreaManager\": \"Lib/FloatAreaManager/FloatAreaManager\",\n   \"SBIS3.CORE.FloatAreaSelector\": \"Deprecated/Controls/DialogSelector/FloatAreaSelector\",\n   \"SBIS3.CORE.GroupCheckBox\": \"Deprecated/Controls/GroupCheckBox/GroupCheckBox\",\n   \"SBIS3.CORE.GroupCheckBox/design/DesignPlugin\": \"Deprecated/Controls/GroupCheckBox/design/DesignPlugin\",\n   \"SBIS3.CORE.GroupCheckBox/design/design\": \"Deprecated/Controls/GroupCheckBox/design/design\",\n   \"SBIS3.CORE.HTMLView\": \"Deprecated/Controls/HTMLView/HTMLView\",\n   \"SBIS3.CORE.HasItemsMixin\": \"Lib/Mixins/HasItemsMixin\",\n   \"SBIS3.CORE.HasTabsMixin\": \"Lib/Mixins/HasTabsMixin\",\n   \"SBIS3.CORE.HierarchyCustomView\": \"Deprecated/Controls/HierarchyCustomView/HierarchyCustomView\",\n   \"SBIS3.CORE.HierarchyView\": \"Deprecated/Controls/HierarchyView/HierarchyView\",\n   \"SBIS3.CORE.HierarchyViewAbstract\": \"Deprecated/Controls/HierarchyViewAbstract/HierarchyViewAbstract\",\n   \"SBIS3.CORE.ImageGallery\": \"Deprecated/Controls/ImageGallery/ImageGallery\",\n   \"SBIS3.CORE.Infobox\": \"Lib/Control/Infobox/Infobox\",\n   \"SBIS3.CORE.InfoboxContent\": \"Lib/Control/InfoboxContent/InfoboxContent\",\n   \"SBIS3.CORE.InfoboxTrigger\": \"Lib/Control/InfoboxTrigger/InfoboxTrigger\",\n   \"SBIS3.CORE.KbLayoutRevert\": \"Lib/KbLayoutRevert/KbLayoutRevert\",\n   \"SBIS3.CORE.Label\": \"Deprecated/Controls/Label/Label\",\n   \"SBIS3.CORE.Label/\": \"Deprecated/Controls/Label/Label.module.js\",\n   \"SBIS3.CORE.Label/design/DesignPlugin\": \"Deprecated/Controls/Label/design/DesignPlugin\",\n   \"SBIS3.CORE.Label/design/design\": \"Deprecated/Controls/Label/design/design\",\n   \"SBIS3.CORE.LadderPlugin\": \"Deprecated/Controls/TableView/plugins/Ladder-plugin\",\n   \"SBIS3.CORE.LayoutManager\": \"Lib/LayoutManager/LayoutManager\",\n   \"SBIS3.CORE.LikeWindowMixin\": \"Lib/Mixins/LikeWindowMixin\",\n   \"SBIS3.CORE.LinkButton\": \"Deprecated/Controls/LinkButton/LinkButton\",\n   \"SBIS3.CORE.LoadingIndicator\": \"Deprecated/Controls/LoadingIndicator/LoadingIndicator\",\n   \"SBIS3.CORE.LocalStorage\": \"Lib/Storage/LocalStorage\",\n   \"SBIS3.CORE.MarkedRowOptionsPlugin\": \"Deprecated/Controls/DataViewAbstract/plugins/MarkedRowOptions-plugin\",\n   \"SBIS3.CORE.Marker\": \"Lib/Marker/Marker\",\n   \"SBIS3.CORE.Master\": \"Lib/Control/Master/Master\",\n   \"SBIS3.CORE.MasterProgress\": \"Deprecated/Controls/MasterProgress/MasterProgress\",\n   \"SBIS3.CORE.Menu\": \"Deprecated/Controls/Menu/Menu\",\n   \"SBIS3.CORE.MergePlugin\": \"Deprecated/Controls/DataViewAbstract/plugins/Merge-plugin\",\n   \"SBIS3.CORE.ModalOverlay\": \"Deprecated/Controls/ModalOverlay/ModalOverlay\",\n   \"SBIS3.CORE.MovePlugin\": \"Deprecated/Controls/DataViewAbstract/plugins/Move-plugin\",\n   \"SBIS3.CORE.NavigationController\": \"Lib/NavigationController/NavigationController\",\n   \"SBIS3.CORE.NavigationPanel\": \"Deprecated/Controls/NavigationPanel/NavigationPanel\",\n   \"SBIS3.CORE.NavigationPanelCollapsePlugin\": \"Deprecated/Controls/NavigationPanel/plugins/Collapse-plugin\",\n   \"SBIS3.CORE.OperationsPanel\": \"Deprecated/Controls/OperationsPanel/OperationsPanel\",\n   \"SBIS3.CORE.OperationsPanelND\": \"Deprecated/Controls/OperationsPanelND/OperationsPanelND\",\n   \"SBIS3.CORE.OutlineButton\": \"Deprecated/Controls/OutlineButton/OutlineButton\",\n   \"SBIS3.CORE.PageFilter\": \"Deprecated/Controls/PageFilter/PageFilter\",\n   \"SBIS3.CORE.Paging\": \"Lib/Control/Paging/Paging\",\n   \"SBIS3.CORE.PartScrollPlugin\": \"Deprecated/Controls/TableView/plugins/PartScroll-plugin/PartScroll-plugin\",\n   \"SBIS3.CORE.PathFilter\": \"Deprecated/Controls/PathFilter/PathFilter\",\n   \"SBIS3.CORE.PathSelector\": \"Deprecated/Controls/PathSelector/PathSelector\",\n   \"SBIS3.CORE.PendingOperationParentMixin\": \"Lib/Mixins/PendingOperationParentMixin\",\n   \"SBIS3.CORE.PendingOperationProducerMixin\": \"Lib/Mixins/PendingOperationProducerMixin\",\n   \"SBIS3.CORE.PrintDialog\": \"Deprecated/Controls/PrintDialog/PrintDialog\",\n   \"SBIS3.CORE.PrintPlugin\": \"Deprecated/Controls/DataViewAbstract/plugins/Print-plugin\",\n   \"SBIS3.CORE.ProgressBar\": \"Deprecated/Controls/ProgressBar/ProgressBar\",\n   \"SBIS3.CORE.PushButton\": \"Deprecated/Controls/PushButton/PushButton\",\n   \"SBIS3.CORE.RaphaelDrawerInternal\": \"Deprecated/Controls/RaphaelDrawerInternal/RaphaelDrawerInternal\",\n   \"SBIS3.CORE.RecordArea\": \"Deprecated/Controls/RecordArea/RecordArea\",\n   \"SBIS3.CORE.RecordFloatArea\": \"Deprecated/Controls/RecordFloatArea/RecordFloatArea\",\n   \"SBIS3.CORE.RequestHistoryPlugin\": \"Deprecated/Controls/FilterButton/plugins/RequestHistory-plugin\",\n   \"SBIS3.CORE.ResultsPlugin\": \"Deprecated/Controls/TableView/plugins/Results-plugin\",\n   \"SBIS3.CORE.RightAccordionPlugin\": \"Deprecated/Controls/TableView/plugins/RightAccordion-plugin/RightAccordion-plugin\",\n   \"SBIS3.CORE.ScrollPaging\": \"Deprecated/Controls/TableView/plugins/ScrollPaging-plugin\",\n   \"SBIS3.CORE.SearchString\": \"Deprecated/Controls/SearchString/SearchString\",\n   \"SBIS3.CORE.SearchString/design/design\": \"Deprecated/Controls/SearchString/design/design\",\n   \"SBIS3.CORE.SelectScannerDialog\": \"Lib/Control/FileScanLoader/resources/SelectScannerDialog/SelectScannerDialog\",\n   \"SBIS3.CORE.Selector\": \"Deprecated/Controls/DialogSelector/Selector\",\n   \"SBIS3.CORE.ServerEventBus\": \"Lib/ServerEvent/Bus\",\n   \"SBIS3.CORE.ServiceUpdateNotifier\": \"Lib/ServiceUpdateNotifier/ServiceUpdateNotifier\",\n   \"SBIS3.CORE.SimpleDialogAbstract\": \"Deprecated/Controls/SimpleDialogAbstract/SimpleDialogAbstract\",\n   \"SBIS3.CORE.Suggest\": \"Lib/Control/Suggest/Suggest\",\n   \"SBIS3.CORE.Summator\": \"Lib/DemoModule/Summator\",\n   \"SBIS3.CORE.SwitchableArea\": \"Deprecated/Controls/SwitchableArea/SwitchableArea\",\n   \"SBIS3.CORE.SwitchableArea/SwitchableAreaItem\": \"Deprecated/Controls/SwitchableArea/SwitchableAreaItem\",\n   \"SBIS3.CORE.SwitchableArea/design/DesignPlugin\": \"Deprecated/Controls/SwitchableArea/design/DesignPlugin\",\n   \"SBIS3.CORE.SwitchableArea/design/design\": \"Deprecated/Controls/SwitchableArea/design/design\",\n   \"SBIS3.CORE.Switcher\": \"Deprecated/Controls/Switcher/Switcher\",\n   \"SBIS3.CORE.Switcher/design/DesignPlugin\": \"Deprecated/Controls/Switcher/design/DesignPlugin\",\n   \"SBIS3.CORE.SwitcherAbstract\": \"Deprecated/Controls/SwitcherAbstract/SwitcherAbstract\",\n   \"SBIS3.CORE.SwitcherDouble\": \"Deprecated/Controls/SwitcherDouble/SwitcherDouble\",\n   \"SBIS3.CORE.TDataSource\": \"Lib/Type/TDataSource/TDataSource\",\n   \"SBIS3.CORE.TReaderParams\": \"Lib/Type/TReaderParams/TReaderParams\",\n   \"SBIS3.CORE.TabButtons\": \"Deprecated/Controls/TabButtons/TabButtons\",\n   \"SBIS3.CORE.TabButtons/design/DesignPlugin\": \"Deprecated/Controls/TabButtons/design/DesignPlugin\",\n   \"SBIS3.CORE.TabButtons/design/design\": \"Deprecated/Controls/TabButtons/design/design\",\n   \"SBIS3.CORE.TabControl\": \"Deprecated/Controls/TabControl/TabControl\",\n   \"SBIS3.CORE.TabControl/TabItem\": \"Deprecated/Controls/TabControl/TabItem\",\n   \"SBIS3.CORE.TabControl/design/DesignPlugin\": \"Deprecated/Controls/TabControl/design/DesignPlugin\",\n   \"SBIS3.CORE.TabControl/design/design\": \"Deprecated/Controls/TabControl/design/design\",\n   \"SBIS3.CORE.TabMessage\": \"Lib/TabMessage/TabMessage\",\n   \"SBIS3.CORE.TabTemplatedArea\": \"Deprecated/Controls/TabTemplatedArea/TabTemplatedArea\",\n   \"SBIS3.CORE.TableView\": \"Deprecated/Controls/TableView/TableView\",\n   \"SBIS3.CORE.TableView/design/DesignPlugin\": \"Deprecated/Controls/TableView/design/DesignPlugin\",\n   \"SBIS3.CORE.Tabs\": \"Deprecated/Controls/Tabs/Tabs\",\n   \"SBIS3.CORE.TemplatedArea\": \"Lib/Control/TemplatedArea/TemplatedArea\",\n   \"SBIS3.CORE.TemplatedArea/design/DesignPlugin\": \"Deprecated/Controls/TemplatedArea/design/DesignPlugin\",\n   \"SBIS3.CORE.TemplatedArea/design/design\": \"Lib/Control/TemplatedArea/design/design\",\n   \"SBIS3.CORE.TemplatedAreaAbstract\": \"Lib/Control/TemplatedAreaAbstract/TemplatedAreaAbstract\",\n   \"SBIS3.CORE.TileView\": \"Deprecated/Controls/TileView/TileView\",\n   \"SBIS3.CORE.ToolBar\": \"Deprecated/Controls/ToolBar/ToolBar\",\n   \"SBIS3.CORE.ToolbarPlugin\": \"Deprecated/Controls/DataViewAbstract/plugins/Toolbar-plugin\",\n   \"SBIS3.CORE.TreeView\": \"Deprecated/Controls/TreeView/TreeView\",\n   \"SBIS3.CORE.TreeView/design/DesignPlugin\": \"Deprecated/Controls/TreeView/design/DesignPlugin\",\n   \"SBIS3.CORE.Window\": \"Lib/Control/Window/Window\",\n   \"SBIS3.CORE.ZoomPlugin\": \"Deprecated/Controls/FieldImage/plugins/FieldImageZoom-plugin\",\n   \"SBIS3.CORE.bignumWrapper\": \"WS/ext/bignumWrapper\",\n   \"SBIS3.StickyHeaderMediator\": \"Lib/StickyHeader/StickyHeaderMediator/StickyHeaderMediator\",\n   \"SBIS3.StickyHeaderManager\": \"Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager\",\n   \"SBIS3.CORE.SelectMergeRecordDialog\": \"Deprecated/res/wsmodules/SelectMergeRecordDialog/SelectMergeRecordDialog\",\n   \"SBIS3.CORE.ConfirmRecordActionsDialog\": \"Deprecated/res/wsmodules/ConfirmRecordActionsDialog/ConfirmRecordActionsDialog\",\n   \"SBIS3.CORE.ReplaceRecordDialog\": \"Deprecated/res/wsmodules/ReplaceRecordDialog/ReplaceRecordDialog\",\n   \"SBIS3.CORE.SuggestShowAllDialog\": \"Deprecated/res/wsmodules/SuggestShowAllDialog/SuggestShowAllDialog\",\n   \"SBIS3.CORE.SumDialog\": \"Deprecated/res/wsmodules/SumDialog/SumDialog\",\n   \"SBIS3.CORE.ErrorsReportDialog\": \"Deprecated/res/wsmodules/ErrorsReportDialog/ErrorsReportDialog\",\n   \"SBIS3.CORE.ValidateCountDialog\": \"Deprecated/res/wsmodules/ValidateCountDialog/ValidateCountDialog\",\n   \"SBIS3.CORE.ColorizeDialog\": \"Deprecated/res/wsmodules/ColorizeDialog/ColorizeDialog\",\n   \"SBIS3.CORE.SelectColumnsDialog\": \"Deprecated/res/wsmodules/SelectColumnsDialog/SelectColumnsDialog\",\n   \"SBIS3.CORE.Raphael\": \"ext/raphael/raphael-full.js\",\n   \"SBIS3.CORE.GRaphael\": \"ext/raphael/g.raphael-full.js\",\n   \"SBIS3.CORE.Raphael.PathMethods\": \"ext/raphael/raphael.path.methods.js\"\n}";});
(function(){"use strict";var e=function(){return this||(0,eval)("this")}();(e.define||e.requirejs&&e.requirejs.define||requirejsVars&&requirejsVars.define)("i18n",["Core/i18n","Core/constants","text","native-css"],function(e,t){var r=t.isNodePlatform||t.isServerScript;return{load:function(t,i,s){if(r||e.isEnabled()){var n=e.getLang(),a=r?Object.keys(e.getAvailableLang()):e.hasLang(n)?[n]:[],c=[],o=[],f=[],u=function(i){var s,n;if(s=e.getDictPath(t,i,"json"),s)c.push("text!"+s),f.push(i);if(!r){if(n=e.getDictPath(t,i,"css"),n)o.push("native-css!"+n);var a=i.substr(3,2);if(n=e.getDictPath(t,a,"css"),n)o.push("native-css!"+n)}};for(var h in a)if(a.hasOwnProperty(h))u(a[h]);i(c.concat(o),function(){try{for(var t=0,r=c.length;t<r;t++)e.setDict(JSON.parse(arguments[t]),c[t],f[t]);s(e.rk.bind(e))}catch(e){s.error(e)}},function(e){s.error(e)})}else s(e.rk.bind(e))}}})})();
//# sourceMappingURL=i18n.js.map
define("Core/htmlparser2",["Core/IoC"],function(t){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var o=e[i]={exports:{},id:i,loaded:false};return t[i].call(o.exports,o,o.exports,s),o.loaded=true,o.exports}return s.m=t,s.c=e,s.p="",s(0)}([function(t,e,s){var i=s(1),o={input:true,option:true,optgroup:true,select:true,button:true,datalist:true,textarea:true},n={tr:{tr:true,th:true,td:true},th:{th:true},td:{thead:true,th:true,td:true},body:{head:true,link:true,script:true},li:{li:true},p:{p:true},h1:{p:true},h2:{p:true},h3:{p:true},h4:{p:true},h5:{p:true},h6:{p:true},select:o,input:o,output:o,button:o,datalist:o,textarea:o,optgroup:{optgroup:true}};function r(t,e){if(t&&"select"===t.toLowerCase())if(!e)n.option={option:true};else delete n.option}var a={__proto__:null,area:true,base:true,basefont:true,br:true,col:true,command:true,embed:true,frame:true,hr:true,img:true,input:true,isindex:true,keygen:true,link:true,meta:true,param:true,source:true,track:true,wbr:true,path:true,circle:true,ellipse:true,line:true,rect:true,use:true,stop:true,polyline:true,polygon:true},_=/\s|\//;function h(t,e){if(this._options=e||{},this._cbs=t||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._attribssequence=null,this._attribsquotes=null,this._stack=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,!!this._options.Tokenizer)i=this._options.Tokenizer;if(this._tokenizer=new i(this._options,this),this._cbs.onparserinit)this._cbs.onparserinit(this)}h.prototype._updatePosition=function(t){if(null===this.endIndex)if(this._tokenizer._sectionStart<=t)this.startIndex=0;else this.startIndex=this._tokenizer._sectionStart-t;else this.startIndex=this.endIndex+1;this.endIndex=this._tokenizer.getAbsoluteIndex()},h.prototype.ontext=function(t){if(this._updatePosition(1),this.endIndex--,this._cbs.ontext)this._cbs.ontext(t)},h.prototype.onopentagname=function(t){if(this._lowerCaseTagNames)t=t.toLowerCase();if(this._tagname=t,!this._options.xmlMode&&t in n)for(var e;(e=this._stack[this._stack.length-1])in n[t];this.onclosetag(e));if(this._options.xmlMode||!(t in a))this._stack.push(t);if(this._cbs.onopentagname)this._cbs.onopentagname(t);if(this._cbs.onopentag)this._attribs={},this._attribssequence=[],this._attribsquotes={}},h.prototype.onopentagend=function(){if(this._updatePosition(1),this._attribs){if(this._cbs.onopentag)this._cbs.onopentag(this._tagname,this._attribs,this._attribsquotes,this._attribssequence);r(this._tagname,false),this._attribs=null,this._attribssequence=null,this._attribsquotes=null}if(!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in a)this._cbs.onclosetag(this._tagname,true);this._tagname=""},h.prototype.onclosetag=function(t){var e=t.toLowerCase();if(this._updatePosition(1),this._lowerCaseTagNames)t=e;if(r(t,true),this._stack.length&&(!(t in a)||this._options.xmlMode)){var s=this._stack.length-1;while(s>=0&&this._stack[s].toLowerCase()!==e)s--;if(-1!==s)if(this._cbs.onclosetag){s=this._stack.length-s;while(s--)this._cbs.onclosetag(this._stack.pop().toLowerCase()===e?t:null)}else this._stack.length=s;else if("p"===t&&!this._options.xmlMode)this.onopentagname(t),this._closeCurrentTag()}else if(!this._options.xmlMode&&("br"===t||"p"===t))this.onopentagname(t),this._closeCurrentTag()},h.prototype.onselfclosingtag=function(){if(this._options.xmlMode||this._options.recognizeSelfClosing)this._closeCurrentTag();else this.onopentagend()},h.prototype._closeCurrentTag=function(){var t=this._tagname;if(this.onopentagend(),this._stack[this._stack.length-1]===t){if(this._cbs.onclosetag)this._cbs.onclosetag(t);this._stack.pop()}},h.prototype.onattribname=function(t){if(this._lowerCaseAttributeNames)t=t.toLowerCase();this._attribname=t},h.prototype.onattribdata=function(t){this._attribvalue+=t},h.prototype.onattribend=function(t){if(this._cbs.onattribute)this._cbs.onattribute(this._attribname,this._attribvalue);if(this._attribs){if('"'!==t&&"'"!==t)t="";this._attribssequence.push(this._attribname),this._attribs[this._attribname]=this._attribvalue,this._attribsquotes[this._attribname]=t}this._attribname="",this._attribvalue=""},h.prototype.ondotattributeend=function(t){this._attribssequence.push(t)},h.prototype._getInstructionName=function(t){var e=t.search(_),s=e<0?t:t.substr(0,e);if(this._lowerCaseTagNames)s=s.toLowerCase();return s},h.prototype.ondeclaration=function(t){if(this._cbs.onprocessinginstruction){var e=this._getInstructionName(t);this._cbs.onprocessinginstruction("!"+e,"!"+t)}},h.prototype.onprocessinginstruction=function(t){if(this._cbs.onprocessinginstruction){var e=this._getInstructionName(t);this._cbs.onprocessinginstruction("?"+e,"?"+t)}},h.prototype.oncomment=function(t){if(this._updatePosition(4),this._cbs.oncomment)this._cbs.oncomment(t);if(this._cbs.oncommentend)this._cbs.oncommentend()},h.prototype.onerror=function(t){if(this._cbs.onerror)this._cbs.onerror(t)},h.prototype.onend=function(){if(this._cbs.onclosetag){var t=this._stack.length;while(t--)this._cbs.onclosetag(null)}if(this._cbs.onend)this._cbs.onend()},h.prototype.reset=function(){if(this._cbs.onreset)this._cbs.onreset();if(this._tokenizer.reset(),this._tagname="",this._attribname="",this._tmplDepth=0,this._attribs=null,this._attribssequence=null,this._attribsquotes=null,this._stack=[],this._cbs.onparserinit)this._cbs.onparserinit(this)},h.prototype.parseComplete=function(t){this.reset(),this.end(t)},h.prototype.write=function(t){this._tokenizer.write(t)},h.prototype.end=function(t){this._tokenizer.end(t)},h.prototype.pause=function(){this._tokenizer.pause()},h.prototype.resume=function(){this._tokenizer.resume()},h.prototype.parseChunk=h.prototype.write,h.prototype.done=h.prototype.end,t.exports=h},function(e,s,i){e.exports=it;var o=0,n=o++,r=o++,a=o++,_=o++,h=o++,p=o++,f=o++,u=o++,c=o++,l=o++,b=o++,d=o++,y=o++,m=o++,g=o++,x=o++,S=o++,T=o++,A=o++,C=o++,I=o++,k=o++,B=o++,w=o++,N=o++,v=o++,E=o++,M=o++,q=o++,D=o++,L=o++,z=o++,P=o++,V=o++,O=o++,Q=o++,R=o++,W=o++,X=o++,Y=o++,H=o++,j=o++,F=o++,G=o++,J=o++,K=0,U=K++,Z=K++,$=K++;function tt(t){return" "===t||"\n"===t||"\t"===t||"\f"===t||"\r"===t}function et(t,e,s){var i=t.toLowerCase();if(t===i)return function(t){if(t===i)this._state=e;else this._state=s,this._index--};else return function(o){if(o===i||o===t)this._state=e;else this._state=s,this._index--}}function st(t,e){var s=t.toLowerCase();return function(i){if(i===s||i===t)this._state=e;else this._state=a,this._index--}}function it(t,e){this._state=n,this._returnToState=n,this._buffer="",this._sectionStart=0,this._index=0,this._tmplDepth=0,this._bufferOffset=0,this._special=U,this._cbs=e,this._running=true,this._ended=false,this._ignoreAttrib=false,this._xmlMode=!!(t&&t.xmlMode),this._decodeEntities=!!(t&&t.decodeEntities)}it.prototype.ignoreAttrib=function(t){this._ignoreAttrib=t},it.prototype._stateText=function(t){if("<"===t){if(this._index>this._sectionStart)this._cbs.ontext(this._getSection());this._state=r,this._sectionStart=this._index}else if("{"===t)this._state=O,this._returnToState=n},it.prototype._stateBeforeTagName=function(t){if("/"===t)this._state=h;else if("<"===t)this._cbs.ontext(this._getSection()),this._sectionStart=this._index;else if(">"===t||this._special!==U||tt(t))this._state=n;else if("!"===t)this._state=g,this._sectionStart=this._index+1;else if("?"===t)this._state=S,this._sectionStart=this._index+1;else this._state=!this._xmlMode&&("s"===t||"S"===t)?B:a,this._sectionStart=this._index},it.prototype._stateInTagName=function(t){if("/"===t||">"===t||"{"===t||tt(t))this._emitToken("onopentagname"),this._state=u,this._index--},it.prototype._stateBeforeCloseingTagName=function(t){if(tt(t));else if(">"===t)this._state=n;else if(this._special!==U)if("s"===t||"S"===t)this._state=w;else this._state=n,this._index--;else this._state=p,this._sectionStart=this._index},it.prototype._stateInCloseingTagName=function(t){if(">"===t||tt(t))this._emitToken("onclosetag"),this._state=f,this._index--},it.prototype._stateAfterCloseingTagName=function(t){if(">"===t)this._state=n,this._sectionStart=this._index+1},it.prototype._stateBeforeAttributeName=function(t){if(">"===t)this._cbs.onopentagend(),this._state=n,this._sectionStart=this._index+1;else if("/"===t)this._state=_;else if("{"===t)this._returnToState=u,this._state=O,this._sectionStart=this._index;else if("}"===t&&"{"===this._buffer[this._sectionStart])this._cbs.ondotattributeend(this._buffer.substring(this._sectionStart,this._index+1));else if(!tt(t))this._state=c,this._sectionStart=this._index},it.prototype._stateInSelfClosingTag=function(t){if(">"===t)this._cbs.onselfclosingtag(),this._state=n,this._sectionStart=this._index+1;else if(!tt(t))this._state=u,this._index--},it.prototype._stateInAttributeName=function(t){if("="===t||"/"===t||">"===t||tt(t))this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=l,this._index--},it.prototype._stateAfterAttributeName=function(t){if("="===t)this._state=b;else if("/"===t||">"===t)this._cbs.onattribend(),this._state=u,this._index--;else if(!tt(t))this._cbs.onattribend(),this._state=c,this._sectionStart=this._index},it.prototype._stateBeforeAttributeValue=function(t){if('"'===t)this._state=d,this._sectionStart=this._index+1;else if("'"===t)this._state=y,this._sectionStart=this._index+1;else if(!tt(t))this._state=m,this._sectionStart=this._index,this._index--},it.prototype._stateInAttributeValueDoubleQuotes=function(t){if('"'===t)!this._ignoreAttrib&&this._emitToken("onattribdata"),this._cbs.onattribend(t),this._state=u;else if("{"===t)this._state=O,this._returnToState=d},it.prototype._stateInAttributeValueSingleQuotes=function(t){if("'"===t)!this._ignoreAttrib&&this._emitToken("onattribdata"),this._cbs.onattribend(t),this._state=u;else if("{"===t)this._state=O,this._returnToState=y},it.prototype._stateInAttributeValueNoQuotes=function(e){if(t.resolve("ILogger").log("HTML Parser","Quotes are missing in the attribute value"),tt(e)||">"===e)!this._ignoreAttrib&&this._emitToken("onattribdata"),this._cbs.onattribend(e),this._state=u,this._index--;else if("{"===e)this._state=O,this._returnToState=m},it.prototype._stateBeforeDeclaration=function(t){this._state="-"===t?T:x},it.prototype._stateInDeclaration=function(t){if(">"===t)this._cbs.ondeclaration(this._getSection()),this._state=n,this._sectionStart=this._index+1},it.prototype._stateInProcessingInstruction=function(t){if(">"===t)this._cbs.onprocessinginstruction(this._getSection()),this._state=n,this._sectionStart=this._index+1},it.prototype._stateBeforeComment=function(t){if("-"===t)this._state=A,this._sectionStart=this._index+1;else this._state=x},it.prototype._stateInComment=function(t){if(this._index-this._sectionStart===9&&"WS-EXPERT"==this._buffer.substring(this._sectionStart,this._index))this._state=C;else if("-"===t)this._returnToState=A,this._state=I},it.prototype._stateInWsExpertComment=function(t){if("-"===t&&"WS-EXPERT-"===this._buffer.substring(this._index-10,this._index))this._returnToState=C,this._state=k},it.prototype._stateAfterComment1=function(t){if("-"===t)this._state=k;else this._state=this._returnToState},it.prototype._stateAfterComment2=function(t){if(">"===t)this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=n,this._sectionStart=this._index+1;else if("-"!==t)this._state=this._returnToState},it.prototype._stateBeforeSpecial=function(t){if("c"===t||"C"===t)this._state=N;else if("t"===t||"T"===t)this._state=W;else this._state=a,this._index--},it.prototype._stateBeforeSpecialEnd=function(t){if(this._special===Z&&("c"===t||"C"===t))this._state=D;else if(this._special===$&&("t"===t||"T"===t))this._state=j;else this._state=n},it.prototype._stateBeforeScript1=st("R",v),it.prototype._stateBeforeScript2=st("I",E),it.prototype._stateBeforeScript3=st("P",M),it.prototype._stateBeforeScript4=st("T",q),it.prototype._stateBeforeScript5=function(t){if("/"===t||">"===t||tt(t))this._special=Z;this._state=a,this._index--},it.prototype._stateAfterScript1=et("R",L,n),it.prototype._stateAfterScript2=et("I",z,n),it.prototype._stateAfterScript3=et("P",P,n),it.prototype._stateAfterScript4=et("T",V,n),it.prototype._stateAfterScript5=function(t){if(">"===t||tt(t))this._special=U,this._state=p,this._sectionStart=this._index-6,this._index--;else this._state=n},it.prototype._stateBeforeTmpl=function(t){if("{"===t)this._state=Q;else this._state=this._returnToState,this._index--},it.prototype._stateInTmpl=function(t){if("{"===t&&"{"===this._buffer[this._index-1])this._tmplDepth++;else if("}"===t)this._state=R},it.prototype._stateAfterTmpl=function(t){if("}"===t)if(0===this._tmplDepth){if(this._state=this._returnToState,this._returnToState===u)this._index--}else this._tmplDepth--,this._state=Q;else this._state=Q,this._index--},it.prototype._stateBeforeStyle1=st("Y",X),it.prototype._stateBeforeStyle2=st("L",Y),it.prototype._stateBeforeStyle3=st("E",H),it.prototype._stateBeforeStyle4=function(t){if("/"===t||">"===t||tt(t))this._special=$;this._state=a,this._index--},it.prototype._stateAfterStyle1=et("Y",F,n),it.prototype._stateAfterStyle2=et("L",G,n),it.prototype._stateAfterStyle3=et("E",J,n),it.prototype._stateAfterStyle4=function(t){if(">"===t||tt(t))this._special=U,this._state=p,this._sectionStart=this._index-5,this._index--;else this._state=n},it.prototype._cleanup=function(){if(this._sectionStart<0)this._buffer="",this._index=0,this._bufferOffset+=this._index;else if(this._running){if(this._state===n){if(this._sectionStart!==this._index)this._cbs.ontext(this._buffer.substr(this._sectionStart));this._buffer="",this._index=0,this._bufferOffset+=this._index}else if(this._sectionStart===this._index)this._buffer="",this._index=0,this._bufferOffset+=this._index;else this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart;this._sectionStart=0}},it.prototype.write=function(t){if(this._ended)this._cbs.onerror(Error(".write() after done!"));this._buffer+=t,this._parse()};var ot={};ot[n]=it.prototype._stateText,ot[r]=it.prototype._stateBeforeTagName,ot[a]=it.prototype._stateInTagName,ot[h]=it.prototype._stateBeforeCloseingTagName,ot[p]=it.prototype._stateInCloseingTagName,ot[f]=it.prototype._stateAfterCloseingTagName,ot[_]=it.prototype._stateInSelfClosingTag,ot[u]=it.prototype._stateBeforeAttributeName,ot[c]=it.prototype._stateInAttributeName,ot[l]=it.prototype._stateAfterAttributeName,ot[b]=it.prototype._stateBeforeAttributeValue,ot[d]=it.prototype._stateInAttributeValueDoubleQuotes,ot[y]=it.prototype._stateInAttributeValueSingleQuotes,ot[m]=it.prototype._stateInAttributeValueNoQuotes,ot[g]=it.prototype._stateBeforeDeclaration,ot[x]=it.prototype._stateInDeclaration,ot[S]=it.prototype._stateInProcessingInstruction,ot[T]=it.prototype._stateBeforeComment,ot[A]=it.prototype._stateInComment,ot[C]=it.prototype._stateInWsExpertComment,ot[I]=it.prototype._stateAfterComment1,ot[k]=it.prototype._stateAfterComment2,ot[B]=it.prototype._stateBeforeSpecial,ot[w]=it.prototype._stateBeforeSpecialEnd,ot[N]=it.prototype._stateBeforeScript1,ot[v]=it.prototype._stateBeforeScript2,ot[E]=it.prototype._stateBeforeScript3,ot[M]=it.prototype._stateBeforeScript4,ot[q]=it.prototype._stateBeforeScript5,ot[D]=it.prototype._stateAfterScript1,ot[L]=it.prototype._stateAfterScript2,ot[z]=it.prototype._stateAfterScript3,ot[P]=it.prototype._stateAfterScript4,ot[V]=it.prototype._stateAfterScript5,ot[O]=it.prototype._stateBeforeTmpl,ot[Q]=it.prototype._stateInTmpl,ot[R]=it.prototype._stateAfterTmpl,ot[W]=it.prototype._stateBeforeStyle1,ot[X]=it.prototype._stateBeforeStyle2,ot[Y]=it.prototype._stateBeforeStyle3,ot[H]=it.prototype._stateBeforeStyle4,ot[j]=it.prototype._stateAfterStyle1,ot[F]=it.prototype._stateAfterStyle2,ot[G]=it.prototype._stateAfterStyle3,ot[J]=it.prototype._stateAfterStyle4,it.prototype._parse=function(){while(this._index<this._buffer.length&&this._running){var t=this._buffer.charAt(this._index),e=ot[this._state];if(e)e.call(this,t);else this._cbs.onerror(Error("unknown _state"),this._state);this._index++}this._cleanup()},it.prototype.pause=function(){this._running=false},it.prototype.resume=function(){if(this._running=true,this._index<this._buffer.length)this._parse();if(this._ended)this._finish()},it.prototype.end=function(t){if(this._ended)this._cbs.onerror(Error(".end() after done!"));if(t)this.write(t);if(this._ended=true,this._running)this._finish()},it.prototype._finish=function(){if(this._sectionStart<this._index)this._handleTrailingData();this._cbs.onend()},it.prototype._handleTrailingData=function(){var t=this._buffer.substr(this._sectionStart);if(this._state===A||this._state===I||this._state===k)this._cbs.oncomment(t);else if(this._state!==a&&this._state!==u&&this._state!==b&&this._state!==l&&this._state!==c&&this._state!==y&&this._state!==d&&this._state!==m&&this._state!==p){var e="</maintag>",s=t.indexOf(e);if(s>=0)t=t.substring(0,s);this._cbs.ontext(t)}},it.prototype.reset=function(){it.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},it.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},it.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},it.prototype._emitToken=function(t){this._cbs[t](this._getSection()),this._sectionStart=-1}}])});
//# sourceMappingURL=htmlparser2.js.map
define("text!View/Builder/Tmpl/modules/templates/objectFunctionHeaderTemplate.jstpl", function(){ return "function debug() { debugger; }\nvar templateCount = 0;\nvar thelpers = typeof tclosure === 'undefined' || !tclosure ? arguments[arguments.length - 1] : tclosure;\nif (typeof thelpers === \"undefined\") {\n   eval(\"var thelpers = null;\");\n   thelpers = global.requirejs(\"View/Runner/tclosure\");\n}\nvar contextObj = {};\nif (sets && sets.isSetts) {\n   contextObj = sets.fullContext || {};\n}\nvar key = typeof context === \"string\" ? context : \"\";\nvar depsLocal = typeof _deps === 'undefined' ? undefined : _deps;\nvar defCollection = {id: [], def: undefined};\nvar viewController = thelpers.configResolver.calcParent(this, typeof currentPropertyName === 'undefined' ? undefined : currentPropertyName, data);";});
define("Core/Context",["Core/core-extend","Core/Abstract","Core/helpers/Object/isPlainObject","Core/helpers/Object/find","Core/helpers/Array/findIndex","Core/helpers/Function/shallowClone","Core/core-instance","Core/core-debug","Core/IoC"],function(e,t,i,n,s,r,o,a,l){function c(e){if(!Array.isArray(e))throw new TypeError("array-unique expects an array.");var t=e.length,i=-1;while(i++<t)for(var n=i+1;n<e.length;++n)if(e[i]===e[n])e.splice(n--,1);return e}var u,h={SET:"FindIntent.SET",GET:"FindIntent.GET",REMOVE:"FindIntent.REMOVE"},f={NONE:0,GET:1,SET:2,GETSET:3,UNDEFINEDS_AS_EXISTENT:4},d=function(e){return function(){return e}},_="/",p=".",g=function(){throw new Error(rk("Метод не должен вызываться"))},v=function(){},b={is:g,get:d(v),set:function(e,t,i){return 0===t.length?i:y.set({},t,i)},remove:g,setWillChange:d(true),toJSON:g},y={name:"SimpleFieldType",is:d(true),equals:function(e,t){return e===t||e&&t&&"function"===typeof e.equals&&e.equals(t)},get:function(e,t){var i,n,s;if(0===t.length)i=e;else if(null===e||"object"!==typeof e||!(t[0]in e))i=v;else n=e[t[0]],i=(s=u.getValueType(n)).get(n,t.slice(1));return i},setWillChange:function(e,t,i){var n,s,r,o;if(0===t.length)n=!y.equals(e,i);else if(e===v)n=true;else if(null===e||"object"!==typeof e)n=false;else if(o=t[0],n=!(o in e),!n)s=e[o],n=(r=u.getValueType(s)).setWillChange(s,t.slice(1),i);return n},set:function(e,t,i){var n,s,o,a,l,c,h=y.equals;if(0===t.length)l=i;else if(e===v)l=y.set({},t,i);else if(null!==e&&"object"===typeof e)if(a=t[0],n=e.hasOwnProperty(a)?e[a]:v,1===t.length)if(c=a in e&&h(n,i),c)l=e;else if(o=u.getValueType(n),s=o.set(n,[],i),h(n,s))l=e;else(l=r(e))[a]=s;else if(o=u.getValueType(n),s=o.set(n,t.slice(1),i),n===s)l=e;else l=y.set(e,[a],s);else l=e;return l},remove:function(e,t){var i,n,s,o,a,l,c,h=y.equals;if(s=0!==t.length,s)if(o=t[0],s=null!==e&&"object"===typeof e&&o in e,s)if(1===t.length)if(Array.isArray(e))if(a=e.slice(0),c=parseInt(o,10),c==o)a.splice(c,1);else delete a[o];else if(i=e[o],n=u.getValueType(i),l=n.remove(i,[]),n.isProxy)s=l.changed,a=e;else s=true,delete(a=r(e))[o];else if(i=e[o],n=u.getValueType(i),l=n.remove(i,t.slice(1)),s=l.changed,s)if(n.isProxy||h(l.value,i))a=e;else(a=r(e))[o]=l.value;return{value:s?a:e,changed:s}},toJSON:function(e,t){return t&&null!==e&&"object"===typeof e&&"function"===typeof e["toJSON"]?e.toJSON():e}},x=[y],C=e({},{$protected:{_options:{objectData:null},_isEmpty:true,_contextObject:{}},$constructor:function(){if(this._contextObject={},this._options.objectData){var e=this._options.objectData;if(!i(e))throw new Error(rk("Опция objectData должна быть простым объектом с ключами и значениями"));for(var t in e)if(e.hasOwnProperty(t)){var n=e[t],s=this._getValueType(n);this._contextObject[t]=this._createTypedValue(n,s),this._isEmpty=false}}},_getValueType:function(e){return u.getValueType(e)},getFieldType:function(e){var t=this._contextObject;return e in t?t[e].type:b},_getFieldValue:function(e){var t=this._contextObject;return e in t?t[e].value:v},isEmpty:function(){return this._isEmpty},_createTypedValue:function(e,t){return{value:e,type:t}},toObject:function(e){return Object.keys(this._contextObject).reduce(function(t,i){var n=this.getFieldType(i),s=this._getFieldValue(i);return t[i]=n.toJSON(s,e),t}.bind(this),{})},has:function(e){var t=this._getFieldDescr(e),i=t&&this.get(t.qname,t.keyPath);return!!(t&&i!==v)},set:function(e,t,i){var n,s,r=this._getFieldValue(e),o=this.getFieldType(e),a=this._contextObject,l=!(r===v&&void 0===i)?o.setWillChange(r,t,i):false;if(l)s=o.set(r,t,i),n=this._getValueType(s),a[e]=this._createTypedValue(s,n),this._isEmpty=false;return l},transaction:function(e){if(e.transaction)e.transaction()},commit:function(e){if(e.commit)e.commit()},_getFieldDescr:function(e,t,i){var s=e.split(_),r=s.map(function(e,t){return s.slice(0,s.length-t)}),o=this._contextObject,a=n(r,function(e){for(var i=e[0],n=1;n<e.length;n++)i+=_+e[n];var s=o.hasOwnProperty(i),r;if(s)r=o[i];return void 0!==r||t&&s&&void 0===r}),l,c,u;if(a)u={qname:l=a.join(_),keyPath:c=s.slice(a.length)};else if(i&&s.length>0)u={qname:s[0],keyPath:s.slice(1)};else u=null;return u},get:function(e,t){var i=this.getFieldType(e),n=this._getFieldValue(e);return i.get(n,t)},getRaw:function(e){var t=this._contextObject;return e in t?t[e].value:v},removeRaw:function(e){delete this._contextObject[e]},setRaw:function(e,t){this._contextObject[e]={value:t,type:this._getValueType(t)}},remove:function(e,t){var i=this.getFieldType(e),n=this._contextObject,s=i!==b,r;if(s)if(0===t.length)if(i.clear)r=i.clear(n[e].value),n[e].value=r.value,s=r.changed;else delete n[e];else r=i.remove(n[e].value,t),n[e].value=r.value,s=r.changed;return s}});function F(e){return function(){var t,i;if(!this.isDestroyed()){if(0===this._updateLockCnt)this._updatedEventsCnt=0;this._updateLockCnt++;try{i=e.apply(this,arguments)}finally{if(this._updateLockCnt--,0===this._updateLockCnt){if(t=this._updatedEventsCnt,this._updatedEventsCnt=0,Array.isArray(this._changedContexts)){var n=c(this._changedContexts);this._changedContexts=[],n.forEach(function(e){e._notify("onFieldsChanged")})}if(t>0)this._notify("onFieldsChanged")}}}return i}}return u=t.extend({$protected:{_options:{isGlobal:false,restriction:""},_restrictFlags:0,_previousContext:null,_context:null,_record:null,_parentContextDataBindHandler:null,_parentContextFieldUpdateHandler:null,_updateLockCnt:0,_updatedEventsCnt:0,_fieldSubscriptions:{}},$constructor:function(){if(!this._options._createdWithWrapper&&!this._options.isGlobal)l.resolve("ILogger").error("Core/Context","Для создания контекста нужно использовать метод Context.createContext(control[, options[, previousContext]]).");switch(this._context=new C,this._options.restriction){case"setget":this._restrictFlags=this._restrictFlags|f.GETSET;case"set":this._restrictFlags=this._restrictFlags|f.SET}if(this._parentContextDataBindHandler=F(function(){if(!this._hasGetRestrictions())this._updatedEventsCnt++,this._notify("onDataBind")}).bind(this),this._parentContextFieldsChangedHandler=F(function(){if(!this._hasGetRestrictions())this._updatedEventsCnt++}).bind(this),this._parentContextFieldUpdateHandler=function(e,t,i,n){if(!this._hasGetRestrictions())if(!this._getFieldDescr(t,h.GET,f.GET))this._notify("onFieldChange",t,i,n)}.bind(this),this._parentContextFieldRemovedHandler=function(e,t){if(!this._hasGetRestrictions())if(!this._getFieldDescr(t,h.GET,f.GET))this._notify("onFieldRemove",t)}.bind(this),false===this._options.isGlobal)this._previousContext=u.global;this._subscribeOnParentUpdates(),this._publish("onDataBind","onFieldChange","onFieldsChanged","onFieldRemove")},_subscribeOnParentUpdates:function(){var e=this._previousContext;if(e)e.subscribe("onDataBind",this._parentContextDataBindHandler),e.subscribe("onFieldsChanged",this._parentContextFieldsChangedHandler),e.subscribe("onFieldChange",this._parentContextFieldUpdateHandler),e.subscribe("onFieldRemove",this._parentContextFieldRemovedHandler)},_unsubscribeOnParentUpdates:function(){var e=this._previousContext;if(e)e.unsubscribe("onDataBind",this._parentContextDataBindHandler),e.unsubscribe("onFieldsChanged",this._parentContextFieldsChangedHandler),e.unsubscribe("onFieldChange",this._parentContextFieldUpdateHandler),e.unsubscribe("onFieldRemove",this._parentContextFieldRemovedHandler)},_unsubscribeFromFields:function(){for(var e in this._fieldSubscriptions)if(this._fieldSubscriptions.hasOwnProperty(e))this._setFieldSubscription(e,this._context.getRaw(e),v);this._fieldSubscriptions={}},getRestriction:function(){return this._options.restriction},setRestriction:function(e){switch(this._options.restriction=e,this._restrictFlags=this._restrictFlags&~f.GETSET,e){case"setget":this._restrictFlags=this._restrictFlags|f.GET;case"set":this._restrictFlags=this._restrictFlags|f.SET}},_hasGetRestrictions:function(){return this._hasRestrictions(f.GET)},_hasSetRestrictions:function(){return this._hasRestrictions(f.SET)},_hasRestrictions:function(e){return 0!==(this._restrictFlags&e)},setPrevious:F(function(e){if(this.isGlobal())throw new Error("Attempt to set a previous context to a global context");if(null!==e&&!e instanceof u)throw new Error('"previous" argument should be instance of Core/Context');if(e!==this._previousContext)if(this._unsubscribeOnParentUpdates(),this._previousContext=e,this._subscribeOnParentUpdates(),!this._hasGetRestrictions())this._updatedEventsCnt++;return this}),getPrevious:function(){return this._previousContext},_changeContextData:F(function(e,t){var i=u.RecordFieldProxy,n,s;if(t.apply(this),o.instanceOfModule(e,"Deprecated/Record"))this._record=e,this._record.each(function(e){n=new i(this._record,e),s=this._context.getRaw(e),this._setFieldSubscription(e,s,n),this._context.setRaw(e,n)}.bind(this));else for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];s=this._context.getRaw(r),this._setFieldSubscription(r,s,a),this._context.setRaw(r,a)}this._updatedEventsCnt++,this._notify("onDataBind")}),setContextData:function(e){this._unsubscribeFromFields(),this._changeContextData(e,function(){this._context=new C})},replaceRecord:function(e){if(this._record)this._record.each(function(e){this._setFieldSubscription(e,this._context.getRaw(e),null),this._context.removeRaw(e)}.bind(this));this._changeContextData(e,function(){})},isGlobal:function(){return this._options.isGlobal},isEmpty:function(){return this.isDestroyed()?true:this._context.isEmpty()},getRecord:function(){return this._record},_getValue:function(e,t,i,n){if(void 0!==t&&"function"!==typeof t)throw new Error(rk("Параметр func должен быть функцией, если он есть"));var s=f[i?"GET":"NONE"],r=this._getFieldDescr(e,h.GET,s,t),o;if(r)o=r.contextData.get(r.qname,r.keyPath);else o=v;return o===v&&!n?void 0:o},getValue:function(e,t){return e?this._getValue(e,t,false):void 0},getValueSelf:function(e){return this._getValue(e,void 0,true)},isFieldSameOrSubField:function(e,t){var i=this._getFieldDescr(e),n=this._getFieldDescr(t),r;if(r=i&&n&&i.context===n.context&&i.qname===n.qname,r)r=-1===s(n.keyPath,function(e,t){return i.keyPath[t]!==e});return r},_getFieldDescr:function(e,t,i,n){var s=this,r=null,o={},l=t===h.SET,c,u,d,_,p;o[h.GET]=f.GET,o[h.SET]=f.SET,o[h.REMOVE]=f.SET;while(!r&&s){if(c=s._restrictFlags|(i||0),u=0!==(c&f.UNDEFINEDS_AS_EXISTENT),s.hasEventHandlers("onFieldNameResolution"))if(p=""+(s._notify("onFieldNameResolution",e,l)||""),p.length>0)s=(r=s._context._getFieldDescr(p,u,l))?s:null;if(!r&&s){if(r=s._context._getFieldDescr(e,u),r&&n)r=!n(_=s._context.get(r.qname,r.keyPath))?r:null;if(!r)s=0===(d=c&o[t])?s.getPrevious():null}}if(a.checkAssertion(!!r===!!s),!r&&l)r=(s=this)._context._getFieldDescr(e,false,true);if(r)r.context=s,r.contextData=s._context;return r},_setFieldSubscription:function(e,t,i){var n=this._fieldSubscriptions,s,r;function o(){this._updatedEventsCnt++,this._notify("onFieldChange",e,this.getValue(e))}if(t!==i){if(e in n)if(s=n[e],delete n[e],s)s();if(r=u.getValueType(i),i&&i!==v&&r.subscribe)s=function(){if(0===this._updateLockCnt)F(o).call(this);else this.once("onFieldsChanged",o.bind(this))}.bind(this),n[e]=r.subscribe(i,s)}},getFieldOrigin:function(e,t){var i=h[t?"SET":"GET"],n=this._getFieldDescr(e,i);return n&&n.context},hasField:function(e){return this._getValue(e,void 0,true,true)!==v},hasFieldWithParents:function(e){return this._getValue(e,void 0,false,true)!==v},getFieldOrigin2:function(e){var t=this._getFieldDescr(e,h.GET,f.UNDEFINEDS_AS_EXISTENT);return t&&t.context},setValue:F(function(e,t,n,s){if(!e)throw new Error(rk("Нельзя писать значения в контекст по пустому полю")+' ""');var r=[];function o(e,t,i,n,s){var o=this._getFieldDescr(e,h.SET,f[i?"SET":"NONE"]);if(!o)l.resolve("ILogger").error("setValue",rk("Нельзя записывать значение в под-поле сложного поля контекста, если этого сложного поля в контексте не существует. Путь к под-полю:")+" "+e);else{var a=o.context,c=a._context.getFieldType(o.qname),u=a._context.getRaw(o.qname),d,_;if(-1===r.indexOf(c))r.push(c),a._context.transaction(c);if(d=a._context.set(o.qname,o.keyPath,t),_=a._context.getRaw(o.qname),s)r.forEach(function(e){a._context.commit(e)}),r.length=0;if(d)a._setFieldSubscription(o.qname,u,_),a._updatedEventsCnt++,a._notify("onFieldChange",e,t,n),this._changedContexts=this._changedContexts||[],this._changedContexts.push(a)}}if("object"==typeof e){if(!i(e))throw new Error("setValue supports simple JSON objects only");var a=t,c=n;Object.keys(e).forEach(function(t,i,n){o.call(this,t,e[t],a,c,i===n.length-1)},this)}else o.call(this,e,t,n,s,true)}),runInBatchUpdate:F(function(e){return e.call(this)}),removeValue:F(function(e,t){var i=t?f.SET:f.NONE,n=this._getFieldDescr(e,h.REMOVE,i),s,r,o,a;if(n)o=n.context,r=(a=F(function(){var t=n.contextData,i=t.getRaw(n.qname),r=n.contextData.remove(n.qname,n.keyPath);if(r)s=t.getRaw(n.qname),n.context._setFieldSubscription(n.qname,i,s),this._updatedEventsCnt++,this._notify("onFieldRemove",e);return r}).bind(o))();else r=false;return r}),setValueSelf:function(e,t,i){if("object"==typeof e)this.setValue(e,true,i);else this.setValue(e,t,true,i)},insert:function(e,t){this._multiOperation(e,t,"insert")},remove:function(e,t){this._multiOperation(e,t,"remove")},_multiOperation:F(function(e,t,n){if(null!==t&&void 0!==t&&"string"!==typeof t)throw new Error(rk("Параметр link должен быть строкой - именем связи"));var s=t?t+p:"";if(o.instanceOfModule(e,"Deprecated/Record"))e=e.toObject();if("object"===typeof e){if(!i(e)&&!Array.isArray(e))throw new Error('"values" argument error: _multiOperation supports simple JSON objects only');for(var r in e)if(e.hasOwnProperty(r)){if("remove"==n)this.removeValue(s+r,true);if("insert"==n)this.setValueSelf(s+r,e[r])}}else if(false===e||null===e||void 0===e){var a=this.getRecord(),l=function(e){if(0===e.indexOf(t))this.removeValue(e,true)}.bind(this);if(a)a.getColumns().forEach(function(e){l(e)});else{var c=this.toObject(false);for(var u in c)if(c.hasOwnProperty(u))l(u)}}this._notify("onDataBind")}),destroy:function(){this._record=null,this._unsubscribeOnParentUpdates(),this._unsubscribeFromFields(),this._context=new C,u.superclass.destroy.apply(this,arguments)},createDependent:function(){var e=new u;return e.setPrevious(this),e},toObject:function(e){var t=this._context.toObject(e);if(e){var i=this.getPrevious();if(i){var n=i.toObject(true);for(var s in n)if(n.hasOwnProperty(s)&&!(s in t))t[s]=n[s]}}return t}}),u.createContext=function(e,t,i){var n;if(!e||!o.instanceOfMixin(e,"Lib/Control/Control.compatible")&&!o.instanceOfModule(e,"Core/Deferred"))l.resolve("ILogger").info("Для создания контекста необходимо передать контрол, которому он будет принадлежать, или Deffered, который выстрелит, когда контекст перестанет быть нужным.");if(t=t||{},i&&!(i instanceof u))throw new Error("Родительский контекст должен иметь тип Core/Context");if(t._createdWithWrapper=true,n=new u(t),i)n.setPrevious(i);if(o.instanceOfMixin(e,"Lib/Control/Control.compatible"))e.addOwnedContext(n);else if(o.instanceOfModule(e,"Core/Deferred"))e.addCallback(function(){n.destroy()});return n},u.registerFieldType=function(e){x.unshift(e)},u.getValueType=function(e){return n(x,function(t){return t.is(e)})},u.NonExistentValue=v,u.SimpleFieldType=y,u.RecordFieldProxy=null,u.STRUCTURE_SEPARATOR=_,u.global=new u({isGlobal:true}),u});
//# sourceMappingURL=Context.js.map
define("Core/ContextBinder",["Core/Context","Core/Abstract","Core/helpers/Object/isPlainObject","Core/helpers/Object/isEmpty","Core/helpers/Array/findIndex","Core/IoC","Core/core-merge","Core/core-clone","Core/helpers/Function/shallowClone","Core/core-instance","Core/core-debug","Core/ConsoleLogger"],function(e,n,t,i,o,r,s,l,a,u,f){"use strict";var c=e.STRUCTURE_SEPARATOR,d=e.NonExistentValue,p={},h=false,m="trace",g="log",N=[],b=r.resolve("ILogger"),C=s,y=l,v=a,x="fromProperty",P="fromContext",V=[],E=function(){return this||(0,eval)("this")}()["console"],B=E&&E.log?Function.prototype.bind.call(E.log,E):function(){},_=E&&E.trace?Function.prototype.bind.call(E.trace,E):B;function D(e,n,t,i,o,r){N.push({control:e,binder:n,context:t,synchronize:i,getSynchData:o,getConstructorOptions:r})}function O(e,n,t){N=N.filter(function(i){return i.control!==e&&i.binder!==n&&i.context!==t})}function S(e){return N.filter(e).map(function(e){return{bindings:l(e.binder._bindings),context:e.context,synchronize:e.synchronize,getSynchData:e.getSynchData,getConstructorOptions:e.getConstructorOptions}})}function w(e){if(h)b.error("Core/ContextBinder","string"===typeof e?e:e())}function A(e,n,t,i,o){if(h){if(!e.comment)e.comment={};var r="function"===typeof t?t():t,s=e.comment[n],l;if(s)if(Array.isArray(s))s.push(r);else e.comment[n]=[s,r];else e.comment[n]=r;if(o)w(l="Проблема в синхронизации контрола "+i.getName()+"/"+i.getId()+": "+r)}}var F=n.extend({$protected:{_options:{bindings:null},_bindings:[{fieldName:"",propName:"",propPath:[],oneWay:false,lastValues:{fromContext:p,fromProperty:p}}],_isBound:false},$constructor:function(e){this._bindings=[];function n(e){var n;if("index"in e)n=""+e.index;else n=e.propName||"";return n}function i(e,o){if(t(o))if(o.fieldName&&""!==n(o))this.defineBinding(e+n(o),o.fieldName,o.oneWay,o.direction,o.nonExistentValue,o.bindNonExistent);else if(o.subBindings&&""!==n(o)){for(var r in o.subBindings)if(o.subBindings.hasOwnProperty(r))i.call(this,e+n(o)+c,o.subBindings[r])}else throw new Error("плохой формат элемента binding");else if(Array.isArray(o))this.defineBinding.apply(this,o);else throw new Error("плохой формат элемента binding")}var o=this._options.bindings;if(o&&o.length){var r=this;o.forEach(function(e){if(!e.propName||-1===e.propName.indexOf("__dirtyCheckingVars_"))i.call(r,"",e)})}},_reduceBindings:function(e,n,t){return this._bindings.filter(function(n){return!n.oneWay||n.oneWay&&n.direction===e}).reduce(function(e,t,i,o){return e=n.call(this,e,t,i===o.length-1),e},t,this)},getConstructorOptions:function(e,n,i){var o=function(n,i){var o=e.hasFieldWithParents(i.fieldName),r,s,l,a,u,f;if(o)r=e.getValue(i.fieldName);else if(o=i.bindNonExistent,o)r=i.nonExistentValue;else w(function(){return"Невозможно прочитать из контекста опцию (начальное значение свойства) для конструктора: "+i.propName+", поскольку в контексте нет соответствующего ей поля "+i.fieldName+", и у привязки не установлены параметры bindNonExistent или bindNonExistentType"});if(o)l=(s=[i.propName].concat(i.propPath)).slice(0,s.length-1),a=s[s.length-1],u=parseInt(a,10),(f=l.reduce(function(e,n,i){var o=s[i+1],r=parseInt(o,10),l;if(!isNaN(r)){if(l=n in e&&Array.isArray(e[n]),!l)e[n]=[]}else if(l=n in e&&t(e[n]),!l)e[n]={};return e[n]},n))[isNaN(u)?a:u]=r;return n}.bind(this),r=this._reduceBindings(P,o,{}),s;if(n&&i){if(s=i.name,s&&i.loadValueFromContextToConstructorOptions&&u.classOfMixin(n,"Lib/Mixins/DataBoundMixin"))r=o(r,{fieldName:s,propName:"value",propPath:[],oneWay:true,direction:P,bindNonExistent:false});r=C(i,r)}return r},bindControl:function(n,t,r){function s(e,i){function r(e){return o(V,function(i){return i.control===n&&i.context===t&&i.direction===e})}function s(){var n=r(e);if(-1!==n)V.splice(n,1)}if(!n.isDestroyed()&&!t.isDestroyed())if(-1===r(e)){V.push({control:n,context:t,direction:e});try{i.call(this)}finally{s()}}}function l(e,i){var o,r,s;if(h===m||h===g)o=n.getContainer(),(r=h===m?_:B)(s=e===P?"Синхронизация контрола из контекста ":"Синхронизация контрола в контекст ",o&&o[0],i.comment,n,t,i)}function a(){var e=c.call(this),t=e.value;if(l(P,e),e.lastValues.forEach(function(e){e.binding.lastValues[P]=e.value}),!i(t))n.setProperties(t)}function u(){var e=p.call(this);l(x,e),e.lastValues.forEach(function(e){e.binding.lastValues[x]=e.value}),t.runInBatchUpdate(function(){if(e.toRemove.forEach(function(e){t.removeValue(e)}),!i(e.toSet))t.setValue(e.toSet)})}function c(){var i=function(e){if(-1===o.indexOf(e)){if(e.transaction)e.transaction();o.push(e)}},o=[],r,s,l;if(!t.isDestroyed()&&!n.isDestroyed())s=this._reduceBindings(P,function(e,t){if(t.propName&&!(t.propName in e))if(t.propName.indexOf("__dirtyCheckingVars_")>-1)delete t.propName;else e[t.propName]=n.getProperty(t.propName);return e},{}),l=v(s),r=this._reduceBindings(P,function(r,s,a){var u,c,p,h,m,g,N,b,C,y,v,x=r.value,V=s.lastValues[P];if(b=t.hasFieldWithParents(s.fieldName),b)u=t.getValue(s.fieldName);else if(b=s.bindNonExistent,b)u=s.nonExistentValue;else u=d;if(y=s.propPath,c=s.propName,p=(c in x?x:l)[c],h=e.getValueType(p),i(h),r.lastValues.push({binding:s,value:u,lastValue:V}),V!==u)if(b)if(m=h.setWillChange(p,y,u),m)N=h.set(p,y,u),x[c]=N,A(r,c,"Свойство "+s.fullPropName+" синхронизировано с полем контекста "+s.fieldName);else if(y.length>0)if(C=h.get(p,y),v=C===u||h.equals&&h.equals(C,u),!v)if(f.checkAssertion(C===d),null===p||void 0===p)if(n.initializeProperty(c),p=n.getProperty(c),null!==p&&void 0!==p)if(h=e.getValueType(p),i(h),m=h.setWillChange(p,y,u),m)N=h.set(p,y,u),x[c]=N,A(r,c,"Свойство "+s.fullPropName+" успешно инициализировано из значения null или undefined, и синхронизировано с полем контекста "+s.fieldName);else A(r,c,"Свойство "+s.fullPropName+" не синхронизируется, потому что не отличается от значения поля контекста "+s.fieldName);else A(r,c,"Свойство "+s.fullPropName+" не синхронизируется, поскольку его инициализация из null/undefined не прошла, "+"оно всё так же равно null или undefined, и в него невозможна запись по пути "+ +s.propPathStr,n,true);else A(r,c,"Свойство "+s.fullPropName+" не синхронизируется, потому что в его текущее значение невозможна запись по пути "+s.propPathStr,n,true);else A(r,c,"Свойство "+s.fullPropName+" не синхронизируется, потому что не отличается от значения поля контекста "+s.fieldName);else A(r,c,"Свойство "+s.fullPropName+" не синхронизируется, потому что не отличается от значения поля контекста "+s.fieldName);else if(y.length>0)if(g=h.remove(p,y),g.changed)x[c]=g.value,A(r,c,"В свойстве "+s.propName+" значение по пути "+s.propPathStr+" удаляется, потому что в контексте нет соответствующего ему поля "+s.fieldName);else A(r,c,"В свойстве "+s.propName+" значение по пути "+s.propPathStr+" нужно удалить, поскольку в контексте нет соответствующего ему поля "+s.fieldName+", но удаление невозможно, поскольку значения в свойстве по этому пути нет, или типом значения не поддерживается удаление",n,true);else A(r,c,"Свойство "+s.propName+" нужно удалить, поскольку в контексте нет соответствующего ему поля "+s.fieldName+", но удаление невозможно, поскольку контрол не умеет удалять свойства (только под-свойства - значения внутри свойств)",n,true);else A(r,c,"В свойстве "+s.propName+" значение по пути "+s.propPathStr+" не синхронизируется, потому что при прошлой синхронизации соотв. ему поле контекста "+s.fieldName+" было таким же, как и в эту синхронизацию",n,true);if(a)o.forEach(function(e){if(e.commit)e.commit()}),o.length=0;return r},{value:{},comment:{},lastValues:[]});else r={value:{},comment:{},lastValues:[]};return r}function p(){if(!t.isDestroyed()&&!n.isDestroyed()){var i=function(e){try{return n.getProperty(e)}catch(e){b.error("Control",e.message)}};return this._reduceBindings(x,function(n,t){var o=i(t.propName),r=e.getValueType(o).get(o,t.propPath),s=t.lastValues[x];if(n.lastValues.push({binding:t,value:r,lastValue:s}),s!==r)if(r!==d&&r!==t.nonExistentValue)n.toSet[t.fieldName]=r,A(n,t.fieldName,"Поле контекста "+t.fieldName+" записывается, потому что соответствующее ему свойство "+t.fullPropName+" существует в свойствах контрола, и не равно параметру nonExistentValue");else if(n.toRemove.push(t.fieldName),r===d)A(n,t.fieldName,"Поле контекста "+t.fieldName+" удаляется, потому что соответствующее ему св-во контрола "+t.fullPropName+" не существует в свойствах контрола");else A(n,t.fieldName,"Поле контекста "+t.fieldName+" удаляется, потому что соответствующее ему св-во контрола "+t.fullPropName+" равно параметру nonExistentValue");else A(n,t.fieldName,"Поле контекста "+t.fieldName+" не меняется (не записывается и не удаляется), потому что при прошлой синхронизации значение соотв. (под)свойства контрола было таким же");return n},{toSet:{},toRemove:[],comment:{},lastValues:[]})}}function N(e){var n=e===x?u:a;s.call(y,e,n)}function C(e){if(e===x)return p.call(y);else if(e===P)return c.call(y)}var y=this,E,S,w;if(this._isBound)throw new Error("На этом экземпляре класса Core/ContextBinder bindControl уже был вызван (из метода createBoundControl, или bindControl). Второй раз bindControl вызывать нельзя.");if(this._isBound=true,this._bindings.length>0)if(E=s.bind(this,P,a),S=s.bind(this,x,u),w=function(){t.unsubscribe("onFieldsChanged",E),n.unsubscribe("onPropertiesChanged",S),y.unsubscribe("onDestroy",w),n.unsubscribe("onDestroy",w),t.unsubscribe("onDestroy",w),O(n,y,t)},t.subscribe("onFieldsChanged",E),n.subscribe("onPropertiesChanged",S),this.subscribe("onDestroy",w),n.subscribe("onDestroy",w),t.subscribe("onDestroy",w),D(n,this,t,N,C.bind(this),this.getConstructorOptions.bind(this,t)),"syncContext"===r)u.call(this);else if("syncControl"===r)a.call(this)},defineBinding:function(e,n,t,i,o,r){var s=e.split(c),l=s[0],a=s.slice(1),u={fieldName:n,propName:l,propPath:a,fullPropName:e,propPathStr:a.join(c),oneWay:t,direction:i||P,nonExistentValue:o,bindNonExistent:r,lastValues:{}};u.lastValues[P]=p,u.lastValues[x]=p,this._bindings.push(u)}});return F.createBoundControl=function(e,n,t,i){var o=new F({bindings:i}),r=new e(o.getConstructorOptions(t,e,y(n)));return o.bindControl(r,t),r},F.getBindingsForControl=function(e){return S(function(n){return n.control===e})},F.getBindingsForContext=function(e){return S(function(n){return n.context===e})},F.initBinderForControlConfig=function(e){return new F({bindings:e.bindings||[]})},F.setDebugMode=function(e){h=e},F});
//# sourceMappingURL=ContextBinder.js.map
define("Core/markup/ParserUtilities",["Core/htmlparser2","Core/helpers/generate-helpers","Core/helpers/markup-helpers","Core/core-extend-initializer","Core/RightsManager","Core/ContextBinder","Core/IoC","Core/helpers/Function/shallowClone","Core/Abstract","Core/constants"],function(e,t,n,i,r,o,s,a,l,u){"use strict";var d=/&quot;/g,c=/^(\[[\s\S]*?\])$/i,f=/^WS-EXPERT([\s\S]+?)WS-EXPERT$/,h=/\{\{([\s\S]*?(}?)+)}}/gi,p=/<!-#\/EVAL#(\d+)#->/gi,m=function(e){if("&quot;"===e)return'"';else return""},g=/"/g,_=/\/>$/,b={},v=s.resolve("ILogger"),y=function(){return this||(0,eval)("this")}(),C=0;function T(e,t){return e.replace(h,function(e){return t.push(e),"<!-#/EVAL#"+(t.length-1)+"#->"})}function w(e,t){return t.length?e.replace(p,function(e,n){return t[+n]}):e}var N=function(e){var t=this;if(this.startTag=e.startTag||"",this.closeTag=e.closeTag||"",this.nodeType=e.nodeType,this.nodeName=e.nodeName,this.attributes=e.attributes||{},this.childNodes=e.childNodes,this.parentNode=e.parentNode,this.text=e.text||e.nodeValue,this.sequence=e.sequence||[],this._junk=e._junk||[],u.isNodePlatform)Object.defineProperty(this,"firstChild",{get:function(){if(t.childNodes)for(var e=0;e<t.childNodes.length;e++)if(8!==t.childNodes[e].nodeType&&10!==t.childNodes[e].nodeType)return t.childNodes[e];return null}}),Object.defineProperty(this,"nextSibling",{get:function(){for(var e=t.parentNode.childNodes||[],n=e.indexOf(t)+1;n<e.length;n++)if(8!==e[n].nodeType&&10!==e[n].nodeType)return e[n];return null}}),Object.defineProperty(this,"nodeValue",{get:function(){return t.text},set:function(e){t.text=e}})};N.prototype.getAttribute=function(e){var t=this.attributes[e];return t?t.value:null},N.prototype.setAttribute=function(e,t,n){var i=this.attributes[e];if(t=""+t,i)i.value=t,i.quote=void 0===n?i.quote:n;else this.attributes[e]={value:t,quote:void 0===n?'"':n},this.sequence.push(e)},N.prototype.innerHTML=function(e){var t="",n;if(void 0!==e){if("string"!==typeof e)throw new Error("Invalid parameter format");if(1!==this.nodeType)throw new Error("Only element node can change the innerHTML property");return t=e,n=b.parse(t),this.childNodes=n.childNodes,t}if(3===this.nodeType||8===this.nodeType)t+=this.text;else if(10===this.nodeType)t+="<"+this.text+">";else for(var i=0,r=this.childNodes.length;i<r;i++)t+=3===(n=this.childNodes[i]).nodeType?n.text:n.outerHTML();return t},N.prototype.outerHTML=function(){var e="",t="";if(1==this.nodeType){t=this.closeTag?this.closeTag:"",e+="<"+this.nodeName;for(var n=0;n<this.sequence.length;n++){var i=this.sequence[n];if("{"===i[0])e+=" "+i;else{var r=this.attributes[i];if(r){var o=r.value;if(""!==o||""!==r.quote){var s=[];o=w(o=(o=T(o,s))?(o+"").replace(g,"&quot;"):"",s),e+=" "+i+"="+r.quote+o+r.quote}else e+=" "+i}}}e+=-1!=this.startTag.indexOf("/>")?"/>":">"}else if(8===this.nodeType)e="\x3c!--",t="--\x3e";return e+this.innerHTML()+t},N.prototype.getElementsByTagName=function(e){var t=[];if(3!==this.nodeType&&8!==this.nodeType&&10!==this.nodeType)for(var n=0,i=this.childNodes.length;n<i;n++){if(this.childNodes[n].nodeName==e)t.push(this.childNodes[n]);t=t.concat(this.childNodes[n].getElementsByTagName(e))}return t},N.prototype.hasAttribute=function(e){return!!this.attributes[e]};function k(t){return new e(t,{recognizeSelfClosing:true,lowerCaseAttributeNames:false,lowerCaseTags:false})}function x(e){return c.test(e)||f.test(e)}var S=function(e,t){if(!e)v.log("ParserUtilities",t)},q=l.extend({$constructor:function(e){if(this.onreset(),this._markup=e.markup,this._buildHtml=!!e.buildHtml,this._tag=e.tag||"component",this._rootNode=new N({childNodes:[],parentNode:null}),this._replacer=e.replacer,"function"===typeof e.firstTagHandler)this._firstTagHandler=e.firstTagHandler;if("function"===typeof e.callback)this._callback=e.callback},_tagStackLast:function(){var e=this._tagStack.length;return e?this._tagStack[e-1]:null},setParser:function(e){this._parser=e},onparserinit:function(e){e._tokenizer.ignoreAttrib(true)},onreset:function(){if(this._buildHtml)this.html="";this._curPos=0,this._isFirstTag=true,this._tagStack=[],this._componentCount=0,this._componentNode=null},onend:function(){if(this._buildHtml)this.html+=this._markup.slice(this._curPos);this.handleCallback(null)},onopentagname:function(){if(this._isFirstTag)this._parser._tokenizer.ignoreAttrib(false)},onopentag:function(e,t,n,i){var r="/"===this._markup[this._parser.endIndex-1],o=this._parser.endIndex,s=r?o-1:o,a=this._parser.startIndex;if(S(this._componentCount>=0,"ParserUtilities: _componentCount < 0"),0===this._componentCount){if(e===this._tag)this._componentNode=this._foundComponentHandler({name:e,raw:this._markup.slice(a,s),rawStart:a,attribs:t,quotes:n,attribSequence:i,selfclosing:r}),this._componentCount++,this._tagStack.push(this._componentNode);else if(this._isFirstTag&&this._firstTagHandler){if(this._firstTagHandler)this._foundFirstTag({name:e,rawStart:a+1,rawEnd:this._parser.endIndex,attribs:t,quotes:n,attribSequence:i,selfclosing:r});this._isFirstTag=false,this._parser._tokenizer.ignoreAttrib(false)}}else{var l=this._foundComponentInnerHandler({name:e,raw:this._markup.slice(a,this._parser.endIndex),rawStart:a,attribs:t,quotes:n,attribSequence:i,selfclosing:r});if(l.nodeName===this._tag)this._componentCount++;this._tagStack.push(l)}},onclosetag:function(e,t){function n(e){return""===e||null===e}function i(e){return e&&e.startTag&&_.test(e.startTag)}var r=this._markup,o=this._parser.endIndex,s,a,l;if(this._componentCount>0)if(l=this._tagStack.pop(),l)if(t||n(e)||i(l))l.closeTag="";else l.closeTag="</"+e+">";if(l&&l.nodeName===this._tag)if(this._componentCount--,S(this._componentCount>=0,"ParserUtilities: _componentCount < 0"),0===this._componentCount){if(a=r.slice(this._componentNode.rawStart,H(r,o)+1),s=this._replacer(this._componentNode,a),this._buildHtml)this.html+=s;this._curPos=o+1}},ontext:function(e){if(this._componentCount>0){var t=this._tagStackLast();t.childNodes.push(new N({nodeType:3,text:e,parentNode:t}))}},onprocessinginstruction:function(e,t){if(this._componentCount>0){var n=this._tagStackLast();n.childNodes.push(new N({nodeType:10,text:t,parentNode:n}))}},oncomment:function(e){if(x(e)&&this._componentCount>0){var t=this._tagStackLast();t.childNodes.push(new N({nodeType:8,text:e,parentNode:t}))}},onerror:function(e){this.handleCallback(e)},handleCallback:function(e){if(e)throw e;else if("function"===typeof this._callback)this._callback(this.html)},_createElement:function(e,t){var n,i={};for(var r in e.attribs)if(e.attribs.hasOwnProperty(r)){var o=e.attribs[r];i[r]={value:(o||"").replace(d,m),quote:e.quotes&&void 0!==e.quotes[r]?e.quotes[r]:'"'}}return n=new N({nodeType:1,nodeName:e.name,startTag:N._forTest?"":e.raw+(e.selfclosing?"/>":">"),closeTag:N._forTest?"":e.selfclosing?"":"</"+e.name+">",attributes:i,sequence:N._forTest?[]:e.attribSequence,childNodes:[],parentNode:t}),n.rawStart=e.rawStart,t.childNodes.push(n),n},_foundComponentHandler:function(e){if(this._buildHtml)this.html+=this._markup.slice(this._curPos,e.rawStart);return this._createElement(e,this._rootNode)},_foundFirstTag:function(e){if(this._buildHtml)this.html+=this._markup.slice(0,e.rawStart-1)+this._firstTagHandler(e);this._curPos=e.rawEnd+1},_foundComponentInnerHandler:function(e){var t=this._tagStackLast();return this._createElement(e,t)}});function H(e,t){var n=t,i=e.length,r=t;while(">"!==e[n]&&n!==i)n++;return n===i?r:n}function P(e,t){var n=null,i=k({onopentag:function(t,r,o,s){i.pause(),n={name:t,attribs:r,quotes:o,attribSequence:s,raw:e.slice(i.startIndex+1,H(e,i.endIndex)),rawStart:i.startIndex+1,selfclosing:"/"===e[i.endIndex-1]}}});return i.end(e),n?t(n):e}var O=function(){var e=/\s+/;function t(t){var n={},i,r,o;if(t)for(i=0,r=(o=t.split(e)).length;i!==r;i++)if(o[i].trim())n[o[i]]=true;return n}return function(e,n,i,r){var o,s,l,u,d,c;if(void 0!==e.enable)e.enabled=!!e.enable;if(void 0!==e.hidden)e.visible=!e.hidden;if(u=r.attribs?a(r.attribs):{},n)d=n();if(d)for(var f in d)if(d.hasOwnProperty(f)){var h=d[f];if("class"!==f)u[f]=h}if(e.name)if(u.sbisname=""+e.name,!u.name)u.name=""+e.name;if(!u.id&&e.hasOwnProperty("id"))u.id=""+e.id;if(u.tabindex=e.enabled?"0":"-1",u.hidefocus="true",u.hasmarkup="true",u.wasbuildmarkup="true",o=t((u["class"]?u["class"]+" ":"")+e["className"]+" "+e["cssClassName"]+" "+(d&&d["class"]?d["class"]:"")),o["ws-control-inactive"]=true,o["ws-component"]=true,e.visible)delete o["ws-hidden"];else o["ws-hidden"]=true;return delete o[e.enabled?"ws-disabled":"ws-enabled"],o[e.enabled?"ws-enabled":"ws-disabled"]=true,u["class"]=Object.keys(o).join(" "),s=Object.keys(u).reduce(function(e,t){var n=u[t];return e+t+'="'+("config"===t?n:"string"===typeof n?n.replace(g,"&quot;"):n)+'" '},""),l=r.name+" "+s+(r.selfclosing?"/":""),i(r,l)}}();function I(e){var t="maintag",n="<"+t+">"+e+"</"+t+">",i=new q({markup:n,replacer:function(){},buildHtml:false,tag:t}),r=k(i);i.setParser(r),r.parseComplete(n);var o=i._componentNode;return o.closeTag="",o.nodeName=void 0,o.nodeType=9,o.parentNode=null,o.startTag="",o.text=void 0,o}function E(e,r,s,a,l,u,d,c){var f="";if(!l)l={};else if("string"===typeof l)l={id:l};if(e){var h,p=l.parentId||l.id,m=r,_=e.prototype,b=_._modifyOptions&&_._modifyOptions.bind(_),v=_._buildMarkup&&_._buildMarkup.bind(_),y,C,T,w,N,k=i.call(e),x=k._options||{},S="buildMarkupWithContext"in m?m.buildMarkupWithContext:x.buildMarkupWithContext,q;if(s&&S)w=o.initBinderForControlConfig(m),m=w.getConstructorOptions(s,e,m);if(_._template)h=i.getInstanceOptionsByDefaults(e,m,{_options:k});else h=i.getInstanceOptionsByDefaults(e,m,k);if(b)if(h=b(h,m,d),!h)throw q=_._moduleName||"???",new Error("Метод _modifyOptions модуля '"+q+"' выдал null или undefined! Проверьте результат, возвращаемый методом _modifyOptions. Встаньте на точку этого исключения, и ");if(!h.id)if("undefined"!==typeof process&&u)h.id=""+u;else h.id=""+t.randomId();if(C=function(e){var t={config:e||n.encodeCfgAttr(m)};if(p)t["data-pid"]=""+p;for(var i in d)if(d.hasOwnProperty(i)){var r=d[i];if("data-pid"!==i&&"config"!==i)t[i]=r}return t},l&&!("enabled"in m)&&"enabled"in l&&!l.enabled&&(h.allowChangeEnable||void 0===h.allowChangeEnable))h.enabled=l.enabled,h.enable=l.enabled;if(_._template){var w;if(h.container=c,s)h.linkedContext=s,w=o.initBinderForControlConfig(h);var H=new e(h),P={};if(window)P[h.__$config]=H;else P[h.__$config]=h;if(n.mergeConfigStorage(P),s)w.bindControl(H,s,"syncControl");f=H.render()}else if("function"===typeof _._dotTplFn)f=v(_._dotTplFn,h,null,C,h.buildMarkupWithContext?s:null);else{var O=true,I;if(d&&d.config)if(I=n.getConfigStorage()[d.config],I)O=false;if(y=O?C():C(d.config),y.id=""+h.id,false===m.visible)y["class"]+=" ws-hidden";f="<component "+(T=Object.keys(y).reduce(function(e,t){var n=y[t];return e+t+'="'+("config"===t?n:n.replace(g,"&quot;"))+'" '},""))+"></component>"}if(_._modifyOptionsAfter)if(_._modifyOptionsAfter(m),h&&h.__$config){var E={};E[h.__$config]=m,n.mergeConfigStorage(E)}}return f}function A(e,t,i,r,o){var s="",a="",l=null;if("string"===typeof e)for(var u=0,d=(e=I(e)).childNodes.length;u<d;u++)if(1==e.childNodes[u].nodeType){e=e.childNodes[u];break}try{if(s=e.getAttribute("data-component"),"undefined"!==typeof window)l=y.requirejs.defined("js!"+s)?y.requirejs("js!"+s):y.requirejs(s);else l=y.requirejs("js!"+s)}catch(t){var c=e.getAttribute("data-optional");if(c&&"false"!==c)return"";else throw t.message="Не удалось определить тип компонента. Тип: \n"+s+"\n"+t.message,t}if(l){var f=n.parseMarkup(e),h={};for(var p in e.attributes)if(e.attributes.hasOwnProperty(p)){var m=e.attributes[p];h[p]=m.value}if(h.hasOwnProperty("data-component")&&l&&l.prototype._moduleName)h["data-component"]=l.prototype._moduleName;a=E(l,f,o,void 0,t,r,h,e)}else if("undefined"===typeof window)a=e.outerHTML();return a}function M(e){return-1!==e.indexOf("<component")}function j(e,t,n){if(-1!==e.indexOf("data-component"))return{hasComponents:true,markup:L(e,t,n)};else return{hasComponents:false,markup:e}}function L(e,t,n){var i=r.rightsNeeded(),o=new q({markup:e,buildHtml:true,tag:"component",replacer:function(e){if(!e)return;if(i&&r.hasDataAccess(e))e=r.applyRights(e,b);if(!e)return"";return A(e,t,void 0,void 0,n)}}),s=k(o);return o.setParser(s),s.parseComplete(e),o.html}function F(e,t,n){var i=new q({markup:t,buildHtml:true,tag:e,replacer:n}),r=k(i);return i.setParser(r),r.parseComplete(t),i.html}function $(e,t,n){var i=new q({markup:t,buildHtml:false,tag:e,replacer:n}),r=k(i);i.setParser(r),r.parseComplete(t)}function B(e,i,o,s,a,l){var u,d={config:t.randomId("cfg-"),hasmarkup:"true"},c;if(u=e.apply(n.getVarStorage(),[i,d,a]),M(u)){var f=1,h=r.rightsNeeded(),p=new q({markup:u,buildHtml:true,tag:"component",replacer:function(e){if(!e)return;if(h&&r.hasDataAccess(e))e=r.applyRights(e,b);if(!e)return"";return A(e,i,null,i&&i.sequenceId,a)},firstTagHandler:l?null:O.bind(void 0,i,s,function(e,t){return"<"+t+">"})}),m=k(p);p.setParser(m),m.parseComplete(u),c=p.html}else if(l)c=u;else c=P(u,O.bind(void 0,i,s,function(e,t){return u.substr(0,e.rawStart)+t+u.substr(e.rawStart+e.raw.length)}));return c}return b={parse:I,forEachTag:$,mapTag:F,buildMarkup:B,prepareMarkupForNode:A,buildMarkupForClass:E,buildInnerComponents:L,buildInnerComponentsExtended:j,Node:N},b});
//# sourceMappingURL=ParserUtilities.js.map
define("Core/Sanitize",["Core/markup/ParserUtilities","Core/helpers/Object/find","Core/core-merge","Core/core-clone","Core/helpers/String/escapeHtml"],function(e,t,r,u,i){"use strict";var a={validNodes:{html:true,head:true,body:true,code:true,p:true,div:true,span:true,img:true,br:true,a:true,pre:true,label:true,b:true,strong:true,i:true,em:true,u:true,s:true,strike:true,q:true,blockquote:true,font:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,dd:true,dir:true,dl:true,dt:true,li:true,menu:true,ol:true,ul:true,table:true,thead:true,tbody:true,caption:true,col:true,colgroup:true,td:true,tfoot:true,th:true,tr:true,input:true,textarea:true,iframe:{src:function(e,r){if(!t(["//www.youtube.com/embed/"],function(t){return e.attributes[r].value.indexOf(t)>=0}))delete e.attributes[r]},allowfullscreen:true}},validAttributes:{style:true,src:true,height:true,width:true,colspan:true,rowspan:true,class:true,id:true,tabindex:true,title:true,href:true,target:true,rel:true,alt:true,hasmarkup:true,config:true,name:true},fullEscapeNodes:{script:true,style:true},checkDataAttribute:true,escapeInvalidTags:true},s=function e(t){return/^data-([\w-])*$/gi.test(t)},o=/javascript:/gim;function l(e,t){var r;for(var u in e.attributes)if(e.attributes.hasOwnProperty(u)){var i=e.attributes[u];if(r=t.validAttributes[u]||(t.checkDataAttribute?s(u):false),"function"!==typeof r)if(r)while(o.test(i.value))i.value=i.value.replace(o,"");else delete e.attributes[u];else r(e,u)}}function n(t,a){if(t.childNodes){var s=t.childNodes.length;while(s--){var o=t.childNodes[s],d=o.nodeType,c=o.nodeName,f=a.validNodes[(c||"").toLowerCase()];if("object"!==typeof f)if(1!==d||f){if("component"!==c)n(o,a)}else if(a.escapeInvalidTags)if(a.fullEscapeNodes[c]){var h=i(o.outerHTML());t.childNodes[s]=new e.Node({nodeType:3,text:h})}else{var p=o.childNodes;if(o.startTag)p.unshift(new e.Node({nodeType:3,text:i(o.startTag)}));if(o.closeTag)p.push(new e.Node({nodeType:3,text:i(o.closeTag)}));t.childNodes.splice.apply(t.childNodes,[s,1].concat(p)),s+=p.length}else t.childNodes.splice(s,1);else{var b=r(u(a),{validAttributes:f});n(t.childNodes[s],b)}}}l(t,a)}return function(t,i){var s,o;if("string"!==typeof t)return t;if(-1===t.search(/<[A-zA-я]/g))return t;return s=e.parse(t),o=i?r(u(a),i):a,n(s,o),s.innerHTML()}});
//# sourceMappingURL=Sanitize.js.map
define("View/decorators",["Core/IoC","Core/markup/ParserUtilities","Core/helpers/i18n/wordCaseByNumber","Core/Sanitize","Core/helpers/String/escapeHtml","Core/helpers/String/linkWrap","Core/helpers/String/escapeTagsFromStr"],function r(e,t,n,i,o,s,a){"use strict";function u(r,e,t,n){var i="fromContext",o="/",s=r.split(o),a=s[0],u=s.slice(1);return{fieldName:e,propName:r,propPath:u,fullPropName:r,propPathStr:u.join(o),oneWay:t,direction:n||i,nonExistentValue:void 0,bindNonExistent:false}}function c(r){return void 0!==r&&null!==r}function l(r,e){var t,n=(r+="").split(".")[1]||(e?"00":""),i=/^-?([0]*)(\d+)\.?\d*\D*$/,o;if(!r.match(i))t="0";if(o=r.replace(i,"$2"),t="0"===t?t:("-"===r.substr(0,1)?"-":"")+o.replace(/(?=(\d{3})+$)/g," ").trim(),1==n.length&&e)n+="0";return{integer:t,fraction:n}}function f(r){return r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function p(r,e,t){var n=false;if(r.childNodes)for(var i=0;i<r.childNodes.length;i++)n=p(r.childNodes[i],e,t)||n;if(r.text&&e.test(r.text))return r.text=r.text.replace(e,'<span class="'+t+'">$&</span>'),true;else return n}function g(r){var e=134217728,t=67108864,n=33554432,i=16777216;function o(r){if(!r)return 0;else if("string"===typeof r){if(r=Number(r),isNaN(r))r=0}else if("object"===typeof r){var o=Number((r.color||"0").replace("#","0x"));return o|=r.isBold?e:0,o|=r.isItalic?t:0,o|=r.isUnderline?n:0,o|=r.isStrike?i:0,o}return r}function s(r){return"000000".substr(0,6-r.length)+r}return r=o(r),{color:"#"+s((16777215&r).toString(16)).toLowerCase(),isBold:!!(r&e),isItalic:!!(r&t),isUnderline:!!(r&n),isStrike:!!(r&i)}}var d={isArray:function r(e){return"[object Array]"===Object.prototype.toString.call(e)},isString:function r(e){return"[object String]"===Object.prototype.toString.call(e)},isObject:function r(e){return"[object Object]"===Object.prototype.toString.call(e)},orEmpty:function r(e){if(void 0===e||null===e)return"";return e},ucFirst:function r(e){return e.replace(/^\w/,function(r){return r.toUpperCase()})},toUpperCase:function r(e){return e.toUpperCase()},toLowerCase:function r(e){return e.toLowerCase()},trace:function r(t,n,i){var o;if(i)o="RUNNING TRACE DECORATOR: "+i+", Result of expression: ",e.resolve("ILogger","ConsoleLogger").info(o,t);else o="RUNNING TRACE DECORATOR: "+"Your Expression: "+n+", Result of expression ",e.resolve("ILogger","ConsoleLogger").info(o,t);return t},trim:function r(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},substr:function r(e,t,n){return e.substr(t,n)},replace:function r(e,t,n){return t=f(t),e.replace(new RegExp(t,"g"),n)},wordCaseByNumber:n,wrapURLs:function r(){return s.wrapURLs.apply(void 0,arguments)},unescape:function r(e){var t=/&(nbsp|amp|quot|apos|lt|gt);/g,n={nbsp:" ",amp:"&",quot:'"',apos:"'",lt:"<",gt:">"};return e.replace(t,function(r,e){return n[e]})},strftime:function r(){var e=Array.prototype.slice.call(arguments);return Date.prototype.strftime.apply(e.shift(),e)},bind:function r(e,t,n,i){if(c(n))return{value:n,binding:u(t,e,true,i)};return{binding:u(t,e,true,i)}},mutable:function r(e,t,n){if(c(n))return{value:n,binding:u(t,e,false)};return{binding:u(t,e,false)}},_sanitizeOpts:function(){var r={};return function(e){if(e)r=e;else{var t=r;return r={},t}}}(),sanitize:function r(e,t){return d._sanitizeOpts(t),e},escapeTagsFromStr:function r(){return a.apply(this,Array.prototype.slice.call(arguments))},money:function(r,e){var t,n=l((r-=0).toFixed(2),true),i;return i=' title="'+n.integer+"."+n.fraction+'"',t='<span class="ws-moneyDecorator"'+i+'><span class="ws-moneyDecorator__integer__'+e+'">'+n.integer,t=t+'</span><span class="ws-moneyDecorator__fraction">.'+n.fraction+"</span></span>",t},number:function(r,e){var t=l(r);if(void 0!==e)t.fraction=(t.fraction+"00000000000000000000").substr(0,e);return t.fraction?t.integer+"."+t.fraction:t.integer},highlight:function(r,e,n){if(!r||!e)return r;if(void 0===n)n="controls-HtmlDecorators-highlight";r=i(r),r=t.parse(r),e=f(o(""+e));var s=p(r,new RegExp(e,"gi"),n),a,u;if(!s)if(a=e.split(" "),a=a.filter(function(r){return""!==r.trim()}),a)for(var c=0;c<a.length;c++)if(u=a[c],s=p(r,new RegExp(u,"i"),n),s)break;return r.innerHTML()},colorMark:function(r){var e,t;if(!r)return r;if(e=g(r),t="color: "+e.color+";"+(e.isBold?"font-weight: bold;":"")+(e.isItalic?"font-style: italic;":""),e.isUnderline||e.isStrike)t+="text-decoration:"+(e.isUnderline?" underline":"")+(e.isStrike?" line-through":"")+";";return t}};return d});
//# sourceMappingURL=decorators.js.map
define("Core/HashManager",["require","Core/helpers/Object/isEmpty","Core/EventBus","Core/constants"],function(e,n,t,i){var o={_eventBusChannel:null,eventBusId:"HashManager",_handlers:{},_getLocWithoutHash:function(){var e=window.location.toString(),n=e.indexOf("#");if(-1!==n)e=e.substring(0,n);return e},get:function(e){var n="";if(window){var t=decodeURI(window.location.hash),i=new RegExp("(?:#|&)"+e+"=(?:[^&]+$|[^&]+(?=&))","");n=t.match(i)}return n?n[0].replace(/^./,"").replace(e+"=","").replace(/:a:/g,"&"):void 0},set:function(e,t,i,o){if(window&&e){var a={},s={},r=[],h,c;if("object"===typeof e)a=e,o=i,i=t;else a[e]=t;for(h in a)if(a.hasOwnProperty(h))if(c=a[h],void 0===c||!(""+c).trim())r.push(h);else s[h]=c;if(r.length)this.remove(r,i);if(!n(s)){var l=decodeURI(window.location.hash);if(0===l.indexOf("#"))l=l.substring(1);for(h in s)if(s.hasOwnProperty(h)){var f=(s[h]+"").replace(/&/g,":a:"),u=new RegExp(h+"=[^&]+$|"+h+"=[^&]+(?=&)",""),d=[h,f].join("=");if(l.length)l=l.match(u)?l.replace(u,d):[l,d].join("&");else l=d}this.setHash(l,i,o)}}},setHash:function(e,n,t){var i=this._getLocWithoutHash();this._changeLocation(i,e,this._replace||t),!t&&(this._replace=n)},pushState:function(){if(this._replace=false,this.set("ws-dummy","1"),this._replace=true,this.remove("ws-dummy",true),e.defined("js!SBIS3.CORE.NavigationController"))e("js!SBIS3.CORE.NavigationController").saveAllStates()},remove:function(e,n){if(window){if(!(e instanceof Array))e=[e];var t=decodeURI(window.location.hash),i=this._getLocWithoutHash();if(0===t.indexOf("#"))t=t.substring(1);for(var o=0;o<e.length;o++){var a=new RegExp("&?"+e[o]+"=[^&]+$|"+e[o]+"=[^&]+&","g");t=t.replace(a,"")}this._changeLocation(i,t,this._replace),this._replace=n}},_changeLocation:function(e,n,t){var a=e+"#"+encodeURI(n);if(!i.$body)i.$body=$("body");if(i.$body.hasClass("ws-new-page-template")){if(n===window.location.hash||t)history.replaceState(history.state,"",a);else history.pushState(history.state,"",a);o._getChannel().notify("onChange")}else if(t)window.location.replace(a);else window.location=a},_getChannel:function(){if(!this._eventBusChannel)this._eventBusChannel=t.channel(this.eventBusId);return this._eventBusChannel},once:function(e,n){this._getChannel().once(e,n,this)},subscribe:function(e,n){return this._getChannel().subscribe(e,n,this),this},unsubscribe:function(e,n){return this._getChannel().unsubscribe(e,n),this}};if("undefined"!==typeof window)o._replace=true,window.onhashchange=function(){o._getChannel().notify("onChange")};return o});
//# sourceMappingURL=HashManager.js.map
define("Lib/NavigationController/NavigationController",["Core/constants","Core/EventBus","Core/Deferred","Core/core-functions","Core/HashManager","Core/cookie"],function(t,e,a,s,i,n){"use strict";return{_storageByStateKey:{},_waitingByStateKey:{},_luntik:null,_storage:[],_needToParseHash:false,init:function(){var e=this;if(t.saveLastState){if(this._loadLastState(),!t.$win)t.$win=$(window),t.$doc=$(document);if(t.$win.on("unload",function(){if(!window.location.search)e._saveLastState()}),t.browser.isMobileSafari)window.addEventListener("pagehide",function(){e._saveLastState()})}this._initLuntikHandler(),this._parseHash(),i.subscribe("onChange",function(){var t=true,a=i.get("ws-nc"),s,n;if(a=a?a.split(";"):[],a.length==e._storage.length){t=false;for(var r=a.length-1;r>=0;r--)if(s=a[r].split("="),n=String(e._storage[r].state).replace(/;|=|%/g,function(t){return{";":":s:","=":":e:","%":":p:"}[t]}),e._storage[r].stateKey!=s[0]||n!=s[1]){t=true;break}}if(t||e._needToParseHash)e._needToParseHash=false,e._parseHash()})},_initLuntikHandler:function(){var t=this;e.channel("luntik").subscribe("onInit",function(e,a){var s=a.getStateKey();if(s){if(t._storageByStateKey[s]=a,t._waitingByStateKey[s]&&!t._waitingByStateKey[s].isReady())try{t._waitingByStateKey[s].callback(a)}finally{delete t._waitingByStateKey[s]}a.subscribe("onDestroy",function(){delete t._storageByStateKey[this.getStateKey()]})}})},_containsByStateKey:function(t){return!!this._storageByStateKey[t]},_getByStateKey:function(t){return this._storageByStateKey[t]},_waitByStateKey:function(t){return this._waitingByStateKey[t]=this._waitingByStateKey[t]||new a},_getHashWithoutMSID:function(){return decodeURI(window.location.hash).replace(/(&msid=s\d+)|(msid=s\d+&?)/g,"").replace(/^#*/g,"")},_saveLastState:function(){var t=decodeURI(window.location.pathname),e={},a=n.get("sid"),s=this._getHashWithoutMSID(),i=this._getLastState();if(i&&i.hasOwnProperty(a))i[a][t]=s,e=i;else(e={})[a]={},e[a][t]=s;this._setLastState(e)},_loadLastState:function(){var t=decodeURI(window.location.pathname),e=this._getHashWithoutMSID(),a=n.get("sid"),s=this._getLastState(),r;if(!window.location.search&&!e.length&&s&&s[a]&&(r=s[a][t]))i.setHash([window.location.hash.replace(/^#/,""),r].join(window.location.hash.length?"&":""),true)},_getLastState:function(){try{return JSON.parse(window.localStorage.getItem("lastState"))}catch(t){return}},_setLastState:function(t){try{window.localStorage.setItem("lastState",JSON.stringify(t))}catch(t){}},updateStateForce:function(t,e,a){this.updateState(t,e,a,true)},_checkAndSaveState:function(t){for(var e in this._storage)if(t?this._storage[e].stateKey===t&&!this._storage[e].saved:!this._storage[e].saved)return void i.pushState()},saveAllStates:function(){for(var t in this._storage)if(this._storage.hasOwnProperty(t))this._storage[t].saved=true},updateState:function(t,e,a,s){if(t){for(var i=0,n=this._storage.length;i<n;i++)if(this._storage[i].stateKey==t){if(!s&&!this._storage[i].applied)return;if(this._storage[i].state!==e&&!a)this._checkAndSaveState();return this._storage[i].state=e,this._updateHash(!this._storage[i].saved?a:true,[],this._storage[i].saved),void(this._storage[i].saved=false)}this._pushState(t,e,true,false),this._updateHash(true,[],true)}},setState:function(t,e){var a={};if(!t)throw new Error("NavigationController.setState :: wrong control stateKey");if("object"==typeof t)a=t;else a[t]=e;for(var s in a)if(a.hasOwnProperty(s))if(void 0===a[s]&&this._containsByStateKey(s))this.removeState(this._getByStateKey(s));else{for(var i=false,n=0,r=this._storage.length;n<r;n++)if(this._storage[n].stateKey==s)if(i=true,this._storage[n].state!==a[s])this._storage[n].state=a[s],this._needToParseHash=true;if(!i)this._pushState(s,a[s]),this._needToParseHash=true}this._updateHash()},_pushState:function(t,e,a,s){if(void 0===s)s=true;this._storage.push({stateKey:t,state:e,applied:a,saved:s})},_updateHash:function(t,e,a){var s=[];if(!e)e=[];for(var n=0,r=this._storage.length;n<r;n++)if(-1===e.indexOf(this._storage[n].stateKey))s.push([this._storage[n].stateKey,(""+this._storage[n].state).replace(/;|=|%/g,function(t){return{";":":s:","=":":e:","%":":p:"}[t]})].join("="));i.set("ws-nc",s.join(";"),t,a)},_removeFromHash:function(t,e){var a=decodeURI(i.get("ws-nc")),s=[];(a=a?a.split(";"):[]).forEach(function(t){s.push(t.split("=")[0])});for(var n=t.length-1;n>=0;n--)if(-1===s.indexOf(t[n]))t.splice(n,1);if(t.length)this._updateHash(true,t,e)},_parseHash:function(){var t=decodeURI(i.get("ws-nc")),e,a=s.clone(this._storage),n;if(this._storage=[],"undefined"==t)return void this._checkChangeState([],a);t=t?t.split(";"):[],this._checkChangeState(t,a);for(var r=0,o=t.length;r<o;r++)if(!!t[r]){n=false,e=t[r].split("=");for(var h in a)if(a[h].stateKey===e[0]){n=true;break}this._pushState(e[0],e[1].replace(/:(s|e|p):/g,function(t,e){return{s:";",e:"=",p:"%"}[e]}),false,n)}this._buildChain()},_checkChangeState:function(t,e){var a=this,s=[];if(!t.length)this._storage=[];t.forEach(function(t){s.push(t.split("=")[0])}),e.forEach(function(t){if(-1===s.indexOf(t.stateKey))a._checkAndApplyEmptyState(t.stateKey)})},_checkAndApplyEmptyState:function(t){var e=t;if("string"===typeof t)if(this._containsByStateKey(t))e=this._getByStateKey(t);if("function"===typeof e.applyEmptyState)e.applyEmptyState()},getStateByKey:function(t){for(var e=0,a=this._storage.length;e<a;e++)if(this._storage[e].stateKey==t)return this._storage[e]},_buildChain:function(){var t=this,e,a=this._storage.concat();function s(e){return e.once("onStateChanged",function a(){var s=t.getStateByKey(e.getStateKey());if(s)s.applied=true,e.applyState(s.state)}),e}for(var i=0,n=a.length;i<n;i++){if(e=a[i],!e.stateKey)continue;if(this._containsByStateKey(e.stateKey)){var r=this._getByStateKey(e.stateKey);e.applied=true,r.applyState(e.state)}else this._waitByStateKey(e.stateKey).addCallback(s)}},removeState:function(t,e){var a=t.getStateKey(),s;if(a)for(var i=this._storage.length-1;i>=0;i--)if(this._storage[i].stateKey==a){s=this._storage[i].stateKey,this._checkAndSaveState(a);var n=this._storage[i].saved;if(this._storage.splice(i,1),this._removeFromHash([s],n),e||void 0===e)this._checkAndApplyEmptyState(t);break}}}});
//# sourceMappingURL=NavigationController.js.map
define("Lib/Mixins/DataBoundMixin",["Core/helpers/generate-helpers","Core/IoC","Core/ConsoleLogger","i18n!Lib/Mixins/DataBoundMixin"],function(t,e){return DataBoundMixin={$protected:{_contextUpdateHandlerFunction:null,_validating:false,_defaultValue:void 0,_initialValueSetted:false,_validationErrorCount:0,_prevValidationResult:true,_vResultErrors:[],_options:{value:"",errorMessage:"",titleErrorMessage:[rk("Ошибка"),rk("Ошибки")],errorMessageFilling:rk("Введите значение"),validators:[],loadValueFromContextToConstructorOptions:false}},$constructor:function(){if(this._publishEvents(),this._contextUpdateHandlerFunction=this._contextUpdateHandler.bind(this),this.setTitleErrorMessage(this._options.titleErrorMessage),!this._options.name)this._options.name="name-"+this.getId()+"-"+t.randomId()},around:{_isCanShowExtendedTooltip:function(){return Array.prototype.shift.call(arguments).apply(this,arguments)||this.isMarked()}},instead:{_alterTooltipText:function(t){if(this.isMarked()){var e=this._options.errorMessage instanceof jQuery?this._options.errorMessage[0].outerHTML:this._options.errorMessage,i=this._validationErrorCount>1?this._options.titleErrorMessage[1]:this._options.titleErrorMessage[0];return("string"==typeof t&&t.length?"<p>"+t+"</p>":"")+'<p><span class="ws-validation-error-message">'+i+":</span> "+e+"</p>"}else return t}},before:{init:function(){if(this._context)this._context.subscribe("onDataBind",this._contextUpdateHandlerFunction),this._context.subscribe("onFieldChange",this._contextUpdateHandlerFunction);if(this._initDefaultValue(),this._contextUpdateHandler(),void 0===this.getValue())this._defaultValueHandler();if(void 0===this.getValue())this._curval=this._curValue(),this._updateSelfContextValue(this._notFormatedVal());this._markInitialValueSetted()},destroy:function(){if(this._context)this._context.unsubscribe("onDataBind",this._contextUpdateHandlerFunction),this._context.unsubscribe("onFieldChange",this._contextUpdateHandlerFunction);this._getInfobox(function(t){if(t.hasTarget()&&t.isCurrentTarget(this._getExtendedTooltipTarget()))t.hide()}.bind(this))}},_notifyOnValueChange:function(t){if(this._initialValueSetted){if(!(t instanceof Array))t=[t];else t=t.slice(0);t.unshift("onValueChange"),this._notify.apply(this,t)}},_markInitialValueSetted:function(){this._initialValueSetted=true},_contextUpdateHandler:function(t,e,i,n){var r=this._options.name;if(!!r&&this._context&&this!==n)if(e){if(this._context.isFieldSameOrSubField(r,e))this._onContextValueReceived(this._context.getValue(r))}else this._onContextValueReceived(this._context.getValue(r))},_publishEvents:function(){this._publish("onValidate","onValueChange")},_initDefaultValue:function(){this._defaultValue=this._getDefaultValue()},_updateSelfContextValue:function(t){if(this._options.name)this.getLinkedContext().setValue(this._options.name,t,void 0,this)},_defaultValueHandler:function(){var t=this.getDefaultValue();if(void 0!==t&&this.setValue)this.setValue(t,true,true)},_getDefaultValue:function(){return},getValue:function(){var t=this._options.name;return t?this.getLinkedContext().getValue(t):void 0},getDefaultValue:function(){return this._defaultValue},_curValue:function(){},_notFormatedVal:function(){},setTitleErrorMessage:function(t){this._options.titleErrorMessage=t instanceof Array?t:[t,t]},_canValidate:function(){var t=this.getValidators();return t&&t.length>0},_invokeValidation:function(){for(var t={errors:[],result:true},i=0,n=this._options.validators.length;i<n;i++){var r=this._options.validators[i],o=!(r.noFailOnError||false),s=false;try{s=r.validator.apply(this,r.params||[])}catch(t){e.resolve("ILogger").log("Control with name "+this.getName(),"Exception while validating "+t.message)}if(true!==s)if(s=r.errorMessage?r.errorMessage:s,t.errors=t.errors.concat(s),o)t.result&=false}return t},validate:function(){var t,e=this.getContainer(),i=this._prevValidationResult;if(this.clearMark(),this._validating||!this._canValidate()||!e||true===e.hasClass("ws-hidden"))return true;try{this._validating=true,t=this._invokeValidation()}catch(e){t={errors:[e.message],result:false}}finally{this._validating=false}if(t.errors.length>0)this.markControl(t.errors);return this._calcPrevValidationResult(),this._notify("onValidate",!!t.result,t.errors,i),this._vResultErrors=t.errors,t.result},_createErrorMessage:function(t){var e;if(t instanceof Array&&1==t.length)e=t[0];else if(t instanceof Array){e=$("<ul></ul>");for(var i=0,n=t.length;i<n;i++)e.append("<li>"+t[i]+"</li>")}else e=t;this._options.errorMessage=e},_handlersPath:function(t){var e=this.getEventHandlers(t),i=[];if(e)for(var n=0,r=e.length;n<r;n++)if(e[n].wsHandlerPath)i.push(e[n].wsHandlerPath);return i},_calcValidationErrorCount:function(t){this._validationErrorCount=t instanceof Array?t.length:1},_calcPrevValidationResult:function(){this._prevValidationResult=!this.isMarked()},markControl:function(t,e){var i=t&&("string"==typeof t||t instanceof Array&&t.length)?t:this._options.errorMessageFilling;if(this._calcValidationErrorCount(i),this._createErrorMessage(i),true===e)this._getInfobox(function(t){t.show(this._getExtendedTooltipTarget(),this._alterTooltipText(),"auto")}.bind(this));this._container.addClass("ws-validation-error")},clearMark:function(){if(this._validationErrorCount)this._validationErrorCount=0,this._options.errorMessage="",this._container.removeClass("ws-validation-error"),this._getInfobox(function(t){if(t.hasTarget()&&t.isCurrentTarget(this._getExtendedTooltipTarget()))if(this._isCanShowExtendedTooltip())this._showExtendedTooltip(true);else t.hide(0)}.bind(this))},isMarked:function(){return!!this._validationErrorCount},_onContextValueReceived:function(t){},getValidators:function(){return this._options.validators},setValidators:function(t){if(t&&"[object Array]"==Object.prototype.toString.apply(t))this._options.validators=t},getErrorMessage:function(){return this._options.errorMessage},setErrorMessage:function(t){this._options.errorMessage=t},getErrorMessageFilling:function(){return this._options.errorMessageFilling},setErrorMessageFilling:function(t){this._options.errorMessageFilling=t},_getInfobox:function(t){var e="Lib/Control/Infobox/Infobox";if(requirejs.defined(e))return t(requirejs(e));else requirejs([e],function(e){return t(e)})}}});
//# sourceMappingURL=DataBoundMixin.js.map
define("Lib/Control/ControlGoodCode",["Core/constants","Core/Deferred","Core/ControlBatchUpdater","Core/helpers/random-helpers","Core/core-instance","Core/IoC"],function(t,e){return{getExtendedTooltip:function(){return this._getOption("extendedTooltip")},setExtendedTooltip:function(t){this._setOption("extendedTooltip",t)},_bindExtendedTooltip:function(){var t=this;if(this._tooltipSettings.handleFocus)this.subscribe("onFocusIn",function(){if(this._isCanShowExtendedTooltip())this._showExtendedTooltip()}),this.subscribe("onFocusOut",function(e,o,i){if(this._isCanShowExtendedTooltip()&&!t._isInfoboxFocus(i))t._getInfobox(function(e){if(e.isCurrentTarget(t._getExtendedTooltipTarget()))e.hide(0)})});if(this._tooltipSettings.handleHover)this.getContainer().bind("mouseenter",function(){if(t._underCursor=true,t._initiatedByCursor=true,t._isCanShowExtendedTooltip())t._showExtendedTooltip(true)}),this.getContainer().bind("mouseleave",function(){if(t._underCursor=false,t._initiatedByCursor=false,t._isCanShowExtendedTooltip())if(!t.isActive())t._getInfobox(function(e){if(e.isCurrentTarget(t._getExtendedTooltipTarget()))e.hide(e.HIDE_TIMEOUT)})})},_isInfoboxFocus:function(t){if(!t)return false;return!!t.getContainer().closest(".ws-info-box").length},_isCanShowExtendedTooltip:function(){var e=false;if(!t.browser.isMobilePlatform&&this._getOption("extendedTooltip"))if(!this.isEnabled())e=!!this._getOption("alwaysShowExtendedTooltip");else e=true;return e},_getExtendedTooltipTarget:function(){return this.getContainer()},_getExtendedTooltipPositionContainer:function(){return this.getContainer()},_showExtendedTooltip:function(t){var o=this,i="Lib/Control/Infobox/Infobox",n,r;if(requirejs.defined(i)){var s=requirejs(i);if(true!==t&&s.isCurrentTarget(this._getExtendedTooltipTarget()))return}this._getInfobox(function(t){if(r=o._notify("onTooltipContentRequest",n=o._getOption("extendedTooltip")),r instanceof e)n='<i class="ws-inline-ajax-loader-16">Загрузка&hellip;</i>',r.addBoth(function(e){if(!t.hasTarget())o._finallyShowInfobox(e);else if(t.isCurrentTarget(o._getExtendedTooltipTarget()))t.setText(o._alterTooltipText(e));else t.once("onShow",function(){if(t.isCurrentTarget(o._getExtendedTooltipTarget()))t.setText(o._alterTooltipText(e))});return e});else if("string"===typeof r)n=r;else if(false===r)n="";o._finallyShowInfobox(n)})},_finallyShowInfobox:function(t){if(this._isCanShowExtendedTooltip()){var e=this,o=this._initiatedByCursor,i=function(){return e._isCanShowExtendedTooltip()&&(!o||e._underCursor)},n={control:this._getExtendedTooltipTarget(),positionByTarget:this._getExtendedTooltipPositionContainer(),message:this._alterTooltipText(t),modifiers:this._getExtendedTooltipModifiers(),autoHide:true,needToShow:i};this._initiatedByCursor=false,this._getInfobox(function(t){n.delay=t.SHOW_TIMEOUT,n.hideDelay=t.ACT_CTRL_HIDE_TIMEOUT,t.show(n)})}},_getInfobox:function(t){var e="Lib/Control/Infobox/Infobox";if(requirejs.defined(e))return t(requirejs(e));else requirejs([e],function(e){return t(e)})}}});
//# sourceMappingURL=ControlGoodCode.js.map
define("Lib/Control/AttributeCfgParser/AttributeCfgParser",["Core/helpers/Object/isEmpty"],function(e){var r='"(?:[^"\\\\]|\\\\.)*"',i="'(?:[^'\\\\]|\\\\.)*'",t="/(?:[^/\\\\]|\\\\.)*/w*",n=",\"'{}()/:[\\]",f="[^\\s:,/][^"+n+"]*[^\\s"+n+"]",u="[^\\s]",l=RegExp(r+"|"+i+"|"+t+"|"+f+"|"+u,"g"),a=/[\])"'A-Za-z0-9_$]+$/,s={in:1,return:1,typeof:1};function o(e){var r=e.trim();if(123===r.charCodeAt(0))r=r.slice(1,-1);var i=[],t=r.match(l),n,f=[],u=0;if(t){t.push(",");for(var o=0,h;h=t[o];++o){var v=h.charCodeAt(0);if(44===v){if(u<=0){if(!n)n=null;i.push({key:n,value:f.join("")}),n=void 0,f=[],u=0;continue}}else if(58===v){if(!u&&!n&&1===f.length){n=f.pop();continue}}else if(47===v&&o&&h.length>1){var c=t[o-1].match(a);if(c&&!s[c[0]])(t=(r=r.substr(r.indexOf(h)+1)).match(l)).push(","),o=-1,h="/"}else if(40===v||123===v||91===v)++u;else if(41===v||125===v||93===v)--u;else if(!n&&!f.length&&(34===v||39===v))h=h.slice(1,-1);f.push(h)}}return i}function h(e){var r=0,i;for(i in e)if(e.hasOwnProperty(i))r++;return r}return function r(i){var t=o(i),n={};if(1==t.length&&null===t[0].key)return t[0]["value"];for(var f=0,u=t.length;f<u;f++)if("key"in t[f]){var l=t[f]["key"],a=t[f]["value"];if(null===l)n[a]=void 0;else n[l]=r(a)}return e(n)?void 0:n}});
//# sourceMappingURL=AttributeCfgParser.js.map
define("Core/helpers/String/unEscapeHtml",function(){return function(e){if("string"==typeof e)return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&");else return e}});
//# sourceMappingURL=unEscapeHtml.js.map
define("Core/helpers/Hcontrol/isScrollable",function(){return function(r,e){var n=$(r);function o(){var r=n.css("overflow-x");return"auto"===r||"scroll"===r}function l(){var r=n.css("overflow-y");return"auto"===r||"scroll"===r}if("x"===e)return o();else if("y"===e)return l();else return o()||l()}});
//# sourceMappingURL=isScrollable.js.map
define("Core/helpers/Hcontrol/hasScrollbar",function(){var r=function(r,t){var i,n=false;if(r=$(r),r.length>0){if(i=r.get(0),void 0===t||"y"===t)n=i.scrollHeight!==i.clientHeight;if(!n&&(void 0===t||"x"===t))n=i.scrollWidth!==i.clientWidth}return n},t=function(t){return r(t,"x")},i=function(t){return r(t,"y")};return r.horizontal=t,r.vertical=i,r});
//# sourceMappingURL=hasScrollbar.js.map
define("Core/helpers/Hcontrol/focusControl",["Core/helpers/Hcontrol/isScrollable","Core/helpers/Hcontrol/hasScrollbar","Core/detection"],function(e,n,o){var r;function t(){return r||(r=$(window))}return function(r){function i(o,r){return 1===o&&("fixed"===r.css("position")||r.is(".ws-scrolling-content")||e(r,"y")&&n(r,"y"))}function l(e){if(0===e.length)return $(null);else{var n=e.prop("nodeType");if(9===n)return $(e.prop("defaultView")||e.prop("parentWindow"));else if(i(n,e))return e;else return l(e.parent())}}function s(e){while(e){if(e.environment)return e.environment;e=e._logicParent}throw new Error("environment не был найден среди предков")}if(!r.isDestroyed()&&r._needFocusOnActivated()&&r.isVisibleWithParents()){var c=r._getElementToFocus(),u,f,a;if(c&&c.focus&&document.activeElement!==c.get(0))if(u=l(c.parent()),u.length>0){if(!$.isWindow(u.get(0))&&u.is("body, html"))u=t();f=u.scrollTop();try{r._ignoreNativeFocusIn=true;var p=true;if(o.isIE)p=$(c).offset().top>0;if(p)if(r.iWantVDOM&&s(r)._haveRebuildRequest)r.__$focusing=true;else c.focus()}finally{r._ignoreNativeFocusIn=false}if(a=u.scrollTop(),a!==f)u.scrollTop(f)}}}});
//# sourceMappingURL=focusControl.js.map
define("Core/helpers/Function/memoize",function(){return function(n,t){var e=function(){var r=n.call(this),i=function(){return r},u=this;return i.reset=function(){u[t]=e,r=void 0},this[t]=i,r};return e.reset=function(){},e.wrappedFunction=n,e}});
//# sourceMappingURL=memoize.js.map
define("Lib/Control/Control",["Core/core-extend","Lib/Control/Control.compatible","Core/core-functions","Core/core-instance","Core/helpers/String/unEscapeHtml","Core/helpers/Function/memoize","Core/IoC","Core/EventBus","Core/Deferred","Core/CommandDispatcher","Core/detection","Core/Abstract","Lib/Mixins/DataBoundMixin","Core/markup/ParserUtilities","Lib/NavigationController/NavigationController","Core/ControlBatchUpdater","Core/helpers/markup-helpers","Core/Context","Core/constants","Core/helpers/Hcontrol/replaceContainer","Core/helpers/Hcontrol/focusControl","Lib/Control/ControlGoodCode","Core/helpers/Object/find","Core/helpers/random-helpers","Core/ContextBinder","Lib/Control/AttributeCfgParser/AttributeCfgParser"],function(t,i,e,n,s,o,a,r,h,l,_,c,d,g,f,u,p,C,m,v,b,y){"use strict";function O(t){return t.substr(0,1).toUpperCase()+t.substr(1)}var w,A,x=function(t,i,e){w.prototype._setCompatibleOptions(t,i,e)};if((w=c.extend([i,y],{_$element:null,_$horizontalAlignment:void 0,_$verticalAlignment:void 0,_$name:"",_$enabled:true,_$allowChangeEnable:true,_$width:"",_$height:"",_$minWidth:0,_$minHeight:0,_$maxWidth:1/0,_$maxHeight:1/0,_$owner:null,_$tooltip:"",_$extendedTooltip:false,_$alwaysShowExtendedTooltip:true,_$visible:true,_$tabindex:-1,_$className:"",_$zIndex:void 0,_$autoHeight:true,_$autoWidth:false,_$saveState:false,_$stateKey:"",_$subcontrol:false,_$cssClassName:"",_$content:"",_$isContainerInsideParent:true,_$activableByClick:true,_$buildMarkupWithContext:true,_$linkedContext:null,_$focusOnActivatedOnMobiles:void 0,_$fix165c4103:false,_parent:null,_container:void 0,_prevEnabled:void 0,_isControlActive:false,_id:"",_context:null,_craftedContext:false,_keysWeHandle:null,_isVisible:true,_minHeight:null,_margins:null,_horizontalAlignment:"Stretch",_verticalAlignment:"Top",_batchUpdateData:void 0,_aliasForContent:"",_checkClickByTap:false,_maxTouchCount:1,_maxTouchTime:300,_clickState:null,_ignoreNativeFocusIn:false,_underCursor:false,_initiatedByCursor:false,_owner:null,_userData:void 0,_tooltipSettings:null,_propertiesChangedLock:0,_propertiesChangedCnt:0,_supportOldJinneeMarkup:false,_rootMarkupByTemplate:false,_enabledOptApplied:void 0,_savedConfigs:null,_savedConfigsMaps:null,_saveConfigFromOption:function(t){if("[object String]"===Object.prototype.toString.call(t)){var i=/config=/gi,n;while(n=i.exec(t)){var s=t.indexOf('"',n.index)+1,o=t.indexOf('"',s),a=t.substring(s,o),r={};r[a]=e.shallowClone(p.getConfigStorage()[a]),this._savedConfigs.push(r),this._savedConfigsMaps.push(a)}}},constructor:function t(i,s){this._savedConfigs=[],this._savedConfigsMaps=[];for(var o in i)if(i.hasOwnProperty(o))this._saveConfigFromOption(i[o]);this._tooltipSettings=this._tooltipSettings||{},this._keysWeHandle=this._keysWeHandle||[],this._margins=this._margins||{},this._clickState={detected:false,stage:"",timer:void 0,timeout:500,target:null,touchCount:0,timeStart:void 0},this._tooltipSettings={handleFocus:this._tooltipSettings&&"handleFocus"in this._tooltipSettings?this._tooltipSettings.handleFocus:true,handleHover:this._tooltipSettings&&"handleHover"in this._tooltipSettings?this._tooltipSettings.handleHover:true},t.superclass.constructor.call(this,i,true);var a=this,r,h,l,_,c;if(this._publish("onChange","onKeyPressed","onClick","onFocusIn","onFocusOut","onStateChanged","onTooltipContentRequest","onPropertyChanged","onPropertiesChanged","onCommandCatch"),this._keysWeHandle=e.hash(this._keysWeHandle),i){if("parent"in i&&(i.parent&&i.parent._template||i.parent instanceof t||n.instanceOfModule(i.parent,"Lib/Control/AreaAbstract/AreaAbstract")))this._parent=i.parent;if("id"in i)this._id=i.id;if(void 0!==i.enable)this._setOption("enabled",!!i.enable);if(void 0!==i.hidden)this._setOption("visible",!i.hidden);this._supportOldJinneeMarkup=!!i.supportOldJinneeMarkup,this._initContainer(i)}var d=this._createContext(this._getOptions(),this._parent&&this._parent.getLinkedContext&&this._parent.getLinkedContext());this._context=d.context,this._craftedContext=d.craftedContext;var g=this._getOptions();if(r={},"enabled"in g)r.enabled=g.enabled;if("visible"in g)r.visible=g.visible;if("name"in g)r.name=g.name;if("className"in g)r.className=g.className;if("cssClassName"in g)r.cssClassName=g.cssClassName;if(this._options)this._options=this._modifyOptions(this._getOptions(),i);if(this._contentAliasing(this._getOptions(),i),this._parent&&!this._parent.isEnabled()&&this._getOption("allowChangeEnable"))this._prevEnabled=this._getOption("enabled"),this._setOption("enabled",false);if(a._isCorrectContainer()){if(p.removeConfigStringDataFromStorage(this._container.attr("config")),l=this._hasMarkup(),this._rootMarkupByTemplate=true,!l&&this._dotTplFn)_=this._getOption("buildMarkupWithContext")?this._context:null,c=this._buildMarkup(this._dotTplFn,this._getOptions(),null,null,_),v(this._container,c),i.element=this._container,this._enabledApplied=this._getOption("enabled");else if(this._rootMarkupByTemplate="true"===this._container.attr("wasbuildmarkup"),h=!this._rootMarkupByTemplate||Object.keys(r).reduce(function(t,i){return t||this._getOption(i)!==r[i]}.bind(this),false),h){if(this._getOption("name"))this._container.attr("sbisname",this._getOption("name"));var f="ws-control-inactive ws-component "+this._getOption("className");if(!this._hasMarkup()&&this._getOption("cssClassName"))f+=" "+this._getOption("cssClassName");var u=this._container.attr("tabindex")||0;this._container.addClass(f).attr({tabindex:u,hideFocus:true})}else this._enabledApplied=this._getOption("enabled");if(!this._getOption("visible"))this.hide();else if("SBIS3.CONTROLS.OperationsPanel"!==this._moduleName&&this._container.hasClass("ws-hidden"))this._isVisible=false,this.show();if(void 0!==this._getOption("zIndex"))this._container.css("z-index",this._getOption("zIndex"));if(this._supportOldJinneeMarkup){this._horizontalAlignment=this._getOption("horizontalAlignment")||this._container.attr("HorizontalAlignment")||this._horizontalAlignment,this._verticalAlignment=this._getOption("verticalAlignment")||this._container.attr("VerticalAlignment")||this._verticalAlignment;var C=a._getLinkedLabel();if(C)C.css("z-index",a._getOption("zIndex"))}else this._horizontalAlignment=this._getOption("horizontalAlignment")||this._horizontalAlignment,this._verticalAlignment=this._getOption("verticalAlignment")||this._verticalAlignment;if(this._container[0].wsControl=this,this._container.bind("click touchend",this._onActionHandler.bind(this)),m.compatibility.touch)this._container[0].addEventListener("touchmove",this._onActionHandler.bind(this),m.compatibility.supportPassive?{passive:true}:false),this._container[0].addEventListener("touchstart",this._onActionHandler.bind(this),m.compatibility.supportPassive?{passive:true}:false);this._initKeyboardMonitor(),this._bindExtendedTooltip()}if(this._initSizeOptions(),this._getOption("autoWidth"))this._setOption("width","auto");if(this._getOption("autoHeight"))this._setOption("height","auto");if(this._parent)this._registerToParent(this._parent);if(this._getOption("saveState"))this.subscribe("onStateChanged",this._stateChangeHandler);if(this.subscribe("onPropertyChanged",function(t,i){if(this._hasOption(i))this._notify("onChange"+i,this._getOption(i))}),!s)this._initInstance()},init:function(){this._initFocusCatch(),w.superclass.init.apply(this,arguments)},_createContext:function(t,i){var e,n,s;if(s=t.context||t.linkedContext,s&&!(s instanceof C))throw new Error("Опция linkedContext (или context), если указана, и не равна null/undefined, то должна быть объектом типа Core/Context");if(e=s||i,n=!e,n)n=false,e=C.global;return{context:e,craftedContext:n}},_isRelativePosition:o(function(){var t=this._isCorrectContainer()&&this._container.css("position");return"relative"===t||"static"===t},"_isRelativePosition"),_buildMarkup:function(t,i,e,n,s){return g.buildMarkup(t,i,void 0,n,s)},_prepareMarkup:function(t,i,e,n,s){return g.prepareMarkupForNode(t,i,e,n,s)},setTooltip:function(t){this._setOption("tooltip",""+(t?t:"")),this._container.attr("title",s(this._getOption("tooltip"))),this._notifyOnPropertyChanged("tooltip")},getClassName:function(){return this._getOption("className")},setClassName:function(t){this._container.toggleClass(this._getOption("className")),this._setOption("className",t),this._container.addClass(t)},describe:function(){return(this._isCorrectContainer()?this.getContainer().attr("type")||this.getContainer().attr("data-component"):"?Control")+"#"+this.getId()},_contentAliasing:function(t,i){var e;if(this._aliasForContent&&t.content){if(i&&this._aliasForContent in i)e=i[this._aliasForContent];else e=void 0;if(""===e||void 0===e||null===e)t[this._aliasForContent]=t.content}return t},_bindInternals:function(){},onAfterVisibilityChange:function(t,i){this._notify("onAfterVisibilityChange",i)},_registerToParent:function(t){if(t._template)this.once("onInit",function(){t._notifyToParentAboutChild(this)}),t.registerToChildMap(this);if(n.instanceOfModule(t,"Lib/Control/AreaAbstract/AreaAbstract")||t._template){if(t.hasEvent("onResize")||t._template)t.registerChildControl(this)}else if(t)a.resolve("ILogger").error("Control","Incorrect parent ("+(t instanceof Object&&t.getId?t.getId():"not object")+") for control ("+this.getId()+"), parent must be instanceof $ws.proto.AreaAbstract");this.onAfterVisibilityChange=this.onAfterVisibilityChange.bind(this),t.subscribe("onAfterVisibilityChange",this.onAfterVisibilityChange),this.subscribe("onDestroy",function(){t.unsubscribe("onAfterVisibilityChange",this.onAfterVisibilityChange)})},_delayToConstructionFinished:function(t,i,e){var n=Array.prototype.slice.call(arguments,3),s=this;if(this._isInitialized)if(i)this._runInBatchUpdate(t,e,n);else e.apply(s,n);else if(i)u.beginBatchUpdate(t),this.once("onInit",function(){try{e.apply(s,n)}finally{u.endBatchUpdate(t)}});else this.once("onInit",function(){e.apply(s,n)})},_initComplete:function(){if(this._isCorrectContainer())this._setEnabled(this._getOption("enabled"));A.store(this),r.channel("luntik").notify("onInit",this),w.superclass._initComplete.apply(this,arguments)},_notifyBatchDelayedEventLow:function(t,i,e){var n;if(this._haveBatchUpdate())u.addDelayedEvent(t,i,this,e);else n=this._notify.apply(this,e);return n},_notifyBatchDelayedNoMerge:function(t){return this._notifyBatchDelayedEventLow(t,false,arguments)},_notifyBatchDelayed:function(t){return this._notifyBatchDelayedEventLow(t,true,arguments)},_notifyOnSizeChanged:function(t,i,e){var n=u;if(n.ensureBatchUpdate("Control._notifyOnSizeChanged"),1===arguments.length)e=arguments[0];n.addBatchSizeChanged(this,e)},_initFocusCatch:function(){var t=this,i=[this._getElementToFocus()];if(!i[0]||i[0].get(0)!==this._container.get(0))i.push(this._container);for(var e=0;e<i.length;++e){var n=i[e];if(n)n.bind("focusin",function(i){if(t._getOption("activableByClick")){if(i.target.wsControl&&i.target.wsControl.iWantVDOM)return;if(!t._ignoreNativeFocusIn&&!t.isActive())t.setActive(true,false,true);i.stopPropagation()}}),n.bind("focusout",function(i){var e=$(i.relatedTarget),n,s,o;if(e.length>0&&0===e.closest(t.getContainer()).length){if(t.isActive()){if(m.compat)n=e.wsControl();else n=e[0].wsControl;if(s=n&&n.findParent(function(i){return i===t}),o=n===t,!s&&!o)t.setActive(false,false,true,n)}i.stopPropagation()}})}},applyState:function(t){},applyEmptyState:function(){},setStateKey:function(t){this._setOption("stateKey",t)},getStateKey:function(){return this._getOption("saveState")?this._getOption("stateKey")||this.getName():void 0},_stateChangeHandler:function(t,i,e,n){if(void 0!==i)f.updateState(this.getStateKey(),i,e,n)},_initSizeOptions:function(){this._setOption("minWidth",parseInt(this._getOption("minWidth"),10)||0),this._setOption("minHeight",parseInt(this._getOption("minHeight"),10)||0);var t=this._getOption("maxWidth"),i=this._getOption("maxHeight");this._setOption("maxWidth",void 0!==t&&t!==1/0?parseInt(t,10):1/0),this._setOption("maxHeight",void 0!==i&&i!==1/0?parseInt(i,10):1/0)},_initContainer:function(t){var i;if(t&&t.nodeType)i=$(t);else if("element"in t)if("string"==typeof t.element){var e=t.element;if(i=$("#"+t.element),0===i.length)throw new Error("Вы пытаетесь создать элемент в несуществующем контейнере! Необходимо создать контейнер с указанным id = "+e)}else if("jquery"in t.element)i=t.element;else if(t.element.nodeType)i=$(t.element);if(i){var n="jquery"in i?i[0]&&i[0].wsControl:i.wsControl;if(n&&n!==this)a.resolve("ILogger").error("Control","Вы пытаетесь привязать компоненту (id: "+this.getId()+", module: "+this._moduleName+", "+"name: "+this.getName()+") элемент, который уже привязан к другому компоненту (id: "+this.getId()+" , module: "+n._moduleName+", "+"name: "+n.getName()+")")}this._container=i},_isHeightDependentOnWidth:function(){return false},_removeContainer:function(){if(this._isCorrectContainer())this._container.empty().remove().get(0).wsControl=null},destroy:function(){if(this._container&&this._container.unbind)this._container.unbind();if(this._savedConfigsMaps)for(var t=0;t<this._savedConfigsMaps.length;t++)if(this._savedConfigsMaps[t])p.removeConfigStringDataFromStorage(this._savedConfigsMaps[t]);if(this._savedConfigs=null,this._savedConfigsMaps=null,this.isActive())this._isControlActive=false,this._notify("onFocusOut",true);if(this._removeContainer(),this._invalidateParentCache(),l.deleteCommandsForObject(this),A.remove(this),this._parent&&this._parent.unregisterChildControl)this._parent.unregisterChildControl(this);if(this._getOption("element"))this._setOption("element",null);if(this._parent=null,this._owner=null,this._userData=void 0,this._batchUpdateData={},this._clickState.target=null,this._getOption("saveState"))this.unsubscribe("onStateChanged",this._stateChangeHandler),f.removeState(this,false);i.destroy.apply(this,arguments),w.superclass.destroy.apply(this,arguments)},setActive:function(t,i,e,n){var s=this._isControlActive,o;if(this._isControlActive=t,this._updateActiveStyles(),this._isCorrectContainer())if(t){if(t!==s){if(this._callOnFocusInside(),o=this.getParent(),o)o.activate(this);if(this._isControlActive)this._notify("onFocusIn")}else if(this._isCanShowExtendedTooltip()&&this._tooltipSettings.handleFocus)this._showExtendedTooltip();if(this._isControlActive&&!e)if(_.isMobileSafari)b(this);else u.runBatchedDelayedAction("Control.focus",[this])}else if(t!==s)if(this._notify("onFocusOut",false,n),n){var a=function(t){return t===o};if(o=this.getParent(),o)if(!n.findParent(a))if(n!==o)o.setActive(false,void 0,void 0,n);else o._activeChildControl=-1,o._activatedWithTabindex=false}else if(o=this.getParent(),o)o.setActive(false),o._activeChildControl=-1,o._activatedWithTabindex=false},_hasMarkup:function(){return this._isCorrectContainer()&&"true"===this._container.attr("hasMarkup")},isVisible:function(){return this._isVisible},setVisible:function(t){this.toggle(t)},_checkDelayedRecalk:function(){var t=u;if(t._needDelayedRecalk(this))t._doDelayedRecalk(this)},_getLinkedLabelLow:o(function(){var t=this._container.parent(),i=this._getOption("name"),e;if(t.hasClass("ws-Label"))e=t.find(".ws-Label-title:first");else if(i){if(e=t.find('label[for="fld-'+i+'"]').parent(),0===e.length&&t.hasClass("ws-labeled-control"))e=t.find("label:first")}else if(t.hasClass("ws-labeled-control"))e=t.find("label:first");return e&&e.length>0?e:null},"_getLinkedLabelLow"),_hasLinkedLabel:function(){return!!this._getLinkedLabelLow()},_getLinkedLabel:function(){return this._getLinkedLabelLow()},getOwnerId:function(){var t=this.getOwner();return t instanceof w?t.getId():null},setOwner:function(t){if(t instanceof w)this._owner=t;else this._setOption("owner",t),this._owner=null},makeOwnerName:function(){var t=this.findParent(function(t){if(n.instanceOfModule(t,"Deprecated/Controls/TabTemplatedArea/TabTemplatedArea")&&!t.getContainer().hasClass("ws-tabs-generated"))return false;return n.instanceOfModule(t,"Lib/Control/TemplatedAreaAbstract/TemplatedAreaAbstract")});return[t&&t.getCurrentTemplateName(),this.getName()].join("/")},getMinSize:function(){return{minHeight:this.getMinHeight(),minWidth:this.getMinWidth()}},_getAutoHeight:function(){return this._container.outerHeight()},_getAutoWidth:function(){return this._container.outerWidth()},_getFixedHeight:o(function(){return this._container.outerHeight()},"_getFixedHeight"),_getFixedWidth:o(function(){return this._container.outerWidth()},"_getFixedWidth"),getMinHeight:function(){if(this._container&&this.isVisible()){var t,i=this._getOption("autoHeight");if("Stretch"===this._verticalAlignment)t=i?this._calcMinHeight():0;else if(i)t=this._getAutoHeight();else t=this._height&&"100%"!==this._height&&"auto"!==this._height?parseInt(this._height,10):this._getFixedHeight();if(t>this._getOption("maxHeight"))t=this._getOption("maxHeight");if(t<this._getOption("minHeight"))t=this._getOption("minHeight");if(this._margins["top"])t+=this._margins["top"];if(this._margins["bottom"])t+=this._margins["bottom"];return t}return 0},_calcMinHeight:function(){return this._getOption("minHeight")},_calcMinWidth:function(){return this._getOption("minWidth")},getMinWidth:function(){if(this._container&&this.isVisible()){var t,i=this._getOption("autoWidth");if("Stretch"===this._horizontalAlignment)t=i?this._calcMinWidth():0;else if(this._getOption("autoWidth"))t=this._getAutoWidth();else t=this._width&&"100%"!==this._width&&"auto"!==this._width?parseInt(this._width,10):this._getFixedWidth();if(t>this._getOption("maxWidth"))t=this._getOption("maxWidth");if(t<this._getOption("minWidth"))t=this._getOption("minWidth");if(this._margins["left"])t+=this._margins["left"];if(this._margins["right"])t+=this._margins["right"];return t}return 0},getAlignment:function(){return{horizontalAlignment:this._horizontalAlignment,verticalAlignment:this._verticalAlignment}},isSubControl:function(){return this._getOption("subcontrol")},initializeProperty:function(t){var i="initialize"+O(t);if("function"===typeof this[i])this[i]();else a.resolve("ILogger").error("Control",'Метод initializeProperty вызвали для несуществующего свойства "'+t+'" (не определено соответствующего ему метода '+i+' ) "')}})).beforeExtend=x,A={_storage:{},_waitingChildren:{},_waitingChildrenByName:{},_storageWithParentName:{},store:function(t){var i=false;if(t instanceof w){if(this._storage[i=t.getId()]=t,this._waitingChildren[i])try{this._waitingChildren[i].callback(t)}finally{delete this._waitingChildren[i]}var e=t.getName(),n=t.makeOwnerName().split("/")[0],s;if(this._waitingChildrenByName[e]&&!this._waitingChildrenByName[e].isReady())try{this._waitingChildrenByName[e].callback(t)}finally{delete this._waitingChildrenByName[e]}if(this._storageWithParentName[n]=this._storageWithParentName[n]||{},s=this._storageWithParentName[n],s[e]instanceof h){var o=s[e];s[e]=t,o.callback(t)}else s[e]=t}return i},remove:function(t){if(t instanceof w){var i=t.getId(),e=t.getName(),n=t.makeOwnerName().split("/")[0];if(i in this._storage)this._storage[i]=null,delete this._storage[i];if(i in this._waitingChildren)this._waitingChildren[i]=null,delete this._waitingChildren[i];if(e in this._waitingChildrenByName)this._waitingChildrenByName[e]=null,delete this._waitingChildrenByName[e];if(n in this._storageWithParentName)this._storageWithParentName[n][e]=null,delete this._storageWithParentName[n][e]}},get:function(t){if(void 0===this._storage[t])throw new Error("ControlStorage : id = '"+t+"' not stored");return this._storage[t]},contains:function(t){return void 0!==this._storage[t]},getByName:function(t,i){for(var e in this._storage)if(this._storage.hasOwnProperty(e))if(this._storage[e].getName()==t){if(i&&!(this._storage[e]instanceof i))continue;return this._storage[e]}throw new Error("ControlStorage : control with name '"+t+"' is not stored")},getWithParentName:function(t){var i=t.split("/"),e=i[1],n=i[0];if(n in this._storageWithParentName&&e in this._storageWithParentName[n])return this._storageWithParentName[n][e];throw new Error("ControlStorage : control with name '"+e+"' is not stored in parent with name "+n)},containsByName:function(t){for(var i in this._storage)if(this._storage.hasOwnProperty(i))if(this._storage[i].getName()==t)return true;return false},waitChild:function(t){if(t in this._storage)return(new h).callback(this._storage[t]);else return t in this._waitingChildren?this._waitingChildren[t]:this._waitingChildren[t]=new h},waitChildByName:function(t){if(this.containsByName(t))return(new h).callback(this.getByName(t));else return t in this._waitingChildrenByName?this._waitingChildrenByName[t]:this._waitingChildrenByName[t]=new h},waitWithParentName:function(t){var i;if(t.indexOf("/")>-1){i=t.split("/"),this._storageWithParentName[i[0]]=this._storageWithParentName[i[0]]||{};var e=this._storageWithParentName[i[0]];if(e[i[1]]instanceof w)return(new h).callback(e[i[1]]);else if(e[i[1]]instanceof h)return e[i[1]];else return e[i[1]]=new h}return A.waitChild(t)},getControls:function(){return this._storage}},window)f.init();var N=t.mixin(w,d);return N.beforeExtend=x,{Control:w,DataBoundControl:N,ControlStorage:A,ControlBatchUpdater:u}});
//# sourceMappingURL=Control.js.map
define("View/config",["Core/helpers/Object/isPlainObject","Core/core-instance"],function(t,r){return{calculators:[{type:"model_record",is:function t(n){return r.instanceOfModule(n,"WS.Data/Entity/Model")},calculator:function t(r,n){var e=n.get(r);if(r in n&&!e)return n[r];return n.get(r)}}],iterators:[{type:"recordset",is:function t(r){return r&&"[object Function]"===Object.prototype.toString.call(r.each)},iterator:function t(r,n){r.each(n)}},{type:"array",is:function t(r){return r instanceof Array},iterator:function t(r,n){var e,o=r.length;for(e=0;e!==o;e++)n(r[e],e)}},{type:"object",is:function r(n){return t(n)},iterator:function t(r,n){for(var e in r)if(r.hasOwnProperty(e))n(r[e],e)}},{type:"int",is:function t(r){return parseInt(r)===r},iterator:function t(r,n){for(var e=0;e<r;e++)n(e,e)}}],ignored:["comment"]}});
//# sourceMappingURL=config.js.map
(function(){"use strict";var r=function(){return this||(0,eval)("this")}(),e=r.define||r.requirejs&&r.requirejs.define||requirejsVars&&requirejsVars.define,t=/http[s]?:\/\//,s=require;e("js",["text","Core/pathResolver","Core/constants","Core/IoC","Core/polyfill"],function(e,o,i,n){var a=/^\//,f=/\.js$/;return{load:function(a,f,u,c){var d;if(i.isBrowserPlatform&&a&&a.startsWith&&n.has("ILogger")&&(a.startsWith("Core/")||a.startsWith("Deprecated/")&&!a.startsWith("Deprecated/Controls")||a.startsWith("Transport/")))n.resolve("ILogger").error("js!",'Модуль "'+a+'" следует подключать без использования плагина js. Замените инструкцию "js!'+a+'" на "'+a+'".');try{d=[o(a,"js")]}catch(r){return u.error(r)}if(i.isNodePlatform&&t.test(d[0])){var h=function(r){u.fromTextFixed?u.fromTextFixed(r):u.fromText(r)};h.error=function(r){u.error(r)},e.load(d[0],f,h,c)}else{if(i.isNodePlatform&&d[0]!==a&&r.isMochaRunned)s(d[0]);if(0===a.indexOf("SBIS3"))d.push("i18n!"+a);f(d,function(r){u(r)},function(r){u.error(r)})}}}})})();
//# sourceMappingURL=js.js.map
define("Core/WindowManager",["Core/Abstract","Core/ControlBatchUpdater","Core/core-instance","Core/constants"],function(i,t,n,e){var s,o;return s=new(o=i.extend({_windows:[],_tabEventEnable:true,_focusIn:void 0,_focusOut:void 0,_focusControlled:false,_acquireIndex:1e3,_acquiredIndexes:[],_modalIndexes:[],_maximizedIndexes:[],_hintIndexes:[],_visibleIndexes:[],_windowsStack:[],_currentVisibleIndicator:null,_zIndexChangedFlag:false,_zIndexChanged:0,pushUp:function(i){var t=i.isMovableToTop(),n=false,e,s,o=[];if(true===t)return this.popBack(i),this._windowsStack.push({visible:function(){return i.isVisible()},window:i}),true;else if(null===t){for(e=this._windowsStack.length-1;e>=0&&!n;--e)if(s=this._windowsStack[e],!n&&s.window._isIndicator)o.push(s),n=s.window===i,this._windowsStack.splice(e,1);for(e=o.length-1;e>=0;--e)this._windowsStack.push(o[e]);return true}else if(false===t){if(!i._isIndicator)return false;e=0;while(e<this._windowsStack.length&&null!==n){if(s=this._windowsStack[e],false===n)n=s.window===i;if(true===n&&s.window._isIndicator)if(s.window!==i&&s.visible())n=null,Array.prototype.splice.apply(this._windowsStack,[e,0].concat(o));else o.push(this._windowsStack.splice(e,1)[0]),e--;e++}}return false},popBack:function(i){this._windowsStack=this._windowsStack.filter(function(t){return t.window!==i})},popAndShowNext:function(i){if(!i._isIndicator)this.popBack(i);for(var t=false,n=this._windowsStack,e=n.length-1;e>=0;e--){var s=n[e];if(s.window._isIndicator&&s.window._isIndicatorVisible){if(s.window!==i)if(!t){if(s.window._myIndicator)s.window._myIndicator.show()}else if(this._pendingIndicator===s.window._myIndicator);else s.window.show(true),this.setCurrentVisibleIndicator(s.window._myIndicator),s.window._myIndicator._isVisible=true;return}else if(s.visible())if(t=true,!i._isIndicator)break}},getStack:function(){return this._windowsStack},getCurrentVisibleIndicator:function(){return this._currentVisibleIndicator},setCurrentVisibleIndicator:function(i){this._currentVisibleIndicator=i},acquireZIndex:function(i,t,n){this._acquireIndex+=10;var e=this._acquireIndex;if(this._acquiredIndexes.push(e),i)this._modalIndexes.push(e);if(t)this._maximizedIndexes.push(e);if(n)this._hintIndexes.push(e);return this._notifyZIndexChanged(),e},_notifyZIndexChanged:function(){function i(i){return n._visibleIndexes&&-1!==n._visibleIndexes.indexOf(i)}function t(){var t=s.getDefaultZIndex(),n;return n=this._modalIndexes.concat(this._maximizedIndexes).concat(this._hintIndexes).reduce(function(t,n){return i(n)?Math.min(n,t):t},1/0),this._acquiredIndexes.forEach(function(e){if(i(e))if(e>t&&e<n)t=e}),t}var n=this;if(!this._zIndexChangedFlag)this._zIndexChangedFlag=true,setTimeout(function(){n._zIndexChangedFlag=false;var i=t.apply(n);if(i!=n._zIndexChanged)n._zIndexChanged=i,n._notify("zIndexChanged",i)},0)},setVisible:function(i){if(-1==this._visibleIndexes.indexOf(i))this._visibleIndexes.push(i),this._notifyZIndexChanged()},setHidden:function(i){var t=this._visibleIndexes.indexOf(i);if(t>=0)this._visibleIndexes.splice(t,1),this._notifyZIndexChanged()},getDefaultZIndex:function(){return 1e3},releaseZIndex:function(i){["acquired","visible","modal","maximized","hint"].forEach(function(t){var n=this["_"+t+"Indexes"]||[],e=n.indexOf(i);if(e>=0)n.splice(e,1)}.bind(this)),this._acquireIndex=Math.max.apply(Math,[this.getDefaultZIndex()].concat(this._acquiredIndexes)),this._notifyZIndexChanged()},getMaxVisibleZIndex:function(){var i=0;return this._visibleIndexes.forEach(function(t){if(t>i&&-1!=this._modalIndexes.indexOf(t))i=t},this),i},isMaximizedWindowExists:function(){return!!s._maximizedIndexes.length},init:function(){if(o.superclass.init.call(this),"undefined"!==typeof $)$(document).ready(this.postInit.bind(this));this._publish("onAreaFocus","zIndexChanged")},postInit:function(){$(function(){this._createFirstElementToFocus(),this._createLastElementToFocus()}.bind(this))},_findActiveWindow:function(){var i=s.getActiveWindow(true);if(i)return i=i.findParent(function(i){return n.instanceOfModule(i,"Lib/Control/FloatArea/FloatArea")})||i.getTopParent(),i;return},_createFirstElementToFocus:function(){if(this._focusIn)this._focusIn.remove();var i=this,t=function(){if(!i._focusControlled){var t=i._findActiveWindow();if(t)t.activateFirstControl()}};if(e.compat)this._focusIn=$('<a class="ws-focus-in" tabindex="1"></a>').prependTo("body").bind("focusin",t)},_createLastElementToFocus:function(){if(this._focusOut)this._focusOut.remove();var i=this;if(e.compat)this._focusOut=$('<a class="ws-focus-out" tabindex="0"></a>').appendTo("body")},focusToFirstElement:function(){if(this._focusIn)this._focusControlled=true,this._focusIn.focus(),this._focusControlled=false},focusToLastElement:function(){if(this._focusOut){if(this._focusControlled=true,e.compat)$("body").append(this._focusOut);this._focusOut.focus(),this._focusControlled=false}},_findWindowIndex:function(i){var t,n=this._windows,e=n.length;for(t=0;t!==e;t++)if(n[t]===i)return t;return-1},_checkRegisterBatchUpdaterActions:function(){this._checkRegisterBatchUpdaterActions=function(){};var i=this;t.registerDelayedAction("WindowManager.activateControl",function(){var t=$(document.activeElement).wsControl();if(i._doActivateControl||!document.activeElement||$(document.activeElement).is(document.body)||t&&!t.isVisibleWithParents()){i._doActivateControl=false;var n=i.getActiveWindow(true);if(n)n.onBringToFront()}})},addWindow:function(i){if(-1===this._findWindowIndex(i)){var t=this;if(this._checkRegisterBatchUpdaterActions(),this._windows.push(i),n.instanceOfMixin(i,"Lib/Control/AreaAbstract/AreaAbstract.compatible"))i.subscribe("onActivate",function(i){if(i.getTarget()===this)t.onActivateWindow(this)})}},removeWindow:function(i){this.deactivateWindow(i,function(i){if(-1!==i)this._windows.splice(i,1)}.bind(this))},deactivateWindow:function(i,n){var e=this._findWindowIndex(i);if(-1!==e)n(e),t.runBatchedDelayedAction("WindowManager.activateControl");else n(-1)},onActivateWindow:function(i){if(i)i.setActivationIndex(this.getMaxActivisionIndex()+1),this._notify("onAreaFocus",i)},disableTabEvent:function(){this._tabEventEnable=false},enableTabEvent:function(){this._tabEventEnable=true},getTabEvent:function(){return this._tabEventEnable},getMaxZWindow:function(i){var t=-1,n,e,s,o=this._windows,a=o.length,d;for(e=0;e!==a;e++)if(d=o[e],(!i||i(d))&&d.isShow())if(s=d.getZIndex(),s>t)t=s,n=d;return n},getMaxZModalWindow:function(){return this.getMaxZWindow(function(i){return i.isModal()})},getMaxZIndex:function(){var i=this.getMaxZWindow();return i&&i.getZIndex()||1e3},_isWindowAcceptFocus:function(i){var t=i;while(t){if(!t.canAcceptFocus())return false;if(n.instanceOfMixin(t,"Lib/Mixins/LikeWindowMixin"))break;t=t.getParent()}return true},_isWindowActivable:function(i){return i.isVisibleWithParents()},_getActiveWindow:function(i){var t=-1,n=void 0,e,s,o,a=this._windows,d=a.length;for(e=0;e!==d;e++)if(o=a[e],!i||i(o))if(s=o.getActivationIndex(),s>t)t=s,n=o;return n},getActiveWindow:function(i,t){var n=i?this._isWindowAcceptFocus:t?function(){return true}:this._isWindowActivable;return this._getActiveWindow(n.bind(this))},getMaxActivisionIndex:function(){var i=this.getActiveWindow(false,true);return i&&i.getActivationIndex()||0},disableLastActiveControl:function(i){var t=this.getActiveWindow();if(t){var n=t.getActiveChildControl();if(n){if(n.getParent()===t&&n!==i)n.setActive(false,void 0,void 0,i)}else t.setActive(false,void 0,void 0,i)}}}))});
//# sourceMappingURL=WindowManager.js.map
(function(){"use strict";var e=function(){return this||(0,eval)("this")}();function r(e){var r=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return r?decodeURIComponent(r[1]):void 0}function n(e){return 0===e.indexOf("SBIS3.CONTROLS/")||0===e.indexOf("Controls/")}function t(e){var t=window.wsConfig,i=r("thmname"),s;if(!t)return"";if(n(e))if(t.themeName)return"__"+t.themeName;else if(i)return"__"+i;else return"";else return""}(e.define||e.requirejs&&e.requirejs.define||requirejsVars&&requirejsVars.define)("css",["native-css","Core/pathResolver","Core/detection"],function(e,r){return{load:function(n,i,s,u){if(u.testing||false===i.isBrowser)s(true);else{var o=r(n,"css"),f=t(n);if(f)return void s(null);if(".css"==o.substr(o.length-4,4))o=o.substr(0,o.length-4);o+=f,e.load(o,i,s,u)}}}})})();
//# sourceMappingURL=css.js.map
define("Transport/HTTPError",["Core/core-extend"],function(r){function t(r,t,e,s,i){this.message=r||"",this.details=i||"Мы знаем об этом и уже исправляем. Попробуйте заглянуть сюда через 15 минут.",this.name="HTTP error",this.httpError=void 0===t?"":t,this.url=e||"",this.payload=s||"",this.processed=false}function e(r,t){this.url=t||"",this.message=r||"",this.processed=false,this._isOfflineMode=true}return r.classicExtend(t,Error),r.classicExtend(e,Error),t.prototype.toString=function(){return[this.name,": ",this.message,"; httpError: ",this.httpError,"; url: ",this.url].join("")},t.offlineModeError=function(r,t){return new e(r,t)},t});
//# sourceMappingURL=HTTPError.js.map
define("Lib/Mixins/BreakClickBySelectMixin",["Core/detection"],function(e){return{_hasSelectionInContainer:function(){var n=this._getSelection();if(e.firefox)if(n&&n.focusNode instanceof Element)if($(n.focusNode).css("display")&&"Range"===n.type&&""===n.toString())return false;return n&&!n.isCollapsed&&!!this._container.find(n.focusNode).length},_getSelection:function(){return window.getSelection?window.getSelection():null},around:{_onClickHandler:function(e,n){if(!this._hasSelectionInContainer()||"none"===$(n.target).css("user-select"))e.call(this,n)}}}});
//# sourceMappingURL=BreakClickBySelectMixin.js.map
define("Core/helpers/Hcontrol/getElementCachedDim",function(){return function(e,n){var i=e.data("cachedSize");if(!i)i={},e.data("cachedSize",i);if(!(n in i))i[n]=e[n]();return i[n]}});
//# sourceMappingURL=getElementCachedDim.js.map
define("Lib/Control/AreaAbstract/AreaAbstract",["Core/core-extend","Lib/Control/AreaAbstract/AreaAbstract.compatible","Core/core-functions","Core/ControlBatchUpdater","Core/core-clone","Core/helpers/Object/find","Core/helpers/Hcontrol/getElementCachedDim","Core/WindowManager","Core/IoC","Core/ParallelDeferred","Core/Deferred","Core/constants","Lib/Control/Control","Core/core-instance","Core/core-debug","Core/detection","Core/CommandDispatcher","Lib/Mixins/BreakClickBySelectMixin","Transport/HTTPError","Core/helpers/Object/isPlainObject","Core/helpers/Array/findIndex","Core/Context","css!Lib/Control/AreaAbstract/AreaAbstract","i18n!Lib/Control/Control"],function(t,e,i,n,r,o,s,a,l,h,d,c,u,_,f,C,g,p,b){"use strict";function v(t,e){if(t&&e){var i=+t.tabindex,n=+e.tabindex;if(isNaN(i)||-1==i)return 1;if(isNaN(n)||-1==n)return-1;return i-n}else return 0}var y=t({},{$protected:{_group:[]},$constructor:function(t){this._group=t},_setEnabled:function(t){},setVisible:function(t){},getGroupContainers:function(){},destroy:function(){this._group=null}}),m=null,A=null,x={_hasSelectionInContainer:p._hasSelectionInContainer,_getSelection:p._getSelection,_onClickHandler:p.around._onClickHandler},B=u.Control.extend([e,x],{_$context:null,_$independentContext:false,_$contextRestriction:"",_$record:false,_$modal:false,_$validateIfHidden:false,_$ignoreTabCycles:true,_$groups:null,_$handleFocusCatch:false,_$currentTemplate:"",_$isRelativeTemplate:false,_$children:[],_$_doGridCalculation:false,_moduleName:"Lib/Control/AreaAbstract/AreaAbstract",_horizontalAlignment:"Left",_pending:null,_pendingTrace:null,_waiting:null,_groupInstances:null,_activeChildControl:-1,_activatedWithTabindex:true,_childControls:null,_childNonControls:null,_childsMapName:null,_childsMapId:null,_childContainers:null,_childsTabindex:false,_childsMapNameCache:null,_childsMapIdCache:null,_childsSizes:null,_maxTabindex:0,_dChildReady:null,_keysWeHandle:null,_resizer:null,_toolbarCount:null,_defaultButton:null,_activationIndex:0,_opener:void 0,_isModal:false,_isReady:false,_waitersByName:null,_waitersById:null,_onDestroyOpener:null,_isInitComplete:false,constructor:function t(e,i){e=e||{},this._$groups={},this._pending=this._pending||[],this._pendingTrace=this._pendingTrace||[],this._waiting=this._waiting||[],this._groupInstances=this._groupInstances||{},this._childControls=this._childControls||[],this._childNonControls=this._childNonControls||[],this._childsMapName=this._childsMapName||{},this._childsMapId=this._childsMapId||{},this._childContainers=this._childContainers||[],this._childsSizes=this._childsSizes||{},this._childsMapNameCache=this._childsMapNameCache||{},this._childsMapIdCache=this._childsMapIdCache||{},this._keysWeHandle=this._keysWeHandle||[c.key.tab,c.key.enter],this._toolbarCount={top:0,right:0,bottom:0,left:0},this._waitersByName={},this._waitersById={},this._baseTabIndex=e.tabindex,t.superclass.constructor.call(this,e,true);var n=this;if(this._publish("onResize","onActivate","onBeforeShow","onAfterShow","onBeforeLoad","onAfterLoad","onBeforeControlsLoad","onBatchFinished"),this._isModal=this._getOption("modal"),this._dChildReady=new h,!this._isCorrectContainer()){if(this._container=$("<div></div>",{tabindex:this._getOption("tabindex")>=0?0:-1}).bind("click touchstart touchmove touchend",this._onActionHandler.bind(this)),this._container[0].wsControl=this,this._getOption("cssClassName"))this._container.addClass(this._getOption("cssClassName"));this._initKeyboardMonitor()}if(this._container.bind("mousedown.activate",function(){if(!$.event.props)$.event.props=[];if(!$.event.props["ws-area-activated-id"])n._container.trigger("container-clicked"),$.event.props["ws-area-activated-id"]=n.getId()}),c.$doc.bind("mousedown."+this.getId(),function(){if(!$.event.props)$.event.props=[];if(n.getId()==$.event.props["ws-area-activated-id"])$.event.props["ws-area-activated-id"]=null}),C.firefox)this._container.bind("mousedown.fxselect",function(t){if(t.ctrlKey)t.preventDefault()});if(!this.getParent())this._subscribeToWindowResize();if(this._dChildReady.getResult().addCallback(function(){n._childNonControls=n._container.children(c.NON_CTRL)}),this.setOpener(e&&e.opener),g.declareCommand(this,"registerDefaultButtonAction",function(){n.sendCommand("resizeYourself")}),g.declareCommand(this,"registerDefaultButtonAction",function(t,e){if(n._defaultButton)return true;return n._registerDefaultButtonAction(t,e),!!_.instanceOfMixin(n,"Lib/Mixins/LikeWindowMixin")}),g.declareCommand(this,"unregisterDefaultButtonAction",function(){if(!A)A=n;if(n._defaultButton&&!m)m=n._defaultButton;else if(n===m)return true;else if(n!==A&&(!n._defaultButton||m!==n._defaultButton))return m=null,A=null,true;n._unregisterDefaultButtonAction();var t=!!_.instanceOfMixin(n,"Lib/Mixins/LikeWindowMixin")||!!_.instanceOfModule(n,"SBIS3.ONLINE.OnlineBaseInnerMinCoreView")||!n.getParent();if(t)m=null,A=null;return t}),!i)this._initInstance()},_subscribeToWindowResize:function(){c.$win.bind("resize."+this.getId(),this._onResizeHandler.bind(this))},addPendingOperation:function(t){var e=!!(t&&t instanceof d);if(e)this._pending.push(t),this._pendingTrace.push(f.getStackTrace()),t.addBoth(this._checkPendingOperations.bind(this));return e},_finishAllPendingsWithSave:function(){this._pending.forEach(function(t){t.callback(true)})},getAllPendingInfo:function(){var t=[],e=this;return this._pending.forEach(function(i,n){t.push({pending:i,trace:e._pendingTrace[n]})}),t},waitAllPendingOperations:function(t){if(t&&t instanceof d&&!t.isReady()){if(0===this._pending.length)t.callback();else this._waiting.push(t);return true}else return false},_checkPendingOperations:function(t){var e=this._pending.length,i;if(i=this._pending.filter(function(t){return t.isReady()}),i=i.map(function(t){return t.getResult()}),i.length==e){this._pending=[],this._pendingTrace=[];while(this._waiting.length>0)this._waiting.pop().callback(i)}return t},init:function(){a.addWindow(this),B.superclass.init.apply(this,arguments),this._subscribeOnReady(),this._runInBatchUpdate("AreaAbstract - init - "+this._id,function(){return d.callbackWrapper(this._loadDescendents(),this._childrenLoadCallback.bind(this))});var t=this._baseTabIndex;if(0===t)t=-1;if(void 0!==t)this._getElementToFocus()[0].setAttribute("tabindex",t),this._container[0].setAttribute("tabindex",t)},_buildMarkup:function(t,e,i,n,r){return e.className=e.className||"",B.superclass._buildMarkup.apply(this,arguments)},_keyboardHover:function(t){return this._oldKeyboardHover.apply(this,arguments)},activateFirstControl:function(t){return this._oldActivateFirstControl.apply(this,arguments)},activateLastControl:function(t){return this._oldActivateLastControl.apply(this,arguments)},detectNextActiveChildControl:function(t,e,i){return this._oldDetectNextActiveChildControl.apply(this,arguments)},_childrenLoadCallback:function(){this._notify("onBeforeShow"),this._notifyBatchDelayed("onAfterShow")},_createCheckDestroyedFunc:function(t,e,i){var n=this;return function(r){if(n.isDestroyed()){var o=new Error(t+": "+rk("Область")+" "+e+", id = "+n._id+rk("была уничтожена до начала создания дочерних контролов."));if(r)o.silent=true,i(o,true);else throw o}return n.isDestroyed()}},_makeLoadErrorHandler:function(t){return function(e){if(!e.silent){var i=e.message,n=$("#onlineChecker"),r=n.find("#warningText"),o=window.navigator.onLine;if(e instanceof b)i+=", "+e.url;if(l.resolve("ILogger").error("AreaAbstract",rk("Ошибка при загрузке дочерних компонентов")+" ("+i+")",e),o)r.text(rk("Произошла ошибка при попытке загрузки ресурса. Пожалуйста, обновите страницу")),n.css("display",""),n.css("zIndex",9999)}try{var s=new d;s.addErrback(function(t){return t}),s.errback(e),t.push(s),t.done()}catch(t){}return e}.bind(this)},_createChildrenLoadCallback:function(){var t=this,e=new h,i=this._dChildReady.getResult().addCallback(this._templateInnerCallback.bind(this)).createDependent();return e.getResult().addErrback(function(e){var i=new d;return t._dChildReady.push(i.errback(e)).done(),e}).addCallback(function(){return t._dChildReady.done(),i}),e},_showControls:function(){this._notify("onAfterLoad")},_collectControlsToBuild:function(t,e){var i=this._getOption("children");if(!i.length&&t)i=t.getControls(e,this.getContainer());return i},_getControlsToBuild:function(t,e){var i=this._collectControlsToBuild(t,e);if(!t||t.needSetZindexByOrder())i=i.map(function(t,e){return t.zIndex="zIndex"in t?t.zIndex:e+1,t});return i=i.sort(v),i},_loadControls:function(t,e,n,o,s){return this._runInBatchUpdate("_loadControls - "+this._id,function(){var o=this,s=this._getControlsToBuild(e,n),a=/js!/;return s=r(s).map(function(t){var e=t.type,n,r,o=["Deprecated","Lib"],s=e.indexOf("/")>0?e.split("/")[0]:false;if(a.test(e)||s&&(o.indexOf(s)>-1||Object.keys(c.modules).some(function(t){return c.modules[t]===s}))||-1===e.indexOf("SBIS3.")&&e.indexOf("/")>-1&&-1==e.indexOf("Control/"))r={ctor:require(e),config:t};else r={ctor:(n=i.extractComponentPath(e)).isModule?require("js!"+n.moduleName):void 0,config:t};return r}),s.forEach(function(t){var i=o._container[0],n=t.config,r=t.ctor,s;try{if(n.element=$("#"+n.id,i),n.parent=o,n.linkedContext=o._context,n.currentTemplate=e,n.supportOldJinneeMarkup=true,s=new r(n),"function"===typeof s.getReadyDeferred)o._dChildReady.push(s.getReadyDeferred());var a=s.getAlignment();if("Stretch"!=a.horizontalAlignment||"Stretch"!=a.verticalAlignment)o._doGridCalculation=true}finally{}}),t.done(),t})},_loadDescendents:function(){return this._runInBatchUpdate("_loadDescendents - "+this._id,function(){var t=this._createChildrenLoadCallback(),e=this._makeLoadErrorHandler(t),i=this._getOption("currentTemplate"),n,r=this._createCheckDestroyedFunc("_loadDescendents",this._getOption("name"),e);this._notify("onBeforeLoad"),this._notify("onBeforeControlsLoad");try{this._isPage=!!(i&&i.isPage()),this._loadControls(t,i,this.getId(),r,e)}catch(t){n=i&&i.getName?i.getName():"<неизвестном>",t.message+=" - в шаблоне "+n,e(t)}return t.getResult().createDependent()})},isAllReady:function(){for(var t=this.getChildControls(),e=0;e<t.length;++e)if(t[e].isReady&&!t[e].isReady())return false;return true},_templateInnerCallbackBeforeReady:function(){},_templateInnerCallback:function(){this._isReady=true,this._initResizers(),n.runBatchedDelayedAction("resizeYourself"),this._templateInnerCallbackBeforeReady(),this._notifyOnReady(),this._showControls()},_notifyOnReady:function(){this._notify("onReady"),this._container.trigger("onReady")},_onClickHandler:function(t){x._onClickHandler.call(this,function(){if(this._getOption("activableByClick"))this.onBringToFront();this._notify("onClick",t)},t)},moveToTop:function(){},_restoreSize:function(){if(this._width||this._height)this._container.css({width:this._getOption("autoWidth")||"Stretch"===this._horizontalAlignment?"auto":this._width,height:this._getOption("autoHeight")||"Stretch"===this._verticalAlignment?"auto":this._height})},setSize:function(t){if(this._getOption("autoHeight"))t["height"]="auto";else this._getFixedHeight.reset();if(!this._getOption("autoWidth"))this._getFixedWidth.reset();this._container.css(t),this._resizeChilds(),this._notify("onResize")},getNamedGroup:function(t){if(t in this._getOption("groups"))if(t in this._groupInstances)return this._groupInstances[t];else{for(var e=[],i=this._getOption("groups")[t],n=0,r=i.length;n<r;n++)try{e.push(this.getChildControlById(i[n]))}catch(t){}return this._groupInstances[t]=new y(e)}else return null},getNearestChildControlByName:function(t,e){var i={},n=[],r,o=function(t){if(t&&!i[t.getId()])i[t.getId()]=true,n.push(t)};if(e){o(this);while(n.length){var s=n.shift();if(s.hasChildControlByName){if(s.hasChildControlByName(t))return s.getChildControlByName(t)}else if(s.getName&&s.getName()===t)return s;if(r=s.getParent(),r)o(r);if(s.getOpener)o(s.getOpener());if(s._childContainers)for(var a=0,l=s._childContainers.length;a<l;++a)o(s._childContainers[a])}}else{r=this;while(r){if(r.hasChildControlByName)if(r.hasChildControlByName(t))return r.getChildControlByName(t);r=r.getParent()||r.getOpener&&r.getOpener()}}return},getImmediateChildControls:function(){for(var t=[],e=0;e<this._childControls.length;e++)if(this._childControls[e])t.push(this._childControls[e]);return t},_isActiveByTabindex:function(){return this._childsTabindex&&this._activeChildControl in this._childsTabindex&&this._childControls[this._childsTabindex[this._activeChildControl]]},isModal:function(){return this._isModal},_destroySuperClass:function(){B.superclass.destroy.apply(this,arguments)},destroyChild:function(t){var e=this._childsMapId[t];if(void 0!==e){var i=this._childControls[e];if(i)this.unregisterChildControl(i),i.destroy()}},disableActiveCtrl:function(t){var e=this.getActiveChildControl();if(e&&e.isActive()){var i=e instanceof B;if(i&&!t||!i)e.setActive(false)}},hide:function(){var t=this.getActiveChildControl(void 0,true);if(t)t._isControlActive=true,t.setActive(false,void 0,void 0,this.getParent());B.superclass.hide.apply(this,arguments)},getToolBarCount:function(t){return this._toolbarCount[t]},increaseToolBarCount:function(t){++this._toolbarCount[t]},setEnabled:function(t){var e=this._getOption("enabled");if(B.superclass.setEnabled.apply(this,arguments),this._getOption("enabled")!==e)this.getImmediateChildControls().forEach(this._setupChildByAreaEnabled,this)},_getAutoHeight:function(){return this._resizer?s(this._resizer,"height"):this._container.outerHeight()},_getAutoWidth:function(){return this._resizer?s(this._resizer,"width"):this._container.outerWidth()},_calcMinHeight:function(){var t,e;if(this._resizer)t=s(this._resizer,"height");else t=Math.max(this._getOption("minHeight"),this._getResizerHeight());return t||0},_calcMinWidth:function(){var t,e;if(this._resizer)t=s(this._resizer,"width");else t=Math.max(this._getOption("minWidth"),this._getResizerWidth());return t||0},getResizer:function(){return this._resizer},_haveAutoSize:function(){return this._getOption("autoHeight")||this._getOption("autoWidth")},_haveStretch:function(){return"Stretch"===this._horizontalAlignment||"Stretch"===this._verticalAlignment},isPage:function(){return this._isPage},hasActiveChildControl:function(){return!!o(this._childControls,function(t){if(t.isActive())return true;if(t instanceof B)return t.hasActiveChildControl()})}});return B.beforeExtend=function(t,e,i){B.prototype._setCompatibleOptions(t,e,i)},B});
//# sourceMappingURL=AreaAbstract.js.map
define("Lib/Control/CompoundControl/CompoundControl",["Core/helpers/random-helpers","Core/core-instance","Core/moduleStubs","Core/EventBus","Core/ParallelDeferred","Lib/Control/AreaAbstract/AreaAbstract","Core/helpers/markup-helpers","Core/ContextBinder","Core/helpers/Hcontrol/getChildContainers","Core/helpers/Hcontrol/replaceContainer","Lib/Control/AttributeCfgParser/AttributeCfgParser","Lib/Control/Control","i18n!Lib/Control/CompoundControl/CompoundControl","Lib/Control/BaseCompatible/BaseCompatible","View/decorators"],function(e,t,n,o,r,i,a,s,l,u){function c(e){if(e.node.removeAttribute)e.node.removeAttribute("config")}function d(e,n,o){var r=e.cfg,i=e.ctor,a=e.hasMarkup,l=this.getLinkedContext(),u,c;if(r.parent&&r.parent.isDestroyed())r.parent=null;if(r.parent&&r.parent._template)if(!r.parent._container||!r.parent.isGoodContainer()||!this._container||!this._container.attr||r.parent._container.find("#"+this._container.attr("id")).length>0)r.parent=null;var d="function"===typeof i.prototype._template;if(d&&t.instanceOfModule(this,"Deprecated/Controls/SwitchableArea/SwitchableAreaItem"))r.parent=null;if(r.linkedContext=this.getLinkedContext(),r.parent=r.parent||this,d){if(c=e.instance,c&&c._eventBusChannel&&c._eventBusChannel.isDestroyed())return void c.destroy();if(c.isBuildVDom()||c.containerIsComponent())c._waitWhileSetParent=true,c.render(),c._waitWhileSetParent=false;if(c.setContext(r.parent.getLinkedContext()),c.setParent(r.parent),!c.iWantVDOM)c.reviveSuperOldControls()}else{if(r&&r.element&&(r.element.wsControl||r.element[0]&&r.element[0].wsControl))return r.element.wsControl||r.element[0]&&r.element[0].wsControl;if(r.element&&r.parent&&r.parent._container)if(!jQuery.contains(document,r.element[0]||r.element)&&jQuery.contains(document,r.parent._container[0]))return;if(u=s.initBinderForControlConfig(r),!a)delete r.bindings,r=u.getConstructorOptions(l,i,r);if(c=new i(r),l=this.getLinkedContext()||l,a)u.bindControl(c,l,"syncControl");else u.bindControl(c,l)}if("function"===typeof c.getReadyDeferred)this._dChildReady.push(c.getReadyDeferred());return c}function h(t,n,r,i,l){var u,c,d;if(u=i?i:t._moduleName,d=global.requirejs.defined("js!"+u)?global.requirejs("js!"+u):global.requirejs(u),t.eventBusId=t.name&&r[t.name]?r[t.name]:e.randomId(),d.prototype&&d.prototype._template)if(n.setAttribute("newconfig",l),t.parent=this,!t._thisIsInstance)if(t.container=window?$(t.element):t.element,t.linkedContext=this.getLinkedContext(),t.container[0]&&t.container[0].wsControl)t._container=window?$(t.element):t.element,t=(c=t.container[0].wsControl)._options;else{var h=s.initBinderForControlConfig(t),p=this.getLinkedContext();if(t.parent&&!("enabled"in t)&&!t.parent.isEnabled()&&false!==t.allowChangeEnable)t.enabled=t.parent.isEnabled(),t.enable=t.parent.isEnabled();var C=t.doNotSetParent;t.doNotSetParent=true,c=new d(t),t.doNotSetParent=C;var f={};f[l]=c,a.mergeConfigStorage(f),p=this.getLinkedContext()||p,h.bindControl(c,p,"syncControl")}else t._container=window?$(t.element):t.element,(t=(c=t)._savedOptions?c._savedOptions:c._options).element=c._container,c._options=t;if(t.name&&!r[t.name])o.channel(t.eventBusId,{waitForPermit:true}),r[t.name]=t.eventBusId;return{cnstr:d,cfg:t,instance:c,cName:i}}var p=i.extend({_$isRelativeTemplate:true,_$autoHeight:true,_isCoreCompound:true,_moduleName:"Lib/Control/CompoundControl/CompoundControl",_createChildOnInitSelector:"",_childEventBusHashMap:null,_cleanupMarkupDataBinding:null,constructor:function e(t){this._childEventBusHashMap=this._childEventBusHashMap||{},e.superclass.constructor.call(this,t,true),this._prepareControlsConfig({selector:this._createChildOnInitSelector}),this._initInstance()},getEventBusOf:function(e){var t=null;if(this._childEventBusHashMap[e]){var n=this._childEventBusHashMap[e];if(o.hasChannel(n))t=o.channel(n)}if(null===t)throw new Error('Component with name "'+e+'" doesn`t exists in CompoundComponent with name "'+this.getName()+'"');else return t},_onSizeChangedBatch:function(){return this._haveAutoSize()&&("Stretch"!==this._horizontalAlignment||"Stretch"!==this._verticalAlignment)},_prepareControlsConfig:function(t){for(var n=(t=t||{}).selector,o=t.container||this._container,r="data-component",i=l(o,n||"["+r+"]"),s,u=[],c,d,p=this._childEventBusHashMap,C,f,m,_,g=null,b,v=0,w=i.length;v<w;v++)if(s=i[v],m=s.getAttribute(r),_=s.getAttribute("data-component"),b=s.getAttribute("config"),_){if(!b)b=s.getAttribute("newconfig")||e.randomId("cfg-"),s.setAttribute("config",b);if(C=a.parseMarkup(s,null),C&&C.__doubleconfig)b=(C=C[0]).__$config;d=h.call(this,C,s,p,_,b),u.push({ctor:d.cnstr,cfg:d.cfg,instance:d.instance,cName:d.cName,node:s,hasMarkup:"true"===s.getAttribute("hasMarkup")})}return u},reviveComponents:function(e){var t,o,i=this;return t=this._prepareControlsConfig({container:e}),t=t.filter(function(e){return!e.node.wsControl||e.node.wsControl._template}),o=t.reduce(function(e,t){if(!t.ctor)e.push(n.require("js!"+t.cName).addCallback(function(e){return t.ctor=e[0],e}));return e},new r),o.done(t).getResult().addCallback(function(e){return this._loadControlsFromConfigArray(new r,"",e,true).getResult().createDependent()}.bind(this))},_loadControls:function(e,t,n,o,r){return this._loadControlsBySelector(e,t,this._createChildOnInitSelector)},_loadControlsFromConfigArray:function(e,t,n,o){return this._runInBatchUpdate("_loadControls - "+this._id,function(){var t=n.map(d,this);return n.forEach(c,this),this._markupDataBinding(),e.done(t)})},_loadControlsBySelector:function(e,t,n){return this._loadControlsFromConfigArray(e,t,this._prepareControlsConfig({selector:n}))},rebuildMarkup:function(e){if(this._dotTplFn)if(e)u(this._container,this._buildMarkup(this._dotTplFn,this._getOptions(),void 0,void 0,this.getLinkedContext())),setTimeout(function(){this._removeControls(),this.reviveComponents()}.bind(this),0);else this._removeControls(),u(this._container,this._buildMarkup(this._dotTplFn,this._getOptions(),void 0,void 0,this.getLinkedContext())),this.reviveComponents()},_calcMinHeight:function(){return this._getOption("minHeight")},_calcMinWidth:function(){return this._getOption("minWidth")}});return p.beforeExtend=function(e,t,n){p.prototype._setCompatibleOptions(e,t,n)},p});
//# sourceMappingURL=CompoundControl.js.map
define("SBIS3.CONTROLS/CompoundControl",["Lib/Control/CompoundControl/CompoundControl"],function(o){"use strict";return o.extend({$protected:{_options:{independentContext:false,tooltip:"",extendedTooltip:false}},$constructor:function(){}})});
//# sourceMappingURL=CompoundControl.js.map
define("js!SBIS3.CONTROLS.CompoundControl",["SBIS3.CONTROLS/CompoundControl"],function(o){return o});
//# sourceMappingURL=CompoundControl.module.js.map
define("Core/js-template-doT",["Core/IoC","Core/helpers/random-helpers"],function(IoC){"use strict";var doT={version:"0.2.0",templateSettings:null,template:void 0,compile:void 0,getSettings:function(){return{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,translate:/\{\[([\s\S]+?)\]\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,expertMode:/<!--WS-EXPERT([\s\S]+?)WS-EXPERT-->/g,ref:/\{\{@([\s\S]+?)\}\}/g,varname:"it",strip:true,append:true,selfcontained:true}}};doT.templateSettings=doT.getSettings();var global=function(){return this||(0,eval)("this")}();global.doT=doT;function initVarStorage(){if(!global.wsDotVarStorage)global.wsDotVarStorage={storage:{}}}function encodeHTMLSource(){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},t=/&(?!#?\w+;)|<|>|"|'|\//g;return function r(n){return n?n.toString().replace(t,function(t){return e[t]||t}):n}}function getStringPresentation(e){return e.join?e.join(""):e.toString()}function wrapUndefinedSource(){return function e(t){return void 0===t?"":t&&"object"===typeof t?getStringPresentation(t):""+t}}function encodeEvalSource(){var e=/\{\{([\s\S]+?)\}\}/g,t="&#123;&#123;$1&#125;&#125;";return function r(n){while(e.test(n))n=n.replace(e,t);return n}}global.encodeHTML=encodeHTMLSource(),global.wrapUndefined=wrapUndefinedSource(),global.encodeEval=encodeEvalSource();var startend={append:{start:"'+(encodeEval(wrapUndefined(",end:")))+'",startencode:"'+encodeEval(wrapUndefined(encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},skip=/$^/;function resolveDefs(c,block,def){return("string"===typeof block?block:block.toString()).replace(c.define||skip,function(m,code,assign,value){if(0===code.indexOf("def."))code=code.substring(4);if(!(code in def))if(":"===assign)def[code]=value;else eval("def['"+code+"']="+value);return""}).replace(c.use||skip,function(m,code){var v=eval(code);return v?resolveDefs(c,v,def):v})}function unescape(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}return doT.template=function(e,t,r){var n=(t=t||doT.templateSettings).append?startend.append:startend.split,o,a,i=0,s;if(t.use||t.define){var c=global.def;global.def=r||{},o=resolveDefs(t,e,global.def),global.def=c}else o=e;if(o=("var randomHelpers = (typeof _randomHelpers !== 'undefined' ? _randomHelpers : undefined) || global.requirejs('Core/helpers/random-helpers');"+"function escapeHtml(str) {return typeof str == \"string\" ? str.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;') : str;}"+"var storage = (function() { return this || (0,eval)('this') })().wsDotVarStorage.storage;"+" var out='"+(t.strip?o.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):o).replace(/'|\\/g,"\\$&").replace(t.expertMode||skip,function(e,t){return unescape(t)}).replace(t.translate||skip,function(e,t){return n.start+"rk('"+unescape(t.replace(/'/g,"\\'"))+"')"+n.end}).replace(t.ref||skip,function(e,t){return n.start+"(function setRefValue(s, v){var k = randomHelpers.randomId(); s[k] = v; return k;}(storage, "+unescape(t)+"))"+n.end}).replace(t.encode||skip,function(e,t){return a=true,n.startencode+unescape(t)+n.end}).replace(t.interpolate||skip,function(e,t){return n.start+unescape(t)+n.end}).replace(t.conditional||skip,function(e,t,r){return t?r?"';}else if("+unescape(r)+"){out+='":"';}else{out+='":r?"';if("+unescape(r)+"){out+='":"';}out+='"}).replace(t.iterate||skip,function(e,t,r,n){if(!t)return"';} } out+='";return i+=1,s=n||"i"+i,t=unescape(t),"';var arr"+i+"="+t+";if(arr"+i+"){var "+r+","+s+"=-1,l"+i+"=arr"+i+".length-1;while("+s+"<l"+i+"){"+r+"=arr"+i+"["+s+"+=1];out+='"}).replace(t.evaluate||skip,function(e,t){return"';"+unescape(t)+"out+='"})+"'; out = encodeEval(out); return out + (pp && out.indexOf('{{') !== -1 ? String.fromCharCode(8203,8203) : '');").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|}|^|{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|}|^|{)out\+=''\+/g,"$1out+="),o="var encodeEval=("+encodeEvalSource.toString()+"());"+"var getStringPresentation="+getStringPresentation.toString()+";"+"var wrapUndefined=("+wrapUndefinedSource.toString()+"());"+"var pp = typeof process !== 'undefined';"+o,a&&t.selfcontained)o="var encodeHTML=("+encodeHTMLSource.toString()+"());"+o;try{return new Function(t.varname,o)}catch(e){throw IoC.resolve("ILogger").error("doT","Could not create template function: "+o,e),e}},doT.compile=function(e,t){return doT.template(e,null,t)},initVarStorage(),doT});
//# sourceMappingURL=js-template-doT.js.map
(function(){"use strict";var e=function(){return this||(0,eval)("this")}();(e.define||e.requirejs&&e.requirejs.define||requirejsVars&&requirejsVars.define)("html",["Core/pathResolver","Core/js-template-doT","text"],function(e,t,r){function n(e,t,r){e.toJSON=function(){var e={$serialized$:"func",module:t};if(r)e.path=r;return e}}function i(e,t){var r=t.replace(/[^a-z0-9]/gi,"_"),i=new Function("f","return function "+r+"(){ return f.apply(this, arguments); }")(e);return n(i,"html!"+t),i}return{load:function(n,o,a,f){var s=n.split("?"),u=false,l,c;if(s.length>1)l=s.shift(),n=s.join("?"),u=/\bencode=true\b/.test(l);else n=s[0];var d=function(e){e.message="Error while loading template "+n+"\n"+e.message+"\n"+e.stack,a.error(e)},h=function(e){if(e&&0==e.indexOf("define"))a.fromTextFixed?a.fromTextFixed(e):a.fromText(e);else{if(c=t.getSettings(),c.strip=false,u)c.encode=c.interpolate;try{a(i(t.template(e,c),n))}catch(e){d(e)}}};h.error=function(e){d(e)};try{var m=e(n,"html");r.load(m,o,h,f)}catch(e){d(e)}}}})})();
//# sourceMappingURL=html.js.map
define("html!SBIS3.Contacts.DialogView",function(){var e=function(e){var t=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(t){for(;e.test(t);)t=t.replace(e,"&#123;&#123;$1&#125;&#125;");return t}}(),o=function(e){return e.join?e.join(""):e.toString()},s=function(e){return void 0===e?"":e&&"object"==typeof e?o(e):""+e},i="undefined"!=typeof process,r=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'%{INCLUDE "/Тема Скрепка/Шаблоны/includes/common-doctype.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/common-html-definition.html"} <head> %{INCLUDE "/Тема Скрепка/Шаблоны/includes/common-meta.html"} <title>'+t(s(e.title))+'</title> %{INCLUDE "/Тема Скрепка/Шаблоны/includes/favicon.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/ws-styles.html"} <link rel="stylesheet" href="'+t(s(e.resourceRoot))+'Tema_Skrepka/SHablony/css/graytheme.v1516270649826335cf4508dd597be4bfc9caa3e08b901.css" type="text/css"/> <link rel="stylesheet" href="'+t(s(e.resourceRoot))+'Tema_Skrepka/SHablony/css/grayThemeEdit.v1516270649826335cf4508dd597be4bfc9caa3e08b901.css" type="text/css"/> '+t(s(e.cssBlock))+' <script type="text/javascript"> window.wsConfig={ appRoot: \''+t(s(e.appRoot))+"',wsRoot: '"+t(s(e.wsRoot))+"',resourceRoot: '"+t(s(e.resourceRoot))+"',defaultServiceUrl: '"+t(s(e.servicesPath||""))+"' || '/service/',userConfigSupport: '"+t(s(e.userConfigSupport||""))+"' || true,globalConfigSupport: '"+t(s(e.globalConfigSupport||""))+"' || true,saveLastState: '"+t(s(e.saveLastState||""))+'\' || false,fasttemplate: true};try{ if(typeof window.callPhantom===\'function\'){window.callPhantom({waitSignal: true});}}catch(e){}<\/script> %{INCLUDE "/Тема Скрепка/Шаблоны/includes/requirejs.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/jquery.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/ws-components-placeholder.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/ws-contents.html"} '+t(s(e.jsBlock))+' %{INCLUDE "/Тема Скрепка/Шаблоны/includes/ws-core.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/ws-common-startup-script.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/webrtc-data-provider.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/opengraph.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/is-data-provider.html"} </head> <body class="ws-server-generated touchInterface ws-narrow-page ws-body-no-scroll ws-sticky-header__wrapper %{CURRENT_LOCALE}"> <div class="ws-sticky-header__header-container"></div> <div class="ws-sticky-header__scrollable-container ws-scrolling-content ws-body-scrolling-content"> <div id="min-width"> <div id="wrapper"> <div id="middleEdit"> <div id="contentAreaEdit" class="ws-float-area-stack-root"> <div id="header"> <div id="headerContent"> <span id="headerLeft"></span> </div> </div> '+t(s(e.content))+' </div> </div> </div> </div> </div> %{INCLUDE "/Тема Скрепка/Шаблоны/includes/ie-hacks.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/webrtc-script.html"} %{INCLUDE "/Тема Скрепка/Шаблоны/includes/common-javascript-files.html"} </body> ');return(r=t(r))+(i&&-1!==r.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.DialogView"}},e});
//# sourceMappingURL=DialogView.xhtml.map
define("js!SBIS3.Contacts.DialogView",["js!SBIS3.CONTROLS.CompoundControl","html!SBIS3.Contacts.DialogView","css!SBIS3.Contacts.DialogView"],function(t,n){var o=t.extend({_dotTplFn:n,$protected:{_options:{}},init:function(){o.superclass.init.call(this)}});return o});
//# sourceMappingURL=DialogView.module.js.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonPhoto",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,s,n,o){function d(){}var c=0,l=void 0!==t&&t?t:arguments[arguments.length-1];void 0===l&&(eval("var thelpers = null;"),l=global.requirejs("View/Runner/tclosure"));var p={};o&&o.isSetts&&(p=o.fullContext||{});var u="string"==typeof s?s:"",m=void 0===r?void 0:r,g={id:[],def:void 0},f=l.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),h=this&&this.includedTemplates?this.includedTemplates:{},v=l.getMarkupGenerator(n);try{var U=v.joinElements([l.getter(i,["photoURL"])?[v.createTag("div",{class:"contacts-PersonPhoto-container "+l.wrapUndef(l.utils.escape(l.getter(i,["className"])))},[v.createTag("img",{class:"person-photo-img"+l.wrapUndef(l.utils.escape(24===l.getter(i,["size"])?" mini-photo":"")),"data-minicard-oid":""+l.wrapUndef(l.utils.escape(l.getter(i,["miniCardAttributes"])&&l.getter(i,["miniCardAttributes","oid"]))),"data-minicard-template":""+l.wrapUndef(l.utils.escape(l.getter(i,["miniCardAttributes"])&&l.getter(i,["miniCardAttributes","template"]))),"data-minicard-mode":""+l.wrapUndef(l.utils.escape(l.getter(i,["miniCardAttributes"])&&l.getter(i,["miniCardAttributes","mode"]))),"data-minicard-track-target":""+l.wrapUndef(l.utils.escape(l.getter(i,["miniCardAttributes"])&&l.getter(i,["miniCardAttributes","trackTarget"]))),"data-minicard-reloadOpener":""+l.wrapUndef(!1),id:""+l.wrapUndef(l.utils.escape(l.getter(i,["photoId"]))),src:""+l.wrapUndef(l.utils.escape(l.getter(i,["photoURL"]))),srcset:""+l.wrapUndef(l.utils.escape(l.getter(i,["srcSetPhotoURL"])?l.getter(i,["srcSetPhotoURL"])+" 2x":"")),style:"width: "+l.wrapUndef(l.utils.escape(l.getter(i,["size"])))+"px; height: "+l.wrapUndef(l.utils.escape(l.getter(i,["size"])))+"px;"},[],{},g,this),l.getter(i,["activity"])?[v.createText(" "+l.wrapUndef(l.Sanitize.apply(void 0,[l.getDecorators().unescape.apply(void 0,[l.getter(i,["activity"])])]))+" ")]:v.createText("")],{},g,this)]:v.createText("")],u,g);g.def&&(U=v.chain(U,g,a),g=void 0)}catch(e){l.templateError("resources/Contacts.Mini/Models/templates/PersonPhoto.tmpl",e,i)}return U||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonPhoto"}},i});
//# sourceMappingURL=PersonPhoto.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonEmployment",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,n,a,o,s){function l(){}var d=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var m={};s&&s.isSetts&&(m=s.fullContext||{});var p="string"==typeof a?a:"",u=void 0===r?void 0:r,f={id:[],def:void 0},g=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),y=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(o);try{var C=v.joinElements([v.createTag("div",{class:"contacts-PersonEmployment__container   "+c.wrapUndef(c.utils.escape(c.getter(i,["isDepartment"])?"contacts-PersonEmployment__department":"contacts-PersonEmployment__company"))+"   "+c.wrapUndef(c.utils.escape(c.getter(i,["miniCardAttributes"])&&c.getter(i,["miniCardAttributes","oid"])?" contacts-PersonEmployment__hover":""))+" "+c.wrapUndef(c.utils.escape(c.getter(i,["className"]))),title:""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(i,["title"])])])),"data-minicard-oid":""+c.wrapUndef(c.utils.escape(c.getter(i,["miniCardAttributes"])&&c.getter(i,["miniCardAttributes","oid"]))),"data-minicard-key":""+c.wrapUndef(c.utils.escape(c.getter(i,["miniCardAttributes"])&&c.getter(i,["miniCardAttributes","oid"]))),"data-minicard-template":""+c.wrapUndef(c.utils.escape(c.getter(i,["miniCardAttributes"])&&c.getter(i,["miniCardAttributes","template"]))),"data-minicard-mode":""+c.wrapUndef(c.utils.escape(c.getter(i,["miniCardAttributes"])&&c.getter(i,["miniCardAttributes","mode"]))),"data-minicard-reloadopener":"false"},[v.createTag("span",{class:"contacts-PersonEmployment__title "+c.wrapUndef(c.utils.escape(c.getter(i,["needUnconfirmedIcon"])?"contacts-PersonEmployment__unconfirmed":""))},[v.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(i,["employmentName"])])]))+" ")],{},f,this),c.getter(i,["needUnconfirmedIcon"])?[v.createTag("span",{class:"contacts-PersonEmployment__icon icon-16 icon-Alert icon-disabled",title:""+global.rk("Организация не подтверждена")},[],{},f,this)]:v.createText("")],n,f,this)],p,f);f.def&&(C=v.chain(C,f,n),f=void 0)}catch(e){c.templateError("resources/Contacts.Mini/Models/templates/PersonEmployment.tmpl",e,i)}return C||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonEmployment"}},i});
//# sourceMappingURL=PersonEmployment.tmpl.map
(function(){"use strict";var e=function(){return this||(0,eval)("this")}();(e.define||e.requirejs&&e.requirejs.define||requirejsVars.define)("tmpl",["text","View/config","Core/pathResolver","View/Runner"],function(e,n,t,r){var i=r.Run;function o(e){return"tmpl!"+e}function a(e,n,t){e.toJSON=function(){var e={$serialized$:"func",module:n};if(t)e.path=t;return e}}return{load:function(r,c,s){try{var l=t(r,"tmpl"),u={config:n,filename:l},f=function(e){if(e&&0==e.indexOf("define"))s.fromTextFixed?s.fromTextFixed(e):s.fromText(e);else try{c(["View/Builder","Lib/Control/Control.compatible","is!compatibleLayer?Lib/Control/AreaAbstract/AreaAbstract.compatible"],function(n){var t=n.Tmpl;t.template(e,o,u).handle(function(e){var n=t.func(e,u);Object.keys(n.includedFunctions).forEach(function(e){a(n.includedFunctions[e],"tmpl!"+r,"includedFunctions."+e)}),n.stable=true;var o=function(){return n.apply(this,t.addArgument(i,arguments))};o.stable=true,o.includedFunctions=n.includedFunctions,a(o,"tmpl!"+r),s(o)},function(e){var n="Error while creating template "+r+"\n"+e.message+"\n"+e.stack;console.log(n),e.message=n})})}catch(e){e.message="Error while creating template "+r+"\n"+e.message+"\n"+e.stack,s.error(e)}};f.error=function(e){e.message="Error while loading template "+r+"\n"+e.message+"\n"+e.stack,s.error(e)},e.load(l,c,f,u)}catch(e){e.message="Error while resolving template "+r+"\n"+e.message+"\n"+e.stack,s.error(e)}}}})})();
//# sourceMappingURL=tmpl.js.map
define("tmpl!SBIS3.CONTROLS/Link/resources/hrefTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},n=function e(n,o,a,i,s){function c(){}var l=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var u="string"==typeof a?a:"",f=void 0===r?void 0:r,g={id:[],def:void 0},_=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),v=this&&this.includedTemplates?this.includedTemplates:{},h=p.getMarkupGenerator(i);try{var T=h.joinElements([p.getter(n,["href"])?[h.createTag("a",{class:"controls-Link-link",href:""+p.wrapUndef(p.utils.escape(p.getter(n,["enabled"])?p.getter(n,["href"]):"")),target:""+p.wrapUndef(p.utils.escape(p.getter(n,["inNewTab"])?"_blank":"")),rel:"noreferrer"},[p.getter(n,["icon"])?[h.createTag("i",{class:"controls-Link__icon controls-Button__icon "+p.wrapUndef(p.utils.escape(p.getter(n,["_iconClass"])))},[],{},g,this)]:h.createText(""),h.createTag("span",{class:"controls-Link__field controls-Button__text js-controls-Button__text"},[h.createText(""+p.wrapUndef(p.Sanitize.apply(void 0,[p.getDecorators().sanitize.apply(void 0,[p.getter(n,["caption"])])])))],{},g,this)],{},g,this)]:[h.createTag("span",{class:"controls-Link-link "},[p.getter(n,["icon"])?[h.createTag("i",{class:"controls-Link__icon controls-Button__icon "+p.wrapUndef(p.utils.escape(p.getter(n,["_iconClass"])))},[],{},g,this),h.createTag("span",{class:"controls-Link__field controls-Button__text js-controls-Button__text"},[h.createText(""+p.wrapUndef(p.Sanitize.apply(void 0,[p.getDecorators().sanitize.apply(void 0,[p.getter(n,["caption"])])])))],{},g,this)]:[h.createText(""+p.wrapUndef(p.Sanitize.apply(void 0,[p.getDecorators().sanitize.apply(void 0,[p.getter(n,["caption"])])])))]],{},g,this)]],u,g);g.def&&(T=h.chain(T,g,o),g=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Link/resources/hrefTemplate.tmpl",e,n)}return T||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Link/resources/hrefTemplate"}},n});
//# sourceMappingURL=hrefTemplate.tmpl.map
define("tmpl!WSControls/Buttons/resources/contentTemplate",["Core/tmpl/js/tclosure"],function(){var t=Array.prototype.slice.call(arguments),e=t[0],r={},o=function t(o,n,s,a,i){function c(){}var l=0,u=void 0!==e&&e?e:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var p={};i&&i.isSetts&&(p=i.fullContext||{});var d="string"==typeof s?s:"",v=void 0===r?void 0:r,f={id:[],def:void 0},m=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},T=u.getMarkupGenerator(a);try{var h=T.joinElements([u.getter(o,["icon"])?[T.createTag("i",{class:"controls-Button__icon js-controls-Button__icon "+u.wrapUndef(u.utils.escape(u.getter(o,["_iconClass"])))},[],{},f,this)]:T.createText(""),u.getter(o,["caption"])?[T.createTag("span",{class:"controls-Button__text js-controls-Button__text "+u.wrapUndef(u.utils.escape(u.getter(o,["_textClass"])))},[T.createText(""+u.wrapUndef(u.Sanitize.apply(void 0,[u.getDecorators().sanitize.apply(void 0,[u.getter(o,["caption"])])])))],{},f,this)]:T.createText("")],d,f);f.def&&(h=T.chain(h,f,n),f=void 0)}catch(t){u.templateError("resources/SBIS3.CONTROLS/WSControls/Buttons/resources/contentTemplate.tmpl",t,o)}return h||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!WSControls/Buttons/resources/contentTemplate"}},o});
//# sourceMappingURL=contentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Mixins/IconMixin/IconTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={},i=function e(i,r,o,c,l){function a(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var p={};l&&l.isSetts&&(p=l.fullContext||{});var d="string"==typeof o?o:"",f=void 0===n?void 0:n,v={id:[],def:void 0},m=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),g=this&&this.includedTemplates?this.includedTemplates:{},S=u.getMarkupGenerator(c);try{var x=S.joinElements([S.createText(""+u.wrapUndef(u.utils.escape(u.getter(i,["icon"])&&" "+(0===u.getter(i,["icon","indexOf"]).apply(u.getter(i,["icon"]),["sprite:"])?u.getter(i,["icon","substr"]).apply(u.getter(i,["icon"]),[7]):u.getter(i,["icon"])))))],d,v);v.def&&(x=S.chain(x,v,r),v=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/Mixins/IconMixin/IconTemplate.tmpl",e,i)}return x||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/IconMixin/IconTemplate"}},i});
//# sourceMappingURL=IconTemplate.tmpl.map
define("SBIS3.CONTROLS/Mixins/IconMixin",["tmpl!SBIS3.CONTROLS/Mixins/IconMixin/IconTemplate"],function(n){return{$protected:{_iconTemplate:n,_options:{icon:""}},after:{_modifyOptions:function(i){if(i.icon)i._iconClass=n(i);return i}},$constructor:function(){},setIcon:function(n){n="undefined"===typeof n?n="":n,this._options.icon=n,this._options._iconClass=this._iconTemplate(this._options),this._drawIcon(n),this._notifyOnPropertyChanged("icon")},getIcon:function(){return this._options.icon},_drawIcon:function(n){}}});
//# sourceMappingURL=IconMixin.js.map
define("SBIS3.CONTROLS/Mixins/FormWidgetMixin",["Core/constants","Core/IoC","Core/core-clone","Core/Deferred","Core/helpers/String/escapeHtml"],function(t,i,r,o,e){return{$protected:{_validationErrorCount:0,_validating:false,_prevValidationResult:true,_vResultErrors:[],_errorMessage:"",_infobox:void 0,_options:{validators:[],validateIfDisabled:false}},$constructor:function(){this._publishEvents()},around:{_isCanShowExtendedTooltip:function(){return Array.prototype.shift.call(arguments).apply(this,arguments)||this.isMarked()}},instead:{_alterTooltipText:function(t){if(this.isMarked()){var i=this._errorMessage instanceof jQuery?this._errorMessage[0].outerHTML:this._errorMessage;return("string"==typeof t&&t.length?"<p>"+t+"</p>":"")+"<p>"+i+"</p>"}else return t},_getExtendedTooltipModifiers:function(){return this.isMarked()?"ws-infobox-type-error":""}},before:{destroy:function(){if(this._infobox&&this._infobox.hasTarget()&&this._infobox.isCurrentTarget(this._getExtendedTooltipTarget()))this._infobox.hide()}},_publishEvents:function(){this._publish("onValidate")},_canValidate:function(){return this._options.validators.length&&(this.isEnabled()||this._options.validateIfDisabled)},_invokeValidation:function(){for(var t={errors:[],result:true},o=0,e=this._options.validators.length;o<e;o++){var s=this._options.validators[o],a=this._options[s.option],n=r(s.params||[]),l=!(s.noFailOnError||false),d=false;n.push(a);try{d=s.validator.apply(this,n)}catch(t){i.resolve("ILogger").log("FieldAbstract","Exception while validating "+t.message)}if(true!==d)if(d=s.errorMessage?s.errorMessage:d,t.errors=t.errors.concat(d),l)t.result&=false}return t},validate:function(){var t,i=this.getContainer(),r=this._prevValidationResult;if(this._validating||!this._options.validateIfDisabled&&!this.isEnabled()||!i||true===i.hasClass("ws-hidden"))return this.clearMark(),true;try{if(this._validating=true,t=this._invokeValidation(),t.result&&this._childControls)for(var o=0,e=this._childControls.length;o<e;o++){var s=this._childControls[o];if(s&&s.validate&&!s.validate()){t.result=false;break}}}catch(i){t={errors:[i.message],result:false}}finally{this._validating=false}if(t.errors.length>0)this.markControl(t.errors,true);else this.clearMark();return this._calcPrevValidationResult(),this._notify("onValidate",!!t.result,t.errors,r),this._vResultErrors=t.errors,t.result},_getMessageBox:function(r,o){var s=$("body > .ws-warning-message-box");if(!s.length){s=$('<div class="ws-warning-message-box"></div>').append($('<span class="ws-warning-icon"></span>')).append($('<span class="ws-warning-message-text"></span>'));for(var a=$('<div class="ws-arrow-balloon"></div>'),n="",l=1;l<=10;l++)n+='<b class="b'+l+'"></b>';a.html(n),s.append(a),$("body").append(s)}if(r)s.find(".ws-warning-message-text").html(e(r));try{if(o){if(o["icon"]&&s.data("current-icon")!=o["icon"]){var d=t.wsRoot+"img/infobox/icon-"+o["icon"]+".png";s.find(".ws-warning-icon").css({"background-image":'url("'+d+'")',display:"block"}),s.data("current-icon",o["icon"])}if(o["noIcon"])s.find(".ws-warning-icon").hide();if(o["color"])s.find(".ws-warning-message-text").css("color",o["color"]);if(o["background-color"]&&s.data("current-background-color")!=o["background-color"])s.css("background-color",o["background-color"]),s.find(".ws-arrow-balloon b").css("background-color",o["background-color"]),s.data("current-background-color",o["background-color"])}}catch(t){i.resolve("ILogger").log("Error","Ошибка установки опций в функции Control."+"_getMessageBox")}return s},_createErrorMessage:function(t){var i;if(t instanceof Array&&1==t.length)i=t[0];else if(t instanceof Array){i=$("<ul></ul>");for(var r=0,o=t.length;r<o;r++)i.append("<li>"+t[r]+"</li>")}else i=t;this._errorMessage=i},_calcValidationErrorCount:function(t){this._validationErrorCount=t instanceof Array?t.length:1},_calcPrevValidationResult:function(){this._prevValidationResult=!this.isMarked()},markControl:function(t,i){var r=t&&("string"==typeof t||t instanceof Array&&t.length)?t:"Введите значение",o;if(this._calcValidationErrorCount(r),this._createErrorMessage(r),true===i)this._getInfoBox().addCallback(function(){if(o=this._getExtendedTooltipTarget()[0],this._infobox.getCurrentTarget()!==o)this._infobox.show({control:o,message:this._alterTooltipText(),delay:0,modifiers:"ws-infobox-type-error",hideDelay:this._infobox.ACT_CTRL_HIDE_TIMEOUT})}.bind(this));this._container.addClass("ws-validation-error")},_getInfoBox:function(){var t=new o;if(this._infobox)return t.callback();return require(["Lib/Control/Infobox/Infobox"],function(i){this._infobox=i,t.callback()}.bind(this)),t},clearMark:function(){if(this._validationErrorCount)this._validationErrorCount=0,this._container.removeClass("ws-validation-error"),this._errorMessage="",this._getInfoBox().addCallback(function(){if(this._infobox.hasTarget()&&this._infobox.isCurrentTarget(this._getExtendedTooltipTarget()))if(this._isCanShowExtendedTooltip())this._showExtendedTooltip(true);else this._infobox.hide(0)}.bind(this))},isMarked:function(){return!!this._validationErrorCount},setValidators:function(t){if(t&&"[object Array]"==Object.prototype.toString.apply(t))this._options.validators=t},addValidators:function(t){this._options.validators=this._options.validators.slice(),Array.prototype.push.apply(this._options.validators,t)}}});
//# sourceMappingURL=FormWidgetMixin.js.map
define("SBIS3.CONTROLS/Mixins/DataBindMixin",["Lib/Control/AttributeCfgParser/AttributeCfgParser"],function(t){"use strict";return{$protected:{_dataBind:{}},$constructor:function(){var i=this._container.attr("data-bind");if(i)this._dataBind=t(i)||{}},_getBindingContext:function(){var t;if(this.getParent())t=this.getParent().getContext();else t=this.getLinkedContext();return t},saveToContext:function(t,i){if(this._dataBind[t])this._getBindingContext().setValue(this._dataBind[t],i,false,this),this.validate()},_propertyDataBinding:function(){var i=this,n=this._getBindingContext(),e=this.getContainer().attr("data-bind"),a,r;function s(t){var n="set"+t.replace(/^(.)/,function(t){return t.toUpperCase()});return n in i?n:false}if(e){a=t(e);for(var o in a)if(a.hasOwnProperty(o))if(false!==(r=s(o)))this[r](n.getValue(a[o])),n.subscribe("onFieldChange",function(t,n,e,s){if(n==a[o]&&i._options[o]!==e&&s!==i)i[r].apply(i,[e])})}}}});
//# sourceMappingURL=DataBindMixin.js.map
define("SBIS3.CONTROLS/Mixins/Clickable",["Core/constants"],function(t){if("undefined"!==typeof window)$(document).on("touchend  mouseup",function(){$(".controls-Click__active").removeClass("controls-Click__active")});return{$protected:{_options:{command:"",commandArgs:[],clickThrottle:false},_keysWeHandle:[t.key.enter,t.key.space]},$constructor:function(){this._publish("onActivated");var t=this;this._container.on("touchstart  mousedown",function(i){if((1==i.which||"touchstart"==i.type)&&t.isEnabled())t._container.addClass("controls-Click__active")})},setCommandArgs:function(t){this._options.commandArgs=t,this._notifyOnPropertyChanged("commandArgs")},getCommandArgs:function(){return this._options.commandArgs},_notifyOnActivated:function(t){this._notify("onActivated",t),t.stopImmediatePropagation()},_keyboardHover:function(t){if(this.isEnabled())return this._clickHandler(t),this._notifyOnActivated(t),true},_checkEnabledByClick:function(){return this.isEnabled()},before:{_clickHandler:function(){}},instead:{_onClickHandler:function(i){if(this._checkEnabledByClick()){if(this._container.removeClass("controls-Click__active"),!this._isControlActive&&this._options.activableByClick)this.setActive(true);if(!this._options.clickThrottle||this._options.clickThrottle&&(i.originalEvent.detail<=1||t.browser.isIE)){if(this._clickHandler(i),!!this._options.command){var n=[this._options.command].concat(this._options.commandArgs);this.sendCommand.apply(this,n)}this._notifyOnActivated(i)}}i.stopImmediatePropagation()}}}});
//# sourceMappingURL=Clickable.js.map
define("js!WSControls/Buttons/ButtonBase",["Lib/Control/CompoundControl/CompoundControl","SBIS3.CONTROLS/Mixins/Clickable","SBIS3.CONTROLS/Mixins/FormWidgetMixin","SBIS3.CONTROLS/Mixins/DataBindMixin","SBIS3.CONTROLS/Mixins/IconMixin","Core/helpers/String/escapeHtml","css!WSControls/Buttons/resources/ButtonBase"],function(t,i,n,o,s,e){"use strict";var a=t.extend([i,n,o,s],{$protected:{_tooltipSettings:{handleFocus:false},_checkClickByTap:true,_maxTouchCount:2,_options:{caption:void 0,escapeCaptionHtml:true}},_modifyOptions:function(){var t=a.superclass._modifyOptions.apply(this,arguments);if(t.caption&&t.escapeCaptionHtml)t.caption=e(t.caption);return t},$constructor:function(){},init:function(){a.superclass.init.call(this),$("[data-component]",this._container.get(0)).mousedown(function(t){t.stopPropagation()})},setCaption:function(t){if(this._options.escapeCaptionHtml)t=e(t);this._options.caption=t||""},validate:function(){return a.superclass.validate.apply(this,arguments)&&t.prototype.validate.apply(this,arguments)},getCaption:function(){return this._options.caption},_setVisibility:function(t){if(t!==this._isVisible)this._container.toggleClass("ws-hidden",!t),this._isVisible=t,this._setOption("visible",this._isVisible),this._notifyOnSizeChanged(true),this._notifyOnPropertyChanged("visible")},_getExtendedTooltipPositionContainer:function(){if(this._options.icon||!!this._options.iconClass)return this.getContainer()[0].querySelector(".js-controls-Button__icon");return this.getContainer()}});return a});
//# sourceMappingURL=ButtonBase.js.map
define("tmpl!WSControls/Buttons/Button",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},n=function e(n,o,i,l,s){function a(){}var u=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var p="string"==typeof i?i:"",v=void 0===r?void 0:r,f={id:[],def:void 0},m=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),g=this&&this.includedTemplates?this.includedTemplates:{},h=c.getMarkupGenerator(l);try{var y=h.joinElements([h.createTag("span",{class:"controls-ButtonBase "+c.wrapUndef(c.utils.escape(c.getter(n,["visible"])?"":" ws-hidden")),title:""+c.wrapUndef(c.utils.escape(c.getter(n,["tooltip"]))),disabled:""+c.wrapUndef(c.utils.escape(c.getter(n,["enabled"])?"":"disabled")),type:"button"},[h.createTag("span",{class:"controls-Button__wrapper"},[h.createControl("resolver",c.getter(n,["contentTemplate"]),c.uniteScope(c.utils.escape(c.uniteScope(n,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},i,v,g,c.config,d,f)],{},f,this)],o,f,this)],p,f);f.def&&(y=h.chain(y,f,o),f=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/WSControls/Buttons/Button.tmpl",e,n)}return y||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!WSControls/Buttons/Button"}},n});
//# sourceMappingURL=Button.tmpl.map
define("js!WSControls/Buttons/Button",["Core/constants","js!WSControls/Buttons/ButtonBase","tmpl!WSControls/Buttons/Button","tmpl!WSControls/Buttons/resources/contentTemplate"],function(t,n,i,s){"use strict";var e=n.extend({_dotTplFn:i,$protected:{_keysWeHandle:[t.key.enter],_options:{contentTemplate:s,primary:false},_contentContainer:null},$constructor:function(){if(true===this._options.primary)this._registerDefaultButton();this._contentContainer=this._container.find(".controls-Button__wrapper")},setCaption:function(t){e.superclass.setCaption.call(this,t),this._redrawButton()},setPrimary:function(t){this._options.primary=!!t,this._container.toggleClass("controls-Button-color__primary",this.isPrimary()),this._container.toggleClass("controls-Button__primary",this.isPrimary()),this._container.toggleClass("controls-Button-color__default",!this.isPrimary())},isPrimary:function(){return this._options.primary},_drawIcon:function(){this._redrawButton()},_redrawButton:function(){this._contentContainer[0].innerHTML=s(this._options)},setEnabled:function(t){e.superclass.setEnabled.call(this,t),this._container.attr("disabled",!this.isEnabled())},_notifyOnActivated:function(n){if(e.superclass._notifyOnActivated.apply(this,arguments),n.which===t.key.enter)n.preventDefault()},isDefaultButton:function(){return!!this._options.primary},_unregisterDefaultButton:function(){this.sendCommand("unregisterDefaultButtonAction")},_registerDefaultButton:function(){if(this.isVisible())this._unregisterDefaultButton(),this._defaultAction=function(t){if(this&&this.isEnabled())return this._onClickHandler(t),false;else return true},this._defaultAction=this._defaultAction.bind(this),this.sendCommand("registerDefaultButtonAction",this._defaultAction,this)},setDefaultButton:function(t,n){if(void 0===t)t=true;if(!n)if(t)this._registerDefaultButton();else this._unregisterDefaultButton();this.setPrimary(t)},destroy:function(){if(this._contentContainer=null,this.isPrimary())this._unregisterDefaultButton();e.superclass.destroy.apply(this,arguments)}});return e});
//# sourceMappingURL=Button.js.map
define("SBIS3.CONTROLS/Utils/LinkUtil",[],function(){return{preparedClassFromOptions:function(i,a){var n=["mainLink","mainLink__2","mainLink__3","additionalLink","additionalLink__2","additionalLink__3","additionalLink__4","additionalLink__5"],d=a&&a.class||i.element&&i.element.className||i.className||"",e="mainLink",k=" controls-Link_";if(d)n.forEach(function(i){if(-1!==d.indexOf(i))e=i});switch(e){case"mainLink":k+="main";break;case"mainLink__2":k+="main-2";break;case"mainLink__3":k+="main-3";break;case"additionalLink":k+="additional";break;case"additionalLink__2":k+="additional-2";break;case"additionalLink__3":k+="additional-3";break;case"additionalLink__4":k+="additional-4";break;case"additionalLink__5":k+="additional-5"}i.className+=k}}});
//# sourceMappingURL=LinkUtil.js.map
define("SBIS3.CONTROLS/Link",["Core/helpers/String/escapeTagsFromStr","js!WSControls/Buttons/Button","SBIS3.CONTROLS/Utils/LinkUtil","tmpl!SBIS3.CONTROLS/Link/resources/hrefTemplate","css!SBIS3.CONTROLS/Link/Link"],function(t,n,s,i){"use strict";var e=n.extend({$protected:{_options:{href:"",inNewTab:false}},_modifyOptions:function(t,n,o){var r=e.superclass._modifyOptions.apply(this,arguments);if(r.cssClassName+=" controls-Link",r.href)r.contentTemplate=i;else r._textClass=" controls-Link__field";return s.preparedClassFromOptions(r,o),r},$constructor:function(){},setCaption:function(n){if(e.superclass.setCaption.call(this,n),this._options.href)this._contentContainer[0].innerHTML=i(this._options);var s=(void 0===n||null===n?"":n+"").replace(/<br>/g,"\n");this.setTooltip(t(s,"\\w+"))},_setEnabled:function(t){if(e.superclass._setEnabled.apply(this,arguments),t){if(this._options.href)$(".controls-Link-link",this._container).attr("href",this._options.href)}else $(".controls-Link-link",this._container).removeAttr("href",this._options.href)},_drawIcon:function(t){if(e.superclass._drawIcon.call(this,t),this._options.href)this._contentContainer[0].innerHTML=i(this._options)},setHref:function(t){this._options.href=t,this._contentContainer[0].innerHTML=i(this._options)}});return e});
//# sourceMappingURL=Link.js.map
define("tmpl!SBIS3.CONTROLS/InformationPopup/InformationPopup",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,n,a,i,l){function p(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var c={};l&&l.isSetts&&(c=l.fullContext||{});var d="string"==typeof a?a:"",f=void 0===r?void 0:r,m={id:[],def:void 0},v=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),P=this&&this.includedTemplates?this.includedTemplates:{},S=u.getMarkupGenerator(i);try{var g=S.joinElements([S.createTag("div",{class:"controls-InformationPopup controls-FloatArea controls-InformationPopup__status-"+u.wrapUndef(u.utils.escape(u.getter(o,["status"])))+" "+u.wrapUndef(u.utils.escape(u.getter(o,["additionalClass"])))},[u.getter(o,["template"])?[S.createControl("resolver",u.getter(o,["template"]),u.uniteScope(u.utils.escape(u.uniteScope(o,{parent:void 0,element:void 0})(u.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},a,f,P,u.config,c,m)]:S.createText("")],n,m,this)],d,m);m.def&&(g=S.chain(g,m,n),m=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/InformationPopup/InformationPopup.tmpl",e,o)}return g||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/InformationPopup/InformationPopup"}},o});
//# sourceMappingURL=InformationPopup.tmpl.map
define("SBIS3.CONTROLS/Utils/TouchKeyboardHelper",["Core/constants","Core/EventBus"],function(i,e){var n={portrait:.3,landscape:.56},o={_keyboardVisible:false,_keyboardAnimation:false,_keyboardShowHandler:function(){this._keyboardVisible=true,this._keyboardHandler()},_keyboardHideHandler:function(){this._keyboardVisible=false,this._keyboardHandler()},_keyboardHandler:function(){var i=this;if(!this._keyboardAnimation)this._keyboardAnimation=setTimeout(function(){i._keyboardAnimation=null},350)},isPortrait:function(){return window.innerHeight>window.innerWidth},getKeyboardAnimation:function(){return this._keyboardAnimation},getKeyboardHeight:function(){if(this.isKeyboardVisible())if(i.browser.isMobileIOS)return $(window).height()*(this.isPortrait()?n.portrait:n.landscape);return 0},isKeyboardVisible:function(){return this._keyboardVisible}};if(i.compatibility.touch)e.globalChannel().subscribe("MobileInputFocus",o._keyboardShowHandler.bind(o)),e.globalChannel().subscribe("MobileInputFocusOut",o._keyboardHideHandler.bind(o));return o});
//# sourceMappingURL=TouchKeyboardHelper.js.map
define("SBIS3.CONTROLS/ControlHierarchyManager",[],function(){return{zIndexManager:{_cur:100499,setFree:function(n){if(n=parseInt(n,10),n==this._cur)this._cur-=2;return this._cur},getNext:function(){return this._cur+=2,this._cur}},_index:{},_topWindow:null,addNode:function(n){var e=n.getParent()||(n.getOpener instanceof Function?n.getOpener():null),t=n.getId(),i,r;if(e&&e.getId instanceof Function)i=e.getId();if(this._index[i])(r=this._componentToNode(n,this._index[i])).parent.children.push(r),this._index[t]=r;else if(r=this._componentToNode(n,null),!this._wasAdded(r))this._index[t]=r},removeNode:function(n){var e;if(n&&n.getChildControls instanceof Function&&n.getChildControls()){e=n.getChildControls();for(var t=0;t<e.length;t++)if(this._index[e[t].getId()])delete this._index[e[t].getId()]}delete this._index[n.getId()]},checkInclusion:function(n,e){var t=this._checkIndexInclusion(n,e);if(!t)t=this._checkParentInclusion(n,e);return t},_checkParentInclusion:function(n,e){var t=$(e).wsControl();if(t){var i=t.getOpener instanceof Function?t.getOpener()||t.getParent():t.getParent(),r=i?i.getContainer():null;if(r&&this._findContainer(n,r))return true;else return this._checkParentInclusion(n,r)}return false},_findContainer:function(n,e){return n._container.find($(e)).length||$(n._container).get(0)==e||n._container==e},_checkIndexInclusion:function(n,e){var t;if(t=this._index[n.getId()],t){var i=t.children.length;if(i)for(var r=0;r<i;r++){var o=t.children[r].self;if(this.checkInclusion(o,e))return true}}return this._findContainer(n,e)},_wasAdded:function(n){for(var e=0;e<this._index.length;e++)if(n.self.getId()==this._index[e].id)return true;return false},_componentToNode:function(n,e){return{parent:e,self:n,children:[]}},setTopWindow:function(n){this._topWindow=n},getTopWindow:function(){return this._topWindow}}});
//# sourceMappingURL=ControlHierarchyManager.js.map
define("Deprecated/Controls/ModalOverlay/ModalOverlay",["Core/WindowManager","Core/Abstract","css!Deprecated/Controls/ModalOverlay/ModalOverlay"],function(e,t){"use strict";return new(t.extend({$protected:{_overlay:void 0,_overlayState:false},$constructor:function(){this._publish("onOverlayToggle","onClick")},_createOverlay:function(){if(void 0===this._overlay){var t=$(".ws-window-overlay");if(t.length)this._overlay=t;else this._overlay=$("<div></div>").appendTo(document.body).hide().addClass("ws-window-overlay");this._overlay.click(function(t){var i=e.getActiveWindow();if(i)i.onBringToFront();if(this._notify("onClick",t))t.stopPropagation()}.bind(this))}},_setZIndex:function(e){if(void 0!==this._overlay)this._overlay.css("z-index",e)},getZIndex:function(){return this._overlay&&this._overlay.css("z-index")||0},isShownForWindow:function(e){return e.getZIndex()-this.getZIndex()===1},_show:function(){if(true!==this._overlayState)this._createOverlay(),this._overlay.show(),this._notify("onOverlayToggle",this._overlayState=true);if(!e.isMaximizedWindowExists())this._overlay.css("right",$("body").css("margin-right"))},_hide:function(){if(void 0!==this._overlay)if(false!==this._overlayState)this._overlay.hide(),this._notify("onOverlayToggle",this._overlayState=false)},adjust:function(){var t=e.getMaxVisibleZIndex();if(t>0)return this._show(),this._setZIndex(t-1),true;else return this._hide(),false},getState:function(){return this._overlayState}}))});
//# sourceMappingURL=ModalOverlay.js.map
define("Core/helpers/Hcontrol/trackElement",["Core/constants","Core/helpers/generate-helpers","Core/EventBus","Core/detection","Core/helpers/Hcontrol/isElementVisible","Core/ControlBatchUpdater"],function(e,t,i,n,r,o){return function(){var f=[],l=[],a=200,s="ws_trackerChannelId",h="ws_trackerState";function u(e,t,i){var n=e[0];if(n)n[t]=i}function c(e,t){var i=e[0];return i&&i[t]}function p(e){var n=t.randomId("tracker-"),r=i.channel(n);return u(e,s,n),r.setEventQueueSize("*",1),r}function d(e){var t=false;return e.parents().each(function(e,i){if("fixed"===$(i).css("position"))return t=true,false}),t}function v(t){var i=r(t),o=d(t),f=t.get(0),l=e.$win,a=i&&f&&f.getBoundingClientRect(),s=a&&0!==a.width&&0!==a.height;if((n.isIE10||n.isIE11)&&i&&!s)return c(t,h)||{};return{visible:i&&s,fixed:o,left:Math.floor(a?a.left+l.scrollLeft():0),top:Math.floor(a?a.top+l.scrollTop():0),winLeft:Math.floor(a?a.left:0),winTop:Math.floor(a?a.top:0),width:Math.floor(a?a.right-a.left:0),height:Math.floor(a?a.bottom-a.top:0)}}function w(e){if(o&&o.haveBatchUpdate()&&!e)return;var t=$(this),n=c(t,s),r=c(t,h),f,l,a,p,d=false;if(!r)d=true,r={};if(f=v(t),l=i.channel(n),f.visible!==r.visible)l.notify("onVisible",f.visible);if(f.visible)if(a=f,p=r,a.fixed!==p.fixed||a.left!==p.left||a.top!==p.top||a.width!==p.width||a.height!==p.height||a.winLeft!==p.winLeft||a.winTop!==p.winTop)if(l.notify("onMove",f,d),!c(t,s))return;u(t,h,f)}function C(e){if(-1===l.indexOf(e[0]))f.push(setInterval(w.bind(e[0]),a)),l.push(e[0])}function b(e){var t=l.indexOf(e[0]);if(t>-1)clearInterval(f[t]),f.splice(t,1),l.splice(t,1)}return function(e,t){var n=$(e),r=c(n,s),o;if(void 0===t)t=true;if(r)o=i.channel(r);else o=p(n);if(t)C(n);else b(n),u(n,s,null),u(n,h,null),o.destroy();return o}}()});
//# sourceMappingURL=trackElement.js.map
define("SBIS3.CONTROLS/Mixins/PopupMixin",["Core/WindowManager","Core/EventBus","Core/Deferred","SBIS3.CONTROLS/ControlHierarchyManager","Deprecated/Controls/ModalOverlay/ModalOverlay","SBIS3.CONTROLS/Utils/TouchKeyboardHelper","Core/core-instance","Core/helpers/Hcontrol/doAutofocus","Core/helpers/Hcontrol/trackElement","Core/detection","Core/constants"],function(t,i,e,o,s,n,r,h,l,a,f){"use strict";if("undefined"!==typeof window){var c=i.channel("WindowChangeChannel"),_=function(t){c.notify("onDocumentClick",t)};document.addEventListener("mousedown",_,true),document.addEventListener("touchstart",_,true),$(window).blur(function(t){if(document.activeElement&&"IFRAME"==document.activeElement.tagName)if(!$(document.activeElement).hasClass("ws-popup-mixin-ignore-iframe"))c.notify("onDocumentClick",t)}),$(document).bind("mouseover",function(t){c.notify("onDocumentMouseOver",t)}),$(window).bind("scroll",function(){c.notify("onWindowScroll")})}return{$protected:{_targetSizes:{},_containerSizes:{},_windowSizes:{},_isMovedH:void 0,_isMovedV:void 0,_defaultCorner:"",_defaultHorizontalAlignSide:"",_defaultVerticalAlignSide:"",_margins:null,_marginsInited:false,_originsInited:false,_zIndex:null,_currentAlignment:{},_parentFloatArea:null,_keysWeHandle:[f.key.tab,f.key.enter,f.key.esc],_options:{visible:false,corner:null,verticalAlign:{},horizontalAlign:{},target:void 0,closeByExternalClick:false,closeByExternalOver:false,closeOnTargetMove:false,closeButton:false,targetPart:false,isModal:false,targetOverlay:false,activateAfterShow:false,locationStrategy:null,bodyBounds:false,isHint:true,parentContainer:"",_canScroll:false,_fixJqueryPositionBug:false}},$constructor:function(){this._publish("onClose","onShow","onAlignmentChange","onChangeFixed");var t=this,e=this._container;if(e.css({position:"absolute",top:"-10000px",left:"-10000px"}),this._initOppositeCorners(),i.channel("WindowChangeChannel").subscribe("onWindowScroll",this._onResizeHandler,this),this._options.closeByExternalOver)i.channel("WindowChangeChannel").subscribe("onDocumentMouseOver",this._clickHandler,this);else if(this._options.closeByExternalClick)i.channel("WindowChangeChannel").subscribe("onDocumentClick",this._clickHandler,this);if(this._touchKeyboardMoveHandler=this._touchKeyboardMoveHandler.bind(this),this._overlayClick=this._overlayClick.bind(this),i.globalChannel().subscribe("MobileInputFocus",this._touchKeyboardMoveHandler),this._options.closeButton)e.append('<div class="controls-PopupMixin__closeButton"></div>'),$(".controls-PopupMixin__closeButton",this.getContainer().get(0)).click(function(){t.setActive(true),t.hide()});if(this._findParentContainer())e.appendTo(this._getParentContainer());else e.appendTo("body");this._saveDefault(),this._resetToDefault();var o=this.getTopParent();if(o&&r.instanceOfModule(o,"Lib/Control/FloatArea/FloatArea"))this._parentFloatArea=o},_findParentContainer:function(){if(!this._options.parentContainer){var t=this._options.target?this._options.target:this._options.opener&&this._options.opener._container?this._options.opener._container:false,i=t?$(t).closest(".popup-container"):false;if(i.length)this._options.parentContainer=i}return this._options.parentContainer},_touchKeyboardMoveHandler:function(){this.recalcPosition()},_subscribeTargetMove:function(){if(this._options.target)this._targetChanges=l(this._options.target,true),this._targetChanges.subscribe("onMove",this._onTargetMove,this),this._targetChanges.subscribe("onVisible",this._onTargetChangeVisibility,this)},_unsubscribeTargetMove:function(){if(this._targetChanges)this._targetChanges.unsubscribe("onMove",this._onTargetMove),this._targetChanges.unsubscribe("onVisible",this._onTargetChangeVisibility)},_onTargetMove:function(t,i,e){if(this.isVisible()){if(this._options.closeOnTargetMove&&!e&&!n.getKeyboardAnimation())this.hide();else if(this.isFixed())this._initSizes();else if(!e)this.recalcPosition(),this._checkTargetPosition()}else this._initSizes()},_onTargetChangeVisibility:function(t,i){if(!i)this.hide()},_checkFixed:function(t){t=$(t);while(t.parent().length){if(this._options.parentContainer&&this._getParentContainer()[0]!==t[0])break;if("fixed"==t.css("position")){if($(this._container).css({position:"fixed"}),this._fixed)this._notify("onChangeFixed",true);return void(this._fixed=true)}else t=t.parent()}this._notify("onChangeFixed",false),this._fixed=false,$(this._container).css({position:"absolute"})},_saveDefault:function(){this._defaultCorner=this._options.corner,this._defaultVerticalAlignSide=this._options.verticalAlign.side,this._defaultHorizontalAlignSide=this._options.horizontalAlign.side},_getParentContainer:function(){var t=this._getOption("parentContainer");if(t instanceof jQuery)return t;else if(this._getOption("target"))return this._getOption("target").closest("."+t);else return $("."+t)},isFixed:function(){return this._fixed},recalcPosition:function(t,i){if(this._isVisible){if(this._currentAlignment={verticalAlign:this._options.verticalAlign,horizontalAlign:this._options.horizontalAlign,corner:this._options.corner},t){this._originsInited=true,this._container.css("height",""),this._container.css("width","");var e=this._container.get(0).scrollWidth,o=this._container.get(0).scrollHeight,s=parseFloat(this._container.css("max-width"),10)||e,n=parseFloat(this._container.css("max-height"),10)||o,r=this._container.outerWidth()-this._container.innerWidth();if(!i)this._resetToDefault();else this._isMovedV=false;this._containerSizes.originWidth=e>s?s:e+r,this._containerSizes.originHeight=o>n?n:o+r}if(void 0===this._fixed)this._checkFixed(this._options.target);if(this._initSizes(i),!this._originsInited)return;if(this._options.target){var h={top:this._targetSizes.offset.top,left:this._targetSizes.offset.left},l=this._getGeneralOffset(this._options.verticalAlign.side,this._options.horizontalAlign.side,this._options.corner);h.top=h.top+this._getUserOffset("vertical"),h.left=h.left+this._getUserOffset("horizontal"),h=this._addOffset(h,l),(h=this._getOffsetByWindowSize(h)).top=this._calculateOverflow(h,"vertical"),h.left=this._calculateOverflow(h,"horizontal");var a=this._container[0].offsetWidth-this._container[0].clientWidth-2*this._containerSizes.border;if(a&&"right"===this._options.horizontalAlign.side)h.left-=a;this._notifyOnAlignmentChange(),this._container.css({top:h.top+"px",left:h.left+"px"})}else if(!this._fixed){var f=this._bodyPositioning();this._container.offset(f)}if(t)this._resizeChilds()}},_resetToDefault:function(){this._isMovedV=false,this._isMovedH=false,this._options.corner=this._defaultCorner,this._options.verticalAlign.side=this._defaultVerticalAlignSide,this._options.horizontalAlign.side=this._defaultHorizontalAlignSide},setTarget:function(t){this._options.target=t,this._checkFixed(t),this._subscribeTargetMove(),this.recalcPosition(true)},getTarget:function(){return this._options.target},setVerticalAlign:function(t){if(this._options.verticalAlign=t,this._saveDefault(),this.isVisible())this.recalcPosition(true)},setHorizontalAlign:function(t){if(this._options.horizontalAlign=t,this._saveDefault(),this.isVisible())this.recalcPosition(true)},setModal:function(t){if(this._options.isModal!==t)this._options.isModal=t,this._setModal(t)},_setModal:function(i){var e=s._overlay;if(i)s.adjust(),e&&e.bind("mousedown",this._overlayClick);else t.releaseZIndex(this._zIndex),s.adjust(),e&&e.unbind("mousedown",this._overlayClick)},isModal:function(){return!!this._options.isModal},_overlayClick:function(){if(this._options.closeByExternalClick&&this.getId()==t.getMaxZWindow().getId())o.getTopWindow().hide()},moveToTop:function(){if(this.isVisible())t.releaseZIndex(this._zIndex),this._getZIndex(),this._container.css("z-index",this._zIndex),s.adjust()},_bodyPositioning:function(){var t=this._containerSizes.width,i=this._containerSizes.height,e=$("body"),o=e.outerHeight(true),s=e.outerWidth(true),n=this._defaultVerticalAlignSide,r=this._defaultHorizontalAlignSide,h={top:this._options.verticalAlign.offset||0,left:this._options.horizontalAlign.offset||0};if(!n)h.top=this._windowSizes.height/2+h.top-this._containerSizes.height/2;else if("bottom"==n)h.top=o-h.top-i;if(!r)h.left=this._windowSizes.width/2+h.left-this._containerSizes.width/2;else if("right"==r)h.left=s-h.left-t;if(this._containerSizes.requiredOffset.top>o)h.top=o-this._containerSizes.originHeight;if(this._containerSizes.requiredOffset.left>s)h.left=s-this._containerSizes.originWidth;return this._calculateBodyOverflow(h),h},_calculateBodyOverflow:function(t){if(t.top<0)t.top=0,this._setOverflowY(this._windowSizes.height);else this._resetOverflowY();if(t.left<0)t.left=0,this._setOverflowX(this._windowSizes.width);else this._resetOverflowX()},_setOverflowY:function(t){this.getContainer().css("overflow-y",a.firefox?"scroll":"auto"),this.getContainer().height(t)},_resetOverflowY:function(){this.getContainer().css({"overflow-y":"visible",height:""})},_setOverflowX:function(t){this.getContainer().css("overflow-x","auto"),this.getContainer().width(t)},_resetOverflowX:function(){this.getContainer().css({"overflow-x":"visible",width:""})},_clickHandler:function(t,i){if(this.isVisible()){var e=this,s=i.target,n;if(e._options.target&&e._options.targetPart)n=!!(e._options.target.get(0)==s||e._options.target.find($(s)).length);if(!n&&!o.checkInclusion(e,s)&&!this._isLinkedPanel(s))if($(s).hasClass("ws-window-overlay")){if(parseInt($(s).css("z-index"),10)<this._zIndex)e.hide()}else e.hide()}},_isLinkedPanel:function(t){var i=$(t).closest(".ws-float-area-stack-cut-wrapper").find(".ws-float-area");if(i.length)return t=i.wsControl().getOpener(),o.checkInclusion(this,t&&t.getContainer());return!!$(t).closest(".ws-info-box").length},_checkTargetPosition:function(){var t=this;if(this._options.target&&this._options.closeByExternalClick)var i=$(window).height(),e=this._options.target.offset().top-$(window).scrollTop()-i},_initSizes:function(t){var i=this._options.target,e=this._container;if(i){if(this._targetSizes={width:this._getTargetWidth(i),height:i.outerHeight(),offset:i.offset(),border:(i.outerWidth()-i.innerWidth())/2,boundingClientRect:i.get(0).getBoundingClientRect()},this._options.parentContainer){var o=this._getParentContainer(),s=o.offset();this._targetSizes.offset.top=this._targetSizes.offset.top-s.top+o.scrollTop(),this._targetSizes.offset.left=this._targetSizes.offset.left-s.left+o.scrollLeft()}if(a.isMobileAndroid)this._targetSizes.offset.top-=$(window).scrollTop(),this._targetSizes.offset.left-=$(window).scrollLeft();if(this._fixed&&!a.isMobileIOS)this._targetSizes.offset=this._targetSizes.boundingClientRect}this._containerSizes.border=(e.outerWidth()-e.innerWidth())/2;var n;if(t)n=this._getGeneralOffset(this._options.verticalAlign.side,this._defaultHorizontalAlignSide,this._options.corner,true);else n=this._getGeneralOffset(this._defaultVerticalAlignSide,this._defaultHorizontalAlignSide,this._defaultCorner,true);if(i)this._containerSizes.requiredOffset={top:n.top+this._targetSizes.offset.top+this._containerSizes.originHeight+(this._options.verticalAlign.offset||0)+this._margins.top-this._margins.bottom,left:n.left+this._targetSizes.offset.left+this._containerSizes.originWidth+(this._options.horizontalAlign.offset||0)+this._margins.left-this._margins.right};else this._containerSizes.requiredOffset={top:this._options.verticalAlign.offset+this._containerSizes.originHeight,left:this._options.horizontalAlign.offset+this._containerSizes.originWidth};this._containerSizes.width=this._containerSizes.originWidth,this._containerSizes.height=this._containerSizes.originHeight,this._containerSizes.boundingClientRect=e.get(0).getBoundingClientRect(),this._initWindowSizes()},_getTargetWidth:function(t){if(this._options._fixJqueryPositionBug)return t[0].offsetWidth;return t.outerWidth()},_initWindowSizes:function(){this._windowSizes={height:$(window).height()-n.getKeyboardHeight(),width:$(window).width()}},_initMargins:function(){if(!this._marginsInited){this._marginsInited=true;var t=this._container;this._margins={top:parseInt(t.css("margin-top"),10)||0,left:parseInt(t.css("margin-left"),10)||0,bottom:parseInt(t.css("margin-bottom"),10)||0,right:parseInt(t.css("margin-right"),10)||0},this._container.css("margin",0)}},_getOffsetByCorner:function(t,i){var e=this._targetSizes.height,o=this._targetSizes.width,s={top:0,left:0};switch(t){case"tr":s.left+=o;break;case"bl":s.top+=e;break;case"br":s.top+=e,s.left+=o}if(this._options.target&&!this._options.corner)throw new Error("PopupMixin: Параметр corner является обязательным");if(!i)this._options.corner=t;return s},_getOffsetBySide:function(t,i,e){var o={top:0,left:0};if("bottom"==t)o.top-=this._containerSizes.originHeight;if("right"==i)o.left-=this._containerSizes.originWidth;if(!e)this._options.horizontalAlign.side=i,this._options.verticalAlign.side=t;return o},_getGeneralOffset:function(t,i,e,o){var s=this._getOffsetByCorner(e,o),n=this._getOffsetBySide(t,i,o);return s=this._addOffset(s,n),s},_getOppositeOffset:function(t,i){var e="vertical"==i?this._options.horizontalAlign.side:this._options.verticalAlign.side,o,s,n;if(n=this._getOppositeCorner(t,e,i),"vertical"==i)s="top"==this._options.verticalAlign.side?"bottom":"top",o=this._getGeneralOffset(s,this._options.horizontalAlign.side,n);else s="left"==this._options.horizontalAlign.side?"right":"left",o=this._getGeneralOffset(this._options.verticalAlign.side,s,n);return o.top+=this._getUserOffset("vertical"),o.left+=this._getUserOffset("horizontal"),o},_getUserOffset:function(t){var i;if("vertical"==t)return i=!!this._isMovedV?-1:1,i*((this._options.verticalAlign.offset||0)+this._margins.top-this._margins.bottom);else return i=!!this._isMovedH?-1:1,i*((this._options.horizontalAlign.offset||0)+this._margins.left-this._margins.right)},_initOppositeCorners:function(){this._oppositeCorners={br:{horizontal:{top:"bl",bottom:"bl"},vertical:{left:"tr",right:"tr"}},tr:{horizontal:{top:"tl",bottom:"tr"},vertical:{left:"br",right:"br"}},bl:{horizontal:{top:"br",bottom:"br"},vertical:{left:"tl",right:"bl"}},tl:{horizontal:{top:"tr",bottom:"tr"},vertical:{left:"bl",right:"tr"}}}},_getOppositeCorner:function(t,i,e){return this._options.corner=this._oppositeCorners[t][e][i],this._options.corner},_getOffsetByWindowSize:function(t){switch(this._options.locationStrategy){case"dontMove":return t;case"bodyBounds":var i=this._fixed?0:$(window).scrollTop(),e=this._fixed?0:$(window).scrollLeft();if(this._isHorizontalOverflow()&&"right"!==this._options.horizontalAlign.side)t.left=this._windowSizes.width+e-this._containerSizes.originWidth;if(this._isVerticalOverflow()&&"bottom"!==this._options.verticalAlign.side)t.top=this._windowSizes.height+i-this._containerSizes.originHeight;if(t.top<0)t.top=0;if(t.left<0)t.left=0;return t;default:var o=this._targetSizes.offset;if(this._isVerticalOverflow()&&!this._isMovedV&&"bottom"!==this._options.verticalAlign.side)this._isMovedV=true,t.top=this._getOppositeOffset(this._options.corner,"vertical").top,t.top=this._addOffset(t,o).top;if(!this._isVerticalOverflow()&&this._isMovedV)this._isMovedV=false,t.top=this._getOppositeOffset(this._options.corner,"vertical").top,t.top=this._addOffset(t,o).top;if(this._isHorizontalOverflow()&&!this._isMovedH&&"right"!==this._options.horizontalAlign.side)this._isMovedH=true,t.left=this._getOppositeOffset(this._options.corner,"horizontal").left,t.left=this._addOffset(t,o).left;if(!this._isHorizontalOverflow()&&this._isMovedH)this._isMovedH=false,t.left=this._getOppositeOffset(this._options.corner,"horizontal").left,t.left=this._addOffset(t,o).left;var s=t.left+this.getContainer()[0].offsetWidth-this._windowSizes.width;if(s>0)t.left-=s;return t}},_isHorizontalOverflow:function(){var t=this._fixed?0:$(window).scrollLeft();return this._containerSizes.requiredOffset.left>this._windowSizes.width+t},_isVerticalOverflow:function(){var t=this._options.parentContainer?this._getParentContainer():$(window),i=this._fixed?0:t.scrollTop();return this._containerSizes.requiredOffset.top>this._windowSizes.height+i-(a.firefox?1:0)},_calculateOverflow:function(t,i){switch(this._options.locationStrategy){case"dontMove":return this._calculateOverflow_dontMove(t,i);default:return this._calculateOverflow_allocate(t,i)}},_calculateOverflow_dontMove:function(t,i){return"vertical"==i?t.top:t.left},_calculateOverflow_allocate:function(t,i){var e=this._options.verticalAlign.offset||0,o=this._options.verticalAlign.offset||0,s=this._container.get(0).scrollHeight,r="",h,l;if(h=this._getSpaces(this._options.corner),"vertical"==i){if(t.top<=0){if(this._overflowedV=true,this._container.css("overflow-y",a.firefox?"scroll":"auto"),this._container.get(0).scrollHeight>this._windowSizes.height)r=this._windowSizes.height;switch(h.bottom-=n.getKeyboardHeight(),this._options.locationStrategy){case"bodyBounds":this._container.css("height",r);break;default:if("top"!==this._options.verticalAlign.side)if(h.top<h.bottom)if(this._options.targetOverlay)this._container.css("height",r),t.top=this._windowSizes.height-this._container.get(0).scrollHeight-2*this._containerSizes.border;else this._isMovedV=!this._isMovedV,l=this._getOppositeOffset(this._options.corner,i),r=(h=this._getSpaces(this._options.corner)).bottom-e-this._margins.top+this._margins.bottom,t.top=this._targetSizes.offset.top+l.top;else if(t.top=0,!this._options.targetOverlay)r=h.top}}if(this._container.css("height",r),this._containerSizes.originHeight+e+this._margins.top-this._margins.bottom<h.bottom&&this._overflowedV)this._container.css("overflow-y","visible"),this._container.css("height",""),this._overflowedV=false;if(this._options.bodyBounds&&t.top<0)t.top=0;return t.top}else{if(t.left<0&&"left"!==this._options.horizontalAlign.side)if(this._overflowedH=true,this._container.css("overflow-x","auto"),h=this._getSpaces(this._options.corner),h.left<h.right)this._isMovedH=!this._isMovedH,l=this._getOppositeOffset(this._options.corner,i),h=this._getSpaces(this._options.corner),this._container.css("width",h.right-o-this._margins.left+this._margins.right),t.left=this._targetSizes.offset.left+l.left;else t.left=0,this._container.css("width",h.left-o-this._margins.left+this._margins.right);if(this._containerSizes.originWidth+o+this._margins.left-this._margins.right<h.right&&this._overflowedH)this._container.css("overflow-x","visible"),this._container.css("width",""),this._overflowedH=false;if(this._options.bodyBounds){if(t.left<0)t.left=0;if(this._containerSizes.requiredOffset.left>this._windowSizes.width)t.left=this._windowSizes.width-this._containerSizes.originWidth}return t.left}},_getSpaces:function(t){var i=this._targetSizes.offset,e=this._targetSizes.width,o=this._targetSizes.height,s=this._windowSizes.height+n.getKeyboardHeight(),r=this._windowSizes.width,h={top:0,left:0,bottom:0,right:0};switch(t){case"br":h.left=i.left+e,h.top=i.top+o;break;case"tr":h.left=i.left+e,h.top=i.top;break;case"tl":h.left=i.left,h.top=i.top;break;case"bl":h.left=i.left,h.top=i.top+o;break;default:return h}return h.bottom=s-h.top,h.right=r-h.left,h},close:function(){this.hide(),this.destroy()},_addOffset:function(t,i){var e={top:0,left:0};return e.top=t.top+i.top,e.left=t.left+i.left,e},_notifyOnAlignmentChange:function(){var t=this._defaultVerticalAlignSide!=this._currentAlignment.verticalAlign.side,i=this._defaultHorizontalAlignSide!=this._currentAlignment.horizontalAlign.side,e=t||i||this._options.corner!=this._currentAlignment.corner,o;if(this._container.toggleClass("controls-popup-revert-horizontal",i).toggleClass("controls-popup-revert-vertical",t),e)o={verticalAlign:this._options.verticalAlign,horizontalAlign:this._options.horizontalAlign,corner:this._options.corner},this._notify("onAlignmentChange",o)},_getZIndex:function(){this._zIndex=t.acquireZIndex(this._options.isModal,false,this._options.isHint),t.setVisible(this._zIndex)},getZIndex:function(){return this._zIndex},after:{init:function(){o.addNode(this,this.getParent()),this._initMargins()},show:function(){if(this._initMargins(),this.recalcPosition(true),this.moveToTop(),this._notify("onShow"),this._parentFloatArea)this._parentFloatArea.setHasPopupInside(true);if(this._options.activateAfterShow)h(this._container)},_keyboardHover:function(t){if(t.which===f.key.esc)this.hide()}},before:{show:function(){if(this._container.css({left:"-10000px",top:"-10000px"}),this._subscribeTargetMove(),this._options._canScroll&&f.browser.isMobilePlatform){var i=t.getMaxZWindow();if(f.$body.addClass("controls-ScrollContainer-overflow-scrolling-auto"),i)i.getContainer().removeClass("controls-Popup__touchScroll-fix");this.getContainer().addClass("controls-Popup__touchScroll-fix")}if(o.setTopWindow(this),!this._zIndex)this._getZIndex();if(this._options.isModal)this._setModal(true)},_onResizeHandler:function(){this._resizeInner()},_resizeInner:function(){if(this._checkFixed(this._options.target||$("body")),this.isVisible()&&!this._fixed)this.recalcPosition(false);else this._initSizes();this._checkTargetPosition()},destroy:function(){if(l(this._options.target,false),t.setHidden(this._zIndex),t.releaseZIndex(this._zIndex),o.removeNode(this),this._unsubscribeTargetMove(),i.globalChannel().unsubscribe("MobileInputFocus",this._touchKeyboardMoveHandler),i.globalChannel().unsubscribe("MobileInputFocusOut",this._touchKeyboardMoveHandler),i.channel("WindowChangeChannel").unsubscribe("onWindowScroll",this._onResizeHandler,this),this._options.closeByExternalOver)i.channel("WindowChangeChannel").unsubscribe("onDocumentMouseOver",this._clickHandler,this);else if(this._options.closeByExternalClick)i.channel("WindowChangeChannel").unsubscribe("onDocumentClick",this._clickHandler,this);if(this._options.isModal)this._setModal(false);if(this._options.closeButton)this.getContainer().find(".controls-PopupMixin__closeButton").off()},hide:function(){if(this._options.target)l(this._options.target,false)}},around:{hide:function(i){if(!this.isVisible())return;if(a.isMobileIOS)if(this.getContainer().find(document.activeElement).length>0)$(document.activeElement).trigger("blur");var o=this,s=this._notify("onClose"),n=function(){t.setHidden(o._zIndex),t.releaseZIndex(o._zIndex),o._zIndex=null},h=function(){if(t.deactivateWindow(this,function(){if(this._unsubscribeTargetMove(),this._options.isModal)this._setModal(false);if(this._parentFloatArea)this._parentFloatArea.setHasPopupInside(false)}.bind(this)),this._options._canScroll&&f.browser.isMobilePlatform){var i=t.getMaxZWindow();if(r.instanceOfMixin(i,"SBIS3.CONTROLS/Mixins/PopupMixin")&&i._options._canScroll)i.getContainer().addClass("controls-Popup__touchScroll-fix");else f.$body.removeClass("controls-ScrollContainer-overflow-scrolling-auto");o.getContainer().removeClass("controls-Popup__touchScroll-fix")}};if(s instanceof e)s.addCallback(function(t){if(false!==t)i.call(o),n(),o._fixedOffset=null,h.call(this)});else if(false!==s)i.call(this),n(),o._fixedOffset=null,h.call(this)}}}});
//# sourceMappingURL=PopupMixin.js.map
define("Lib/Mixins/LikeWindowMixin",["Core/CommandDispatcher","Core/IoC"],function(e,i){return{$protected:{_options:{ignoreTabCycles:false}},$constructor:function(){if(!this.getParent())this._parent=$("body").wsControl(),this._options.parent=this._parent;e.declareCommand(this,"resizeYourself",function(){if(this._resizeInner&&this._resizeInner(),!this._resizeInner)i.resolve("ILogger").error("LikeWindowMixin::_resizeInner","Необходимо реализовать метод перерисовки _resizeInner, вызываемый на команду resizeYourself");return true}.bind(this))}}});
//# sourceMappingURL=LikeWindowMixin.js.map
define("SBIS3.CONTROLS/InformationPopup",["Lib/Control/CompoundControl/CompoundControl","SBIS3.CONTROLS/Mixins/PopupMixin","Lib/Mixins/LikeWindowMixin","tmpl!SBIS3.CONTROLS/InformationPopup/InformationPopup","css!SBIS3.CONTROLS/InformationPopup/InformationPopup"],function(o,t,n,i){"use strict";var s=o.extend([t,n],{_dotTplFn:i,$protected:{_options:{status:"default",template:null}},$constructor:function(){},init:function(){s.superclass.init.call(this)},setStatus:function(o){this.getContainer().removeClass("controls-InformationPopup__status-"+this._options.status).addClass("controls-InformationPopup__status-"+o),this._options.status=o}});return s.resizable=false,s});
//# sourceMappingURL=InformationPopup.js.map
define("SBIS3.CONTROLS/Button",["js!WSControls/Buttons/Button","css!SBIS3.CONTROLS/Button/Button"],function(s){"use strict";var t=s.extend([],{_modifyOptions:function(){var s=t.superclass._modifyOptions.apply(this,arguments);return s.cssClassName+=" controls-Button",s.cssClassName+=" controls-Button-size__"+(!!s.size?s.size:"default"),s.cssClassName+=" controls-Button-color__"+(!!s.primary||"primary"===s.style?"primary":"default"),s.cssClassName+=!!s.primary||"primary"===s.style?" controls-Button__primary":"",s},show:function(){var s=this.isVisible();if(t.superclass.show.call(this),!s&&this.isPrimary())this.setDefaultButton(true)}});return t});
//# sourceMappingURL=Button.js.map
define("tmpl!SBIS3.ENGINE.LinkValidator",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Button","js!SBIS3.CONTROLS/Link"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],a={};a["js!SBIS3.CONTROLS/Button"]=e[1],a["js!SBIS3.CONTROLS/Link"]=e[2];var n=function e(n,r,i,o,l){function c(){}var s=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var g={};l&&l.isSetts&&(g=l.fullContext||{});var u="string"==typeof i?i:"",p=void 0===a?void 0:a,k={id:[],def:void 0},v=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),S=this&&this.includedTemplates?this.includedTemplates:{},T=d.getMarkupGenerator(o);try{var _=T.joinElements([T.createTag("div",{class:"engine-LinkValidator"},[T.createTag("div",{class:"engine-LinkValidator__body"},[T.createTag("div",{class:"engine-LinkValidator__body__title"},[T.createText(""+global.rk("Переход по подозрительной ссылке"))],{},k,this),T.createTag("div",{class:"engine-LinkValidator__body__mainText"},[T.createText(global.rk("Вы собираетесь перейти по ссылке, адрес которой не совпадает с её описанием")+".")],{},k,this),T.createTag("div",{class:"engine-LinkValidator__body__mainText_second"},[T.createText(global.rk("URL на который вы перейдете")+":")],{},k,this),T.createTag("div",{class:"engine-LinkValidator__body__link"},[T.createText(""+d.wrapUndef(d.utils.escape(d.getter(n,["link"]))))],{},k,this),T.createTag("div",{class:"engine-LinkValidator__body__description"},[T.createText(global.rk("Мы всегда заботимся о")+" "),T.createTag("span",{class:"engine-LinkValidator__body__domain"},[T.createText(""+global.rk("Вашей"))],{},k,this),T.createText(" "+global.rk("безопасности"))],{},k,this)],{},k,this),T.createTag("div",{class:"engine-LinkValidator__footer"},[T.createControl("wsControl","ws:SBIS3.CONTROLS/Button",{handlers:{onActivated:d.getTypeFunc("js!SBIS3.ENGINE.LinkValidator:buttonClickHandler",{})},caption:global.rk("Отменить переход"),name:"cancel",primary:"true",esc:!1},{name:"cancel",sbisname:"cancel"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},i,p,S,d.config,g),T.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{handlers:{onActivated:d.getTypeFunc("js!SBIS3.ENGINE.LinkValidator:buttonClickHandler",{})},caption:global.rk("Перейти по ссылке"),href:d.getter(n,["link"]),inNewTab:"true",name:"go",esc:!1},{name:"go",sbisname:"go"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},i,p,S,d.config,g)],{},k,this)],r,k,this)],u,k);k.def&&(_=T.chain(_,k,r),k=void 0)}catch(e){d.templateError("resources/SBIS3.ENGINE/components/LinkValidator/LinkValidator.tmpl",e,n)}return _||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.ENGINE.LinkValidator"}},n});
//# sourceMappingURL=LinkValidator.tmpl.map
define("js!SBIS3.ENGINE.LinkValidator",["SBIS3.CONTROLS/InformationPopup","tmpl!SBIS3.ENGINE.LinkValidator","css!SBIS3.ENGINE.LinkValidator","SBIS3.CONTROLS/Button","SBIS3.CONTROLS/Link"],function(e,t){var n={linkClickHandler:function(n){var a=["tensor.ru","sbis.ru"],r,i=new RegExp(a.join("|")+"$"),o=function(e){return e.replace(/https?:\/\//,"").replace(/\/$/,"")};if("A"!==n.target.nodeName){var l=$(n.target).closest("a");if(l.length)r=l[0];else r=n.target}else r=n.target;if("A"==r.nodeName&&void 0!=$(r).attr("href")&&o($(r).attr("href"))!==o($(r).text())&&"javascript:void(0)"!=r.href.replace(/ |;/g,"")&&"#"!=r.href&&0===$(r).parents("input,textarea,[contenteditable], .engine-LinkValidator, .LinkDecorator__wrap").length&&0!==$(r).parents(".ws-basic-style").length&&!(i.test(r.host)||i.test(r.hostname)||i.test(r.href.replace(/(\..{2,5})\/.*/i,"$1")))){n.preventDefault(),n.stopImmediatePropagation(),n.stopPropagation();var s=document.domain.replace(/(.*)\.(.*)\.(.*)/,"$2.$3"),d=new e({element:$("<div></div>"),template:t,status:"error",isModal:true,link:$(r).attr("href"),site:s,closeButton:true});d.show(),d.setActive(true)}},buttonClickHandler:function(){this.getTopParent().close()}},a=function(){document.addEventListener("click",n.linkClickHandler,true)};if("undefined"!==typeof document)if("complete"===document.readyState)a();else document.addEventListener("DOMContentLoaded",a);return n});
//# sourceMappingURL=LinkValidator.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.SiteSupport",["Core/core-instance","Core/core-merge","Core/IoC"],function(e,i,t){"use strict";var s={$protected:{_servicesSite:null,_getServicesSite:function(){return this._servicesSite},_setServicesSite:function(e){this._servicesSite=e}},after:{init:function(){this.subscribeTo(this,"onDestroy",function(){this._servicesSite=void 0,this._getServicesSite=void 0,this._setServicesSite=void 0})}},getServicesSite:function(){var i=this._getServicesSite(),s;if(null===i){if(e.instanceOfMixin(this,"SBIS3.Contacts.Mixins.Services.Site"))i=this;else{s=this.getParent();while(s)if(e.instanceOfMixin(s,"SBIS3.Contacts.Mixins.Services.Site")){i=s;break}else s=s.getParent()}if(!i)t.resolve("ILogger").error("Services.Executor.SiteSupport","Services.Site not found in parents");this._setServicesSite(i)}return i},mergeMixin:function(e,t,r){return r=r?r:{},r["clone"]=true,i(i({},t?e:s,{clone:true}),t?t:e,r)}};return s});
//# sourceMappingURL=SiteSupport.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Consumer",["Core/IoC","Core/ParallelDeferred","Core/Deferred","js!SBIS3.Contacts.Mixins.Services.Executor.SiteSupport"],function(e,r,i,n){"use strict";return n.mergeMixin({$protected:{_options:{consumedServices:void 0}},consume:function(r,i){var n=[{result:null,executed:false}];if(!r)return e.resolve("ILogger").error("Services.Consumer","serviceName required"),n;var t=this.getServicesSite();if(!t)return e.resolve("ILogger").error("Services.Consumer","Site of services is not found"),n;return t.consumeService(r,i,this)},waitExecution:function(e){for(var n=new i,t=new r,s=0;s<e.length;s++)if(e[s].executed&&e[s].result instanceof i)t.push(e[s].result);return t.done().getResult().addCallback(function(e){n.callback(e)}).addErrback(function(e){n.errback(e)}),n},after:{init:function(){var e;if(this._options.consumedServices)for(var r=function(e){this[e]=function(r){return this.consume(e,r)}},i=0;i<this._options.consumedServices.length;i++)e=this._options.consumedServices[i],r.bind(this)(e)}}})});
//# sourceMappingURL=Consumer.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.OpenFoundPosition",[],function(){"use strict";return{$protected:{_options:{noLoad:false}},after:{init:function(){this.subscribeTo(this,"onItemActivate",this._handlerOnItemActivateFoundMessage.bind(this))}},setNoLoad:function(){this._options.noLoad=true},_addingCursorOnSearch:function(e){this.getContainer()[this._isSearching(e)?"addClass":"removeClass"]("contacts-miniView__search")},_handlerOnItemActivateFoundMessage:function(e,n){var t=this;if(t._isSearching())t.consume("closeSmallSearch",{resetSearch:true,noLoad:true}),t.consume("closeMinSearch",{noLoad:true}),t.reloadDialog(t._getDialogId(),null,"",{beginMessage:n.id})}}});
//# sourceMappingURL=OpenFoundPosition.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.MessageClick.Dialog",["Core/core-instance","Core/detection"],function(e,i){"use strict";return{$protected:{_options:{messagesRegistry:void 0,notClickable:void 0}},before:{init:function(){this.once("onAfterShow",function(){var i=this,s=this._options.messagesRegistry;if(e.instanceOfModule(this,"SBIS3.CONTROLS/ListView"))i.subscribeTo(i,"onItemClick",i._handler_ItemClick_Dialog);else if(s&&"string"==typeof s)this.waitChildControlByName(s).addCallback(function(s){if(e.instanceOfModule(s,"SBIS3.CONTROLS/ListView"))s.subscribeTo(s,"onItemClick",i._handler_ItemClick_Dialog)})})}},_handler_ItemClick_Dialog:function(e,s,o,t){var n=this,a=$(t),l=i.isMobilePlatform||i.isMobileAndroid||i.isMobileIOS||i.isMacOSMobile||i.isMobileSafari,r=function(){if(n.isEnabled()&&!n._options.notClickable){var e=o.get("КонтактПерсона");if(null!=e[0]||null!=e[1])n.consume("changeReceivers",{addOrReplace:e[1]?e:[e[0]]})}};if(!l&&a.hasClass("person-photo-img"))r();else if(l&&a.hasClass("message-person-name"))r();else if(n._handlerSeparatorClick){var c=a.closest(".contacts-ChatHistory-separator");if(c.length)n._handlerSeparatorClick.call(n,c)}}}});
//# sourceMappingURL=MessageClick.Dialog.module.js.map
define("tmpl!SBIS3.Contacts.NotificationFooter/NotificationFooter",["Core/tmpl/js/tclosure"],function(){var t=Array.prototype.slice.call(arguments),e=t[0],o={},i=function t(i,r,a,n,c){function s(){}var l=0,d=void 0!==e&&e?e:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var f={};c&&c.isSetts&&(f=c.fullContext||{});var p="string"==typeof a?a:"",u=void 0===o?void 0:o,v={id:[],def:void 0},g=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),h=this&&this.includedTemplates?this.includedTemplates:{},m=d.getMarkupGenerator(n);try{var y=m.joinElements([m.createTag("div",{class:"contacts-NotificationFooter"},[d.getter(i,["text"])?[m.createTag("div",{class:"contacts-NotificationFooter_text"},[m.createText(" "+d.wrapUndef(d.Sanitize.apply(void 0,[d.getDecorators().sanitize.apply(void 0,[d.getter(i,["text"])])]))+" ")],{},v,this)]:m.createText(""),d.getter(i,["footer"])?[m.createTag("div",{class:"contacts-NotificationFooter_footer"},[m.createText(" "+d.wrapUndef(d.Sanitize.apply(void 0,[d.getDecorators().sanitize.apply(void 0,[d.getter(i,["footer"])])]))+" ")],{},v,this)]:m.createText("")],r,v,this)],p,v);v.def&&(y=m.chain(y,v,r),v=void 0)}catch(t){d.templateError("resources/Contacts.Mini/NotificationFooter.tmpl",t,i)}return y||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.NotificationFooter/NotificationFooter"}},i});
//# sourceMappingURL=NotificationFooter.tmpl.map
define("js!SBIS3.Contacts.NotificationFooter",["tmpl!SBIS3.Contacts.NotificationFooter/NotificationFooter","css!SBIS3.Contacts.NotificationFooter/NotificationFooter"],function(t){"use strict";return t});
//# sourceMappingURL=NotificationFooter.module.js.map
define("tmpl!SBIS3.Contacts.MessageInformer/MessageInformer",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],a={},s=function e(s,r,o,c,i){function n(){}var l=0,g=void 0!==t&&t?t:arguments[arguments.length-1];void 0===g&&(eval("var thelpers = null;"),g=global.requirejs("View/Runner/tclosure"));var p={};i&&i.isSetts&&(p=i.fullContext||{});var d="string"==typeof o?o:"",m=void 0===a?void 0:a,f={id:[],def:void 0},u=g.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),h=this&&this.includedTemplates?this.includedTemplates:{},v=g.getMarkupGenerator(c);try{var D=v.joinElements([v.createTag("div",{class:"contacts-MessageInformer"},[g.getter(s,["messageData","photoData"])?[v.createTag("div",{class:"contacts-MessageInformer__photoBlock"},[g.getter(s,["messageData","photoData","url"])?[v.createTag("img",{class:"contacts-MessageInformer__photo",src:""+g.wrapUndef(g.utils.escape(g.getter(s,["messageData","photoData","url"]))),width:g.wrapUndef(g.utils.escape(g.getter(s,["messageData","photoData","size"])))+"px",height:g.wrapUndef(g.utils.escape(g.getter(s,["messageData","photoData","size"])))+"px"},[],{},f,this)]:v.createText(""),v.createText(" "+g.wrapUndef(g.Sanitize.apply(void 0,[g.getDecorators().sanitize.apply(void 0,[g.getter(s,["messageData","activity"])])]))+" ")],{},f,this)]:v.createText(""),v.createTag("div",{class:"contacts-MessageInformer__dataBlock"},[v.createTag("div",{class:"contacts-MessageInformer__titleBlock"},[v.createTag("div",{class:"contacts-MessageInformer__personName",title:""+g.wrapUndef(g.utils.escape(g.getter(s,["messageData","author"])))},[v.createText(" "+g.wrapUndef(g.utils.escape(g.getter(s,["messageData","author"])))+" ")],{},f,this),g.getter(s,["messageData","department"])?[v.createTag("div",{class:"contacts-MessageInformer__personPlace",title:""+g.wrapUndef(g.utils.escape(g.getter(s,["messageData","department"])))},[v.createText(" "+g.wrapUndef(g.utils.escape(g.getter(s,["messageData","department"])))+" ")],{},f,this)]:v.createText("")],{},f,this),v.createTag("div",{class:"contacts-MessageInformer__messageText"},[v.createText(" "+g.wrapUndef(g.Sanitize.apply(void 0,[g.getDecorators().sanitize.apply(void 0,[g.getter(s,["messageData","text"])])]))+" ")],{},f,this)],{},f,this)],r,f,this)],d,f);f.def&&(D=v.chain(D,f,r),f=void 0)}catch(e){g.templateError("resources/Contacts.Mini/MessageInformer.tmpl",e,s)}return D||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.MessageInformer/MessageInformer"}},s});
//# sourceMappingURL=MessageInformer.tmpl.map
define("js!SBIS3.Contacts.MessageInformer",["tmpl!SBIS3.Contacts.MessageInformer/MessageInformer","css!SBIS3.Contacts.MessageInformer/MessageInformer"],function(e){"use strict";return e});
//# sourceMappingURL=MessageInformer.module.js.map
define("Core/defaultRenders",["require","Core/constants"],function(e,t){return{leadZero:function(e,t){var r=""+Math.floor(e);if(r.length<t)r="00000000000000000000000000000000".substr(0,t-r.length)+r;return r},integer:function(e,t){try{e=(""+e).trim()}catch(t){e=""}var r=/^-?([0]*)(\d+)\.?\d*\D*$/,i;if(!e.match(r))return"0";return i=e.replace(r,"$2"),("-"==e.substr(0,1)?"-":"")+(t?i:i.replace(/(?=(\d{3})+$)/g," ").trim())},logic:function(e,t){var r;if(e)r="ws-browser-checkbox-logic-true";else r="ws-browser-checkbox-logic-false";var i='<span class="ws-browser-checkbox-logic '+r+'"></span>';return t?i:$(i)},money:function(e){return this.real(e,2,true)},numeric:function(e,t,r,i,n,s,u){var a,f,l,o;if(-1!==(e+"").indexOf("e")&&!isNaN(parseFloat(e+""))&&isFinite(e+"")){l=(e=e.toFixed(20)).length;while("0"===e.charAt(l-1))--l;e=e.substr(0,l)}if(e=""+e,e=e.replace(n?/[^0-9\.]/g:/[^0-9\.\-]/g,""),a=e.indexOf("."),f=e.indexOf(".",a+1),o=/\-/.test(e)?1:0,-1!==f)e=e.substring(0,f);if(a===e.length-1)e=e.substr(0,e.length-1),a=-1;if(!/^\-?[0-9]*(\.[0-9]*)?$/.test(e))e="";if(""===e||null===e)e=null;else{if(t>=0){if(-1===a)a=e.length;if(t+o<a)e=e.substring(0,t+o)+e.substr(a);a=e.indexOf(".")}if(i<0)e=-1===a?this.integer(e,!r):[this.integer(e.substring(0,a),!r),e.substr(a)].join("");else e=e.substr(0,s&&!r?s:e.length),e=this.real(e,i,r,u)}return e},real:function(e,t,r,i){t=void 0===t?0:t;var n=(e+="").indexOf("."),s=e;if(-1!=n)s=e.substring(0,n);var u=-1!=n?e.substr(n):0,a=-1!==s.indexOf("-"),f;if("."==u)u=".0";if(i&&0!=parseFloat(u))f=parseFloat((u+"00000000000000000000000000000000").substr(0,t+1)).toFixed(t);else f=parseFloat(u).toFixed(t);if(1==f)s=parseInt(s,10),s=a?s-1:s+1;if(f=f.replace(/.+\./,""),0===t)return this.integer(s,!r);var l=[];return l.push(this.integer(s,!r)),l.push("."),l.push(f),l.join("")},timer:function(e){return Math.floor(e/1e3)+"."+this.leadZero(e%1e3,3)},timestamp:function(e,r,i){var n="";if("object"==typeof i&&"precision"in i)i=i.precision;else if(true===i)i="msec";else i="sec";if(e instanceof Date){if("Дата"==r)n=e.strftime(t.Date.masks.date);else if("Время"==r)n=e.strftime(t.Date.masks[i]);else if("Дата и время"==r)n=e.strftime(t.Date.masks.date)+" "+e.strftime(t.Date.masks[i])}else n="&minus;";return n},enumType:function(t){var r=e.defined("Deprecated/Enum")?e("Deprecated/Enum"):null;if(r&&t instanceof r){if(null===t.getCurrentValue())return"";return t.getValues()[t.getCurrentValue()]}return""},flags:function(e){var t=[];if(e.each(function(e,r){if(r)t.push(e)}),t.length)return t.join(", ");return"&minus;"},isText:function(e){return-1!==e.indexOf("char")||"text"==e}}});
//# sourceMappingURL=defaultRenders.js.map
define("Core/helpers/String/format",["require","Core/defaultRenders"],function(e,r){return function n(t,n){if(n&&n.saveProtoM)n=""+n;if("string"!==typeof n)return"";return n.replace(/\$([а-яА-Яa-zA-Z0-9_ .]+)\$(?:([sdD])|([t])\$([\s\S]*?)|([fF])(?:\$([0-9]+))?)\$/g,function(n,u,f,i,a,l,o){var s=t?t&&t.hasColumn&&t.hasColumn(u)?t.get(u):t.getValue&&"function"===typeof t.getValue?t.getValue(u):t[u]:null;if(i)f=i;if(l)f=l;if("t"===f)return s?s.strftime(a):"";if("d"===f||"D"===f)return r.integer(s,!!("d"===f));if("f"===f||"F"===f)return r.real(s,o?o:2,"f"!==f);var d=e.defined("Deprecated/Enum")?e("Deprecated/Enum"):null;if(d&&s instanceof d)return r.enumType(s);else return s?s:""})}});
//# sourceMappingURL=format.js.map
define("js!SBIS3.Contacts.DialogsViewerHelper",["Core/Context","js!WS.Data/Source/SbisService","Core/Deferred","Core/helpers/String/format"],function(e,a,t){"use strict";var l=void 0;return{getLastDialogsViewDate:function(l,i){var n=e.global.getValue("lastDialogsViewDate");if(l)return n;else{var s=new t;if(n&&!i)s.callback(n);else new a({endpoint:"ИнформерПерсона"}).call("Счетчики",{}).addCallbacks(function(a){var t=a.getScalar(),l=null;if(t&&t.last_dialog_view_time)l="string"===typeof t.last_dialog_view_time?Date.fromSQL(t.last_dialog_view_time):new Date(t.last_dialog_view_time);e.global.setValue("lastDialogsViewDate",l),s.callback(l)},function(e){s.callback(null)});return s}},updateLastDialogsViewDate:function(i,n){if(!i)i="actual";if("interface"===i||"full"===i||"actual"===i){var s=n&&n instanceof Date?n:new Date;e.global.setValue("lastDialogsViewDate",s)}if("bl"===i||"full"===i||"actual"===i){if(!l)l=new a({endpoint:"ИнформерПерсона"}).call("ПосмотретьДиалоги",{}).addCallback(function(a){if(l=void 0,"actual"===i){var t=a.getScalar();if(t)n="string"===typeof t?Date.fromSQL(t):new Date(t),e.global.setValue("lastDialogsViewDate",n)}return n});return l}else return t.success(s)},getLastDialogsViewFictiveDate:function(){return e.global.getValue("lastDialogsViewInterfaceDate")},setLastDialogsViewFictiveDate:function(a){var t=a&&a instanceof Date?a:new Date;e.global.setValue("lastDialogsViewInterfaceDate",t)}}});
//# sourceMappingURL=DialogsViewer.module.js.map
(function(){"use strict";var e=function(){return this||(0,eval)("this")}();(e.define||e.requirejs&&e.requirejs.define||requirejsVars&&requirejsVars.define)("browser",{load:function(e,r,i){if("undefined"!==typeof window)r([e],i,function(e){i.error(e)});else i(null)}})})();
//# sourceMappingURL=browser.js.map
define("tmpl!SBIS3.CONTROLS/SubmitPopup/resources/template",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={},r=function e(r,n,a,i,s){function l(){}var u=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var p={};s&&s.isSetts&&(p=s.fullContext||{});var m="string"==typeof a?a:"",d=void 0===o?void 0:o,g={id:[],def:void 0},S=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),v=this&&this.includedTemplates?this.includedTemplates:{},b=c.getMarkupGenerator(i);try{var B=b.joinElements([b.createTag("div",{class:"controls-SubmitPopup"+c.wrapUndef(c.utils.escape(c.getter(r,["autoWidth"])?"":c.getter(r,["message","length"])>c.getter(r,["messageMaxLength"])||c.getter(r,["details","length"])>c.getter(r,["detailsMaxLength"])?" controls-SubmitPopup__size-big":" controls-SubmitPopup__size-standard"))},[b.createTag("div",{class:"controls-SubmitPopup__body"},[c.getter(r,["messageTemplate"])||c.getter(r,["message"])?[b.createTag("div",{class:"controls-SubmitPopup__message "+c.wrapUndef(c.utils.escape(c.getter(r,["detailsTemplate"])||c.getter(r,["details"])?"controls-SubmitPopup__message_withDetails":""))},[c.getter(r,["messageTemplate"])?[b.createControl("resolver",c.getter(r,["messageTemplate"]),c.uniteScope(c.utils.escape(c.uniteScope(r,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},a,d,v,c.config,p,g)]:[b.createTag("div",{class:"controls-SubmitPopup__message-centered"},[b.createText(""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["message"])])])))],{},g,this)]],{},g,this)]:b.createText(""),c.getter(r,["detailsTemplate"])||c.getter(r,["details"])?[b.createTag("div",{class:"controls-SubmitPopup__details"},[c.getter(r,["detailsTemplate"])?[b.createControl("resolver",c.getter(r,["detailsTemplate"]),c.uniteScope(c.utils.escape(c.uniteScope(r,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},a,d,v,c.config,p,g)]:[b.createTag("div",{class:"controls-SubmitPopup__details-centered"},[b.createText(""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["details"])])])))],{},g,this)]],{},g,this)]:b.createText("")],{},g,this),b.createTag("div",{class:"controls-SubmitPopup__footer"},[b.createTag("div",{class:"controls-SubmitPopup__buttonContainer"},["confirm"===c.getter(r,["status"])||c.getter(r,["useConfirmButtons"])?[b.createControl("resolver",c.getter(r,["positiveButton","isLink"])?"SBIS3.CONTROLS/Link":"SBIS3.CONTROLS/Button",{primary:!0,name:"positiveButton",allowChangeEnable:!1,caption:c.getter(r,["positiveButton","caption"])},{class:"controls-SubmitPopup__button"+c.utils.escape(c.getter(r,["hasCancelButton"])?" controls-SubmitPopup__button-mini":"")+" controls-Button__ellipsis",name:"positiveButton",sbisname:"positiveButton"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},a,d,v,c.config,p,g),b.createControl("resolver",c.getter(r,["negativeButton","isLink"])?"SBIS3.CONTROLS/Link":"SBIS3.CONTROLS/Button",{name:"negativeButton",allowChangeEnable:!1,caption:c.getter(r,["negativeButton","caption"])},{class:"controls-SubmitPopup__button"+c.utils.escape(c.getter(r,["hasCancelButton"])?" controls-SubmitPopup__button-mini":"")+" controls-Button__ellipsis",name:"negativeButton",sbisname:"negativeButton"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},a,d,v,c.config,p,g),c.getter(r,["hasCancelButton"])?[b.createControl("resolver",c.getter(r,["cancelButton","isLink"])?"SBIS3.CONTROLS/Link":"SBIS3.CONTROLS/Button",{name:"cancelButton",allowChangeEnable:!1,caption:c.getter(r,["cancelButton","caption"])},{class:"controls-SubmitPopup__button controls-SubmitPopup__button-mini controls-Button__ellipsis",name:"cancelButton",sbisname:"cancelButton"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},a,d,v,c.config,p,g)]:b.createText("")]:[b.createControl("resolver",c.getter(r,["submitButton","isLink"])?"SBIS3.CONTROLS/Link":"SBIS3.CONTROLS/Button",{name:"okButton",primary:!0,allowChangeEnable:!1,caption:c.getter(r,["submitButton","caption"])},{class:"controls-SubmitPopup__button controls-Button__ellipsis",name:"okButton",sbisname:"okButton"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},a,d,v,c.config,p,g)]],{},g,this)],{},g,this)],n,g,this)],m,g);g.def&&(B=b.chain(B,g,n),g=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/SubmitPopup/resources/template.tmpl",e,r)}return B||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/SubmitPopup/resources/template"}},r});
//# sourceMappingURL=template.tmpl.map
define("SBIS3.CONTROLS/SubmitPopup",["Core/constants","SBIS3.CONTROLS/InformationPopup","Core/helpers/Function/runDelayed","tmpl!SBIS3.CONTROLS/SubmitPopup/resources/template","SBIS3.CONTROLS/Button","SBIS3.CONTROLS/Link","css!SBIS3.CONTROLS/SubmitPopup/SubmitPopup","css!Controls/ConfirmationWindow/Dialog/Dialog"],function(t,s,i,e){"use strict";var o=s.extend({$protected:{_options:{status:"default",message:"",details:"",positiveButton:{caption:rk("Да"),isLink:false},negativeButton:{caption:rk("Нет"),isLink:false},cancelButton:{caption:rk("Отмена"),isLink:false},submitButton:{caption:rk("ОК"),isLink:false},hasCancelButton:false,messageTemplate:null,detailsTemplate:null,template:e,messageMaxLength:100,detailsMaxLength:160,isModal:true,useConfirmButtons:false,autoWidth:false,additionalClass:"controls-SubmitPopup_popup"},_buttons:[]},$constructor:function(){this._publish("onChoose")},init:function(){o.superclass.init.call(this);var s=this;if("confirm"===this._options.status||this._options.useConfirmButtons){if(this._registerButton(this.getChildControlByName("positiveButton"),true),this._registerButton(this.getChildControlByName("negativeButton"),false),this._options.hasCancelButton)this._registerButton(this.getChildControlByName("cancelButton"))}else this._registerButton(this.getChildControlByName("okButton"));this.subscribe("onKeyPressed",function(i,e){if(e.which===t.key.esc)s._choose()}),i(function(){s.recalcPosition(true)})},_choose:function(t){if(false!==this._notify("onChoose",t))this.close()},_switchButton:function(t,s){var i=(t+(s?1:-1)+this._buttons.length)%this._buttons.length;this._buttons[i].setActive(true)},_registerButton:function(s,i){var e=this,o=this._buttons.length;this._buttons.push(s),this.subscribeTo(s,"onActivated",function(){e._choose(i)}),this.subscribeTo(s,"onKeyPressed",function(s,i){switch(i.which){case t.key.left:e._switchButton(o,false);break;case t.key.right:e._switchButton(o,true)}})}});return o});
//# sourceMappingURL=SubmitPopup.js.map
define("tmpl!SBIS3.CONTROLS/NotificationPopup/resources/template",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={},r=function e(r,i,n,a,c){function l(){}var p=0,s=void 0!==t&&t?t:arguments[arguments.length-1];void 0===s&&(eval("var thelpers = null;"),s=global.requirejs("View/Runner/tclosure"));var u={};c&&c.isSetts&&(u=c.fullContext||{});var d="string"==typeof n?n:"",f=void 0===o?void 0:o,v={id:[],def:void 0},m=s.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),N=this&&this.includedTemplates?this.includedTemplates:{},g=s.getMarkupGenerator(a);try{var h=g.joinElements([g.createTag("div",{class:"controls-NotificationPopup"},[g.createTag("div",{class:"controls-NotificationPopup__header"+s.wrapUndef(s.utils.escape(s.getter(r,["closeButton"])?" controls-NotificationPopup__header-withCloseButton":""))},[g.createControl("resolver",s.getter(r,["headerTemplate"]),s.uniteScope(s.utils.escape(s.uniteScope(r,{parent:void 0,element:void 0})(s.plainMerge)),{}),{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},n,f,N,s.config,u,v)],{},v,this),s.getter(r,["bodyTemplate"])?[g.createTag("div",{class:"controls-NotificationPopup__body"},[g.createControl("resolver",s.getter(r,["bodyTemplate"]),s.uniteScope(s.utils.escape(s.uniteScope(r,{parent:void 0,element:void 0})(s.plainMerge)),{}),{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},n,f,N,s.config,u,v)],{},v,this)]:g.createText(""),s.getter(r,["footerTemplate"])?[g.createTag("div",{class:"controls-NotificationPopup__footer"},[g.createControl("resolver",s.getter(r,["footerTemplate"]),s.uniteScope(s.utils.escape(s.uniteScope(r,{parent:void 0,element:void 0})(s.plainMerge)),{}),{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},n,f,N,s.config,u,v)],{},v,this)]:g.createText("")],i,v,this)],d,v);v.def&&(h=g.chain(h,v,i),v=void 0)}catch(e){s.templateError("resources/SBIS3.CONTROLS/NotificationPopup/resources/template.tmpl",e,r)}return h||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/NotificationPopup/resources/template"}},r});
//# sourceMappingURL=template.tmpl.map
define("tmpl!SBIS3.CONTROLS/NotificationPopup/resources/headerTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,n,a,c){function l(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var p={};c&&c.isSetts&&(p=c.fullContext||{});var d="string"==typeof n?n:"",f=void 0===r?void 0:r,v={id:[],def:void 0},h=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},N=u.getMarkupGenerator(a);try{var S=N.joinElements([N.createTag("div",{class:"controls-NotificationPopup__header_icon"},[],i,v,this),N.createTag("div",{class:"controls-NotificationPopup__header_caption"},[N.createText(""+u.wrapUndef(u.utils.escape(u.getter(o,["caption"]))))],i,v,this)],d,v);v.def&&(S=N.chain(S,v,i),v=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/NotificationPopup/resources/headerTpl.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/NotificationPopup/resources/headerTpl"}},o});
//# sourceMappingURL=headerTpl.tmpl.map
define("SBIS3.CONTROLS/NotificationPopup",["SBIS3.CONTROLS/InformationPopup","tmpl!SBIS3.CONTROLS/NotificationPopup/resources/template","tmpl!SBIS3.CONTROLS/NotificationPopup/resources/headerTpl","Core/detection","css!SBIS3.CONTROLS/NotificationPopup/NotificationPopup"],function(t,o,i,n){"use strict";var s={success:"icon-size icon-24 icon-Yes icon-done",error:"icon-size icon-24 icon-Alert icon-error",warning:"icon-size icon-24 icon-Alert icon-attention",default:""},e=t.extend({$protected:{_options:{headerTemplate:i,bodyTemplate:null,footerTemplate:null,icon:null,caption:null,template:o,activableByClick:false,additionalClass:"controls-NotificationPopup_popup",closeButton:true},_customIcon:false},init:function(){e.superclass.init.call(this);var t=this;if(this._options.icon)this.setIcon(this._options.icon);else this.setStatus(this._options.status);if(n.isMobilePlatform)this.getContainer().on("swipe",function(){t.close()})},setCaption:function(t){if("string"===typeof t)this.getContainer().find(".controls-NotificationPopup__header_caption").text(t)},setIcon:function(t){if("string"===typeof t)this._setIcon(t),this._customIcon=true},setStatus:function(t){if(!this._customIcon)this._setIcon(s[t]||"");e.superclass.setStatus.call(this,t)},_setIcon:function(t){this.getContainer().find(".controls-NotificationPopup__header_icon").removeClass(this._options.icon).addClass(t),this._options.icon=t},destructor:function(){if(n.isMobilePlatform)this.getContainer().off("swipe");e.superclass.destructor.call(this)}});return e});
//# sourceMappingURL=NotificationPopup.js.map
define("SBIS3.CONTROLS/Utils/InformationPopupManager",["Core/core-merge","SBIS3.CONTROLS/SubmitPopup","SBIS3.CONTROLS/NotificationPopup","browser!js!SBIS3.CONTROLS/Utils/NotificationStackManager","Core/constants","Core/helpers/Function/runDelayed"],function(e,t,o,i,n,r){"use strict";var s=function(o,i,s,a){if(o.message&&"error"===o.status)o.message=o.message.toString().replace("Error: ","");var u=new t(e(o,{element:$("<div></div>"),isModal:true}));if(u.subscribeOnceTo(u,"onChoose",function(e,t){var o;switch(t){case true:o=i;break;case false:o=s;break;default:o=a}if(o&&"function"===typeof o)o.call(u)}),n.browser.isIE)r(function(){u.show(),u.setActive(true)});else u.show(),u.setActive(true);return u};return{showConfirmDialog:function(t,o,i,n){return s(e(t,{status:"confirm"}),o,i,n)},showMessageDialog:function(e,t){return s(e,null,null,t)},showNotification:function(t,n){var r=new o(e({element:$("<div></div>")},t));return i.showNotification(r,n),r},showCustomNotification:function(e,t){return i.showNotification(e,t),e}}});
//# sourceMappingURL=InformationPopupManager.js.map
define("js!SBIS3.CONTROLS.Utils.InformationPopupManager",["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(n){return n});
//# sourceMappingURL=Utils_InformationPopupManager.module.js.map
define("Transport/prepareGetRPCInvocationURL",["Core/core-merge","Core/constants","Core/Context","Core/helpers/string-helpers-min"],function(e,r,n,o){"use strict";return function t(i,a,f,l,p,s){var c=p||r.defaultServiceUrl,C=encodeURIComponent(i+"."+a),d=e({},f||{}),m=s||0,u,R;for(var g in d)if(d.hasOwnProperty(g)){var O=d[g];if(null!==O&&"object"===typeof O&&"fieldName"in O)d[g]=(l||n.global).getValue(O.fieldName);if("ИдО"===g){var v=d[g];if(!v)return"";if("string"===typeof v){if(u=String(v).split(","),1===u.length)u=[u[0],""];if(R=u[1]||i,u[0])d[g]=u[0];C=encodeURIComponent(R+"."+a)}}}return c+"?id="+m+"&method="+C+"&protocol="+r.JSONRPC_PROOTOCOL_VERSION+"&params="+encodeURIComponent(o.serializeURLData(d))}});
//# sourceMappingURL=prepareGetRPCInvocationURL.js.map
define("Core/Indicator",["Core/moduleStubs"],function(e){return{_container:void 0,_ready:false,_dReady:void 0,_init:function(t){var i=this;if(!t)t={};if(t.handlers={onReady:function(){i._ready=true}},!this._dReady)this._dReady=e.requireModule("Deprecated/Controls/LoadingIndicator/LoadingIndicator").addCallback(function(e){return i._container=new e[0](t),i._container});return this._dReady},show:function(e){if(!this._ready)this._init({delay:e}).addCallback(function(e){return e.show(),e});else this._container.setDelay(e),this._container.show();return this},setMessage:function(e,t){var i=this;if(!this._ready)this._init({delay:t}).addCallback(function(t){return t.setMessage(e),t.subscribe("onReady",function(){this.setMessage(e)}),t});else if(this._container.setDelay(t),this._container.isVisible()&&t)this._container.show(),this._container._getDelay().addCallback(function(t){return i._container.setMessage(e),t});else i._container.setMessage(e),this._container.show();return this},hide:function(){if(this._ready)this._container.hide();else this._init().addCallback(function(e){return e.hide(),e});return this},progressBar:function(e){var t=this;if(!this._ready)this.destroy(),this._init({progressBar:e});else if(!(this._container._myProgressBar&&e))this.destroy(),this._init({progressBar:e});return t},setProgress:function(e){if(!this._ready)this._init().addCallback(function(t){return t.setProgress(e),t.subscribe("onReady",function(){this.setProgress(e)}),t});else this._container.setProgress(e);return this},destroy:function(){if(this._ready)this._container.destroy();else this._init().addCallback(function(e){return e.destroy(),e});return this._container=void 0,this._ready=false,this._dReady=void 0,this}}});
//# sourceMappingURL=Indicator.js.map
define("js!SBIS3.Contacts.CoreMiniFunctions",["Core/Context","Core/constants","js!WS.Data/Source/SbisService","Core/Deferred","Core/helpers/String/format","Core/helpers/String/escapeHtml","Core/IoC","js!SBIS3.CONTROLS.Utils.InformationPopupManager","js!SBIS3.Contacts.MessageInformer","Core/UserInfo","js!SBIS3.Contacts.DialogsViewerHelper","js!SBIS3.Contacts.NotificationFooter","Core/Indicator","Transport/prepareGetRPCInvocationURL","Core/i18n","Core/UserInfo"],function(e,t,n,r,a,o,s,i,l,c,u,f,g,D,C,B){"use strict";var d={question:function(e,t){var n=new r;return i.showConfirmDialog({message:e,opener:t},function(){n.callback(true)},function(){n.callback(false)},function(){n.callback(false)}),n},alert:function(e,t){var n=new r;return i.showMessageDialog({message:e,status:"error",opener:t},function(){n.callback()}),n},chatUnLock:function(e,t,r){var a=r.get("Тема");new n({endpoint:"Чат"}).call("Восстановить",{"Чат":a}).addCallbacks(function(e){var t=e.getRawData(),n={chat:a,status:0,msg_action:t};require(["js!SBIS3.Contacts.MessagesExchangeEvents"],function(e){e.doAndNotify("onLockChat",n),e.onNewMessageFromServiceChat(n,"Contacts.onLockChat")})},d.defaultErrorForSend)},checkCorrespondenceAvailabilityWithoutAccess:function(e){var t=new n({endpoint:"Персона",idProperty:"Персона"}),a=new r,o=[],l=[],c=0;return t.call("КПроверитьВозможностьПереписки",{"Персоны":e}).addCallbacks(function(e){for(var t=e?e.getAll():null,n,r=0;r<t.getCount();r++)if(n=t.at(r),n.has("ЕстьПользователь")&&n.get("ЕстьПользователь"))o.push(n.get("Персона"));else{if(c<3)l.push(d.getFIOFromRec(n));c++}if(c){var s=[rk("Следующие контакты не будут добавлены:")+"\n",l.join(",\n"),d.getMoreStr(c,3),".\n",rk("В чат можно добавить только тех пользователей, у которых есть доступ в систему.")].join("");i.showMessageDialog({message:s,status:"error"})}a.callback(o)},function(e){s.resolve("ILogger").error(e),a.callback([])}),a},getFIOFromRec:function(e){var t=[],n,r;if((e.has&&e.has("Фамилия")||e.hasColumn&&e.hasColumn("Фамилия"))&&e.get("Фамилия"))t.push(e.get("Фамилия"));if((e.has&&e.has("Имя")||e.hasColumn&&e.hasColumn("Имя"))&&e.get("Имя"))t.push(e.get("Имя"));if(!t.length)if((e.has&&e.has("ФИО")||e.hasColumn&&e.hasColumn("ФИО"))&&e.get("ФИО"))t.push(e.get("ФИО"));else if(e.has&&e.has("Название")||e.hasColumn&&e.hasColumn("Название"))t.push(e.get("Название"));else if(e.has&&e.has("НазваниеПолное")||e.hasColumn&&e.hasColumn("НазваниеПолное"))r=(n=e.get("НазваниеПолное")).split(" "),t.push(r[0]),t.push(r[1]);var a=o(t.join(" "));return a=a&&a.length?a:"["+rk("Неизвестный пользователь")+"]",a},showPopupNotification:function(e){var t={};if(e.tag)switch(e.tag){case"newMessage":t={template:l,messageData:{authorId:e.userId,author:e.author,department:e.department,post:e.post,text:e.fullText,activity:e.activity,photoData:{oid:e.userId,url:e.photo,size:e.photoSize}}};break;case"serviceMessage":t={caption:e.caption,text:e.text,footer:e.footer,status:e.status?e.status:"success",icon:e.icon?e.icon:e.icon,footerTemplate:f};break;case"sendMessageSuccess":t={caption:e.caption,status:"success",icon:"icon-24 icon-Send icon-done"};break;default:t={caption:e.caption,status:e.status?e.status:"default",icon:e.icon?e.icon:""}}else{if(e.footer||e.text)t={caption:e.caption,text:e.text,footer:e.footer,footerTemplate:f};else t={caption:e.caption};if(e.type&&!e.status){switch(e.type){case"success":t.status="success";break;case"warning":t.status="warning";break;case"error":case"danger":t.status="error";break;default:t.status="default"}t.icon=e.icon?e.icon:""}else t.status=e.status?e.status:"default",t.icon=e.icon?e.icon:""}i.showNotification(t)},getMoreStr:function(e,t){var n="";if(e>t){var r=e-t;if(n+=" "+rk("и еще")+" "+r+" "+rk("человек"),r>1&&r<5)n+="а"}return n},callIfContentBecomeVisibleForUser:function(e,t,n){var r=null,a=false,o=this,s=function(){if(!a&&(!t||"function"===typeof t.isDestroyed&&!t.isDestroyed())&&(!r||!r.isDestroyed()))if(d.isContentVisibleForUser.bind(o)(e,t,r))a=true,n();else{if(e&&t&&r)t.subscribeOnceTo(r,"onTabChange",s);if(t&&!t.isVisibleWithParents())t.subscribeOnceTo(t,"onaftervisibilitychange",s);$(document).one("webkitvisibilitychange mozvisibilitychange visibilitychange",s)}};if(e&&t&&"function"===typeof t.getParentByClass)r=t.getParentByClass("SBIS3.Contacts.WorkSpaceTabs");s()},isBilling:function(){return!!t.modules["Биллинг"]},isContentVisibleForUser:function(e,t,n){var r=(void 0===document.visibilityState||"visible"===document.visibilityState)&&!document.hidden;if(e&&t&&r)return n=n||t.getParentByClass("SBIS3.Contacts.WorkSpaceTabs"),n?n.isTabActive(e):r&&t.isVisibleWithParents();else if(this&&this.isVisibleWithParents)return this.isVisibleWithParents()&&r;else return r},isContentVisibleForUserAnnonim:function(e,t){return this.isContentVisibleForUser(e,t)&&!!(document.body.clientHeight&&document.body.clientWidth)},getPhotoIdCurrentPerson:function(){return["pfm_",c.get("ИдентификаторСервисаПрофилей"),"_",c.get("ИдентификаторКлиента")].join("")},getUserId:function(){var t=e.global.getValue("mypersonid")||B.get("ИдентификаторСервисаПрофилей");if("__сбис__аноним"===B.get("КлассПользователя"))if(!t)t=$.cookie("CpsUserId"),e.global.setValue("mypersonid",t);return t},isCurrentPerson:function(e){return e===this.getUserId()},onDataLoadError:function(e,t){if(e.setResult(true),t.details&&502===parseInt(t.details,10)&&t.message)d.defaultErrorForSend(t,true);else if(!t.details&&t.message)d.defaultErrorForSend(rk("При получении данных от сервера произошла ошибка. Попробуйте обновить страницу"),true),s.resolve("ILogger").error("Ошибка при обработке данных от сервера",t.message);else d.defaultErrorForSend("",true)},openDocWithMsg:function(e,t,n,r,a,o,s,i){require(["js!SBIS3.Contacts.OpenerHelper"],function(l){l.openDocWithMsg(e,t,n,r,a,o,s,null,null,i)})},defaultErrorForSend:function(t,n,a){var o,s,l,c=true;if("object"===typeof t)if(1502===t.error_code)o=t.details.split(",")[1];else l=t.message;if(!t)o=rk("Сервис сообщений");if(o)l=[o,"\n",rk("на техническом обслуживании")].join(""),s=[rk("Мы знаем об этом и уже исправляем."),"\n",rk("Попробуйте заглянуть сюда через 15 минут.")].join("");if(!l)l=t;if(g.hide(),n=n||false,a=a||false,!a){var u=e.global.getValue("contactsLastError");if(u)c=new Date-u>1e4}if(c&&l&&(n||-1!==window.location.href.indexOf("contacts.html")||$("[templatename='js!SBIS3.Contacts.WorkSpaceTabs']").length||$("[templatename='js!SBIS3.Contacts.SenderViewerBP']").length||$("[templatename='js!SBIS3.Contacts.Chats']").length||$("[data-component='SBIS3.Contacts.Chats']").length||$("[data-component='SBIS3.Contacts.SingleChat']").length||$("[templatename='js!SBIS3.Contacts.SingleChat']").length||$("[data-component='SBIS3.Contacts.SingleChatGroup']").length||$("[templatename='js!SBIS3.Contacts.SingleChatGroup']").length||$("[data-component='SBIS3.Contacts.SingleChatConsultant']").length||$("[templatename='js!SBIS3.Contacts.SingleChatConsultant']").length||$("[templatename='js!SBIS3.Contacts.SendViewDialog']").length||$("[templatename='js!SBIS3.Contacts.SendViewChat']").length||$("[templatename='js!SBIS3.Contacts.Consultations']").length||$("[data-component='SBIS3.Contacts.Consultations']").length)){var f={message:l,status:"error"};if(s)f["details"]=s;i.showMessageDialog(f),e.global.setValue("contactsLastError",new Date)}return r.fail(l)},alertShow502:false,msgNotWork:function(e){if(e&&"object"===typeof e&&502===parseInt(e.details,10)){if(false===d.alertShow502&&$(".contacts-area").length>0)d.alertShow502=true,d.defaultErrorForSend(e).addBoth(function(){d.alertShow502=false});return true}else return false},sendMessageErrorOut:function(e){var t=e?e.details?e.details:e.message:"",n=e&&e.message?e.message:"",r=s.resolve("ILogger");if(0===t.indexOf("<log>"))r.log("Для информации",t.substring(5));else r.error("Произошла ошибка при отправке сообщения",t);if(n)e.message=n;d.defaultErrorForSend(e)},errorMessageService:function(e,t){if(function(e){if(e&&"object"===typeof e)if(502===parseInt(e.details,10))return d.defaultErrorForSend(e,t),true;return false}(e))return;var r=[rk("Извините, основной сервис временно недоступен, идут профилактические работы.")," ",rk("Попробуйте повторить чуть позже")].join("");return new n({endpoint:"msgAPI2"}).call("Status",{}).addCallbacks(function(e){if(!e.getRawData())d.defaultErrorForSend("",t);else d.defaultErrorForSend(r,t)},function(){d.defaultErrorForSend(r,t)})},getStringWithCrc32Pref:function(e){return e=d.utf16toUtf8(e),["&re",d.getCrc32ForString(e),e].join("_")},utf16toUtf8:function(e){for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);if(55296<=r&&r<=56319){var a=r,o=e.charCodeAt(n+1);if(!isNaN(o))n++,t+="&#x"+(r=1024*(a-55296)+(o-56320)+65536).toString(16).toUpperCase()+";"}else t+=e[n]}return t},getCrc32ForString:function(e){var t=["00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F ","E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 ","09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 ","F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 ","136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 ","FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 ","3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C ","DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 ","26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 ","CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 ","2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 ","98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 ","7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D ","91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E ","6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 ","8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 ","4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 ","A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 ","44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA ","BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F ","5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 ","B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A ","EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 ","0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 ","F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB ","196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC ","F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E ","38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B ","D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 ","316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 ","CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 ","2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D ","9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F ","72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 ","92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 ","68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 ","88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 ","616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 ","A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC ","40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 ","BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 ","54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 ","B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D"].join(""),n=0,r=0;if(e=d.utf8Encode(e),"undefined"===typeof a)var a=0;a^=-1;for(var o=0,s=e.length;o<s;o++)r=255&(a^e.charCodeAt(o)),a=a>>>8^(n="0x"+t.substr(9*r,8));return-1^a},utf8Encode:function(e){var t="";e=e.replace(/\r\n/g,"\n");for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128)t+=String.fromCharCode(r);else if(r>127&&r<2048)t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128);else t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128)}return t},hasViewFastAnswer:function(e,t,n){if(e.hasChildControlByName("FastAnswer")){if(!t)return true;if("БыстрыйОтвет"===t.get("ДляИнтерфейса"))return true;var r=e.getUserData("БыстрыйОтветЗапись");return r&&r.t===t.get("Тема")&&(!n||r.id===t.getId()||r.m===t.get("Сообщение"))}return false},isInMySbis:function(){return"__сбис__физики"===c.get("КлассПользователя")},isCurrentClient:function(e){return e===c.get("ИдентификаторКлиента")},getCachedPhotoUrl:function(t,n,r){if(!t)s.resolve("ILogger").error("Не задан параметер photoId"),t="";return D("СервисПрофилей","ФотоПоИд",{"Ид":t},e.global,n?"/previewer/r/"+n+"/"+n+"/service/":"/previewer/service/")},getServiceMessage:function(e,t,n){var r="";switch(t=t?" "+t:"",n=n||{},e){case"new_invitation":case"employee_invitation":r=a({org:t},rk("Приглашение на подключение к аккаунту компании$org$s$.","sign_msg"));break;case"accepted_invitation":r=rk("Приглашение принято","sign_msg");break;case"declined_invitee_invitation":r=rk("Приглашение отклонено","sign_msg");break;case"declined_invitaion":r=rk("Приглашение вами отклонено","sign_msg");break;case"accepted_employee_invitation":r=a({org:t},rk("Вы подключены к аккаунту компании$org$s$. <br>Для переключения между аккаунтами воспользуйтесь вспомогательным меню в верхней правой части экрана.","sign_msg"));break;case"accepted_new_invitation":r=a({org:t},rk("Приглашение вами принято, но вы еще не подключены к аккаунту компании$org$s$. <br>Ожидайте завершения операции. Вы получите уведомление в  верхней части экрана.","sign_msg"));break;case"not_sign":r=rk("Подпись отклонена","sign_msg");break;case"sign":r=rk("Документы подписаны","sign_msg");break;case"for_first_sign":case"for_second_sign":case"for_sign":r=rk("Запрос подписи","sign_msg");break;default:if(n&&n.serviceMessage)r='<div style="color: '+n.serviceMessageColor+' !important;">'+rk(n.serviceMessage)+"</div>"}return r},getPhotoUrl:function(t,n){if(!t)s.resolve("ILogger").error("Не задан параметер personGUID"),t="00000000-0000-0000-0000-000000000000";return D("Персона","ФотоПерсоны",{"Персона":t,"МинСторона":n,"Клиент":e.global.getValue("myclientid")})},getGroupPhotoUrl:function(e){if(!e)s.resolve("ILogger").error("Не задан параметер personGUIDArray"),e=["00000000-0000-0000-0000-000000000000"];return D("Персона","ФотоТемы",{"Персоны":e,"Размер":40})},getPersonPhotoHTML:function(e,t,n,r,a){return'<div class="contacts-person-photo '+(n?n:"")+'" id="'+(t?t:"")+'"'+' style="background-image:url('+(r?d.getGroupPhotoUrl(e,40,a):d.getPhotoUrl(e,40))+");"+' background-size: cover;" person="'+e+'" data-minicard-oid="'+e+'" data-minicard-template="js!SBIS3.PersonalOffice.MiniCard" ></div>'},plural:function(e,t,n,r,a){var o=function(){if(e%1>0)return a;if(e%=100,e>=11&&e<=19)return r;if(e%=10,1===e)return t;if(2===e||3===e||4===e)return n;else return r},s=function(){if(e>1||0===e)return n;return t};return"ru-RU"===C.getLang()?o():s()},checkElementByClass:function(e,t,n){var r=function(t){return e.className.indexOf(t)>=0};return n?t.every(r):t.some(r)},checkOnScreen:function(e,t,n){var r=null;if(e.length&&e[0]){var a=e.offset(),o=e.width(),s=e.height(),i=a.top+(n&&"number"===typeof n.top?n.top:0),l=a.left+(n&&"number"===typeof n.left?n.left:0),c=l+o+(n&&"number"===typeof n.right?n.right:0),u=i+s+(n&&"number"===typeof n.bottom?n.bottom:0);if("number"!==typeof t.right)t.right=t.left+t.width;if("number"!==typeof t.bottom)t.bottom=t.top+t.height;(r={left:l-t.left,right:t.right-c,top:i-t.top,bottom:t.bottom-u}).verticalInside=!(r.top<=-1*s||r.bottom<=-1*s),r.horizontalInside=!(r.left<=-1*o||r.right<=-1*o),r.inside=r.verticalInside&&r.horizontalInside,r.absoluteInside=r.left>0&&r.right>0&&r.top>0&&r.bottom>0}return r},loadDialogsSettings:function(){var t={closeAfterSend:true,timeInterval:1,startDate:null,endDate:null},a=e.global.getValue("dialogSettings"),o=new r;if(void 0!==a)o.callback();else new n({endpoint:"ПользовательскиеПараметры"}).call("ПолучитьЗначение",{"Путь":"ОбменСообщениями.НастройкиДиалогов"}).addCallbacks(function(n){var r=n.getScalar();if(r)try{var a=JSON.parse(r);t.closeAfterSend=a.closeAfterSend,t.timeInterval=a.timeInterval,t.startDate=a.startDate?new Date(a.startDate):null,t.endDate=a.endDate?new Date(a.endDate):null}catch(e){}e.global.setValue("dialogSettings",t),o.callback()},function(){e.global.setValue("dialogSettings",t),o.callback()});return o},getLastDialogsViewDate:function(e,t){return u.getLastDialogsViewDate(e,t)},updateLastDialogsViewDate:function(e,t){return u.updateLastDialogsViewDate(e,t)},getPeriodLimit:function(e){var t=e.timeInterval+"",n="",r=new Date,a=new Date;switch(t){case"1":a=null,r=null,n=rk("весь период","contacts");break;case"2":a.setHours(0,0,0,0),n=rk("сегодня","contacts");break;case"3":a.setMonth(a.getMonth()-1),n=rk("последний месяц","contacts");break;case"4":a.setMonth(a.getMonth()-6),n=rk("последние полгода","contacts");break;case"5":a.setFullYear(a.getFullYear()-1),n=rk("последний год","contacts");break;case"6":a=e.startDate,r=e.endDate,n=rk("период","contacts");break;default:t=null}if(a)a.setHours(0,0,0,0);if(r)r.setHours(23,59,59,0);return t?{period:t,"ДатНач":a,"ДатКнц":r,name:n}:null},showCompanyAcceptMessage:function(){var e=function(){return['<div style="text-align: center;">',rk("Вы подключены к аккаунту компании. Для переключения между аккаунтами воспользуйтесь вспомогательным меню в верхней правой части экрана."),"<br>",rk("Подробнее в"),' <a href="https://help.sbis.ru/help/com/shift/" target="_blank">',rk("инструкции"),".</a>","</div>"].join("")};i.showMessageDialog({message:rk("Приглашение принято."),detailsTemplate:e})},checkNeedInviteContact:function(e){var t=new n({endpoint:"ПриглашениеКонтакта"}),a;if(e&&36===e.length)a=t.call("ПроверитьКонтакты",{"Персоны":[e],"Тема":null}).addCallbacks(function(e){var t=e.getRow();return{allowSend:!t.get("НельзяОтправлятьСообщение"),invitationStatus:t.get("ВМоемКруге")}},function(e){return{allowSend:false,info:e}});else a=r.fail({allowSend:false,info:"Параметры переданы некорректно"});return a},getFilesFromMessagesList:function(e){var t,n,r;if(e)for(var a=0;a<e.getCount();a++)if(n=e.at(a),r=n?n.get("ФайлыДляПревью"):void 0,r)if(t)t.append(r);else t=r.clone();return t},appendClientFieldsToRS:function(e,t){var n=t.getFormat();if("function"===typeof t.addField)for(var r=0;r<e.length;r++)if(-1===n.getFieldIndex(e[r].name))t.addField(e[r]);return t},getLastDialogsViewFictiveDate:u.getLastDialogsViewFictiveDate,setLastDialogsViewFictiveDate:u.setLastDialogsViewFictiveDate};return d});
//# sourceMappingURL=Functions.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.MessageActions.Quote",["Core/core-instance","Core/Context","Core/Deferred","js!SBIS3.Contacts.CoreMiniFunctions"],function(e,t,n,o){"use strict";return{$protected:{_options:{messagesRegistry:void 0}},before:{init:function(){this.once("onAfterShow",function(){var t=this,n=this._options.messagesRegistry;if(e.instanceOfModule(this,"SBIS3.CONTROLS/ListView"))t.subscribeTo(t,"onChangeHoveredItem",t._change_hovered_Quote),t._addQuoteActionToView();else if(n&&"string"!==typeof n)this.waitChildControlByName(n).addCallback(function(n){if(e.instanceOfModule(n,"SBIS3.CONTROLS/ListView"))n.subscribeTo(n,"onChangeHoveredItem",t._change_hovered_Quote),t._addQuoteActionToView.call(n)});t.subscribeTo(t,"onDestroy",function(){if(this._quoteButton&&this._quoteButton.length)this._quoteButton.unbind("mousedown"),this._selectedNodes=[],this._savedSelection=null})})}},_addQuoteActionToView:function(){var e=this,t=e.getItemsActions()?e.getItemsActions().getItems():null,n=t&&t.getCount()?t.getRawData():[];n.push({name:"quoteMessage",icon:"sprite:icon-16 icon-Quote icon-primary",isMainAction:true,caption:rk("Цитировать"),tooltip:rk("Цитировать"),onActivated:e._handler_Quote}),e.setItemsActions(n),setTimeout(function(){if(e._quoteButton=e.getContainer().find("[data-id=quoteMessage]"),e._quoteButton.length)e._quoteButton.mousedown(function(){e._getSelectionHtml.bind(e)()})},300)},_getSelectionHtml:function(){var e=this;if(e._selectedEl=null,e._savedSelection=null,window&&window.getSelection){var t=window.getSelection(),n;if(t&&!t.isCollapsed&&!!e.getContainer().find(t.focusNode).length&&t.rangeCount){e._selectedNodes=[t.focusNode,t.anchorNode];var o=document.createElement("div");for(n=0;n<t.rangeCount;n++)o.appendChild(t.getRangeAt(n).cloneContents());var s=["contacts-ThemeMessage__title","message-attachment","message-time-date","person-photo","inline-clear","message-me-label"];for(n=0;n<s.length;n++){var i=o.getElementsByClassName(s[n]);if(i&&i.length)while(i.length>0)i[0].remove()}var a=o.getElementsByClassName("LinkDecorator__image");if(a&&a.length)for(n=0;n<a.length;n++){var r=a[n],c=document.createTextNode(r.getAttribute("alt"));if(!r.parentNode.classList.contains("LinkDecorator__linkWrap"))r.parentNode.insertBefore(c,r),r.remove()}var l=o.innerHTML;e._savedSelection=0==l.indexOf("<")?l:"<p>"+l+"</p>"}}},_handler_Quote:function(e,s,i){var a=this,r=t.global.getValue("myfaceinfo"),c=i.get("КонтактПерсона")[0],l=o.isCurrentPerson(c)?r["Фамилия"]+" "+r["Имя"]:i.get("КонтактФИ")[0],d=i.get("ДатаВремя")[0],u=d.strftime("%e %b %R").toLowerCase(),g=i.get("Текст")[0],f=i.get("Сообщение"),h="question"===a._listType,_=i.get("Тема"),m=true,v,C=function(){a.consume("quoteMsg",{text:g,sender:l,dateTime:u,msgDate:d.strftime("%Y-%m-%d %H:%M:%S.000%z"),msgSender:c,msgId:f,msgThemeId:_})};if(a._savedSelection&&a._selectedNodes&&a._selectedNodes.length){var S=e&&e.find(".message-text");if(S&&S.length){for(var p=0;p<a._selectedNodes.length;p++)if(v=a._selectedNodes[p],v&&!S.find(v).length){m=false;break}if(m)g=a._savedSelection}a._selectedNodes=[],a._savedSelection=null}if(h){var w=a.getParentByClass("SBIS3.Contacts.MessagesViewLikable.Question")._getSendMessage();if(w&&w.isVisible())C();else{var b=a._beforeConsumeReply({target:e}),N=b?b[0]:false;if(N&&N.hasOwnProperty("result")&&N.result instanceof n)N.result.addCallback(function(){C()})}}else C()},_change_hovered_Quote:function(e,t){var n=this;if(t.record){var o=n.getItemsActions().getItemsInstances();if(o.hasOwnProperty("quoteMessage")){var s=o["quoteMessage"],i=t.record.get("СлужебныйТип")[0],a=t.record.get("НачатаПравка")[0]?(new Date-new Date(t.record.get("НачатаПравка")[0]))/1e3:null,r=a&&a<31||"function"==typeof n.isEdit&&n.isEdit(),c=!t.record.get("Текст")[0];s[!i&&!r&&!c?"show":"hide"]()}}}}});
//# sourceMappingURL=Quote.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.Base",["Core/IoC","js!SBIS3.Contacts.Mixins.Services.Executor.SiteSupport"],function(e,t){"use strict";return t.mergeMixin({$protected:{_options:{},_hasRequiredMethods:false,_requiredMethods:[]},setRequiredMethods:function(e){this._requiredMethods=e},getRequiredMethods:function(){return this._requiredMethods},checkRequiredMethods:function(){if(this._hasRequiredMethods)return true;else{for(var t=this.getRequiredMethods(),r,i=e.resolve("ILogger"),s=0;s<t.length;s++)if(r=t[s],"function"!=typeof this[r])return i.error("required function "+r+" not found in this context"),false;return this._hasRequiredMethods=true,true}},register:function(e){if(!e)throw new Error("array with service names required");var t=this.getServicesSite(),r=this.getName(),i=null;if(!t)throw new Error("servicesSite not found");if(!r)i=this.getId();for(var s=0;s<e.length;s++){var o=e[s];if("function"==typeof this["se"+o.charAt(0).toUpperCase()+o.slice(1)])t.registerService(o,r,i)}}})});
//# sourceMappingURL=Base.module.js.map
define("tmpl!SBIS3.DOCVIEW.List/templates/classic",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},s=function e(s,a,r,l,p){function c(){}var n=0,o=void 0!==t&&t?t:arguments[arguments.length-1];void 0===o&&(eval("var thelpers = null;"),o=global.requirejs("View/Runner/tclosure"));var g={};p&&p.isSetts&&(g=p.fullContext||{});var m="string"==typeof r?r:"",d=void 0===i?void 0:i,y={id:[],def:void 0},u=o.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),v=this&&this.includedTemplates?this.includedTemplates:{},f=o.getMarkupGenerator(l);try{var _=f.joinElements([f.createTag("div",{class:"controls-ListView__item js-controls-ListView__item dv-classic-item "+o.wrapUndef(o.utils.escape(o.getter(s,["item","isRequired"]).apply(o.getter(s,["item"]),[])?"dv-classic-item_required":""))+" controls-CompositeView__listItem controls-ListView__item-type-"+o.wrapUndef(o.utils.escape(o.getter(s,["projItem","isNode"]).apply(o.getter(s,["projItem"]),[])?"node":"leaf"))+" "+o.wrapUndef(o.utils.escape(o.getter(s,["item","get"]).apply(o.getter(s,["item"]),["countRedactions"])>1?"dv-classic-item__hasRedactions":""))+" "+o.wrapUndef(o.utils.escape(o.getter(s,["item","isEncrypted"]).apply(o.getter(s,["item"]),[])||o.getter(s,["item","get"]).apply(o.getter(s,["item"]),["link"])||o.getter(s,["item","get"]).apply(o.getter(s,["item"]),["signs"])||o.getter(s,["item","getSigns"]).apply(o.getter(s,["item"]),[])?"dv-classic-item__"+((o.getter(s,["item","getSigns"]).apply(o.getter(s,["item"]),[])?3===o.getter(s,["item","get"]).apply(o.getter(s,["item"]),["signs"])?2:1:"")+(o.getter(s,["item","get"]).apply(o.getter(s,["item"]),["link"])?1:"")+(o.getter(s,["item","isEncrypted"]).apply(o.getter(s,["item"]),[])?1:""))+"-icon":"")),"data-hash":""+o.wrapUndef(o.utils.escape(o.getter(s,["projItem","getHash"]).apply(o.getter(s,["projItem"]),[]))),"data-id":""+o.wrapUndef(o.utils.escape(o.getter(s,["item","getId"]).apply(o.getter(s,["item"]),[])))},[o.getter(s,["multiselect"])?[f.createTag("span",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox controls-ListView__itemCheckBox__showByHover"},[],{},y,this)]:f.createText(""),f.createText(" "+o.wrapUndef(o.Sanitize.apply(void 0,[o.getDecorators().sanitize.apply(void 0,[o.getter(s,["item","getIcon"]).apply(o.getter(s,["item"]),[])])]))+" "),f.createTag("div",{class:"dv-classic-name ws-ellipsis",title:""+o.wrapUndef(o.utils.escape(o.getter(s,["item","get"]).apply(o.getter(s,["item"]),["fileName"])))},[f.createText(" "+o.wrapUndef(o.Sanitize.apply(void 0,[o.getDecorators().sanitize.apply(void 0,[o.getter(s,["item","getTitle"]).apply(o.getter(s,["item"]),[])])]))+" ")],{},y,this),o.getter(s,["item","get"]).apply(o.getter(s,["item"]),["link"])?[f.createTag("div",{class:"icon-16 icon-Linked icon-disabled dv-classic-linked_icon",title:""+o.wrapUndef(o.utils.escape(global.rk.apply(s,["Ссылка на файл"])+". "+global.rk.apply(s,["Этот файл не занимает места на вашем диске"])))},[],{},y,this)]:f.createText(""),f.createText(" "+o.wrapUndef(o.Sanitize.apply(void 0,[o.getDecorators().sanitize.apply(void 0,[o.getter(s,["item","getSigns"]).apply(o.getter(s,["item"]),[])])]))+" "),o.getter(s,["item","isEncrypted"]).apply(o.getter(s,["item"]),[])?[f.createTag("div",{class:"icon-16 icon-Lock icon-disabled dv-classic-lock_icon",title:""+global.rk("Документ зашифрован")},[],{},y,this)]:f.createText(""),o.getter(s,["item","get"]).apply(o.getter(s,["item"]),["size"])?[f.createTag("div",{class:"dv-classic-size ws-ellipsis dv-classic__extension"},[f.createText(" "+o.wrapUndef(o.utils.escape(o.getter(s,["item","getPrettySize"]).apply(o.getter(s,["item"]),[o.getter(s,["item","get"]).apply(o.getter(s,["item"]),["size"])])))+" ")],{},y,this)]:f.createText("")],a,y,this)],m,y);y.def&&(_=f.chain(_,y,a),y=void 0)}catch(e){o.templateError("resources/Docview/List/templates/classic.tmpl",e,s)}return _||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/templates/classic"}},s});
//# sourceMappingURL=classic.tmpl.map
define("tmpl!SBIS3.DOCVIEW.List/templates/big_preview",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},r=function e(r,a,s,p,l){function g(){}var o=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var n="string"==typeof s?s:"",m=void 0===i?void 0:i,v={id:[],def:void 0},w=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),u=this&&this.includedTemplates?this.includedTemplates:{},h=c.getMarkupGenerator(p);try{var y=h.joinElements([h.createTag("div",{class:"controls-CompositeView__listItem            controls-ListView__item-type-"+c.wrapUndef(c.utils.escape(c.getter(r,["item","get"]).apply(c.getter(r,["item"]),["folder@"])?"node":"leaf"))+"            controls-ListView__item            js-controls-ListView__item            dv-bigpreview-item            "+c.wrapUndef(c.utils.escape(c.getter(r,["item","isRequired"]).apply(c.getter(r,["item"]),[])?"dv-bigpreview-item_required":""))+"            "+c.wrapUndef(c.utils.escape(c.getter(r,["item","hasSmallPreview"]).apply(c.getter(r,["item"]),[])?"dv-bigpreview-imgmod":""))+"            "+c.wrapUndef(c.utils.escape(c.getter(r,["item","get"]).apply(c.getter(r,["item"]),["folder@"])&&!c.getter(r,["templateBinding","folderAsPreview"])?"dv-bigpreview-folder":""))+"            "+c.wrapUndef(c.utils.escape(c.getter(r,["item","moreTileCount"])?"docview-list__item_more":"")),"data-hash":""+c.wrapUndef(c.utils.escape(c.getter(r,["projItem","getHash"]).apply(c.getter(r,["projItem"]),[]))),"data-id":""+c.wrapUndef(c.utils.escape(c.getter(r,["item","getId"]).apply(c.getter(r,["item"]),[])))},[c.getter(r,["item","get"]).apply(c.getter(r,["item"]),["folder@"])&&c.getter(r,["templateBinding","folderAsPreview"])||(c.getter(r,["templateBinding","doNotRequestPreview"])||c.getter(r,["item","doNotRequestPreview"]))&&!c.getter(r,["item","previewUrl"])?[h.createTag("div",{class:"dv-bigpreview-vis",style:"width: "+c.wrapUndef(c.utils.escape(c.getter(r,["item","getPreviewWidth"]).apply(c.getter(r,["item"]),[])))+"px; height: "+c.wrapUndef(c.utils.escape(c.getter(r,["item","getPreviewHeight"]).apply(c.getter(r,["item"]),[])))+"px;"},[h.createTag("div",{class:"div-PreviewDiv_forImg",title:""+c.wrapUndef(c.utils.escape(c.getter(c.getter(r,["item","getTitleForDisk"]).apply(c.getter(r,["item"]),[]),["tooltip"])))},[h.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["item","getIcon"]).apply(c.getter(r,["item"]),["bigpreview"])])]))+" "),h.createTag("div",{class:"div-PreviewCanvas_fixva"},[],{},v,this)],{},v,this)],{},v,this)]:c.getter(r,["item","get"]).apply(c.getter(r,["item"]),["folder@"])?[h.createTag("div",{class:"dv-folder-background",style:"width: "+c.wrapUndef(c.utils.escape(c.getter(r,["item","getPreviewWidth"]).apply(c.getter(r,["item"]),[])))+"px; "+c.wrapUndef(c.utils.escape(c.getter(r,["item","get"]).apply(c.getter(r,["item"]),["folder@"])&&c.getter(r,["templateBinding","folderAsPreview"])&&c.getter(r,["item","getPreviewHeight"]).apply(c.getter(r,["item"]),[])?"height: "+c.getter(r,["item","getPreviewHeight"]).apply(c.getter(r,["item"]),[])+"px;":""))},[c.getter(r,["multiselect"])?[h.createTag("div",{class:"dv-checkbox-holder"},[h.createTag("span",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox controls-ListView__itemCheckBox__showByHover"},[],{},v,this)],{},v,this)]:h.createText(""),h.createTag("div",{class:"title",title:""+c.wrapUndef(c.utils.escape(c.getter(c.getter(r,["item","getTitleForDisk"]).apply(c.getter(r,["item"]),[]),["tooltip"])))},[h.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["item","getIcon"]).apply(c.getter(r,["item"]),["diskClassic"])])]))+" "+c.wrapUndef(c.utils.escape(c.getter(r,["item","title"])))+" ")],{},v,this)],{},v,this)]:[h.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["item","getPreviewDiv"]).apply(c.getter(r,["item"]),[{className:"forEmptyLink",coef:1.5,width:c.getter(r,["item","_options","previewWidth"]),height:c.getter(r,["item","_options","previewHeight"])}])])]))+" "),c.getter(r,["item","getSigns"]).apply(c.getter(r,["item"]),[])||c.getter(r,["item","hasIconForBigPreview"]).apply(c.getter(r,["item"]),[])?[h.createTag("div",{class:"dv-bigpreview-absolute-right-top"},[c.getter(r,["item","hasIconForBigPreview"]).apply(c.getter(r,["item"]),[])&&(3!==c.getter(r,["item","signs"])||c.getter(r,["item","_options","previewWidth"])>82)?[h.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["item","getIcon"]).apply(c.getter(r,["item"]),["diskClassic"])])]))+" ")]:h.createText(""),h.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["item","getSigns"]).apply(c.getter(r,["item"]),[])])]))+" ")],{},v,this)]:h.createText(""),c.getter(r,["item","isUnknown"]).apply(c.getter(r,["item"]),[])&&c.getter(r,["item","_options","previewWidth"])>100?[h.createTag("div",{class:"dv-bigpreview-absolute-right-bottom ws-ellipsis"},[h.createText(" "+c.wrapUndef(c.utils.escape(c.getter(r,["item","getFileExtension"]).apply(c.getter(r,["item"]),[])))+" ")],{},v,this)]:h.createText("")],!c.getter(r,["item","get"]).apply(c.getter(r,["item"]),["folder@"])||c.getter(r,["templateBinding","folderAsPreview"])?[h.createTag("div",{class:"dv-bigpreview-title",style:"width: "+c.wrapUndef(c.utils.escape(c.getter(r,["item","getPreviewWidth"]).apply(c.getter(r,["item"]),[])))+"px;"},[h.createTag("div",{class:"title",title:""+c.wrapUndef(c.utils.escape(c.getter(c.getter(r,["item","getTitleForDisk"]).apply(c.getter(r,["item"]),[]),["tooltip"])))},[h.createTag("span",{class:"dv-title-text ws-ellipsis"},[h.createText(""+c.wrapUndef(c.utils.escape(c.getter(c.getter(r,["item","title","split"]).apply(c.getter(r,["item","title"]),[".url"]),[0]))))],{},v,this)],{},v,this),h.createTag("div",{class:"dv-date-size ws-ellipsis"},[c.getter(r,["included","subtitle"])?[h.createControl("resolver",c.getter(r,["included","subtitle"]),c.uniteScope(c.utils.escape(c.uniteScope(r,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},s,m,u,c.config,d,v)]:[h.createText(" "+c.wrapUndef(c.utils.escape(c.getter(c.getter(r,["item","getDate"]).apply(c.getter(r,["item"]),[]),["date"])))+" "+c.wrapUndef(c.utils.escape(c.getter(c.getter(r,["item","getDate"]).apply(c.getter(r,["item"]),[]),["time"])))+" "),c.getter(r,["item","prettySize"])?[h.createText("("+c.wrapUndef(c.utils.escape(c.getter(r,["item","prettySize"])))+")")]:h.createText("")]],{},v,this)],{},v,this),c.getter(r,["multiselect"])?[h.createTag("div",{class:"dv-checkbox-holder"},[h.createTag("span",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox controls-ListView__itemCheckBox__showByHover"},[],{},v,this)],{},v,this)]:h.createText("")]:h.createText(""),h.createTag("div",{class:"docview-list__more-overlay","data-more":""+c.wrapUndef(c.utils.escape(c.getter(r,["item","moreTileCount"])?"+"+c.getter(r,["item","moreTileCount"]):""))},[],{},v,this)],a,v,this)],n,v);v.def&&(y=h.chain(y,v,a),v=void 0)}catch(e){c.templateError("resources/Docview/List/templates/big_preview.tmpl",e,r)}return y||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/templates/big_preview"}},r});
//# sourceMappingURL=big_preview.tmpl.map
define("Transport/ajax-emulator",[],function(){"use strict";function e(e,t,r){var n,s,o,a,i=e.contents,c=e.dataTypes;while("*"===c[0])if(c.shift(),void 0===n)n=e.mimeType||t.getResponseHeader("Content-Type");if(n)for(s in i)if(i[s]&&i[s].test(n)){c.unshift(s);break}if(c[0]in r)o=c[0];else{for(s in r){if(!c[0]||e.converters[s+" "+c[0]]){o=s;break}if(!a)a=s}o=o||a}if(o){if(o!==c[0])c.unshift(o);return r[o]}}function t(e,t,r,n){var s,o,a,i,c,l={},f=e.dataTypes.slice();if(f[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=f.shift();while(o){if(e.responseFields[o])r[e.responseFields[o]]=t;if(c=o,o=f.shift(),o)if("*"===o)o=c;else if("*"!==c&&c!==o){if(a=l[c+" "+o]||l["* "+o],!a)for(s in l)if(i=s.split(" "),i[1]===o)if(a=l[c+" "+i[0]]||l["* "+i[0]],a){if(true===a)a=l[s];else if(true!==l[s])o=i[0],f.unshift(i[1]);break}if(true!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:new Error("No conversion from "+c+" to "+o)}}}}return{state:"success",data:t}}function r(e){var t=e.headers||{};if(e.data&&e.hasContent&&false!==e.contentType||e.contentType)t["Content-Type"]=e.contentType;if(t["Accept"]=e.dataTypes[0]&&e.accepts[e.dataTypes[0]]?e.accepts[e.dataTypes[0]]+("*"!==e.dataTypes[0]?", "+f+"; q=0.01":""):e.accepts["*"],!e.crossDomain&&!t["X-Requested-With"])t["X-Requested-With"]="XMLHttpRequest";return t}function n(e,t){var n=new XMLHttpRequest,s=r(e);if(n.open(e.type,e.url,true),e.mimeType&&n.overrideMimeType)n.overrideMimeType(e.mimeType);for(var o in s)n.setRequestHeader(o,s[o]);return n.onload=function(e){t(l[n.status]||n.status,n.statusText,"string"!==typeof n.responseText?{binary:n.response}:{text:n.responseText},n.getAllResponseHeaders())},n.onabort=n.onerror=function(e){t(n.status,n.statusText)},n}function s(e){t={};var t,r={readyState:0,getResponseHeader:function(r){var n,s=e.getAllResponseHeaders();if(!s)return null;if(!t){t={};while(n=T.exec(s))t[n[1].toLowerCase()]=n[2]}return n=t[r.toLowerCase()],null==n?null:n}};return["setRequestHeader","getAllResponseHeaders","overrideMimeType","abort","send"].forEach(function(t){r[t]=function(){return e[t].apply(e,arguments)}}),r}function o(e){var t;if(!e||"string"!==typeof e)return null;try{t=(new window.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}if(!t||t.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+e);return t}var a="undefined"!==typeof location?location:{href:"",protocol:"https"},i=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,c=/^\/\//,l={0:200},f="*/".concat("*"),p={url:a.href,type:"GET",isLocal:i.test(a.protocol),global:true,processData:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":f,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":JSON.parse,"text xml":o},success:function(){},error:function(){}},u=/^(?:GET|HEAD)$/,d=/\?/,h=/%20/g,m=/#.*$/,y=/[^\x20\t\r\n\f]+/g,x=/([?&])_=[^&]*/,T=/^(.*?):[ \t]*([^\r\n]*)$/gm,v=Date.now();function w(e){return Object.assign({},p,e)}function g(r){var o,i,l,f,p,T=w(r),g,b=document.createElement("a");if(b.href=a.href,T.url=((T.url||loc_locationation.href)+"").replace(c,a.protocol+"//"),T.dataTypes=(T.dataType||"*").toLowerCase().match(y)||[""],null==T.crossDomain){g=document.createElement("a");try{g.href=settings.url,g.href=g.href,T.crossDomain=b.protocol+"//"+b.host!==g.protocol+"//"+g.host}catch(e){T.crossDomain=true}}if(T.type=T.type.toUpperCase(),T.hasContent=!u.test(T.type),i=T.url.replace(m,""),!T.hasContent){if(p=T.url.slice(i.length),T.data)i+=(d.test(i)?"&":"?")+T.data,delete T.data;if(false===T.cache)i=i.replace(x,"$1"),p=(d.test(i)?"&":"?")+"_="+v+++p;T.url=i+p}else if(T.data&&T.processData&&0===(T.contentType||"").indexOf("application/x-www-form-urlencoded"))T.data=T.data.replace(h,"+");if(o=s(n(T,C)),T.beforeSend&&false===T.beforeSend.call(null,o,T))return o.abort();try{o.send(T.hasContent&&T.data||null)}catch(e){C(-1,e)}function C(r,n,s,a){var i,c,p,u,d=n;if(f=true,l=a||"",i=r>=200&&r<300||304===r,s)u=e(T,o,s);if(u=t(T,u,o,i),i)if(204===r||"HEAD"===T.type)d="nocontent";else if(304===r)d="notmodified";else d=u.state,c=u.data,i=!(p=u.error);else if(p=d,r||!d)if(d="error",r<0)r=0;if(Object.assign(o,{statusText:d,status:r}),i)T.success(c,d,o);else T.error(o,d,p)}return o}return g});
//# sourceMappingURL=ajax-emulator.js.map
define("Transport/ITransport",["Core/core-extend"],function(e){return e({},{execute:function(e,n){throw new Error("Method not implemented")}})});
//# sourceMappingURL=ITransport.js.map
define("Transport/XHRTransport",["Transport/ITransport","Core/Deferred","Core/EventBus","Core/UserInfo","Core/constants","Transport/HTTPError","Core/IoC","Core/detection","Transport/ajax-emulator"],function(r,e,o,n,t,i,s,a,f){var c,u=o.channel("Transport"),p=o.channel("errors");function d(r,e){if(c.isOfflineError(r)){var o;try{(o=JSON.parse(e).method.split(".")).push(r)}catch(n){o=[e,r]}return!!c.notifyOfflineError(o)}}var l=false;if("undefined"!==typeof window)if(a.firefox)window.addEventListener("beforeunload",function(){l=true,setTimeout(function(){l=false},600)});else window.addEventListener("unload",function(){l=true});var h;if((c=r.extend({$protected:{_options:{method:"GET",dataType:"text",contentType:"application/x-www-form-urlencoded",url:"",processData:true},_xhr:void 0},$constructor:function(){if(!h&&"undefined"!==typeof rk){h=true;for(var r in c.ERRORS_TEXT)if(c.ERRORS_TEXT.hasOwnProperty(r))c.ERRORS_TEXT[r]=rk(c.ERRORS_TEXT[r])}if(""===this._options.url)throw new Error("Request with no URL is ambiguous")},execute:function(r,o){var s=new e({cancelCallback:this.abort.bind(this)}),a=this;if(t.checkSessionCookie&&!n.isValid())return s.errback(c.ERRORS_TEXT.sessionError),p.notify("onAuthError"),s;try{this._xhr=f({type:this._options.method,dataType:this._options.dataType,contentType:this._options.contentType,url:this._options.url,processData:this._options.processData,headers:o||{},data:r,beforeSend:function(r,e){return u.notify("onBeforeSend",r,e)},success:function(o){if(d(o.error,r))return void s.errback(i.offlineModeError());var n=e.success(o);return u.notify("onResponseSuccess",a._xhr,n,a._options.url),s.dependOn(n),o},error:function(o,n){var t,f,h,T,E;if(o.responseJSON&&d(o.responseJSON.error,r))return void s.errback(i.offlineModeError());if(E=o.status,t=c.ERRORS_TEXT,f=t[E]||t[n]||t.unknown||"",0===E&&""===o.getAllResponseHeaders()&&"abort"!==n){var R="/"===a._options.url.charAt(0)?window.location.hostname:a._options.url;f=t.lossOfConnection+" "+R}if(T=new i(f,E,a._options.url,o.responseText),p.notify("onHTTPError",T),"401"==E)if(true===p.notify("onAuthError"))return;if(h=new e,u.notify("onResponseError",a._xhr,h),h.addCallback(function(r){s.callback(r)}).addErrback(function(r){s.errback(r)}),l)h.cancel();else h.errback(T)}})}catch(r){s.errback("JavaScript exception while trying to execute request: "+r.message)}return s},setUrl:function(r){if("string"==typeof r)this._options.url=r},abort:function(){if(this._xhr)this._xhr.abort()}})).ERRORS_TEXT={timeout:"Таймаут запроса",unknown:"Неизвестная ошибка",parsererror:"Ошибка разбора документа",abort:"Запрос был прерван",lossOfConnection:"Потеряна связь с сайтом",sessionError:"Ошибка авторизации. Текущая сессия принадлежит другому пользователю/клиенту",403:"У вас недостаточно прав для выполнения данного действия",404:"Документ не найден",413:"Превышен допустимый размер загружаемого файла",423:"Действие заблокировано лицензией",500:"Внутренняя ошибка сервера",502:"Сервис находится на техническом обслуживании",503:"Сервис находится на техническом обслуживании",504:"Сервис находится на техническом обслуживании"},c.isOfflineError=function(r){var e;return e=r&&(r.data&&r.data.error_code||r.httpError||r.code),300==e||405==e},c.notifyOfflineError=function(r){var e,n,t;if(e=o.globalChannel(),n=["onOfflineModeError"].concat(r),t=e.notify.apply(e,n),t)s.resolve("ILogger").info("XHRTransport","Работа в offline-режиме");return t},c.getServiceByName=function(r){return t.services[r]||t.defaultServiceUrl},!s.has("ITransport"))s.bind("ITransport",c);return c});
//# sourceMappingURL=XHRTransport.js.map
define("Transport/TransportError",["Core/core-extend","Transport/HTTPError"],function(r,t){function e(r,t,e,s,i,o,h,n,a,d){this.message=r,this.httpError=void 0===t?"":t,this.code=e||0,this.name="Transport error",this.methodName=s||"",this.details=i||"",this.url=o||"",this.classid=h||"",this.errType=n||"error",this.addinfo=a||"",this.error_code=d}return r.classicExtend(e,t),e.prototype.toString=function(){return[this.name,": ",this.message,"; method: ",this.methodName,"; code: ",this.code,"; httpError: ",this.httpError,"; details: ",this.details].join("")},(function(){return this||(0,eval)("this")}()).TransportError=e,e});
//# sourceMappingURL=TransportError.js.map
define("Transport/RPCJSON",["Core/core-extend","Core/Deferred","Core/constants","Core/UserInfo","Core/IoC","Core/EventBus","Core/helpers/Object/isEmpty","Core/helpers/random-helpers","Core/helpers/string-helpers-min","Transport/HTTPError","Transport/TransportError","Core/base64","Core/i18n","Transport/XHRTransport"],function(e,r,t,n,o,a,s,i,c,d,l,u,h){var p="system.bl_async_replies";function f(e,r,n){var o={jsonrpc:"2.0",protocol:t.JSONRPC_PROOTOCOL_VERSION,method:e,params:r,id:void 0!==n?n:1},a={"X-CalledMethod":c.transliterate(""+e),"X-OriginalMethodName":u.encode(""+e),"Accept-Language":(h.getLang()||"ru-RU")+";q=0.8,en-US;q=0.5,en;q=0.3"},s="?protocol="+t.JSONRPC_PROOTOCOL_VERSION+"&method="+encodeURI(e)+"&params="+encodeURIComponent(c.serializeURLData(r))+"&id="+(void 0!==n?n:1);return{reqBody:JSON.stringify(o),reqUrl:s,reqHeaders:a}}var _={init:function(){if(this._channel||"undefined"==typeof window)return;var e=this;this._channel=a.channel("Transport"),this._channel.subscribe("onResponseSuccess",function(r,t,n,o){e.__cache[o]=e.__cache[o]||{},e.__cache[o]["X-LastModification"]=t.getResponseHeader("X-LastModification")||e.__cache[o]["X-LastModification"]||void 0})},getHeader:function(e,r){return this.__cache[e]?this.__cache[e][r]:""},__cache:{}};_.init();function T(e){o.resolve("ILogger").log("Transport/RPCJSON",'Private method "'+e+'" is deprecated and will be deleted in 3.17.220')}var C=e({},{$protected:{_transportPOST:null,_transportGET:null,_currentTransport:null,_useGet:false,_options:{serviceUrl:"",fallback:false,timeout:6e4,async:false}},$constructor:function(){this._transportPOST=this._createTransport("POST"),this._useGet="undefined"!==typeof window&&!s(window.cachedMethods||[])},_handleRPCError:function(e,r,t,n){T("_handleRPCError"),e.errback(C.handleRPCError(r,n.error))},_handleHTTPError:function(e,r,t,n){T("_handleHTTPError"),e.errback(C.handleHTTPError(r,n))},_fallbackResponse:function(e,r,t,n){if(n&&"string"===typeof n)n=JSON.parse(n);if(n&&n.guid===r)clearTimeout(this.timeout),e.callback(n.data)},_useGetMethod:function(e){return T("_useGetMethod"),(window.cachedMethods||[]).indexOf(e)>-1},_canUseGetMethod:function(e,r){return("undefined"!==typeof window&&!s(window.cachedMethods||[])?window.cachedMethods:[]).indexOf(e)>-1&&r.length<2*1024},_setHeaders:function(e,r,o){if("get"===r){var a=n.getCurrent();if(a){var s=a.split("-"),c=s[0],d=s[1];e.reqHeaders["X-SbisSessionsID"]=a,e.reqHeaders["X-CID"]=c,e.reqHeaders["X-UID"]=d}}else{var l=this._options.serviceUrl||t.defaultServiceUrl,u=_.getHeader(l,"X-LastModification");if(u)e.reqHeaders["X-LastModification"]=u}if(this._options.fallback)e.reqHeaders["X-ASYNCINVOKE"]=true,e.reqHeaders["X-PublishAsyncResponse"]=true,e.reqHeaders["X-UNIQ-ID"]=i.createGUID();if(this._options.async)e.reqHeaders["X-ASYNCINVOKE"]=true;if(o)e.reqHeaders["X-RequireRecent"]=true},callMethod:function(e,n,o){var a=this,s=new r({cancelCallback:this.abort.bind(this)}),i=f(e,n),c;if(this._canUseGetMethod(e,i.reqUrl)){if(i.reqBody="",this._setHeaders(i,"get",o),!this._transportGET)this._transportGET=this._createTransport("GET");this._transportGET.setUrl((this._options.serviceUrl||t.defaultServiceUrl)+i.reqUrl),this._currentTransport=this._transportGET}else this._setHeaders(i,"post",o),this._currentTransport=this._transportPOST;if(this._options.fallback)require(["Lib/ServerEvent/Bus"],function(e){e.serverChannel(p).once("onReady",function(){var r={},t=a._fallbackResponse.bind(r,s,i.reqHeaders["X-UNIQ-ID"]);r.timeout=setTimeout(function(){e.serverChannel(p).unsubscribe("onMessage",t,r),s.errback("Timeout")},a._options.timeout),e.serverChannel(p).subscribe("onMessage",t,r),c=a._currentTransport.execute(i.reqBody,i.reqHeaders)})},function(e){s.errback(e)});else(c=this._currentTransport.execute(i.reqBody,i.reqHeaders)).addCallbacks(function(r){var t="error"in(r=r||C.getEmptyRpcResponse())?C.handleRPCError(r.error,e,a._options.serviceUrl):r.result;return s.callback(t),r},function(r){return s.callback(C.handleHTTPError(r,e)),r});return s.addErrback(function(e){var r;return r=(e.httpError||0)>500?rk("Попробуйте заглянуть сюда через 15 минут"):"",e.details=e.details||r,e}),s},abort:function(){this._currentTransport&&this._currentTransport.abort()},_createTransport:function(e){return o.resolve("ITransport",{url:this._options.serviceUrl||t.defaultServiceUrl,method:e,dataType:"json",contentType:"application/json; charset=utf-8"})}});return C.jsonRpcPreparePacket=f,C.getEmptyRpcResponse=function(){return{error:{message:"Получен пустой ответ от сервиса",code:"",details:""}}},C.handleHTTPError=function(e,r){if(!(e instanceof d))return e;var t,n,o=e.message,s="",i=0,c="",u="",h="",p="";try{if(n=JSON.parse(e.payload),n.error){if(o=n.error.message||o,s=n.error.details,i=n.error.code,n.error.data)c=n.error.data.classid||c,h=n.error.data.addinfo||h,p=n.error.data.error_code||p;u=n.error.type}}catch(e){}if(t=new l(o,e.httpError,i,r,s,e.url,c,u||"error",h||"",p),a.channel("errors").notify("onRPCError",t),t.processed)e.processed=true;return t},C.handleRPCError=function(e,r,n){var o=new l(e.message,"",e.code,r,e.details||"",n||t.defaultServiceUrl,e.data&&e.data.classid||"",e.type||"error",e.data&&e.data.addinfo||"",e.data&&e.data.error_code||"");return a.channel("errors").notify("onRPCError",o),o},C});
//# sourceMappingURL=RPCJSON.js.map
define("Core/TimeInterval",["Core/core-clone"],function(t){var e=1e3,r=6e4,n=36e5,o=864e5,i=60,s=60,u=24,a=["days","hours","minutes","seconds","milliseconds"],l={days:o,hours:n,minutes:r,seconds:e,milliseconds:1},c=[{regExp:/^P(?:(-?[0-9]+)D)?(?:T(?:(-?[0-9]+)H)?(?:(-?[0-9]+)M)?(?:(-?[0-9]+(?:\.[0-9]{0,3})?)[0-9]*S)?)?$/i,format:"P[<Число_дней>D][T[<Число_часов>H][<Число_минут>M][<Число_секунд>[.Число_долей_секунды]S]"}],f=[{regExp:/^P(-?[0-9]+D)?(T(-?[0-9]+H)?(-?[0-9]+M)?(-?[0-9]+(\.[0-9]+)?S)?)?$/i,format:"P[<Число_дней>D][T[<Число_часов>H][<Число_минут>M][<Число_секунд>[.Число_долей_секунды]S]"}];function p(){for(var t=[],e=0;e<f.length;e++)t[e]=f[e].format;return t.join(", ")}function h(t){return parseFloat(t)||0}function d(t){return t>0?Math.floor(t):Math.ceil(t)}function v(t,e){return h(h(t).toFixed(e))}function m(t){var e=[],r,n;if(!M(t))throw new Error(rk("Передаваемый аргумент не соответствует формату ISO 8601. Допустимые форматы")+": "+p()+". ");for(n=0;n<c.length;n++)if(r=c[n].regExp.exec(t))break;switch(n){case 0:for(var o=1;o<r.length;o++)if(o===r.length-1)e.push(d(r[o])),e.push(v(r[o]%1*1e3));else e.push(h(r[o]))}return e}function y(t){for(var e={},r=0;r<a.length;r++)e[a[r]]=h(t[r]);return e}function g(t){var e=0;for(var r in l)if(l.hasOwnProperty(r))e+=l[r]*h(t[r]);return e}function _(t){var e={};for(var r in l)if(l.hasOwnProperty(r)){var n=l[r];e[r]=d(t/n),t%=n}return e}function b(t){var e=v(t.seconds+t.milliseconds/1e3,3);return"P"+t.days+"D"+"T"+t.hours+"H"+t.minutes+"M"+e+"S"}function M(t){for(var e=0;e<f.length;e++)if(f[e].regExp.test(String(t)))return true;return false}function I(t){if("number"===typeof t&&t%1===0)return true;return false}function O(t,e){if(!(e instanceof Date))throw new Error(rk("Передаваемый аргумент должен быть объектом класса Date"));return e=new Date(e.getTime()),e.setTime(e.getTime()+t*this.getTotalMilliseconds()),e}function S(t){if(this instanceof S)this._normIntervalObj=void 0,this._normIntervalStr=void 0,this.set(t);else throw new Error(rk("TimeInterval вызывать через оператор new"))}return S.prototype.getDays=function(){return this._normIntervalObj.days},S.prototype.addDays=function(t){return this.addMilliseconds(h(t)*o)},S.prototype.subDays=function(t){return this.subMilliseconds(h(t)*o)},S.prototype.getHours=function(){return this._normIntervalObj.hours},S.prototype.addHours=function(t){return this.addMilliseconds(h(t)*n)},S.prototype.subHours=function(t){return this.subMilliseconds(h(t)*n)},S.prototype.getMinutes=function(){return this._normIntervalObj.minutes},S.prototype.addMinutes=function(t){return this.addMilliseconds(h(t)*r)},S.prototype.subMinutes=function(t){return this.subMilliseconds(h(t)*r)},S.prototype.getSeconds=function(){return this._normIntervalObj.seconds},S.prototype.addSeconds=function(t){return this.addMilliseconds(h(t)*e)},S.prototype.subSeconds=function(t){return this.subMilliseconds(h(t)*e)},S.prototype.getMilliseconds=function(){return this._normIntervalObj.milliseconds},S.prototype.addMilliseconds=function(t){return this.set(this.getTotalMilliseconds()+d(t))},S.prototype.subMilliseconds=function(t){return this.set(this.getTotalMilliseconds()-d(t))},S.prototype.getTotalHours=function(){return this._normIntervalObj.days*u+this._normIntervalObj.hours},S.prototype.getTotalMinutes=function(){return this.getTotalHours()*s+this._normIntervalObj.minutes},S.prototype.getTotalSeconds=function(){return this.getTotalMinutes()*i+this._normIntervalObj.seconds},S.prototype.getTotalMilliseconds=function(){return this.getTotalSeconds()*e+this._normIntervalObj.milliseconds},S.prototype.set=function(e){var r;if(e=t(e),e instanceof S)r="timeInterval";else if("string"===typeof e)r="intervalStr";else if(e instanceof Array)r="intervalArray";else if(e&&"object"===typeof e)r="intervalObj";else e=h(e),r="milliseconds";switch(r){case"intervalStr":e=m(e);case"intervalArray":e=y(e);case"intervalObj":e=g(e);case"milliseconds":this._normIntervalObj=e=_(e,false),this._normIntervalStr=b(e,false);break;case"timeInterval":this._normIntervalObj=e._normIntervalObj,this._normIntervalStr=e._normIntervalStr}return this},S.prototype.toString=function(){return this._normIntervalStr},S.prototype.valueOf=S.prototype.toString,S.prototype.toObject=function(){return this._normIntervalObj},S.prototype.clone=function(){return new S(this)},S.prototype.calc=function(t,e){var r=["==","!=",">=","<=",">","<","+","-","+=","-="];if(-1===r.indexOf(t))throw new Error(rk("Операция")+' "'+t+'" '+rk("не доступна. Разрешенные операции")+": "+r.join(", "));if(!(this instanceof S&&e instanceof S))throw new Error(rk("Operand должен быть объектом класса TimeInterval"));var n=this.getTotalMilliseconds(),o=e.getTotalMilliseconds();switch(t){case"==":return n===o;case"!=":return n!==o;case">=":return n>=o;case"<=":return n<=o;case">":return n>o;case"<":return n<o;case"+":return(new S).set(n+o);case"-":return(new S).set(n-o);case"+=":return this.set(n+o);case"-=":return this.set(n-o)}},S.prototype.addToDate=function(t){return O.call(this,1,t)},S.prototype.subFromDate=function(t){return O.call(this,-1,t)},S.toString=function(t){if(void 0!==t)return S.prototype.set.call({},t)._normIntervalStr;return Function.toString.call(this)},S});
//# sourceMappingURL=TimeInterval.js.map
define("js!SBIS3.DOCVIEW.Funcs",["Core/core-instance","Core/helpers/String/format","Core/helpers/string-helpers-min","Core/base64","Core/constants","Core/Deferred","Core/UserInfo","WS.Data/Source/SbisService","WS.Data/Collection/RecordSet","WS.Data/Entity/Record","WS.Data/Di","Core/core-merge","Core/EventBus","i18n!SBIS3.DOCVIEW.Funcs"],function(e,t,n,r,i,a,o,c,s,l,d,u,f){"use strict";function m(e){var t={};return Object.keys(e).forEach(function(n){if(!(e[n]instanceof Object))t[n]=e[n]}),t}var p={getLinkUrl:function(e,t){var n=e.get("fileName")||"",r;if(/^https?:/.test(n))r=this.parseFileName(n).name;else r=this.getUrlForDownloadFile(e,t),$.ajax({url:r,dataType:"text",async:false,success:function(e){var t=e.match(/^\s*URL=(.*)/m);r=t&&t[1]}});return r},getLinkInfo:function(e){return new c({endpoint:{contract:"LinkDecorator",address:"/linkdecorator/service/"}}).call("GetJson",{SourceLink:e})},parseLink:function(e){var t=null;if(e=(e||"").trim(),/^https?:\/\/[^ "]+/.test(e))t=(t=e.split(/[\n\t\r\f\s]/)[0]).replace(/[<>]/g,"");return t},decorateLink:function(e){var t=new a;if("string"!==typeof e||!e.length)return t.callback(null);return require(["js!SBIS3.Engine.Utils.LinkDecorateUtil"],function(n){n.decorateLink(e).addCallbacks(function e(n){t.callback(n)},function e(n){t.errback(n)})},function(e){t.errback(e)}),t},getDecoratedLink:function(e){return this.decorateLink(e).addCallback(function(e){if(!e||!e.html)return{};var t=$("<div>").html(e.html).find("a").removeAttr("href").removeAttr("target").end();return e.title=t.find(".engine-DecoratedLink__title").text()||e.link,e.html=t.html(),e})},getUrlForDownloadFile:function(e,t){if(e.get("relativeUrl"))return e.get("relativeUrl");var r=t.objectName,i=e?e.get("redactionId")||e.get("attachId"):"",a=n.serializeURLData({"ИдО":String(i)}),o=this.getServiceUrl(t.serviceUrl),c=+new Date;return[o,"?method=",encodeURIComponent(r)+".ReadFile","&params=",encodeURIComponent(a),"&id=",c].join("")},getUrlForDownloadEncryptedFile:function(e,t,n,i){var a={attachId:e.get("attachId"),stamp:n||null,password:i||null};return[this.getServiceUrl(e.getServiceUrl()||t.serviceUrl),"?method=",encodeURIComponent(e.getObjectName()||t.objectName)+".GetDecryptedAttachment","&params=",encodeURIComponent(r.encode(JSON.stringify(a))),"&id=0"].join("")},getInternalServiceUrl:function(e){return"http://"+window.location.host+e.serviceUrl+"service/"},getServiceUrl:function(e){var t="/docview/"===e,n=i.defaultServiceUrl;return("/service/"===n||t||"/service/"===n?e.substring(0,e.length-1):"")+(t?"/service/":n)},_setMinimalOptions:function(e){if(!e.mainOptions)e.mainOptions={};if(!e.mainOptions.commands)e.mainOptions.commands={};if(!e.viewOptions)e.viewOptions={};if(!e.listOptions)e.listOptions={}},signDocuments:function(e,t){var n=new a;if(!e.length)return n.errback(new Error("Нет файлов для подписи")),n;return requirejs(["Deprecated/BLObject","Deprecated/Record","Deprecated/RecordSetStatic","Core/Indicator"],function(r,i,o,c){var s=function(e){n.errback(e),c.hide()},l=new r({name:t.objectName,serviceUrl:t.serviceUrl+"service/"});c.setMessage(rk("Пожалуйста, подождите")+"..."),l.call("HashForDigitalSignature2",{redactions:e},r.RETURN_TYPE_RECORDSET).addCallbacks(function(d){var u="",f=(d.getRecords()||[]).map(function(e){if(e.get("error"))u=e.get("error");else{var t=new i;return t.addColumn("id",i.FIELD_TYPE_STRING),t.addColumn("hash",i.FIELD_TYPE_BINARY),t.addColumn("alreadySignedCerts",i.FIELD_TYPE_QUERY),t.set("id",e.get("redactionId")),t.set("hash",e.get("hash")),t.setKey(e.get("redactionId")),t}});if(u)c.hide(),n.errback(new Error(u));else{var m=new a;if(false!==t.checkExistingSignatures)for(var p=0;p<e.length;p++)(function(t){m.addBoth(function(){var n=new i;return n.addColumn("redactionId",i.FIELD_TYPE_STRING),n.set("redactionId",e[t]),l.call("SignsList",{"Фильтр":n,"Сортировка":null,"Навигация":null,"ДопПоля":[]},r.RETURN_TYPE_RECORDSET).addCallback(function(e){f[t].set("alreadySignedCerts",e)})})})(p);m.callback().addBoth(function(){var e=new o;e.addRecords(f),requirejs(["js!SBIS3.EDO2.EdoCryptoSigns"],function(a){a.signData(e,t.opener,t.useListForSign).addCallbacks(function(e){for(var t=new o,a=0;a<e.getRecordCount();a++){var d=new i;d.addColumn("redactionId",i.FIELD_TYPE_STRING),d.addColumn("sign",i.FIELD_TYPE_BINARY),d.set("redactionId",e.at(a).get("id")),d.set("sign",e.at(a).get("sign")),t.addRecords([d])}if(!t.getRecordCount())return c.hide(),void n.callback();l.call("CreateSigns2",{signs:t},r.RETURN_TYPE_RECORDSET).addCallbacks(function(){c.hide(),n.callback()},s)},s)})})}},s)}),n},openFullScreen:function(e){var t=new a;return requirejs(["Core/Context","Lib/Control/Dialog/Dialog","Core/core-clone","Core/helpers/random-helpers","js!SBIS3.DOCVIEW.DocviewModel","js!SBIS3.DOCVIEW.FullScreenViewer"],function(n,r,i,o,c){var s,l=new a,d=n.createContext(l,null,e.opener&&!e.opener.isDestroyed()&&e.opener.getLinkedContext()),u=i(e._options);if(u.element=void 0,p._setMinimalOptions(u),u.mainOptions.commands.fullScreen=false,e.record)u.listOptions.defaultRecordPK=e.record.get("attachId");if(e.redactionRecord)u.mainOptions._defaultRedactionRecord=e.redactionRecord;else if(e.redactionId)u.mainOptions._defaultRedactionId=e.redactionId;if(u.filter)s=u.filter;else if(u.mainOptions.useOnlyCtx)s={};else s={catalogId:u.mainOptions.fixId||(u.mainOptions.ctxLinkId?d.getValue(u.mainOptions.ctxLinkId):void 0)};if(!u.mainOptions.useOnlyCtx&&e.recordSet){u.mainOptions.useOnlyCtx=true;var f=o.randomId("viewerField");u.mainOptions.ctxLinkList=f,d.setValue(f,e.recordSet)}t.callback(new r({resizable:false,modal:false,border:false,name:"ViewerFullScreenDlg",template:e.template||"js!SBIS3.DOCVIEW.FullScreenViewer",componentOptions:{name:"fullScreenViewerInstance",mainOptions:u.mainOptions,viewOptions:u.viewOptions,listOptions:u.listOptions,handlers:e.handlers,filter:s,viewer:e.viewer,className:e.className},enabled:void 0===u.enabled?void 0===u.mainOptions.enabled?true:u.mainOptions.enabled:u.enabled,maximize:true,className:"fullScreenContainer",left:0,top:0,context:d,opener:e.opener,handlers:{onReady:function(){var t=this.getChildControlByName("fullScreenViewerInstance");try{e.readyFuncs(t)}catch(e){}if(e.record){var n=e.record.get("fileName");if(p._isFileWithExtensions(n,["doc","docx","odt","docm","dot","dotm","dotx","rtf","xls","xlsx","ods","xlsm","xlsb","odp","vsd","vsdx"])||c.prototype.isEncrypted.call(e.record))t.getContainer().addClass("docview-officeDocuments");else if(p._isFileWithExtensions(n,["pdf","tif","tiff"]))t.getContainer().addClass("docview-PDFDocuments")}if(e.opener)this.subscribeTo(this,"onCommandCatch",function(t,n){if("close"!==n)t.setResult(e.opener.sendCommand.apply(e.opener,[n].concat(Array.prototype.slice.call(arguments,2))))})},onClick:function(){var e=this.getChildControlByName("fullScreenViewerInstance").getView();e.startCommand("closeFullScreen",[e.savedRec])},onDestroy:function(){l.callback()}}}))}),t},showCertificates:function(e){e.methodName="SignsList",requirejs(["js!SBIS3.CRYPTO.CryptoDialogs"],function(t){t.showDigitalSignaturesBL(e,e.opener)},function(e){throw e})},showOneCertificate:function(e){requirejs(["js!SBIS3.CRYPTO.CryptoDialogs"],function(t){t.showDigitalSignature(e.signRec,e.opener)})},alert:function(e){requirejs(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(t){t.showMessageDialog({message:e.message,details:e.details,status:"error",opener:e.opener})})},_showConfirmDialog:function(e){requirejs(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(t){t.showConfirmDialog({message:e.message,details:e.details,status:"error",opener:e.opener,hasCancelButton:false},e.myPositiveHandler,e.myNegativeHandler)})},showErrorNotification:function(e){requirejs(["SBIS3.CONTROLS/Utils/InformationPopupManager","tmpl!SBIS3.DOCVIEW.Funcs/notification/notificationFooterTemplate","css!SBIS3.DOCVIEW.Funcs/notification/notificationFooter"],function(t,n){t.showNotification({caption:e.message,status:"error",details:e.details,footerTemplate:n})})},checkDeviceSupportOfficeOnline:function(e){var t={word:true,excel:true,powerpoint:true};if(!i.browser.isMobilePlatform)return t;var n=window.navigator.userAgent,r=n.match(/android\s([0-9\.]*)/i);if(r){var a=/Mobile/.test(n);if(parseFloat(r[r.length-1])<4)t={};else if(e)if(a)t={};else t.word=false}return t},getLockers:function(e){var t=new a,n=e.host||window.location.host;return require(["WS.Data/Source/SbisService"],function(r){new r({endpoint:{address:"/wopi/service/",contract:"Locks"}}).call("GetLockers",{FileID:e.attachId,Service:"http://"+n,Object:e.objectName}).addCallback(function(e){t.callback(e.getRow())}).addErrback(function(e){t.errback(e)})}),t},getFilesLockedInfo:function(e,t){var n=new s({adapter:"adapter.sbis"}),r=p.getInternalServiceUrl(t),i=[{name:"Object",type:"string"},{name:"Service",type:"string"}];return n.append(e.map(function(e){var n=t.isDisk&&e.get("Object")?"ObjectID":"AttachID",a=new l({adapter:"adapter.sbis",format:i.concat({name:n,type:"string"})}),o={Object:t.objectName,Service:r};return o[n]=e.get("ObjectID"===n?"Object":"attachId"),a.set(o),a})),new c({endpoint:{address:"/wopi/service/",contract:"Locks"}}).call("FilesLockedInfo",{files:n}).addCallback(function(e){return e.getAll()})},releaseExclusiveLock:function(e,t){return new c({endpoint:{address:"/wopi/service/",contract:"Locks"}}).call("ReleaseExclusiveLock",{Service:p.getInternalServiceUrl(t),Object:t.objectName,ID:e.get("attachId"),LockID:""})},_getLockMessage:function(e){var t=e.get("Lockers"),n=t.length,r="";if(n)if(1===n)r=rk("С документом работает")+" "+t[0];else r=rk("С документом работают")+" "+t.join(", ");return r},setLock:function(e){var t=e.lock?"AddLocker":"RemoveLocker",n=e.host||window.location.host;return p.getFileInfo(e.record,e.options).addCallback(function(e){return new c({endpoint:{address:"/wopi/service/",contract:"Locks"}}).call(t,{FileID:e.record.get("attachId"),Service:"http://"+n,Object:e.objectName}).addCallback(function(){return e})})},getFileInfo:function(e,t){var n=e.get("link")&&e.get("ShareId");if(n){var r={id:n,objectName:"FileSD",serviceUrl:"/disk/api/v1/",directLinkRouting:"disk"};return p.readAttachmentInfo(r).addCallback(function(e){if(!e.has("attachId"))e.addField({name:"attachId",type:"string"}),e.set("attachId",n);return r.record=e,r})}return a.success({record:e,objectName:t.objectName,serviceUrl:t.serviceUrl,directLinkRouting:t.directLinkRouting})},_addSubmenuItemsToCommandsArray:function(e){var t=[];if(!e)return t;return e.forEach(function(e){if(e.items)e.items.forEach(function(n){n.caption=n.caption||n.title,n.tooltip=n.title,n.parent=e.id||e.name,n.name=n.id,t.push(n)})}),e.concat(t)},checkServiceAvailable:function(e){var t=true;return $.ajax({url:e.serviceUrl+"service/?stat",dataType:"text",async:false,method:"GET",error:function(e){if(502===e.status||503===e.status)t=false}}),t},showAttachment:function(e,t,n,r){var i=n.mainOptions||{},o="undefined"!==typeof n.enabled?n.enabled:true,c="undefined"!==typeof i._isAuth?i._isAuth:true;if(n.serviceUrl=n.serviceUrl||"/",i.fixId=n.objId,i.objectName=n.objectName,i.serviceUrl=n.serviceUrl,i.commands)i.commands.fullScreen=false;if("undefined"!==typeof n.isDisk)i.isDisk=n.isDisk;var s=n.listOptions||{};s.defaultRecordPK=n.attachId;var l=n.viewOptions||{};if(l.justAttach=true,"edit"===e.query.mode)l.mode="edit";if("1"===e.query.isCreate)i.isCreate=true;var d=n.fileName||"",u=new a,f;if(e.headers&&n.lastRedaction)f=e.headers["x-forwarded-protocol"]+"://"+e.headers.host+p.createPreviewUrl({sync:true,absoluteServiceUrl:"http://"+e.headers.host+n.serviceUrl,objectName:n.objectName,attachId:n.objId,redactionId:n.lastRedaction.redactionId,hash:n.lastRedaction.hash,width:300,height:300});if("edit"===e.query.mode&&"0"!==e.query.checkLockers)p.getLockers({attachId:n.attachId,objectName:n.type||n.objectName,host:e.headers.host}).addCallback(function(n){if(!n.get("WebAppsEdit")&&n.get("Lockers").length)t.render("SBIS3.DOCVIEW.BaseAttachmentTemplate",{content:new r("SBIS3.DOCVIEW.AttachError",{message:p._getLockMessage(n)}),docName:d,modeOpened:"edit"===e.query.mode?"Редактирование":"Просмотр"});else u.callback()}).addErrback(function(n){t.render("SBIS3.DOCVIEW.BaseAttachmentTemplate",{content:new r("SBIS3.DOCVIEW.AttachError",{}),docName:d,modeOpened:"edit"===e.query.mode?"Редактирование":"Просмотр"})});else u.callback();u.addCallback(function(){t.render("SBIS3.DOCVIEW.BaseAttachmentTemplate",{content:new r(n.template||"SBIS3.DOCVIEW.FullScreenViewer",{mainOptions:i,listOptions:s,viewOptions:l,enabled:o}),userConfigSupport:c,globalConfigSupport:c,modeOpened:"edit"===e.query.mode?"Редактирование":"Просмотр",docName:d,useMainService:i&&i._useMainService,previewURL:f,isAuth:c})})},_getErrorHTML:function(e){var t='<div style="color:#999999;font-family: Tahoma; width: 370px;height: 100px;position: absolute;top:0;right: 0;bottom: 100px;left: 0;margin: auto;">'+'<div style="float: left;">'+'<img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3kAAQAEAAAAZAAA/+4AJkFkb2JlAGTAAAAAAQMAFQQDBgoNAAACqwAABKoAAAXiAAAHL//bAIQAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQICAgICAgICAgICAwMDAwMDAwMDAwEBAQEBAQECAQECAgIBAgIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD/8IAEQgAIAAgAwERAAIRAQMRAf/EANkAAAMAAwAAAAAAAAAAAAAAAAMHCAAGCQEAAwEBAQAAAAAAAAAAAAAAAQUGBAADEAACAgIBBAIDAAAAAAAAAAADBAIGAAUTEBQVFgE0EjYHEQAABQEGAwQIBwAAAAAAAAABAgMEBREhEhMUFQYAMUEQcSIyUWIjM9MWpjckRGQltYYHEgAABQEEBgcJAAAAAAAAAAAAARECAxIQITEEQVFhsSIz8IHBMqKjNHGRofFSgrITgxMBAQACAQMDBAMBAAAAAAAAAREhMQAQQVHwYXGBkaHRscHx4f/aAAwDAQACEQMRAAAB6HXM0rWeJ+oWdBIGrBwaojtJy3IujTDhfsWf1XbDJRM+2nagUmBCRncYH//aAAgBAQABBQK+MbKy3i1aSX8u2n9Ssm3qj9asustOsyu06w7W55pNs+3b9lv/AB+/oNB9H6Vv9/uCG9837Jf89kv+U9De+b//2gAIAQIAAQUCRiNdJU3kxaxcTUGFyKkxhtcSeGFCKgwcgHnu96MfQUmDh7dDO3QxuYOH/9oACAEDAAEFAmfmRWDD7ObhZhkIsDQwQCzYwc5fJ5E/Eqy3b9BfaPEnJytZytYCJOT/2gAIAQICBj8CfnnNqkW7cHtzTW3aRLFJjwpr0j9cnzsLK5M1XvHf2691kMjS43Vr1HcJJl5dPWpoG8NNK6VxTYWqzLf0/ISwTOorpvRcDHqfLcPU+W4RQQuroqvRMTH/2gAIAQMCBj8CbliNGBpwmd+gMe3C/sFbLDmzBezpsskYfdKlPcGR/UvwB3qtkv27gyWMqqV2YjleIhyvEQfLIVNSbcB//9oACAEBAQY/AobYTeQWjo1duDh8ZARKZwbBdPFb90QxSkaNqJlN4cQajWzjb7rastKKHfqq40a4WTUFzlztguHTbIoJrIusW5QydQMFg+jactG3jIFNMIP0DXso6TU0oxG64hYRQwJmFM3mKIDTqHCclGqVKPgcNz0zDNxSpkFyhyMHQeRgtDsebr3q0MgDQ5VYVmd0zcplNiHypSgzdOSpJxqZa0Gl9UwGtG92b3i3C+IxiPlrTkMJEuX1CMVcO/aETKsrirFr4zGp0pxtqDymL8w6x+Kx7mU0lkR37nBPmMxfu+Yl3nbxK/uup6nkfyOSwMlnP1jvExM36tLvWvZ/pX9O/hV+NpT8HElmjQJpwrhhqDaNOcJVii0TOVw6qmBU7oiNgjy7w+2v1jC/A4+2v1jC/A43bPzkSWFNPGgyt2GoNpI5AimKzRQ5nDWiYlUvAIWAPPvH/9oACAEBAwE/ISIcZgfgA4KpxAlRiujIvmlC057IWR2SO46FRbAvqwAF5zaeuiPQu7DduKCDutCufY9sM/GdsyWOejXO59Avs89D8PRn4HQxLztGYZUmi2Ai9QwwJztGYZUmo2EgcP/aAAgBAgMBPyEmgxXbIPjLl3OCWwkJJb5WJLv59/PRLs8z8X/OPTz2ew8nrHSo8JAfOhX8RPHSWzOVzEw0Q8T35pd2J9UuJ8N5+/g6A9R7OY32Km86Oep+znqfs5jfZqazp5//2gAIAQMDAT8hboxX32/wY9+Nb627yeJv457+4dnwf6599B3Hw9JpJrR+NL/1novH4S08xze9dRfrefH/ALTV93z09X7ueaslNE289X9XPV/VzxVkpomzn//aAAwDAQACEQMRAAAQCeHC7Drd/9oACAEBAwE/EDr5oWJrZhtCudeGtbenBTLzwkbMWErczSGj4fcXiGTegBvRlZ6WXa2TMqXfT/ttOtFhjSr1O7j/AOy4nqfL+DufCMzcKH4B1V++78IzNwofgHFf/9oACAECAwE/EIZNeQcJdm5aYJW1EnEJ5i3ZCUYJxNcYFKkvmCg6RBjRMAMn8VPHk2sOehskgNSFqtDKWiQY53fhR3yLQTCt05594csrsNd+BjfPWPD2J8re0z0gEjI54XRz1oGQ23APSCBSMjnlNDPSI5TTcof/2gAIAQMDAT8Qw8wvsW+QgHFVuI7UqoOTBAEqRqlG6uyhLWDR4HCrZFMU4YTGk+UH8OkydFjB1RDWDEBmYqKW3ll2MgZWQK1zlZ2hz7YWYekdk2Teefr5/v1+Ene9ao4p5MYh0Yiu3WO50qqjinkwqnRmiad47v8A/9k=" style="width:32px;height:32px; padding-top: 6px;"/>'+'</div><div><p style="font-size: 32px; margin: 0px;padding-left:48px;">'+rk("Документ не найден")+'!</p><p style="font-size: 13px; margin: 0px;padding-left:48px;padding-top: 8px;">'+rk("Возможно, он был удален или сейчас к нему ограничен доступ")+"</p></div></div>";return t+="\x3c!-- "+e.message+" --\x3e",t},escapeSpaces:function(e){return(null==e?"":String(e)).replace(/ /g,"&nbsp;")},parseFileName:function e(t){var n=(t=t||"").replace(/\n/g," ").match(/^(.*)\.(.*)$/)||[];return{fullName:t,name:!n[2]?t:n[1]||t||"",extension:n[1]?(n[2]||"").toLowerCase():""}},getFileName:function e(t,n){if(t=t||"",!n)n=i.browser.isUnix?"/":"\\";return t.substring(t.lastIndexOf(n)+1)},generateScreenShotName:function e(t,n){var r=rk("Скриншот от $date$t$%d.%m.%y, %H-%M-%S$.$ext$s$");return this.generateUniqueName(t,r,n)},generateScanName:function e(t,n){var r=rk("Скан от $date$t$%d.%m.%y, %H-%M-%S$.$ext$s$");return this.generateUniqueName(t,r,n)},generateUniqueName:function(e,n,r){var i=1,a=e.split(".").pop(),o=new Date,c=t({date:o,cnt:i,ext:a},n);if(r&&r.length>0)while(r.indexOf(c)>=0)c=t({date:o,cnt:++i,ext:a},n);return c},uniqueName:function(e,t,n){var r=0,i=p.parseFileName(e),a=e;while(t.indexOf(a)>=0)r+=1,a=n?e+" ("+r+")":i.name+" ("+r+")."+i.extension;return a},getFileExtension:function e(t){return this.parseFileName(t).extension},_isFileExtensionIn:function(e,t){if(!t||!e)return false;e=e.toLowerCase();for(var n=0;n<t.length;n++)if(t[n].toLowerCase()===e)return true;return false},_isFileWithExtensions:function(e,t){return p._isFileExtensionIn(this.getFileExtension(e),t)},wildcardToRegExp:function(e){for(var t="",n,r=0;r<e.length;r++){switch(n=e.charAt(r),n){case"*":n=".*";break;case"?":n=".";break;case".":n="\\."}t+=n}return new RegExp(t+"$","i")},getItemsInCurrentFolder:function(t){var n=[];if(t&&e.instanceOfModule(t,"SBIS3.DOCVIEW.List")){var r=t.getTreeView().getItems(),i=t.getCurrentRoot();if(r)r.each(function(e){if(e.get("folder")==i)n.push(e)})}return n},getFileObjectsInCurrentFolder:function(e){return this.getItemsInCurrentFolder(e).filter(function(e){return e.get("fileName")}).map(function(e){return{fileName:e.get("fileName"),fileTitle:e.get("title"),isFormDoc:!!e.get("versionForm")}})},getFilesArray:function(e){return(e||[]).map(function(e){return e.fileName})},testFileName:function(e,t){if(!(t instanceof Array))t=[];if(!t.length)return true;for(var n=0;n<t.length;n++)if(this.wildcardToRegExp(t[n]).test(e))return true;return false},readFolderInfo:function(e){return e.method="ReadFolderInfo",p.getInfoFromBL(e)},readAttachmentInfo:function(e){if(e.method="ReadAttachmentInfo","Archvie"===e.objectName)e.method="ReadFileInfo";if(e.record){var t="attachId";if(!e.model&&e.record._linkedControl)e.model=e.record._linkedControl._getMyModel();return e.id=e.record.get(t),this.getInfoFromBL(e).addCallback(function(n){var r={};return e.record.getFormat().each(function(t){var i=t.getName();if(!n.has(i))n.addField({name:i,type:t.getType()}),r[i]=e.record.get(i)}),n.set(r),n.setIdProperty(t),n})}return p.getInfoFromBL(e)},_getAttachmentInfo:function(e,t){return p.readAttachmentInfo({objectName:t.getObjectName()||e.mainOptions.objectName,serviceUrl:t.getServiceUrl()||e.mainOptions.serviceUrl,record:t}).addCallback(function(e){if(t._options.isError)e._options.isError=true;return e})},getInfoFromBL:function(e){var t=new a,n={endpoint:{address:e.serviceUrl+"service/",contract:e.objectName},idProperty:"attachId"},r=e.model&&d.isRegistered(e.model)&&d.resolve(e.model)||e.record;return requirejs(["WS.Data/Source/SbisService"],function(i){new i(n).call(e.method,{"ИдО":e.id.toString()}).addCallback(function(e){var n=e.getRow();if(r)(n=d.resolve(r.$constructor,{rawData:n.getRawData(),adapter:e.getAdapter()}))._options=m(r._options);t.callback(n)}).addErrback(function(e){t.errback(e)})}),t},cloneMyRec:function(e){var t=e.$constructor,n=m(e._options);return n.rawData={},e.getFormat().each(function(t){var r=t.getName();n.rawData[r]=e.get(r)}),delete n.adapter,new t(n)},getFamilyIO:function(e){if(e=e||"",3===e.split(".").length)return e;var t=e.split(" "),n=t[0];if(t.length>1&&t[1][0])n+=" "+t[1][0]+".";if(t.length>2&&t[2][0])n+=t[2][0]+".";return n},getSyncPreviewUrl:function(e,t){return p.createPreviewUrl({sync:true,serviceUrl:e._options.serviceUrl,objectName:e._options.objectName,attachId:e.get("attachId"),redactionId:e.get("redactionId"),hash:e.get("hash"),width:t.width,height:t.height})},getFileOpt:function(e){var t={program:"",ico_font:"",color:"",isUnknown:false,extension:this.getFileExtension(e)};switch(t.extension){case"jpeg":case"jpg":case"png":case"gif":case"tif":case"tiff":case"psd":case"webp":case"bmp":t["program"]="Средство просмотра изображений",t["ico_font"]="",t["color"]="#FEC63F";break;case"vsd":case"vsdx":t["ico_font"]="",t["color"]="#CCCCCC";break;case"pdf":t["program"]="Adobe Reader",t["ico_font"]="",t["color"]="#EF463A";break;case"doc":case"docx":case"dotx":case"rtf":case"odt":case"docm":case"dot":case"dotm":t["program"]="Microsoft Word 2007-2010",t["ico_font"]="",t["color"]="#587AB0";break;case"zip":case"rar":case"7z":t["program"]="Архиватор WinZip",t["ico_font"]="",t["color"]="#999999";break;case"xml":t["program"]="Средство просмотра XML-файлов",t["ico_font"]="",t["color"]="#999999";break;case"xls":case"xlt":case"xlsx":case"xlsm":case"ods":case"xlsb":case"csv":t["program"]="Microsoft Excel 2007-2010",t["ico_font"]="",t["color"]="#72BE44";break;case"ppt":case"pptx":case"odp":case"pot":case"potx":case"ppsx":case"pps":case"ppsm":case"potm":case"pptm":t["program"]="Microsoft PowerPoint",t["ico_font"]="",t["color"]="#EF463A";break;case"html":case"htm":case"txt":case"patch":case"py":case"plain866":case"plain1251":case"sql":case"orx":case"cpp":case"js":case"h":case"dicx":case"uax":case"rlx":case"trg":case"cnv":case"json":t["program"]="Текстовый документ",t["ico_font"]="",t["color"]="#000000";break;case"lnk":case"url":t["program"]="Браузер",t["ico_font"]="",t["color"]="#999999";break;case"avi":case"flv":case"3gp":case"m4v":case"mpg":case"mpeg":case"wmv":case"mov":case"ogv":case"webm":case"mkv":case"vob":case"mp4":t["program"]='"Неизвестное программное обеспечение"',t["ico_font"]="&#xe73d;",t["color"]="#72be44";break;case"mp3":case"wav":case"wma":t["program"]='"Неизвестное программное обеспечение"',t["ico_font"]="&#xe73c;",t["color"]="#336E7B";break;default:t["program"]='"Неизвестное программное обеспечение"',t["ico_font"]="",t["color"]="#CCC",t.isUnknown=true}return t},getPrettyFileSize:function(e){if(!e)return"-";if(0===e)return"0 Б";var t=1024,n=[rk("Б"),rk("КБ"),rk("МБ"),rk("ГБ"),rk("ТБ")],r=parseInt(Math.floor(Math.log(e)/Math.log(t)),10),i=e/Math.pow(t,r);if(n[r]===rk("Б")||n[r]===rk("КБ"))return i.toFixed(0)+" "+n[r];else if(n[r]===rk("МБ"))return(i.toFixed(i<100?1:0)+" "+n[r]).replace(/\.0+ /," ");else if(n[r]===rk("ГБ")||n[r]===rk("ТБ"))return(i.toFixed(i<100?2:0)+" "+n[r]).replace(/\.0+ /," ")},getOptionsForSave:function(e,t){var n=t._options.mainOptions,r=n.commands,i=t._dataController.getFilter(),a={};for(var o in r)if(r.hasOwnProperty(o))a[o]=r[o];return{listOptions:{root:t._dataController.getCurrentRoot(),pageSize:t._options.listOptions.pageSize},mainOptions:{ctxLinkId:n.ctxLinkId,fixId:n.fixId,objectName:n.objectName,serviceUrl:n.serviceUrl,useOnlyCtx:n.useOnlyCtx,commands:a,isDisk:n.isDisk,filter:{InitialRootId:i.InitialRootId,IsRootFolder:i.IsRootFolder,catalogId:i.catalogId,Path:i.Path}},full_path:t._getCurrentPathToZip(t._dataController.getItems(),e)}},setAllOptions:function(e,t){e._options.mainOptions.ctxLinkId=t.mainOptions.ctxLinkId,e._options.mainOptions.fixId=t.mainOptions.fixId,e._options.mainOptions.objectName=t.mainOptions.objectName,e._options.mainOptions.serviceUrl=t.mainOptions.serviceUrl,e._options.mainOptions.useOnlyCtx=t.mainOptions.useOnlyCtx;var n=t.mainOptions.commands;e._options.mainOptions.commands={};for(var r in n)if(n.hasOwnProperty(r))e._options.mainOptions.commands[r]=n[r];if(e._options.mainOptions.isDisk=t.mainOptions.isDisk,e._options.mainOptions.filter&&t.mainOptions.filter)e._options.mainOptions.filter.InitialRootId=t.mainOptions.filter.InitialRootId,e._options.mainOptions.filter.IsRootFolder=t.mainOptions.filter.IsRootFolder;e._options.hiddenWithOneDoc=t.hiddenWithOneDoc,e._notifyOnPropertyChanged("listOptions"),e._notifyOnPropertyChanged("mainOptions")},getResponsible:function(e,t){var n="",r="",i="",a=t===p.ROOT_FOLDER_SHARED,o=t===p.ROOT_FOLDER_MY_TRASH||t===p.ROOT_FOLDER_COMMON_TRASH;if(!(t===p.ROOT_FOLDER_MY)&&!o)n=e.get(a?"Author":"Owner")||"",r=e.get(a?"AuthorName":"OwnerName"),i=a?rk("Предоставил доступ"):e.get("folder@")?rk("Владелец папки"):rk("Владелец документа");return{id:n,name:r,description:i,attachId:e.get("attachId")}},isDemoMode:function(){return o.get("isDemo")},isAuthenticated:function(){return!!this.getUserID()},getUserID:function(){return o.get("ИдентификаторПользователя")},getClientID:function(){return o.get("ИдентификаторКлиента").toString()},getPluralForm:function(e,t,n,r){return e=e<0?-e:e,e%10===1&&e%100!==11?t:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?n:r},getRootName:function(e){switch(e){case p.ROOT_FOLDER_COMMON:return"Общие документы";case p.ROOT_FOLDER_LOADS:return"Загрузки";case p.ROOT_FOLDER_MY:return"Мои документы";case p.ROOT_FOLDER_SHARED:return"Со мной поделились";case p.ROOT_FOLDER_COMMON_TRASH:return"Корзина общих";case p.ROOT_FOLDER_MY_TRASH:return"Корзина моих"}},ROOT_FOLDER_MY:"mydocs",ROOT_FOLDER_COMMON:"commondocs",ROOT_FOLDER_LOADS:"loads",ROOT_FOLDER_SHARED:"sharedmedocs",ROOT_FOLDER_MY_TRASH:"mytrash",ROOT_FOLDER_COMMON_TRASH:"commontrash",ROOT_FOLDER_MY_RECENT:"myrecent",ROOT_FOLDER_COMMON_RECENT:"commonrecent",ROOT_FOLDER_RECENT:"recent",wrapperDef:function(e){return e instanceof a?e:a.success(e)},createEventTransmitter:function(e){function t(t){for(var n=[t.name],r=1,i=arguments.length;r<i;r++)n.push(arguments[r]);t.setResult(e._notify.apply(e,n))}return t},openFullScreenByFileId:function(e){var t=new a;function n(e){var t=e.getTarget().getView();t._createdByImageEditor=true,f.channel("imageEditor").subscribe("onWriteImgDone",r),t.startCommand("imageEdit",[t.savedRec])}function r(e,n){return f.channel("imageEditor").unsubscribe("onWriteImgDone",r),$("body").removeClass("imageEdit__hideCommandPanel"),p.readAttachmentInfo({id:n.attachId,objectName:"FileSD",serviceUrl:"/disk/api/v1/"}).addCallback(function(e){t.callback({url:e.get("relativeUrl"),code:201,id:n.attachId})})}return p.openFullScreen({record:new l({rawData:{attachId:e}}),_options:{mainOptions:{isOneRec:true,isDisk:true,objectName:"FileSD",serviceUrl:"/disk/api/v1/"}},handlers:{onReady:function(){$("body").addClass("imageEdit__hideCommandPanel")},onShowFile:n}}),t},openImagesInFullScreen:function(e,t,n){var r=this;requirejs(["WS.Data/Collection/RecordSet"],function(i){if(!Array.isArray(e))e=[String(e)];if(!e.length)return;var a=new i({idProperty:"attachId",rawData:e.map(function(e,t){return{attachId:t,canEdit:false,fileName:"image.v1516270649826335cf4508dd597be4bfc9caa3e08b901.png",hash:e,imageUrl:e,relativeUrl:e}})});t=!t||t<0||t>=e.length?0:t,r.openFullScreen(u({recordSet:a,record:a.at(t),_options:{mainOptions:{commands:{copyToBuffer:false,deleteDoc:false,directLink:false,links:false,redactions:false,rename:false,rights:false,saveToPdf:false,sendMessage:false,signDocument:false}}}},n||{}))})},_getValidSignsValue:function(e,t){var n=e._getRawDataValue("signs"),r=t._getRawDataValue("signs");if("number"===typeof n&&"number"!==typeof r&&!!n&&!!r)return n;else return t.get("signs")},getRedactionIds:function(e,t){var n=new a;if(e.every(function(e){return!!(e.get("redactionId")||e.get("folder@"))}))return n.callback(e),n;return requirejs(["Core/ParallelDeferred"],function(r){n.dependOn(new r({steps:e.map(function(e){if(e.get("redactionId")||e.get("folder@"))return a.success(e);return p.readAttachmentInfo({id:e.get("attachId"),objectName:t.objectName,serviceUrl:t.serviceUrl+"service/",record:e})})}).done().getResult().addCallback(function(e){return Object.keys(e).map(function(t){return e[t]})}))}),n},createPreviewUrl:function(e){var t=this.normalizePreviewSize(e.width,e.height),n="DocView.ReadAttachmentAsPreview"+(e.sync?"Sync":""),i={Service:e.absoluteServiceUrl||"http://"+this.getHost()+e.serviceUrl,Object:e.objectName,ID:e.attachId&&String(e.attachId),IDRedaction:e.redactionId&&String(e.redactionId),Version:e.hash,Width:t.width,Height:t.height};if(e.sync){if("boolean"===typeof e.Transp)i.Transp=e.Transp;if("boolean"===typeof e.Icon)i.Icon=e.Icon}return i=encodeURIComponent(r.encode(JSON.stringify(i))),"/docview/service/?method="+n+"&params="+i+"&id="+(e.previewId||0)},normalizePreviewSize:function(e,t){for(var n=[{height:100,width:100},{height:330,width:330},{height:900,width:900}],r=0;r<n.length;r++)if(n[r].height>=t&&n[r].width>=e)return n[r];return{height:900,width:1900}},getHost:function(){if("undefined"===typeof window)return"undefined"!==typeof process&&process.domain&&process.domain.req&&process.domain.req.headers&&process.domain.req.headers.host||"";return window.location.host},readByObject:function(e){var t,n;return t=new c({endpoint:{contract:"FileSD",address:"/disk/api/v1/service/"}}),n=new l({adapter:"adapter.sbis",format:[{name:"ReadLinkedObjects",type:"boolean"},{name:"ReadVersions",type:"integer"},{name:"ReadServiceFiles",type:"boolean"}]}),n.set({ReadLinkedObjects:false,ReadVersions:1,ReadServiceFiles:true}),t.call("ReadByObject",{Id:e,ExtraParams:n}).addCallback(function(e){return e.getRow()})}};return d.register("ImageEditor",p,{instantiate:false}),p});
//# sourceMappingURL=Funcs.module.js.map
define("js!SBIS3.DOCVIEW.Command",["Core/core-instance","Core/constants","SBIS3.CONTROLS/CompoundControl","js!SBIS3.DOCVIEW.Funcs","Core/Deferred","WS.Data/Chain"],function(n,t,e,o,i,r){"use strict";var a;return a=e.extend({$protected:{_options:{records:[],isOperationPanel:false,isMenu:false},_finishParams:{},_play:function(){},_endPlay:function(){},_findRecordSet:function(n){if(n.viewerRecordSet)return n.viewerRecordSet;else{var t=n.getParent();if(!t||n===t)return null;return this._findRecordSet(t)}},_getCommandsManager:function(){var n=this.getParent();while(n&&(!n.isValidParent||!n.isValidParent())){var t=n.getParent();if(n!==t)n=t;else break}return n}},_getRecords:function(){var t=this._options.records;if(!t||!t.length){var e=this.getParent();if(e&&n.instanceOfModule(e,"SBIS3.DOCVIEW.OperationPanel"))t=e._selIts&&new r(e._selIts).toArray()}return t},$constructor:function(){this._publish("onStartCommand","onFinishCommand","onErrorCommand","onCancelCommand","onCommandActivated","onProcessCommand");var n=this;if(this._options.records=this._getRecords(),this.once("onReady",function(){if(n._options.isMenu)try{n.getChildControlByName("mainBtn").subscribe("onMenuItemActivate",function(t,e){n._notify("onCommandActivated",n.idCmd,{records:n._options.records,item:e})})}catch(n){}else try{n.getChildControlByName("mainBtn").subscribe("onActivated",function(){n._notify("onCommandActivated",n.idCmd,{records:n._options.records})})}catch(n){}}),"undefined"!==typeof window&&t.browser.isMobilePlatform)n.getContainer()[0].addEventListener("touchmove",function(n){n.preventDefault?n.preventDefault():n.returnValue=false},false),n.getContainer()[0].addEventListener("touchstart",function(t){var e=(new Date).getTime(),o=e-(n._options.lastTouch||e+1);if(n._options.lastTouch=e,o<300&&o>0)t.preventDefault?t.preventDefault():t.returnValue=false,n.play()},false)},play:function(n){var t=this,e;o.wrapperDef(this._notifyOnStartCommand(n)).addCallback(function(r){if(false===r)return t._notifyOnCancelCommand();return e=t._showConfirmDialog(),e.addCallback(function(){return o.wrapperDef(t._play(n)).addCallback(function(){var n=t._notifyOnFinishCommand();if(n instanceof i)return n.addCallback(function(n){if(false!==n)t._endPlay()})})})}).addErrback(function(n){if("cancel"===n.message)t._notifyOnCancelCommand();else t._notifyOnErrorCommand(n)})},_showConfirmDialog:function(){var n=this,t=new i,e="function"===typeof n._getConfirmDialogText&&n._getConfirmDialogText();if(e)requirejs(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(o){var i={message:e,hasCancelButton:false,opener:n};if(n._options.confirmDialogDefaultButtonIsCancel)i.handlers={onReady:function(){var n=this.getChildControlByName("negativeButton"),t=this.getChildControlByName("positiveButton");t.setPrimary(false),n.setPrimary(true),this.subscribeOnceTo(t,"onFocusIn",function(){n.setActive(true)})}};if(n._options.confirmMessageMaxLength)i.messageMaxLength=n._options.confirmMessageMaxLength;o.showConfirmDialog(i,function n(){t.callback()},function e(){n._notifyOnCancelCommand(),t.errback()})});else t.callback();return t},_notifyOnCancelCommand:function(){return this._notify("onCancelCommand",this.idCmd,{records:this._getRecords()})},_notifyOnErrorCommand:function(n){return this._notify("onErrorCommand",this.idCmd,{records:this._getRecords(),error:n})},_notifyOnStartCommand:function(n){return this._notify("onStartCommand",this.idCmd,{records:this._getRecords(),item:n&&n.item,instance:this})},_notifyOnFinishCommand:function(){var n={records:this._getRecords(),finishParams:this._finishParams};return this._notify("onFinishCommand",this.idCmd,n)},_clickHandler:function(){this._notify("onCommandActivated",this.idCmd,{records:this._options.records})},_getCommandOptions:function(){return this.idCmd&&this._options.mainOptions&&this._options.mainOptions.commandsOptions&&this._options.mainOptions.commandsOptions[this.idCmd]||{}},getIcon:function(){return""},getCaption:function(){return""}}),a});
//# sourceMappingURL=Command.module.js.map
define("tmpl!SBIS3.DOCVIEW.linkActivated",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,n,l,o,a){function c(){}var d=0,s=void 0!==t&&t?t:arguments[arguments.length-1];void 0===s&&(eval("var thelpers = null;"),s=global.requirejs("View/Runner/tclosure"));var u={};a&&a.isSetts&&(u=a.fullContext||{});var v="string"==typeof l?l:"",p=void 0===r?void 0:r,f={id:[],def:void 0},m=s.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),h=this&&this.includedTemplates?this.includedTemplates:{},y=s.getMarkupGenerator(o);try{var g=y.joinElements([y.createTag("div",{},[],n,f,this)],v,f);f.def&&(g=y.chain(g,f,n),f=void 0)}catch(e){s.templateError("resources/Docview/Commands/linkActivated/linkActivated.tmpl",e,i)}return g||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.linkActivated"}},i});
//# sourceMappingURL=linkActivated.tmpl.map
define("tslib",[],function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)if(o.hasOwnProperty(n))t[n]=o[n]};return{__extends:function(o,n){t(o,n);function r(){this.constructor=o}o.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}});
//# sourceMappingURL=tslib.js.map
define("Lib/ServerEvent/native/HashedCounter",["require","exports"],function(t,e){"use strict";return function(){function t(t){if(void 0===t)t=true;if(this.counter=Object.create(null),this.list=[],!t)this.add=this.addWithoutCount.bind(this)}return t.prototype.add=function(t){var e=this.counter[t.hash()]||0;e+=1,this.counter[t.hash()]=e,this.list.push(t)},t.prototype.addWithoutCount=function(t){if((this.counter[t.hash()]||0)>0)return;this.counter[t.hash()]=1,this.list.push(t)},t.prototype.remove=function(t){var e=this.counter[t.hash()]||0;if(0===e)return;if(e-=1,e>0)return void(this.counter[t.hash()]=e);this.list=this.list.filter(function(e){return e.hash()!==t.hash()}),delete this.counter[t.hash()]},t.prototype.removeByName=function(t){var e=[],r=function(r){if(r.getChannelName()!==t)return true;return e.push(r),false};this.list=this.list.filter(r);for(var n=0,i=e;n<i.length;n++){var h=i[n];delete this.counter[h.hash()]}return e},t.prototype.has=function(t){return!!this.counter[t.hash()]},t.prototype.hasByName=function(t){for(var e=0,r=this.list;e<r.length;e++)if(r[e].getChannelName()===t)return true;return false},t.prototype.getSubscribes=function(){return this.list.slice()},t.prototype.getByName=function(t){for(var e=[],r=0,n=this.list;r<n.length;r++){var i=n[r];if(i.getChannelName()!==t)continue;e.push(i)}return e},t.prototype.getCount=function(t){return this.counter[t.hash()]||0},t.prototype.clear=function(){this.list=[],this.counter=Object.create(null)},t}()});
//# sourceMappingURL=HashedCounter.js.map
define("Lib/ServerEvent/native/EventStorage/Writer",["require","exports"],function(e,t){"use strict";return function(){function e(t,r){this.db=t,this.storeName=r,this.garbageCollection=this.garbageCollection.bind(this),setInterval(this.garbageCollection,e.GC_INTERVAL)}return e.prototype.write=function(t){var r=Date.now(),o={headers:t.headers,body:t.body,command:t.command};o[e.STORE_KEY]=r,this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(o)},e.prototype.createStore=function(){this.db.createObjectStore(this.storeName,{keyPath:e.STORE_KEY,autoIncrement:false})},e.prototype.garbageCollection=function(){var t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName),r=t.count();r.onsuccess=function(){if(r.result<=100)return;t.delete(IDBKeyRange.upperBound(Date.now()-e.GC_EVENT_LIMIT))}},e.GC_INTERVAL=5e3,e.STORE_KEY="timestamp",e.GC_EVENT_LIMIT=5*60*1e3,e}()});
//# sourceMappingURL=Writer.js.map
define("Lib/ServerEvent/native/EventStorage/Reader",["require","exports"],function(e,r){"use strict";return function(){function e(e,r){this.db=e,this.storeName=r}return e.prototype.query=function(e){var r=this;return new Promise(function(e,t){var n=r.db.transaction(r.storeName,"readonly").objectStore(r.storeName).openCursor(),o=[];n.onsuccess=function(r){var t=n.result;if(!t)return e(o);if(t.value)o.push(t.value);t.continue()},n.onerror=t}).then(function(r){if(!e)return r;return r.filter(function(r){var t;if(r["headers"]&&r["headers"]["event-type"])t=r["headers"]["event-type"];return t.match(e)})})},e}()});
//# sourceMappingURL=Reader.js.map
define("Lib/ServerEvent/native/EventStorage/ConnectorIE",["require","exports","Lib/ServerEvent/native/EventStorage/Writer","Lib/ServerEvent/native/EventStorage/Reader","Core/Deferred"],function(e,r,n,t,o){"use strict";return function(){function e(e){this.db=e}return e.connect=function(){var r=new o;if("object"!==typeof indexedDB)return o.fail("В окружении нет indexedDB");var t;try{t=indexedDB.open(e.DB_NAME,1)}catch(e){return console.warn(e),r.errback(e),r}return t.onupgradeneeded=function(r){var t=this.result;t.onerror=function(e){console.error("Database error: "+e.target.errorCode)},new n(t,e.STORE_NAME).createStore()},t.onsuccess=function(n){var t=this.result;r.callback(new e(t))},t.onerror=function(e){return console.warn("Почему Вы не позволяете online.sbis.ru использовать IndexedDB?!"),r.errback("You haven't rights to use IndexDB."),true},r},e.prototype.getWriter=function(){return new n(this.db,e.STORE_NAME)},e.prototype.getReader=function(){return new t(this.db,e.STORE_NAME)},e.DB_NAME="sbis.seb",e.STORE_NAME="events",e}()});
//# sourceMappingURL=ConnectorIE.js.map
define("Lib/ServerEvent/native/AckSender",["require","exports"],function(t,e){"use strict";return function(){function t(t){if(this.isAck=t,this.queueLen=0,this.send=this.send.bind(this),!t)this.start=function(){},this.stop=function(){}}return t.prototype.send=function(){if(!this.last)return;this.last.ack(),this.last=void 0,this.queueLen=0},t.prototype.push=function(e){if(this.last=e,this.queueLen=this.queueLen+1,this.isAck&&this.queueLen>=t.LIMIT_ACK)setTimeout(this.send,0)},t.prototype.start=function(){this.timer=setInterval(this.send,t.INTERVAL)},t.prototype.stop=function(){clearInterval(this.timer)},t.LIMIT_ACK=9,t.INTERVAL=2*1e3,t}()});
//# sourceMappingURL=AckSender.js.map
define("Core/LocalStorageNative",["Core/UserInfo","Core/IoC"],function(t,e){"use strict";var r=function(){return this||(0,eval)("this")}(),n="__sid",i="__s3su",o="ws-local-keys",u="ws-store-always-keys",a=s(),c=1024*512;function f(t,r){r=r||"log",e.resolve("ILogger")[r]("Core/LocalStorageNative",t)}function s(){try{var t=this&&this.localStorage||r&&r.localStorage,e=Math.random().toString(),n="PingLocalStorage"+e;if(t.setItem(n,e),e!==t.getItem(n))throw new Error("localStorage not supported, using fake storage");return t.removeItem(n),t}catch(t){return new l}}function l(){var t={};this.setItem=function(e,r){t[e]=r&&r.toString()||""+r,this.length++},this.removeItem=function(e){delete t[e],this.length--},this.getItem=function(e){return t[e]||null},this.clear=function(){t={},this.length=0},this.length=0}function g(t){var e=encodeURIComponent(t).match(/%[89ABab]/g);return t.length+(e?e.length:0)}var h=function(t,e){try{return a.setItem(t,e),true}catch(t){return f(t),false}},m=function(t){try{return a.getItem(t)}catch(t){return f(t),null}},v=function(t){try{a.removeItem(t)}catch(t){f(t)}},I=function(){var e=m(i);if(!t.isValid(e)){y();var r=t.getCurrent();if(r)h(i,r);else v(i)}},y=function(){var t=S(),e;try{e=[].concat(JSON.parse(m(u)))}catch(t){e=[]}var r=[];t.forEach(function(t){if(-1===e.indexOf(t))return v(t);r.push(t)}),h(o,JSON.stringify(r))},S=function(){try{return JSON.parse(m(o))||[]}catch(t){return[]}};return v(n),{getItem:function(t){return I(),m(t)},setItem:function(t,e){if(t===i)return;var r=""+e,n=g(r);if(n>c)return f("Maximum size of item for write local storage = "+c/1024+"kb, item size = "+(n/1024).toFixed(2)+"kb","error"),false;I();var a=h(t,r),s=S();if(-1===s.indexOf(t)&&t!==u)s.push(t),h(o,JSON.stringify(s));return a},removeItem:function(t){if(t===i)return;v(t);var e=S();e=e.filter(function(e){return t!==e}),h(o,JSON.stringify(e));var r;try{r=JSON.parse(m(u))||[]}catch(t){r=[]}if(-1!==r.indexOf(t))r=r.filter(function(e){return t!==e}),h(u,JSON.stringify(r))},clear:function(){y(),I()},getLength:function(){return a.length},getKeys:function(){return S()}}});
//# sourceMappingURL=LocalStorageNative.js.map
define("Lib/Storage/ie/LocalStorageNative",["require","exports","Core/detection","Core/EventBus","Core/LocalStorageNative"],function(e,t,n,r,i){"use strict";var o=function(){return this||(0,eval)("this")}(),a="__storage",u=function(){return r.channel("local_storage")},f="ws-store-always-keys",s="ws-local-keys",l=k("ie-fix-event",a),c=[];function g(e){return e.length>=2143}var v=/\$ie-fix\{(\d+)\}/i,d=Math.random().toString().substr(2),m;function h(e){if(e=e||o.event,!e)return;var t=e.key,n=e.newValue,r=e.oldValue;if(n==r)return e.stopPropagation(),void e.stopImmediatePropagation();var i=Date.now();if(m&&m.key===t&&m.newValue===n&&m.oldValue===r&&i-m.date<=2*1e3)return;m={key:t,newValue:n,oldValue:r,date:i};var f,s;if(n){var l=n.match(v);if(l)n=n.replace(l[0],""),f=l[1],s=true,e.stopPropagation(),e.stopImmediatePropagation()}if(f===d)return;if(y(t,a))return p(t,n,r);if(g(n))c.push({key:t,length:n.length});if(s)u().notify("onChange",t,n)}function p(e,t,n){var r=t;if(w(e,a)===l)setTimeout(function(){var e=L.getItem(r),t=c.filter(function(t){return t.key===r&&t.length===e.length});if(!t)u().notify("onChange",r,e);c=c.filter(function(e){return e!==t})},10)}function I(e){return e&&e.replace(v,"")||e}function y(e,t){return!t||0===e.indexOf(t+"/")}function k(e,t){return t&&t+"/"+e||e}function w(e,t){return t&&y(e,t)?e.substr(t.length+1):e}var L;if(n.isIE){if(L={getItem:function(e){return I(i.getItem(e))},setItem:function(e,t){if(e===f||e===s)return i.setItem(e,t);t="$ie-fix{"+d+"}"+t;var n=i.setItem(e,t);if(n&&g(t))i.setItem(l,e),i.removeItem(l);return n}},["getLength","getKeys","removeItem","clear"].forEach(function(e){L[e]=i[e].bind(L)}),o.addEventListener)o.addEventListener("storage",h,false)}else L=i;return L});
//# sourceMappingURL=LocalStorageNative.js.map
define("Lib/Storage/LocalStorage",["require","exports","Core/Abstract","Core/EventBus","Core/Serializer","Core/core-simpleExtend","Core/helpers/Object/isPlainObject","Lib/Storage/ie/LocalStorageNative"],function(e,t,r,n,i,o,u,f){"use strict";var s=function(){return this||(0,eval)("this")}(),a="ws-store-always-keys",c=["onChange","onRemove","onClear"],l=function(){return n.channel("local_storage")},h=new i,p=false;function v(){if(p||!s)return;if(p=true,s.addEventListener)return s.addEventListener("storage",y,false)}function y(e){if(!e&&s.event)e=s.event;if(!e)return;var t=e.key,r=e.newValue,n=e.oldValue;if(!t)return void l().notify("onClear");if(!r)return l().notify("onRemove",t);return l().notify("onChange",t,r)}function g(e,t,r){if(!t||x(t,this.prefix))return this._notify(e.name,S(t,this.prefix),C(r))}function m(e){return C(f.getItem(e))}function d(e){return f.getKeys().filter(function(t){return x(t,e)})}function x(e,t){return!t||0===e.indexOf(t+"/")}function b(e,t){return t&&t+"/"+e||e}function S(e,t){return t&&x(e,t)?e.substr(t.length+1):e}function O(e){var t=e;if(e&&"function"===typeof e.toJSON)t=e.toJSON();try{if(!t||u(t))return JSON.stringify(t,h.serialize);return JSON.stringify(t)}catch(e){return""+t}}function C(e){if(!e)return null;var t;try{t=JSON.parse(e,h.deserialize)}catch(t){return e}return t}var I=o.extend(r,{prefix:"",storeAlways:false,constructor:function(e,t){var n=this;r.apply(this,arguments),this.prefix=e||"",this.storeAlways=t||false,this._onStorage=g.bind(this),c.forEach(function(e){l().subscribe(e,n._onStorage)}),this._publish.apply(this,c),v()},destroy:function(){var e=this;return c.forEach(function(t){l().unsubscribe(t,e._onStorage)}),I.superclass.destroy.call(this)},setItem:function(e,t){if("undefined"===typeof t)return this.removeItem(e);var r=b(e,this.prefix),n=O(t),i=f.setItem(r,n);if(!i||!this.storeAlways)return i;var o=m(a)||[];if(-1===o.indexOf(r))o.push(r),f.setItem(a,O(o));return i},getItem:function(e){return m(b(e,this.prefix))},removeItem:function(e){return f.removeItem(b(e,this.prefix))},clear:function(){d(this.prefix).forEach(function(e){f.removeItem(e)})},getKeys:function(){var e=this;return d(this.prefix).map(function(t){return S(t,e.prefix)})},toObject:function(){var e={};return d(this.prefix).forEach(function(t){e[t]=m(t)}),e}});return I.clearAll=function(){f.clear()},I});
//# sourceMappingURL=LocalStorage.js.map
define("Lib/TabMessage/TabMessage",["require","exports","Lib/Storage/LocalStorage","Core/EventBus","Core/detection"],function(t,e,n,i,s){"use strict";var o="TabMessage",r={};function c(t,e){if(!s.isIE)return t.removeItem(e);if(r[e])clearTimeout(r[e]);r[e]=setTimeout(function(){t.removeItem(e)},500)}return function(){function t(){var t=this;this._storage=new n(o),this._channel=i.channel(o+"-"+Math.random().toFixed(6).toString().substr(2),{}),this._storage.subscribe("onChange",function(e,n,i){t._channel.notifyWithTarget(n,t,i)})}return t.prototype.destroy=function(){if(this._storage.destroy(),this._channel)this._channel.unsubscribeAll(),this._channel.destroy()},t.prototype.subscribe=function(t,e){return this._channel.subscribe(t,e,this),this},t.prototype.once=function(t,e){return this._channel.once(t,e,this),this},t.prototype.unsubscribe=function(t,e){return this._channel.unsubscribe(t,e),this},t.prototype.notify=function(t,e){if(void 0==e)e=""+e;this._storage.setItem(t,e),c(this._storage,t)},t}()});
//# sourceMappingURL=TabMessage.js.map
(function(){"use strict";var e=function(){return this||(0,eval)("this")}();(e.define||e.requirejs&&e.requirejs.define||requirejsVars&&requirejsVars.define)("optional",{load:function(e,i,n){i([e],n,function(){n(null)})}})})();
//# sourceMappingURL=optional.js.map
define("Lib/ServerEvent/ResponseConverter",["require","exports","optional!WS.Data/Entity/Record","optional!WS.Data/Collection/RecordSet"],function(r,t,e,n){"use strict";var o=i,a=i;if(!!e)o=function(r){if("record"!=r._type)throw new TypeError("Raw data is not Record");return new e({rawData:r,adapter:"adapter.sbis"})};if(!!n)a=function(r){if("recordset"!=r._type)throw new TypeError("Raw data is not RecordSet");return new n({rawData:r,adapter:"adapter.sbis"})};function i(r){return r}function u(r){return r&&r.s&&r.d&&"record"==r._type}function c(r){return r&&r.s&&r.d&&"recordset"==r._type}function f(r){for(var t in r){if(!r.hasOwnProperty(t))continue;r[t]=d(r[t])}return r}function s(r){for(var t=[],e=0,n=r;e<n.length;e++){var o=n[e];t.push(d(o))}return t}function d(r){if(u(r))return o(r);if(c(r))return a(r);if(r instanceof Array)return s(r);return r}function p(r){return d(JSON.parse(r))}return p});
//# sourceMappingURL=ResponseConverter.js.map
define("js!SBIS3.DOCVIEW.UpdaterMixin",["Core/base64","Lib/ServerEvent/Bus","Core/IoC","js!SBIS3.DOCVIEW.Funcs"],function(e,t,i,r){"use strict";var a={};return{$protected:{_waitPreviewsKeys:[],_errorsPreviewsKeys:[],_reloadPreviewIntervalId:null,_firstTimeTimeoutId:null},$constructor:function(){var e=this;if(!this._options.dontUpdate&&r.isAuthenticated())this.subscribeTo(t.serverChannel("docview.previewready"),"onMessage",function(t,i){e._onDocumentViewerChannelMessage(i)}),this.once("onDestroy",function(){clearInterval(e._reloadPreviewIntervalId),clearTimeout(e._firstTimeTimeoutId),e._waitPreviewsKeys=e._errorsPreviewsKeys=null})},_getCacheKey:function(e){var t=r.normalizePreviewSize(e.width,e.height);return e.attachId+";"+e.redactionId+";"+t.width+";"+t.height},_savePreviewId:function(e,t){a[this._getCacheKey(e)]=t},getPreviewId:function(e){return a[this._getCacheKey(e)]||0},_onDocumentViewerChannelMessage:function t(i){var r=this,a=i.get("ID"),n=i.get("IDRedaction");if(this._removeKeyFromWaitArray(a),i.has("IsError")&&i.get("IsError"))return void this._errorsPreviewsKeys.push(a);this.getContainer().find('[data-attachid="'+a+'"][data-redactionid="'+n+'"], '+'[data-attachid="'+a+'"][data-redactionid="null"]').each(function(){var t=$(this),n=t.attr("src"),s=false;if(i.has("Width")&&n){var o=decodeURIComponent(n.split("params=")[1].split("&id=")[0]),d=JSON.parse(e.decode(o));if(parseInt(d.Height,10)===i.get("Height")&&parseInt(d.Width,10)===i.get("Width"))s=true}if(s)r._savePreviewId({attachId:a,redactionId:t.attr("data-redactionid"),width:i.get("Width"),height:i.get("Height")},r._reloadImage(t))})},_reloadImage:function(e){var t=0;if(e.attr("src",e.attr("src").replace(/&id=(\d+)(?=$|#|&)/,function(e,i){return t=++i,"&id="+t})),this.viewerRecordSet){var i=e.attr("data-attachid"),r=this.viewerRecordSet.getRecordById(i);if(r)r._options.previewId=t}return t},_setJustInCasePreviewUpdater:function(){var e=this,t=this.viewerRecordSet,r=this.getContainer(),a="data-updatecount",n=5e3,s=o();if(this._waitPreviewsKeys.length=0,clearInterval(this._reloadPreviewIntervalId),clearTimeout(this._firstTimeTimeoutId),false===this._options.dontUpdate||!t||!t.getCount()||!s.length)return;this._firstTimeTimeoutId=setTimeout(function(){if(s=o(),s.each(function(t,i){var r=i.getAttribute("data-attachid");if(-1===e._errorsPreviewsKeys.indexOf(r))e._waitPreviewsKeys.push(r)}),e._waitPreviewsKeys.length)d(void 0,function t(){e._reloadPreviewIntervalId=setInterval(function(){d(function t(){clearInterval(e._reloadPreviewIntervalId)})},n)})},2*n);function o(){return r.find("[data-redactionid][data-attachid]").filter(function(e,t){return(!t.complete||40===t.naturalHeight&&40===t.naturalWidth)&&t.getAttribute(a)<3})}function d(t,r){if(s=o(),!s.length&&"function"===typeof t)return t();if(i.resolve("ILogger").log(e._moduleName,"Для "+(e._waitPreviewsKeys.length>1?"файлов":"файла")+' с идентификаторами "'+e._waitPreviewsKeys.join('", "')+'" не пришли события о готовности preview!'),s.each(function(t,i){var r=$(i);r.attr(a,+(r.attr(a)||0)+1),e._reloadImage(r)}),"function"===typeof r)return r()}},_removeKeyFromWaitArray:function(e){if(this._waitPreviewsKeys){var t=this._waitPreviewsKeys.indexOf(e);if(-1!==t)this._waitPreviewsKeys.splice(t,1)}}}});
//# sourceMappingURL=UpdaterMixin.module.js.map
define("Core/helpers/setSessionStorageValue",["Core/deprecated","Core/LocalStorageNative"],function(e,o){return e.showInfoLog("Хелпер Core/helpers/getSessionStorageValue помечен как deprecated и будет удален в 3.18. Используйте Core/LocalStorageNative::setItem(key, value)"),o.setItem});
//# sourceMappingURL=setSessionStorageValue.js.map
define("Core/helpers/getSessionStorageValue",["Core/deprecated","Core/LocalStorageNative"],function(e,o){return e.showInfoLog("Хелпер Core/helpers/getSessionStorageValue помечен как deprecated и будет удален в 3.18. Используйте Core/LocalStorageNative::getItem(key)"),o.getItem});
//# sourceMappingURL=getSessionStorageValue.js.map
define("js!SBIS3.DOCVIEW.LoadVisibilityModeMixin",["Core/helpers/string-helpers-min","Core/helpers/getSessionStorageValue","Core/helpers/setSessionStorageValue","Core/EventBus"],function(i,e,t,o){"use strict";var s="docview-list-viewmode";function n(){var i=e(s);try{i=JSON.parse(i)}catch(i){}if(!i||"object"!==typeof i)i={modes:{}};else if(!i.modes||"object"!==typeof i.modes)i.modes={};return i}function r(i){t(s,JSON.stringify(i))}function d(i,e){var t=n();t.modes[i]=e,r(t)}function l(i){return n().modes[i]}return{$protected:{_saveVisibilityMode:function(i,e,t,s){if(this._options.listOptions.visibilityMode.setFromCookie&&!s){var n="";try{if(t)n=this._formCookieName(t);else n=this._getCookieNameFromContext()}catch(i){}if(n){var r=(new Date).getTime(),l=this.getTopParent()._lastSavingTime;if(!l||r-l>100)d(n,i);this.getTopParent()._lastSavingTime=(new Date).getTime()}}o.channel("DocviewVisibiliyMode").notify("onChange",i,this,this._options.listOptions,e)},_getCookieNameFromContext:function(){var i;if(this.getTopParent()._currentDocId)i=this._formCookieName(this.getTopParent()._currentDocId);else i=this._formCookieName(this.getLinkedContext().getValue(this._options.listOptions.visibilityMode.savedModeField));return i},_listenChannelChangedModeSub:function(){var i=this;if(i.subscribeTo(o.channel("DocviewVisibiliyMode"),"onChange",function(e,t,o,s,n){var r=i.getTopParent(),d=o.getTopParent();if(s.visibilityMode.changedId===i._options.listOptions.visibilityMode.changedId&&(r===d||d===o)){if(i._options.listOptions.visibilityMode.defaultMode=t,n)i._savedMode=t;i._applyNewVisibilityMode(t),i._notify("onChangeVisibilityMode",t)}}),this._options.listOptions.visibilityMode.setFromCookie)i.getLinkedContext().subscribe("onFieldChange",function(e,t,o){try{if("currentFolder"===t)i.getLinkedContext().setValue("currentFolderId",o.Id);if(t===i._options.listOptions.visibilityMode.savedModeField&&i.getLinkedContext().getValue(i._options.listOptions.visibilityMode.savedModeField))if(i._setVisibilityMode())try{i._saveVisibilityMode(l(i._formCookieName(o)))}catch(i){}}catch(i){}})},_saveDocumentId:function(i){this.getTopParent()._currentDocId=i},_formCookieName:function(e){return i.transliterate(e)},_getSavedVisibilityModeFromCookie:function(i){var e=null;if(this._options.listOptions.visibilityMode.setFromCookie)try{if(i)e=l(this._formCookieName(i));else e=l(this._getCookieNameFromContext())}catch(i){}return e},_setVisibilityMode:function(i,e){var t;if(this._options.listOptions.visibilityMode.setFromCookie)t=this._getSavedVisibilityModeFromCookie(e);if(t=t||i,t){var o=this._options.listOptions.visibilityMode.defaultMode;return this._options.listOptions.visibilityMode.defaultMode=t,o!==t}return false},_savedMode:null},$constructor:function(){this._publish("onChangeVisibilityMode"),this._savedMode=this._options.listOptions.visibilityMode.defaultMode,this._setVisibilityMode(),this._listenChannelChangedModeSub()},getVisibilityMode:function(){return this._options.listOptions.visibilityMode.defaultMode}}});
//# sourceMappingURL=LoadVisibilityModeMixin.module.js.map
define("tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Title",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},r=function e(r,a,s,l,p){function o(){}var n=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};p&&p.isSetts&&(d=p.fullContext||{});var g="string"==typeof s?s:"",m=void 0===i?void 0:i,y={id:[],def:void 0},u=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),v=this&&this.includedTemplates?this.includedTemplates:{},T=c.getMarkupGenerator(l);try{var f=T.joinElements([c.getter(r,["item","isFolder"]).apply(c.getter(r,["item"]),[])?[T.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["item","getIcon"]).apply(c.getter(r,["item"]),["diskClassic"])])]))+" ")]:[!c.getter(r,["item","hasSmallPreview"]).apply(c.getter(r,["item"]),[])||c.getter(r,["item","get"]).apply(c.getter(r,["item"]),["Deleted"])||c.getter(r,["item","isEncrypted"]).apply(c.getter(r,["item"]),[])||c.getter(r,["item","get"]).apply(c.getter(r,["item"]),["doNotRequestPreview"])?[T.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["item","getIcon"]).apply(c.getter(r,["item"]),["diskClassic"])])]))+" ")]:[T.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["item","getPreviewDiv"]).apply(c.getter(r,["item"]),[{className:"diskClassic",width:24,height:24}])])]))+" ")]],T.createTag("span",{class:"dv-diskClassic__title-text "+c.wrapUndef(c.utils.escape(c.getter(r,["title","isLink"])?"dv-title-text_link":""))+" ws-ellipsis",title:""+c.wrapUndef(c.utils.escape(c.getter(c.getter(r,["item","getTitleForDisk"]).apply(c.getter(r,["item"]),[]),["tooltip"]))),style:""+c.wrapUndef(c.utils.escape(c.getter(r,["item","getTitleTextMaxWidth"]).apply(c.getter(r,["item"]),[])?"max-width:"+c.getter(r,["item","getTitleTextMaxWidth"]).apply(c.getter(r,["item"]),[]):""))},[T.createText(""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(c.getter(r,["item","getTitleForDisk"]).apply(c.getter(r,["item"]),[]),["fileName"])])]))),c.getter(c.getter(r,["item","getTitleForDisk"]).apply(c.getter(r,["item"]),[]),["ext"])?[T.createTag("span",{class:"dv-diskClassic__extension"},[T.createText(""+c.wrapUndef(c.utils.escape(c.getter(c.getter(r,["item","getTitleForDisk"]).apply(c.getter(r,["item"]),[]),["ext"]))))],{},y,this)]:T.createText("")],a,y,this),T.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["item","getSigns"]).apply(c.getter(r,["item"]),[])])]))+" "),c.getter(r,["item","isEncrypted"]).apply(c.getter(r,["item"]),[])?[T.createTag("span",{class:"dv-diskClassic__encrypted icon-16 icon-Lock icon-disabled",title:""+global.rk("Документ зашифрован")},[],{},y,this)]:T.createText("")],g,y);y.def&&(f=T.chain(f,y,a),y=void 0)}catch(e){c.templateError("resources/Docview/List/resources/diskClassic/columns/Title.tmpl",e,r)}return f||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Title"}},r});
//# sourceMappingURL=Title.tmpl.map
define("tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Size",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,s,n,l,o){function c(){}var a=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};o&&o.isSetts&&(d=o.fullContext||{});var p="string"==typeof n?n:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),h=this&&this.includedTemplates?this.includedTemplates:{},S=u.getMarkupGenerator(l);try{var g=S.joinElements([S.createTag("span",{},[S.createText(" "+u.wrapUndef(u.utils.escape(u.getter(i,["item","get"]).apply(u.getter(i,["item"]),["prettySizeOrDash"])))+" ")],s,v,this)],p,v);v.def&&(g=S.chain(g,v,s),v=void 0)}catch(e){u.templateError("resources/Docview/List/resources/diskClassic/columns/Size.tmpl",e,i)}return g||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Size"}},i});
//# sourceMappingURL=Size.tmpl.map
define("tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Responsible",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,s,o,l,n){function a(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var p="string"==typeof o?o:"",v=void 0===r?void 0:r,m={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),y=this&&this.includedTemplates?this.includedTemplates:{},g=u.getMarkupGenerator(l);try{var h=g.joinElements([g.createText(""+u.wrapUndef(u.Sanitize.apply(void 0,[u.getDecorators().sanitize.apply(void 0,[u.getter(i,["item","getResponsibleHtml"]).apply(u.getter(i,["item"]),[])])])))],p,m);m.def&&(h=g.chain(h,m,s),m=void 0)}catch(e){u.templateError("resources/Docview/List/resources/diskClassic/columns/Responsible.tmpl",e,i)}return h||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Responsible"}},i});
//# sourceMappingURL=Responsible.tmpl.map
define("tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Link",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},r=function e(r,l,s,n,o){function a(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};o&&o.isSetts&&(u=o.fullContext||{});var g="string"==typeof s?s:"",p=void 0===i?void 0:i,m={id:[],def:void 0},v=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),k=this&&this.includedTemplates?this.includedTemplates:{},f=d.getMarkupGenerator(n);try{var y=f.joinElements([d.getter(r,["item","get"]).apply(d.getter(r,["item"]),["Flags"])&&d.getter(d.getter(r,["item","get"]).apply(d.getter(r,["item"]),["Flags"]),["get"]).apply(d.getter(r,["item","get"]).apply(d.getter(r,["item"]),["Flags"]),["IsLink"])?[d.getter(r,["item","get"]).apply(d.getter(r,["item"]),["Раздел@"])?[f.createTag("i",{class:"icon-16 icon-Linked icon-disabled",title:global.rk("Ссылка на папку")+"&#010;"+global.rk("Эта папка не занимает места на вашем диске")},[],{},m,this)]:[f.createTag("i",{class:"icon-16 icon-Linked icon-disabled",title:global.rk("Ссылка на файл")+"&#010;"+global.rk("Этот файл не занимает места на вашем диске")},[],{},m,this)]]:f.createText("")],g,m);m.def&&(y=f.chain(y,m,l),m=void 0)}catch(e){d.templateError("resources/Docview/List/resources/diskClassic/columns/Link.tmpl",e,r)}return y||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Link"}},r});
//# sourceMappingURL=Link.tmpl.map
define("tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Folder",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,s,l,a,n){function o(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};n&&n.isSetts&&(u=n.fullContext||{});var p="string"==typeof l?l:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),g=this&&this.includedTemplates?this.includedTemplates:{},y=d.getMarkupGenerator(a);try{var h=y.joinElements([d.getter(i,["item","getParentNameDeleted"]).apply(d.getter(i,["item"]),[])?[y.createTag("span",{title:""+d.wrapUndef(d.utils.escape(d.getter(i,["item","getParentNameDeleted"]).apply(d.getter(i,["item"]),[])))},[y.createText(" "+d.wrapUndef(d.utils.escape(d.getter(i,["item","getParentNameDeleted"]).apply(d.getter(i,["item"]),[])))+" ")],{},v,this)]:y.createText("")],p,v);v.def&&(h=y.chain(h,v,s),v=void 0)}catch(e){d.templateError("resources/Docview/List/resources/diskClassic/columns/Folder.tmpl",e,i)}return h||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Folder"}},i});
//# sourceMappingURL=Folder.tmpl.map
define("tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Flags",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,s,l,a,o){function n(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};o&&o.isSetts&&(d=o.fullContext||{});var g="string"==typeof l?l:"",p=void 0===r?void 0:r,m={id:[],def:void 0},v=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},y=u.getMarkupGenerator(a);try{var h=y.joinElements([u.getter(i,["item","get"]).apply(u.getter(i,["item"]),["Flags"])&&u.getter(u.getter(i,["item","get"]).apply(u.getter(i,["item"]),["Flags"]),["get"]).apply(u.getter(i,["item","get"]).apply(u.getter(i,["item"]),["Flags"]),["Shared"])?[y.createTag("i",{class:"icon-16 icon-Groups icon-disabled",title:""+global.rk("В публичном доступе")},[],{},m,this)]:y.createText("")],g,m);m.def&&(h=y.chain(h,m,s),m=void 0)}catch(e){u.templateError("resources/Docview/List/resources/diskClassic/columns/Flags.tmpl",e,i)}return h||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Flags"}},i});
//# sourceMappingURL=Flags.tmpl.map
define("tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/DaysLeft",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},s=function e(s,i,a,l,n){function o(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var p="string"==typeof a?a:"",m=void 0===r?void 0:r,f={id:[],def:void 0},g=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),v=this&&this.includedTemplates?this.includedTemplates:{},y=u.getMarkupGenerator(l);try{var D=y.joinElements([u.getter(s,["item","get"]).apply(u.getter(s,["item"]),["DatePermanentlyDelete"])?[y.createTag("span",{title:""+u.wrapUndef(u.utils.escape(u.getter(u.getter(s,["item","getDaysLeft"]).apply(u.getter(s,["item"]),[]),["title"])))},[y.createText(" "+u.wrapUndef(u.utils.escape(u.getter(u.getter(s,["item","getDaysLeft"]).apply(u.getter(s,["item"]),[]),["visual"])))+" ")],{},f,this)]:y.createText("")],p,f);f.def&&(D=y.chain(D,f,i),f=void 0)}catch(e){u.templateError("resources/Docview/List/resources/diskClassic/columns/DaysLeft.tmpl",e,s)}return D||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/DaysLeft"}},s});
//# sourceMappingURL=DaysLeft.tmpl.map
define("tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Date",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,s,a,l,o){function n(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};o&&o.isSetts&&(d=o.fullContext||{});var p="string"==typeof a?a:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),g=this&&this.includedTemplates?this.includedTemplates:{},D=u.getMarkupGenerator(l);try{var h=D.joinElements([D.createTag("span",{title:""+u.wrapUndef(u.utils.escape(u.getter(u.getter(i,["item","getDateForDisk"]).apply(u.getter(i,["item"]),[]),["tooltip"])))},[D.createText(" "+u.wrapUndef(u.utils.escape(u.getter(u.getter(i,["item","getDateForDisk"]).apply(u.getter(i,["item"]),[]),["date"])))+" ")],s,v,this)],p,v);v.def&&(h=D.chain(h,v,s),v=void 0)}catch(e){u.templateError("resources/Docview/List/resources/diskClassic/columns/Date.tmpl",e,i)}return h||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Date"}},i});
//# sourceMappingURL=Date.tmpl.map
define("js!SBIS3.DOCVIEW.List.DiskClassicColumns",["Core/core-clone","Core/detection","tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Title","tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Responsible","tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Folder","tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/DaysLeft","tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Date","tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Link","tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Size","tmpl!SBIS3.DOCVIEW.List/resources/diskClassic/columns/Flags"],function(s,l,e,i,t,c,a,o,r,d){"use strict";var n={title:{cellTemplate:e,className:"dv-diskClassic__title controls-DataGridView-cell-overflow-ellipsis"},responsible:{cellTemplate:i,width:l.isMobilePlatform?100:125,className:"dv-diskClassic__responsible controls-DataGridView-cell-overflow-ellipsis"},folder:{cellTemplate:t,width:120,className:"dv-diskTrash__folder controls-DataGridView-cell-overflow-ellipsis"},daysLeft:{cellTemplate:c,width:64,className:"dv-diskTrash__days controls-DataGridView-cell-overflow-ellipsis"},date:{cellTemplate:a,width:98,className:"dv-diskClassic__changed"},link:{cellTemplate:o,width:28,className:"dv-diskClassic__link"},size:{cellTemplate:r,width:64,className:"dv-diskClassic__size controls-DataGridView-cell-overflow-ellipsis"},flags:{cellTemplate:d,width:28,className:"dv-diskClassic__flags"}},m=["title","responsible","folder","daysLeft","link","flags","size"].concat(l.isMobilePlatform?[]:"date");function u(l){return l=l||m,l.map(function(l){return s(n[l])})}function C(s){return s=s||[],u(m.filter(function(l){return s.indexOf(l)<0}))}return{getColumns:u,getColumnsExcept:C}});
//# sourceMappingURL=DiskClassicColumns.module.js.map
define("js!SBIS3.DOCVIEW.HistoryMonitor",["Core/Abstract","Core/helpers/string-helpers-min","Core/HashManager"],function(t,e,n){"use strict";var a=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i;function i(t){return a.test(t)}function o(){return"undefined"!==typeof window&&window.location.href||""}var s=o();return t.extend({$protected:{_options:{list:void 0},_needToSaveState:false,_doNotHandleHashManagerChange:false,_brokenHash:{}},$constructor:function(){var t=this,e=this._options.list;this.subscribeTo(n,"onChange",this._onHashManagerChange.bind(this)),this.subscribeTo(e,"onInit",function n(){t.subscribeTo(e.getTreeView(),"onDataLoad",t._onDataLoad.bind(t))})},_onDataLoad:function(t){var e=t.getTarget(),a=e.getFilter()[e.getParentProperty()]||null,i=this._getStateKey();if(a!==n.get(i))this._doNotHandleHashManagerChange=true,n.set(i,a)},_onHashManagerChange:function(){if(this._doNotHandleHashManagerChange)this._doNotHandleHashManagerChange=false;else if(!this._isStateValueChanged())this._brokenHash[location.hash]=true;else if(!this._brokenHash[location.hash]){var t=n.get(this._getStateKey()),e=this._options.list,a=e.getTreeView(),r=a.getCurrentRoot(),h=/_ZIP$/i.test(t),l;if("null"===t)t=null;if(void 0!==t&&t!==r){var g=a.getFilter();if(t&&!i(t)&&!h&&g&&g.catalogId!==t&&!e.isArchive())g.catalogId=t,a.setFilter(g);if(h){if(l=a.getItems().getRecordById(t.replace(/_ZIP$/i,"")),l)e._openItem(l)}else a.setCurrentRoot(t),a.reload()}}s=o()},_getStateKey:function(){return this._options.list._options.listOptions.stateKey||"root_"+e.transliterate(this._options.list.getName())},_getStateValue:function(t,e){return(t.split((e||this._getStateKey())+"=")[1]||"").split("&")[0]},_isStateValueChanged:function(){if("undefined"!==typeof window&&window.event&&"hashchange"===window.event.type){var t=this._getStateKey(),e=window.event.oldURL||s,n=window.event.newURL||o();return this._getStateValue(e,t)!==this._getStateValue(n,t)}return false}})});
//# sourceMappingURL=HistoryMixin.module.js.map
define("tmpl!SBIS3.DOCVIEW.Preview",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,s,a,c,d){function l(){}var n=0,o=void 0!==t&&t?t:arguments[arguments.length-1];void 0===o&&(eval("var thelpers = null;"),o=global.requirejs("View/Runner/tclosure"));var g={};d&&d.isSetts&&(g=d.fullContext||{});var v="string"==typeof a?a:"",p=void 0===r?void 0:r,u={id:[],def:void 0},h=o.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},w=o.getMarkupGenerator(c);try{var m=w.joinElements([w.createTag("div",{class:"dv-bigpreview-vis",style:""+o.wrapUndef(o.utils.escape(o.getter(i,["cssWidth"])||o.getter(i,["width"])?"width: "+(o.getter(i,["cssWidth"])||o.getter(i,["width"]))+(+(o.getter(i,["cssWidth"])||o.getter(i,["width"]))?"px":"")+";":""))+o.wrapUndef(o.utils.escape(o.getter(i,["cssHeight"])||o.getter(i,["height"])?"height: "+(o.getter(i,["cssHeight"])||o.getter(i,["height"]))+(+(o.getter(i,["cssHeight"])||o.getter(i,["height"]))?"px":"")+";":""))},[w.createTag("div",{class:"div-PreviewDiv_forImg",title:""+o.wrapUndef(o.utils.escape(o.getter(i,["fileName"])))},[w.createTag("img",{class:"ws-no-select "+o.wrapUndef(o.utils.escape(o.getter(i,["centerVertically"])?"dv-preview_center":"")),src:""+o.wrapUndef(o.utils.escape(o.getter(i,["url"]))),"data-attachid":""+o.wrapUndef(o.utils.escape(o.getter(i,["attachId"]))),"data-redactionid":""+o.wrapUndef(o.utils.escape(o.getter(i,["redactionId"])+"")),unselectable:"on"},[],{},u,this),w.createTag("div",{class:"div-PreviewCanvas_fixva"},[],{},u,this)],{},u,this)],s,u,this)],v,u);u.def&&(m=w.chain(m,u,s),u=void 0)}catch(e){o.templateError("resources/Docview/Preview/Preview.tmpl",e,i)}return m||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.Preview"}},i});
//# sourceMappingURL=Preview.tmpl.map
define("SBIS3.CONTROLS/Button/IconButton",["js!WSControls/Buttons/Button","css!SBIS3.CONTROLS/Button/IconButton/IconButton"],function(o){"use strict";var n=o.extend([],{$protected:{_options:{}},setIcon:function(o){if(o)if(o.indexOf("icon-error")>=0||o.indexOf("icon-done")>=0)if(o.indexOf("icon-error")>=0)this.getContainer().removeClass("controls-IconButton__doneBorder").addClass("controls-IconButton__errorBorder");else this.getContainer().addClass("controls-IconButton__doneBorder").removeClass("controls-IconButton__errorBorder");else this.getContainer().removeClass("controls-IconButton__doneBorder").removeClass("controls-IconButton__errorBorder");else this.getContainer().removeClass("controls-IconButton__doneBorder").removeClass("controls-IconButton__errorBorder");n.superclass.setIcon.call(this,o)},_modifyOptions:function(){var o=n.superclass._modifyOptions.apply(this,arguments),r=o._iconClass;if(o.className+=" controls-IconButton",r)if(r.indexOf("icon-error")>=0||r.indexOf("icon-done")>=0)if(r.indexOf("icon-error")>=0)o.className+=" controls-IconButton__errorBorder";else o.className+=" controls-IconButton__doneBorder";return o},$constructor:function(){var o=this._container.get(0).className;if(o&&o.indexOf("controls-IconButton__round-border")>=0)this._container.removeClass("action-hover")}});return n});
//# sourceMappingURL=IconButton.js.map
define("tmpl!SBIS3.DOCVIEW.signs",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Button/IconButton"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={};n["js!SBIS3.CONTROLS/Button/IconButton"]=e[1];var r=function e(r,o,i,a,s){function l(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var g="string"==typeof i?i:"",p=void 0===n?void 0:n,m={id:[],def:void 0},S=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),v=this&&this.includedTemplates?this.includedTemplates:{},w=u.getMarkupGenerator(a);try{var f=w.joinElements([w.createTag("div",{class:"docview-Signature docview-Signature_icons-"+u.wrapUndef(u.utils.escape(2===u.getter(r,["signs"])?"own":0===u.getter(r,["signs"])||1===u.getter(r,["signs"])?"other":"both"))+" "+u.wrapUndef(u.utils.escape(u.getter(r,["count"])>99?"docview-Signature_more-99":"")),"data-count":""+u.wrapUndef(u.utils.escape(u.getter(r,["displayCount"])?u.getter(r,["displayCount"]):""))},[2===u.getter(r,["signs"])||3===u.getter(r,["signs"])?[w.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{name:"ownSignature",allowChangeEnable:!1,enabled:!0,icon:"sprite:icon-16 icon-Signature icon-primary",tooltip:global.rk("Моя подпись"),tabindex:1},{class:"docview-Signature__own",name:"ownSignature",sbisname:"ownSignature"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},i,p,v,u.config,d)]:w.createText(""),0===u.getter(r,["signs"])||1===u.getter(r,["signs"])||3===u.getter(r,["signs"])?[w.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{name:"mainBtn",allowChangeEnable:!1,enabled:!0,icon:"sprite:icon-16 icon-Signature icon-"+(u.getter(r,["disabled"])?"disabled":"hover"),tooltip:u.getter(r,["disabled"])?global.rk.apply(r,["Подписи под предыдущими редакциями документа"]):global.rk.apply(r,["Подписи документа"]),tabindex:2},{class:"docview-Signature__other",name:"mainBtn",sbisname:"mainBtn"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},i,p,v,u.config,d)]:w.createText(""),4===u.getter(r,["signs"])?[w.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{name:"mainBtn",allowChangeEnable:!1,enabled:!0,icon:"sprite:icon-16 icon-SignatureNone icon-error",tooltip:global.rk.apply(r,["Данные файла не соответствуют подписи"]),tabindex:2},{class:"docview-Signature__other",name:"mainBtn",sbisname:"mainBtn"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},i,p,v,u.config,d)]:w.createText("")],o,m,this)],g,m);m.def&&(f=w.chain(f,m,o),m=void 0)}catch(e){u.templateError("resources/Docview/Commands/signs/signs.tmpl",e,r)}return f||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.signs"}},r});
//# sourceMappingURL=signs.tmpl.map
define("tmpl!SBIS3.DOCVIEW.DocviewModel/resources/SignsComponent",["Core/tmpl/js/tclosure","js!SBIS3.DOCVIEW.signs"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.DOCVIEW.signs"]=e[1];var o=function e(o,n,i,s,l){function c(){}var a=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var p="string"==typeof i?i:"",v=void 0===r?void 0:r,g={id:[],def:void 0},m=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},S=d.getMarkupGenerator(s);try{var C=S.joinElements([S.createControl("wsControl","ws:SBIS3.DOCVIEW.signs",{attachId:d.getter(o,["attachId"]),count:d.getter(o,["count"]),signs:d.getter(o,["signs"]),disabled:d.getter(o,["disabled"])},d.plainMerge(n,{}),{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},i,v,f,d.config,u)],p,g);g.def&&(C=S.chain(C,g,n),g=void 0)}catch(e){d.templateError("resources/Docview/DocviewModel/resources/SignsComponent.tmpl",e,o)}return C||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.DocviewModel/resources/SignsComponent"}},o});
//# sourceMappingURL=SignsComponent.tmpl.map
define("js!SBIS3.DOCVIEW.DocviewModel",["Core/helpers/String/escapeHtml","Core/helpers/random-helpers","WS.Data/Entity/Model","WS.Data/Di","WS.Data/Chain","Core/detection","js!SBIS3.DOCVIEW.Funcs","tmpl!SBIS3.DOCVIEW.Preview","tmpl!SBIS3.DOCVIEW.DocviewModel/resources/SignsComponent","js!SBIS3.DOCVIEW.signs"],function(e,t,i,s,n,r,o,h,a){"use strict";var l=["jpg","jpeg","png","gif","bmp","psd","webp","rgb","rgba"],g=["zip","rar","7z"],c=[].concat(l,"tif","tiff"),d=["mp3","wav","ogg","wma"].concat(g),u=i.extend({_moduleName:"SBIS3.DOCVIEW.DocviewModel",$protected:{_linkedControl:null,_options:{serviceUrl:"",objectName:"",previewWidth:"",previewHeight:"",calcMargin:"",_isAuth:""}},_$properties:{prettySize:{get:function(){var e=this.get("size")||this.get("Size");return this.getPrettySize(e)}},prettySizeOrDash:{get:function(){return this.get("prettySize")||"—"}}},$constructor:function(e){if(e=e||{},e.linkedControl)this._linkedControl=s.resolve(e.linkedControl);if(this.isRequired()&&!this.get("attachId"))this.set("attachId",t.createGUID())},getFileExtension:function e(){return o.getFileExtension(this.get("fileName"))},getPreviewUrl:function(e){var t={sync:"undefined"!==typeof(e=e||{}).sync?e.sync:false===this._options._isAuth,fileName:this.get("fileName"),serviceUrl:this.get("serviceUrl")||this._options.serviceUrl,objectName:this.get("objectName")||this._options.objectName,attachId:this.get("attachId"),redactionId:this.get("redactionId"),hash:this.get("fileHash")||this.get("hash"),width:e.width||this._options.previewWidth,height:e.height||this._options.previewHeight,previewId:this._options.previewId||0,absoluteServiceUrl:this.get("absoluteServiceUrl")};if("URL"===this.get("objectName"))t.sync=true,t.attachId=this.get("path"),t.redactionId=this.get("path"),t.hash="",t.absoluteServiceUrl="1",t.Transp=false,t.Icon=false;return o.createPreviewUrl(t)},isEncrypted:function(){return(this.get("linkedRecord")||this).get("encrypted")>=2},isFolder:function(){return Boolean(this.get("folder@")||this.get("Раздел@"))},isImage:function(){return!this.isFolder()&&o._isFileWithExtensions(this.get("fileName"),l)},hasSmallPreview:function(){return!this.isFolder()&&o._isFileWithExtensions(this.get("fileName"),c)},hasPreview:function(){return!this.isFolder()&&!this.isRequired()&&!this.isEncrypted()&&!this.get("Deleted")&&(!o._isFileWithExtensions(this.get("fileName"),d)||!!this.get("versionForm"))},isUnknown:function(){return!this.isRequired()&&!this.get("versionForm")&&o.getFileOpt(this.get("fileName")).isUnknown},isRequired:function(){return Boolean(this.get("required"))&&!this.get("redactionId")},isLoadedRequired:function(){return Boolean(this.get("required")&&this.get("redactionId"))},isLink:function(){return"url"===o.getFileExtension(this.get("fileName"))},getPreviewWidth:function(){return Number(this._options.previewWidth||0)},getPreviewHeight:function(){return Number(this._options.previewHeight||0)},getPreviewDiv:function(e){var t=(e=e||{}).width||this._options.previewWidth,i=e.height||this._options.previewHeight,s,n,o;if(!this.hasPreview())return this.getIcon(e.className||"",{fontSize:48,width:t,height:i});if(s=this._options.calcMargin&&e.coef||1,this.get("previewUrl"))n="data:image/png;base64,"+this.get("previewUrl");else n=this.getPreviewUrl({width:Math.round(t*s),height:Math.round(i*s)});if(this._linkedControl&&r.firefox)n+="#"+this._linkedControl.getId();return o={cssWidth:t,cssHeight:i,width:Math.round(t*s),height:Math.round(i*s),attachId:this.get("attachId"),redactionId:this.get("redactionId"),url:n,centerVertically:this.isImage(),fileName:this.get("fileName")},h(o)},getIcon:function(e,t){var i,s=t&&t.height&&t.width,n;if(s&&this.isEncrypted())i={ico_font:"",color:"#CCC !important"},n=rk("Документ зашифрован");else if(this.get("versionForm")&&this.get("countError"))i={className:"ws-listView-flkErrors",color:"#FEC63F !important",ico_font:""};else if(3===this.get("Type")&&void 0===this.get("versionForm"))i=o.getFileOpt(this.get("fileName")+".xml");else if(!this.get("folder@")){var r=this.get("fileName");if((r?r.split("."):[]).length<2)r=this.get("title");if(i=o.getFileOpt(r),i.isUnknown&&this.get("versionForm"))i=o.getFileOpt(r+".xml");i.className=""}else i={className:"ws-listView-folder",color:"#CCC !important",ico_font:""};var h="",a=i.ico_font;if(s)h=" height: "+t.height+"px; width: "+t.width+"px;",a='<div style="display: inline-block; height: 100%; vertical-align: middle;"></div>'+'<span style="font-size: '+(t.fontSize||t.height)+"px; line-height: "+t.height+'px; display: inline-block; vertical-align: middle;">'+a+"</span>";return'<div class="dv-icon icon-24 dv-'+(e||"classic")+"-icon "+(i.className||"")+'" '+(n?'title="'+n+'"':"")+' style="color:'+i.color+";"+h+'">'+a+"</div>"},getTitle:function(){var t=this.get("title"),i=this.get("fileName"),s=!t||t===i,n=o.parseFileName(i),r=e(s?n.name:t);if("url"===n.extension)return'<span class="dv-title-text_link" title="'+r+'">'+r+"</span>";return r+(n.extension&&s?'<span class="dv-classic__extension">.'+n.extension+"</span>":"")},hasIconForBigPreview:function(){var e=this.getFileExtension();return e&&!this.isUnknown()&&-1===c.indexOf(e)&&-1===g.indexOf(e)},getTitleForDisk:function(){var t=this.get("fileName"),i="",s="",n=this.isLink();if(this.get("folder@")||this.get("versionForm")||3===this.get("Type")||this.get("required"))s=t=e(this.get("title")||t);else{var r=o.parseFileName(e(this.get("title")||t));t=r.name,i=r.extension&&!n?"."+r.extension:"",s=n?r.name:r.fullName}return{fileName:o.escapeSpaces(t),ext:i,tooltip:s,isLink:n}},getSizeHtml:function(){return this.get("prettySizeOrDash")},hasSigns:function(){return Boolean(this.get("signs")||this.get("idPreviousRedactionSign")||this.get("hasPreviousRedactionSign"))},getSigns:function(){var e=this.get("CountSigns")||this.get("countSigns"),t={attachId:this.get("attachId"),count:e>0?e:"",signs:this.get("signs")};if(this.get("signs"))return a(t);else if(this.get("idPreviousRedactionSign")||this.get("hasPreviousRedactionSign"))return t.disabled=true,a(t);else return""},getDate:function(e){var t=this.get(e||"lastChange");return t="string"===typeof t?new Date(t):t,{date:t?t.strftime("%d %b").toLowerCase():"",time:t?t.getFullYear()!==(new Date).getFullYear()?" "+t.getFullYear():t.strftime("%H:%M"):""}},getObjectName:function(){return this.get("objectName")||this._options.objectName},getServiceUrl:function(){return this.get("serviceUrl")||this._options.serviceUrl},setMultiple:function(e,t){var i=this,s=this.getOwner()||this,r;(t||[]).filter(function(t){return void 0!==e[t.name]&&s.getFormat().getFieldIndex(t.name)<0},this).forEach(function(e){s.addField(e,void 0)}),r=n(e).filter(function(e,t){return void 0!==e&&i.has(t)}).toObject(),this.set(r)},updateFlags:function(e){var t=this.get("Flags"),i=e.get("Flags");if(i&&t&&void 0!==t.set)if(t.set("IsLink",i.get("IsLink")),"undefined"!==typeof i.get("Shared"))t.set("Shared",i.get("Shared"))},getPrettySize:function(e){return e&&!this.isLink()?o.getPrettyFileSize(e):""}});return u.createPreviewUrl=o.createPreviewUrl,u});
//# sourceMappingURL=DocviewModel.module.js.map
define("tmpl!SBIS3.DOCVIEW.DocviewModel/resources/Responsible",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,n,o,s){function l(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};s&&s.isSetts&&(u=s.fullContext||{});var p="string"==typeof n?n:"",f=void 0===r?void 0:r,v={id:[],def:void 0},m=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),g=this&&this.includedTemplates?this.includedTemplates:{},h=d.getMarkupGenerator(o);try{var w=h.joinElements([h.createTag("span",{"data-minicard-oid":""+d.wrapUndef(d.utils.escape(d.getter(i,["id"]))),"data-minicard-template":"js!SBIS3.PersonalOffice.MiniCard",class:"dv-responsible",title:""+d.wrapUndef(d.utils.escape(d.getter(i,["description"]))),"data-minicard-mode":"click","data-minicard-offsetx":"-120"},[h.createText(" "+d.wrapUndef(d.utils.escape(d.getter(i,["name"])))+" ")],a,v,this)],p,v);v.def&&(w=h.chain(w,v,a),v=void 0)}catch(e){d.templateError("resources/Docview/DocviewModel/resources/Responsible.tmpl",e,i)}return w||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.DocviewModel/resources/Responsible"}},i});
//# sourceMappingURL=Responsible.tmpl.map
define("SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragObject",["Core/Abstract","Core/WindowManager","Core/core-instance","Core/constants"],function(t,e,n,i){"use strict";var r=5;return new(t.extend({$protected:{_owner:void 0,_source:void 0,_target:void 0,_avatar:void 0,_dragging:void 0,_meta:void 0,_jsEvent:void 0,_targetsControl:void 0},getSource:function(){return this._source},setSource:function(t){this._source=t},getTarget:function(){return this._target},setTarget:function(t){this._target=t},getOwner:function(){return this._owner},reset:function(){this._source=void 0,this._target=void 0,this._owner=void 0,this._meta=void 0,this._jsEvent=void 0,this._targetsControl=void 0,this._dragging=false,this.setAvatar(null)},getAvatar:function(){return this._avatar},getMeta:function(){return this._meta},setMeta:function(t){this._meta=t},setAvatar:function(t){if(this.removeAvatar(),t)this._avatar=$(t),this._setAvatarPosition(this._jsEvent),this._avatar.css({"z-index":e.acquireZIndex(false),position:"absolute"}).appendTo($("body"))},removeAvatar:function(){if(this._avatar)this._avatar.remove(),this._avatar=null},isDragging:function(){return this._dragging},getEvent:function(){return this._jsEvent},getTargetsControl:function(){return this._targetsControl},getTargetsDomElement:function(){if(this._jsEvent){var t=this.getAvatar(),e=this._jsEvent.type in{touchmove:true,touchend:true};if("function"==typeof document.elementsFromPoint&&(this._isAncillaryElem(this._jsEvent.target)||e||i.browser.firefox)){for(var n=document.elementsFromPoint(this._jsEvent.pageX,this._jsEvent.pageY),r=0,s=n.length;r<s;r++)if(!t||!this._isAncillaryElem(n[r]))return $(n[r])}else if("function"==typeof document.elementFromPoint&&e)return $(document.elementFromPoint(this._jsEvent.pageX,this._jsEvent.pageY));return $(this._jsEvent.target)}},getTargetsDomElemet:function(){return this.getTargetsDomElement()},_isAncillaryElem:function(t){var e=this.getAvatar();return $(t).hasClass("controls-DragNDropMixin-overlay")||e&&(e.find(t).length>0||e[0]==t)},setDragging:function(t){this._dragging=!!t},_setAvatarPosition:function(t){if(this.getAvatar())this.getAvatar().css({left:t.pageX+r,top:t.pageY+r})},setOwner:function(t){this._owner=t},_getTargetsControl:function(){var t=$(this.getTargetsDomElement()).wsControl(),e=function(t){if(t){if(n.instanceOfMixin(t,"SBIS3.CONTROLS/Mixins/DragNDropMixin")&&t.getItemsDragNDrop())return t;return e(t.getParent())}};return e(t)},onDragHandler:function(t){if(this.isDragging()&&this._jsEvent!==t)this._jsEvent=t,this._targetsControl=this._getTargetsControl(),this._setAvatarPosition(t)}}))});
//# sourceMappingURL=DragObject.js.map
define("SBIS3.CONTROLS/Action/Mixin/DialogMixin",["Core/core-merge","Core/Deferred","WS.Data/Utils","Core/IoC"],function(e,o,t,i){"use strict";return{$protected:{_options:{dialogComponent:"",template:"",mode:"dialog",componentOptions:null,dialogOptions:null},_dialog:void 0,_linkedModelKey:void 0,_isExecuting:false,_executeDeferred:void 0},$constructor:function(){if(this._options.dialogComponent&&!this._options.template)t.logger.stack(this._moduleName+'::$constructor(): option "dialogComponent" is deprecated and will be removed in 3.8.0',1),this._options.template=this._options.dialogComponent;this._publish("onAfterShow","onBeforeShow")},_doExecute:function(e){if(!this._isExecuting)return this._executeDeferred=new o,this._openComponent(e),this._executeDeferred;return(new o).callback()},closeDialog:function(){if(this._dialog)this._dialog.close()},_openDialog:function(e){this._openComponent(e,"dialog")},_openFloatArea:function(e){this._openComponent(e,"floatArea")},_openComponent:function(e,o){(e=e||{}).mode=o||e.mode||this._options.mode;var t=this._getDialogConfig(e);this._createComponent(t,e)},_buildComponentConfig:function(o){var t=e({},this._options.componentOptions||{});return e(t,o.componentOptions||{})},_createComponent:function(o,t){var i="floatArea"==t.mode?"Lib/Control/FloatArea/FloatArea":"Lib/Control/Dialog/Dialog",n;if(this._isNeedToRedrawDialog())this._resetComponentOptions(),n=this._dialog._options.template!==o.template,e(this._dialog._options,o),this._dialog.reload(true,n);else this._isExecuting=true,requirejs([i],function(e){try{this._dialog=new e(o)}catch(e){this._finishExecuteDeferred(e)}}.bind(this))},_resetComponentOptions:function(){var e=this._dialog._options;e.componentOptions={isPanelMaximized:e.maximized}},_getDefaultDialogConfig:function(o){return e({isStack:true,showOnControlsReady:false,autoCloseOnHide:true,needSetDocumentTitle:false,opener:o.opener||this._getOpener(),template:o.template||this._options.template,target:void 0,block_by_task_1173286428:false},this._options.dialogOptions||{})},_getOpener:function(){var e=this.getContainer()&&this.getContainer().closest(".controls-FloatArea"),o,t,i;if(e&&e.length)return e.wsControl();else if(o=this.getTopParent(),o!==this)t=(i=o.getContainer().closest(".ws-float-area")).length?i[0].wsControl:false;return t||this},_getDialogConfig:function(o){var t=this._getDefaultDialogConfig(o),i=this;e(t,o.dialogOptions),t.componentOptions=this._buildComponentConfig(o),t.handlers=t.handlers||{};var n={onAfterClose:function(e,t){i._isExecuting=false,i._finishExecuteDeferred(),i._notifyOnExecuted(o,t),i._dialog=void 0},onBeforeShow:function(){i._notify("onBeforeShow",this)},onAfterShow:function(){i._isExecuting=false,i._notify("onAfterShow",this)}};for(var s in n)if(n.hasOwnProperty(s))if(t.handlers.hasOwnProperty(s)&&t.handlers[s]instanceof Array)t.handlers[s].push(n[s]);else if(t.handlers.hasOwnProperty(s))t.handlers[s]=[t.handlers[s],n[s]];else t.handlers[s]=n[s];return t},_finishExecuteDeferred:function(e){if(this._executeDeferred&&!this._executeDeferred.isReady())if(!e)this._executeDeferred.callback(false);else this._executeDeferred.errback(e)},setMode:function(e){this._options.mode=e},getMode:function(){return this._options.mode},setDialogComponent:function(e){t.logger.stack(this._moduleName+'::$constructor(): option "dialogComponent" is deprecated and will be removed in 3.8.0',1),this._options.template=e},_isNeedToRedrawDialog:function(){return this._dialog&&!this._dialog.isDestroyed()&&this._dialog.isAutoHide&&!this._dialog.isAutoHide()},_opendEditComponent:function(e,o,t){i.resolve("ILogger").error("SBIS3.CONTROLS.OpenEditDialog","Используйте публичный метод execute для работы с action'ом открытия диалога редактирования"),e.template=o,this._openComponent.call(this,e,t)},after:{destroy:function(){if(this._dialog)this._dialog.destroy(),this._dialog=void 0}}}});
//# sourceMappingURL=DialogMixin.js.map
define("SBIS3.CONTROLS/Action",["Core/Deferred","Lib/Control/Control"],function(t,n){"use strict";var e=n.Control.extend({$protected:{_canExecute:true},$constructor:function(){this._publish("onChangeCanExecute","onExecuted","onExecute","onError")},execute:function(t){var n=this;if(this.isCanExecute())return this._callHandlerMethod([t],"onExecute","_doExecute").addCallbacks(function(e){if(false!==e)return n._notifyOnExecuted(t,e)},function(e){return n._notify("onError",e,t),n._handleError(e,t),e})},setCanExecute:function(t){if(t=!!t,this._canExecute!==t)this._canExecute=t,this._notify("onChangeCanExecute",t)},_callHandlerMethod:function(n,c,o){var i=this._notify.apply(this,[c].concat(n)),r="function"===typeof this[i]?this[i]:this[o];if(false!==i&&i!==e.ACTION_CUSTOM){var u=this;return(i instanceof t?i:(new t).callback(true)).addCallback(function(t){if(false!==t&&t!==e.ACTION_CUSTOM)if(r="function"===typeof u[t]?u[t]:r,"function"===typeof r)return r.apply(u,n)})}return(new t).callback(i)},isCanExecute:function(){return this._canExecute},_doExecute:function(){},_handleError:function(t,n){},canAcceptFocus:function(){return false},_notifyOnExecuted:function(){var t=Array.prototype.slice.call(arguments);t.unshift("onExecuted"),this._notify.apply(this,t)}});return e.ACTION_CUSTOM="custom",e});
//# sourceMappingURL=Action.js.map
define("SBIS3.CONTROLS/Action/OpenDialog",["SBIS3.CONTROLS/Action","SBIS3.CONTROLS/Action/Mixin/DialogMixin","WS.Data/Entity/Model","WS.Data/Utils"],function(t,i){"use strict";var e=t.extend([i],{execute:function(t){return e.superclass.execute.call(this,t)},getDialog:function(){return this._dialog}});return e});
//# sourceMappingURL=OpenDialog.js.map
define("Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager",["Core/constants","Core/deprecated","Core/detection","Core/EventBus","css!Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager"],function(e,t,i,a){"use strict";var r=[],n=[],s=!(e.browser.isIE7||e.browser.isIE8||e.browser.isIE9),l=[],c=function e(t){var i=0;if(t&&"0px"!==t)if(i=parseInt(t.replace("px",""),10),isNaN(i))i=0;return i},o=function e(t){var i=t.css("padding");if(""!==i)return"0px"===i?"":i;var a={top:c(t.css("padding-top")),bottom:c(t.css("padding-bottom")),left:c(t.css("padding-left")),right:c(t.css("padding-right"))};if(a.top||a.bottom||a.left||a.right)return(a.top?a.top+"px":0)+" "+(a.right?a.right+"px":0)+" "+(a.bottom?a.bottom+"px":0)+" "+(a.left?a.left+"px":0);return""},d=function(e,t){e.parent(".ws-sticky-header__wrapper").toggleClass("ws-sticky-header__wrapper-scrolled",e.scrollTop()>0)},f=function e(){var t=$(this);d(t),m.checkAllSticky(t)},h=function t(i){var a=e.browser.isIE8,r=a?i.wheelDelta||i.originalEvent.wheelDelta:i.deltaY||i.originalEvent.deltaY,n=$(this).parent(".ws-sticky-header__wrapper").children(".ws-sticky-header__scrollable-container");if(a)r=r<0?80:-80;n[0].scrollTop+=r},_=function(e){return e.isTableHeader?e.elemCopy:e.jqElem},y=function(e){return e.isTableHeader?e.jqElem:e.elemCopy},k=function(e){return e.stuck?y(e.fixedStackElem):e.jqElem},u=function(e){if(e instanceof jQuery)e=e[0];for(var t=0,i=r.length;t<i;t++)if(_(r[t])[0]===e)return r[t]},b=function(){if(!g)g=setTimeout(p,0)},p=function(){a.channel("stickyHeader").notify("onStickyHeadersChanged"),g=null},g,m={_subscribeWrapper:function(t){if(t.length&&-1===l.indexOf(t[0])){var i=t.children(".ws-sticky-header__scrollable-container"),a=t.children(".ws-sticky-header__header-container"),r;if(i.length&&a.length)l.push(t[0]),i.bind("scroll.stickyHeaderManager",f),a.bind(e.browser.isIE8?"mousewheel.stickyHeaderManager":"wheel.stickyHeaderManager",m.headerWheelHandler),a.bind("click.stickyHeaderManager",m._headerClickHandler);d(i)}},_unSubscribeWrapper:function(t){var i=l.indexOf(t[0]),a=t.children(".ws-sticky-header__header-container");if(-1!==i)l.splice(i,1),t.children(".ws-sticky-header__scrollable-container").unbind("scroll.stickyHeaderManager"),a.unbind(e.browser.isIE8?"mousewheel.stickyHeaderManager":"wheel.stickyHeaderManager"),a.unbind("click.stickyHeaderManager"),t.removeClass("ws-sticky-header__wrapper-scrolled")},_headerClickHandler:function(e){var t=u($(e.target).closest(".ws-sticky-header__table-header-copy"));if(t)y(t).wsControl()._onClickHandler(e)},fixAllChildren:function(e,a){m._subscribeWrapper(e.closest(".ws-sticky-header__wrapper")),e.find(".ws-sticky-header__wrapper:visible").each(function(e,t){m._subscribeWrapper($(t))});var r=[],n=a?a.filter(":visible"):e.find(".ws-sticky-header__block:visible:not(.ws-sticky-header__registered), .ws-sticky-header__table:visible:not(.ws-sticky-header__registered)");n.not(".controls-ScrollContainer .ws-sticky-header__block, .controls-ScrollContainer .ws-sticky-header__table").each(function(e,i){var a=$(i),r="Обнаружен зафиксированный заголовок вне SBIS3.CONTROLS.ScrollContainer";if("header"===a.attr("id")||a.hasClass("ws-IE8Warning"))return;["id","class"].forEach(function(e){var t=a.attr(e);if(t)r+=" "+e+': "'+t+'"'}),r+=". Если на странице есть ScrollContainer, то вам необходимо отключить фиксацию этого заголовка. "+"Если на странице нет ScrollContainer, то необходимо внедрить его, отказавшись по максимуму от фиксации. "+"В идеальном случае фиксация заголовков должна остаться только для заголовков таблиц. "+"В 3.17.350 механизм фиксации заголвков вне ScrollContainer отключен.",t.showInfoLog(r)}),n.each(function(e,t){var i=$(t);r.push({index:e,jqElem:i,top:i.offset().top,height:i.innerHeight()})}),r.sort(function(e,t){var i=e.top-t.top;return 0!==i?i:e.height>0?1:e.index-t.index});for(var s=0,l=r.length;s<l;s++)m._registerElement(r[s].jqElem);if(m.checkAllSticky(e.closest(".ws-sticky-header__scrollable-container")),m._fixGradientTop(e),i.firefox)d(e)},_registerElement:function(e){if(!m._validateStickyLayout(e))return;var t=m.__calcPositionParams(e);if(m._getStackHeight(e.closest(".ws-sticky-header__scrollable-container"))+2<t.top+t.scrollTop||t.stickyParent||t.isTableWithStickyRows)m._registerStickyElement(e,t);else m._fixElement(e);e.addClass("ws-sticky-header__registered")},_validateStickyLayout:function(e){var t=e.closest(".ws-sticky-header__scrollable-container"),i=t.parent(".ws-sticky-header__wrapper"),a=i.children(".ws-sticky-header__header-container");return t.length&&i.length&&a.length},_isTableHeader:function(e){return e.is("table")&&e.hasClass("ws-sticky-header__table")},_isTableHeaderHasScroll:function(e){return e.closest(".controls-DataGridView").hasClass("controls-DataGridView__with-partScroll")},_isTableHeaderPartScrollShown:function(e){return e.closest(".controls-DataGridView").hasClass("controls-DataGridView__PartScroll__shown")},_registerStickyElement:function(e,t){var i=m._isTableHeader(e),a=i&&m._isTableHeaderHasScroll(e),r=e.closest(".ws-sticky-header__scrollable-container"),s=-1/0,l,c,o=function(){return{jqElem:e,isTableHeader:i,isTableHeaderHasScroll:a,isTableWithStickyRows:t.isTableWithStickyRows,scrollableContainer:r,fixedStickyTableRow:$(),fixedStickyTableRowDummy:$(),stuck:false}};if(t.stickyParent&&n.length){for(var d=0;d<n.length;d++){if(c=k(n[d]),!c.closest(".ws-sticky-header__scrollable-container").length)continue;if(l=m.__calcPositionParams(c),s<t.top&&t.top<l.top)break;s=l.top}n.splice(d+1,0,o()),m.checkAllSticky(e.closest(".ws-sticky-header__scrollable-container"))}else n.push(o());e.addClass("ws-sticky-header__sticky")},_unRegisterStickyElement:function(e){e.jqElem.removeClass("ws-sticky-header__sticky ws-sticky-header__registered");var t=n.indexOf(e);n.splice(t,1)},__calcPositionParams:function(e){var t=e.closest(".ws-sticky-header__scrollable-container"),i=t.offset().top,a=e.closest(".ws-sticky-header__parent"),r={top:e.offset().top-i-Math.max(c(e.css("margin-top")),0),scrollTop:t[0].scrollTop,stickyParent:t.has(a).length?a:null,isTableWithStickyRows:e.hasClass("ws-sticky-header__table-with-sticky-rows"),scrollableTop:i,scrollableHeight:t.innerHeight()};if(r.stickyParent)r.parentBottomEdge=r.stickyParent.offset().top+r.stickyParent.innerHeight()-i;return r},checkAllSticky:function(e){var t=[],i=[],a,r;for(r=0;r<n.length;r++)if(n[r].scrollableContainer[0]==e[0])if(n[r].stuck)t.push(n[r]);else{if(a=n[r].jqElem,n[r].isTableHeader&&!n[r].isTableWithStickyRows)a=a.children("thead");if(a.is(":visible"))i.push(n[r])}for(r=t.length-1;r>=0;r--)m._checkStickyElement(t[r]);if(e.scrollTop()>=0)for(r=0;r<i.length;r++)m._checkStickyElement(i[r])},_checkStickyElement:function(e){var t;if(this._checkTableStickyRow(e),e.stuck&&e.isTableWithStickyRows)this._synchronizeTableStickyRows(e);if(e.isTableHeader){if(t=e.jqElem.find("thead:first"),!t.length)if(e.fixedStickyTableRowDummy&&e.fixedStickyTableRowDummy.length)t=e.jqElem;else return}else if(e.stuck)t=e.fixedStackElem.elemCopy;else t=e.jqElem;var a=m.__calcPositionParams(t),r=t.outerHeight(),n=m._getStackHeight(e.scrollableContainer),s=e.stuck?e.fixedStackElem.topShift||0:0;if(n-=s,e.isTableWithStickyRows)r+=e.fixedStickyTableRow.outerHeight()||0;if(e.stuck&&(n-r<=a.top&&(i.isMobileIOS?true:0!==n&&0!==a.top)||a.stickyParent&&n-r>=a.parentBottomEdge)){if(s)m._shiftElem(e.fixedStackElem,0);m._unfixTableRow(e),m._unfixElement(e.fixedStackElem),e.stuck=false,delete e.fixedStackElem}else if(!e.stuck&&(n>a.top||(i.isMobileIOS?false:0===n&&0===a.top))&&(a.stickyParent?n<a.parentBottomEdge:true)){var l=m._fixElement(e.jqElem);if(e.stuck=true,e.fixedStackElem=l,n+=r,e.isTableWithStickyRows)this._synchronizeTableStickyRows(e)}if(e.stuck&&a.stickyParent)if(n>a.parentBottomEdge&&n-r<a.parentBottomEdge)s=a.parentBottomEdge-n,m._shiftElem(e.fixedStackElem,s);else m._shiftElem(e.fixedStackElem,0)},_shiftElem:function(e,t){var i=e.isTableHeader?e.elemCopy:e.jqElem,a=e.gradientContainer;if(t=t||0,e.topShift=t,i.toggleClass("ws-sticky-header__shifted",!!t).css("margin-top",t?t+"px":""),i.prev().toggleClass("ws-sticky-header__shifted-under",!!t),a)a.css("margin-top",t?t+"px":"")},_getStackHeight:function(e){var t=e.parent(".ws-sticky-header__wrapper"),i=t.children(".ws-sticky-header__header-container").children(":not(.ws-sticky-header__gradient)").last();if(!i.length)return 0;else return i.offset().top+i.outerHeight()-t.offset().top},getStickyHeaderHeight:function(e){var t=e.closest(".ws-sticky-header__scrollable-container");if(t.length)return m._getStackHeight(t);return 0},getStickyHeaderIntersectionHeight:function(e){var t=e.closest(".ws-sticky-header__wrapper"),i;if(!e.closest(".ws-sticky-header__scrollable-container").length)return 0;return i=this.getStickyHeaderHeight(e)-e.offset().top+t.offset().top,i>=0?i:0},getStickyHeaderMaxHeight:function(e){var t=0;return e.closest(".ws-sticky-header__scrollable-container").find(".ws-sticky-header__block-copy, .ws-sticky-header__table>thead, .ws-sticky-header__block").each(function(e,i){t+=$(i).outerHeight()}),t},_fixElement:function(e){for(var t=m._isTableHeader(e),i=t&&m._isTableHeaderHasScroll(e),a=e.attr("style")||"",n=(e.attr("class")||"").split(/\s+/),l=[],d=e.offset().top,f=-1/0,h=0,_,y,k,u,p,g=0;g<n.length-1;g++)if(-1===["ws-sticky-header__block","ws-sticky-header__table","ws-sticky-header__fixed","ws-sticky-header__registered","ws-sticky-header__sticky"].indexOf(n[g]))l.push(n[g]);var w=e.closest(".ws-sticky-header__scrollable-container"),S=c(e.css("margin-left")),H=e.offset().left-w.offset().left-S,T=m._calcWidth(e,H,w,false,i),x=m._calcWidth(e,H,w,true,i),v=w.parent(".ws-sticky-header__wrapper").children(".ws-sticky-header__header-container:first"),C=t?e.find("thead:first"):e,E="border-box"===C.css("box-sizing")?C.outerHeight():C.height(),R=C.find(":focus"),j,q;if(R.length)v.focus();if(t){var W=$("<table "+(a?'style="'+a+'"':"")+(l.length?' class="'+l.join(" ")+'"':"")+"></table>"),P=e.parent().attr("class")||"";j=$('<div class="'+P+' ws-sticky-header__table-header-copy"></div>'),W.appendTo(j),m._changeTableHeaders(e,W),q=j}else{var I=o(e),A=e.css("margin"),M="height:"+E+"px;"+(I?"padding:"+I+";":"")+(A&&"0px"!==A?"margin:"+A+";":"")+a;j=$('<div style="'+M+'" class="'+l.join(" ")+' ws-sticky-header__block-copy"></div>'),e.before(j),q=e}for(e.addClass("ws-sticky-header__fixed"),h=0;h<r.length;h++){if(!r[h].scrollableContainer.is(w))continue;if(r[h].isTableHeader)y=r[h].elemCopy,k=r[h].jqElem;else y=r[h].jqElem,k=r[h].elemCopy;if(f<d&&d<k.offset().top){_=y;break}f=k.offset().top}if(_)_.before(q);else v.append(q);q.css({width:T+"px","margin-left":H+S+"px"});var D={jqElem:e,isTableHeader:t,isTableHeaderHasScroll:i,elemCopy:j,width:T,height:E,leftPosition:H,marginLeft:S,scrollableContainer:w};if(s){var z=$('<div class="ws-sticky-header__gradient"></div>');z.css({top:m._calcGradientTop(D,w)+"px",left:H+"px",width:x+"px",display:D.height?"":"none"}),v.append(z),D.gradientContainer=z}if(R&&1===R.length)if(R.focus(),R.is("input")&&"text"===R.attr("type"))p=(u=R[0]).value.length,u.setSelectionRange(p,p);return r.splice(h+1,0,D),b(),D},_changeTableHeaders:function(e,t){var i=e.find("colgroup:first");if(1===i.length)i.clone().appendTo(t);if(m._changeTableThead(e,t),1===i.length)m._synchronizeTableHeaderRows(e,t),m._updateTableHeaderColumnWidth(e,t)},_changeTableThead:function(e,t){var i=e.find("thead:first"),a;if(i.length)a=m._createDummyThead(i),t.append(i),e.find("tbody:first").before(a)},_createDummyThead:function(e){return $('<thead class="'+(e.attr("class")||"")+' ws-sticky-header__thead-copy" style="visibility:hidden"></thead>')},synchronizeTableHeaderColumnWidth:function(e){var t=m._getStackElementByJQ(e);if(t)m._updateTableHeaderColumnWidth(t.jqElem,t.elemCopy.children("table"))},_synchronizeTableHeaderRows:function(e,t){var i,a,r;(a=t.find("thead").clone()).find("[id], [data-component]").removeAttr("id data-component sbisname name config hasmarkup wasbuildmarkup hidefocus tabindex"),a.css("visibility","hidden"),a.find(">tr>th,>tr>td").css({"min-width":"","max-width":""}),e.find("thead").remove(),a.insertAfter(e.find("colgroup"))},_updateTableHeaderColumnWidth:function(e,t){var i=t.find(">thead>tr"),a,r;e.find(">thead>tr").each(function(e,t){a=i.eq(e).children("th,td"),$(t).children("th,td").each(function(e,t){r=getComputedStyle(t,null).width,a.eq(e).css({"min-width":r,"max-width":r})})})},_synchronizeTableCssClasses:function(e){var t=_(e),i=y(e);t.attr("class",i.parent().attr("class")+" ws-sticky-header__table-header-copy")},_synchronizeTableStickyRows:function(e){var t=y(e.fixedStackElem),i=_(e.fixedStackElem),a=t.find(".ws-sticky-header__table-sticky-row"),r=$(),n=$(),s,l,c,o,d;if(e.fixedStickyTableRowDummy.length&&!e.fixedStickyTableRowDummy.parent().length)this._unfixTableRow(e);if(!a.length)return;if(s=m._getStackHeight(e.scrollableContainer),e.fixedStickyTableRow.length)s-=e.fixedStickyTableRow.outerHeight();if(a.each(function(e,t){if(l=e,n=$(t),c=m.__calcPositionParams(n),s<c.top)return false;r=n}.bind(this)),e.fixedStickyTableRow[0]===r[0]||r.hasClass("ws-sticky-header__tr-copy"))return;if(this._unfixTableRow(e),r)e.fixedStickyTableRow=r,(d=r.clone().addClass("ws-sticky-header__tr-copy")).insertAfter(r),e.fixedStickyTableRowDummy=d,r.remove(),(o=$("<tbody></tbody>")).append(r),i.children("table").append(o);e.fixedStackElem.height=i.outerHeight()-(e.topShift||0),m._fixGradientTop(e.scrollableContainer)},_unfixTableRow:function(e){var t;if(e.fixedStickyTableRow.length)t=y(e.fixedStackElem).find(".ws-sticky-header__tr-copy"),_(e.fixedStackElem).find(">table>tbody").remove(),e.fixedStickyTableRow.insertAfter(t),t.remove(),e.fixedStickyTableRow=$(),e.fixedStickyTableRowDummy=$()},_checkTableStickyRow:function(e){if(e.fixedStickyTableRowDummy.length&&!jQuery.contains(document.documentElement,e.fixedStickyTableRowDummy[0]))e.fixedStickyTableRowDummy=$(),e.fixedStickyTableRow.remove(),e.fixedStickyTableRow=$()},_unfixElement:function(e){var t=r.indexOf(e);if(-1===t)throw new Error("Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager - trying to unfix unknown element.");r.splice(t,1);var i=e.jqElem,a=e.elemCopy,n=e.isTableHeader?a.find("thead:first"):i,s=n.find(":focus"),l;if(s.length)l=e.scrollableContainer.scrollTop(),n.closest(".ws-sticky-header__header-container").focus();if(e.isTableHeader)i.find("thead:first").remove(),i.find("tbody:first").before(n),n.find("th,td").css({minWidth:"",maxWidth:""});else a.before(n),n.css({height:"",width:"","margin-left":""});if(i.removeClass("ws-sticky-header__fixed"),!i.hasClass("ws-sticky-header__sticky"))i.removeClass("ws-sticky-header__registered");if(a.remove(),e.gradientContainer)e.gradientContainer.remove();if(s.length)s.focus(),e.scrollableContainer.scrollTop(l);b()},_findElementsInContainer:function(e,t){var i=".ws-sticky-header__block-copy, .ws-sticky-header__table.ws-sticky-header__fixed",a=e.find(i).addBack(i),s=[],l,c,o;for(l=0;l<a.length;l++)for(c=0;c<r.length;c++)if(o=r[c].isTableHeader?r[c].jqElem:r[c].elemCopy,o[0]===a[l]){s.push(r[c]);break}var d={fixed:s};if(t){var f=".ws-sticky-header__sticky.ws-sticky-header__registered, .ws-sticky-header__block-copy",h=e.find(f).addBack(f),_=[];for(l=0;l<h.length;l++){var y=$(h[l]).hasClass("ws-sticky-header__block-copy");for(c=0;c<n.length;c++)if(o=!y?n[c].jqElem:n[c].stuck?n[c].fixedStackElem.elemCopy:null,o&&o[0]===h[l]){_.push(n[c]);break}}d.sticky=_}return d},checkStickyHeaderSize:function(e){for(var t=e?m._findElementsInContainer(e).fixed:r,i,a,n,s=0,l=t.length;s<l;s++){var o=t[s],d=o.isTableHeader?o.jqElem:o.elemCopy,f=o.isTableHeader?o.elemCopy:o.jqElem,h=d.offset().left-o.scrollableContainer.offset().left-c(d.css("margin-left")),_=m._calcWidth(d,h,o.scrollableContainer,false,o.isTableHeaderHasScroll);if(_!==o.width)if(o.width=_,f.css("width",_+"px"),o.gradientContainer){var y=m._calcWidth(d,o.leftPosition,o.scrollableContainer,true,o.isTableHeaderHasScroll);o.gradientContainer.css("width",y+"px")}if(o.leftPosition!==h)if(o.leftPosition=h,f.css("margin-left",h+o.marginLeft+"px"),o.gradientContainer)o.gradientContainer.css("left",h+"px");if(n=f.height(),o.isTableHeader)i=o.jqElem,a=o.elemCopy.children("table");if(o.height!==n){if(o.height=n,o.isTableHeader)m._synchronizeTableHeaderRows(i,a);else d.css("height",n+"px");if(o.gradientContainer)m._fixGradientTop(o.scrollableContainer)}if(o.isTableHeader)m._synchronizeTableCssClasses(o),m._updateTableHeaderColumnWidth(i,a)}e&&m.checkAllSticky(e.closest(".ws-sticky-header__scrollable-container"))},_fixGradientTop:function(e){for(var t=0,i=r.length;t<i;t++)if(r[t].scrollableContainer[0]==e[0]){var a=r[t];a.gradientContainer.css({top:m._calcGradientTop(a,e)+"px",display:a.height?"":"none"})}},_calcGradientTop:function(e,t){var i=e.isTableHeader?e.elemCopy:e.jqElem,a=i.offset().top-t.offset().top,r=i.outerHeight();if(e.isTableHeader){if(0===r)r=i.children("table:first").outerHeight()||0;if(e.isTableHeaderHasScroll&&this._isTableHeaderPartScrollShown(i))r-=7}return a+r-1},_calcWidth:function(t,i,a,r,n){var s=t.closest(".controls-DataGridView");if(s.length&&(n||e.browser.isIE10))t=s;var l=r?t.outerWidth(true):t.width();if(a&&1===a.length)if(l+i>a[0].clientWidth)l=a[0].clientWidth-i;return l},tableHeadRedrawn:function(e){var t=m._getStackElementByJQ(e);if(t){if(!t.elemCopy.find("thead").length)m._changeTableThead(t.jqElem,t.elemCopy.find("table"));m._tableHeadRedrawn(t)}},_tableHeadRedrawn:function(e){var t=e.elemCopy.children("table"),i=t.find("colgroup:first");if(1===i.length){var a=e.jqElem.find("colgroup:first");i.replaceWith(a.clone()),m._synchronizeTableHeaderRows(e.jqElem,t),m._updateTableHeaderColumnWidth(e.jqElem,t)}},updateTableHeaderVisibility:function(e){var t=m._getStackElementByJQ(e);if(t)t.jqElem.find("thead").toggleClass("ws-hidden",t.elemCopy.find("thead").hasClass("ws-hidden"))},_getStackElementByJQ:function(e){for(var t=0,i=r.length;t<i;t++)if(r[t].isTableHeader&&r[t].jqElem[0]===e[0])return r[t]},unfixAllChildren:function(e,t){var i=e.find(".ws-sticky-header__scrollable-container");if(i&&i.length)for(var a=i.length-1;a>=0;a--)m._unfixAllInArea($(i[a]),t);if(e.hasClass("ws-sticky-header__scrollable-container"))m._unfixAllInArea(e,t);else{for(var r=m._findElementsInContainer(e,t),n=r.fixed.length-1;n>=0;n--)m._unfixElement(r.fixed[n]);if(t)for(var s=r.sticky.length-1;s>=0;s--)m._unRegisterStickyElement(r.sticky[s]);m._fixGradientTop(e.closest(".ws-sticky-header__scrollable-container"))}},_unfixAllInArea:function(e,t){if(!e||1!==e.length)return;for(var i=r.length-1;i>=0;i--)if(r[i].scrollableContainer[0]==e[0])m._unfixElement(r[i]);if(t)for(var a=n.length-1;a>=0;a--)if(n[a].scrollableContainer[0]==e[0])m._unRegisterStickyElement(n[a]);m._unSubscribeWrapper(e.parent(".ws-sticky-header__wrapper"))},unfixOne:function(e,t){for(var i=r.length-1;i>=0;i--)if(r[i].jqElem[0]==e[0]){m._unfixElement(r[i]);break}if(t)for(var a=n.length-1;a>=0;a--)if(n[a].jqElem[0]==e[0]){m._unRegisterStickyElement(n[a]);break}m._fixGradientTop(e.closest(".ws-sticky-header__scrollable-container"))}};return{fixAllChildren:m.fixAllChildren,unfixAllChildren:m.unfixAllChildren,unfixOne:m.unfixOne,checkStickyHeaderSize:m.checkStickyHeaderSize,getStickyHeaderHeight:m.getStickyHeaderHeight,getStickyHeaderIntersectionHeight:m.getStickyHeaderIntersectionHeight,getStickyHeaderMaxHeight:m.getStickyHeaderMaxHeight,tableHeadRedrawn:m.tableHeadRedrawn,updateTableHeaderVisibility:m.updateTableHeaderVisibility,synchronizeTableHeaderColumnWidth:m.synchronizeTableHeaderColumnWidth}});
//# sourceMappingURL=StickyHeaderManager.js.map
define("Lib/LayoutManager/LayoutManager",["Core/constants","Core/detection","Core/helpers/Object/find","Core/EventBus","Core/detection","Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager"],function(t,e,i,n,o,r){"use strict";var l,s={};function c(t){var e=i(t,function(t){return!!$(t).length});return e?$(e):$()}var a={configureLayoutBlocks:function(t){if(t&&t.contentArea)l=c(t.contentArea)},getLayoutBlocks:function(){return{contentArea:l}},isMainScrollingContainerBody:function(){return 0===$(".ws-body-scrolling-content").length},getMainScrollingContainer:function(){var t=$(".ws-body-scrolling-content");return t.length?t:$("body")},getScrollingContainerFixedOffsets:function(){if(this.isMainScrollingContainerBody()){var t=$("body")[0];return{top:0,right:0,bottom:0,left:0,clientWidth:t&&t.clientWidth,clientHeight:t&&t.clientHeight}}else{var e=this.getMainScrollingContainer()[0];return{top:0,right:e.offsetWidth-e.clientWidth,bottom:e.offsetHeight-e.clientHeight,left:0,clientWidth:e.clientWidth,clientHeight:e.clientHeight}}},registerHandler:function(t,e){if("string"!==typeof t||""===t.trim())throw new Error("LayoutManager: При регистрации обработчика введено неправильное название события");if("function"!==typeof e)throw new Error("LayoutManager: При регистрации обработчика введен неправильный обработчик");if(s.hasOwnProperty(t))n.globalChannel().unsubscribe(t,s[t]);n.globalChannel().subscribe(t,e),s[t]=e},init:function(){if("undefined"!==typeof window){this.registerHandler("ContentAbsoluteBlocksChanged",function(t,e){if(!l.length)return;if(e.maxHeight>0){l.css("min-height","");var i=e.maxHeight>l.get(0).scrollHeight?Math.max(l.get(0).scrollHeight,e.maxHeight):"";if(""!==i)l.css("min-height",i)}else l.css("min-height","")}),l=c(t.layoutConfig.contentArea);var e=$("body");if(e.on("scroll",function(){if("hidden"===e.css("overflow-y"))this.getMainScrollingContainer().get(0).scrollIntoView(true)}.bind(this)),o.isMobileSafari){var i=0,n=function t(e){$(document.documentElement).css("height",e>0?"calc(100% + "+e+"px)":""),i=e>0?e:0},r=function t(){for(var e=1;e<=4;e++)setTimeout(s,100*Math.pow(e,2))},s=function(){a(),h()},a=function t(e){var o=window.innerHeight-document.documentElement.clientHeight;if(o=o>0?o:0,o!==i)n(o)},h=function(){if(e.hasClass("ws-body-no-scroll")&&e[0].scrollTop>0)e[0].scrollTop=0};$(document).bind("visibilitychange",r),$(window).bind("orientationchange",r),a(),setTimeout(a,1e3)}}},setHasAnyFloatArea:function(t){if(o.isMobileIOS&&!this.isMainScrollingContainerBody())this.getMainScrollingContainer().toggleClass("ws-ios-overflow-scrolling-auto",t)},scrollToElement:function(t,i,n){if(!t||!t.length)return;n=n||1/0;for(var o=t.parents().filter(function t(){if(n<=0)return false;var e=$(this).css("overflow-y"),i="auto"===e||"scroll"===e||this===document.documentElement;if(i)n--;return i&&this.scrollHeight>this.clientHeight}),l=$("html")[0],s=$("body")[0],c=function t(e){var i=e.offset();if(e[0]===l||e[0]===s)i.isHtmlOrBody=true,i.top=s.scrollTop,i.bottom=i.top+e[0].clientHeight;else i.bottom=i.top+e.outerHeight();return i},a=0;a<o.length;a++){var h=$(o[a]),f=c(h),g=c(t),u=f.isHtmlOrBody?s:h[0],d=h.hasClass("ws-sticky-header__scrollable-container")?r.getStickyHeaderMaxHeight(h):0;if(f.bottom<g.bottom)if(i)u.scrollTop+=g.bottom-f.bottom;else u.scrollTop+=g.top-f.top-d;else if(f.top+d>g.top)if(i)u.scrollTop-=Math.max(f.bottom+d-g.bottom,0);else u.scrollTop-=Math.max(f.top+d-g.top,0)}if(e.isMobileIOS&&e.isOldWebKit)setTimeout(function(){var t=u.style.height,e=$(u);e.height(t),e.height()},1)}};return a.init(),a});
//# sourceMappingURL=LayoutManager.js.map
define("js!SBIS3.ENGINE.MiniCard",["Core/constants","Core/detection","Core/WindowManager","SBIS3.CONTROLS/Action/OpenDialog","Core/core-instance","Lib/LayoutManager/LayoutManager","SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragObject","Lib/Control/AreaAbstract/AreaAbstract"],function(t,e,a,r,o,i,n,s){"use strict";var c={mode:"hover",delay:1e3,attribute:"data-minicard-template",attributePrefix:"data-minicard-"},u={_currentActiveCard:false,_lastTarget:false,_timer:void 0,_lastX:void 0,_lastY:void 0,_waitShow:void 0,delegateEvents:function(){var t=this;if(!e.isMobilePlatform)t._captureEvent("mouseenter",function(e,a){var r;if(r=t._getTargetParams(e),t._lastX=a.clientX,t._lastY=a.clientY,clearTimeout(t._timer),"click"==r.mode&&"hoverClick"!==r.mode)return;e.on("mousemove",{target:e,params:r,self:t},t._onMouseMove),t._stopPropagation(a)}),t._captureEvent("mouseleave",function(e){e.off("mousemove",t._onMouseMove),t._waitShow=false,clearTimeout(t._timer)}),t._captureEvent("mousedown",function(e){e.off("mousemove",t._onMouseMove),t._waitShow=false,clearTimeout(t._timer)}),t._captureEvent("click",function(e,a){var r;if(r=t._getTargetParams(e),clearTimeout(t._timer),"click"!=r.mode&&"hoverClick"!==r.mode)return;t._stopPropagation(a),t._showCard(r,e)});else t._captureEvent("click",function(e,a){var r=t._getTargetParams(e);a.preventDefault(),a.stopImmediatePropagation(),t._showCard(r,e)})},_stopPropagation:function(t){if(t.stopImmediatePropagation)t.stopImmediatePropagation();else t.returnValue=false},_onMouseMove:function(t){var e=t.data.self,a=t.data.params,r=t.data.target;if(e._waitShow||t.clientX==e._lastX&&t.clientY==e._lastY)return t;e._lastX=t.clientX,e._lastY=t.clientY,e._waitShow=true,e._timer=setTimeout(function(){e._showCard(a,r)},a.delay||c.delay)},_captureEvent:function(t,e){var a=function(t){var a=$(t.target||t.srcElement);if(a&&a[0]!==document&&"HTML"!==a[0].tagName)if(a.is("["+c.attribute+"]"))e(a,t);else if(a.parent("["+c.attribute+"]").length)if(a=$(a.parent("["+c.attribute+"]")[0]),"click"==a.attr(c.attributePrefix+"mode"))e(a,t)};if(document.addEventListener)document.addEventListener(t,a,true);else if(document.attachEvent){if("mouseenter"==t)t="mouseover";document.attachEvent("on"+t,a)}},_showCard:function(t,e){var a,o,i=e.closest("td");if(i&&i.width()&&i.width()<e.width())e=i;if(!this._validateParams(t))return false;if(this._canShow(e)){if(this._lastTarget=e,this._currentActiveCard)this._currentActiveCard.close();a=this._createCardConfig(t,e),(o=new r(a)).execute().addCallback(function(){o.destroy()})}},_validateParams:function(t){return t&&t.template},_getTargetParams:function(t){var e=t[0].attributes,a={};return Object.keys(e).forEach(function(t){var r=e[t];if(0===r.name.indexOf(c.attributePrefix))a[r.name.substr(c.attributePrefix.length)]=r.value}),a},_canShow:function(t){var e=a.getActiveWindow(true),r;if(e)e=e.getTopParent(),r=o.instanceOfModule(e,"Lib/Control/FloatArea/FloatArea");return(!e||!r||this._lastTarget[0]!=t[0])&&(!this._currentActiveCard||this._currentActiveCard._options.target[0]!==t[0])&&!n.isDragging()},_getOffset:function(t){return{x:t.offsetx?t.offsetx:0,y:t.offsety?t.offsety:0}},_createCardConfig:function(t,e){var a=this,r="false"===t["track-target"]?false:true;return{dialogOptions:{target:e,hoverTarget:e,opener:e.wsControl(),parent:e.wsControl()instanceof s?e.wsControl():e.wsControl().getParent(),catchFocus:false,direction:"right",animation:"fade",verticalAlign:"bottom",showDelay:0,autoHide:true,autoCloseOnHide:true,fitWindow:true,trackTarget:r,offset:a._getOffset(t),side:"right",isStack:false,task1173269044:true,autoShow:false,handlers:{onTargetVisibilityChange:function(t,e){if(!e)this.close()},onAfterClose:function(){if(a._currentActiveCard===this)a._currentActiveCard=false,a._lastTarget=false;i.setHasAnyFloatArea(false)},onBeforeShow:function(){a._currentActiveCard=this,i.setHasAnyFloatArea(true)},onAfterLoad:function(){this.show()}}},template:t.template,componentOptions:t,mode:"floatArea"}}};if(t.isBrowserPlatform)u.delegateEvents();return u});
//# sourceMappingURL=MiniCard.module.js.map
define("js!SBIS3.DOCVIEW.SbisDiskModel",["js!SBIS3.DOCVIEW.DocviewModel","js!SBIS3.DOCVIEW.Funcs","tmpl!SBIS3.DOCVIEW.DocviewModel/resources/Responsible","js!SBIS3.ENGINE.MiniCard","i18n!SBIS3.DOCVIEW.SbisDiskModel"],function(e,t,i){"use strict";return e.extend({_moduleName:"SBIS3.DOCVIEW.SbisDiskModel",getDaysLeft:function(){var e=this.get("DatePermanentlyDelete");if(!e)return"";var i=(e-(new Date).getTime())/1e3,r,s="",a=rk("Будет удален навсегда")+" "+e.strftime("%d %b %Y, %H:%M").toLowerCase();if(i<3600)if(r=Math.floor(i/60),r<=0)s=rk("1 минута");else s=r+t.getPluralForm(r," "+rk("минута","удаления")," "+rk("минуты","удаления")," "+rk("минут","удаления"));else if(i<86400)s=(r=Math.floor(i/3600))+t.getPluralForm(r," "+rk("час","удаления")," "+rk("часа","удаления")," "+rk("часов","удаления"));else s=(r=Math.floor(i/86400))+t.getPluralForm(r," "+rk("день","удаления")," "+rk("дня","удаления")," "+rk("дней","удаления"));return{title:a,visual:s}},getDateForDisk:function(){var e=this._linkedControl._dataController.getFilter(),t="ModifyDate",i=rk("Изменен"),r="",s="",a;if("loads"===e.catalogId)t="CreationDate",i=rk("Загружен");else if("sharedmedocs"===e.catalogId)t="CreationDate",i=rk("Доступ предоставлен");else if("signedmedocs"===e.catalogId)t="CreationDate",i=rk("Подписан");else if("mytrash"===e.catalogId||"commontrash"===e.catalogId)i=rk("Удален"),t="DeleteDate";if(a=this.get(t),a){var o=a.strftime("%d %b").toLowerCase(),l=a.getFullYear()!==(new Date).getFullYear()?", "+a.strftime("%Y"):"",n=a.strftime("%H:%M");r=o+(l||", "+n),s=i+" "+a.strftime("%d %b %Y, %H:%M:%S").toLowerCase()}return{date:r,tooltip:s}},getLinkHtml:function(){var e,t,i="",r=!!this.get("Раздел@");if(this.get("Flags")&&this.get("Flags").get("IsLink"))e="icon-Linked",t=rk("Ссылка на")+" "+(r?rk("папку")+"\n"+rk("Эта папка"):rk("файл")+"\n"+rk("Этот файл"))+" "+rk("не занимает места на вашем диске");if(e)i='<div class="icon-16 '+e+' icon-disabled" title="'+t+'"></div>';return i},getResponsibleHtml:function(){var e,r;if(this._linkedControl)e=(this._linkedControl._dataController.getFilter()||{}).catalogId;return r=t.getResponsible(this,e),!r||!r.name?"":i(r)},getParentNameDeleted:function(){var e=this.get("OppositeFileParentName");if(!e&&this.get("OppositeFileParentId"))e=t.getRootName(this.get("OppositeFileParentId"));return e},getTitleTextMaxWidth:function(){var e=0;if(this.hasSigns()){var t=this.get("CountSigns")||this.get("countSigns")||0;if(e=20,t>1&&t<=9)e=23;else if(t>=10&&t<=99)e=29;else if(t>99)e=35;if(3===this.get("signs"))e+=20}if(this.isEncrypted())e+=20;if(e>0)return"calc(100% - "+e+"px)";return""}})});
//# sourceMappingURL=SbisDiskModel.module.js.map
define("js!SBIS3.DOCVIEW.DocviewDataSource",["WS.Data/Source/Base","WS.Data/Query/Query","Core/helpers/Object/isEmpty"],function(e,t,r){"use strict";return e.extend({$protected:{_dataSources:{},_active:null,_findDataSource:function(e){var t=null;e=e||[];for(var r in this._dataSources)if(this._dataSources.hasOwnProperty(r))if(e.indexOf(r)<0)t={id:r,dataSource:this._dataSources[r]};return t},_selectActiveDataSource:function(e){var t=this._findDataSource(e);if(t)this._active=t.id;return t&&t.dataSource},_getActiveDataSource:function(e){if(e){var t=e.getWhere();if(r(t)){if(this._dataSources.memory)return this._active="memory",this._dataSources.memory}else if(t.folder&&String(t.folder).indexOf("_ZIP")>-1||t.Path&&String(t.Path).indexOf("_ZIP")>-1||t.catalogId&&String(t.catalogId).indexOf(window.location.host)>-1&&t.folder)return this._active="Archive",this._dataSources.Archive;else{var o=this._selectActiveDataSource(["memory","Archive"]);if(!o)o=this._selectActiveDataSource(["Archive"]);return o}}return this._selectActiveDataSource(["Archive"])}},appendDataSource:function(e,t){this._dataSources[e]=t},removeAllDataSources:function(){this._dataSources={},this._active=null},isEmpty:function(){return r(this._dataSources)},getActiveDataSourceId:function(){return this._active},getAdapter:function(){return this._getActiveDataSource().getAdapter()},setAdapter:function(e){throw new Error("Method must be implemented")},getModel:function(){throw new Error("Method must be implemented")},setModel:function(e){throw new Error("Method must be implemented")},getIdProperty:function(){throw new Error("Method must be implemented")},setIdProperty:function(e){throw new Error("Method must be implemented")},create:function(e){throw new Error("Method must be implemented")},read:function(e,t){throw new Error("Method must be implemented")},update:function(e,t){throw new Error("Method must be implemented")},destroy:function(e,t){throw new Error("Method must be implemented")},merge:function(e,t){throw new Error("Method must be implemented")},copy:function(e,t){throw new Error("Method must be implemented")},query:function(e){return this._getActiveDataSource(e).query("memory"===this._active?new t:e)},call:function(e,t){throw new Error("Method must be implemented")},getResource:function(){return this._getActiveDataSource().getResource()}})});
//# sourceMappingURL=DocviewDataSource.module.js.map
define("js!SBIS3.DOCVIEW.DocviewDataSetMixin",["Core/core-clone","Core/core-instance","Core/core-merge","Core/helpers/Array/findIndex","js!SBIS3.DOCVIEW.Funcs","js!SBIS3.DOCVIEW.DocviewDataSource","WS.Data/Source/SbisService","WS.Data/Source/Memory","WS.Data/Entity/Model","WS.Data/Query/Query","js!SBIS3.DOCVIEW.DocviewModel","js!SBIS3.DOCVIEW.SbisDiskModel","WS.Data/Di","Core/Deferred","WS.Data/Collection/RecordSet","WS.Data/Chain","css!SBIS3.DOCVIEW.Preview"],function(e,t,i,o,n,r,a,s,d,c,l,u,h,f,_,g){"use strict";function m(e,t,i){return i.every(function(i){return e.get(i)===t.get(i)})}function p(e,t){var i,o,n;for(i=0,o=e.getCount();i<o;i++)if(n=e.at(i),l.prototype.isRequired.call(n)&&m(n,t,["typeDoc","subTypeDoc"]))return true;return false}function v(e,t){var i;if(l.prototype.isRequired.call(t))return p(e,t);return i=e.getIndexByValue("attachId",t.get("attachId")),i>=0&&m(e.at(i),t,["hash","signs","countError","encrypted","editable"])}function C(e,t,i){return g(e).filter(function(e){var o=e.get("attachId");return!t.getRecordById(o)&&(!i||e.get("folder")===i)}).toArray()}function S(e){for(var t in e)if(e.hasOwnProperty(t)&&null!=e[t])return true;return false}function I(e,t){var i={},o=0;return e.each(function(e,n){var r={inSet:n};if(e.get("folder")===t)r.inFolder=o,o+=1;i[e.getId()]=r}),i}function R(e,t){var i=e.getRecordById(t);if(i&&i.get("folder@"))return g(e).filter(function(e){return e.get("folder")===t}).map(function(t){var i=t.get("attachId");if(t.get("folder@"))return[i].concat(R(e,i));return i}).flatten().toArray();return[]}function y(e,t){return t.reduce(function(t,i){return t[i]=e.get(i),t},{})}return{$protected:{_currentSelection:null,_dataController:null,_doNotHandleBeforeSetRoot:false,_doNotHandleContextItemChange:false,_changes:[],_getMyModel:function(){var e=this,t=this._options.mainOptions,o=this._options.listOptions,n=this._getAliasId(this._options),r="docview.control."+n,a=t.modelAlias||this._options._randomAlias||"docview.model."+n,s=t.viewModel||u,d={serviceUrl:t.serviceUrl,objectName:t.objectName,previewWidth:200,previewHeight:150,calcMargin:false,_isAuth:t._isAuth};if(o){if(o.previewWidth)d.previewWidth=o.previewWidth;if(o.previewHeight)d.previewHeight=o.previewHeight;d.calcMargin=Boolean(o.calcMargin)}if(!h.isRegistered(r))h.register(r,this,{instantiate:false});if(h.isRegistered(a)&&t.objectName!==h.resolve(a)._options.objectName)a+="."+t.objectName;if(!h.isRegistered(a))h.register(a,function(t){if(t=t||{},t.linkedControl=r,i(t,d),e._currentPreviewWidth)t.previewWidth=e._currentPreviewWidth;if(e._currentPreviewHeight)t.previewHeight=e._currentPreviewHeight;return new s(t)});return a},_createMemorySource:function(e){var i={model:this._getMyModel(),idProperty:"attachId"};if(e){if(i.data=e.getRawData(true),t.instanceOfModule(e.getAdapter(),"WS.Data/Adapter/Sbis"))i.adapter="adapter.sbis"}else i.data=[],i.adapter="adapter.sbis";return new s(i)},_createSbisServiceSource:function(){return new a({model:this._getMyModel(),adapter:"adapter.sbis",endpoint:{address:this._options.mainOptions.serviceUrl+"service/",contract:this._options.mainOptions.objectName},binding:{query:"AttachList"}})},_isDocviewModels:function(e){return e instanceof _&&"string"===typeof e.getModel()&&0===e.getModel().indexOf("docview.model")},_createMemory:function(e){var t=this.getLinkedContext(),i=this._getContextRecordSet(),o=this._options.listOptions.defaultRecordPK,n,r;if(this._trackContextRecordSet(i),this._applyChanges(),this._docviewDataSource.appendDataSource("memory",this._createMemorySource(i)),t.getValue("redactionsListsCache"))t.setValue("redactionsListsCache",{});if(!this._issettedds){if(this._listDataLoaded=true,n=e.getItems(),this._options.listOptions.serializedItems&&this._isDocviewModels(n)){if(e.setDataSource(this._docviewDataSource,true),e._notify("onDataLoad",n),e._notify("onItemsReady",n),e._notify("onDrawItems"),n.getCount())e._notify("onSelectedItemChange",n.at(0).getId())}else e.setDataSource(this._docviewDataSource);if(void 0!==i)this._issettedds=true,this._isWaitingDataSource=false;if(null!=o&&-1!==o&&"undefined"!==o)r=o}else if(this._mergeFromCtx(),this.viewerRecordSet.getCount())r=-1!==o&&"undefined"!==o?o:e.getSelectedKey()||null;if(null!=r&&"function"===typeof e.setSelectedKey&&r!==e.getSelectedKey())e.setSelectedKey(r)},_createMemoryAsync:function e(t){var i=this;clearTimeout(this._createMemoryTimeout),this._createMemoryTimeout=setTimeout(function(){if(!i.isDestroyed())i._createMemory(t)},0)},_getCurrentItems:function(e){var t=e.getDataSource();if(t===this._docviewDataSource)if("Archive"===t.getActiveDataSourceId()){var i=t._findDataSource(["Archive"]);if(i&&"memory"===i.id)return i.dataSource.query().getResult().getAll()}return e.getItems()},_setMonitoringCtx:function(e){var t=this,i=this._getContextRecordSet(),o=this.getLinkedContext();if(this.subscribeTo(o,"onFieldChange",n),this.subscribeTo(o,"onFieldsChanged",n),i)this._createMemoryAsync(e);function n(i,o){if(t._options.mainOptions.ctxLinkList===o||("record"===o||!o)&&t._dataController&&t._previousContextRecordSet!==t._getContextRecordSet())t._createMemoryAsync(e)}},_initOneRec:function(e){var t=this,i=t._getMyModel(),o=h.resolve(i);o.set("attachId",t._options.listOptions.defaultRecordPK),n._getAttachmentInfo(t._options,o).addCallback(function(e){return t._notify("onReadAttachmentInfo",e),e}).addCallback(r).addErrback(function(e){if(t._options.viewOptions.justAttach)t.getContainer().empty().before(n._getErrorHTML(e));else o.set("notFound",true),r(o)});function r(t){var o=t.getAdapter(),n=new _({model:i,adapter:o});n.add(t);var r={data:n.getRawData(),model:i,idProperty:"attachId",adapter:o};e.setDataSource(new s(r))}},_startCheck:function(e){if(!e||!e.length)return;var t=this;new a({endpoint:{address:t._options.mainOptions.serviceUrl+"service/",contract:t._options.mainOptions.objectName}}).call("AccessRightData",{FileIds:e}).addCallback(function(e){var i=e.getAll();if(t.viewerRecordSet.setEventRaising(false),i.getCount()>0)t._doNotHandleDrawItems=true;i.each(function(e,i){if(i===this.getCount()-1)t._doNotHandleDrawItems=false;var o=e.get("FileId"),n=t.viewerRecordSet.getRecordById(o);if(n){var r={canEdit:e.get("canEdit")};if(e.has("canDelete")&&n.has("canDelete"))r.canDelete=e.get("canDelete");n.set(r)}}),t.viewerRecordSet.setEventRaising(true),t._doNotHandleDrawItems=false,t._addItemsInstances(t.viewerRecordSet),t._notify("onAccessReady",i)})},_checkRight:function(e){var t=g(e||this.viewerRecordSet).filter(function(e){return!e.isRequired()&&null===e.get("canEdit")}).map(function(e){return e.get("attachId")}).value();this._startCheck(t)},_initDataSet:function(e,i){if(!this._options.mainOptions.useOnlyCtx&&!this._options.mainOptions.isOneRec&&!this._options.mainOptions.fixId&&(!e.getFilter||!S(e.getFilter()))&&(!this._options.mainOptions.ctxLinkId||!this.getLinkedContext().getValue(this._options.mainOptions.ctxLinkId)))return;var o=this;if(!o._docviewDataSource)o._docviewDataSource=new r;if(o._options.viewOptions.justAttach||o._options.mainOptions.isOneRec)o._initOneRec(e);if(!o._initedDataSet)this.subscribeTo(e,"onBeforeSetRoot",function(){if(o._doNotHandleBeforeSetRoot)return;if(o.isArchive())o._doNotHandleBeforeSetRoot=true,o._returnFromArchive(),o._doNotHandleBeforeSetRoot=false}),e.subscribe("onDataLoad",function(t,i){if(o._isDataLoaded=true,!o._options.fullScreenMode)o._currentSelection=null;if(e!==o)o._notify("onDataLoad",i);if(o.isEnabled())setTimeout(function(){if(!o.isDestroyed())o._checkEditingArr(e.getItems()).addCallback(function(){var e=o._getTestedArray();if(e.length)o._notify("onChangeCommandsSetting",e)})},1);setTimeout(function(){if(!o.isDestroyed())o._addItemsInstances(e.getItems()),o._checkRight(e.getItems())},1)}),e.subscribe("onItemsReady",function(){o.viewerRecordSet=e.getItems()}),e.subscribe("onDataLoadError",function e(i,n){if("Archive"===o._options.mainOptions.objectName&&o._archiveStack.length){var r=o._options.mainOptions.fixId.split(";")[2],a=o._getArchiveParent(),s=o.viewerRecordSet.getRecordById(r);if(s._options.isError=true,o._goFromZip(o._archiveStack.length-1,a,true),o.getVisibilityMode&&"bigPreview"===o.getVisibilityMode()||!t.instanceOfModule(o.getParent(),"SBIS3.DOCVIEW.FullViewer"))o.startCommand("fullScreen",[s]);i.setResult(true)}}),e.subscribe("onDataMerge",function(t,i){var n=this;setTimeout(function(){var t=n.getItems();if(e!==o)o._notify("onDataLoad",t,true);if(o.viewerRecordSet=t,o.isEnabled())o._checkEditingArr(t);o._addItemsInstances(t),o._checkRight()},1)});if(o._initedDataSet=true,o._dataController=e,!o._options.mainOptions.isOneRec){if(o._options.mainOptions.useOnlyCtx)o._setMonitoringCtx(e);else o._docviewDataSource.appendDataSource(o._options.mainOptions.objectName,this._createSbisServiceSource());if(!o._docviewDataSource.isEmpty())e.setDataSource(o._docviewDataSource,i),o._issettedds=true}}},_getLimitForMergeFromBL:function(e){var t,i,o;if(e.offset&&e.recordCount)return e.recordCount;if(e.recordCount)return e.recordCount+1;return t=this.viewerRecordSet.getCount(),i=e.additionalCount||1,o=this._options.listOptions&&this._options.listOptions.pageSize||0,Math.max(o,t+i)},_mergeDataSet:function(e,t,i){var o=this.viewerRecordSet,n=-1,r=null,a=[],s,d,c,l,u,h;if(i.deleteItems)C(o,e,s=i.deleteItemsOnlyCurrentFolder&&i.filter&&i.filter.folder).forEach(function(e){this.deleteItem(e.get("attachId"))},this);for(d=I(o,t),this._dataController._options.autoRedraw=true,h=0;h<e.getCount();h++){if(c=e.at(h),l=c.get("attachId"),u=d[l],c._options.idProperty="attachId",u&&u.inFolder!==h&&!i.append)a=a.concat(R(o,l)),this.deleteItem(l),u=null;if(!u){if(i.needSetCursor&&!r)r=l;if(n+=1,i.append||n===o.getCount())o.add(c);else o.add(c,n);d=I(o,t)}else n=u.inSet}if(this.deleteItems(a),this._dataController._options.autoRedraw=false,this._dataController.reviveComponents(),this.isEnabled())this._checkEditingArr(o);if(this._addItemsInstances(o),r=i.selectedKey||r,i.needSetCursor&&r&&this.selectItemAndScroll)this.selectItemAndScroll(r);this._checkRight(),this._notify("onMergeFromBL")},mergeFromBL:function(e){var t=this,i;if(!this.viewerRecordSet||0===this.viewerRecordSet.getCount())return this._dataController.reload();return e=e||{},i=(new c).where(e.filter||t._dataController.getFilter()).offset(e.offset&&e.recordCount?e.offset:0).limit(this._getLimitForMergeFromBL(e)).orderBy(t._dataController.getSorting()),this._createSbisServiceSource().query(i).addCallback(function(o){t._mergeDataSet(o.getAll(),i.getWhere().folder,e)})},_mergeFromCtx:function(){var e=this,t=this._getContextRecordSet(),i=e.viewerRecordSet,o=false,n=[],r=[],a=e._doNotHandleSelectedItemsChange,s=e._doNotHandleDrawItems;if(!t||!t.getCount())o=true;else i.each(function(e){if(!v(t,e))n.push(e.get("attachId"))}),o=n.length===i.getCount();if(o)e._doNotHandleSelectedItemsChange=true;if(e._doNotHandleDrawItems=true,e.viewerRecordSet.setEventRaising(false,true),o)this.deleteAllItems();else n.forEach(function(t){e.deleteItem(t)});if(e.viewerRecordSet.setEventRaising(true,true),e._doNotHandleSelectedItemsChange=a,e._dataController._options.autoRedraw=true,t&&t.each(function(e,t){if(!v(i,e))if(t<i.getCount())i.add(e,t);else r.push(e)}),r.length)i.append(r);if(e._doNotHandleDrawItems=s,e._dataController._notify("onDrawItems"),e._dataController._options.autoRedraw=false,e._dataController.reviveComponents(),e._notify("onMergeFromContext"),e.isEnabled())e._checkEditingArr(i);e._addItemsInstances(i),e._checkRight()},deleteItem:function(e){this.deleteItems([e])},deleteItems:function(e){if(!e||!e.length)return;var i=this,o=t.instanceOfMixin(this._dataController,"SBIS3.CONTROLS/Mixins/Selectable")&&t.instanceOfMixin(this._dataController,"SBIS3.CONTROLS/Mixins/MultiSelectable"),n=this._dataController.getItems();if(o){var r=this._dataController.getSelectedKeys()||[],a=e.filter(function(e){return r.indexOf(e)>=0});this._dataController.toggleItemsSelection(a)}e.forEach(function(e){var t=n.getRecordById(e);if(t)i.viewerRecordSet.remove(t);i.getContainer().find('[data-id="'+e+'"]').remove()})},deleteAllItems:function(){if(t.instanceOfMixin(this._dataController,"SBIS3.CONTROLS/Mixins/MultiSelectable"))this._dataController.removeItemsSelectionAll();this.viewerRecordSet.clear()},_updateContextModel:function(e,t){var i=this._getContextRecordSet(),o=i&&i.getRecordById(e);if(o)this._doNotHandleContextItemChange=true,l.prototype.setMultiple.call(o,t),this._doNotHandleContextItemChange=false},_getFieldFormats:function(e,t){var i=e.getFormat();return t.map(function(e){return i.getIndexByValue("name",e)}).filter(function(e){return e>=0}).map(function(e){var t=i.at(e);return{name:t.getName(),type:t.getType()}})},_updateAttachment:function(e,t){var i;if(!t)return;(i=y(t,["title","fileName","hash","redactionId","canEdit","Size","size","CountSigns","countRedactions","redactionsNumber","idPreviousRedactionSign","hasPreviousRedactionSign","ModifyDate","relativeUrl","Editor","encrypted","Type","versionForm"])).title=i.title||i.fileName,i.signs=n._getValidSignsValue(e,t),i.EditorPhotoId=t.get("EditorPhotoId")||t.get("profilePhotoId"),this._updateContextModel(e.get("attachId"),i),e.updateFlags(t),e.setMultiple(i,this._getFieldFormats(t,["idPreviousRedactionSign"])),this._notify("onItemChanged",e)},_updateRedactionsCache:function(e){var t=e.get("countRedactions")||0,i=e.get("redactionsNumber")||0,o,n,r,a;if(t<2&&i<2||"classic"!==this.getVisibilityMode())return;if(o=e.get("attachId"),n=this.getLinkedContext().getValue("redactionsListsCache"),r=n&&n[o],r)if(a=r.getRecordById(e.get("redactionId")),t!==r.getCount()||i!==r.getCount())delete n[o];else if(a.get("hash")!==e.get("hash"))l.prototype.setMultiple.call(a,g(e).toObject());this._fillInlineRedactionsControls(o)},_recalculateToolbarPosition:function(){var e=this._dataController._getItemsToolbar();if(e&&e.isVisible())e.recalculatePosition()},redrawItemDocview:function(e,t){var i=this.viewerRecordSet&&this.viewerRecordSet.getRecordById(e);if(!i)return;if(this._updateAttachment(i,t),this.isDestroyed())return;if(this._dataController.redrawItem(i),this._dataController.reviveComponents(),this._addItemsInstances(this.viewerRecordSet),this._calcMargin)this._calcMargin(),this._recalculateToolbarPosition(),this._updateRedactionsCache(i)},reloadItemInstances:function(){if(this.isEnabled())this._checkEditingArr(this.viewerRecordSet);this._addItemsInstances(this.viewerRecordSet)},_goToZip:function(t){var i=n.getOptionsForSave(t,this),o="http://"+window.location.host+this._options.mainOptions.serviceUrl+"service/",r=this._dataController,a=this._getCurrentPathToZip(r.getItems(),t),s=t.get("attachId"),d;if(r.removeItemsSelectionAll(),i.mainOptions.filter=e(r.getFilter()),this._changedCmd)i.changedCommandsSettings=e(this._changedCmd);if(this.setCommandCfg("fullScreen",{isMainAction:true},true),this._archiveStack.push(i),d={listOptions:{root:s+"_ZIP"},mainOptions:{ctxLinkId:"????",fixId:[o,this._options.mainOptions.objectName,s,t.get("redactionId")||""].join(";"),objectName:"Archive",serviceUrl:"/docview/",useOnlyCtx:false,commands:{deleteDoc:false,directLink:false,addPage:false,edit:false,redactions:false,deletePermanentlyDoc:false,editInApp:false,move:false,print:false,rename:false,signDocument:false,sendMessage:false,rights:false,upload:true,saveToPdf:false,links:false,copyToBuffer:false,imageEdit:false},isDisk:false},hiddenWithOneDoc:false,full_path:a},n.setAllOptions(this,d),this._notify("onGoToZip",d,i),this._initDataSet(r,true),a)a=JSON.stringify(a.getRawData());r.setItemsDragNDrop(false),r._options.selectedIndex=null,r._options.selectedKey=null,this._options.mainOptions.filter={catalogId:this._options.mainOptions.fixId,Path:a},this._notifyOnPropertyChanged("mainOptions"),this._doNotHandleBeforeSetRoot=true,r.setCurrentRoot(d.listOptions.root),this._doNotHandleBeforeSetRoot=false,r._options.pageSize=1e3,this._options.mainOptions.filter.folder=d.listOptions.root,this._notifyOnPropertyChanged("mainOptions"),r.setFilter(this._options.mainOptions.filter),this.getContainer().addClass("docview-list_archive")},getSelectedItems:function(){return this._dataController.getSelectedItems()},goFromZip:function(e,t){this._dataController._options.root=e,this._goFromZip(0,e,t)},_goFromZip:function(e,t,i){var o=this,r=o._archiveStack[e],a=r.full_path,s=a.getCount()&&a.at(a.getCount()-1),d=a.getCount()&&a.at(0).get("folder")===t||this._dataController._options.root===t;if(this._dataController.removeItemsSelectionAll(),this.setCommandCfg("fullScreen",{isMainAction:false},true),r.changedCommandsSettings)this.setMultiplyCommandCfg(r.changedCommandsSettings);if(d)r.mainOptions.filter.Path=null;if(this._dataController.setItemsDragNDrop(this._options.listOptions.itemsDragNDrop),r.mainOptions.filter.folder=t,n.setAllOptions(o,r),o._notify("onGoToZip",r,n.getOptionsForSave(s,this)),this._archiveStack.length=e,this._dataController._options.selectedIndex=null,this._dataController._options.selectedKey=null,this._dataController.setCurrentRoot(t),this._dataController._options.pageSize=r.listOptions.pageSize,this._dataController.setFilter(r.mainOptions.filter,true),this.getContainer().removeClass("docview-list_archive"),i)this._dataController.setCurrentRoot(t),this._dataController.reload();if(o.getLinkedContext().getValue("listFilters"))this.getLinkedContext().setValue("listFilters",r.mainOptions.filter)},$constructor:function(){this._publish("onDataLoad","onGoToZip","onAccessReady","onItemChanged");var e=this;e.once("onInit",function(){e.subscribe("onFinishCommand",function(t,i,o){var r=o.records[0];if("rename"===i&&o.finishParams.newTitle){var a=new d;a.set("fileName",o.finishParams.newTitle);var s=r.get("attachId");if(!e._options.fullScreenMode)e.redrawItemDocview(s,a)}if("deleteDoc"===i||"deletePermanentlyDoc"===i)e._onFinishDeleteCommand(o.records);if("imageEdit"===i&&false!==e._options.redrawOnEdit&&!(o&&o.finishParams&&o.finishParams.saving instanceof f))n._getAttachmentInfo(e._options,r).addCallback(function(t){if(!e.isDestroyed())e.redrawItemDocview(r.get("attachId"),t)})}),e.subscribe("onProcessCommand",function(t,i,o){if("edit"===i&&(!e._options.viewOptions||"edit"!==e._options.viewOptions.mode)){var r=o&&o.records?o.records[0]:null;n._getAttachmentInfo(e._options,r).addCallback(function(t){e.redrawItemDocview(r.get("attachId"),t)})}else if("redactions"===i&&o.isOpenedFromList)e.startCommand("fullScreen",[o.records[0]],{inline:true,mainRecord:o.mainRecord})})}),this.once("onDestroy",function(){var e=this._getAliasId(this._options),t=this._options._randomAlias||"docview.model."+e,i=t+"."+this._options.mainOptions.objectName,o="docview.control."+e;h.unregister(t),h.unregister(i),h.unregister(o),this._dataController=null,this._untrackContextRecordSet()})},_onFinishDeleteCommand:function(e){var t,i,o;for(o=0;o<e.length;o++)if(t=e[o],i=t.get("attachId"),t.isLoadedRequired())this._deleteRequiredAttachment(i);else if(!t.isRequired())this.deleteItem(i)},_deleteRequiredAttachment:function(e){var t=this.viewerRecordSet&&this.viewerRecordSet.getRecordById(e);if(t&&t.isLoadedRequired())if(t.set({fileName:null,redactionId:null,hash:null}),this._setItemActionsForAttachment)this._setItemActionsForAttachment(t)},reload:function(){this._initDataSet(this._dataController)},_getContextRecordSet:function(){return this.getLinkedContext().getValue(this._options.mainOptions.ctxLinkList)},getSelectedItem:function(){if(this.viewerRecordSet&&this._dataController){var e=this._dataController.getSelectedKey();if(e)return this.viewerRecordSet.getRecordById(e)}},_getArchiveParent:function(){var e=this._archiveStack[this._archiveStack.length-1].full_path,t=e.getCount()&&e.at(e.getCount()-1);return t&&t.get("folder")||void 0},isArchive:function(){return Boolean(this._options.mainOptions&&"Archive"===this._options.mainOptions.objectName)},_returnFromArchive:function(){function e(e){return g(e.full_path).toArray().some(function e(t){return t.get("folder")==i})}var t=this._dataController.getFilter(),i=t.folder||null,n=this._archiveStack||[],r=String(t.catalogId),a=o(n,e);if(-1===r.indexOf(window.location.host))i=n[0].full_path.at(0).get("folder");if(n.length&&a<0&&null===i)a=0,n[0].full_path.at(0).set("folder",null);if(a>=0)this._goFromZip(a,i)},switchToRemoteDataSource:function(){if(!this._options.mainOptions.useOnlyCtx)return;if(this._options.mainOptions.useOnlyCtx=false,clearTimeout(this._createMemoryTimeout),this.unsubscribeFrom(this.getLinkedContext()),this._docviewDataSource)this._docviewDataSource.removeAllDataSources();if(this._dataController)this._initDataSet(this._dataController,true),this.viewerRecordSet=this._dataController.getItems()},_trackContextRecordSet:function(e){var t=this;if(this._previousContextRecordSet&&e!==this._previousContextRecordSet)this._untrackContextRecordSet();if(!this._previousContextRecordSet){if(this._previousContextRecordSet=e,!e)return;this.subscribeTo(e,"onCollectionItemChange",function(e,i,o,n){if(t.isDestroyed()||t._doNotHandleContextItemChange)return;t._pushChange("ch",{id:i.getId(),props:n})}),this.subscribeTo(e,"onCollectionChange",function(e,i,o,n,r,a){if(t.isDestroyed()||t._doNotHandleContextItemChange)return;t._pushChange(i,{newItems:o,newIndex:n,oldItems:r,oldIndex:a})})}},_untrackContextRecordSet:function(){if(!this._previousContextRecordSet)return;this.unsubscribeFrom(this._previousContextRecordSet),this._previousContextRecordSet=null,this._changes=[]},_pushChange:function(e,t){this._changes.push({action:e,data:t})},_applyChanges:function(){if(!this._changes||!this._dataController||!this._dataController.getItems())return;var e=this._dataController.getItems(),t;this._changes.forEach(function(i){switch(i.action){case"ch":if(t=e.getRecordById(i.data.id),t)t.set(i.data.props);break;case"rp":e.replace(i.data.newItems[0],i.data.newIndex)}}),this._changes=[]},_getAliasId:function(e){return e&&e.eventBusId||e&&e.__$config||this&&this._id||e&&"string"===typeof e.element&&e.element||e&&e.name}}});
//# sourceMappingURL=DocviewDataSetMixin.module.js.map
define("js!SBIS3.DOCVIEW.CommandsManager",["Core/helpers/Object/find","Core/detection","js!SBIS3.DOCVIEW.Funcs","Core/IoC","Core/Deferred","Core/ParallelDeferred","i18n!SBIS3.DOCVIEW.CommandsManager"],function(e,i,n,t,s,o){"use strict";var r={},a=["СчФктр","ОписаниеОшибки","АнализОшибкиРазработка","АнализОшибкиТестирование","MergeRequest","ТТНЕГАИС","ВыполнитьНаБоевом","ВыполнитьНаТестовом","УпдДоп","УпдСчфДоп","СправкаБ"];function l(e){return!("inline"===e.place&&!e.command.inInline||"list"===e.place&&!e.command.inList||"mas"===e.place&&!e.command.inMas||"single"===e.place&&!e.command.inSingle)}return{$protected:{_options:{mainOptions:{userCommands:[]}},isValidParent:function(){return true},_fileEditor:void 0,_typeCmd:"inline",imageExts:["jpg","jpeg","bmp","png","ico","gif","rgb","rgba","psd","webp"],notEditableImagesExts:["webp","psd"],archiveExts:["zip","rar","7z"],pdfExts:["pdf","tif","tiff"],videoExts:["mp4","webm"],audioExts:["mp3","wav","ogg"],officeExts:["dot","dotm","xlt","pptm","pot","potm","potx","pps","ppsm","vsd","vsdx","dotx"],editInBrowse:["docx","doc","xls","xlsx","ppt","pptx","ppsx","odp","ods","xlsb","xlsm","odt","rtf"],editOnlyInApp:["docm"],wordExts:["odt","docm","dot","dotm","dotx","rtf","doc","docx"],excelExts:["xls","xlt","xlsx","xlsm","ods","xlsb","csv"],txtExts:["txt","plain1251","plain866","py","sql","patch","html","htm","xml","csv","log","xsd","orx","cpp","h","dicx","uax","rlx","trg","cnv","js","json"],_changedCmd:{},_commandsSetting:{print:{name:"print",icon:"sprite:icon-24 icon-Print icon-primary",tooltip:rk("Распечатать"),caption:rk("Распечатать"),isMainAction:false,weight:225,inInline:true,inList:true,inEditMode:true,inMas:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.print",isAvailable:function(){return!i.isMobilePlatform}},copyToBuffer:{name:"copyToBuffer",icon:"sprite:icon-24 icon-Copy icon-primary",tooltip:rk("Скопировать"),caption:rk("Скопировать"),isMainAction:false,weight:206,inInline:true,inList:true,inMas:true,inSingle:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.copyToBuffer",isAvailable:function(e,i){return l(i)&&!e.isEncrypted()&&(i.isDisk||!e.get("folder@"))&&!e._options.noRights}},fullScreen:{name:"fullScreen",icon:"sprite:icon-24 icon-NewTab icon-primary",tooltip:rk("Открыть на весь экран"),caption:rk("Открыть на весь экран"),isMainAction:false,weight:200,weightlist:1,inInline:true,inList:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.fullScreen"},zoomPlus:{name:"zoomPlus",icon:"sprite:icon-24 icon-ZoomIn icon-primary",tooltip:rk("Увеличить масштаб"),caption:rk("Увеличить"),isMainAction:false,inList:false,inInline:true,inEditMode:true,weight:171,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.zoomPlus"},zoomMinus:{name:"zoomMinus",icon:"sprite:icon-24 icon-ZoomOut icon-primary",tooltip:rk("Уменьшить масштаб"),caption:rk("Уменьшить"),isMainAction:false,weight:170,inInline:true,inList:false,inEditMode:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.zoomMinus"},rotateLeft:{name:"rotateLeft",icon:"sprite:icon-24 icon-TurnL icon-primary",tooltip:rk("Повернуть влево"),caption:rk("Повернуть"),isMainAction:false,weight:141,inInline:true,inList:false,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.rotateLeft"},rotateRight:{name:"rotateRight",icon:"sprite:icon-24 icon-TurnR icon-primary",tooltip:rk("Повернуть вправо"),caption:rk("Повернуть"),isMainAction:false,inList:false,inInline:true,weight:142,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.rotateRight",separateFrom:["zoomMinus","imageEdit"]},upload:{name:"upload",icon:"sprite:icon-24 icon-Save icon-primary",tooltip:rk("Скачать"),caption:rk("Скачать"),isMainAction:true,inList:true,inInline:true,inMas:true,inSingle:true,inEditMode:false,weight:202,weightlist:3,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.upload",isAvailable:function(e,i){if(e._options.noRights)return false;if(!l(i)||this._commandsSetting.downloadWithSigns.isAvailable.apply(this,arguments))return false;var n=Boolean(e.get("folder@"));if(i.isArchive)return"mas"!==i.place&&!n;else return true===i.isDisk||!n},linkedButtons:["downloadWithSigns"]},downloadWithSigns:{name:"downloadWithSigns",icon:"sprite:icon-24 icon-Save icon-primary",tooltip:rk("Скачать"),caption:rk("Скачать"),isMainAction:true,inList:true,inInline:true,isMenu:true,inMas:true,inSingle:true,inEditMode:false,weight:202,weightlist:3,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.upload",isAvailable:function(e,i){return e.get("signs")&&e.has("relativeUrlWithSign")&&!e.isEncrypted()&&"mas"!==i.place},items:[{id:"file",title:rk("Файл")},{id:"fileWithSigns",title:rk("Файл и подписи")}]},deleteDoc:{name:"deleteDoc",icon:"sprite:icon-24 icon-Erase icon-error",tooltip:rk("Удалить"),caption:rk("Удалить"),isMainAction:false,weight:205,weightlist:5,inInline:true,inEditMode:false,inList:true,inMas:true,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.deleteDoc"},directLink:{name:"directLink",icon:"sprite:icon-24 icon-Link icon-primary",tooltip:rk("Получить ссылку"),caption:rk("Получить ссылку"),isMainAction:false,weight:203,weightsingle:290,inInline:true,inList:true,inEditMode:false,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.directLink",inDisk:false,isAvailable:function(e,i){return l(i)&&!this._commandsSetting.links.isAvailable.apply(this,arguments)}},saveToPdf:{name:"saveToPdf",icon:"sprite:icon-24 icon-PDF icon-primary",tooltip:rk("Сохранить в PDF"),caption:rk("Сохранить в PDF"),isMainAction:false,weight:210,inInline:true,inList:true,inMas:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.saveToPdf"},rename:{name:"rename",icon:"sprite:icon-24 icon-Rename icon-primary",tooltip:rk("Переименовать"),caption:rk("Переименовать"),isMainAction:false,weight:10,weightlist:60,weightsingle:216,inInline:true,inList:true,inSingle:true,inEditMode:true,typeCmd:"rw",cmdClass:"js!SBIS3.DOCVIEW.rename"},editGroup:{name:"editGroup",icon:"sprite:icon-24 icon-Edit icon-primary",tooltip:rk("Редактировать"),caption:rk("Редактировать"),isMainAction:false,weightlist:34,typeCmd:"w"},edit:{name:"edit",tooltip:rk("в браузере"),caption:rk("в браузере"),parent:"editGroup",isMainAction:false,weight:110,inMas:false,weightlist:35,inInline:true,inList:true,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.edit",separateFrom:["addPage","zoomMinus"]},editPdf:{name:"editPdf",icon:"sprite:icon-24 icon-Edit icon-primary",tooltip:rk("Редактировать PDF-документ"),caption:rk("Редактировать"),isMainAction:false,weight:112,inInline:true,inList:false,inEditMode:false,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.editPdf",separateFrom:["addPage","zoomMinus","redactions"]},editInApp:{name:"editInApp",tooltip:rk("в приложении"),caption:rk("в приложении"),parent:"editGroup",isMainAction:false,weight:111,inMas:false,weightlist:36,inInline:true,inList:true,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.editInApp",separateFrom:["addPage","zoomMinus"]},editOnly:{name:"editOnly",icon:"sprite:icon-24 icon-Edit icon-primary",tooltip:rk("Редактировать в браузере"),caption:rk("Редактировать"),isMainAction:false,weight:110,weightlist:35,inInline:false,inList:true,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.edit"},editInAppOnly:{name:"editInAppOnly",icon:"sprite:icon-24 icon-Edit icon-primary",tooltip:rk("Редактировать в приложении"),caption:rk("Редактировать"),isMainAction:false,weight:111,weightlist:36,inInline:false,inList:true,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.editInApp"},saveChanges:{name:"saveChanges",tooltip:rk("Сохранить"),caption:rk("Сохранить"),isMainAction:false,weight:298,weightlist:35,inInline:false,inList:false,inEditMode:true,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.saveChanges"},signs:{name:"signs",icon:"sprite:icon-24 icon-Signature icon-primary",isMainAction:false,weight:20,inInline:true,inList:false,inEditMode:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.signs"},redactions:{name:"redactions",icon:"sprite:icon-24 icon-ExpandList icon-primary",caption:rk("Редакции и подписи"),tooltip:rk("Редакции и подписи"),isMainAction:false,weight:101,weightlist:20,inInline:true,inList:true,inEditMode:false,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.redactions",separateFrom:["edit","editInApp","rotateLeft","zoomMinus","imageEdit"]},encrypt:{name:"encrypt",icon:"sprite:icon-24 icon-Lock icon-primary",caption:rk("Зашифровать"),tooltip:rk("Зашифровать"),isMainAction:false,weight:209,inInline:true,inList:true,inMas:true,inEditMode:false,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.encrypt"},decrypt:{name:"decrypt",icon:"sprite:icon-24 icon-Unlock icon-primary",caption:rk("Расшифровать"),tooltip:rk("Расшифровать"),isMainAction:false,weight:210,inInline:true,inList:true,inMas:false,inEditMode:false,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.decrypt",isAvailable:function(e,i){return l(i)&&2===e.get("encrypted")}},addPage:{name:"addPage",icon:"",isMainAction:false,weight:120,inInline:true,inList:false,inEditMode:true,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.addPage",separateFrom:["zoomMinus"],isAvailable:function(e,i){var t=e.get("fileName");return this.isEnabled()&&e.get("canEdit")&&"inline"===i.place&&(i.isEdit&&"pdf"===e.getFileExtension()||e.isImage()&&!n._isFileWithExtensions(t,this.notEditableImagesExts)||n._isFileWithExtensions(t,["tif","tiff"]))}},addFromBuffer:{name:"addFromBuffer",icon:"sprite:icon-24 icon-Paste icon-primary",caption:rk("Из буфера обмена"),isMainAction:false,weight:120,inInline:!i.isMobilePlatform,inList:true,inEditMode:true,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.addFromBuffer"},closeFullScreen:{name:"closeFullScreen",icon:"sprite:icon-24 icon-Close icon-disabled",isMainAction:false,weight:299,inInline:true,inList:false,inEditMode:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.closeFullScreen"},closeAttach:{name:"closeAttach",icon:"sprite:icon-24 icon-Close icon-disabled",isMainAction:false,weight:299,inInline:true,inList:false,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.closeAttach"},linkActivated:{name:"linkActivated",isMainAction:false,weight:297,inInline:false,inList:false,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.linkActivated"},rights:{name:"rights",icon:"sprite:icon-24 icon-Groups icon-primary",tooltip:rk("Права доступа"),caption:rk("Права доступа"),isMainAction:true,inList:true,inInline:true,inEditMode:true,inMas:true,inSingle:true,weight:201,weightlist:2,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.rights",inDisk:true,isAvailable:function(e,i){if(!l(i))return false;if(!i.isDisk)return Boolean(e.get("ShareId"));return true}},sendMessage:{name:"sendMessage",icon:"sprite:icon-24 icon-EmptyMessage icon-primary",tooltip:rk("Диалог"),caption:rk("Диалог"),isMainAction:false,inList:true,inInline:true,inEditMode:true,weight:204,weightlist:40,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.sendMessage",inDisk:true},restore:{name:"restore",icon:"sprite:icon-24 icon-Restore icon-primary",tooltip:rk("Восстановить"),caption:rk("Восстановить"),isMainAction:false,weight:4,inInline:false,inList:true,inMas:true,typeCmd:"rw",cmdClass:"js!SBIS3.DOCVIEW.restore",inDisk:true},signDocument:{name:"signDocument",icon:"sprite:icon-24 icon-Signature icon-primary",tooltip:rk("Подписать"),caption:rk("Подписать"),isMainAction:false,weight:208,inInline:true,inList:true,inMas:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.signDocument",isAvailable:function(e,i){return l(i)&&!e.isEncrypted()&&!e.get("link")}},originalImage:{name:"originalImage",tooltip:rk("Оригинал"),caption:rk("Оригинал"),isMainAction:false,weight:172,inList:false,inInline:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.originalImage"},deletePermanentlyDoc:{name:"deletePermanentlyDoc",icon:"sprite:icon-24 icon-Erase icon-error",tooltip:rk("Удалить навсегда"),caption:rk("Удалить навсегда"),isMainAction:false,weight:250,inInline:false,inList:true,inMas:true,typeCmd:"rw",cmdClass:"js!SBIS3.DOCVIEW.deletePermanentlyDoc",inDisk:true},move:{name:"move",icon:"sprite:icon-24 icon-Move icon-primary",tooltip:rk("Переместить"),caption:rk("Переместить"),isMainAction:false,weight:218,inInline:false,inList:true,inMas:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.move"},linksGroup:{name:"linksGroup",icon:"sprite:icon-24 icon-Link icon-primary",tooltip:rk("Ссылки"),caption:rk("Ссылки"),isMainAction:false,inInline:false,inList:false,weightlist:114,typeCmd:"r",inDisk:true},links:{name:"links",caption:rk("Ссылки"),tooltip:rk("Ссылки"),icon:"sprite:icon-24 icon-Link icon-primary",isMainAction:false,weight:203,weightlist:39,inInline:true,inList:true,inSingle:true,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.links",inDisk:true,isAvailable:function(e,i){if(!l(i))return false;if(!i.isDisk)return Boolean(e.get("ShareId"));return true}},imageEdit:{name:"imageEdit",icon:"sprite:icon-24 icon-Edit  icon-primary",tooltip:rk("Редактировать"),caption:rk("Редактировать"),isMainAction:false,weight:151,weightlist:36,inInline:true,inList:true,inMas:false,inEditMode:true,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.imageEdit",separateFrom:["zoomMinus"]},xmlEdit:{name:"xmlEdit",icon:"sprite:icon-24 icon-Edit icon-primary",tooltip:rk("Редактировать"),caption:rk("Редактировать"),isMainAction:false,weight:152,inInline:true,inList:true,inMas:false,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.xmlEdit"},flkErrors:{name:"flkErrors",icon:"sprite:icon-24 icon-Alert icon-attention",tooltip:rk("Ошибки ФЛК"),caption:rk("Ошибки ФЛК"),isMainAction:false,inInline:true,inList:false,weight:20,inMas:false,typeCmd:"r",cmdClass:"js!SBIS3.DOCVIEW.flkErrors",isAvailable:function(e){return Boolean(e.get("countError"))}},scan:{name:"scan",icon:"sprite:icon-24 icon-Scan icon-primary",tooltip:rk("Скан"),caption:rk("Скан"),isMainAction:true,inInline:false,inList:true,weight:20,inMas:false,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.scan"},scanFromFile:{name:"scanFromFile",icon:"sprite:icon-24 icon-ScanSave icon-primary",tooltip:rk("Скан из файла"),caption:rk("Скан из файла"),isMainAction:true,inInline:false,inList:true,weight:20,inMas:false,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.scanFromFile"},attachFromSbisDisk:{name:"attachFromSbisDisk",icon:"sprite:icon-24 icon-Unfavourite icon-primary",tooltip:rk("Из документов"),caption:rk("Из документов"),isMainAction:true,inInline:false,inList:true,weight:20,inMas:false,typeCmd:"w",cmdClass:"js!SBIS3.DOCVIEW.attachFromSbisDisk"},OpenTemplateEditor:{name:"OpenTemplateEditor",icon:"sprite:icon-24 icon-Edit icon-primary",tooltip:"Править форму",caption:"Править форму",isMainAction:false,weight:261,inInline:true,inList:true,inMas:true,typeCmd:"rw",cmdClass:"js!SBIS3.DOCVIEW.OpenTemplateEditor",isDisk:false,isAvailable:function(e){return e._options.printTemplateId||"ПечатнаяФорма"===e.get("typeDoc")||String(e.get("attachId")).indexOf("template")>=0}}},_pushCmdToArray:function(e){for(var i=[],n=0;n<e.length;n++)i.push(this._commandsSetting[e[n]]);return i},sort:function(e,i){var n="weight"+(i||""),t=[];function s(e){return null==e[n]?e.weight:e[n]}for(var o=0;o<e.length;o++)if("undefined"===typeof s(e[o]))t.push(e.splice(o--,1)[0]);return e.sort(function(e,i){return s(e)-s(i)}).concat(t)},_documents:{pdfDocument:{getCmds:function(){return this._pushCmdToArray(["rename","signs","zoomMinus","zoomPlus","print","saveToPdf","upload","downloadWithSigns","editPdf","fullScreen","directLink","deleteDoc","closeFullScreen","closeAttach","redactions","encrypt","rights","saveChanges","copyToBuffer","sendMessage","restore","deletePermanentlyDoc","move","links","linksGroup","signDocument","addPage","OpenTemplateEditor"])}},office:{getCmds:function(){return this._pushCmdToArray(["rename","signs","zoomMinus","zoomPlus","print","upload","downloadWithSigns","fullScreen","directLink","deleteDoc","saveToPdf","closeFullScreen","editInApp","editInAppOnly","closeAttach","redactions","encrypt","rights","copyToBuffer","sendMessage","restore","deletePermanentlyDoc","move","signDocument","links","linksGroup","OpenTemplateEditor"])}},officeEditInBrowse:{getCmds:function(){return this._pushCmdToArray(["rename","signs","zoomMinus","zoomPlus","print","upload","downloadWithSigns","fullScreen","directLink","deleteDoc","saveToPdf","closeFullScreen","edit","editInApp","editOnly","editInAppOnly","encrypt","closeAttach","redactions","rights","copyToBuffer","sendMessage","restore","deletePermanentlyDoc","move","saveChanges","signDocument","links","linksGroup","OpenTemplateEditor"])}},editOnlyInApp:{getCmds:function(){return this._pushCmdToArray(["rename","signs","zoomMinus","zoomPlus","print","upload","downloadWithSigns","fullScreen","directLink","deleteDoc","saveToPdf","closeFullScreen","editInApp","editInAppOnly","encrypt","closeAttach","redactions","rights","copyToBuffer","sendMessage","restore","deletePermanentlyDoc","move","saveChanges","signDocument","links","linksGroup"])}},txt:{getCmds:function(){return this._pushCmdToArray(["rename","signs","zoomMinus","zoomPlus","print","upload","downloadWithSigns","fullScreen","directLink","deleteDoc","saveToPdf","closeFullScreen","closeAttach","redactions","encrypt","rights","copyToBuffer","sendMessage","restore","deletePermanentlyDoc","move","signDocument","links","linksGroup","OpenTemplateEditor"])}},unknown:{getCmds:function(){return this._pushCmdToArray(["rename","signs","upload","downloadWithSigns","deleteDoc","closeFullScreen","closeAttach","directLink","redactions","encrypt","rights","copyToBuffer","sendMessage","restore","deletePermanentlyDoc","move","links","signDocument","linksGroup","fullScreen"])}},img:{getCmds:function(){return this._pushCmdToArray(["rename","signs","zoomMinus","zoomPlus","originalImage","rotateRight","rotateLeft","print","fullScreen","upload","downloadWithSigns","directLink","deleteDoc","saveToPdf","addPage","closeFullScreen","closeAttach","redactions","encrypt","rights","signDocument","copyToBuffer","sendMessage","restore","deletePermanentlyDoc","move","saveChanges","links","linksGroup","imageEdit"])}},format:{getCmds:function(){return this._pushCmdToArray(["rename","signs","upload","downloadWithSigns","deleteDoc","closeFullScreen","print","fullScreen","saveToPdf","closeAttach","redactions","encrypt","directLink","rights","copyToBuffer","sendMessage","restore","deletePermanentlyDoc","move","links","linksGroup","signDocument","flkErrors","xmlEdit","saveChanges","OpenTemplateEditor"])}},encrypted:{getCmds:function(){return this._pushCmdToArray(["decrypt","rename","signs","fullScreen","directLink","deleteDoc","closeFullScreen","closeAttach","copyToBuffer","sendMessage","restore","deletePermanentlyDoc","move","upload","downloadWithSigns","signDocument","rights","links","linksGroup"])}},link:{getCmds:function(){return this._pushCmdToArray(["rename","deleteDoc","upload","downloadWithSigns","rights","copyToBuffer","move","restore","deletePermanentlyDoc","closeFullScreen","linkActivated","fullScreen"])}},folder:{getCmds:function(){return this._pushCmdToArray(["rename","deleteDoc","rights","copyToBuffer","sendMessage","restore","upload","downloadWithSigns","deletePermanentlyDoc","move","links","linksGroup","signDocument"])}},archiveView:{getCmds:function(){return this._pushCmdToArray(["rename","deleteDoc","rights","copyToBuffer","sendMessage","upload","downloadWithSigns","directLink","links","linksGroup","closeFullScreen","closeAttach","signs","encrypt","redactions","restore","deletePermanentlyDoc","move","signDocument"])}},wsImage:{getCmds:function(){return this._pushCmdToArray(["closeFullScreen","fullScreen"])}},wsYoutube:{getCmds:function(){return this._pushCmdToArray(["closeFullScreen"])}},required:{getCmds:function(){return this._pushCmdToArray(["scan","scanFromFile","attachFromSbisDisk","addFromBuffer"])}},notFound:{getCmds:function(){return this._pushCmdToArray(["closeFullScreen"])}}},_helpEvent:function(e,i,t,s,o){t.setResult(n.wrapperDef(this._notify(i,s,o)).addBoth(function(){e.destroy()}))}},setCommandCfg:function(e,i,n){var t=this,s=this._commandsSetting[e],o=["isMainAction","icon","tooltip","caption","weight","weightlist","inList","inInline","inMas","inSingle","isAvailable"];if(this._changedCmd.hasOwnProperty(e)){for(var r in i)if(i.hasOwnProperty(r))this._changedCmd[e][r]=i[r]}else this._changedCmd[e]=i;if(o.forEach(function(e){if("undefined"!==typeof i[e])if(s[e]=i[e],s.linkedButtons)s.linkedButtons.forEach(function(n){t._commandsSetting[n][e]=i[e]})}),!n)this._notify("onChangeCommandsSetting",e,i)},setMultiplyCommandCfg:function(e){var i=false;for(var n in e)if(e.hasOwnProperty(n))this.setCommandCfg(n,e[n],true),i=true;if(i)this._notify("onChangeCommandsSetting")},$constructor:function(){this._publish("onStartCommand","onFinishCommand","onCancelCommand","onErrorCommand","onProcessCommand","onKeyPressIframe","onShowFile","onReadyFile","onChangeCommandsSetting"),this._isAuthenticated=n.isAuthenticated()},_ensureCommandLoaded:function(e){if(!(e.cmdConstructor instanceof s)){var i=r[e.name];if(i instanceof s)return void(e.cmdConstructor=i);var n=e.cmdClass;if(e.cmdConstructor=r[e.name]=new s,!n)e.cmdConstructor.callback();else if("function"===typeof n)e.cmdConstructor.callback(n);else if(require.defined(n))e.cmdConstructor.callback(require(n));else require([n],function(i){e.cmdConstructor.callback(i)},function(e){t.resolve("ILogger").error("Ошибка при загрузке модуля "+n,e)})}},_loadCommandModules:function(e){for(var i=new o,n=0;n<e.length;n++){var t=e[n];this._ensureCommandLoaded(t),i.push(t.cmdConstructor)}return setTimeout(function(){i.done()},0),i.getResult().addCallback(function(){return e})},getCommands:function(e){var i=false,t=this.getDocument(e),s=this._options.mainOptions,o=e.get("Type")&&3===e.get("Type")||e.get("versionForm"),r=o&&-1!==a.indexOf(e.get("typeDoc"));if(!t||!s.commands)return[];var l=[],c=t.getCmds.call(this);c=c.concat(s.userCommands);for(var d=0;d<c.length;d++){var m=false,p=c[d],u=false!==s.commands[p.name];if("editOnly"===p.name)u=false!==s.commands.edit;if("editInAppOnly"===p.name)u=false!==s.commands.editInApp;var f=p.inInline&&"inline"===this._typeCmd,h=p.inList&&"list"===this._typeCmd,g=p.inMas&&"mas"===this._typeCmd,C=p.inSingle&&"single"===this._typeCmd,y=p.inEditMode&&"inline"===this._typeCmd,I=void 0===p.inDisk||p.inDisk===s.isDisk;if(!u)continue;if("function"===typeof p.isAvailable)if(m=p.isAvailable.call(this,e,{command:p,place:this._typeCmd,isDisk:s.isDisk,isFullScreen:this._options.fullScreenMode,isEdit:"edit"===this._options.viewOptions.mode,isArchive:"Archive"===s.objectName}),!m)continue;if(!e.isFolder()&&!e.isLink()&&"rename"===p.name&&(o||e.get("fileName")!==e.get("title"))){m=false;continue}if(o&&"xmlEdit"===p.name&&(f||h))if(!e.get("editable")&&e.get("canEdit")&&this.isEnabled()&&r)m=true;else{m=false;continue}if("edit"!==this._options.viewOptions.mode){if((this.isEnabled()||!!e.get("editable"))&&e.get("canEdit")&&u){if((f||h||g||C)&&I)m=true}else if(u)if(("w"!==p.typeCmd&&f||"r"===p.typeCmd&&h||"r"===p.typeCmd&&g||"r"===p.typeCmd&&C)&&I)m=true;if(e.isRequired()&&("scan"===p.name||"scanFromFile"===p.name||"addFromBuffer"===p.name||"attachFromSbisDisk"===p.name))m=this.isEnabled();if("editPdf"===p.name&&n._isFileWithExtensions(e.get("fileName"),["tif","tiff"]))m=false;if(f&&("closeAttach"===p.name||"closeFullScreen"===p.name))m=this._checkCloseBtn(p,m);if(this._options.viewOptions&&"edit"===this._options.viewOptions.mode&&this._options.viewOptions.justAttach&&("editInApp"===p.name||"edit"===p.name))m=false;if(("zoomMinus"===p.name||"zoomPlus"===p.name)&&(f||h||g))m=n._isFileWithExtensions(e.get("fileName"),this.wordExts.concat(this.imageExts).concat(this.txtExts).concat(this.pdfExts))&&!n._isFileWithExtensions(e.get("fileName"),["html","htm"]);if(("deleteDoc"===p.name||"deletePermanentlyDoc"===p.name)&&this.isEnabled()&&"undefined"!==typeof e.get("canDelete")&&(f||h||g))m=!!e.get("canDelete")}else{if(m=y&&I,"print"===p.name&&"SVRD"!==s.objectName)m=false;if(n._isFileWithExtensions(e.get("fileName"),this.pdfExts)&&("rights"===p.name||"sendMessage"===p.name))m=false;if("zoomMinus"===p.name||"zoomPlus"===p.name)m=-1!==["docx","doc","docm","pdf"].indexOf(e.getFileExtension());if("deleteDoc"===p.name&&"PDF"===s.objectName)m=true}if("signs"===p.name&&!e.get("signs")&&!e.get("idPreviousRedactionSign")&&!e.get("hasPreviousRedactionSign"))m=false;if("edit"===p.name&&n._isFileWithExtensions(e.get("fileName"),this.editInBrowse)){var S=n.checkDeviceSupportOfficeOnline(true);if(!S.word&&n._isFileWithExtensions(e.get("fileName"),["docx","doc","docm"])||!S.excel&&n._isFileWithExtensions(e.get("fileName"),["xls","xlsx"])||!S.powerpoint&&n._isFileWithExtensions(e.get("fileName"),["ppt","pptx"]))m=false}if(("originalImage"===p.name||"imageEdit"===p.name)&&n._isFileWithExtensions(e.get("fileName"),this.notEditableImagesExts))m=false;if("linkActivated"===p.name)this._ensureCommandLoaded(p);if(m&&!i&&("editInApp"===p.name&&-1!==l.indexOf(this._commandsSetting.edit)||"edit"===p.name&&-1!==l.indexOf(this._commandsSetting.editInApp)))i=true,l.push(this._commandsSetting.editGroup);if("encrypt"===p.name&&this._isEncryptionUnavailable(e))m=false;if("imageEdit"===p.name)if(!n._isFileWithExtensions(e.get("fileName"),["jpg","jpeg","bmp","png"])||g)m=false;else if("PDF"===s.objectName)m=true;if(m)this._ensureCommandLoaded(p),l.push(p)}return this.sort(l,this._typeCmd)},_isEncryptionUnavailable:function(e){return 1!==e.get("encrypted")||!this._isAuthenticated||!!e.get("ShareId")},_checkCloseBtn:function(e,i){if(!this._options.fullScreenMode)return false;var n=i;if(window.opener&&this._options.viewOptions.justAttach)n="closeAttach"===e.name?true:"closeFullScreen"===e.name?false:i;else if(!window.opener&&this._options.viewOptions.justAttach)n=false;else if(!this._options.viewOptions.justAttach)n="closeFullScreen"===e.name?true:"closeAttach"===e.name?false:i;return n},setUserCommands:function(e){this._options.mainOptions.userCommands=e},getDocument:function(e){if(!e||e._options.isError)return this._documents.unknown;if(e.get("notFound")||e._options.notFound)return this._documents.notFound;if(e.isRequired())return this._documents.required;if(e.isEncrypted())return this._documents.encrypted;if(e.get("folder@"))return this._documents.folder;if(e.get("versionForm")||3===e.get("Type"))return this._documents.format;var i=n.getFileExtension(e.get("fileName"));if(n._isFileExtensionIn(i,this.archiveExts))return this._documents.archiveView;if("ws-image"===e.get("objectName"))return this._documents.wsImage;else if("ws-youtube"===e.get("objectName"))return this._documents.wsYoutube;if(!i)return this._documents.unknown;else if(n._isFileExtensionIn(i,["lnk","url"]))return this._documents.link;else if(n._isFileExtensionIn(i,this.pdfExts))return this._documents.pdfDocument;else if(n._isFileExtensionIn(i,this.imageExts))return this._documents.img;else if(n._isFileExtensionIn(i,this.editOnlyInApp))return this._documents.editOnlyInApp;else if(n._isFileExtensionIn(i,this.officeExts))return this._documents.office;else if(n._isFileExtensionIn(i,this.editInBrowse))return this._documents.officeEditInBrowse;else if(n._isFileExtensionIn(i,this.txtExts))return this._documents.txt;else return this._documents.unknown},getIframeWindow:function(){return this._getIframeWindow()},startCommand:function(i,n,t){var s=this,o=this._commandsSetting[i];if(!o)if(o=e(this._options.mainOptions.userCommands,function(e){return e.name===i}),!o)return;var r="dynamic_"+o.name,a=this.hasChildControlByName(r);if(!a&&"undefined"!==typeof o.cmdClass)this._ensureCommandLoaded(o),o.cmdConstructor.addCallback(function(e){if(s.isDestroyed())return e;return new e({name:r,mainOptions:s._options.mainOptions,listOptions:s._options.listOptions,viewOptions:s._options.viewOptions,recordSet:s._recordSet,records:n,parent:s,linkedContext:s.getLinkedContext(),handlers:{onStartCommand:function(e,i,n){e.setResult(s._notify("onStartCommand",i,n,t))},onProcessCommand:function(e,i,n){e.setResult(s._notify("onProcessCommand",i,n,t))},onFinishCommand:function(e,i,n){s._helpEvent(this,"onFinishCommand",e,i,n,t)},onErrorCommand:function(e,i,n){s._helpEvent(this,"onErrorCommand",e,i,n)},onCancelCommand:function(e,i,n){s._helpEvent(this,"onCancelCommand",e,i,n)}}}).play(t),e});else if(a){var l=this.getChildControlByName(r);l.setProperty("records",n),l.play(t)}},switchStateOneCommand:function(e,i){try{this._container.find("#"+e).wsControl().setEnabled(i)}catch(e){}},switchVisibleOneCommand:function(e,i){try{this._container.find("#"+e).wsControl().toggle(!i)}catch(e){}}}});
//# sourceMappingURL=CommandsManager.module.js.map
define("tmpl!SBIS3.CONTROLS/ProgressBar/ProgressBar",["Core/tmpl/js/tclosure"],function(){var r=Array.prototype.slice.call(arguments),e=r[0],s={},t=function r(t,o,a,i,n){function l(){}var c=0,d=void 0!==e&&e?e:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};n&&n.isSetts&&(u=n.fullContext||{});var g="string"==typeof a?a:"",p=void 0===s?void 0:s,v={id:[],def:void 0},f=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,t),m=this&&this.includedTemplates?this.includedTemplates:{},S=d.getMarkupGenerator(i);try{var h=S.joinElements([S.createTag("div",{class:"controls-ProgressBar"},[S.createTag("div",{class:"controls-ProgressBar__progress","data-bind":"{         style: {            background-size: progress/backgroundSize         },         html: progress/value      }"},[],{},v,this)],o,v,this)],g,v);v.def&&(h=S.chain(h,v,o),v=void 0)}catch(r){d.templateError("resources/SBIS3.CONTROLS/ProgressBar/ProgressBar.tmpl",r,t)}return h||""};return t.includedFunctions={},t.stable=!0,t.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ProgressBar/ProgressBar"}},t});
//# sourceMappingURL=ProgressBar.tmpl.map
define("SBIS3.CONTROLS/ProgressBar",["SBIS3.CONTROLS/CompoundControl","tmpl!SBIS3.CONTROLS/ProgressBar/ProgressBar","css!SBIS3.CONTROLS/ProgressBar/ProgressBar"],function(s,r){var t=s.extend({_dotTplFn:r,$protected:{_errorText:null,_options:{progress:0,minimum:0,maximum:100,step:1}},init:function(){t.superclass.init.call(this),this.setProgress(this.getProgress())},_modifyOptions:function(s){if(t.superclass._modifyOptions.call(this,s),!/ controls-ProgressBar_align-(left|right) /.test(s.className))s.className+=" controls-ProgressBar_align-center";return s},_checkRanges:function(s){if(s.progress=parseFloat(s.progress),isNaN(s.progress))return this._errorText="Значение прогресса не является числом",false;if(s.progress<s.minimum)return this._errorText="Значение прогресса меньше минимума",false;if(s.maximum<s.minimum)return this._errorText="Значение максимума меньше минимума",false;if(s.progress>s.maximum)return this._errorText="Значение прогресса превышает максимальное значение",false;return true},setProgress:function(s){if(this._options.progress=s,!this._checkRanges(this._options))throw new Error("setProgress. "+this._errorText);this._drawProgress(this._getPercent())},getProgress:function(){return this._options.progress},setMaximum:function(s){this._options.maximum=s,this._drawProgress(this._getPercent())},setMinimum:function(s){this._options.minimum=s,this._drawProgress(this._getPercent())},_getPercent:function(){var s=this._options.progress,r=this._options.minimum,t=this._options.maximum,e=this._options.step,i=t-r;if(s!==i)s=Math.floor(s/e)*e,this._options.progress=s;return Math.round((s-r)/i*100)},_drawProgress:function(s){this.getLinkedContext().setValueSelf("progress",{backgroundSize:s+"% 100%",value:s+"%"})}});return t});
//# sourceMappingURL=ProgressBar.js.map
define("js!SBIS3.DOCVIEW.FileEditor",["Core/core-clone","Core/helpers/Object/isEqual","SBIS3.CONTROLS/CompoundControl","Core/Deferred","Core/ParallelDeferred","Core/Indicator","Core/EventBus","optional!js!SBIS3.Plugin/Source/LocalService","i18n!SBIS3.DOCVIEW.FileEditor"],function(i,t,e,n,o,r,l){"use strict";function s(){this._cache=[]}s.prototype.get=function i(t){var e=this._getItemByOptions(t);return e&&e.plugin||null},s.prototype._getItemByOptions=function i(e){for(var n=0;n<this._cache.length;n++){var o=this._cache[n];if(t(e,o.options))return o}return null},s.prototype._getItemByPlugin=function i(t){for(var e=0;e<this._cache.length;e++){var n=this._cache[e];if(n.plugin===t)return{item:n,index:e}}return null},s.prototype.add=function i(t,e){var n=this._getItemByOptions(t);if(n){if(n.plugin=e,n.counter=1,n.loading)n.loading.callback(e)}else n={options:t,plugin:e,counter:1},this._cache.push(n)},s.prototype.addLoading=function i(t){var e={options:t,loading:new n,counter:0};this._cache.push(e)},s.prototype.getLoading=function i(t){var e=this._getItemByOptions(t);return e&&e.loading||null},s.prototype.remove=function i(t){var e=this._getItemByPlugin(t);if(e)e.item.plugin.destroy(),this._cache.splice(e.index,1)},s.prototype.catchPlugin=function i(t){var e=this._getItemByPlugin(t);if(e)e.item.counter+=1},s.prototype.releasePlugin=function i(t){var e=this._getItemByPlugin(t);if(e)if(e.item.counter>1)e.item.counter-=1;else e.item.plugin.destroy(),this._cache.splice(e.index,1)};var a=new s;function c(i,t){requirejs(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(e){e.showMessageDialog({message:i,status:"error",opener:t})})}var u=e.extend({$protected:{_options:{objectName:"Документ",asyncCreate:false,wopiUrl:null,webdav:null,lock_file_id:"",lock_id:"",ido:"",fileName:"",onlyCheck:false,fileArr:[]},_fileEditorPlugin:null,_pluginOptions:null},$constructor:function(){this._publish("onFinishPlugin","onError","onReadyEditingList","onStartLoad","onChangeDoc")},init:function(){u.superclass.init.call(this);var i=this,t=function(t,e){if(e.ControlId===i.getId()){var n=JSON.parse(e.Message);if(7===n.status)i._notify("onStartLoad");else if(n.status>=0)i._notify("onFinishPlugin",{fileId:n.uuid});else{if(!i._options.onlyCheck)c(n.error_text,i.getTopParent());i._notify("onError",n)}}};if(!this._options.asyncCreate)this._initPlugin().addCallback(function(){if(!i.isDestroyed())if(i.subscribeTo(l.channel("SbisPluginEvent"),"FileEditorChannel",t),i._options.onlyCheck)i.canEditList(i._options.fileArr);else i.editRemoteDocument()})},destroy:function(){u.superclass.destroy.call(this),this.destroyFileEditorPlugin(),this._pluginOptions=null},_getAccountId:function(){var i=new n;return requirejs(["js!SBIS3.Plugin/Source/Helper/Helper"],function(t){i.callback(t.getAccountId())},function(t){i.errback(t)}),i},editRemoteDocument:function(){var i=this;r.setMessage(rk("Открытие")),new o({steps:{plugin:this._getFileEditorPlugin(),accountId:this._getAccountId()}}).done().getResult().addCallback(function(t){var e=window.location.protocol+"//"+window.location.host,n=window.location.protocol+"//office-"+window.location.host;t.plugin.call("EditDocumentWebdav",{uuid:String(i._options.ido),docName:i._options.fileName,methodRead:"ReadAttachment",readParams:'{"ИдО":"'+i._options.ido+'"}',methodWrite:"WriteAttachment",writeParams:'{"ИдО":"'+i._options.ido+'", "НоваяСессияРедактирования":"true"}',editorParamsJson:{url:e+"/service/",AccountID:t.accountId,webdav_url:n+"/webdav/service/",wopi_url:e+"/wopi/service/",bl_object:i._options.objectName,control_id:i.getId(),lock_file_id:i._options.lock_file_id,lock_id:i._options.lock_id,event_bus_channel:"FileEditorChannel"}}).addCallback(function(t){if(r.hide(),t=JSON.parse(t),t.status<0)c(t.error_text,i.getTopParent()),i._notify("onError",t);else require(["Lib/ServerEvent/Bus"],function(t){i.subscribeTo(t.serverChannel("webdav.documentchanged"),"onMessage",function(t,e){if(e===i._options.lock_file_id)i._notify("onChangeDoc")})})}).addErrback(function(t){r.hide(),c(t.message,i.getTopParent()),i._notify("onError",{})})}).addErrback(function(){r.hide()})},destroyFileEditorPlugin:function(){if(this._fileEditorPlugin)a.releasePlugin(this._fileEditorPlugin),this._fileEditorPlugin=null},_loadFileEditorPlugin:function(t){var e=new n;return require(["js!SBIS3.Plugin/Source/LocalService"],function(n){var o=new n({endpoint:{address:"FileEditor-2.0.1.7",contract:"FileEditor"},options:i(t)});o.isReady().addCallback(function(){e.callback(o)}).addErrback(function(i){e.errback(i)})},function(){e.errback()}),e},_getFileEditorPlugin:function(i,t){var e=new n,o=this;if(this._fileEditorPlugin&&this._fileEditorPlugin.getState()!==this._fileEditorPlugin.readyState.OPEN)this.destroyFileEditorPlugin();if(this._fileEditorPlugin&&!i)return e.callback(o._fileEditorPlugin),e;var r=a.get(i);if(r)if(r.getState()!==r.readyState.OPEN)a.remove(r),r=null;else if(!this._fileEditorPlugin){if(i)this._pluginOptions=i;this._fileEditorPlugin=r,a.catchPlugin(r)}if(this._fileEditorPlugin)if(r===this._fileEditorPlugin)return e.callback(o._fileEditorPlugin),e;else this.destroyFileEditorPlugin(),this._fileEditorPlugin=r,this._pluginOptions=i;if(this._fileEditorPlugin)a.catchPlugin(this._fileEditorPlugin);else{if(i)this._pluginOptions=i;var l=a.getLoading(this._pluginOptions);if(l)return l.createDependent().addCallback(function(i){if(!o.isDestroyed())a.catchPlugin(i);return i});else a.addLoading(this._pluginOptions);this._loadFileEditorPlugin(this._pluginOptions).addCallback(function(t){a.add(i||o._pluginOptions,t),e.callback(o._fileEditorPlugin=t)}).addErrback(function(i){if(!t&&!o._options.onlyCheck&&i&&i.message!==rk("Не удается подключиться к хосту"))c(i.message,o.getTopParent());a.getLoading(o._pluginOptions).errback(i),e.errback(i)})}return e},_initPlugin:function(){var i=this,t={mode:this._options.onlyCheck?"silent":"runOnce"},e=new n;if(!this._options.onlyCheck)r.setMessage(rk("Открытие"));return this._getFileEditorPlugin(t,true).addCallbacks(function(i){e.callback(i)},function(t){if(!i._options.onlyCheck){if(t&&t.message!==rk("Не удается подключиться к хосту"))c(t.message,i.getTopParent());r.hide()}return t}),e},canEditList:function(i){return this._getFileEditorPlugin().addCallback(function(t){return t.call("CanEditList",{extensions:i.join(", ")})})},canEditListAsync:function(i){return this._initPlugin().addCallback(function(t){if(t)return t.call("CanEditList",{extensions:i.join(", ")})})}});return u});
//# sourceMappingURL=FileEditor.module.js.map
define("js!SBIS3.DOCVIEW.CheckEditingMixin",["js!SBIS3.DOCVIEW.FileEditor","js!SBIS3.DOCVIEW.Funcs","Core/Deferred","Core/ParallelDeferred"],function(t,e,n,i){"use strict";var r={};function o(t){var e=(new n).addCallbacks(function e(n){r[t]=n},function e(){r[t]=false});return r[t]=e}function c(t,e){var i=r[t];if(i instanceof n)i.callback(e);else r[t]=e}function f(t){for(var n=[],i,r,o=0;o<t.getCount();o++)if(r=t.at(o),r.get("canEdit"))if(i=e.getFileExtension(r.get("fileName")),i)n.push(i);return n}return{$constructor:function(){this.once("onDestroy",function(){this._fileEditor=null})},_getFileEditor:function(){if(!this._fileEditor)this._fileEditor=new t({parent:this,asyncCreate:true,objectName:this._options.mainOptions.objectName,ido:"",fileName:"",fileArr:[],onlyCheck:true});return this._fileEditor},_startPluginForCheck:function(t){if(!t||0===t.length)return n.success();var e=this._getFileEditor();return e.canEditListAsync(t).addCallback(function(t){try{for(var n=JSON.parse(t),i=0;i<n.length;i++)c(n[i].ext,n[i].can_edit)}catch(t){return t}finally{if(e.isDestroyed())e.destroyFileEditorPlugin()}}).addErrback(function(){for(var e=0;e<t.length;e++)c(t[e],false)})},_checkEditingArr:function(t){for(var e=f(t),c=[],s=new i,u,a,l=0;l<e.length;l++)if(u=e[l],a=r[u],a instanceof n)s.push(a);else if(void 0===a)s.push(o(u)),c.push(u);if(c.length)this._startPluginForCheck(c);return s.done().getResult()},canEditInApp:function(t){return true===r[t]},getEditInAppChecking:function(t){return r[t]},_getTestedArray:function(){return Object.keys(r).filter(function(t){return"boolean"===typeof r[t]})}}});
//# sourceMappingURL=CheckEditingMixin.module.js.map
define("tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/TreeCompositeItemsTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,n,a,l){function s(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var u="string"==typeof n?n:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),C=this&&this.includedTemplates?this.includedTemplates:{},S=c.getMarkupGenerator(a);try{var T=S.joinElements([S.createTag("div",{class:"controls-CompositeView__foldersContainer "+c.wrapUndef(c.utils.escape("tile"===c.getter(o,["tplData","viewMode"])&&"dynamic"===c.getter(o,["tplData","tileMode"])?"controls-CompositeView-tile__static":""))},[S.createControl("resolver",c.getter(o,["tplData","drawFolders"]),c.uniteScope(c.utils.escape(c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},n,m,C,c.config,d,v)],i,v,this),S.createControl("resolver",c.getter(o,["tplData","drawLeafs"]),c.uniteScope(c.utils.escape(c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},n,m,C,c.config,d,v)],u,v);v.def&&(T=S.chain(T,v,i),v=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Tree/CompositeView/resources/TreeCompositeItemsTemplate.tmpl",e,o)}return T||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/TreeCompositeItemsTemplate"}},o});
//# sourceMappingURL=TreeCompositeItemsTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/StaticFolderContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={},r=function e(r,i,s,l,a){function c(){}var n=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var u="string"==typeof s?s:"",m=void 0===o?void 0:o,h={id:[],def:void 0},g=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),v=this&&this.includedTemplates?this.includedTemplates:{},C=p.getMarkupGenerator(l);try{var w=C.joinElements([C.createTag("div",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox "+p.wrapUndef(p.utils.escape(p.getter(r,["_options","showCheckboxes"])?" controls-ListView__itemCheckBox__showAlways":""))+" "+p.wrapUndef(p.utils.escape(p.getter(r,["_options","showCheckboxes"])||p.getter(r,["_options","hideCheckboxes"])?"":" controls-ListView__itemCheckBox__showByHover"))},[],i,h,this),C.createTag("span",{class:"controls-CompositeView__folderIcon icon-32 icon-Folder icon-disabled"},[],i,h,this),C.createTag("div",{class:"controls-CompositeView__tileTitle",style:""+p.wrapUndef(p.utils.escape(p.getter(r,["decorators","apply"]).apply(p.getter(r,["decorators"]),[p.getter(r,["color"]),"color"])))},[C.createText(""+p.wrapUndef(p.Sanitize.apply(void 0,[p.getDecorators().sanitize.apply(void 0,[p.getter(r,["decorators","apply"]).apply(p.getter(r,["decorators"]),[p.getter(r,["item","get"]).apply(p.getter(r,["item"]),[p.getter(r,["displayProperty"])])])])])))],i,h,this)],u,h);h.def&&(w=C.chain(w,h,i),h=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Tree/CompositeView/resources/StaticFolderContentTemplate.tmpl",e,r)}return w||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/StaticFolderContentTemplate"}},r});
//# sourceMappingURL=StaticFolderContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/ListFolderTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,s,l,n){function a(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var m="string"==typeof s?s:"",u=void 0===r?void 0:r,v={id:[],def:void 0},f=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},y=p.getMarkupGenerator(l);try{var w=y.joinElements([y.createTag("div",{class:"controls-ListView__item-type-node controls-CompositeView__listItem js-controls-CompositeView__verticalItemActions controls-CompositeView__verticalItemActions controls-ListView__item js-controls-ListView__item "+p.wrapUndef(p.utils.escape(p.getDecorators().orEmpty.apply(void 0,[p.getter(o,["className"])]))),"data-hash":""+p.wrapUndef(p.utils.escape(p.getter(o,["projItem","getHash"]).apply(p.getter(o,["projItem"]),[]))),"data-id":""+p.wrapUndef(p.utils.escape(p.getter(o,["item","getId"]).apply(p.getter(o,["item"]),[])+""))},[y.createControl("resolver",p.getter(o,["listFolderContent"]),p.uniteScope(p.utils.escape(p.uniteScope(o,{parent:void 0,element:void 0})(p.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},s,u,g,p.config,d,v)],i,v,this)],m,v);v.def&&(w=y.chain(w,v,i),v=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Tree/CompositeView/resources/ListFolderTemplate.tmpl",e,o)}return w||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/ListFolderTemplate"}},o});
//# sourceMappingURL=ListFolderTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/FolderTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,s,l,a){function n(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var m="string"==typeof s?s:"",u=void 0===r?void 0:r,v={id:[],def:void 0},f=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},w=p.getMarkupGenerator(l);try{var C=w.joinElements([w.createTag("div",{class:"controls-ListView__item-type-node controls-CompositeView__tileItem "+p.wrapUndef(p.utils.escape(p.getter(o,["tileMode"])?"":"js-controls-CompositeView__verticalItemActions controls-CompositeView__verticalItemActions"))+" controls-ListView__item js-controls-ListView__item "+p.wrapUndef(p.utils.escape(p.getDecorators().orEmpty.apply(void 0,[p.getter(o,["className"])]))),"data-hash":""+p.wrapUndef(p.utils.escape(p.getter(o,["projItem","getHash"]).apply(p.getter(o,["projItem"]),[]))),"data-id":""+p.wrapUndef(p.utils.escape(p.getter(o,["item","getId"]).apply(p.getter(o,["item"]),[])+""))},[w.createTag("div",{class:"controls-CompositeView__tileContainer"},[w.createControl("resolver",p.getter(o,["folderContent"]),p.uniteScope(p.utils.escape(p.uniteScope(o,{parent:void 0,element:void 0})(p.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},s,u,g,p.config,d,v)],{},v,this)],i,v,this)],m,v);v.def&&(C=w.chain(C,v,i),v=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Tree/CompositeView/resources/FolderTemplate.tmpl",e,o)}return C||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/FolderTemplate"}},o});
//# sourceMappingURL=FolderTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/FolderContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,s,l,c){function a(){}var n=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};c&&c.isSetts&&(d=c.fullContext||{});var g="string"==typeof s?s:"",m=void 0===r?void 0:r,u={id:[],def:void 0},w=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),_=this&&this.includedTemplates?this.includedTemplates:{},h=p.getMarkupGenerator(l);try{var T=h.joinElements([h.createTag("div",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox "+p.wrapUndef(p.utils.escape(p.getter(o,["_options","showCheckboxes"])?" controls-ListView__itemCheckBox__showAlways":""))+" "+p.wrapUndef(p.utils.escape(p.getter(o,["_options","showCheckboxes"])||p.getter(o,["_options","hideCheckboxes"])?"":" controls-ListView__itemCheckBox__showByHover"))},[],i,u,this),h.createTag("div",{class:"controls-CompositeView__tileImg-container"},[h.createTag("img",{class:"controls-CompositeView__tileImg",src:""+p.wrapUndef(p.utils.escape(p.getter(o,["item","get"]).apply(p.getter(o,["item"]),[p.getter(o,["image"])])?p.getter(o,["item","get"]).apply(p.getter(o,["item"]),[p.getter(o,["image"])]):"/resources/SBIS3.CONTROLS/themes/online/img/defaultFolder.v1516270649826335cf4508dd597be4bfc9caa3e08b901.png"))},[],{},u,this)],i,u,this),h.createTag("div",{class:"controls-CompositeView__tileTitle"},[h.createTag("div",{class:"controls-CompositeView__tileTitle-text",style:""+p.wrapUndef(p.utils.escape(p.getter(o,["decorators","apply"]).apply(p.getter(o,["decorators"]),[p.getter(o,["color"]),"color"])))},[h.createText(" "+p.wrapUndef(p.utils.escape(p.getter(o,["decorators","apply"]).apply(p.getter(o,["decorators"]),[p.getter(o,["item","get"]).apply(p.getter(o,["item"]),[p.getter(o,["description"])])])))+" "),h.createTag("div",{class:"controls-TreeView__editArrow js-controls-TreeView__editArrow"},[],{},u,this)],{},u,this),h.createTag("div",{class:"controls-TreeView__editArrow controls-TreeView__editArrow-overflow js-controls-TreeView__editArrow"},[],{},u,this)],i,u,this)],g,u);u.def&&(T=h.chain(T,u,i),u=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Tree/CompositeView/resources/FolderContentTemplate.tmpl",e,o)}return T||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/FolderContentTemplate"}},o});
//# sourceMappingURL=FolderContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/CompositeView__folderTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,o,s,l,c){function a(){}var n=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};c&&c.isSetts&&(d=c.fullContext||{});var m="string"==typeof s?s:"",g=void 0===r?void 0:r,u={id:[],def:void 0},f=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),v=this&&this.includedTemplates?this.includedTemplates:{},_=p.getMarkupGenerator(l);try{var C=_.joinElements([_.createTag("div",{class:"js-controls-CompositeView__verticalItemActions controls-CompositeView__verticalItemActions"},[_.createTag("div",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox"},[],{},u,this),_.createTag("div",{class:"controls-CompositeView__tileImg-container"},[_.createTag("img",{class:"controls-CompositeView__tileImg",src:""+p.wrapUndef(p.utils.escape(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),[p.getter(i,["image"])])?p.getter(i,["item","get"]).apply(p.getter(i,["item"]),[p.getter(i,["image"])]):"/resources/SBIS3.CONTROLS/themes/online/img/defaultFolder.v1516270649826335cf4508dd597be4bfc9caa3e08b901.png"))},[],{},u,this)],{},u,this),_.createTag("div",{class:"controls-CompositeView__tileTitle",style:""+p.wrapUndef(p.utils.escape(p.getter(i,["decorators","apply"]).apply(p.getter(i,["decorators"]),[p.getter(i,["color"]),"color"])))},[_.createText(""+p.wrapUndef(p.utils.escape(p.getter(i,["decorators","apply"]).apply(p.getter(i,["decorators"]),[p.getter(i,["item","get"]).apply(p.getter(i,["item"]),[p.getter(i,["description"])])]))))],{},u,this)],o,u,this)],m,u);u.def&&(C=_.chain(C,u,o),u=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Tree/CompositeView/resources/CompositeView__folderTpl.tmpl",e,i)}return C||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/CompositeView__folderTpl"}},i});
//# sourceMappingURL=CompositeView__folderTpl.tmpl.map
define("SBIS3.CONTROLS/Utils/TemplateUtil",["Core/js-template-doT"],function(){return{prepareTemplate:function(e){var t;if(e&&e.toString&&e.saveToValue)e=e.toString();switch(typeof e){case"string":t=0===e.indexOf("html!")||0===e.indexOf("tmpl!")||global.requirejs.defined(e)?global.requirejs(e):doT.template(e);break;case"function":t=e;break;case"undefined":t=void 0;break;case"object":if("[object Array]"===Object.prototype.toString.call(e))t=function t(){var r=Array.prototype.slice.call(arguments);return e.reduce(function e(t,n){return t+n.apply(this,r)},"")};else t=null;break;default:t=null}return t}}});
//# sourceMappingURL=TemplateUtil.js.map
define("tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/searchRender",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/BreadCrumbs"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={};t["js!SBIS3.CONTROLS/BreadCrumbs"]=e[1];var i=function e(i,l,a,o,n){function s(){}var d=0,c=void 0!==r&&r?r:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};n&&n.isSetts&&(u=n.fullContext||{});var g="string"==typeof a?a:"",p=void 0===t?void 0:t,C={id:[],def:void 0},m=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),h=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(o);try{var f=v.joinElements([v.createTag("td",{class:"controls-DataGridView__td controls-DataGridView__firstContentCell",colspan:""+c.wrapUndef(c.utils.escape(c.getter(i,["viewCfg","colspan"])))},[v.createControl("wsControl","ws:SBIS3.CONTROLS/BreadCrumbs",{items:c.getter(i,["path"]),itemTpl:c.getter(i,["bcTpls","itemTpl"]),itemContentTpl:c.getter(i,["bcTpls","itemContentTpl"]),highlightEnabled:c.getter(i,["viewCfg","highlightEnabled"]),highlightText:c.getter(i,["viewCfg","highlightText"]),colorMarkEnabled:c.getter(i,["viewCfg","colorMarkEnabled"]),colorField:c.getter(i,["viewCfg","colorField"]),enabled:c.getter(i,["viewCfg","allowEnterToFolder"])||!!c.getter(i,["viewCfg","task1173671799"]),idProperty:c.getter(i,["viewCfg","idProperty"]),displayProperty:c.getter(i,["viewCfg","displayProperty"]),activableByClick:!1,allowChangeEnable:!1,command:"BreadCrumbsItemClick"},{class:"controls-BreadCrumbs__smallItems controls-BreadCrumbs__home-hide controls-TreeView__searchBreadCrumbs"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},a,p,h,c.config,u)],l,C,this)],g,C);C.def&&(f=v.chain(f,C,l),C=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Tree/DataGridView/resources/searchRender.tmpl",e,i)}return f||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/searchRender"}},i});
//# sourceMappingURL=searchRender.tmpl.map
define("tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/ItemTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,a,i,l,n){function p(){}var s=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var g="string"==typeof i?i:"",m=void 0===r?void 0:r,u={id:[],def:void 0},h=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),v=this&&this.includedTemplates?this.includedTemplates:{},_=c.getMarkupGenerator(l);try{var w=_.joinElements([_.createTag("tr",{class:""+c.wrapUndef(c.utils.escape(c.getter(c.getter(o,["getItemTemplateData"]).apply(o,[c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)]),["addClasses"])))+c.wrapUndef(c.utils.escape(c.getter(o,["drawHiddenGroup"])?" ws-hidden":""))+" "+c.wrapUndef(c.utils.escape(c.getter(o,["_options","itemsHover"])?" controls-ListView__item__withHover":" controls-ListView__item__withoutHover")),style:""+c.wrapUndef(c.utils.escape(c.getter(o,["decorators","apply"]).apply(c.getter(o,["decorators"]),[c.getter(o,["colorField"])?c.getter(o,["item","get"]).apply(c.getter(o,["item"]),[c.getter(o,["colorField"])]):"","color"]))),"data-parent-hash":""+c.wrapUndef(c.utils.escape(c.getter(o,["projItem","getParent"]).apply(c.getter(o,["projItem"]),[])?c.getter(c.getter(o,["projItem","getParent"]).apply(c.getter(o,["projItem"]),[]),["getHash"]).apply(c.getter(o,["projItem","getParent"]).apply(c.getter(o,["projItem"]),[]),[]):"")),"data-hash":""+c.wrapUndef(c.utils.escape(c.getter(o,["projItem","getHash"]).apply(c.getter(o,["projItem"]),[]))),"data-id":""+c.wrapUndef(c.utils.escape(c.getter(o,["item","getId"]).apply(c.getter(o,["item"]),[])+""))},[c.getter(o,["multiselect"])?[_.createTag("td",{class:"controls-DataGridView__td controls-DataGridView__td__checkBox "+c.wrapUndef(c.utils.escape(void 0!==c.getter(o,["startScrollColumn"])?0===c.getter(o,["startScrollColumn"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":""))},[_.createTag("span",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox "+c.wrapUndef(c.utils.escape(c.getter(o,["_options","showCheckboxes"])?" controls-ListView__itemCheckBox__showAlways":""))+" "+c.wrapUndef(c.utils.escape(c.getter(o,["_options","showCheckboxes"])||c.getter(o,["_options","hideCheckboxes"])?"":" controls-ListView__itemCheckBox__showByHover"))},[],{},u,this)],{},u,this)]:_.createText(""),_.createControl("resolver",c.getter(o,["itemContent"]),c.uniteScope(c.utils.escape(c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)),{itemLevel:c.getter(c.getter(o,["getItemContentTplData"]).apply(o,[c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)]),["itemLevel"]),hierField_d:c.getter(c.getter(o,["getItemContentTplData"]).apply(o,[c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)]),["hierField$"]),hasScroll:c.getter(c.getter(o,["getItemContentTplData"]).apply(o,[c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)]),["hasScroll"]),isNode:c.getter(c.getter(o,["getItemContentTplData"]).apply(o,[c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)]),["isNode"]),hasChilds:c.getter(c.getter(o,["getItemContentTplData"]).apply(o,[c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)]),["hasChilds"])}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},i,m,v,c.config,d,u)],a,u,this)],g,u);u.def&&(w=_.chain(w,u,a),u=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Tree/DataGridView/resources/ItemTemplate.tmpl",e,o)}return w||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/ItemTemplate"}},o});
//# sourceMappingURL=ItemTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/ItemContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,o,l,a,n){function c(){}var s=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};n&&n.isSetts&&(p=n.fullContext||{});var g="string"==typeof l?l:"",u=void 0===r?void 0:r,m={id:[],def:void 0},v=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},_=d.getMarkupGenerator(a);try{var T=_.joinElements([function(){for(var e=void 0,t=0;t<d.iterators.length&&!e;t++)d.iterators[t].is(d.utils.escape(d.getter(i,["columns"])))&&(e=d.iterators[t].iterator);var r=[];return function(){var t=d.createScope(i);if(i=t,e){var o=l,n=0;e(d.utils.escape(d.getter(i,["columns"])),function(e,t){d.presetScope(e,i,t,{key:"index",value:"column"}),l&&void 0!==a&&a&&(l=o+"-for_"+n,n++);var c=[!d.getter(i,["foldersColspan"])||!d.getter(i,["isNode"])||d.getter(i,["isNode"])&&d.getter(i,["index"])<1?[_.createTag("td",{colspan:""+d.wrapUndef(d.utils.escape(d.getter(i,["foldersColspan"])&&d.getter(i,["isNode"])?d.getter(i,["columns","length"]):"")),class:"controls-DataGridView__td "+d.wrapUndef(d.utils.escape(d.getter(i,["column","editor"])?"controls-DataGridView__edited-td":""))+" "+d.wrapUndef(d.utils.escape(d.getDecorators().orEmpty.apply(void 0,[d.getter(i,["column","className"])])))+" "+d.wrapUndef(d.utils.escape(d.getter(i,["hasScroll"])?d.getter(i,["startScrollColumn"])<=d.getter(i,["index"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":""))+" "+d.wrapUndef(d.utils.escape(d.getter(i,["index"])+1===d.getter(i,["columns","length"])?"controls-DataGridView__lastContentCell":""))+" "+d.wrapUndef(d.utils.escape(0==d.getter(i,["index"])?"controls-DataGridView__firstContentCell":""))+" "+d.wrapUndef(d.utils.escape(d.getter(i,["hoveredColumn","columnIndex"])===d.getter(i,["index"])?"controls-DataGridView__hoveredColumn__cell":"")),style:""+d.wrapUndef(d.utils.escape(d.getter(i,["startScrollColumn"])<=d.getter(i,["index"])?"transform:translateX("+d.getter(i,["columnsShift"])+"px);":""))},[0==d.getter(i,["index"])?[_.createTag("div",{class:"controls-TreeDataGridView__levelPaddingWrap"},[d.getter(i,["isSearch"])?d.getter(i,["projItem","getLevel"]).apply(d.getter(i,["projItem"]),[])>1?[_.createTag("div",{class:"controls-TreeDataGridView__levelPadding"},[_.createText(""+global.rk("&nbsp;"))],{},m,this)]:_.createText(""):[function(){for(var e=void 0,t=0;t<d.iterators.length&&!e;t++)d.iterators[t].is(d.utils.escape(d.getter(i,["itemLevel"])))&&(e=d.iterators[t].iterator);var r=[];return function(){var t=d.createScope(i);if(i=t,e){var o=l,n=0;e(d.utils.escape(d.getter(i,["itemLevel"])),function(e,t){d.presetScope(e,i,t,{value:"i"}),l&&void 0!==a&&a&&(l=o+"-for_"+n,n++);var c=[_.createTag("div",{class:"controls-TreeDataGridView__levelPadding"},[_.createText(""+global.rk("&nbsp;"))],{},m,this)];void 0===c[0]&&void 0!==a&&a||(r=r.concat(c))}.bind(i))}else r=""}.call(i),r}()],_.createTag("div",{class:"lvl"+d.wrapUndef(d.utils.escape(d.getter(i,["projItem","getLevel"]).apply(d.getter(i,["projItem"]),[])))+" controls-TreeView__expand js-controls-TreeView__expand "+d.wrapUndef(d.utils.escape(d.getter(i,["projItem","isExpanded"]).apply(d.getter(i,["projItem"]),[])?"controls-TreeView__expand__open":""))+" "+d.wrapUndef(d.utils.escape(null===d.getter(i,["isNode"])||!1===d.getter(i,["isNode"])&&!1===d.getter(i,["hierField_d"])&&!d.getter(i,["hasChilds"])||"folders"===d.getter(i,["displayType"])&&!1===d.getter(i,["hierField_d"])&&!d.getter(i,["hasChilds"])?"controls-TreeView__expand__leaf":"has-child"))},[],{},m,this),d.getter(i,["projItem","isNode"]).apply(d.getter(i,["projItem"]),[])?[d.getter(i,["arrowActivatedHandler"])||d.getter(i,["editArrow"])&&"custom"!==d.getter(i,["editArrow"])?[_.createTag("div",{class:"controls-TreeView__ellipsis-wrapper"},[_.createTag("div",{class:"controls-TreeView__ellipsis-container"},[_.createTag("div",{class:"controls-TreeView__folderTitle"},[_.createControl("resolver",d.getter(i,["column","contentTpl"]),d.uniteScope(d.utils.escape(d.getter(i,["cellData"])),{item:d.getter(i,["item"]),projItem:d.getter(i,["projItem"]),field:d.getter(i,["column","field"]),column:d.getter(i,["column"]),included:d.getter(i,["column","included"]),templateBinding:d.getter(i,["column","templateBinding"]),decorators:d.getter(i,["decorators"]),isNode:d.getter(i,["isNode"]),Sanitize:d.getter(i,["Sanitize"])}),{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},l,u,f,d.config,p,m)],{},m,this),_.createTag("div",{class:"controls-TreeView__editArrow"},[],{},m,this)],{},m,this),_.createTag("div",{class:"controls-TreeView__ellipsis-copyArrow"},[_.createTag("div",{class:"controls-TreeView__editArrow"},[],{},m,this)],{},m,this)],{},m,this)]:[_.createTag("div",{class:"controls-TreeView__folderTitle"},[_.createControl("resolver",d.getter(i,["column","contentTpl"]),d.uniteScope(d.utils.escape(d.getter(i,["cellData"])),{item:d.getter(i,["item"]),projItem:d.getter(i,["projItem"]),field:d.getter(i,["column","field"]),column:d.getter(i,["column"]),included:d.getter(i,["column","included"]),templateBinding:d.getter(i,["column","templateBinding"]),decorators:d.getter(i,["decorators"]),isNode:d.getter(i,["isNode"]),Sanitize:d.getter(i,["Sanitize"])}),{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},l,u,f,d.config,p,m)],{},m,this)]]:[_.createTag("div",{class:"controls-DataGridView__columnValue"},[_.createControl("resolver",d.getter(i,["column","contentTpl"]),d.uniteScope(d.utils.escape(d.getter(i,["cellData"])),{item:d.getter(i,["item"]),projItem:d.getter(i,["projItem"]),field:d.getter(i,["column","field"]),column:d.getter(i,["column"]),included:d.getter(i,["column","included"]),templateBinding:d.getter(i,["column","templateBinding"]),decorators:d.getter(i,["decorators"]),isNode:d.getter(i,["isNode"]),Sanitize:d.getter(i,["Sanitize"])}),{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},l,u,f,d.config,p,m)],{},m,this)]],{},m,this)]:[_.createTag("div",{class:"controls-DataGridView__columnValue"},[_.createControl("resolver",d.getter(i,["column","contentTpl"]),d.uniteScope(d.utils.escape(d.getter(i,["cellData"])),{item:d.getter(i,["item"]),projItem:d.getter(i,["projItem"]),field:d.getter(i,["column","field"]),column:d.getter(i,["column"]),included:d.getter(i,["column","included"]),templateBinding:d.getter(i,["column","templateBinding"]),decorators:d.getter(i,["decorators"]),isNode:d.getter(i,["isNode"]),Sanitize:d.getter(i,["Sanitize"])}),{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},l,u,f,d.config,p,m)],{},m,this)]],{},m,this)]:_.createText("")];void 0===c[0]&&void 0!==a&&a||(r=r.concat(c))}.bind(i))}else r=""}.call(i),r}()],g,m);m.def&&(T=_.chain(T,m,o),m=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/Tree/DataGridView/resources/ItemContentTemplate.tmpl",e,i)}return T||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/ItemContentTemplate"}},i});
//# sourceMappingURL=ItemContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/FooterWrapperTemplate",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Link"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Link"]=e[1];var o=function e(o,a,i,l,n){function s(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};n&&n.isSetts&&(p=n.fullContext||{});var u="string"==typeof i?i:"",v=void 0===r?void 0:r,T={id:[],def:void 0},f=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},m=d.getMarkupGenerator(l);try{var S=m.joinElements([m.createTag("tr",{class:"controls-DataGridView__tr controls-TreeDataGridView__folderFooter","data-parent":""+d.wrapUndef(d.utils.escape(d.getter(o,["key"])))},[d.getter(o,["multiselect"])?[m.createTag("td",{},[],{},T,this)]:m.createText(""),m.createTag("td",{class:"controls-TreeDataGridView__folderFooter-td"+d.wrapUndef(d.utils.escape(d.getter(o,["footerTpl"])?" controls-TreeDataGridView__folderFooter-separator":"")),colspan:""+d.wrapUndef(d.utils.escape(d.getter(o,["colspan"])))},[m.createTag("div",{class:"controls-TreeView__folderFooterContainer"},[m.createTag("div",{class:"controls-TreeDataGridView__levelPaddingWrap"},[function(){for(var e=void 0,t=0;t<d.iterators.length&&!e;t++)d.iterators[t].is(d.utils.escape(d.getter(o,["level"])+1))&&(e=d.iterators[t].iterator);var r=[];return function(){var t=d.createScope(o);if(o=t,e){var a=i,n=0;e(d.utils.escape(d.getter(o,["level"])+1),function(e,t){d.presetScope(e,o,t,{value:"i"}),i&&void 0!==l&&l&&(i=a+"-for_"+n,n++);var s=[m.createTag("div",{class:"controls-TreeDataGridView__levelPadding"},[m.createText(""+global.rk("&nbsp;"))],{},T,this)];void 0===s[0]&&void 0!==l&&l||(r=r.concat(s))}.bind(o))}else r=""}.call(o),r}(),d.getter(o,["footerTpl"])?[m.createTag("div",{class:"controls-TreeDataGridView__folderFooterTmpl"},[m.createControl("resolver",d.getter(o,["footerTpl"]),d.uniteScope(d.utils.escape(d.uniteScope(o,{parent:void 0,element:void 0})(d.plainMerge)),{item:d.getter(o,["item"]),projItem:d.getter(o,["projItem"])}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},i,v,g,d.config,p,T)],{},T,this)]:m.createText(""),d.getter(o,["pagerOptions"])?[m.createControl("wsControl","ws:SBIS3.CONTROLS/Link",d.uniteScope(d.utils.escape(d.getter(o,["pagerOptions"])),{allowChangeEnable:!1}),{class:"controls-TreePager"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},i,v,g,d.config,p)]:m.createText("")],{},T,this)],{},T,this)],{},T,this)],a,T,this)],u,T);T.def&&(S=m.chain(S,T,a),T=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/Tree/DataGridView/resources/FooterWrapperTemplate.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/FooterWrapperTemplate"}},o});
//# sourceMappingURL=FooterWrapperTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Tree/DataGridView/TreeDataGridView",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Panel","js!SBIS3.CONTROLS/Link"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Panel"]=e[1],r["js!SBIS3.CONTROLS/Link"]=e[2];var a=function e(a,o,i,s,l){function n(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};l&&l.isSetts&&(p=l.fullContext||{});var u="string"==typeof i?i:"",g=void 0===r?void 0:r,v={id:[],def:void 0},w=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),_=this&&this.includedTemplates?this.includedTemplates:{},f=d.getMarkupGenerator(s);try{var m=f.joinElements([f.createTag("div",{class:"controls-TreeDataGridView controls-DataGridView controls-ListView"+d.wrapUndef(d.utils.escape(d.getter(a,["preparedClasses"])))+"            "+d.wrapUndef(d.utils.escape(!1!==d.getter(a,["multiselect"])?"controls-ListView__multiselect":"controls-ListView__multiselect__off"))+"            "+d.wrapUndef(d.utils.escape(void 0!==d.getter(a,["startScrollColumn"])?"controls-DataGridView__with-partScroll":""))+d.wrapUndef(d.utils.escape(d.getter(a,["_serverRender"])?" controls-ListView__dataLoaded":" controls-ListView__dataNotLoaded"))},[f.createTag("div",{class:"js-controls-DataGridView__minHeight controls-DataGridView__minHeight"},[],{},v,this),f.createControl("wsControl","ws:SBIS3.CONTROLS/Panel",{tabindex:1,allowChangeEnable:!1},{class:"controls-ListView__fakeFocusElement"},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},i,g,_,d.config,p),f.createTag("div",{class:"controls-AjaxLoader ws-hidden"},[f.createTag("div",{class:"controls-AjaxLoader__outer"},[f.createTag("div",{class:"controls-AjaxLoader__block"},[f.createTag("div",{class:"controls-AjaxLoader__LoadingIndicator"},[],{},v,this)],{},v,this)],{},v,this)],{},v,this),d.getter(a,["virtualScrolling"])?[f.createTag("div",{class:"controls-ListView__virtualScrollTop"},[],{},v,this)]:f.createText(""),f.createTag("table",{class:"controls-DataGridView__table "+d.wrapUndef(d.utils.escape(d.getter(a,["stickyHeader"])?"ws-sticky-header__table":""))},[f.createControl("resolver",d.getter(a,["_colGroupTpl"]),d.uniteScope(d.utils.escape(d.getter(a,["_colgroupData"])),{}),{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},i,g,_,d.config,p,v),d.getter(a,["showHead"])?[f.createControl("resolver",d.getter(a,["headTpl"]),d.uniteScope(d.utils.escape(d.getter(a,["_headData"])),{}),{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},i,g,_,d.config,p,v)]:f.createText(""),f.createTag("tbody",{class:"controls-DataGridView__tbody"},[d.getter(a,["_serverRender"])?[f.createControl("resolver",d.getter(a,["_itemsTemplate"]),{records:d.getter(a,["_records"]),tplData:d.getter(a,["_itemData"])},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},i,g,_,d.config,p,v)]:f.createText("")],{},v,this),f.createControl("resolver",d.getter(a,["_footTpl"]),d.uniteScope(d.utils.escape(d.uniteScope(a,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},i,g,_,d.config,p,v)],{},v,this),f.createTag("div",{class:"controls-ListView__EmptyData "+d.wrapUndef(d.utils.escape(d.getter(a,["_serverRender"])&&!d.getter(a,["_records","length"])&&d.getter(a,["emptyHTML"])?"":"ws-hidden"))},[f.createControl("resolver",d.getter(a,["_sanitize"]).apply(a,[d.getter(a,["emptyHTML"])]),{},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},i,g,_,d.config,p,v)],{},v,this),d.getter(a,["footerTpl"])?[f.createTag("div",{class:"controls-ListView__footer"},[f.createControl("resolver",d.getter(a,["footerTpl"]),d.uniteScope(d.utils.escape(d.uniteScope(a,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},i,g,_,d.config,p,v)],{},v,this)]:f.createText(""),d.getter(a,["showPaging"])?[f.createTag("div",{class:"controls-Pager-container"},[],{},v,this)]:f.createText(""),f.createTag("div",{class:"controls-ListView__ItemsToolbar-container ws-hidden"},[],{},v,this),d.getter(a,["editArrow"])||d.getter(a,["arrowActivatedHandler"])?[f.createTag("div",{class:"controls-TreeView__editArrow-container ws-hidden"},[],{},v,this)]:f.createText(""),"demand"==d.getter(a,["infiniteScroll"])?[f.createTag("div",{class:"controls-ListView__serviceFooter"},[f.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"loadMoreButton",caption:"Еще...",visible:"false"},{class:"controls-ListView__loadMoreButton",name:"loadMoreButton",sbisname:"loadMoreButton"},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},i,g,_,d.config,p)],{},v,this)]:f.createText(""),d.getter(a,["virtualScrolling"])?[f.createTag("div",{class:"controls-ListView__virtualScrollBottom"},[],{},v,this)]:f.createText(""),f.createTag("div",{class:"controls-ListView-scrollIndicator "+d.wrapUndef(d.utils.escape("up"===d.getter(a,["infiniteScroll"])?"controls-ListView-scrollIndicator__up":""))},[],{},v,this),f.createTag("div",{class:"controls-ListView__scrollPager "+d.wrapUndef(d.utils.escape(d.getter(a,["it","infiniteScroll"])?"":"ws-hidden"))},[],{},v,this)],o,v,this)],u,v);v.def&&(m=f.chain(m,v,o),v=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/Tree/DataGridView/TreeDataGridView.tmpl",e,a)}return m||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Tree/DataGridView/TreeDataGridView"}},a});
//# sourceMappingURL=TreeDataGridView.tmpl.map
define("SBIS3.CONTROLS/Utils/Contains",function(){return function(n,e){var t=false,i=n instanceof jQuery?n[0]:n,r=e instanceof jQuery?e[0]:e;while(!t&&r)t=i===(r=r.parentNode);return t}});
//# sourceMappingURL=Contains.js.map
define("SBIS3.CONTROLS/Mixins/TreeViewMixin",["Core/constants","SBIS3.CONTROLS/Utils/TemplateUtil","Core/core-instance","Core/helpers/String/format"],function(e,t,o,n){var r=function(e,t){var o=t.getContents(),n=o.get(e.idProperty);return{key:n,item:o,level:t.getLevel(),footerTpl:e.folderFooterTpl,multiselect:e.multiselect,pagerOptions:e._getFolderPagerOptions(e,t,n)}};return{$protected:{_options:{_getFolderFooterOptions:r,_getFolderFooterOptionsTVM:r,_getFolderPagerOptions:function(e,t,o){var r,i,s,a;if("number"===typeof e._folderHasMore[o]&&e.pageSize)s=(r=e._folderHasMore[o]-e._folderOffsets[o]-e.pageSize)<=0?false:r;else if("boolean"===typeof e._folderHasMore[o])s=!!e._folderHasMore[o];else if("object"===typeof e._folderHasMore[o])s=!!e._folderHasMore[o].after;if(s){if("number"===typeof s)a=n({count:s},rk("Еще $count$s$"));else a=rk("Еще")+"...";i={caption:a,command:"loadNode",commandArgs:[o]}}return i},_hasFolderFooters:function(e){return e._footerWrapperTemplate&&e.folderFooterTpl},folderFooterTpl:void 0,itemsDragNDrop:"allow"}},getActiveNodeKey:function(){var e,t;if(null!==this._options.selectedIndex&&void 0!==this._options.selectedIndex&&this._options.selectedIndex>=0)if(t=this._getItemsProjection().at(this._options.selectedIndex),t)if(t.isNode()&&t.isExpanded()&&o.instanceOfModule(t.getContents(),"WS.Data/Entity/Model"))e=t.getContents().getId();else{var n=t.getParent();if(n&&n.getContents()&&o.instanceOfModule(n.getContents(),"WS.Data/Entity/Model"))e=n.getContents().getId()}if(!e)e=this.getCurrentRoot();return e},_onExpandItem:function(e){this._createFolderFooter(e),this._drawExpandedItem(e)},_drawExpandedItem:function(e){var t=this._getItemsContainer().find('[data-hash="'+e.getHash()+'"]');t.find(".js-controls-TreeView__expand").addClass("controls-TreeView__expand__open"),this._notify("onNodeExpand",e.getContents().getId(),t)},_onCollapseItem:function(e){var t=e.getContents().getId(),o=this._getItemsContainer().find('[data-hash="'+e.getHash()+'"]');o.find(".js-controls-TreeView__expand").removeClass("controls-TreeView__expand__open"),delete this._options.openedPath[t],this._destroyItemsFolderFooter(t),this._notify("onNodeCollapse",t,o)},_onChangeItemExpanded:function(e){this["_"+(e.isExpanded()?"onExpandItem":"onCollapseItem")](e)},_findExpandByElement:function(e){var t;if(e.hasClass("js-controls-TreeView__expand"))return e;else return t=e.closest(".js-controls-TreeView__expand"),t.length?t:e},_loadFullData:function(e){return this.reload(this.getFilter(),this.getSorting(),0,1e3,e)},_createFolderFooter:function(e){var t,n,r=this._options;if(!o.instanceOfModule(e,"WS.Data/Display/CollectionItem"))e=this._getItemProjectionByItemId(e);if(o.instanceOfModule(e,"WS.Data/Display/TreeItem"))if(this._destroyItemsFolderFooter(e.getContents().getId()),this._needCreateFolderFooter(e))if(t=this._getLastChildByParent(this._getItemsContainer(),e),"function"===typeof r._footerWrapperTemplate&&t)(n=$(r._footerWrapperTemplate(r._getFolderFooterOptions(r,e)))).insertAfter(t),this.reviveComponents()},_destroyItemsFolderFooter:function(e){var t=this._getFolderFooter(e);this._destroyControls(t),t.remove()},_getFolderFooter:function(e){return $(".controls-TreeDataGridView__folderFooter"+(e?'[data-parent="'+e+'"]':""),this._container)},_createAllFolderFooters:function(){this._getItemsProjection().each(function(e){this._createFolderFooter(e)}.bind(this))},_needCreateFolderFooter:function(e){var t,n,r;if(o.instanceOfModule(e,"WS.Data/Display/GroupItem"))return false;return t=e.getContents(),n=t&&t.get(this._options.idProperty),r=t&&t.get(this._options.nodeProperty),(true===r||false===r)&&e.isExpanded()&&(this._options.folderFooterTpl||this._options._folderHasMore[n])},_getLastChildByParent:function(e,t){var o=t.getLevel(),n=this._getItemsProjection().getEnumerator();n.setCurrent(t);while(n.moveNext())if(n.getCurrent().getLevel()<=o){n.movePrevious();break}return $('.controls-ListView__item[data-hash="'+n.getCurrent().getHash()+'"]',e.get(0))},around:{_onCollectionRemove:function(e,t,n){var r,i,s;for(r=0;r<t.length;r++)if(i=t[r],!o.instanceOfModule(i,"WS.Data/Display/GroupItem"))if(s=i.getContents().getId(),!n&&i.isExpanded())delete this._options.openedPath[s],i.setExpanded(false),this._destroyItemsFolderFooter(s);return e.call(this,t,n)},_onUpdateItemProperty:function(e,t,o){if(e.call(this,t,o),"expanded"===o)this._onChangeItemExpanded(t)}},before:{_keyboardHover:function(t){switch(t.which){case e.key.m:t.ctrlKey&&this.moveRecordsWithDialog()}},_clearItems:function(e){if(this._getItemsContainer().get(0)==$(e).get(0)||!e){var t=this;this._lastParent=this._options.currentRoot,this._lastDrawn=void 0,this._lastPath=[],t._destroyItemsFolderFooter()}}},after:{_modifyOptions:function(e){return e.folderFooterTpl=t.prepareTemplate(e.folderFooterTpl),e},setOpenedPath:function(e){if(this._getItemsProjection())for(var t in e)if(e.hasOwnProperty(t))this._createFolderFooter(t)}},_elemClickHandlerInternal:function(e,t,o){var n=$(o);if(this._findExpandByElement($(o)).hasClass("js-controls-TreeView__expand"))this.toggleNode(t);else if(!n.hasClass("js-controls-ListView__itemCheckBox"))if(this._options.allowEnterToFolder&&e.get(this._options.nodeProperty))this.setCurrentRoot(t),this.reload();else this._activateItem(t)},_activateItem:function(e){var t={id:e,item:this.getItems().getRecordById(e),hierField:this._options.parentProperty,parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty};this._notify("onItemActivate",t)}}});
//# sourceMappingURL=TreeViewMixin.js.map
define("tmpl!SBIS3.CONTROLS/Mixins/TreeMixin/resources/searchRender",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/BreadCrumbs"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={};t["js!SBIS3.CONTROLS/BreadCrumbs"]=e[1];var i=function e(i,l,o,n,s){function a(){}var d=0,c=void 0!==r&&r?r:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};s&&s.isSetts&&(u=s.fullContext||{});var g="string"==typeof o?o:"",p=void 0===t?void 0:t,m={id:[],def:void 0},C=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),h=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(n);try{var f=v.joinElements([v.createControl("wsControl","ws:SBIS3.CONTROLS/BreadCrumbs",{items:c.getter(i,["path"]),itemTpl:c.getter(i,["bcTpls","itemTpl"]),itemContentTpl:c.getter(i,["bcTpls","itemContentTpl"]),highlightEnabled:c.getter(i,["viewCfg","highlightEnabled"]),highlightText:c.getter(i,["viewCfg","highlightText"]),colorMarkEnabled:c.getter(i,["viewCfg","colorMarkEnabled"]),colorField:c.getter(i,["viewCfg","colorField"]),enabled:c.getter(i,["viewCfg","allowEnterToFolder"])||!!c.getter(i,["viewCfg","task1173671799"]),idProperty:c.getter(i,["viewCfg","idProperty"]),activableByClick:!1,displayProperty:c.getter(i,["viewCfg","displayProperty"]),command:"BreadCrumbsItemClick"},c.plainMerge(l,{class:"controls-BreadCrumbs__smallItems controls-BreadCrumbs__home-hide controls-TreeView__searchBreadCrumbs"}),{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:C},o,p,h,c.config,u)],g,m);m.def&&(f=v.chain(f,m,l),m=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Mixins/TreeMixin/resources/searchRender.tmpl",e,i)}return f||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/TreeMixin/resources/searchRender"}},i});
//# sourceMappingURL=searchRender.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/DataGridViewGroupBy",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={},i=function e(i,a,o,s,n){function l(){}var c=0,d=void 0!==r&&r?r:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};n&&n.isSetts&&(u=n.fullContext||{});var p="string"==typeof o?o:"",v=void 0===t?void 0:t,f={id:[],def:void 0},G=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),h=this&&this.includedTemplates?this.includedTemplates:{},m=d.getMarkupGenerator(s);try{var w=m.joinElements([m.createTag("tr",{class:"controls-GroupBy controls-DataGridView__tr controls-ListView__item controls-HierarchyDataGridView__path"},[m.createTag("td",{class:"controls-DataGridView__td",colspan:""+d.wrapUndef(d.utils.escape(d.getter(i,["colspan"])))},[],{},f,this)],a,f,this)],p,f);f.def&&(w=m.chain(w,f,a),f=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/DataGridViewGroupBy.tmpl",e,i)}return w||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/DataGridViewGroupBy"}},i});
//# sourceMappingURL=DataGridViewGroupBy.tmpl.map
define("WS.Data/Relation/Hierarchy",["WS.Data/Entity/Abstract","WS.Data/Entity/OptionsMixin","WS.Data/Entity/Record","WS.Data/Di"],function(t,r,e,n){"use strict";var i=t.extend([r],{_moduleName:"WS.Data/Relation/Hierarchy",_$idProperty:"",_$parentProperty:"",_$nodeProperty:"",_$declaredChildrenProperty:"",constructor:function t(e){t.superclass.constructor.call(this,e),r.constructor.call(this,e)},getIdProperty:function(){return this._$idProperty},setIdProperty:function(t){this._$idProperty=t},getParentProperty:function(){return this._$parentProperty},setParentProperty:function(t){this._$parentProperty=t},getNodeProperty:function(){return this._$nodeProperty},setNodeProperty:function(t){this._$nodeProperty=t},getDeclaredChildrenProperty:function(){return this._$declaredChildrenProperty},setDeclaredChildrenProperty:function(t){this._$declaredChildrenProperty=t},isNode:function(t){return t.get(this._$nodeProperty)},getChildren:function(t,r){if(!this._$parentProperty)return null===t||void 0===t?function(){var t=[];return r.each(function(r){t.push(r)}),t}():[];var e=this._asField(t,this._$idProperty),n=r.getIndicesByValue(this._$parentProperty,e),i=[],o;if(0===n.length&&null===e)n=r.getIndicesByValue(this._$parentProperty);for(o=0;o<n.length;o++)i.push(r.at(n[o]));return i},hasDeclaredChildren:function(t){return t.get(this._$declaredChildrenProperty)},hasParent:function(t,r){var e=(t=this._asRecord(t,r)).get(this._$parentProperty),n=this._$idProperty||r.getIdProperty();return r.getIndexByValue(n,e)>-1},getParent:function(t,r){var e=(t=this._asRecord(t,r)).get(this._$parentProperty);return void 0===e||null===e?null:this._asRecord(e,r)},_asRecord:function(t,r){if(t instanceof e)return t;var n=this._$idProperty||r.getIdProperty(),i=r.getIndexByValue(n,t);if(-1===i)throw new ReferenceError(this._moduleName+': Record with id "'+t+'" is not found in RecordSet');return r.at(i)},_asField:function(t,r){if(!(t instanceof e))return t;return t.get(r)}});return n.register("relation.hierarchy",i),i});
//# sourceMappingURL=Hierarchy.js.map
define("SBIS3.CONTROLS/Utils/TreeDataReload",function(){"use strict";return{prepareReloadableNodes:function(e){var t={},i=e.items,n=e.nodeProperty,r=e.hierarchyRelation;function a(e){var o=e.getId(),f=r.getChildren(e,i);t[o]=0,f.forEach(function(e){if(null!==e.get(n))a(e)})}if("inside"===e.direction)a(e.item);return t},applyUpdatedData:function(e){var t=e.item,i=e.items,n=e.updatedItems,r=e.hierarchyRelation,a=e.nodeProperty,o=[];function f(e){r.getChildren(e,i).forEach(function(e){if(null!==e.get(a))f(e);if(!n.getRecordById(e.getId()))o.push(e)})}if("inside"===e.direction)f(t);if(o.length)i.setEventRaising(false,true),o.forEach(function(e){i.remove(e)});if(i.merge(n,{remove:false,inject:true}),o.length)i.setEventRaising(true,true)}}});
//# sourceMappingURL=TreeDataReload.js.map
define("tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/menuItem",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={},o=function e(o,a,s,i,c){function n(){}var l=0,u=void 0!==r&&r?r:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};c&&c.isSetts&&(d=c.fullContext||{});var p="string"==typeof s?s:"",v=void 0===t?void 0:t,m={id:[],def:void 0},g=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},y=u.getMarkupGenerator(i);try{var h=y.joinElements([y.createTag("div",{class:"controls-MenuItem js-controls-BreadCrumbs__crumb",style:""+u.wrapUndef(u.utils.escape(u.getter(o,["decorators","apply"]).apply(u.getter(o,["decorators"]),[u.getter(o,["record","get"]).apply(u.getter(o,["record"]),[u.getter(o,["colorField"])]),"color"]))),"data-id":""+u.wrapUndef(u.utils.escape(u.getter(o,["record","get"]).apply(u.getter(o,["record"]),[u.getter(o,["idProperty"])])+""))},[function(){for(var e=void 0,r=0;r<u.iterators.length&&!e;r++)u.iterators[r].is(u.utils.escape(u.getter(o,["wrappersCount"])))&&(e=u.iterators[r].iterator);var t=[];return function(){var r=u.createScope(o);if(o=r,e){var a=s,c=0;e(u.utils.escape(u.getter(o,["wrappersCount"])),function(e,r){u.presetScope(e,o,r,{value:"i"}),s&&void 0!==i&&i&&(s=a+"-for_"+c,c++);var n=[y.createTag("div",{class:"controls-BreadCrumbs__hierWrapper"},[],{},m,this)];void 0===n[0]&&void 0!==i&&i||(t=t.concat(n))}.bind(o))}else t=""}.call(o),t}(),y.createTag("span",{class:"controls-BreadCrumbs__menuTitle"},[y.createText(" "+u.wrapUndef(u.utils.escape(u.getter(o,["record","get"]).apply(u.getter(o,["record"]),[u.getter(o,["displayProperty"])])))+" ")],{},m,this)],a,m,this)],p,m);m.def&&(h=y.chain(h,m,a),m=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/BreadCrumbs/resources/menuItem.tmpl",e,o)}return h||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/menuItem"}},o});
//# sourceMappingURL=menuItem.tmpl.map
define("tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/itemTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,o,n,s){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var u="string"==typeof o?o:"",m=void 0===r?void 0:r,g={id:[],def:void 0},v=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},y=c.getMarkupGenerator(n);try{var S=y.joinElements([y.createTag("span",{class:"controls-BreadCrumbs__crumb js-controls-BreadCrumbs__crumb controls-ListView__item","data-hash":""+c.wrapUndef(c.utils.escape(c.getter(i,["projItem","getHash"]).apply(c.getter(i,["projItem"]),[]))),"data-id":""+c.wrapUndef(c.utils.escape(c.getter(i,["item","getId"]).apply(c.getter(i,["item"]),[])+"")),title:""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(i,["escapeHtml"]).apply(i,[c.getter(i,["escapeUnicode"]).apply(i,[c.getter(i,["item","get"]).apply(c.getter(i,["item"]),[c.getter(i,["displayProperty"])])||""])])])]))},[y.createControl("resolver",c.getter(i,["itemContent"]),c.uniteScope(c.utils.escape(c.uniteScope(i,{parent:void 0,element:void 0})(c.plainMerge)),{}),c.plainMerge(c.getter(i,["attributes"]),{}),{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},o,m,f,c.config,d,g)],a,g,this)],u,g);g.def&&(S=y.chain(S,g,a),g=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/BreadCrumbs/resources/itemTpl.tmpl",e,i)}return S||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/itemTpl"}},i});
//# sourceMappingURL=itemTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/itemContentTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},a=function e(a,o,i,s,l){function n(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var u="string"==typeof i?i:"",m=void 0===r?void 0:r,g={id:[],def:void 0},y=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),v=this&&this.includedTemplates?this.includedTemplates:{},f=p.getMarkupGenerator(s);try{var C=f.joinElements([f.createTag("span",{class:"controls-BreadCrumbs__arrow icon-size icon-DayForward icon-primary action-hover"},[],o,g,this),p.getter(a,["item","get"]).apply(p.getter(a,["item"]),["icon"])?[f.createTag("span",{class:""+p.wrapUndef(p.utils.escape(p.getter(a,["item","get"]).apply(p.getter(a,["item"]),["icon"])))},[],{},g,this)]:f.createText(""),f.createTag("a",{class:"controls-BreadCrumbs__title",style:""+p.wrapUndef(p.utils.escape(p.getter(a,["decorators","apply"]).apply(p.getter(a,["decorators"]),[p.getter(a,["item","get"]).apply(p.getter(a,["item"]),["color"]),"color"])))},[f.createText(""+p.wrapUndef(p.Sanitize.apply(void 0,[p.getDecorators().sanitize.apply(void 0,[p.getter(a,["decorators","apply"]).apply(p.getter(a,["decorators"]),[p.getter(a,["escapeHtml"]).apply(a,[p.getter(a,["item","get"]).apply(p.getter(a,["item"]),[p.getter(a,["displayProperty"])])])||""])])])))],o,g,this)],u,g);g.def&&(C=f.chain(C,g,o),g=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/BreadCrumbs/resources/itemContentTpl.tmpl",e,a)}return C||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/itemContentTpl"}},a});
//# sourceMappingURL=itemContentTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/dotsTpl",["Core/tmpl/js/tclosure"],function(){var r=Array.prototype.slice.call(arguments),e=r[0],t={},s=function r(s,o,a,n,i){function c(){}var l=0,u=void 0!==e&&e?e:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};i&&i.isSetts&&(d=i.fullContext||{});var m="string"==typeof a?a:"",p=void 0===t?void 0:t,v={id:[],def:void 0},b=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),f=this&&this.includedTemplates?this.includedTemplates:{},C=u.getMarkupGenerator(n);try{var h=C.joinElements([C.createTag("span",{class:"controls-BreadCrumbs__crumb js-controls-BreadCrumbs__crumb controls-BreadCrumbs__dots controls-ListView__item"},[C.createTag("span",{class:"controls-BreadCrumbs__arrow icon-16 icon-size icon-DayForward icon-primary action-hover"},[],{},v,this),C.createTag("a",{class:"controls-BreadCrumbs__title"},[C.createText(""+global.rk("..."))],{},v,this)],o,v,this)],m,v);v.def&&(h=C.chain(h,v,o),v=void 0)}catch(r){u.templateError("resources/SBIS3.CONTROLS/BreadCrumbs/resources/dotsTpl.tmpl",r,s)}return h||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/dotsTpl"}},s});
//# sourceMappingURL=dotsTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/BreadCrumbs/BreadCrumbs",["Core/tmpl/js/tclosure"],function(){var r=Array.prototype.slice.call(arguments),e=r[0],t={},s=function r(s,a,o,n,i){function c(){}var l=0,u=void 0!==e&&e?e:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};i&&i.isSetts&&(d=i.fullContext||{});var m="string"==typeof o?o:"",p=void 0===t?void 0:t,C={id:[],def:void 0},b=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),v=this&&this.includedTemplates?this.includedTemplates:{},h=u.getMarkupGenerator(n);try{var B=h.joinElements([h.createTag("div",{class:"controls-BreadCrumbs"},[h.createTag("span",{class:"controls-BreadCrumbs__crumb js-controls-BreadCrumbs__crumb controls-BreadCrumbs__crumb-home ws-hidden"},[h.createTag("span",{class:"controls-BreadCrumbs__home icon-size icon-Home3 icon-primary"},[],{},C,this)],{},C,this),h.createTag("div",{class:"controls-BreadCrumbs__itemsContainer"},[],{},C,this)],a,C,this)],m,C);C.def&&(B=h.chain(B,C,a),C=void 0)}catch(r){u.templateError("resources/SBIS3.CONTROLS/BreadCrumbs/BreadCrumbs.tmpl",r,s)}return B||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/BreadCrumbs/BreadCrumbs"}},s});
//# sourceMappingURL=BreadCrumbs.tmpl.map
define("tmpl!SBIS3.CONTROLS/FloatArea/FloatArea",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,a,l,n,i){function c(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};i&&i.isSetts&&(d=i.fullContext||{});var p="string"==typeof l?l:"",v=void 0===r?void 0:r,m={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),S=this&&this.includedTemplates?this.includedTemplates:{},g=u.getMarkupGenerator(n);try{var h=g.joinElements([g.createTag("div",{class:"controls-FloatArea"},[u.getter(o,["template"])?[g.createControl("resolver",u.getter(o,["template"]),u.uniteScope(u.utils.escape(u.getter(o,["componentOptions"])),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},l,v,S,u.config,d,m)]:g.createText("")],a,m,this)],p,m);m.def&&(h=g.chain(h,m,a),m=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/FloatArea/FloatArea.tmpl",e,o)}return h||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FloatArea/FloatArea"}},o});
//# sourceMappingURL=FloatArea.tmpl.map
define("SBIS3.CONTROLS/FloatArea",["Lib/Control/CompoundControl/CompoundControl","SBIS3.CONTROLS/Mixins/PopupMixin","Lib/Mixins/LikeWindowMixin","tmpl!SBIS3.CONTROLS/FloatArea/FloatArea","SBIS3.CONTROLS/Utils/TemplateUtil","css!SBIS3.CONTROLS/FloatArea/FloatArea"],function(t,e,i,o,n){"use strict";var l=t.extend([e,i],{_dotTplFn:o,$protected:{_options:{animation:"no",template:null,componentOptions:{}}},_modifyOptions:function(t){if(t=l.superclass._modifyOptions.apply(this,arguments),"string"==typeof t.template&&0!==t.template.indexOf("js!"))t.template=n.prepareTemplate(t.template);return t},$constructor:function(){},toggle:function(){if(this.isVisible())this.hide();else this.show()}});return l});
//# sourceMappingURL=FloatArea.js.map
define("SBIS3.CONTROLS/Mixins/PickerMixin",["Core/constants","SBIS3.CONTROLS/FloatArea"],function(i,e){return{$protected:{_picker:null,_border:0,_options:{pickerClassName:"",pickerConfig:null}},$constructor:function(){this._publish("onPickerOpen","onPickerClose")},_initializePicker:function(){var e=this,t=this.getContainer(),n=$("<div></div>");if(this._options.pickerClassName)n.addClass(this._options.pickerClassName);i.$body.append(n),this._picker=this._createPicker(n),this.subscribeTo(this._picker,"onAlignmentChange",function(i,t){e._onAlignmentChangeHandler(t)}),this.subscribeTo(this._picker,"onClose",function(){t.removeClass("controls-Picker__show"),e._notify("onPickerClose")}),t.on("mouseenter",function(){n.addClass("controls-Picker__owner__hover")}).on("mouseleave",function(){n.removeClass("controls-Picker__owner__hover")}),this.subscribeTo(this._picker,"onDestroy",function(){e.getContainer().off("mouseenter mouseleave")}),this._border=t.outerWidth()-t.innerWidth(),this._setPickerContent(),n.addClass("js-controls-Picker__initialized")},_createPicker:function(i){var t=this._setPickerConfig(),n=this;if(this._options.pickerConfig)for(var o in this._options.pickerConfig)if(this._options.pickerConfig.hasOwnProperty(o)){if("handlers"===o&&t[o]){for(var r in this._options.pickerConfig[o])if(this._options.pickerConfig[o].hasOwnProperty(r))if(t[o][r])t[o][r]=[t[o][r]],t[o][r].push(this._options.pickerConfig[o][r]);else t[o][r]=this._options.pickerConfig[o][r];continue}t[o]=this._options.pickerConfig[o]}return t.parent=void 0!==t.parent?t.parent:n,t.opener=this,t.context=t.context||n&&n.getLinkedContext(),t.target=t.target||this._container,t.element=i,new e(t)},_setPickerConfig:function(){return{corner:"bl",verticalAlign:{side:"top"},horizontalAlign:{side:"left"},closeByExternalClick:true}},_onAlignmentChangeHandler:function(i){},showPicker:function(){if(!this._picker||this._picker.isDestroyed())this._initializePicker();this._container.addClass("controls-Picker__show"),this._picker.show(),this._notify("onPickerOpen")},getPicker:function(){if(!this._picker||this._picker.isDestroyed())this._initializePicker();return this._picker},hidePicker:function(){if(this._picker)this._container.removeClass("controls-Picker__show"),this._picker.hide()},togglePicker:function(){if(!this._picker)this.showPicker();else if(this._container.toggleClass("controls-Picker__show"),this._picker.isVisible())this.hidePicker();else this.showPicker()},isPickerVisible:function(){return Boolean(this._picker&&this._picker.isVisible())},_setPickerContent:function(){},after:{destroy:function(){if(this._picker)this._picker.destroy();this.getContainer().off("mouseenter mouseleave")}},around:{_getScrollContainer:function(i){if(!this._picker)return i.call(this);return this._picker.getContainer()}}}});
//# sourceMappingURL=PickerMixin.js.map
define("tmpl!SBIS3.CONTROLS/Mixins/ItemsControlMixin/resources/ItemsTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},a=function e(a,o,i,l,n){function p(){}var s=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var g={};n&&n.isSetts&&(g=n.fullContext||{});var d="string"==typeof i?i:"",m=void 0===r?void 0:r,u={id:[],def:void 0},v=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),f=this&&this.includedTemplates?this.includedTemplates:{},y=c.getMarkupGenerator(l);try{var D=y.joinElements([(c.getter(a,["tplData","timeLogger"])&&c.getter(a,["tplData","timeLogger"]).apply(c.getter(a,["tplData"]),["ItemsRender",!0]),y.createText("")),function(){for(var e=void 0,t=0;t<c.iterators.length&&!e;t++)c.iterators[t].is(c.utils.escape(c.getter(a,["records"])))&&(e=c.iterators[t].iterator);var r=[];return function(){var t=c.createScope(a);if(a=t,e){var o=i,n=0;e(c.utils.escape(c.getter(a,["records"])),function(e,t){c.presetScope(e,a,t,{key:"index",value:"item"}),i&&void 0!==l&&l&&(i=o+"-for_"+n,n++);var p=[(c.getter(a,["tplData","timeLogger"])&&c.getter(a,["tplData","timeLogger"]).apply(c.getter(a,["tplData"]),["SingleItemRender",!0]),y.createText("")),c.getter(a,["item","getContents"])?[c.getter(a,["tplData","decorators"])&&c.getter(a,["tplData","decorators","ladder"])?[y.createText(""+c.wrapUndef(c.utils.escape(c.getter(a,["tplData","decorators","ladder","setRecord"]).apply(c.getter(a,["tplData","decorators","ladder"]),[c.getter(a,["item","getContents"]).apply(c.getter(a,["item"]),[])])||"")))]:y.createText(""),y.createControl("resolver",c.getter(a,["tplData","itemTpl"]),c.uniteScope(c.utils.escape(c.getter(a,["tplData"])),{item:c.getter(a,["item","getContents"]).apply(c.getter(a,["item"]),[]),projItem:c.getter(a,["item"])}),{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},i,m,f,c.config,g,u)]:[y.createControl("resolver",c.getter(a,["item","tpl"]),c.uniteScope(c.utils.escape(c.getter(a,["item","data"])),{}),{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},i,m,f,c.config,g,u)],(c.getter(a,["tplData","timeLogger"])&&c.getter(a,["tplData","timeLogger"]).apply(c.getter(a,["tplData"]),["SingleItemRender",!1]),y.createText(""))];void 0===p[0]&&void 0!==l&&l||(r=r.concat(p))}.bind(a))}else r=""}.call(a),r}(),(c.getter(a,["tplData","timeLogger"])&&c.getter(a,["tplData","timeLogger"]).apply(c.getter(a,["tplData"]),["ItemsRender",!1]),y.createText(""))],d,u);u.def&&(D=y.chain(D,u,o),u=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Mixins/ItemsControlMixin/resources/ItemsTemplate.tmpl",e,a)}return D||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/ItemsControlMixin/resources/ItemsTemplate"}},a});
//# sourceMappingURL=ItemsTemplate.tmpl.map
define("SBIS3.CONTROLS/Utils/SourceUtil",["Core/core-instance","require"],function(e,i){return{prepareSource:function(n){var r;switch(typeof n){case"function":r=n.call(this);break;case"object":if(e.instanceOfMixin(n,"WS.Data/Source/ISource"))r=n;if("module"in n)r=new(i(n.module))(n.options||{})}return r}}});
//# sourceMappingURL=SourceUtil.js.map
define("SBIS3.CONTROLS/Mixins/ItemsControlMixin",["Core/core-clone","Core/Deferred","Core/IoC","Core/core-merge","WS.Data/Source/Memory","WS.Data/Collection/RecordSet","WS.Data/Query/Query","WS.Data/Collection/ObservableList","WS.Data/Display/Display","WS.Data/Collection/IBind","SBIS3.CONTROLS/Utils/TemplateUtil","tmpl!SBIS3.CONTROLS/Mixins/ItemsControlMixin/resources/ItemsTemplate","WS.Data/Utils","Core/markup/ParserUtilities","Core/Sanitize","Lib/LayoutManager/LayoutManager","Core/core-instance","SBIS3.CONTROLS/Utils/InformationPopupManager","Core/helpers/Function/forAliveOnly","Core/helpers/String/escapeHtml","SBIS3.CONTROLS/Utils/SourceUtil","Core/helpers/Object/isEmpty","Core/helpers/Function/debounce","Lib/Control/Control","WS.Data/Display/Collection","WS.Data/Display/Enum","WS.Data/Display/Flags"],function(t,e,i,o,s,r,n,a,l,p,_,h,u,c,d,m,f,g,y,I,v,P,C,S){function T(t){return function(){return this.runInPropertiesUpdate(t,arguments)}}var w=function(t,e){var i,o={};if(o.idProperty=e.idProperty||(e.dataSource&&"function"===typeof e.dataSource.getIdProperty?e.dataSource.getIdProperty():""),e.itemsSortMethod)o.sort=e.itemsSortMethod;if(e.itemsFilterMethod)o.filter=e.itemsFilterMethod;if("merge"==e.loadItemsStrategy)o.unique=true;return i=l.getDefaultDisplay(t,o),i},D=function(t,e,i){return e+""},B=function(t,e){return e.groupBy.method?e.groupBy.method.apply(this,arguments):t.get(e.groupBy.field)};applyGroupingToProjection=function(t,e){if(!P(e.groupBy)&&e.easyGroup){var i=function(t){var i=e._getGroupId(t,e);if(false!==i)i=e._prepareGroupId(t,i,e);return i};t.setGroup(i)}else t.setGroup(null);return t},applyFilterToProjection=function(t,e){t.setFilter(e.itemsFilterMethod)},_oldGroupByDefaultMethod=function(t,e,i,o){var s=t.get(this._options.groupBy.field),r=s!==this._previousGroupBy;return this._previousGroupBy=s,r},getPropertyValue=function(t,e){if("string"==typeof t)return t;else return u.getItemPropertyValue(t,e)},canApplyGrouping=function(t,e){return!P(e.groupBy)&&(0===e._itemsProjection.getSort().length||!t||!t.isNode||!t.isNode())},getGroupTemplate=function(t){return t._groupTemplate},groupItemProcessing=function(e,i,o,s,r){if(s._canApplyGrouping(o,s)){var n=s.groupBy,a=s._getGroupTemplate(s);if(a){var l={columns:t(s.columns||[]),items:s._items,multiselect:s.multiselect,hierField:s.hierField+"@",parentProperty:s.parentProperty,nodeProperty:s.nodeProperty,item:o.getContents(),groupContentTemplate:_.prepareTemplate(n.contentTemplate||""),groupId:e,groupHash:r,groupCollapsing:s._groupCollapsing};l.colspan=l.columns.length+s.multiselect,i.push({tpl:_.prepareTemplate(a),data:l})}}},getRecordsForRedraw=function(t,e){var i=[];if(t){var o=false,s,r;t.each(function(t,n){if(f.instanceOfModule(t,"WS.Data/Display/GroupItem"))s=t.getContents(),r=t.getHash(),o=true;else{if(!P(e.groupBy)&&e.easyGroup)if(o&&s)e._groupItemProcessing(s,i,t,e,r),o=false;i.push(t)}})}return i},buildTplArgs=function(t){var e={},o=this,s={},r,n,a;if(e.escapeHtml=I,e.Sanitize=d,e.idProperty=t.idProperty,e.displayField=t.displayProperty,e.displayProperty=t.displayProperty,e.templateBinding=t.templateBinding,e.getPropertyValue=t._propertyValueGetter,"undefined"===typeof window)a=i.resolve("ILogger"),e.timeLogger=function e(i,r){if(r)s[i]=new Date;else a.log(o._moduleName||t.name,i+" "+(new Date-s[i])),delete s[i]};if(t.itemContentTpl)n=t.itemContentTpl;else n=t._defaultItemContentTemplate;if(e.itemContent=_.prepareTemplate(n),t.itemTpl)r=t.itemTpl;else r=t._defaultItemTemplate;if(e.itemTpl=_.prepareTemplate(r),e.defaultItemTpl=_.prepareTemplate(t._defaultItemTemplate),t.includedTemplates){var l=t.includedTemplates;e.included={};for(var p in l)if(l.hasOwnProperty(p))e.included[p]=_.prepareTemplate(l[p])}return e},canServerRenderOther=function(t){return!t.itemTemplate},findIdProperty=function(t){if(t[0])return Object.keys(t[0])[0]},JSONToRecordset=function(t,e){return new r({rawData:t,idProperty:e})},extendedMarkupCalculate=function(t,e){return c.buildInnerComponentsExtended(t,e)};var b={$protected:{_itemData:null,_groupHash:{},_itemsInstances:{},_offset:0,_limit:void 0,_dataSource:void 0,_revivePackageParams:{},_options:{_getGroupTemplate:getGroupTemplate,_groupCollapsing:{},_itemsTemplate:h,_propertyValueGetter:getPropertyValue,_canServerRender:false,_canServerRenderOther:canServerRenderOther,_serverRender:false,_defaultItemTemplate:"",_defaultItemContentTemplate:"",_prepareGroupId:D,_getGroupId:B,_createDefaultProjection:w,_buildTplArgsSt:buildTplArgs,_buildTplArgs:buildTplArgs,_getRecordsForRedrawSt:getRecordsForRedraw,_getRecordsForRedraw:getRecordsForRedraw,_applyGroupingToProjection:applyGroupingToProjection,_applyFilterToProjection:applyFilterToProjection,_groupItemProcessing:groupItemProcessing,_canApplyGrouping:canApplyGrouping,keyField:null,idProperty:null,displayField:null,displayProperty:null,items:null,dataSource:void 0,pageSize:void 0,groupBy:{},emptyHTML:"",filter:{},sorting:[],loadItemsStrategy:"append",templateBinding:{},includedTemplates:{},footerTpl:void 0,itemContentTpl:null,itemTpl:null,itemsSortMethod:null,itemsFilterMethod:void 0,easyGroup:false,task1173770359:false},_loader:null},around:{_modifyOptions:function(t,e,o){if(e.displayField)i.resolve("ILogger").log("ItemsControl","Опция displayField является устаревшей, используйте displayProperty"),e.displayProperty=e.displayField;if(e.keyField)i.resolve("ILogger").log("ItemsControl","Опция keyField является устаревшей, используйте idProperty"),e.idProperty=e.keyField;var s=t.call(this,e),r,n;if(s.items){if(o._itemsProjection)s._itemsProjection=o._itemsProjection,s._items=o._items,applyGroupingToProjection(s._itemsProjection,s),s._applyFilterToProjection(s._itemsProjection,s);else{if(s.items instanceof Array){if(!s.idProperty){var a=findIdProperty(s.items);s.idProperty=a,o.idProperty=a}n=JSONToRecordset(e.items,s.idProperty),s._items=n,o._items=n}else s._items=s.items,o._items=s.items;r=s._createDefaultProjection(s._items,s),r=s._applyGroupingToProjection(r,s),s._itemsProjection=r,o._itemsProjection=r}if(e._canServerRender&&e._canServerRenderOther(e))if(P(e.groupBy)||e.easyGroup){if(s._serverRender=true,s._records=e._getRecordsForRedraw(e._itemsProjection,e),e._items&&f.instanceOfModule(e._items,"WS.Data/Collection/RecordSet"))s._resultsRecord=e._items.getMetaData().results;s._itemData=e._buildTplArgs(e)}}return s}},$constructor:function(){this._publish("onDrawItems","onDataLoad","onDataLoadError","onBeforeDataLoad","onItemsReady","onPageSizeChange"),this._revivePackageParams={revive:false,light:true,processed:true};var t=C(y(this._drawItemsCallback,this),0);if(this._drawItemsCallbackDebounce=y(function(){t(),this._drawItemsCallbackSync()},this),"string"===typeof this._options.pageSize)this._options.pageSize=1*this._options.pageSize;if(this._checkIdProperty(),this._bindHandlers(),this._prepareItemsConfig(),this._options.itemTemplate)i.resolve("ILogger").error("3.7.5 ItemsControl","Контрол "+this.getName()+" отрисовывается по неоптимальному алгоритму. Задан itemTemplate");if(!P(this._options.groupBy)&&!this._options.easyGroup)i.resolve("ILogger").error("3.7.5 ItemsControl","Контрол "+this.getName()+" отрисовывается по неоптимальному алгоритму. Используется GroupBy без easyGroup: true");if(this._options.userItemAttributes)i.resolve("ILogger").error("3.7.5 userItemAttributes","Option is no longer available since version 3.7.4.200. Use ItemTpl")},_getItemsTemplate:function(){return this._options._itemsTemplate},_getItemsTemplateForAdd:function(){return this._options._itemsTemplate},_prepareItemsConfig:function(){if(this._options.dataSource)this._dataSource=v.prepareSource.call(this,this._options.dataSource);if(this._options._itemsProjection)this._setItemsEventHandlers(),this._notify("onItemsReady"),this._itemsReadyCallback(),this._dataLoadedCallback();if(this._options.items instanceof Array){if(this._options.pageSize&&this._options.items.length>this._options.pageSize)i.resolve("ILogger").log("ListView","Опция pageSize работает только при запросе данных через dataSource");if(!this._options.idProperty)this._options.idProperty=findIdProperty(this._options.items);if(this._dataSource)this._options._items=JSONToRecordset(this._options.items,this._options.idProperty),this._options._itemsProjection=this._options._createDefaultProjection.call(this,this._options._items,this._options),this._options._itemsProjection=this._options._applyGroupingToProjection(this._options._itemsProjection,this._options),this._setItemsEventHandlers(),this._notify("onItemsReady"),this._itemsReadyCallback();else this._dataSource=new s({data:t(this._options.items),idProperty:this._options.idProperty})}},_prepareConfig:function(t,e){if(t)this._dataSource=v.prepareSource.call(this,t);if(e){if(e instanceof Array){if(!this._options.idProperty)this._options.idProperty=findIdProperty(e);this._options._items=JSONToRecordset(e,this._options.idProperty)}else this._options._items=e;if(this._options._itemsProjection)this._unsetItemsEventHandlers(),this._options._itemsProjection.destroy();this._options._itemsProjection=this._options._createDefaultProjection.call(this,this._options._items,this._options),this._options._itemsProjection=this._options._applyGroupingToProjection(this._options._itemsProjection,this._options),this._setItemsEventHandlers(),this._notify("onItemsReady"),this._itemsReadyCallback()}this._checkIdProperty()},_checkIdProperty:function(){if(this._options.idProperty)return;var t=this.getItems();if(t&&t.getIdProperty)i.resolve("ILogger").info("ItemsControl","Option idProperty is undefined in control "+this.getName())},_getItemProjectionByItemId:function(t){return this._getItemsProjection()?this._getItemsProjection().getItemBySourceItem(this.getItems().getRecordById(t)):null},_getItemProjectionByHash:function(t){return this._getItemsProjection().getByHash(t)},_groupByDefaultMethod:function(t,e,i){return e.get(i)!=t.get(i)},_getGroupContainers:function(t){var e=$([]);if(this._getItemsProjection())for(var i=this._getGroupItems(t),o=0;o<i.length;o++)e.push(this._getDomElementByItem(i[o]).get(0));return e},_toggleGroup:function(t,e){this._options._groupCollapsing[t]=e,this._getGroupContainers(t).toggleClass("ws-hidden",e),$('.controls-GroupBy[data-group="'+t+'"] .controls-GroupBy__separatorCollapse',this._container).toggleClass("controls-GroupBy__separatorCollapse__collapsed",e),this._drawItemsCallbackDebounce()},expandGroup:function(t){this._toggleGroup(t,false)},collapseGroup:function(t){this._toggleGroup(t,true)},toggleGroup:function(t){this[this._isGroupCollapsed(t)?"expandGroup":"collapseGroup"].call(this,t)},_isGroupCollapsed:function(t){return this._options._groupCollapsing[t]},_prepareItemsData:function(){return{records:this._options._getRecordsForRedraw.call(this,this._options._itemsProjection,this._options)}},_prepareFullData:function(){var t,e=this._getItemTemplate();return t={items:this._options._getRecordsForRedraw(this._options._itemsProjection,this._options)},t.itemTemplate=_.prepareTemplate(e),t.itemsTemplate=this._getItemsTemplate(),t},_buildTplArgs:function(){return this._options._buildTplArgs.apply(this,arguments)},_prepareItemData:function(){var e;if(this._options._canServerRender)e=this._options._buildTplArgs;else e=this._buildTplArgs;if(!this._itemData)this._itemData=t(e.call(this,this._options));else this._updateItemData(this._itemData);return this._itemData},_updateItemData:function(t){},_redrawItems:function(t){this._groupHash={};var e=this._getItemsContainer();if(e){var i=e.get(0),o=this._prepareItemsData(),s,r;o.tplData=this._prepareItemData(),s=(r=extendedMarkupCalculate(this._getItemsTemplate()(o),this._options)).markup;var n=this._destroyInnerComponents(e,this._options.easyGroup);if(s.length)i.innerHTML=s;else if(this._options.easyGroup)i.innerHTML="";for(var a=0;a<n.length;a++)if(n[a])n[a].destroy();this._toggleEmptyData(this._needShowEmptyData(o.records))}if(this._container.addClass("controls-ListView__dataLoaded").removeClass("controls-ListView__dataNotLoaded"),t)this._revivePackageParams.revive=true,this._revivePackageParams.light=false;else this._reviveItems()},_needShowEmptyData:function(t){return!(t&&t.length)},_redrawItem:function(t){var e=this._redrawItemInner(t);this._revivePackageParams.revive=this._revivePackageParams.revive||e,this._revivePackageParams.light=this._revivePackageParams.light&&t.getContents().getId()!=this._options.selectedKey},_redrawItemInner:function(t){var e=false,i,o,s=this._getDomElementByItem(t),r=s.attr("style")||"",n=this._getItemsProjection(),a;if(s.length){if(s.hasClass("controls-HierarchyDataGridView__path"))return this._redrawHierarchyPathItem(t),e;if(a=this._prepareItemData(),a.projItem=t,a.item=t.getContents(),this._options.groupBy&&this._options.easyGroup)a.drawHiddenGroup=!!this._options._groupCollapsing[n.getGroupByIndex(n.getIndex(t))];if(a.decorators&&a.decorators.ladder)a.decorators.ladder.setRecord(a["item"]);var l=this._calculateDataBeforeRedraw(a,t),p;if(a.itemTpl)p=l.itemTpl;else p=l.defaultItemTpl;i=(o=extendedMarkupCalculate(p(l),this._options)).markup;var _=this._destroyInnerComponents(s,true);if(r)s.replaceWith($(i).attr("style",r));else{if(s.find($(document.activeElement)).length>0)this._getElementToFocus().focus();s.get(0).outerHTML=i}for(var h=0;h<_.length;h++)if(_[h])_[h].destroy();if(e=o.hasComponents,!P(this._options.groupBy))this._groupFixOnRedrawItemInner(t,s)}return e},_redrawHierarchyPathItem:function(t){},_groupFixOnRedrawItemInner:function(t){var e=this._getDomElementByItem(t),i;if(!this._options._canApplyGrouping(t,this._options))if(i=e.prev(),i.length&&i.hasClass("controls-GroupBy")){e.after(i);var o=i.next();if(o.length&&!o.hasClass("js-controls-ListView__item"))i.remove()}},_calculateDataBeforeRedraw:function(t){return t},_removeItems:function(t){for(var e=0;e<t.length;e++){var i=t[e],o=this._getDomElementByItem(i);if(o.length){this._clearItems(o);var s=o.get(0);s.parentNode.removeChild(s)}else if(this._isSearchMode&&this._isSearchMode()&&i.isNode&&i.isNode())return void this.redraw()}},_removeItemsLight:function(t){for(var e=0;e<t.length;e++){var i=t[e],o=this._getDomElementByItem(i);if(o.length){this._clearItems(o);var s=o.get(0);s.parentNode.removeChild(s)}}},_getSourceNavigationType:function(){if(this.getDataSource())return this.getDataSource().getOptions().navigationType},_getItemsForRedrawOnAdd:function(t){var e=[],i,o;if(t.length&&f.instanceOfModule(t[0],"WS.Data/Display/GroupItem")){if(t.length>1){if(i=t[0].getContents(),o=t[0].getHash(),false!==i)this._options._groupItemProcessing(i,e,t[1],this._options,o);t.splice(0,1),e=e.concat(t)}}else e=t;return e},_optimizedInsertMarkup:function(t,e){var i=e.container;if(e.inside)i.get(0).insertAdjacentHTML(e.prepend?"afterBegin":"beforeEnd",t);else i[e.prepend?"before":"after"](t)},_addItems:function(t,e){var i,o,s=this._getItemsProjection();if(this._itemData=null,t&&t.length){if(this._options.groupBy)if(f.instanceOfModule(t[0],"WS.Data/Display/GroupItem"))o=t[0].getContents();else o=s.getGroupByIndex(s.getIndex(t[0]));if(this._isSlowDrawing(this._options.easyGroup))for(i=0;i<t.length;i++)this._addItem(t[i],e+i,true),this._notifyOnDrawItems();else{var r,n,a,l;if(l=this._getItemsForRedrawOnAdd(t),l.length)(r={records:l,tplData:this._prepareItemData()}).tplData.drawHiddenGroup=!!this._options._groupCollapsing[o],n=(a=extendedMarkupCalculate(this._getItemsTemplateForAdd()(r),this._options)).markup,this._optimizedInsertMarkup(n,this._getInsertMarkupConfig(e,t)),this._revivePackageParams.revive=this._revivePackageParams.revive||a.hasComponents,this._revivePackageParams.light=false}this._afterAddItems()}},_afterAddItems:function(){},_getInsertMarkupConfig:function(t,e){return this._getInsertMarkupConfigICM.apply(this,arguments)},_getInsertMarkupConfigICM:function(t,e){var i=true,o=false,s=this._getItemsContainer(),r=this._getItemsProjection(),n=r.at(t-1),a=r.getCount()-e.length;if(this._virtualScrollController&&this._virtualScrollController._currentWindow[1]>0)a=this._virtualScrollController._currentWindow[1]+1;if(0==t||t==a)o=0==t;else if(!this._canApplyGrouping(e[0])&&f.instanceOfModule(n,"WS.Data/Display/GroupItem"))o=1==t;else i=false,s=this._getDomElementByItem(n);return{inside:i,prepend:o,container:s}},_getDomElementByItem:function(t){var e;if(f.instanceOfModule(t,"WS.Data/Display/GroupItem"))e=this._getItemsContainer().find('.controls-GroupBy[data-group-hash="'+t.getHash()+'"]');else e=this._getRecordElemByItem(t);return e},_getRecordElemByItem:function(t){return this._getItemsContainer().find('.js-controls-ListView__item[data-hash="'+t.getHash()+'"]')},_reviveItems:function(t,e){this.reviveComponents().addCallback(this._onReviveItems.bind(this,t,e)).addErrback(function(t){throw t})},_onReviveItems:function(t,e){if(!e)this._notifyOnDrawItems(t)},_notifyOnDrawItems:function(t){this._notify("onDrawItems"),this._drawItemsCallbackDebounce(t)},_clearItems:function(t){if(t=t||this._getItemsContainer(),!P(this._itemsInstances))for(var e in this._itemsInstances)if(this._itemsInstances.hasOwnProperty(e))this._itemsInstances[e].destroy();if(this._itemsInstances={},t.length){var i;if(t.get(0)==this._getItemsContainer().get(0))i=$(".controls-ListView__item, .controls-GroupBy",t.get(0)),this._destroyControls(i),i.remove();else this._destroyControls(t)}},_destroyInnerComponents:function(t,e){var i=this._destroyControls(t,e);if(!e)t.get(0).innerHTML="";return this._itemsInstances={},i},_destroyControls:function(t,e){var i=[],o=false;if($("[data-component]",t).each(function(t,s){var r=s.wsControl;if(r)if(!e){if(!o)S.ControlBatchUpdater.beginBatchUpdate("AreaAbstract_destroy");r.destroy(true),o=true}else i.push(r)}),o)S.ControlBatchUpdater.endBatchUpdate("AreaAbstract_destroy");return i},_isSlowDrawing:function(t){var e=!!this._options.itemTemplate;if(t)return e;else return e||!P(this._options.groupBy)},before:{init:function(){if(this._options.pageSize)this._limit=this._options.pageSize}},after:{_modifyOptions:function(t){return t.footerTpl=_.prepareTemplate(t.footerTpl),t},init:function(){if(this._options._items){if(!this._options._serverRender)this.redraw()}else if(this._dataSource&&!(this._options.dataSource&&false===this._options.dataSource.firstLoad))this.reload();if(this._options._serverRender)this._notifyOnDrawItems(),this._container.addClass("controls-ListView__dataLoaded").removeClass("controls-ListView__dataNotLoaded")},destroy:function(){if(this._cancelLoading(),this._unsetItemsEventHandlers(),this._options._items)this._options._items=null;if(this._options._itemsProjection)this._options._itemsProjection.destroy(),this._options._itemsProjection=null;this._clearItems(),this._itemData=null,this._dataSource=null}},_convertDataSourceToItems:function(t){return new a({source:t})},_bindHandlers:function(){this._onCollectionChange=R.bind(this),this._onBeforeCollectionChange=j.bind(this),this._onAfterCollectionChange=O.bind(this)},_setItemsEventHandlers:function(){this.subscribeTo(this._options._itemsProjection,"onCollectionChange",this._onCollectionChange),this.subscribeTo(this._options._itemsProjection,"onBeforeCollectionChange",this._onBeforeCollectionChange),this.subscribeTo(this._options._itemsProjection,"onAfterCollectionChange",this._onAfterCollectionChange)},_unsetItemsEventHandlers:function(){this.unsubscribeFrom(this._options._itemsProjection,"onCollectionChange",this._onCollectionChange),this.unsubscribeFrom(this._options._itemsProjection,"onBeforeCollectionChange",this._onBeforeCollectionChange),this.unsubscribeFrom(this._options._itemsProjection,"onAfterCollectionChange",this._onAfterCollectionChange)},setDataSource:function(t,e){if(this._prepareConfig(t),!e)return this.reload()},getDataSet:function(t){if(!t)u.logger.stack("SBIS3.CONTROLS/Mixins/ItemsControlMixin Получение DataSet явялется устаревшим функционалом используйте getItems()",1);return this._options._items},reloadItem:function(t,i){var o=this,s=this.getItems().getRecordById(t);if(this.getDataSource()&&s)return this.getDataSource().read(t,i).addCallback(function(t){s.merge(t)});else return e.success()},reload:T(function(t,i,o,s,r,n){var a,l=this,p="undefined"!==typeof t,_="undefined"!==typeof i,h="undefined"!==typeof o,u="undefined"!==typeof s;if(this._cancelLoading(),p)this.setFilter(t,true);if(_)this.setSorting(i,true);if(this._offset=h?o:this._offset,this._limit=u?s:this._limit,this._dataSource)this._toggleIndicator(true),this._notify("onBeforeDataLoad",this._getFilterForReload.apply(this,arguments),this.getSorting(),this._offset,this._limit),a=this._callQuery(this._getFilterForReload.apply(this,arguments),this.getSorting(),this._offset,this._limit).addCallback(y(function(t){if(l._toggleIndicator(false),l._notify("onDataLoad",t),l._onDataLoad(t),this.getItems()&&t.getModel()===this.getItems().getModel()&&Object.getPrototypeOf(t).constructor==Object.getPrototypeOf(t).constructor&&Object.getPrototypeOf(t.getAdapter()).constructor==Object.getPrototypeOf(this.getItems().getAdapter()).constructor)this._setNewDataAfterReload(t),l._drawItemsCallbackDebounce();else this._unsetItemsEventHandlers(),this._options._items=t,this._options._itemsProjection=this._options._createDefaultProjection.call(this,this._options._items,this._options),this._options._itemsProjection=this._options._applyGroupingToProjection(this._options._itemsProjection,this._options),this._setItemsEventHandlers(),this._notify("onItemsReady"),this._itemsReadyCallback(),l.redraw();return l._checkIdProperty(),this._dataLoadedCallback(n),t},l)).addErrback(function(t){if(!l.isDestroyed())l._loadErrorProcess(t);return t}),this._loader=a;else{if(this._options._itemsProjection)this._redraw();(a=new e).callback()}return this._notifyOnPropertyChanged("filter"),this._notifyOnPropertyChanged("sorting"),this._notifyOnPropertyChanged("offset"),this._notifyOnPropertyChanged("limit"),a}),_setNewDataAfterReload:function(t){var e=t.getMetaData();if(f.instanceOfModule(this.getDataSource(),"WS.Data/Source/Memory"))e=o(this._options._items.getMetaData(),t.getMetaData());this._options._items.setMetaData(e),this._options._items.assign(t)},_onDataLoad:function(){},_loadErrorProcess:function(t){var e=this;if(!t.canceled)if(this._toggleIndicator(false),true!==this._notify("onDataLoadError",t)&&!t._isOfflineMode)g.showMessageDialog({message:t.message,opener:e,status:"error"}),t.processed=true;return t},_getFilterForReload:function(){return this._options.filter},_getPropertyValue:function(){return this._options._propertyValueGetter.apply(this,arguments)},_callQuery:function(t,e,i,o,s){if(!this._dataSource)return;var r=this._getQueryForCall(t,e,i,o,s);return this._dataSource.query(r).addCallback(function(t){if(this._options.idProperty&&this._options.idProperty!==t.getIdProperty())t.setIdProperty(this._options.idProperty);return t.getAll()}.bind(this))},_getQueryForCall:function(t,e,i,o){var s=new n;return s.where(t).offset(i).limit(o).orderBy(e),s},_toggleIndicator:function(){},_toggleEmptyData:function(){},setPageSize:function(t,e){if(this._options.pageSize=t,this._dropPageSave(),this._notify("onPageSizeChange",this._options.pageSize),!e)this.reload(this._options.filter,this.getSorting(),0,t);else if(this._options.pageSize)this._limit=Number(this._options.pageSize)},getPageSize:function(){return this._options.pageSize},getFilter:function(){return this._options.filter},setFilter:function(t,e){if(this._options.filter=t,this._dropPageSave(),this._dataSource&&!e)this.reload(this._options.filter,this.getSorting(),0,this.getPageSize(),void 0,true);else this._notifyOnPropertyChanged("filter")},getSorting:function(){return this._options.sorting},setSorting:function(t,e){if(this._options.sorting=t,this._dropPageSave(),this._dataSource&&!e)this.reload(this._options.filter,this.getSorting(),0,this.getPageSize())},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t},_setPageSave:function(t){},_dropPageSave:function(){},_isLoading:function(){return i.resolve("ILogger").log("ListView","Метод _isLoading() будет удален в 3.7.4 используйте isLoading()"),this.isLoading()},isLoading:function(){return this._loader&&!this._loader.isReady(true)},_cancelLoading:function(){if(this.isLoading())this._loader.cancel();this._loader=null},getItems:function(){return this._options._items},_getItemsProjection:function(){return this._options._itemsProjection},setItems:function(t){if(this._options.items=t,this._unsetItemsEventHandlers(),this._options._items=null,this._prepareConfig(void 0,t),this._dataLoadedCallback(),t instanceof Array){if(this._options.pageSize&&t.length>this._options.pageSize)i.resolve("ILogger").log("ListView","Опция pageSize работает только при запросе данных через dataSource");if(!this._options.idProperty)this._options.idProperty=findIdProperty(this._options.items);this._dataSource=new s({data:this._options.items,idProperty:this._options.idProperty})}else this._notifyOnPropertyChanged("items");this.redraw()},_drawItemsCallbackSync:function(){this._needToRedraw=true},_drawItemsCallback:function(){},redraw:function(t){if(this._itemData=null,this._isSlowDrawing(this._options.easyGroup))this._oldRedraw();else if(this._getItemsProjection())this._redrawItems(t)},_redraw:function(){this.redraw()},_destroySearchBreadCrumbs:function(){},_getTargetContainer:function(t){return this._getItemsContainer()},_getItemsContainer:function(){return this._container},redrawItem:function(t,e){if(this._itemData=null,!this._isSlowDrawing(this._options.easyGroup)){if(e=e||this._getItemProjectionByItemId(t.getId()),e)this._redrawItem(e),this._notifyOnDrawItems()}else this._oldRedrawItemInner(t,e),this._reviveItems(t.getId()!=this._options.selectedKey)},_oldRedrawItemInner:function(t,e,i){e=e||this._getItemProjectionByItemId(t.getId());var o=this._getElementByModel(t),s=this._createItemInstance(e);return this._addItemAttributes(s,e),this._clearItems(o),o.after(s).remove(),true},_getElementByModel:function(t){return this._getItemsContainer().find('.js-controls-ListView__item[data-id="'+t.getId()+'"]')},_group:function(t,e,i){var o=this._options.groupBy,s,r,n=true;if(!P(o)&&this._canApplyGrouping(t))if(s=o.method.apply(this,[t.getContents(),e,i,t,this._options]),r="boolean"===typeof s?s:s instanceof Object&&s.hasOwnProperty("drawGroup")?!!s.drawGroup:false,n=s instanceof Object&&s.hasOwnProperty("drawItem")?!!s.drawItem:true,r)this._drawGroup(t.getContents(),e,i,t);return n},_drawGroup:function(e,i,o,s){var r=this._options.groupBy,n={columns:t(this._options.columns||[]),multiselect:this._options.multiselect,hierField:this._options.hierField+"@",parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty},a,l,p;if(a=this._getTargetContainer(e),n.item=e,n.colspan=n.columns.length+this._options.multiselect,p=_.prepareTemplate(r.template),l=this._buildTplItem(s,p(n)),l.addClass("controls-GroupBy").removeClass("controls-ListView__item"),this._appendItemTemplate(e,a,l,i),r.render&&"function"===typeof r.render)r.render.apply(this,[e,l,o])},setGroupBy:function(t,e){if(this._options.groupBy=t,!P(this._options.groupBy)&&!this._options.easyGroup){if(!this._options.groupBy.hasOwnProperty("method"))this._options.groupBy.method=_oldGroupByDefaultMethod;if(!this._options.groupBy.hasOwnProperty("template"))this._options.groupBy.template=this._getGroupTpl();if(!this._options.groupBy.hasOwnProperty("render"))this._options.groupBy.render=this._groupByDefaultRender}if(this._options.easyGroup&&this._getItemsProjection())applyGroupingToProjection(this._getItemsProjection(),this._options);if(e)this._redraw()},getGroupBy:function(){return this._options.groupBy},_getGroupTpl:function(){throw new Error("Method _getGroupTpl() must be implemented")},_groupByDefaultRender:function(){throw new Error("Method _groupByDefaultRender() must be implemented")},_fillItemInstances:function(){for(var t=this.getChildControls(),e=0;e<t.length;e++)if(t[e].getContainer().hasClass("controls-ListView__item")){var i=t[e].getContainer().attr("data-hash");if(this._getItemsProjection().getByHash(i))this._itemsInstances[i]=t[e]}},getItemsInstances:function(){if(P(this._itemsInstances))this._fillItemInstances();return this._itemsInstances},getItemInstance:function(t){var e=this._getItemProjectionByItemId(t);if(!e)return;return this.getItemsInstances()[e.getHash()]},_hasNextPage:function(t,e){e=void 0===e?this._offset:e;var i="boolean"!==typeof t?t>e+this._options.pageSize:!!t;if("Offset"==this._getSourceNavigationType())return i;else return e<0?false:i},_scrollTo:function t(e,i,o){if("string"===typeof e)e=$(e);m.scrollToElement(e,i,o)},_scrollToProjItem:function(t,e,i){var o=this._getDomElementByItem(t);if(o)this._scrollTo(o,e,i)},_scrollToItem:function(t,e,i){var o=$('.controls-ListView__item[data-id="'+t+'"]',this._getItemsContainer());if(o.length)this._scrollTo(o,e,i)},setEmptyHTML:function(t){this._options.emptyHTML=t},getDataSource:function(){return this._dataSource},setItemTpl:function(t){this._options.itemTpl=t},setKeyField:function(t){i.resolve("ILogger").log("ItemsControl","Метод setKeyField устарел, используйте setIdProperty"),this.setIdProperty(t)},setIdProperty:function(t){this._options.idProperty=t},setDisplayField:function(t){i.resolve("ILogger").log("ItemsControl","Метод setDisplayField устарел, используйте setDisplayProperty"),this._options.displayProperty=t},setDisplayProperty:function(t){this._options.displayProperty=t},setItemContentTpl:function(t){this._options.itemContentTpl=t},_getScrollContainer:function(){},_dataLoadedCallback:function(){},_itemsReadyCallback:function(){},_isCommonParent:function(t,e){var i=t.attr("data-parent-hash"),o=e.attr("data-parent-hash");return t.length?i===o:true},_isNeedToRedraw:function(){return!!this._getItemsContainer()&&(!this._isSlowDrawing(this._options.easyGroup)||this._needToRedraw)},_changeItemProperties:function(t,e){if(this._isSlowDrawing(this._options.easyGroup))return this._oldRedrawItemInner(t.getContents(),t);else return this._redrawItemInner(t)},_getItemContainerByIndex:function(t,e){return t.find("> .controls-ListView__item:eq("+e+")")},_getItemContainer:function(t,e){var i=this._getItemProjectionByItemId(e.get(this._options.idProperty));return i?t.find('[data-hash="'+i.getHash()+'"]'):$()},_oldRedraw:function(){var t;if(this._options._items)this._clearItems(),this._needToRedraw=false,t=this._options._getRecordsForRedraw.call(this,this._options._itemsProjection,this._options,true),this._toggleEmptyData(!t.length),this._drawItems(t);this._container.addClass("controls-ListView__dataLoaded").removeClass("controls-ListView__dataNotLoaded")},_drawItem:function(t,e,i){var o;if(false!==this._group(t,e,i))o=this._createItemInstance(t),this._addItemAttributes(o,t);return o},_drawAndAppendItem:function(t,e,i){var o=this._drawItem(t,e,i);if(o)this._appendItemTemplate(t,this._getTargetContainer(t.getContents()),o,e)},_getItemTemplate:function(t){if(this._options.itemTemplate)return this._options.itemTemplate;else if(this._options.itemTpl)return this._options.itemTpl;else return this._options._defaultItemTemplate},_drawItems:function(t,e){var i=e;if(t&&t.length>0){for(var o=0;o<t.length;o++){var s;if(t[o].getContents)s=t[o];else s=this._options._itemsProjection.getItemBySourceItem(t[o]);if(s)if(this._drawAndAppendItem(s,i,o===t.length-1),i&&i.at)i.at++}this.reviveComponents().addCallback(this._notifyOnDrawItems.bind(this)).addErrback(function(t){throw t})}else this._notifyOnDrawItems()},_normalizeItems:function(t){if(!f.instanceOfMixin(t,"WS.Data/Collection/IList"))return t;var e=[];return t.each(function(t){e.push(t)}),e},_buildTplItem:function(t,e){var i,o;if(void 0!==e)i=e;else i=this._getItemTemplate(t);if(o=_.prepareTemplate(i),"function"==typeof o){var s=this._prepareItemData(),r;if(s["projItem"]=t,s["item"]=t.getContents(),s["escapeHtml"]=I,r=o(s),r instanceof $)r=r.get(0).outerHTML;if(r.hasOwnProperty("html"))return $(r.html);return $(c.buildInnerComponents(r,this._options))}else throw new Error("Ошибка в itemTemplate")},_canApplyGrouping:function(t){return!P(this._options.groupBy)&&(0===this._options._itemsProjection.getSort().length||!t.isNode||!t.isNode())},_getGroupItems:function(t){return this._getItemsProjection().getGroupItems(t)},_addItem:function(t,e,i){var o=t.getContents(),s=this._canApplyGrouping(t),r=this._previousGroupBy,n=false;if(s){var a=this._options.groupBy.method,l=this._options._itemsProjection.getPrevious(t),p=this._options._itemsProjection.getNext(t);if(l)a.call(this,l.getContents(),void 0,void 0,l,this._options);if(a.call(this,o,void 0,void 0,t,this._options),p&&!a.call(this,p.getContents(),void 0,void 0,p,this._options))n=true}var _=this._getTargetContainer(o),h=this._getItemTemplate(t),u=this._buildTplItem(t,h);if(this._addItemAttributes(u,t),this._insertItemContainer(o,u,_,e,l,n),s)this._group(t,{at:e}),this._previousGroupBy=r;if(this._revivePackageParams.revive=true,this._revivePackageParams.light=false,!i)this._notifyOnDrawItems()},_insertItemContainer:function(t,e,i,o,s,r){var n=this._options.groupBy.method,a=o>0?this._getItemContainerByIndex(i,o-1):null;if(r)e.insertBefore(this._getItemContainerByIndex(i,o));else if(a&&a.length){if(s)n&&n.call(this,s.getContents(),void 0,void 0,s,this._options);e.insertAfter(a)}else if(0===o)this._previousGroupBy=void 0,e.prependTo(i);else e.appendTo(i)},_addItemAttributes:function(t,e){var i=e.getContents().getId();if(null==i)i+="";t.attr("data-id",i).addClass("controls-ListView__item"),t.attr("data-hash",e.getHash())},_createItemInstance:function(t){return this._buildTplItem(t,this._getItemTemplate(t))},_appendItemTemplate:function(t,e,i,o){if(o&&"undefined"!==typeof o.at){var s=0!==o.at&&$(".controls-ListView__item",this._getItemsContainer().get(0)).eq(o.at-1);if(s.length)s.after(i);else if(0==o.at)e.prepend(i);else if(s=$("> .controls-ListView__item",this._getItemsContainer().get(0)).eq(o.at),s.length)s.before(i);else e.append(i)}else e.append(i)},_onCollectionReplace:function(t){var e,i=false;for(e=0;e<t.length;e++)i=this._changeItemProperties(t[e])||i;this._revivePackageParams.revive=this._revivePackageParams.revive||i,this._revivePackageParams.light=false},_onCollectionReset:function(){this.redraw(true)},_onCollectionRemove:function(t,e){if(t.length)this._removeItems(t)},_onCollectionAddMoveRemove:function(t,e,i,o,s,r){if(this._onCollectionRemove(s,e===p.ACTION_MOVE),i.length)this._addItems(i,o);this._toggleEmptyData(!this._options._itemsProjection.getCount())},setItemsSortMethod:function(t){if(this._options.itemsSortMethod=t,this._options._itemsProjection)this._options._itemsProjection.setSort(t)},setItemsFilterMethod:function(t){if(this._options.itemsFilterMethod=t,this._options._itemsProjection)this._options._applyFilterToProjection(this._getItemsProjection(),this._options)},getLastItemByProjection:function(){if(this._options._itemsProjection&&this._options._itemsProjection.getCount())return this._options._itemsProjection.at(this._options._itemsProjection.getCount()-1).getContents()},_onUpdateItemProperty:function(t,e){var i;if(this._isNeedToRedraw())if(i=this._changeItemProperties(t,e),this._revivePackageParams.revive=this._revivePackageParams.revive||i,f.instanceOfModule(t,"WS.Data/Entity/Model"))this._revivePackageParams.light=this._revivePackageParams.light&&t.getContents().getId()!=this._options.selectedKey},_afterCollectionChange:function(){}},j=function(){if(this._revivePackageParams.processed)this._revivePackageParams={light:true,revive:false,processed:false}},G=function(t,e,i,o){this._onUpdateItemProperty(e,o)},R=function(t,e,i,o,s,r){if(this._isNeedToRedraw()){if(i.length>0)o=this._getItemsProjection().getIndex(i[0]);switch(e){case p.ACTION_ADD:case p.ACTION_MOVE:case p.ACTION_REMOVE:if(e===p.ACTION_MOVE&&(!P(this._options.groupBy)||this._isSearchMode()))this.redraw();else this._onCollectionAddMoveRemove.apply(this,arguments);break;case p.ACTION_CHANGE:i.forEach(function(e,s){G.call(this,t,e,o+s,i.properties)},this);break;case p.ACTION_REPLACE:this._onCollectionReplace(i);break;case p.ACTION_RESET:this._onCollectionReset()}}},O=function(){if(false!==this._revivePackageParams.revive)this._reviveItems(this._revivePackageParams.light);else this._notifyOnDrawItems(this._revivePackageParams.light);this._revivePackageParams.processed=true,this._afterCollectionChange()};return b});
//# sourceMappingURL=ItemsControlMixin.js.map
define("SBIS3.CONTROLS/Utils/HtmlDecorators/HtmlDecorators",["Core/core-extend","WS.Data/Utils"],function(t,o){"use strict";var r="text",s="attr",i=t({},{$protected:{_kinds:{},_options:{_decorators:{}}},$constructor:function(){},destroy:function(){for(var t in this._options._decorators)if(this._options._decorators.hasOwnProperty(t))for(var o=0;o<this._options._decorators[t].length;o++)this._options._decorators[t][o].destroy()},add:function(t,o,s){if(o=this._getDefaultArea(o),s=s||r,void 0===this._options._decorators[o])this._options._decorators[o]=[],this._kinds[o]=s;else if(this._kinds[o]!==s)throw new Error("Area kind mismatch.");this._options._decorators[o].push(t)},getByName:function(t){for(var o in this._options._decorators)if(this._options._decorators.hasOwnProperty(o))for(var r=0;r<this._options._decorators[o].length;r++)if(this._options._decorators[o][r].getName()==t)return this._options._decorators[o][r]},update:function(t){for(var o in this._options._decorators)if(this._options._decorators.hasOwnProperty(o))for(var r=0;r<this._options._decorators[o].length;r++)this._options._decorators[o][r].update(t)},applyIf:function(t,r,s){return o.logger.stack("SBIS3.CONTROLS/Utils/HtmlDecorators/HtmlDecorators Опция applyIf не поддерживается с 3.7.3.100, вместо нее используйте applyOnly",1),this.applyOnly.apply(this,arguments)},applyOnly:function(t,o){var r=[];if("object"===typeof o)return r=this.setConditions(o),this._applyDecorators(t,"",r);if("function"===typeof o?o(t):o)return this.apply(t,area)},setConditions:function(t){var o=[];for(var r in this._options._decorators)if(this._options._decorators.hasOwnProperty(r))for(var s=0;s<this._options._decorators[r].length;s++)if(this._options._decorators[r][s].checkCondition(t))o.push(this._options._decorators[r][s]);return o},apply:function(t,o){if(this._kinds[o]===s&&"object"!==typeof t)throw new Error("The value must be instance of an Object for attribute decorators");return this._applyDecorators(t,o)},_applyDecorators:function(t,o,r){o=this._getDefaultArea(o);for(var s=r||this._getByArea(o),i=0,e=s.length;i<e;i++)if(s[i].isEnabled())t=s[i].apply(t);return this._render(t,o)},_render:function(t,o){if(o=this._getDefaultArea(o),this._kinds[o]===s){var r=[];for(var i in t)if(t.hasOwnProperty(i))r.push(i+'="'+t[i]+'"');return r.join(" ")}return t},_getByArea:function(t){if(t=this._getDefaultArea(t),this._options._decorators[t])return this._options._decorators[t];return[]},_getDefaultArea:function(t){return t||""}});return i.AREA_KIND_TEXT=r,i.AREA_KIND_ATTR=s,i});
//# sourceMappingURL=HtmlDecorators.js.map
define("SBIS3.CONTROLS/Utils/HtmlDecorators/AbstractDecorator",["Core/core-extend"],function(t){"use strict";return t({},{$protected:{_options:{enabled:true,enabledGetter:""}},$constructor:function(){},destroy:function(){},setConditions:function(){},checkCondition:function(t){},getName:function(){return this._name},update:function(t){if(this._options.enabledGetter)this._options.enabled=t[this._options.enabledGetter]()},apply:function(t){return t},setEnabled:function(t){this._options.enabled=!!t},isEnabled:function(){return this._options.enabled}})});
//# sourceMappingURL=AbstractDecorator.js.map
define("SBIS3.CONTROLS/Utils/HtmlDecorators/HighlightDecorator",["SBIS3.CONTROLS/Utils/HtmlDecorators/AbstractDecorator","Core/markup/ParserUtilities","Core/core-instance","Core/helpers/String/escapeHtml"],function(t,e,i,r){"use strict";var s=t.extend({$protected:{_name:"highlight",_options:{cssClass:"controls-HtmlDecorators-highlight",textGetter:""},_text:""},$constructor:function(){},update:function(t){if(s.superclass.update.apply(this,arguments),this._options.textGetter)this._text=t[this._options.textGetter]()},checkCondition:function(t){return t?!!t["highlight"]:false},apply:function(t){if(!this._options.enabled)return t;return this.getHighlighted(t,this._text,this._options.cssClass)},getHighlighted:function(t,s,o){if(!t||!s)return t;if(i.instanceOfModule(t,"WS.Data/Type/Enum"))t=t.toString();return t=e.parse(t),s=r(""+s).replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n(t,new RegExp(s,"gi"),o),t.innerHTML()}});function n(t,e,i){var r=0;if(t.childNodes)for(var s=t.childNodes.length-1;s>=0;s--)n(t.childNodes[s],e,i);if(t.text)t.text=t.text.replace(e,'<span class="'+i+'">$&</span>')}return s});
//# sourceMappingURL=HighlightDecorator.js.map
define("SBIS3.CONTROLS/Utils/HtmlDecorators/ColorMarkDecorator",["SBIS3.CONTROLS/Utils/HtmlDecorators/AbstractDecorator"],function(t){"use strict";var e=134217728,r=67108864,i=33554432,o=16777216;return t.extend({$protected:{_name:"colorMark",_options:{}},$constructor:function(){},apply:function(t){return t?this.specToStyle(t):t},specToStyle:function(t){var e=this.specToObject(t),r;if(r=["color: "+e.color],e.isBold)r.push("font-weight: bold");if(e.isItalic)r.push("font-style: italic");if(e.isUnderline||e.isStrike)r.push("text-decoration: "+[e.isUnderline?"underline":"",e.isStrike?"line-through":""].join(" "));return r.join(";")},specToObject:function(t){return t=this.specToNumber(t),{color:"#"+this.lPad3b((16777215&t).toString(16)).toLowerCase(),isBold:!!(t&e),isItalic:!!(t&r),isUnderline:!!(t&i),isStrike:!!(t&o)}},specToNumber:function(t){if(!t)return 0;else if("string"===typeof t){if(t=Number(t),isNaN(t))t=0}else if("object"===typeof t){var n=Number((t.color||"0").replace("#","0x"));return n|=t.isBold?e:0,n|=t.isItalic?r:0,n|=t.isUnderline?i:0,n|=t.isStrike?o:0,n}return t},lPad3b:function(t){return"000000".substr(0,6-t.length)+t}})});
//# sourceMappingURL=ColorMarkDecorator.js.map
define("SBIS3.CONTROLS/Mixins/DecorableMixin",["SBIS3.CONTROLS/Utils/HtmlDecorators/HtmlDecorators","SBIS3.CONTROLS/Utils/HtmlDecorators/HighlightDecorator","SBIS3.CONTROLS/Utils/HtmlDecorators/ColorMarkDecorator"],function(t,i,o){"use strict";return{$protected:{_options:{_decorators:null,highlightEnabled:false,highlightText:"",colorMarkEnabled:false,colorField:""}},around:{_modifyOptions:function(e,r){for(var n=[],l=1;l<arguments.length;l++)n.push(arguments[l]);var s=e.apply(this,n);return s._decorators=new t,s._decorators.add(new i({enabledGetter:"isHighlightEnabled",textGetter:"getHighlightText"})),s._decorators.add(new o({enabledGetter:"isColorMarkEnabled"}),"color"),s}},before:{destroy:function(){this._options._decorators.destroy()},redraw:function(){this._options._decorators.update(this)}},after:{},isHighlightEnabled:function(){return this._options.highlightEnabled},setHighlightEnabled:function(t,i){if(this._options.highlightEnabled===t)return;if(this._options.highlightEnabled=t,i)this._redraw()},getHighlightText:function(){return this._options.highlightText},setHighlightText:function(t,i){if(i=void 0===i?true:i,this._options.highlightText===t)return;if(this._options.highlightText=t,i)this._redraw()},isColorMarkEnabled:function(){return this._options.colorMarkEnabled},setColorMarkEnabled:function(t){if(this._options.colorMarkEnabled===t)return;this._options.colorMarkEnabled=t,this._redraw()},getColorField:function(){return this._options.colorField},setColorField:function(t,i){if(i=void 0===i?true:i,this._options.colorField===t)return;if(this._options.colorField=t,i)this._redraw()}}});
//# sourceMappingURL=DecorableMixin.js.map
define("Core/helpers/String/escapeUnicode",function(){return function(){var r={8210:45,1105:1105,8470:8470,187:187,171:171};return function(n){for(var e=[],i=0;i<n.length;i++){var o=n.toString().charCodeAt(i);if(o<128||o>=1025&&o<1104)e.push(String.fromCharCode(o));else if(o in r)e.push(String.fromCharCode(r[o]))}return e.join("")}}()});
//# sourceMappingURL=escapeUnicode.js.map
define("SBIS3.CONTROLS/BreadCrumbs",["Lib/Control/CompoundControl/CompoundControl","SBIS3.CONTROLS/Mixins/ItemsControlMixin","SBIS3.CONTROLS/Mixins/PickerMixin","SBIS3.CONTROLS/Mixins/DecorableMixin","tmpl!SBIS3.CONTROLS/BreadCrumbs/BreadCrumbs","tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/itemContentTpl","tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/dotsTpl","tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/itemTpl","tmpl!SBIS3.CONTROLS/BreadCrumbs/resources/menuItem","Core/helpers/String/escapeHtml","Core/helpers/String/escapeUnicode","Core/IoC","Core/helpers/Function/memoize","css!SBIS3.CONTROLS/BreadCrumbs/BreadCrumbs","css!SBIS3.CONTROLS/Menu/Menu","css!SBIS3.CONTROLS/Menu/MenuItem/MenuItem"],function(t,i,e,s,r,o,n,d,a,h,l,c,_){"use strict";var u=36,m=t.extend([i,e,s],{_dotTplFn:r,$protected:{_resizeTimeout:null,_dropdownWidth:null,_homeIcon:void 0,_sizesInited:false,_arrowWidth:0,_homeIconWidth:0,_dotsWidth:0,_paddings:void 0,_BCmargins:void 0,_options:{idProperty:"id",displayField:"",displayProperty:"title",itemTpl:d,itemContentTpl:o,_defaultItemContentTemplate:o,_defaultItemTemplate:d,pickerClassName:"controls-Menu__Popup controls-BreadCrumbs "}},_modifyOptions:function(t){var i=m.superclass._modifyOptions.apply(this,arguments);if(!t.items||0!==t.length)i.visible=false;if(t.keyField)c.resolve("ILogger").log("BreadCrumbs","Опция keyField является устаревшей, используйте idProperty"),t.idProperty=t.keyField;if(t.displayField)c.resolve("ILogger").log("BreadCrumbs","Опция displayField является устаревшей, используйте displayProperty"),t.displayProperty=t.displayField;return i},$constructor:function(){this._publish("onItemClick"),this._homeIcon=$(".controls-BreadCrumbs__crumb-home",this._container),this.toggle(this.getItems()&&0===this.getItems().getCount()),this.getContainer().on("mousedown",this._onMousedownHandler)},_onMousedownHandler:function(t){t.stopPropagation()},_onClickHandler:function(t,i){var e,s,r,o,n;if(this.isEnabled()){m.superclass._onClickHandler.apply(this,arguments);var d=$(t.target).closest(".js-controls-BreadCrumbs__crumb");if(d.hasClass("controls-BreadCrumbs__dots"))this._dotsClickHandler(),t.stopPropagation();else if(d.length){e=d.data("id"),s=[],r=this.getItems(),n=0;do{o=r.at(n),s.push(o.getId()),n++}while(o.getId()!=e&&n<r.getCount());if(this._notify("onItemClick",e),this._options.command)this.sendCommand(this._options.command,e,s);t.stopPropagation()}if(this._picker&&this._picker.isVisible()&&i)this._picker.hide()}},_dotsClickHandler:function(){if(this._picker)this._picker.setTarget(this._dots);if(this.togglePicker(),this._picker&&this._picker.isVisible())this._redrawDropdown()},_toggleHomeIcon:function(t){if(this._homeIcon)this._homeIcon.toggleClass("ws-hidden",t)},_getElementToFocus:function(){return this._container},_setPickerConfig:function(){return{target:this._dots,corner:"bl",verticalAlign:{side:"top"},horizontalAlign:{side:"left"},closeByExternalClick:true,targetPart:true}},_setPickerContent:function(){var t=this;this._redrawDropdown(),this._picker._container.bind("mouseup",function(i){t._onClickHandler(i,true)})},_redrawDropdown:function(){var t=this;if(this._picker){var i=this._picker._container.width(),e=0,s=[];if(this._picker.getContainer().empty(),this.getItems().each(function(i){if(i.get(t._options.idProperty)){var r={decorators:t._options._decorators,colorField:t._options.colorField?i.get(t._options.colorField):"",record:i,idProperty:t._options.idProperty,displayProperty:t._options.displayProperty,wrappersCount:e};s.push(a(r)),e++}}),this.getPicker().getContainer().append(s.join("")),i!==this._dropdownWidth)this._picker.recalcPosition(true),this._dropdownWidth=i}},_onResizeHandler:function(){var t=this._getContainerWidth();if(this._prewContainerWidth!=t)this.redraw(),this._prewContainerWidth=t},_calculateSizes:function(){this._initNonTextElementSizes(),this._paddings=void 0===this._paddings?this._container.innerWidth()-this._container.width():this._paddings,this._BCmargins=void 0===this._BCmargins?this._container.outerWidth(true)-this._container.outerWidth():this._BCmargins;var t=this._getTargetContainer(),i=this._getContainerWidth(),e=$(".controls-BreadCrumbs__crumb",t),s=e.length-1;if(!e.length||0==i)return;if(t.width()+this._homeIconWidth>=i&&e.length>2)for($(e[s-1]).before(this._dots),s;s>1;s--){if(t.width()+this._homeIconWidth<i||1==s)break;e[s-1].className+=" ws-hidden"}if(e=$(".controls-BreadCrumbs__crumb",t).not(".ws-hidden").not(".controls-BreadCrumbs__dots"),t.outerWidth(true)+this._homeIconWidth>=i){var r=$(".controls-BreadCrumbs__dots",this._container).outerWidth(true)||0,o=this._homeIconWidth+r+this._arrowWidth,n=Math.floor((i-o)/2);if(2==e.length){var d=e.eq(0),a=d.width(),h=e.eq(1),l=h.width();if(a>n&&l>n)$(".controls-BreadCrumbs__title",e).css("max-width",n);else if(a>n)$(".controls-BreadCrumbs__title",d).css("max-width",i-o-l-this._getAdditionalCrumbWidth(d));else $(".controls-BreadCrumbs__title",h).css("max-width",i-o-a-this._getAdditionalCrumbWidth(h))}else $(".controls-BreadCrumbs__title",e).css("max-width",i-o-this._getAdditionalCrumbWidth(e))}var c=$(".controls-BreadCrumbs__crumb.ws-hidden",t),_=c.first(),m=i-t.outerWidth(true)-this._homeIconWidth-this._arrowWidth-20;if(c.length&&m>u)if($(".controls-BreadCrumbs__title",_).css("max-width",m),_.removeClass("ws-hidden"),c.length>1)this._dots.insertAfter(_);else this._dots.detach()},_getAdditionalCrumbWidth:function(t){return t.width()-$(".controls-BreadCrumbs__title",t).width()},redraw:function(){var t=!this.getItems()||this.getItems()&&0===this.getItems().getCount();if(this._toggleHomeIcon(t),this.toggle(!t),this._dots)this._dots.detach();else this._dots=$(n());if(m.superclass.redraw.call(this),this.getItems()&&this.getItems().getCount()&&this.isVisible())this._calculateSizes()},_initNonTextElementSizes:function(){if(!this._homeIconWidth||!this._arrowWidth)this._homeIconWidth=$(".controls-BreadCrumbs__crumb-home",this._container).outerWidth(true),this._arrowWidth=$(".controls-BreadCrumbs__arrow",this._container).last(0).outerWidth(true)},_buildTplArgs:function(t){var i=m.superclass._buildTplArgs.apply(this,arguments);return i.decorators=this._options._decorators,i.escapeHtml=h,i.escapeUnicode=l,i},_getContainerWidth:function(){var t=parseFloat(this._container.css("max-width")),i=this._container[0].getBoundingClientRect();return t?t:Math.ceil(Math.abs(i.left-i.right)-this._paddings-this._BCmargins)},_getItemsContainer:_(function(){return $(".controls-BreadCrumbs__itemsContainer",this._container)},"_getItemsContainer"),destroy:function(){this.getContainer().off("mousedown",this._onMousedownHandler),m.superclass.destroy.apply(this,arguments)}});return m});
//# sourceMappingURL=BreadCrumbs.js.map
define("SBIS3.CONTROLS/Mixins/TreeMixin",["Core/core-clone","Core/core-merge","SBIS3.CONTROLS/Utils/TreeDataReload","Core/constants","Core/CommandDispatcher","Core/Deferred","WS.Data/Display/Tree","tmpl!SBIS3.CONTROLS/Mixins/TreeMixin/resources/searchRender","WS.Data/Entity/Model","WS.Data/Relation/Hierarchy","Core/core-instance","SBIS3.CONTROLS/Utils/TemplateUtil","Core/helpers/Function/forAliveOnly","Core/IoC","Core/helpers/Object/isEmpty","Core/helpers/Object/isPlainObject","Core/helpers/Function/runDelayed","SBIS3.CONTROLS/BreadCrumbs","tmpl!SBIS3.CONTROLS/DataGridView/resources/DataGridViewGroupBy","WS.Data/Adapter/Sbis"],function(e,t,i,o,r,s,n,a,l,d,h,p,c,u,f,_,g){var y=function(e,t){var i,o,r,s=[];if("undefined"!=typeof t.currentRoot)i=t.currentRoot;else if("undefined"!=typeof t.root)i=t.root;else i=null;if(r=_(i),r)(i=l.fromObject(i,"adapter.sbis")).setIdProperty(t.idProperty);if("folders"==t.displayType)s.push(T.bind(this));else s.push(S.bind(t));if(t.itemsFilterMethod)s.push(t.itemsFilterMethod);var a={collection:e,idProperty:t.idProperty||(t.dataSource?t.dataSource.getIdProperty():""),parentProperty:t.parentProperty,nodeProperty:t.nodeProperty,loadedProperty:"!"+t.hasChildrenProperty,unique:true,root:i,rootEnumerable:r,filter:s,sort:t.itemsSortMethod};if("append"==t.loadItemsStrategy)a.unique=false;return o=new n(a),o},m=function(e,t){var i=e.item.isNode();if(i===t.item.isNode())return e.index>t.index?1:-1;else return i?-1:1},P=function(e){return{idProperty:e.idProperty,displayProperty:e.displayProperty,highlightEnabled:e.highlightEnabled,highlightText:e.highlightText,colorMarkEnabled:e.colorMarkEnabled,colorField:e.colorField,allowEnterToFolder:e.allowEnterToFolder,task1173671799:e.task1173671799}},I=function(i,o){var r=[],s,n,a=[],l;function d(i,o,r){if(o.length){var s=r._buildTplArgs(r),n=o[o.length-1];if(s.projItem=n.projItem,s.item=s.projItem.getContents(),s.className="controls-HierarchyDataGridView__path",r._searchFolders[s.item.get(r.idProperty)]=true,s.itemContent=p.prepareTemplate(r._defaultSearchRender),s.bcTpls={},r.hierarchyViewModeItemTpl||r.hierarchyViewModeItemContentTpl)s.bcTpls.itemTpl=p.prepareTemplate(r.hierarchyViewModeItemTpl),s.bcTpls.itemContentTpl=p.prepareTemplate(r.hierarchyViewModeItemContentTpl);t(s,{path:e(o),viewCfg:r._getSearchCfg(r)}),i.push({tpl:s.itemTpl,data:s})}}var c;if(i instanceof Array)c=function(e){i.forEach(e)};else c=i.each.bind(i);if(c(function(e){if(h.instanceOfModule(e,"WS.Data/Display/GroupItem"))return;if(e.getParent()!=s&&a.length){if(s!=n)d(r,a,o),n=s;while(a.length>0){if(s=a[a.length-1]["projItem"],e.getParent()==s)break;a.pop()}}function t(e){var t=e.getContents(),i={};return i[o.idProperty]=t.getId(),i[o.displayProperty]=t.get(o.displayProperty),i["projItem"]=e,i["item"]=t,i}if(e.isNode()){if(e.getParent()!=s&&!a.length){l=e.getParent();while(l&&!l.isRoot())a.unshift(t(l)),s=l,l=l.getParent()}a.push(t(e)),s=e}else{if(s!=n)d(r,a,o),n=s;r.push(e)}}),a.length&&s!=n)d(r,a,o),n=s;return r},C=function(e,t,i){var o=i._getHierarchyRelation(i);function r(e){var t;if(o)t=o.hasParent(e,i._items)?o.getParent(e,i._items):null;return void 0!==t?null===t?"@":t.get(i.idProperty)+r(t):""}return r(e)+t},v=function(e,t){var i,o=[],r=[],s;if(s=w(e,false),t.expand||t.hierarchyViewMode)b(e,t);else M(e,t);if(D(e,s,false),t._searchFolders={},t.hasNodes=false,t.hierarchyViewMode)r=I(e,t);else{var n=false,a,l;e.each(function(e){if(h.instanceOfModule(e,"WS.Data/Display/GroupItem"))a=e.getContents(),l=e.getHash(),n=true;else{if(e.isNode())t.hasNodes=true;if(!f(t.groupBy)&&t.easyGroup)if(t._canApplyGrouping(e,t)&&n&&a)t._groupItemProcessing(a,r,e,t,l),n=false;if(t._hasFolderFooters(t)){if(o.length)if(e.getLevel()<i.getLevel())r.push({tpl:t._footerWrapperTemplate,data:t._getFolderFooterOptions(t,o.pop())});if(e.isNode()&&e.isExpanded())o.push(e);i=e}r.push(e)}})}return r},R=function(e,t){if(t&&true!==e.isNode())return false;var i=e.getParent();return i?i.isExpanded()?R(i):false:true},S=function(e,t,i,o,r){var s,n;if(!i.getParent)return r;return s=i.getParent(),n=s&&s.getContents(),this.hierarchyViewMode&&h.instanceOfModule(n,"WS.Data/Entity/Record")&&(false!==s.isNode()||this.task1174261549)||R(i)},T=function(e,t,i){return this._isSearchMode&&this._isSearchMode()||R(i,true)},w=function(e,t){var i=e.getFilter();return e.setEventRaising(false,t),e.setFilter(function(){return true}),i},D=function(e,t,i){e.setFilter(t),e.setEventRaising(true,i)},M=function(e,t){var i,o;for(i in t.openedPath)if(t.openedPath.hasOwnProperty(i))if(o=e.getItemBySourceItem(t._items.getRecordById(i)),o){if(!o.isExpanded()){var r=e.getCollection();if(new d({idProperty:r.getIdProperty(),parentProperty:e.getParentProperty()}).getChildren(o.getContents().getId(),e.getCollection()).length)o.setExpanded(true);else delete t.openedPath[i]}}else delete t.openedPath[i]},x=function(e,t){var i=[];if("folders"==t.displayType)i.push(T.bind(this));else i.push(S.bind(t));if(t.itemsFilterMethod)i.push(t.itemsFilterMethod);e.setFilter(i)},b=function(e,t){for(var i=e.getCollection(),o=e.getItems(),r=new d({idProperty:i.getIdProperty(),parentProperty:e.getParentProperty()}),s,n,a=0;a<o.length;a++)if(s=o[a],!h.instanceOfModule(s,"WS.Data/Display/GroupItem")&&s.isNode()&&!s.isExpanded())if(n=s.getContents().getId(),r.getChildren(n,i).length){if(t.expand)t.openedPath[n]=true;if(s.setExpanded(true),s.setLoaded(true),t.singleExpand)return}},F=function(e){var t=e._buildTplArgsLV.call(this,e);return t.displayType=e.displayType,t.hierField=e.hierField,t.parentProperty=e.parentProperty,t.nodeProperty=e.nodeProperty,t.isSearch=e.hierarchyViewMode,t.hasNodes=e.hasNodes,t.getItemTemplateData=e._getItemTemplateData,t.hierarchy=new d({idProperty:e.idProperty,parentProperty:e.parentProperty}),t},E=function(e){var t=e._items,i=e._itemsProjection,o=e._getHierarchyRelation(e),r=false,s=0,n=i.getCount(),a,l;while(s<n&&!r){if(l=i.at(s),e.partialyReload&&!l.isLoaded())r=!!l.getContents().get(e.hasChildrenProperty);else if(a=o.getChildren(l.getContents().getId(),t),a.length)r=true;s++}return r},N=function(e){var t=e._items;return new d({idProperty:t?t.getIdProperty():"",parentProperty:e.parentProperty,nodeProperty:e.nodeProperty})};return getItemTemplateData=function(e){return{nodePropertyValue:e.item.get(e.nodeProperty),projection:e.projItem.getOwner(),padding:e.paddingSize*(e.projItem.getLevel()-1)+e.originallPadding}},{$protected:{_options:{_hasNodeWithChild:E,_folderOffsets:{},_folderHasMore:{},_prepareGroupId:C,_buildTplArgs:F,_buildTplArgsTV:F,_getItemTemplateData:getItemTemplateData,_getHierarchyRelation:N,_defaultSearchRender:a,_getSearchCfgTv:P,_getSearchCfg:P,_searchFolders:{},_getRecordsForRedraw:v,_getRecordsForRedrawTree:v,_createDefaultProjection:y,_curRoot:null,expanderDisplayMode:"always",currentRoot:null,root:void 0,hierField:null,parentProperty:null,nodeProperty:null,hasChildrenProperty:null,displayType:"all",singleExpand:false,expand:false,partialyReload:true,deepReload:false,openedPath:{},allowEnterToFolder:true,itemsSortMethod:m,_applyFilterToProjection:x,hierarchyViewMode:false,hierarchyViewModeItemTpl:"",hierarchyViewModeItemContentTpl:"",loadItemsStrategy:"merge",task1174261549:false},_lastParent:void 0,_lastDrawn:void 0,_lastPath:[],_loadedNodes:{},_previousRoot:void 0,_hier:[],_hierPages:{}},$constructor:function(){var e=this.getFilter()||{};if(this._publish("onSearchPathClick","onNodeExpand","onNodeCollapse","onSetRoot","onBeforeSetRoot"),"undefined"!=typeof this._options.root)e[this._options.parentProperty]=this._options.root;if(this._options.expand)e["Разворот"]="С разворотом",e["ВидДерева"]="С узлами и листьями";this.setFilter(e,true),r.declareCommand(this,"BreadCrumbsItemClick",this._breadCrumbsItemClick)},setHierField:function(e){u.resolve("ILogger").log("TreeMixin","Метод setHierField устарел, используйте setParentProperty/setNodeProperty"),this.setParentProperty(e)},getHierField:function(){return u.resolve("ILogger").log("TreeMixin","Метод getHierField устарел, используйте getParentProperty/getNodeProperty"),this.getParentProperty()},setParentProperty:function(e){this._options.parentProperty=e},getParentProperty:function(){return this._options.parentProperty},setNodeProperty:function(e){this._options.nodeProperty=e},getNodeProperty:function(){return this._options.nodeProperty},collapseNode:function(e,t){var i;if(t)i=this._getItemsProjection().getByHash(t);else i=this._getItemProjectionByItemId(e);if(i)return delete this._options.openedPath[e],i.setExpanded(false),s.success();else return s.fail()},toggleNode:function(e,t){var i;if(t)i=this._getItemsProjection().getByHash(t);else i=this._getItemProjectionByItemId(e);if(i)return this[i.isExpanded()?"collapseNode":"expandNode"](e,t);else return s.fail()},expandNode:function(e,t){var i,o={};if(t)i=this._getItemsProjection().getByHash(t);else i=this._getItemProjectionByItemId(e);if(i)if(i.isExpanded())return s.success();else{if(this._options.singleExpand)o[e]=true,this._collapseNodes(this.getOpenedPath(),o);return this._options.openedPath[e]=true,this._loadNode(e).addCallback(c(function(){var i;if(t)i=this._getItemsProjection().getByHash(t);else i=this._getItemProjectionByItemId(e);i.setExpanded(true)}).bind(this))}else return s.fail()},_loadNode:function(e){if(this._dataSource&&!this._loadedNodes[e]&&this._options.partialyReload)return this._toggleIndicator(true),this._notify("onBeforeDataLoad",this._createTreeFilter(e),this.getSorting(),0,this._limit),this._callQuery(this._createTreeFilter(e),this.getSorting(),0,this._limit).addCallback(c(function(t){if(this._options._folderHasMore[e]=t.getMetaData().more,this._options._folderOffsets[e]=0,this._loadedNodes[e]=true,this._notify("onDataMerge",t),this._onDataMergeCallback(t),"merge"==this._options.loadItemsStrategy)this._options._items.merge(t,{remove:false});else this._options._items.append(t);this._getItemProjectionByItemId(e).setLoaded(true),this._dataLoadedCallback()}).bind(this)).addBoth(function(e){return this._toggleIndicator(false),e}.bind(this));else return s.success()},_redrawHierarchyPathItem:function(e){var t=e.getContents(),i=t.getId();this._container.find('[data-id="'+i+'"]').parents(".controls-TreeView__searchBreadCrumbs").each(function(e,o){var r=o.wsControl;r.getItems().getRecordById(i).merge(t),r.redraw()})},_breadCrumbsItemClick:function(e,i){var o=this;if(false!==this._notify("onSearchPathClick",e)){var r=t(this.getFilter(),{"Разворот":"Без разворота"});if(r[this._searchParamName]=void 0,this.setInfiniteScroll(this._options.infiniteScroll,true),this.setHighlightText("",false),this.setFilter(r,true),this._options.hierarchyViewMode=false,this._options.task1173671799&&!this._options.allowEnterToFolder)i.forEach(function(e){o._options.openedPath[e]=true}),this.setCurrentRoot(this.getRoot()),this.reload(void 0,void 0,void 0,void 0,true);else this.setCurrentRoot(e),this.reload()}},_isVisibleItem:function(e,t){if(t&&true!==e.isNode())return false;var i=e.getParent();return i?i.isExpanded()?this._isVisibleItem(i):false:true},_getGroupItems:function(e){for(var t=[],i=this._getItemsProjection().getGroupItems(e),o=0;o<i.length;o++)if(this._canApplyGrouping(i[o]))t.push(i[o]);return t},_getItemsForRedrawOnAdd:function(e){var t=[],i=0,o,r,s,n;if(this._options.hierarchyViewMode){if(t=I(e,this._options),s=this._getItemsContainer().find(">.controls-ListView__item:last"),s.hasClass("controls-HierarchyDataGridView__path"))if(n=s.find(".controls-BreadCrumbs").wsControl(),t[0].data&&n.getItems().at(0).getId()===t[0].data.path[0]["Id"])n.setItems(t[0].data.path),t.shift()}else if(e.length&&h.instanceOfModule(e[0],"WS.Data/Display/GroupItem")){if(o=e[0].getContents(),r=e[0].getHash(),false!==o&&e.length>1&&this._canApplyGrouping(e[1]))this._options._groupItemProcessing(o,t,e[1],this._options,r);e.splice(0,1),t=t.concat(e)}else for(var a=i;a<e.length;a++)if(this._isVisibleItem(e[a]))t.push(e[a]);return t},_createTreeFilter:function(t){var i=e(this.getFilter())||{};if(this._options.expand)i["Разворот"]="С разворотом",i["ВидДерева"]="Узлы и листья",this.setFilter(e(i),true);return i[this._options.parentProperty]=t,i},_collapseNodes:function(e,t){for(var i in e)if(e.hasOwnProperty(i))if(!t||!t[i])this.collapseNode(i)},getOpenedPath:function(){return this._options.openedPath},setOpenedPath:function(t){var i=this._getItemsProjection(),o;if(i)o=w(i,true),this._collapseNodes(this.getOpenedPath(),t),this._options.openedPath=e(t),M(i,this._options),D(i,o,true);else this._options.openedPath=e(t)},_removeFromLoadedRemoteNodes:function(e){var t=false;if(e.length)for(var i=0;i<e.length;i++)if(!h.instanceOfModule(e[0],"WS.Data/Display/GroupItem"))if(t||!this.getItems().getRecordById(e[0].getContents().getId()))t=true,delete this._loadedNodes[e[i].getContents().getId()];else break},around:{_prepareClassesByConfig:function(e,t){if(e(t),"withChild"===t.expanderDisplayMode){if(t.preparedClasses+=" controls-TreeView__hideExpanderEmptyNodes",t._items&&!t._hasNodeWithChild(t))t.preparedClasses+=" controls-TreeView__hideExpands"}else if("never"===t.expanderDisplayMode)t.preparedClasses+=" controls-TreeView__hideExpands"},reloadItem:function(t,o,r,n){var a=this,l=this._options.selectedKey,d=this.getItems(),h=d.getRecordById(o),p=this._options._getHierarchyRelation(this._options),c=this.getNodeProperty(),u;if("inside"===n)if(h)return u=e(this.getFilter()),u[this.getParentProperty()]="null"===o?null:o,u.reloadableNodes=i.prepareReloadableNodes({direction:n,hierarchyRelation:p,item:h,items:d,nodeProperty:c}),this._notify("onBeforeDataLoad",u,this.getSorting(),this._offset,this._limit),this._callQuery(u,this.getSorting(),this._offset,this._limit).addCallback(function(e){i.applyUpdatedData({direction:n,hierarchyRelation:p,item:h,items:d,nodeProperty:c,updatedItems:e}),a.setSelectedKey(l)});else return s.success();else return t.call(this,o,r)},_getItemProjectionByItemId:function(e,t){var i;if(_(this._options.root))if(i=this._getItemsProjection().getRoot(),String(i.getContents().get(this._options.idProperty))===String(t))return i;return e.apply(this,[t])},_isSlowDrawing:function(e,t){if(this._options.hierarchyViewMode)return false;else return e.call(this,t)},_canApplyGrouping:function(e,t){if(this._isSearchMode())return false;return e.call(this,t)},_findAndRedrawChangedBranches:function(e,t){var i={},o=function(e){var t,o;for(t=0;t<e.length;t++)if(!h.instanceOfModule(e[t],"WS.Data/Display/GroupItem"))if(o=e[t].getParent(),!o.isRoot())if(!i[o.getContents().getId()])i[o.getContents().getId()]=o}.bind(this);o(e),o(t);for(var r in i)if(i.hasOwnProperty(r)){if(this._isSlowDrawing(this._options.easyGroup))this.redrawItem(i[r].getContents(),i[r]);else this._redrawItem(i[r]);this._createFolderFooter(i[r])}},_onCollectionAddMoveRemove:function(e,t,i,o,r,s,n){e.call(this,t,i,o,r,s,n),this._findAndRedrawChangedBranches(o,s),this._removeFromLoadedRemoteNodes(s),this._updateExpanderDisplay()},_onCollectionReset:function(e){e.call(this),this._updateExpanderDisplay()},_onUpdateItemProperty:function(e,t,i){e.call(this,t,i),this._updateExpanderDisplay()},_onCollectionReplace:function(e,t){e.call(this,t),this._updateExpanderDisplay()},_updateExpanderDisplay:function(){if("withChild"===this._options.expanderDisplayMode)this._container.toggleClass("controls-TreeView__hideExpands",!this._options._hasNodeWithChild(this._options))},setSelectedItemsAll:function(e){var t=this,i=[],o=this.getItems(),r=this._options.nodeProperty;if(o&&this._isSearchMode&&this._isSearchMode())o.each(function(e){if(true!==e.get(r)||t._options._searchFolders[e.get(t._options.idProperty)])i.push(e.getId())}),this.setSelectedKeys(i);else e.call(this)}},_getFilterForReload:function(t,i,o,r,s){var t=e(this._options.filter),n;if((this._options.deepReload||s)&&!f(this._options.openedPath)){if(n=this._options.parentProperty,!(t[n]instanceof Array))t[n]=[];t[n].push(this.getCurrentRoot()||null),t[n]=t[n].concat(Object.keys(this._options.openedPath))}return t},_folderLoad:function(e){var t=this,i;this._toggleIndicator(true),this._notify("onBeforeDataLoad",this._createTreeFilter(e),this.getSorting(),(e?this._options._folderOffsets[e]:this._options._folderOffsets["null"])+this._limit,this._limit),this._loader=this._callQuery(this._createTreeFilter(e),this.getSorting(),(e?this._options._folderOffsets[e]:this._options._folderOffsets["null"])+this._limit,this._limit).addCallback(c(function(i){if(t._notify("onDataMerge",i),t._onDataMergeCallback(i),t._loader=null,e)t._options._folderOffsets[e]+=t._limit;else t._options._folderOffsets["null"]+=t._limit;if(t._options._folderHasMore[e]=i.getMetaData().more,i.getCount()){if("merge"==this._options.loadItemsStrategy)t._options._items.merge(i,{remove:false});else t._options._items.append(i);t._updateItemsToolbar(),t._dataLoadedCallback(),t._createFolderFooter(e)}t._toggleIndicator(false)},t)).addErrback(function(e){return e})},_afterAddItems:function(){if(this._options.hasNodes&&this._isSearchMode())this.redraw()},_getReloadOffset:function(){var e;if(void 0!==this._hierPages[this.getCurrentRoot()])e=this._hierPages[this.getCurrentRoot()]*this._limit;else e=0;return e},_getRootCount:function(){return this._getItemsProjection().getChildren(this._getItemsProjection().getRoot()).getCount()},before:{_modifyOptions:function(e){if(null!==e._curRoot&&null===e.currentRoot)e.currentRoot=e._curRoot;if(null===e.currentRoot)this._previousRoot=e.currentRoot=e.root;else this._previousRoot=e.root;if(e.hierField)u.resolve("ILogger").log("TreeMixin","Опция hierField является устаревшей, используйте parentProperty"),e.parentProperty=e.hierField;if(e.parentProperty&&!e.nodeProperty)e.nodeProperty=e.parentProperty+"@";if(e.parentProperty&&!e.hasChildrenProperty)e.hasChildrenProperty=e.parentProperty+"$"},_addItems:function(){M(this._getItemsProjection(),this._options)},_stateResetHandler:function(){this._options._folderOffsets["null"]=0,this._lastParent=void 0,this._lastDrawn=void 0,this._lastPath=[],this._loadedNodes={},this._options._folderHasMore={}},reload:function(){this._stateResetHandler()},setItems:function(){this._stateResetHandler()},redraw:function(){this._updateExpanderDisplay()},_applyExpandToItems:function(e){var t=this._options._getHierarchyRelation(this._options),i=this._options.openedPath;e.each(function(o){var r=o.getId();if(t.getChildren(o,e).length&&"null"!=r&&r!=this._curRoot)i[r]=true})},_onDataMergeCallback:function(e){if(this._options.expand)this._applyExpandToItems(e)},_dataLoadedCallback:function(){var t=this._options._items.getMetaData().path,i=e(this._hier),o=this,r=this._previousRoot,s;if(this._options.expand)this._applyExpandToItems(this.getItems());if(t)i=this.getHierarchy(t,this._options.currentRoot);if(this._previousRoot!==this._options.currentRoot){if(this._notify("onSetRoot",this._options.currentRoot,i),this.getItems().getRecordById(this._previousRoot)){if(this.setSelectedKey(this._previousRoot),!this._container.parents(".controls-ListView").length)g(function(){o._scrollToItem(r)})}else for(var n=0;n<this._getItemsProjection().getCount();n++)if(s=this._getItemsProjection()&&this._getItemsProjection().at(0),s&&!h.instanceOfModule(s,"WS.Data/Display/GroupItem")){if(this.setSelectedKey(s.getContents().getId()),!this._container.parents(".controls-ListView").length)this._scrollToItem(s.getContents().getId());break}this._previousRoot=this._options.currentRoot}this._updateExpanderDisplay()}},expandToItem:function(e){var t=this.getItems(),i=this._options._itemsProjection,o=e,r=[],s,n;while(!s&&o)if(n=t.getRecordById(o),s=i.getItemBySourceItem(n),!s)if(n)o=n.get(this._options.parentProperty),r.push(o);else o=void 0;for(var a=r.length-1,l=0;a>=l;a--)this.expandNode(r[a])},setRoot:function(e){this._options.root=e,this._previousRoot=void 0},getRoot:function(){return this._options.root},getCurrentRoot:function(){return this._options.currentRoot},setCurrentRoot:function(e){var t,i=this.getFilter()||{},r=_(this._options.root)&&this._options.root[this._options.idProperty]===e;if(o.browser.isIE&&$.contains(this._container[0],document.activeElement))this._getElementToFocus();if(this._destroyEditInPlaceController(),r||void 0!==e&&null!==e)i[this._options.parentProperty]=e;else if(this._options.root)i[this._options.parentProperty]=this._options.root;else delete i[this._options.parentProperty];if(this.setFilter(i,true),this._offset=0,this._notify("onBeforeSetRoot",e),this._options.currentRoot=r||void 0!==e&&null!==e?e:this._options.root,this._options.saveReloadPosition)this._hierPages[this._previousRoot]=this._getCurrentPage();if(r)(t=l.fromObject(this._options.root,this.getItems()?this.getItems().getAdapter():"adapter.sbis")).setIdProperty(this._options.idProperty);else t=void 0!==this._options.currentRoot?this._options.currentRoot:null;if(this._options._itemsProjection)this._options._itemsProjection.setEventRaising(false),this._options._itemsProjection.setRootEnumerable(r),this._options._itemsProjection.setRoot(t),this._options._itemsProjection.setEventRaising(true);this._hier=this.getHierarchy(this.getItems(),e)},getHierarchy:function(e,t){var i,o,r=[];if(e&&e.getCount())while(null!==t&&void 0!==t&&t!=this.getRoot()){if(i=e.getRecordById(t),o=i?i.get(this._options.parentProperty):null,i)r.push({id:t||null,parent:o,title:i.get(this._options.displayProperty),color:this._options.colorField?i.get(this._options.colorField):"",data:i});t=o}return r},setExpand:function(e){this._options.expand=!!e},getExpand:function(){return this._options.expand},getParentKey:function(e,t){var i=this._options._itemsProjection.getItemBySourceItem(t);if(void 0!==i){var o=i.getParent().getContents();return h.instanceOfModule(o,"WS.Data/Entity/Record")?o.getId():o}return},_dropPageSave:function(){var e=this._options.root;this._pageSaver={},this._pageSaver[e]=0},_onDragCallback:function(e){var t=e.getTarget();if(t&&h.instanceOfModule(t,"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Row")){var i=t.getModel(),o=this._getItemsProjection(),r=o.getItemBySourceItem(i);if(r&&r.isNode()&&!r.isExpanded())window.setTimeout(function(){if(e.isDragging()&&t==e.getTarget()){var r=o.getItemBySourceItem(i);if(r&&!r.isExpanded())this.expandNode(i.getId())}}.bind(this),1e3)}}}});
//# sourceMappingURL=TreeMixin.js.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/rowTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,a,l,i,s){function c(){}var n=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};s&&s.isSetts&&(u=s.fullContext||{});var p="string"==typeof l?l:"",v=void 0===r?void 0:r,g={id:[],def:void 0},_=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},f=d.getMarkupGenerator(i);try{var w=f.joinElements([f.createTag("tr",{class:"controls-DataGridView__tr",style:""+d.wrapUndef(d.utils.escape(d.getDecorators().trace.apply(void 0,[d.getter(o,["decorators","apply"]).apply(d.getter(o,["decorators"]),[d.getter(o,["color"]),"color"])])))},[d.getter(o,["multiselect"])?[f.createTag("td",{class:"controls-DataGridView__td controls-DataGridView__td__checkBox "+d.wrapUndef(d.utils.escape(void 0!==d.getter(o,["startScrollColumn"])?0===d.getter(o,["startScrollColumn"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":""))},[f.createTag("span",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox"},[],{},g,this)],{},g,this)]:f.createText(""),function(){for(var e=void 0,t=0;t<d.iterators.length&&!e;t++)d.iterators[t].is(d.utils.escape(d.getter(o,["columns"])))&&(e=d.iterators[t].iterator);var r=[];return function(){var t=d.createScope(o);if(o=t,e){var a=l,s=0;e(d.utils.escape(d.getter(o,["columns"])),function(e,t){d.presetScope(e,o,t,{key:"index",value:"column"}),l&&void 0!==i&&i&&(l=a+"-for_"+s,s++);var c=[f.createTag("td",{class:"controls-DataGridView__td "+d.wrapUndef(d.utils.escape(d.getter(o,["column","editor"])?"controls-DataGridView__edited-td":""))+" "+d.wrapUndef(d.utils.escape(d.getter(o,["column","className"])))+" "+d.wrapUndef(d.utils.escape(void 0!==d.getter(o,["startScrollColumn"])?d.getter(o,["startScrollColumn"])<=d.getter(o,["index"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":""))},[f.createTag("div",{class:"controls-DataGridView__columnValue"},[f.createText(""+d.wrapUndef(d.Sanitize.apply(void 0,[d.getDecorators().sanitize.apply(void 0,[d.getter(o,["column","value"])])])))],{},g,this)],{},g,this)];void 0===c[0]&&void 0!==i&&i||(r=r.concat(c))}.bind(o))}else r=""}.call(o),r}()],a,g,this)],p,g);g.def&&(w=f.chain(w,g,a),g=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/rowTpl.tmpl",e,o)}return w||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/rowTpl"}},o});
//# sourceMappingURL=rowTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/headTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,a,l,i,s){function n(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};s&&s.isSetts&&(u=s.fullContext||{});var p="string"==typeof l?l:"",g=void 0===r?void 0:r,w={id:[],def:void 0},v=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},h=d.getMarkupGenerator(i);try{var m=h.joinElements([h.createTag("thead",{class:"controls-DataGridView__thead "+d.wrapUndef(d.utils.escape(d.getter(o,["isVisible"])?"":"ws-hidden"))},[d.getter(o,["showHead"])?[function(){for(var e=void 0,t=0;t<d.iterators.length&&!e;t++)d.iterators[t].is(d.utils.escape(d.getter(o,["content"])))&&(e=d.iterators[t].iterator);var r=[];return function(){var t=d.createScope(o);if(o=t,e){var a=l,s=0;e(d.utils.escape(d.getter(o,["content"])),function(e,t){d.presetScope(e,o,t,{key:"i",value:"row"}),l&&void 0!==i&&i&&(l=a+"-for_"+s,s++);var n=[!d.getter(o,["row","length"])||1===d.getter(o,["countRows"])&&1!==d.getter(o,["i"])?h.createText(""):[h.createTag("tr",{class:"controls-DataGridView__headerRow"},[d.getter(o,["multiselect"])?[h.createTag("th",{class:"controls-DataGridView__th controls-DataGridView__td__checkBox                       "+d.wrapUndef(d.utils.escape(void 0!==d.getter(o,["startScrollColumn"])?0===d.getter(o,["startScrollColumn"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":"")),style:""+d.wrapUndef(d.utils.escape(0===d.getter(o,["startScrollColumn"])?"transform:translateX("+d.getter(o,["columnsShift"])+"px);":""))},[],{},w,this)]:h.createText(""),function(){for(var e=void 0,t=0;t<d.iterators.length&&!e;t++)d.iterators[t].is(d.utils.escape(d.getter(o,["row"])))&&(e=d.iterators[t].iterator);var r=[];return function(){var t=d.createScope(o);if(o=t,e){var a=l,s=0;e(d.utils.escape(d.getter(o,["row"])),function(e,t){d.presetScope(e,o,t,{key:"index",value:"column"}),l&&void 0!==i&&i&&(l=a+"-for_"+s,s++);var n=[d.getter(o,["column","ignore"])&&1!=d.getter(o,["countRows"])?h.createText(""):[h.createTag("th",{class:d.wrapUndef(d.utils.escape(0===d.getter(o,["index"])?"controls-DataGridView__firstContentCell":""))+" "+d.wrapUndef(d.utils.escape(d.getter(o,["index"])+1===d.getter(o,["row","length"])?"controls-DataGridView__lastContentCell":""))+" controls-DataGridView__th "+d.wrapUndef(d.utils.escape(void 0!==d.getter(o,["startScrollColumn"])?void 0!==d.getter(o,["startScrollColumn"])&&d.getter(o,["startScrollColumn"])<=d.getter(o,["index"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":""))+" "+d.wrapUndef(d.utils.escape(0==d.getter(o,["i"])&&!d.getter(o,["column","rowspan"])&&d.getter(o,["column","colspan"])?"controls-DataGridView__th__topRow":""))+" "+d.wrapUndef(d.utils.escape(d.getter(o,["column","className"]))),title:""+d.wrapUndef(d.utils.escape(d.getter(o,["column","headTooltip"])?d.getter(o,["column","headTooltip"]):d.getter(o,["column","title"]))),colspan:""+d.wrapUndef(d.utils.escape(d.getDecorators().orEmpty.apply(void 0,[d.getter(o,["column","colspan"])]))),rowspan:""+d.wrapUndef(d.utils.escape(2===d.getter(o,["countRows"])?d.getDecorators().orEmpty.apply(void 0,[d.getter(o,["column","rowspan"])]):"")),style:""+d.wrapUndef(d.utils.escape(void 0!==d.getter(o,["startScrollColumn"])&&d.getter(o,["startScrollColumn"])<=d.getter(o,["index"])?"transform:translateX("+d.getter(o,["columnsShift"])+"px);":""))},[h.createControl("resolver",d.getter(o,["sanitize"]),{value:d.getter(o,["column","value"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},l,g,f,d.config,u,w)],{},w,this)]];void 0===n[0]&&void 0!==i&&i||(r=r.concat(n))}.bind(o))}else r=""}.call(o),r}()],{},w,this)]];void 0===n[0]&&void 0!==i&&i||(r=r.concat(n))}.bind(o))}else r=""}.call(o),r}()]:h.createText(""),d.getter(o,["hasResults"])&&"top"===d.getter(o,["resultsPosition"])?[h.createControl("resolver",d.getter(o,["resultsTpl"]),d.uniteScope(d.utils.escape(d.uniteScope(o,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},l,g,f,d.config,u,w)]:h.createText(""),d.getter(o,["showHead"])&&void 0!==d.getter(o,["startScrollColumn"])?[h.createTag("tr",{},[h.createTag("th",{class:"controls-DataGridView__PartScroll__row ws-hidden",colspan:""+d.wrapUndef(d.utils.escape(d.getter(o,["columns","length"])))},[h.createTag("div",{class:"controls-DataGridView__PartScroll__container"},[h.createTag("i",{class:"controls-DataGridView__PartScroll__arrowLeft icon-24 icon-DayBackward  icon-disabled"},[],{},w,this),h.createTag("div",{class:"controls-DataGridView__PartScroll__thumb",style:"left:"+d.wrapUndef(d.utils.escape(d.getter(o,["thumbPosition"])))+"px;"},[],{},w,this),h.createTag("i",{class:"controls-DataGridView__PartScroll__arrowRight icon-24 icon-DayForward icon-primary action-hover"},[],{},w,this)],{},w,this)],{},w,this)],{},w,this)]:h.createText("")],a,w,this)],p,w);w.def&&(m=h.chain(m,w,a),w=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/headTpl.tmpl",e,o)}return m||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/headTpl"}},o});
//# sourceMappingURL=headTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/headColumnTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,o,n,l){function s(){}var d=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var p="string"==typeof o?o:"",v=void 0===r?void 0:r,f={id:[],def:void 0},m=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),h=this&&this.includedTemplates?this.includedTemplates:{},S=c.getMarkupGenerator(n);try{var T=S.joinElements([S.createTag("div",{class:"controls-DataGridView__th-content"},[S.createText(""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(i,["title"])])])))],a,f,this)],p,f);f.def&&(T=S.chain(T,f,a),f=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/headColumnTpl.tmpl",e,i)}return T||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/headColumnTpl"}},i});
//# sourceMappingURL=headColumnTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/footTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,n,l,a){function s(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var p="string"==typeof n?n:"",f=void 0===r?void 0:r,v={id:[],def:void 0},m=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),S=this&&this.includedTemplates?this.includedTemplates:{},g=u.getMarkupGenerator(l);try{var h=g.joinElements([g.createTag("tfoot",{class:"controls-DataGridView__tfoot"},[u.getter(o,["hasResults"])&&"bottom"===u.getter(o,["resultsPosition"])?[g.createControl("resolver",u.getter(o,["resultsTpl"]),u.uniteScope(u.utils.escape(u.uniteScope(o,{parent:void 0,element:void 0})(u.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},n,f,S,u.config,d,v)]:g.createText("")],i,v,this)],p,v);v.def&&(h=g.chain(h,v,i),v=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/footTpl.tmpl",e,o)}return h||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/footTpl"}},o});
//# sourceMappingURL=footTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/colgroupTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,a,l,c){function n(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};c&&c.isSetts&&(d=c.fullContext||{});var p="string"==typeof a?a:"",v=void 0===r?void 0:r,f={id:[],def:void 0},g=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},h=u.getMarkupGenerator(l);try{var S=h.joinElements([h.createTag("colgroup",{class:"controls-DataGridView__colgroup"},[u.getter(o,["multiselect"])?[h.createTag("col",{width:"24px"},[],{},f,this)]:h.createText(""),function(){for(var e=void 0,t=0;t<u.iterators.length&&!e;t++)u.iterators[t].is(u.utils.escape(u.getter(o,["columns"])))&&(e=u.iterators[t].iterator);var r=[];return function(){var t=u.createScope(o);if(o=t,e){var i=a,c=0;e(u.utils.escape(u.getter(o,["columns"])),function(e,t){u.presetScope(e,o,t,{key:"index",value:"column"}),a&&void 0!==l&&l&&(a=i+"-for_"+c,c++);var n=[h.createTag("col",{width:""+u.wrapUndef(u.utils.escape(u.getter(o,["column","width"])))},[],{},f,this)];void 0===n[0]&&void 0!==l&&l||(r=r.concat(n))}.bind(o))}else r=""}.call(o),r}()],i,f,this)],p,f);f.def&&(S=h.chain(S,f,i),f=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/colgroupTpl.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/colgroupTpl"}},o});
//# sourceMappingURL=colgroupTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/cellTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},l=function e(l,i,a,o,n){function d(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var s={};n&&n.isSetts&&(s=n.fullContext||{});var u="string"==typeof a?a:"",g=void 0===r?void 0:r,m={id:[],def:void 0},v=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,l),f=this&&this.includedTemplates?this.includedTemplates:{},y=p.getMarkupGenerator(o);try{var h=y.joinElements([y.createText(""+p.wrapUndef(p.Sanitize.apply(void 0,[p.getDecorators().sanitize.apply(void 0,[p.getDecorators().orEmpty.apply(void 0,[p.getter(l,["decorators","applyOnly"]).apply(p.getter(l,["decorators"]),[p.getter(l,["getCellValue"]).apply(l,[p.getter(l,["getColumnVal"]).apply(l,[p.getter(l,["item"]),p.getter(l,["field"])]),p.getter(l,["column","field"]),p.getter(l,["item"]),p.getter(l,["ladder"]),p.getter(l,["ladderColumns"])]),{highlight:p.getter(l,["column","highlight"])}])])])])))],u,m);m.def&&(h=y.chain(h,m,i),m=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/cellTemplate.tmpl",e,l)}return h||""};return l.includedFunctions={},l.stable=!0,l.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/cellTemplate"}},l});
//# sourceMappingURL=cellTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/SortingTemplate",["Core/tmpl/js/tclosure","js!WSControls/Buttons/Button"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!WSControls/Buttons/Button"]=e[1];var n=function e(n,o,i,l,a){function s(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var m="string"==typeof i?i:"",g=void 0===r?void 0:r,p={id:[],def:void 0},S=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),f=this&&this.includedTemplates?this.includedTemplates:{},v=u.getMarkupGenerator(l);try{var C=v.joinElements([v.createControl("wsControl","ws:WSControls/Buttons/Button",{commandArgs:[""+u.getter(n,["column","field"]),""+u.getter(n,["column","sorting"])],caption:u.getter(n,["column","title"]),command:"ColumnSorting",icon:"DESC"==u.getter(n,["sortingValue"])?"icon-16 icon-TrendDown":"ASC"==u.getter(n,["sortingValue"])?"icon-16 icon-TrendUp":"icon-16",esc:!1},u.plainMerge(o,{class:"controls-DataGridView__headSorting"}),{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S,internal:{__dirtyCheckingVars_0:u.getter(n,["column","field"]),__dirtyCheckingVars_1:u.getter(n,["column","sorting"])}},i,g,f,u.config,d)],m,p);p.def&&(C=v.chain(C,p,o),p=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/SortingTemplate.tmpl",e,n)}return C||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/SortingTemplate"}},n});
//# sourceMappingURL=SortingTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/ResultsTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},l=function e(l,o,a,s,i){function n(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};i&&i.isSetts&&(d=i.fullContext||{});var p="string"==typeof a?a:"",m=void 0===r?void 0:r,f={id:[],def:void 0},v=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,l),g=this&&this.includedTemplates?this.includedTemplates:{},S=u.getMarkupGenerator(s);try{var C=S.joinElements([S.createTag("tr",{class:"controls-DataGridView__results"},[u.getter(l,["multiselect"])?[S.createTag("td",{class:"controls-DataGridView__td "+u.wrapUndef(u.utils.escape(void 0!==u.getter(l,["startScrollColumn"])?0===u.getter(l,["startScrollColumn"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":"")),style:""+u.wrapUndef(u.utils.escape(0===u.getter(l,["startScrollColumn"])?"transform:translateX("+u.getter(l,["columnsShift"])+"px);":""))},[],{},f,this)]:S.createText(""),function(){for(var e=void 0,t=0;t<u.iterators.length&&!e;t++)u.iterators[t].is(u.utils.escape(u.getter(l,["columns"])))&&(e=u.iterators[t].iterator);var r=[];return function(){var t=u.createScope(l);if(l=t,e){var o=a,i=0;e(u.utils.escape(u.getter(l,["columns"])),function(e,t){u.presetScope(e,l,t,{key:"index",value:"column"}),a&&void 0!==s&&s&&(a=o+"-for_"+i,i++);var n=[S.createTag("td",{class:"controls-DataGridView__td "+u.wrapUndef(u.utils.escape(0===u.getter(l,["index"])?"controls-DataGridView__firstContentCell":""))+" "+u.wrapUndef(u.utils.escape(u.getter(l,["column","className"])))+" "+u.wrapUndef(u.utils.escape(void 0!==u.getter(l,["startScrollColumn"])?void 0!==u.getter(l,["startScrollColumn"])&&u.getter(l,["startScrollColumn"])<=u.getter(l,["index"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":"")),style:""+u.wrapUndef(u.utils.escape(void 0!==u.getter(l,["startScrollColumn"])&&u.getter(l,["startScrollColumn"])<=u.getter(l,["index"])?"transform:translateX("+u.getter(l,["columnsShift"])+"px);":""))},[S.createControl("resolver",u.getter(l,["column","resultTemplate"]),u.uniteScope(u.utils.escape(u.getter(l,["column","resultTemplateData"])),{}),{},{data:l,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},a,m,g,u.config,d,f)],{},f,this)];void 0===n[0]&&void 0!==s&&s||(r=r.concat(n))}.bind(l))}else r=""}.call(l),r}()],o,f,this)],p,f);f.def&&(C=S.chain(C,f,o),f=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/ResultsTpl.tmpl",e,l)}return C||""};return l.includedFunctions={},l.stable=!0,l.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/ResultsTpl"}},l});
//# sourceMappingURL=ResultsTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/ItemTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,s,a,l){function c(){}var n=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var u="string"==typeof s?s:"",m=void 0===r?void 0:r,_={id:[],def:void 0},w=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},h=p.getMarkupGenerator(a);try{var f=h.joinElements([h.createTag("tr",{class:"controls-DataGridView__tr controls-ListView__item js-controls-ListView__item "+p.wrapUndef(p.utils.escape(p.getter(o,["selectedKey"])==p.getter(o,["item","getId"]).apply(p.getter(o,["item"]),[])?"controls-ListView__item__selected":""))+" "+p.wrapUndef(p.utils.escape(p.getter(o,["className"])))+p.wrapUndef(p.utils.escape(p.getter(o,["drawHiddenGroup"])?" ws-hidden":""))+" "+p.wrapUndef(p.utils.escape(p.getter(o,["_options","itemsHover"])?" controls-ListView__item__withHover":" controls-ListView__item__withoutHover")),style:""+p.wrapUndef(p.utils.escape(p.getter(o,["decorators","apply"]).apply(p.getter(o,["decorators"]),[p.getDecorators().orEmpty.apply(void 0,[p.getter(o,["item","colorField"])]),"color"]))),"data-hash":""+p.wrapUndef(p.utils.escape(p.getter(o,["projItem","getHash"]).apply(p.getter(o,["projItem"]),[]))),"data-id":""+p.wrapUndef(p.utils.escape(p.getter(o,["item","getId"]).apply(p.getter(o,["item"]),[])+""))},[p.getter(o,["multiselect"])?[h.createTag("td",{class:"controls-DataGridView__td controls-DataGridView__td__checkBox "+p.wrapUndef(p.utils.escape(void 0!==p.getter(o,["startScrollColumn"])?0===p.getter(o,["startScrollColumn"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":"")),style:""+p.wrapUndef(p.utils.escape(p.getter(o,["columnsShift"])&&0===p.getter(o,["startScrollColumn"])?"transform:translateX("+p.getter(o,["columnsShift"])+"px);":""))},[h.createTag("span",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox "+p.wrapUndef(p.utils.escape(p.getter(o,["_options","showCheckboxes"])?" controls-ListView__itemCheckBox__showAlways":""))+" "+p.wrapUndef(p.utils.escape(p.getter(o,["_options","showCheckboxes"])||p.getter(o,["_options","hideCheckboxes"])?"":" controls-ListView__itemCheckBox__showByHover"))},[],{},_,this)],{},_,this)]:h.createText(""),h.createControl("resolver",p.getter(o,["itemContent"]),p.uniteScope(p.utils.escape(p.uniteScope(o,{parent:void 0,element:void 0})(p.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:w},s,m,g,p.config,d,_)],i,_,this)],u,_);_.def&&(f=h.chain(f,_,i),_=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/ItemTemplate.tmpl",e,o)}return f||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/ItemTemplate"}},o});
//# sourceMappingURL=ItemTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/ItemResultTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,l,o,n){function s(){}var u=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var p="string"==typeof l?l:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),S=this&&this.includedTemplates?this.includedTemplates:{},y=c.getMarkupGenerator(o);try{var T=y.joinElements([y.createText(""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(i,["result"])])])))],p,v);v.def&&(T=y.chain(T,v,a),v=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/ItemResultTemplate.tmpl",e,i)}return T||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/ItemResultTemplate"}},i});
//# sourceMappingURL=ItemResultTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/ItemContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,l,n,i,a){function c(){}var s=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};a&&a.isSetts&&(u=a.fullContext||{});var p="string"==typeof n?n:"",m=void 0===r?void 0:r,g={id:[],def:void 0},f=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),v=this&&this.includedTemplates?this.includedTemplates:{},C=d.getMarkupGenerator(i);try{var S=C.joinElements([function(){for(var e=void 0,t=0;t<d.iterators.length&&!e;t++)d.iterators[t].is(d.utils.escape(d.getter(o,["columns"])))&&(e=d.iterators[t].iterator);var r=[];return function(){var t=d.createScope(o);if(o=t,e){var l=n,a=0;e(d.utils.escape(d.getter(o,["columns"])),function(e,t){d.presetScope(e,o,t,{key:"index",value:"column"}),n&&void 0!==i&&i&&(n=l+"-for_"+a,a++);var c=[C.createTag("td",{class:"controls-DataGridView__td           "+d.wrapUndef(d.utils.escape(d.getter(o,["column","editor"])?"controls-DataGridView__edited-td":""))+"           "+d.wrapUndef(d.utils.escape(d.getDecorators().orEmpty.apply(void 0,[d.getter(o,["column","className"])])))+"           "+d.wrapUndef(d.utils.escape(0==d.getter(o,["index"])?"controls-DataGridView__firstContentCell":""))+"           "+d.wrapUndef(d.utils.escape(d.getter(o,["index"])+1===d.getter(o,["columns","length"])?"controls-DataGridView__lastContentCell":""))+"           "+d.wrapUndef(d.utils.escape(void 0!==d.getter(o,["startScrollColumn"])?d.getter(o,["startScrollColumn"])<=d.getter(o,["index"])?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell":""))+"           "+d.wrapUndef(d.utils.escape(d.getter(o,["hoveredColumn","index"])===d.getter(o,["index"])?"controls-DataGridView__hoveredColumn__cell":"")),style:""+d.wrapUndef(d.utils.escape(d.getter(o,["startScrollColumn"])<=d.getter(o,["index"])?"transform:translateX("+d.getter(o,["columnsShift"])+"px);":""))},[C.createTag("div",{class:"controls-DataGridView__columnValue"},[C.createControl("resolver",d.getter(o,["column","contentTpl"]),d.uniteScope(d.utils.escape(d.getter(o,["cellData"])),{item:d.getter(o,["item"]),projItem:d.getter(o,["projItem"]),field:d.getter(o,["column","field"]),column:d.getter(o,["column"]),included:d.getter(o,["column","included"]),templateBinding:d.getter(o,["column","templateBinding"]),decorators:d.getter(o,["decorators"]),Sanitize:d.getter(o,["Sanitize"])}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},n,m,v,d.config,u,g)],{},g,this)],{},g,this)];void 0===c[0]&&void 0!==i&&i||(r=r.concat(c))}.bind(o))}else r=""}.call(o),r}()],p,g);g.def&&(S=C.chain(S,g,l),g=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/ItemContentTemplate.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/ItemContentTemplate"}},o});
//# sourceMappingURL=ItemContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/resources/GroupTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},a=function e(a,o,i,n,s){function l(){}var p=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var c={};s&&s.isSetts&&(c=s.fullContext||{});var d="string"==typeof i?i:"",g=void 0===r?void 0:r,f={id:[],def:void 0},v=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),m=this&&this.includedTemplates?this.includedTemplates:{},h=u.getMarkupGenerator(n);try{var y=h.joinElements([h.createTag("tr",{class:"controls-GroupBy"+u.wrapUndef(u.utils.escape(u.getter(a,["stickyHeader"])?" ws-sticky-header__table-sticky-row":""))+u.wrapUndef(u.utils.escape(u.getter(a,["groupCollapsing",u.getter(a,["groupId"])])?" controls-GroupBy__collapsed":"")),"data-group":""+u.wrapUndef(u.utils.escape(u.getter(a,["groupId"]))),"data-group-hash":""+u.wrapUndef(u.utils.escape(u.getter(a,["groupHash"])))},[h.createTag("td",{colspan:""+u.wrapUndef(u.utils.escape(u.getter(a,["colspan"])))},[h.createControl("resolver",u.getter(a,["groupContentTemplate"]),u.uniteScope(u.utils.escape(u.uniteScope(a,{parent:void 0,element:void 0})(u.plainMerge)),{}),{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},i,g,m,u.config,c,f)],{},f,this)],o,f,this)],d,f);f.def&&(y=h.chain(y,f,o),f=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/DataGridView/resources/GroupTemplate.tmpl",e,a)}return y||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/resources/GroupTemplate"}},a});
//# sourceMappingURL=GroupTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/DataGridView/DataGridView",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Panel","js!SBIS3.CONTROLS/Link"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Panel"]=e[1],r["js!SBIS3.CONTROLS/Link"]=e[2];var o=function e(o,a,i,s,l){function n(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};l&&l.isSetts&&(p=l.fullContext||{});var u="string"==typeof i?i:"",g=void 0===r?void 0:r,v={id:[],def:void 0},_=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),w=this&&this.includedTemplates?this.includedTemplates:{},f=d.getMarkupGenerator(s);try{var m=f.joinElements([f.createTag("div",{class:"controls-DataGridView controls-ListView "+d.wrapUndef(d.utils.escape(!1!==d.getter(o,["multiselect"])?"controls-ListView__multiselect":"controls-ListView__multiselect__off"))+"            "+d.wrapUndef(d.utils.escape(void 0!==d.getter(o,["startScrollColumn"])?" controls-DataGridView__with-partScroll":""))+d.wrapUndef(d.utils.escape(d.getter(o,["_serverRender"])?" controls-ListView__dataLoaded":" controls-ListView__dataNotLoaded"))},[f.createTag("div",{class:"js-controls-DataGridView__minHeight controls-DataGridView__minHeight"},[],{},v,this),f.createControl("wsControl","ws:SBIS3.CONTROLS/Panel",{tabindex:1,allowChangeEnable:!1},{class:"controls-ListView__fakeFocusElement"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},i,g,w,d.config,p),f.createTag("div",{class:"controls-AjaxLoader ws-hidden"},[f.createTag("div",{class:"controls-AjaxLoader__outer"},[f.createTag("div",{class:"controls-AjaxLoader__block"},[f.createTag("div",{class:"controls-AjaxLoader__LoadingIndicator"},[],{},v,this)],{},v,this)],{},v,this)],{},v,this),d.getter(o,["virtualScrolling"])?[f.createTag("div",{class:"controls-ListView__virtualScrollTop"},[],{},v,this)]:f.createText(""),f.createTag("table",{class:"controls-DataGridView__table"+d.wrapUndef(d.utils.escape(d.getter(o,["stickyHeader"])&&(d.getter(o,["showHead"])||d.getter(o,["stickyGroup"])||d.getter(o,["hasResults"])&&"top"===d.getter(o,["resultsPosition"]))?" ws-sticky-header__table":""))+d.wrapUndef(d.utils.escape(d.getter(o,["stickyHeader"])&&d.getter(o,["stickyGroup"])?" ws-sticky-header__table-with-sticky-rows":""))},[f.createControl("resolver",d.getter(o,["_colGroupTpl"]),d.uniteScope(d.utils.escape(d.getter(o,["_colgroupData"])),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},i,g,w,d.config,p,v),f.createControl("resolver",d.getter(o,["headTpl"]),d.uniteScope(d.utils.escape(d.getter(o,["_headData"])),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},i,g,w,d.config,p,v),f.createTag("tbody",{class:"controls-DataGridView__tbody"},[d.getter(o,["_serverRender"])?[f.createControl("resolver",d.getter(o,["_itemsTemplate"]),{records:d.getter(o,["_records"]),tplData:d.getter(o,["_itemData"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},i,g,w,d.config,p,v)]:f.createText("")],{},v,this),f.createControl("resolver",d.getter(o,["_footTpl"]),d.uniteScope(d.utils.escape(d.uniteScope(o,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},i,g,w,d.config,p,v)],{},v,this),f.createTag("div",{class:"controls-ListView__EmptyData "+d.wrapUndef(d.utils.escape(d.getter(o,["_serverRender"])&&!d.getter(o,["_records","length"])&&d.getter(o,["emptyHTML"])?"":"ws-hidden"))},[f.createControl("resolver",d.getter(o,["_sanitize"]).apply(o,[d.getter(o,["emptyHTML"])]),{},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},i,g,w,d.config,p,v)],{},v,this),d.getter(o,["footerTpl"])?[f.createTag("div",{class:"controls-ListView__footer"},[f.createControl("resolver",d.getter(o,["footerTpl"]),d.uniteScope(d.utils.escape(d.uniteScope(o,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},i,g,w,d.config,p,v)],{},v,this)]:f.createText(""),d.getter(o,["showPaging"])?[f.createTag("div",{class:"controls-Pager-container"},[],{},v,this)]:f.createText(""),"demand"==d.getter(o,["infiniteScroll"])?[f.createTag("div",{class:"controls-ListView__serviceFooter"},[f.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"loadMoreButton",caption:"Еще...",visible:"false"},{class:"controls-ListView__loadMoreButton",name:"loadMoreButton",sbisname:"loadMoreButton"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},i,g,w,d.config,p)],{},v,this)]:f.createText(""),d.getter(o,["virtualScrolling"])?[f.createTag("div",{class:"controls-ListView__virtualScrollBottom"},[],{},v,this)]:f.createText(""),f.createTag("div",{class:"controls-ListView-scrollIndicator "+d.wrapUndef(d.utils.escape("up"===d.getter(o,["infiniteScroll"])?"controls-ListView-scrollIndicator__up":""))},[],{},v,this),f.createTag("div",{class:"controls-ListView__ItemsToolbar-container ws-hidden"},[],{},v,this),f.createTag("div",{class:"controls-ListView__scrollPager "+d.wrapUndef(d.utils.escape(d.getter(o,["infiniteScroll"])?"":"ws-hidden"))},[],{},v,this)],a,v,this)],u,v);v.def&&(m=f.chain(m,v,a),v=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/DataGridView/DataGridView.tmpl",e,o)}return m||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/DataGridView/DataGridView"}},o});
//# sourceMappingURL=DataGridView.tmpl.map
define("SBIS3.CONTROLS/Utils/GetTextWidth",function(){return function(t){var e="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",i=document.createElement("div");document.all?i.style.setAttribute("cssText",e):i.setAttribute("style",e),i.innerHTML=t,document.body.appendChild(i);var n=i.clientWidth;return document.body.removeChild(i),n}});
//# sourceMappingURL=GetTextWidth.js.map
define("SBIS3.CONTROLS/Utils/TitleUtil",["SBIS3.CONTROLS/Utils/GetTextWidth","Core/helpers/String/escapeHtml"],function(t,e){return{setTitle:function(i){var l;if(i=i&&i.get?i.get(0):i,i)if(l=i.innerText,!i.getAttribute("title")&&t(e(l))>i.clientWidth)i.setAttribute("title",l)}}});
//# sourceMappingURL=TitleUtil.js.map
define("SBIS3.CONTROLS/Utils/ImitateEvents",["Core/detection"],function(t){"use strict";return{imitateFocus:function(e,i){var o=$(document.elementFromPoint(e,i)),n=o.wsControl();if(n){if(n.setActive(true),t.isMobilePlatform)o.focus()}else o.focus()}}});
//# sourceMappingURL=ImitateEvents.js.map
define("SBIS3.CONTROLS/Utils/HtmlDecorators/LadderDecorator",["SBIS3.CONTROLS/Utils/HtmlDecorators/AbstractDecorator","Core/IoC"],function(e,t){"use strict";var n=e.extend({$protected:{_name:"ladder",_options:{ladder:void 0,ladderInstance:null},_record:null,_columnName:void 0,_isCheckCondition:false,_markLadderColumn:false,_ignoreEnabled:false},checkCondition:function(e){var t=e.hasOwnProperty("ladder")&&e["ladder"],n=typeof t;if(!t)this._columnName=void 0;else if(t&&"object"==n)this._columnName=t.column;else if("string"==n)this._columnName=t;return this._isCheckCondition=true,true},apply:function(e){if(!this._isCheckCondition||!this._columnName)return e;return this._isCheckCondition=false,this._notifyDeprecated(),this.setLadder(e)},setRecord:function(e){this._record=e},update:function(e){n.superclass.update.apply(this,arguments),this._options.ladder=e._options.ladder},setLadder:function(e){var t=this._options.ladderInstance,n=this._record,r=this._columnName;if(!n||t.isPrimary(n,r))return'<span class="controls-ladder">'+e+"</span>";else return'<span class="controls-ladder ws-invisible">'+e+"</span>"},reset:function(){},setMarkLadderColumn:function(e){this._markLadderColumn=!!e},isMarkLadderColumn:function(){return this._markLadderColumn},removeNodeData:function(e){},isIgnoreEnabled:function(){return this._ignoreEnabled},setIgnoreEnabled:function(e){this._ignoreEnabled=!!e},getIgnoreEnabled:function(){return this._ignoreEnabled},_isLadderColumn:function(){return this._options.ladder&&Array.indexOf(this._options.ladder,this._columnName)>-1},_notifyDeprecated:function(){t.resolve("ILogger").info("LadderDecorator:",'module SBIS3.CONTROLS/Utils/HtmlDecorators/LadderDecorator is deprecated and will be removed in 3.7.5. Use "it.ladder.get(it.item, it.field)" in your template instead. See /docs/WS/Data/Display/Ladder/ for details.'),this._notifyDeprecated=function(){}}});return n});
//# sourceMappingURL=LadderDecorator.js.map
define("SBIS3.CONTROLS/Mixins/DragAndDropMixin",["Core/constants"],function(t){var n=t.browser.isMobilePlatform;return{$protected:{_dragContainer:void 0,_withinElement:void 0,_startPosition:{x:0,y:0},_dragStartEventHandler:void 0,_eventHandlers:{touchmove:"_moveAt",touchend:"_moveEnd",touchcancel:"_moveEnd",mousemove:"_moveAt",mouseup:"_moveEnd"}},$constructor:function(){this._dragStartEventHandler=this._startEventHandler.bind(this)},initializeDragAndDrop:function(){this._dragContainers=this._getDragAndDropContainer(),this._toggleNativeDragNDrop(false),this._dragContainers.addClass("draggable").bind("mousedown touchstart",this._dragStartEventHandler)},_bindDragEvents:function(){for(var n in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(n))t.$win.bind(n+".dragNDrop",function(t,n){if(t.call(this,n),n.originalEvent.touches&&"touchmove"===n.type)n.preventDefault()}.bind(this,this[this._eventHandlers[n]]))},updateDragAndDrop:function(){if(this._dragContainers.length)this._dragContainersUnbind();this._toggleNativeDragNDrop(true),this.initializeDragAndDrop()},_toggleNativeDragNDrop:function(t){for(var n=0;n<this._dragContainers.length;n++)this._dragContainers[n].ondragstart=function(){return t}},_startEventHandler:function(t){if(t.originalEvent.touches?t.originalEvent.touches.length>1:1!==t.which)return;this._withinElement=t.target.offsetParent,this._dragStart(t),this._setStartPosition(t,t.target),this._bindDragEvents()},_moveAt:function(t){this._preparePageXY(t),this._dragMove(t,{top:t.pageY-this._startPosition.y,left:t.pageX-this._startPosition.x})},_moveEnd:function(n){t.$win.unbind(".dragNDrop"),this._dragEnd(n)},_getCords:function(t){var n=t.getBoundingClientRect(),e=this._withinElement.getBoundingClientRect();return{top:n.top+pageYOffset-e.top,left:n.left+pageXOffset-e.left}},_dragContainersUnbind:function(){this._dragContainers.unbind("mousedown touchstart",this._dragStartEventHandler)},_setStartPosition:function(t,n){var e=this._getCords(n),i=window.getComputedStyle?getComputedStyle(n,""):n.currentStyle;this._preparePageXY(t),this._startPosition.x=t.pageX-e.left+parseInt(i.marginLeft),this._startPosition.y=t.pageY-e.top+parseInt(i.marginTop)},_getDragAndDropContainer:function(){throw new Error("Method _getDragContainer() must be implemented")},_getWithinElem:function(){},_dragMove:function(){},_dragEnd:function(){},_dragStart:function(){},before:{destroy:function(){if(this._dragContainers&&this._dragContainers.length)this._dragContainersUnbind(),this._dragContainers=null;this._dragStartEventHandler=void 0}}}});
//# sourceMappingURL=DragAndDropMixin.js.map
define("tmpl!SBIS3.CONTROLS/ListView/resources/ListViewGroupBy",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={},i=function e(i,o,s,n,l){function u(){}var c=0,a=void 0!==r&&r?r:arguments[arguments.length-1];void 0===a&&(eval("var thelpers = null;"),a=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var p="string"==typeof s?s:"",v=void 0===t?void 0:t,f={id:[],def:void 0},m=a.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),y=this&&this.includedTemplates?this.includedTemplates:{},S=a.getMarkupGenerator(n);try{var h=S.joinElements([S.createTag("div",{class:"controls-GroupBy"},[],o,f,this)],p,f);f.def&&(h=S.chain(h,f,o),f=void 0)}catch(e){a.templateError("resources/SBIS3.CONTROLS/ListView/resources/ListViewGroupBy.tmpl",e,i)}return h||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ListView/resources/ListViewGroupBy"}},i});
//# sourceMappingURL=ListViewGroupBy.tmpl.map
define("tmpl!SBIS3.CONTROLS/ListView/resources/ItemTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,s,o,a,n){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var u="string"==typeof o?o:"",m=void 0===r?void 0:r,g={id:[],def:void 0},v=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},w=c.getMarkupGenerator(a);try{var _=w.joinElements([w.createTag("div",{class:"controls-ListView__item "+c.wrapUndef(c.utils.escape(c.getter(i,["_options","itemsHover"])?" controls-ListView__item__withHover":" controls-ListView__item__withoutHover"))+" js-controls-ListView__item    "+c.wrapUndef(c.utils.escape(c.getter(i,["selectedKey"])==c.getter(i,["item","getId"]).apply(c.getter(i,["item"]),[])?"controls-ListView__item__selected":""))+"    "+c.wrapUndef(c.utils.escape(c.getter(i,["className"])))+"    "+c.wrapUndef(c.utils.escape(c.getter(i,["drawHiddenGroup"])?" ws-hidden":"")),"data-hash":""+c.wrapUndef(c.utils.escape(c.getter(i,["projItem","getHash"]).apply(c.getter(i,["projItem"]),[]))),"data-id":""+c.wrapUndef(c.utils.escape(c.getter(i,["item","getId"]).apply(c.getter(i,["item"]),[])+""))},[w.createControl("resolver",c.getter(i,["itemContent"]),c.uniteScope(c.utils.escape(c.uniteScope(i,{parent:void 0,element:void 0})(c.plainMerge)),{}),c.plainMerge(c.getter(i,["attributes"]),{}),{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},o,m,f,c.config,d,g)],s,g,this)],u,g);g.def&&(_=w.chain(_,g,s),g=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/ListView/resources/ItemTemplate.tmpl",e,i)}return _||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ListView/resources/ItemTemplate"}},i});
//# sourceMappingURL=ItemTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/ListView/resources/ItemContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,n,o,l,s){function a(){}var u=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var p="string"==typeof o?o:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),S=this&&this.includedTemplates?this.includedTemplates:{},y=c.getMarkupGenerator(l);try{var T=y.joinElements([y.createText(""+c.wrapUndef(c.utils.escape(c.getter(i,["item",c.getter(i,["displayProperty"])]))))],p,v);v.def&&(T=y.chain(T,v,n),v=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/ListView/resources/ItemContentTemplate.tmpl",e,i)}return T||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ListView/resources/ItemContentTemplate"}},i});
//# sourceMappingURL=ItemContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/ListView/resources/GroupTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,n,a,l){function s(){}var p=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var c={};l&&l.isSetts&&(c=l.fullContext||{});var d="string"==typeof n?n:"",g=void 0===r?void 0:r,v={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},h=u.getMarkupGenerator(a);try{var S=h.joinElements([h.createTag("div",{class:"controls-GroupBy"+u.wrapUndef(u.utils.escape(u.getter(o,["groupCollapsing",u.getter(o,["groupId"])])?" controls-GroupBy__collapsed":"")),"data-group":""+u.wrapUndef(u.utils.escape(u.getter(o,["groupId"]))),"data-group-hash":""+u.wrapUndef(u.utils.escape(u.getter(o,["groupHash"])))},[h.createControl("resolver",u.getter(o,["groupContentTemplate"]),u.uniteScope(u.utils.escape(u.uniteScope(o,{parent:void 0,element:void 0})(u.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},n,g,m,u.config,c,v)],i,v,this)],d,v);v.def&&(S=h.chain(S,v,i),v=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/ListView/resources/GroupTemplate.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ListView/resources/GroupTemplate"}},o});
//# sourceMappingURL=GroupTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/ListView/ListView",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Panel","js!SBIS3.CONTROLS/Link"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Panel"]=e[1],r["js!SBIS3.CONTROLS/Link"]=e[2];var o=function e(o,i,s,a,l){function n(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};l&&l.isSetts&&(p=l.fullContext||{});var u="string"==typeof s?s:"",g=void 0===r?void 0:r,v={id:[],def:void 0},m=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),_=this&&this.includedTemplates?this.includedTemplates:{},f=d.getMarkupGenerator(a);try{var T=f.joinElements([f.createTag("div",{class:"controls-ListView"+d.wrapUndef(d.utils.escape(d.getter(o,["preparedClasses"])))},[f.createControl("wsControl","ws:SBIS3.CONTROLS/Panel",{tabindex:1,allowChangeEnable:!1},{class:"controls-ListView__fakeFocusElement"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},s,g,_,d.config,p),f.createTag("div",{class:"controls-AjaxLoader ws-hidden"},[f.createTag("div",{class:"controls-AjaxLoader__outer"},[f.createTag("div",{class:"controls-AjaxLoader__block"},[f.createTag("div",{class:"controls-AjaxLoader__LoadingIndicator"},[],{},v,this)],{},v,this)],{},v,this)],{},v,this),d.getter(o,["virtualScrolling"])?[f.createTag("div",{class:"controls-ListView__virtualScrollTop"},[],{},v,this)]:f.createText(""),d.getter(o,["_serverRender"])&&d.getter(o,["_resultsRecord"])&&"top"==d.getter(o,["resultsPosition"])&&d.getter(o,["resultsTpl"])?[f.createControl("resolver",d.getter(o,["resultsTpl"]),{item:d.getter(o,["_resultsRecord"]),multiselect:d.getter(o,["multiselect"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},s,g,_,d.config,p,v)]:f.createText(""),f.createTag("div",{class:"controls-ListView__itemsContainer"},[d.getter(o,["_serverRender"])?[f.createControl("resolver",d.getter(o,["_itemsTemplate"]),{records:d.getter(o,["_records"]),tplData:d.getter(o,["_itemData"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},s,g,_,d.config,p,v)]:f.createText("")],{},v,this),d.getter(o,["_serverRender"])&&d.getter(o,["_resultsRecord"])&&"bottom"==d.getter(o,["resultsPosition"])&&d.getter(o,["resultsTpl"])?[f.createControl("resolver",d.getter(o,["resultsTpl"]),{item:d.getter(o,["_resultsRecord"]),multiselect:d.getter(o,["multiselect"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},s,g,_,d.config,p,v)]:f.createText(""),f.createTag("div",{class:"controls-ListView__EmptyData "+d.wrapUndef(d.utils.escape(d.getter(o,["isSmall"])?"controls-ListView__small__EmptyData":"controls-ListView__normal__EmptyData"))+d.wrapUndef(d.utils.escape(d.getter(o,["_serverRender"])&&!d.getter(o,["_records","length"])&&d.getter(o,["emptyHTML"])?"":" ws-hidden"))},[f.createControl("resolver",d.getter(o,["_sanitize"]).apply(o,[d.getter(o,["emptyHTML"])]),{},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},s,g,_,d.config,p,v)],{},v,this),d.getter(o,["footerTpl"])?[f.createTag("div",{class:"controls-ListView__footer"},[f.createControl("resolver",d.getter(o,["footerTpl"]),d.uniteScope(d.utils.escape(d.uniteScope(o,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},s,g,_,d.config,p,v)],{},v,this)]:f.createText(""),d.getter(o,["showPaging"])?[f.createTag("div",{class:"controls-Pager-container"},[],{},v,this)]:f.createText(""),"demand"==d.getter(o,["infiniteScroll"])?[f.createTag("div",{class:"controls-ListView__serviceFooter"},[f.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"loadMoreButton",caption:"Еще...",visible:!1},{class:"controls-ListView__loadMoreButton",name:"loadMoreButton",sbisname:"loadMoreButton"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},s,g,_,d.config,p)],{},v,this)]:f.createText(""),f.createTag("div",{class:"controls-ListView-scrollIndicator "+d.wrapUndef(d.utils.escape("up"===d.getter(o,["infiniteScroll"])?"controls-ListView-scrollIndicator__up":""))},[],{},v,this),f.createTag("div",{class:"controls-ListView__ItemsToolbar-container ws-hidden"},[],{},v,this),d.getter(o,["virtualScrolling"])?[f.createTag("div",{class:"controls-ListView__virtualScrollBottom"},[],{},v,this)]:f.createText(""),f.createTag("div",{class:"controls-ListView__scrollPager "+d.wrapUndef(d.utils.escape(d.getter(o,["infiniteScroll"])?"":" ws-hidden"))},[],{},v,this)],i,v,this)],u,v);v.def&&(T=f.chain(T,v,i),v=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/ListView/ListView.tmpl",e,o)}return T||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ListView/ListView"}},o});
//# sourceMappingURL=ListView.tmpl.map
define("SBIS3.CONTROLS/Utils/ScrollWatcher",["Core/Abstract","Lib/LayoutManager/LayoutManager"],function(t,o){"use strict";var n=t.extend({$protected:{_options:{element:void 0,opener:void 0,totalScrollOffset:0}},$constructor:function(){this._publish("onTotalScroll","onScroll"),this._onContainerScroll=this._onContainerScroll.bind(this),this._getScrollElement().bind("scroll.wsScrollWatcher",this._onContainerScroll)},_getScrollElement:function(){return this._findScrollElement()||$(window)},_findScrollElement:function(){if(!this._options.element.length){var t=this._options.opener.getContainer().closest(".ws-scrolling-content").not(".ws-body-scrolling-content"),o;if(t.length)o=t;else if(t=$(".ws-body-scrolling-content"),t.length)o=t;return o}else{if(this._options.element.hasClass("controls-ScrollContainer"))this._options.element=$(".controls-ScrollContainer__content",this._options.element);return this._options.element}},_processScrollEvent:function(t){if(this._notify("onScroll",t),this.isScrollOnTop())this._notify("onTotalScroll","top",t);if(this.isScrollOnBottom())this._notify("onTotalScroll","bottom",t)},_onContainerScroll:function(t){var o,n;if(n=t.target,n==document)o=$(window).scrollTop();else o=n.scrollTop;this._processScrollEvent(o)},getScrollContainer:function(){if(!this._options.element.length){var t=this._findScrollElement();if(t)this._options.element=t}return this._options.element.length?this._options.element:$(window)},isScrollOnBottom:function(t){var o=this.getScrollContainer(),n=t?0:this._options.totalScrollOffset;return this._isScrollOnBottom(o,n)},_isScrollOnBottom:function(t,o){return o=o||0,t.scrollTop()+Math.round(t.outerHeight())>=this.getScrollHeight(t[0])-o},isScrollOnTop:function(){return this.getScrollContainer().scrollTop()<=this._options.totalScrollOffset},scrollTo:function(t){var o=this.getScrollContainer();o.scrollTop("string"===typeof t?"top"===t?0:this.getScrollHeight(o[0]):t)},scrollToElement:function(t){o.scrollToElement(t)},getScrollHeight:function(t){if(t=t||this.getScrollContainer()[0],void 0!==t.scrollHeight)return t.scrollHeight;else if(t==window){var o=document.body,n=document.documentElement;return Math.max(o.scrollHeight,o.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight)}},getContainerHeight:function(){return this._options.element.height()},hasScroll:function(t){t=t||-10;var o=this.getScrollContainer();return this._hasScroll(o,t)},_hasScroll:function(t,o){o=o||0;var n=this.getScrollHeight();return n>this.getContainerHeight()-o||n>$(window).height()-o},destroy:function(){this._getScrollElement().unbind(".wsScrollWatcher",this._onContainerScroll),this._setOption("element",null),this._setOption("opener",null),n.superclass.destroy.call(this)}});return n});
//# sourceMappingURL=ScrollWatcher.js.map
define("SBIS3.CONTROLS/Utils/ConfigByClasses",[],function(){"use strict";return function(e,n,t){var i;function f(e,n){if("string"===typeof e)return!!~e.split(" ").filter(function(e){return""!==e}).indexOf(n);else return}for(var r=0;r<n.length;r++)if(i=n[r],f(t,i.class))e[i.optionName]=i.value;else if(!e[i.optionName])e[i.optionName]=i.defaultValue}});
//# sourceMappingURL=ConfigByClasses.js.map
define("SBIS3.CONTROLS/Utils/ArraySimpleValuesUtil",[],function(){"use strict";return{hasInArray:function(r,n){return-1!==this.invertTypeIndexOf(r,n)},invertTypeIndexOf:function(r,n){var e=r.indexOf(n);if(-1===e)n="string"===typeof n?Number(n):String(n),e=r.indexOf(n);return e},addSubArray:function(r,n){n.forEach(function(n){if(!this.hasInArray(r,n))r.push(n)},this)},removeSubArray:function(r,n){var e;n.forEach(function(n){if(e=this.invertTypeIndexOf(r,n),-1!==e)r.splice(e,1)},this)},getArrayDifference:function(r,n){var e={},i=this;return e.removed=r.filter(function(r){return!i.hasInArray(n,r)}),e.added=n.filter(function(n){return!i.hasInArray(r,n)}),e}}});
//# sourceMappingURL=ArraySimpleValuesUtil.js.map
define("tmpl!SBIS3.CONTROLS/Paging/resources/ItemsTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,s,n,o){function l(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var g={};o&&o.isSetts&&(g=o.fullContext||{});var d="string"==typeof s?s:"",u=void 0===r?void 0:r,m={id:[],def:void 0},v=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},y=p.getMarkupGenerator(n);try{var h=y.joinElements([function(){for(var e=void 0,t=0;t<p.iterators.length&&!e;t++)p.iterators[t].is(p.utils.escape(p.getter(i,["records"])))&&(e=p.iterators[t].iterator);var r=[];return function(){var t=p.createScope(i);if(i=t,e){var a=s,o=0;e(p.utils.escape(p.getter(i,["records"])),function(e,t){p.presetScope(e,i,t,{key:"index",value:"item"}),s&&void 0!==n&&n&&(s=a+"-for_"+o,o++);var l=[p.getter(i,["item","getContents"])?[y.createTag("div",{class:"controls-ListView__item js-controls-ListView__item controls-Paging__item","data-hash":""+p.wrapUndef(p.utils.escape(p.getter(i,["item","getHash"]).apply(p.getter(i,["item"]),[]))),"data-id":""+p.wrapUndef(p.utils.escape(p.getter(p.getter(i,["item","getContents"]).apply(p.getter(i,["item"]),[]),["getId"]).apply(p.getter(i,["item","getContents"]).apply(p.getter(i,["item"]),[]),[])))},[y.createText(""+p.wrapUndef(p.utils.escape(p.getter(p.getter(i,["item","getContents"]).apply(p.getter(i,["item"]),[]),["getId"]).apply(p.getter(i,["item","getContents"]).apply(p.getter(i,["item"]),[]),[]))))],{},m,this)]:[y.createTag("div",{class:" controls-Paging__item"},[y.createText(""+global.rk("..."))],{},m,this)]];void 0===l[0]&&void 0!==n&&n||(r=r.concat(l))}.bind(i))}else r=""}.call(i),r}()],d,m);m.def&&(h=y.chain(h,m,a),m=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Paging/resources/ItemsTemplate.tmpl",e,i)}return h||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Paging/resources/ItemsTemplate"}},i});
//# sourceMappingURL=ItemsTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Paging/Paging",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Button/IconButton"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={};n["js!SBIS3.CONTROLS/Button/IconButton"]=e[1];var r=function e(r,o,i,a,c){function l(){}var s=0,g=void 0!==t&&t?t:arguments[arguments.length-1];void 0===g&&(eval("var thelpers = null;"),g=global.requirejs("View/Runner/tclosure"));var d={};c&&c.isSetts&&(d=c.fullContext||{});var u="string"==typeof i?i:"",m=void 0===n?void 0:n,p={id:[],def:void 0},P=g.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),v=this&&this.includedTemplates?this.includedTemplates:{},N=g.getMarkupGenerator(a);try{var C=N.joinElements([N.createTag("div",{class:"controls-Paging"},[N.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{tooltip:global.rk("В начало"),cssClassName:"control-Paging__btn control-Paging__begin",name:"PagingBegin",icon:"icon-16 icon-First icon-primary",visible:g.getter(r,["visiblePath","begin"])},{name:"PagingBegin",sbisname:"PagingBegin"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:P},i,m,v,g.config,d),N.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{tooltip:global.rk("Назад"),cssClassName:"control-Paging__btn control-Paging__prev",name:"PagingPrev",icon:"icon-16 icon-Back2 icon-primary",visible:g.getter(r,["visiblePath","prev"])},{name:"PagingPrev",sbisname:"PagingPrev"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:P},i,m,v,g.config,d),N.createTag("div",{class:"controls-Paging__itemsContainer"+g.wrapUndef(g.utils.escape(g.getter(r,["visiblePath","pages"])?"":" ws-hidden"))},[g.getter(r,["_records"])?[N.createControl("resolver",g.getter(r,["_itemsTemplate"]),{records:g.getter(r,["_records"]),tplData:g.getter(r,["_itemData"])},{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:P},i,m,v,g.config,d,p)]:N.createText("")],{},p,this),N.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{tooltip:global.rk("В конец"),cssClassName:"control-Paging__btn control-Paging__end",name:"PagingEnd",icon:"icon-16 icon-Last icon-primary",visible:g.getter(r,["visiblePath","end"])},{name:"PagingEnd",sbisname:"PagingEnd"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:P},i,m,v,g.config,d),N.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{tooltip:global.rk("Вперёд"),cssClassName:"control-Paging__btn control-Paging__next",name:"PagingNext",icon:"icon-16 icon-Forward icon-primary",visible:g.getter(r,["visiblePath","next"])},{name:"PagingNext",sbisname:"PagingNext"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:P},i,m,v,g.config,d)],o,p,this)],u,p);p.def&&(C=N.chain(C,p,o),p=void 0)}catch(e){g.templateError("resources/SBIS3.CONTROLS/Paging/Paging.tmpl",e,r)}return C||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Paging/Paging"}},r});
//# sourceMappingURL=Paging.tmpl.map
define("SBIS3.CONTROLS/Mixins/Selectable",["WS.Data/Utils","WS.Data/Collection/IBind","Core/core-instance"],function(e,t,i){var s={$protected:{_isMove:false,_isMoveKey:null,_curHash:void 0,_options:{selectedIndex:null,selectedKey:null,allowEmptySelection:true}},$constructor:function(){this._publish("onSelectedItemChange")},_prepareSelectedKeyByIndex:function(e){if(this._isEmptyIndex(e))this._options.selectedKey=null;else if(this.getItems()&&i.instanceOfModule(this.getItems(),"WS.Data/Collection/RecordSet"))this._options.selectedKey=this._getKeyByIndex(this._options.selectedIndex);this._prepareOtherSelectedConfig()},_prepareSelectedIndexByKey:function(e){if("undefined"===typeof e)this._options.selectedIndex=-1;else if(this.getItems()&&i.instanceOfModule(this.getItems(),"WS.Data/Collection/RecordSet"))this._options.selectedIndex=this._getItemIndexByKey(e);this._prepareOtherSelectedConfig()},_prepareBothSelectedConfig:function(e,t){if(this._isEmptyIndex(e))this._prepareSelectedIndexByKey(t);else this._prepareSelectedKeyByIndex(e)},_prepareOtherSelectedConfig:function(){var e=this._getItemsProjection();if(e){if(!this._options.allowEmptySelection&&this._isEmptyIndex(this._options.selectedIndex))if(e.getCount())this._options.selectedIndex=e.getIndex(e.getFirst()),this._options.selectedKey=this._getKeyByIndex(this._options.selectedIndex);var t=e.at(this._options.selectedIndex);if(t)this._curHash=t.getHash()}},before:{setDataSource:function(e,t){if(!t)this._options.selectedIndex=-1,this._curHash=void 0},setItems:function(){this._options.selectedIndex=-1,this._curHash=void 0}},after:{_modifyOptions:function(e){var t,s;if(!e.allowEmptySelection&&e._itemsProjection&&!e.selectedKey)if(t=e._itemsProjection.at(0),t)if(s=t.getContents(),i.instanceOfModule(s,"WS.Data/Entity/Model"))e.selectedKey=s.get(e.idProperty)},_setItemsEventHandlers:function(){if(!this._onProjectionCurrentChange)this._onProjectionCurrentChange=o.bind(this);if(this.subscribeTo(this._getItemsProjection(),"onCurrentChange",this._onProjectionCurrentChange),!this._onProjectionChange)this._onProjectionChange=n.bind(this);this.subscribeTo(this._getItemsProjection(),"onCollectionChange",this._onProjectionChange)},_drawItemsCallback:function(e){if(!this.isDestroyed())this._drawSelectedItem(this._options.selectedKey,this._options.selectedIndex,e)},_unsetItemsEventHandlers:function(){if(this._getItemsProjection()&&this._onProjectionCurrentChange)this.unsubscribeFrom(this._getItemsProjection(),"onCurrentChange",this._onProjectionCurrentChange);if(this._getItemsProjection()&&this._onProjectionChange)this.unsubscribeFrom(this._getItemsProjection(),"onCollectionChange",this._onProjectionChange)},_itemsReadyCallback:function(){if(this._isEmptyIndex(this._options.selectedIndex)){var e=this._getItemsProjection().getCurrentPosition();if(!this._isEmptyIndex(e))this._options.selectedIndex=e}var t=this._options.selectedIndex;this._prepareBothSelectedConfig(this._options.selectedIndex,this._options.selectedKey),d.call(this,t)}},_setSelectedIndex:function(e,t){this._drawSelectedItem(t,e),this._notifySelectedItem(t,e)},setSelectedKey:function(e){if(this._options.selectedKey=e,this._prepareSelectedIndexByKey(this._options.selectedKey),this._getItemsProjection())this._selectInProjection()},setSelectedIndex:function(e){if(this._options.selectedIndex=e,this._prepareSelectedKeyByIndex(e),this._getItemsProjection())this._selectInProjection()},getSelectedKey:function(){return this._options.selectedKey},getSelectedIndex:function(){return this._options.selectedIndex},getSelectedItem:function(){var e=this.getItems();return e?e.getRecordById(this.getSelectedKey())||null:null},_drawSelectedItem:function(){},_getItemValue:function(t,i){if(t&&"object"===typeof t)return e.getItemPropertyValue(t,i);return t},_getItemIndexByKey:function(e){var t=this._getItemProjectionByItemId(e);return this._getItemsProjection().getIndex(t)},_notifySelectedItem:function(e,t){this._notifyOnPropertyChanged("selectedKey"),this._notifyOnPropertyChanged("selectedIndex"),this._notify("onSelectedItemChange",e,t)},_getKeyByIndex:function(e){if(this._hasItemByIndex(e)){var t=this._getItemsProjection().at(e).getContents();if(i.instanceOfModule(t,"WS.Data/Entity/Model"))return t.getId()}},_hasItemByIndex:function(e){return"undefined"!=typeof e&&null!==e&&"undefined"!=typeof this._getItemsProjection().at(e)},_isEmptyIndex:function(e){return null===e||"undefined"==typeof e||-1==e},_selectInProjection:function(){if(this._hasItemByIndex(this._options.selectedIndex))this._getItemsProjection().setCurrentPosition(this._options.selectedIndex);else this._getItemsProjection().setCurrentPosition(-1)}},n=function(e,i,s,n,o){switch(i){case t.ACTION_ADD:case t.ACTION_REMOVE:case t.ACTION_MOVE:case t.ACTION_REPLACE:case t.ACTION_RESET:var c=this._getItemIndexByKey(this._options.selectedKey),h=this._getItemsProjection(),l;if(this._isMove&&i==t.ACTION_ADD&&1==s.length&&this._isMoveKey==s[0].getContents().getId())this._options.selectedKey=this._isMoveKey,this._options.selectedIndex=h.getIndex(s[0]),this._isMove=false,this._isMoveKey=null;else if(this._isMove=false,this._isMoveKey=null,c>=0)this._options.selectedIndex=c;else if(l=h.getCount(),l>0){if(!this._isEmptyIndex(this._options.selectedIndex)){if(this._options.selectedIndex>l-1)this._options.selectedIndex=l-1;if(1==o.length&&i==t.ACTION_REMOVE&&void 0!==o[0].isNode&&o[0].getContents().getId()==this._options.selectedKey)this._isMove=true,this._isMoveKey=this._options.selectedKey;this._options.selectedKey=this._getKeyByIndex(this._options.selectedIndex)}else if(!this._options.allowEmptySelection)this._options.selectedIndex=0,this._options.selectedKey=this._getKeyByIndex(this._options.selectedIndex)}else this._options.selectedIndex=-1,this._options.selectedKey=null;var r;if(h){if(h.getCurrentPosition()!==this.getSelectedIndex())d.call(this,this.getSelectedIndex());var _=h.at(this._options.selectedIndex);if(_)r=_.getHash()}if(i!==t.ACTION_REPLACE&&r!==this._curHash)this._setSelectedIndex(this._options.selectedIndex,this._options.selectedKey),this._curHash=r}},o=function(e,t,i,s){this._setSelectedIndex(s,this._getKeyByIndex(s))},d=function(e){var t=this._getItemsProjection(),i=this.getSelectedIndex();if(this._isEmptyIndex(t.getCurrentPosition())&&!this._isEmptyIndex(i)&&t.getCount()>i)this._getItemsProjection().setCurrentPosition(i,e===i)};return s});
//# sourceMappingURL=Selectable.js.map
define("SBIS3.CONTROLS/Paging",["Lib/Control/CompoundControl/CompoundControl","tmpl!SBIS3.CONTROLS/Paging/Paging","SBIS3.CONTROLS/Mixins/ItemsControlMixin","SBIS3.CONTROLS/Mixins/Selectable","tmpl!SBIS3.CONTROLS/Paging/resources/ItemsTemplate","SBIS3.CONTROLS/Button/IconButton","css!SBIS3.CONTROLS/Paging/Paging"],function(t,e,n,i,s){"use strict";var o=function(t,e){var n,i,s,o=false,l=false,a=t.getCount(),r=[];if(e.showPages&&t){if(n=parseInt(e.selectedKey,10)||1,i=n-1,s=n+1,i<1)i=n,s=n+2>a?a:n+2;if(s>a)i=a-2<0?0:a-2,s=a;if("full"==e.mode){if(i-1>1)o=true;if(s+1<a)l=true}var g=1;t.each(function(t){var n=parseInt(t.getContents().getId(),10);if("part"==e.mode){if(n>=i&&n<=s)r.push(t)}else if("full"==e.mode)if(1==g||g==a)r.push(t);else{if(o&&2==g)r.push("...");if(l&&g==a-1)r.push("...");if(n>=i&&n<=s)r.push(t)}g++})}return r},l=function(t){if(t.pagesCount&&!t.items){t.items=[],t.idProperty="id",t.displayProperty="text";for(var e=1;e<=t.pagesCount;e++)t.items.push({id:e,text:e.toString()})}},a=t.extend([n,i],{_dotTplFn:e,$protected:{_prevBtn:null,_nextBtn:null,_options:{_canServerRender:true,_getRecordsForRedraw:o,allowEmptySelection:false,mode:"part",pagesCount:null,showPages:true,visiblePath:null}},$constructor:function(){this._publish("onPageChange")},_modifyOptions:function(t){l(t);var e=a.superclass._modifyOptions.apply(this,arguments);if(e._itemsTemplate=s,!t.visiblePath)t.visiblePath={begin:true,prev:true,pages:t.showPages,next:true,end:"full"===t.mode};return e},init:function(){if(a.superclass.init.call(this),!this._prevBtn)this._bindControls()},getMode:function(){return this._options.mode},getPagesCount:function(){return this._options.pagesCount},getZIndex:function(){return this._zIndex},setPagesCount:function(t){this._options.pagesCount=t,this._options.items=null,l(this._options),this.setItems(this._options.items)},_onClickHandler:function(t){var e=$(t.target).closest(".js-controls-ListView__item"),n,i,s;if(e.length)if(n=e.data("hash"),i=this._getItemsProjection(),i)s=i.getByHash(n),this.setSelectedKey(s.getContents().getId())},_drawSelectedItem:function(t){var e=t;$(".controls-Paging__item",this._container).removeClass("controls-ListView__item__selected"),$('.controls-Paging__item[data-id="'+e+'"]',this._container).addClass("controls-ListView__item__selected")},setSelectedKey:function(){if(a.superclass.setSelectedKey.apply(this,arguments),this._options.visiblePath.pages)this.redraw();else this._toggleItemsEnabled()},_getItemsContainer:function(){return $(".controls-Paging__itemsContainer",this._container.get(0))},_toggleItemsEnabled:function(){if(!this._prevBtn)this._bindControls();if(1==this.getSelectedKey())this._prevBtn.setEnabled(false),this._beginBtn.setEnabled(false);else this._prevBtn.setEnabled(true),this._beginBtn.setEnabled(true);if(this.getItems()&&this.getSelectedKey()==this.getItems().getCount())this._nextBtn.setEnabled(false),this._endBtn.setEnabled(false);else this._endBtn.setEnabled(true),this._nextBtn.setEnabled(true)},_drawItemsCallback:function(){a.superclass._drawItemsCallback.apply(this,arguments),this._toggleItemsEnabled()},destroy:function(){a.superclass.destroy.apply(this,arguments),this._prevBtn=null,this._nextBtn=null,this._beginBtn=null,this._endBtn=null},_bindControls:function(){this._prevBtn=this.getChildControlByName("PagingPrev"),this._nextBtn=this.getChildControlByName("PagingNext"),this._beginBtn=this.getChildControlByName("PagingBegin"),this._endBtn=this.getChildControlByName("PagingEnd"),this._prevBtn.subscribe("onActivated",this._goToPrev.bind(this)),this._nextBtn.subscribe("onActivated",this._goToNext.bind(this)),this._beginBtn.subscribe("onActivated",this._goToBegin.bind(this)),this._endBtn.subscribe("onActivated",this._goToEnd.bind(this))},_goToNext:function(){this._goToSibling(1)},_goToPrev:function(){this._goToSibling(-1)},_goToSibling:function(t){var e=parseInt(this.getSelectedKey(),10);this.setSelectedKey(e+t)},_goToBegin:function(){this._notify("onFirstPageSet"),this.setSelectedKey(1)},_goToEnd:function(){this._notify("onLastPageSet"),this.setSelectedKey(this.getItems().getCount())}});return a});
//# sourceMappingURL=Paging.js.map
define("SBIS3.CONTROLS/Mixins/MultiSelectable",["Core/ParallelDeferred","Core/core-clone","Core/Deferred","Core/moduleStubs","Core/IoC","WS.Data/Collection/List","SBIS3.CONTROLS/Utils/ArraySimpleValuesUtil","Core/helpers/Object/isEqual","Core/core-instance","Core/helpers/Function/forAliveOnly","Core/helpers/Array/clone"],function(e,t,s,i,o,l,n,r,c,d,a){var h=[null],f=function(e,t){var s=[],i;if(e)e.each(function(e){if(i=e.get(t||this._options.idProperty),void 0===i)throw new Error(this._moduleName+": record key is undefined.");if(!n.hasInArray(s,i))s.push(i)},this);return s};return{$protected:{_options:{multiselect:true,selectedKeys:[],allowEmptyMultiSelection:true,selectedItems:null,useSelectAll:false,_isEmptySelection:{isEmptySelection:function(e){var t=e.selectedKeys,s=e.selectedItems,i=e._items,o=true;if(t.length)if(r(t,h)){if(i&&-1!==i.getIndexByValue(e.idProperty,h[0]))o=false;if(o&&s&&-1!==s.getIndexByValue(e.idProperty,h[0]))o=false}else if(o)o=false;return o}}.isEmptySelection},_loadItemsDeferred:void 0,_selectorController:void 0},$constructor:function(){if(this._publish("onSelectedItemsChange"),this._options.useSelectAll){var e=c.instanceOfMixin(this,"SBIS3.CONTROLS/Mixins/TreeMixin")?"SBIS3.CONTROLS/ListView/resources/MassSelectionController/MassSelectionHierarchyController":"SBIS3.CONTROLS/ListView/resources/MassSelectionController/MassSelectionController";i.require([e]).addCallback(function(e){this._selectorController=new e[0]({linkedObject:this,idProperty:this._options.idProperty})}.bind(this))}if(this._options.selectedKeys&&this._options.selectedKeys.length)if(Array.isArray(this._options.selectedKeys)){if(!this._options.multiselect)this._options.selectedKeys=this._options.selectedKeys.slice(0,1)}else throw new Error("Argument must be instance of Array");else if(false==this._options.allowEmptyMultiSelection)this._setFirstItemAsSelected()},_projSelectedChange:function(e){},after:{init:function(){this._drawSelectedItems(this._options.selectedKeys,{})},destroy:function(){if(this._loadItemsDeferred&&!this._loadItemsDeferred.isReady())this._loadItemsDeferred.cancel();if(this._selectorController)this._selectorController.destroy()}},before:{setDataSource:function(){this.once("onDataLoad",function(e,t){this._checkNewItemsFormat(t)})},setItems:function(){this.once("onItemsReady",function(){this._checkNewItemsFormat(this.getItems())})},_modifyOptions:function(e){if(e.selectedItems)e.selectedKeys=f(e.selectedItems,e.idProperty);if(!e.multiselect&&e.useSelectAll)e.useSelectAll=false}},setSelectedKeys:function(e){var t=this._isEmptySelection(),s;if(Array.isArray(e)){if(this._selectorController)this._selectorController.setSelectedKeys(e);if(s=n.getArrayDifference(this._options.selectedKeys,e),this._options.multiselect||!e.length)this._options.selectedKeys=e;else if(1===e.length)this._options.selectedKeys=e;else this._options.selectedKeys=e.slice(0,1);if(t&&this._isEmptySelection())return;this._afterSelectionHandler(s.added,s.removed,t)}else throw new Error("Argument must be instance of Array")},setSelectedItemsAll:function(){if(this._selectorController)this._selectorController.setSelectedItemsAll();else this.setSelectedKeys(this._convertToKeys(this.getItems()))},getSelectedKeys:function(){return this._options.selectedKeys},addItemsSelection:function(e){var t=this._addItemsSelection(e);this._afterSelectionHandler(t,[])},_addItemsSelection:function(e){var t=[],s=[];if(Array.isArray(e)){if(e.length)if(this._options.multiselect){if(this._selectorController)this._selectorController.addItemsSelection(e);t=a(this._options.selectedKeys);for(var i=0;i<e.length;i++)if(!this._isItemSelected(e[i]))t.push(e[i])}else t=e.slice(0,1);return s=n.getArrayDifference(this._options.selectedKeys,t).added,this._options.selectedKeys=t,s}else throw new Error("Argument must be instance of Array")},removeItemsSelection:function(e){var t=this._removeItemsSelection(e);this._afterSelectionHandler([],t)},_removeItemsSelection:function(e){var t=[],s=a(this._options.selectedKeys);if(Array.isArray(e)){if(this._selectorController)this._selectorController.removeItemsSelection(e);for(var i=e.length-1;i>=0;i--)if(this._isItemSelected(e[i]))s.splice(this._getSelectedIndex(e[i],s),1),t.push(e[i]);return this._options.selectedKeys=s,t}else throw new Error("Argument must be instance of Array")},removeItemsSelectionAll:function(){if(this._selectorController)this._selectorController.removeItemsSelectionAll();else this.setSelectedKeys([])},toggleItemsSelection:function(e){if(Array.isArray(e)){if(e.length){var s=[],i=[],o,l;if(this._options.multiselect){if(this._isEmptySelection())return void this.setSelectedKeys(e);for(var n=0;n<e.length;n++)if(this._isItemSelected(e[n])||this._isItemPartiallySelected(e[n]))l=this._removeItemsSelection([e[n]]),i=i.concat(l);else o=this._addItemsSelection([e[n]]),s=s.concat(o)}else if(this._isItemSelected(e[0]))i=t(this._options.selectedKeys),this._options.selectedKeys=[];else i=t(this._options.selectedKeys),this._options.selectedKeys=e.slice(0,1),s=t(this._options.selectedKeys);this._afterSelectionHandler(s,i)}}else throw new Error("Argument must be instance of Array")},_isItemPartiallySelected:function(e){return c.instanceOfModule(this._selectorController,"SBIS3.CONTROLS/ListView/resources/MassSelectionController/MassSelectionHierarchyController")&&this._selectorController.isItemPartiallySelected(e)},toggleItemsSelectionAll:function(){if(this._selectorController)this._selectorController.toggleItemsSelectionAll();else this.toggleItemsSelection(this._convertToKeys(this.getItems()))},setMultiselect:function(e){var t=Boolean(e),s;if(this._options.multiselect!==t){if(this._options.multiselect=t,s=this.getSelectedKeys(),false===t&&s.length>1)this.setSelectedKeys(s);this._notifyOnPropertyChanged("multiselect")}},getMultiselect:function(){return this._options.multiselect},getSelection:function(){if(this._selectorController)return this._selectorController.getSelection()},getSelectedItems:function(t,i){this._syncSelectedItems();var l=this,r=this._options.selectedKeys,a=[],h,f,_,m,u,S;if(!t)return this._options.selectedItems;else if(this._loadItemsDeferred&&!this._loadItemsDeferred.isReady())return this._loadItemsDeferred;else if(this._isEmptySelection())return(new s).callback(this._options.selectedItems);this._loadItemsDeferred=new s({cancelCallback:function(){if(h)h.getResult().cancel(),S.cancel()}}),u=this._convertToKeys(this._options.selectedItems);for(var y=0,I=r.length;y<I;y++)if(!n.hasInArray(u,r[y]))a.push(r[y]);if(m=a.length,m){if(m=i<m?i:m,h=new e({stopOnFirstError:false}),this.isLoading())S=(new s).dependOn(this._loader);else S=s.success();if(!this._options.selectedItems)this.initializeSelectedItems();s.callbackWrapper(S,d(function(e){_=l.getItems();for(var t=0;m>t;t++){if(f=_&&_.at(_.getIndexByValue(l._options.idProperty,a[t])),f){l._options.selectedItems.add(f);continue}if(!l._dataSource){o.resolve("ILogger").log("MultiSelectable","Потенциальная ошибка. У контрола "+l.getName()+" не задан dataSource для вычитки записей.");continue}if(null!==a[t])h.push(l._dataSource.read(a[t]).addCallbacks(function(e){if(!h.getResult().isReady())l._options.selectedItems.add(e);return e},function(e){if(o.resolve("ILogger").info("MultiSelectable","У контрола "+l.getName()+" не удалось вычитать запись по ключу "+e),c.instanceOfModule(l._dataSource,"WS.Data/Source/Rpc"))l._removeItemsSelection([e])}.bind(this,a[t])))}return h.done().getResult().addCallback(function(){l._onSelectedItemsChangeHandler(),l._loadItemsDeferred.callback(l._options.selectedItems)}),e},l))}else l._loadItemsDeferred.callback(this._options.selectedItems);return this._loadItemsDeferred},_syncSelectedItems:function(){var e=this,t=this._options.selectedItems,s=[];if(!t)return;if(this._isEmptySelection()){if(t.getCount())t.clear(),this._onSelectedItemsChangeHandler();return}if(t.each(function(t){if(!e._isItemSelected(t.get(e._options.idProperty)))s.push(t)}),s.length){for(var i=0,o=s.length;i<o;i++)t.remove(s[i]);this._onSelectedItemsChangeHandler()}},_onSelectedItemsChangeHandler:function(){this._cloneSelectedItems(),this._notifyOnPropertyChanged("selectedItems")},_cloneSelectedItems:function(){this._options.selectedItems=this._options.selectedItems.clone(true)},_isItemSelected:function(e){return-1!==this._getSelectedIndex(e)},_getSelectedIndex:function(e,t){var s=t||this._options.selectedKeys,i=this._options.selectedItems,o=n.invertTypeIndexOf(s,e);if(-1===o&&c.instanceOfModule(e,"WS.Data/Entity/Model"))if(i)o=i.getIndexByValue(e.getIdProperty(),e.get(this._options.idProperty));else o=-1;return o},_drawSelectedItems:function(){},_makeList:function(e){return new l({items:e?e:[]})},_afterSelectionHandler:function(e,t){if(this._checkEmptySelection())this._setFirstItemAsSelected();if(this._loadItemsDeferred&&(e.length||t.length))this._loadItemsDeferred.cancel();if(this._notifySelectedItems(this._options.selectedKeys,{added:e,removed:t}),!this.isDestroyed())this._drawSelectedItems(this._options.selectedKeys,{added:e,removed:t})},_notifySelectedItems:function(e,t){this._setSelectedItems(),this._notifyOnPropertyChanged("selectedKeys"),this._notify("onSelectedItemsChange",e,t)},initializeSelectedItems:function(){this._options.selectedItems=new l},_dataLoadedCallback:function(){var e=this.getItems();if(this._checkEmptySelection())if(e)if(this._setFirstItemAsSelected(),!this._isEmptySelection())this._afterSelectionHandler(this.getSelectedKeys(),[]);this._setSelectedItems()},_setFirstItemAsSelected:function(){var e=this.getItems(),t=e&&e.at(0);if(t)this._options.selectedKeys=[t.getId()]},_checkEmptySelection:function(){return this._isEmptySelection()&&false==this._options.allowEmptyMultiSelection},_setSelectedItems:function(){var e,t,s=-1,i=this,o=[],l=this.getItems();if(!i._options.selectedItems)i.initializeSelectedItems();if(l&&(!this._loadItemsDeferred||this._loadItemsDeferred.isReady()))if(t=!this._options.selectedItems.getCount(),this.getSelectedKeys().forEach(function(n){if(e=l.at(l.getIndexByValue(i._options.idProperty,n)),e){if(t)return void o.push(e);if(s=i._options.selectedItems.getIndexByValue(i._options.idProperty,e.getId()),-1!==s)i._options.selectedItems.replace(e,s);else o.push(e)}}),o.length)i._options.selectedItems.append(o)},_checkNewItemsFormat:function(e){var t=this._options.selectedItems;if(!t||!e||!c.instanceOfMixin(t,"WS.Data/Entity/FormattableMixin")||!c.instanceOfMixin(e,"WS.Data/Entity/FormattableMixin"))return false;else if(e.getAdapter()._moduleName!==t.getAdapter()._moduleName||!e.getFormat().isEqual(t.getFormat()))this._options.selectedItems=null},_isEmptySelection:function(){return this._options._isEmptySelection(this._options)},_convertToKeys:f}});
//# sourceMappingURL=MultiSelectable.js.map
define("SBIS3.CONTROLS/Mixins/DragNDropMixin",["Core/EventBus","SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragObject","WS.Data/Di","Core/core-instance","css!SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragNDropMixin"],function(e,n,t,i){"use strict";if("undefined"!==typeof window){var r=1,o=24,a=0,s=false,g=e.channel("DragAndDropChannel"),u=function(e){g.notify("onMouseup",e),n.reset()};$(document).on("mousedown touchstart",function(e){if(e.buttons&r)s=true,a=window.innerWidth}).on("mousemove touchmove",function(e){if(s&&!(e.buttons&r)&&a-e.pageX<o)s=false,u(e);else g.notify("onMousemove",e)}).on("mouseup touchend",function(e){s=false,u(e)})}return{$protected:{_options:{dragEntity:void 0,dragEntityList:"collection.list",itemsDragNDrop:true},_constShiftLimit:3,_beginDragTarget:null},$constructor:function(){this._publish("onDragMove","onBeginDrag","onEndDrag"),e.channel("DragAndDropChannel").subscribe("onMouseup",this._onMouseupOutside,this),e.channel("DragAndDropChannel").subscribe("onMousemove",this._onMousemove,this)},after:{destroy:function(){e.channel("DragAndDropChannel").unsubscribe("onMouseup",this._onMouseupOutside,this),e.channel("DragAndDropChannel").unsubscribe("onMousemove",this._onMousemove,this)}},setDragEntity:function(e){this._options.dragEntity=e},getItemsDragNDrop:function(){return this._options.itemsDragNDrop},setItemsDragNDrop:function(e){this._options.itemsDragNDrop=e},_endDragHandler:function(e,n,t){},_onDragHandler:function(e,n){},_beginDragHandler:function(e,n){},_createAvatar:function(e,n){},_updateDragTarget:function(e,n){},_showAvatar:function(e){if(!n.getAvatar()){var t=this._createAvatar(n,e);n.setAvatar(t)}},_initDrag:function(t){var i=this,o=function(r,a){if(i._preparePageXY(a),!n.isDragging()&&i._isDrag(a,t))i._beginDrag(t),i._beginDragTarget=t.target,e.channel("DragAndDropChannel").unsubscribe("onMousemove",o)},a=t.originalEvent||t;if(0===$(a.target).closest(".controls-DragNDropMixin__notDraggable",i._getDragContainer()[0]).length&&("mousedown"==a.type&&a.which==r||"mousedown"!=a.type))e.channel("DragAndDropChannel").subscribe("onMousemove",o),e.channel("DragAndDropChannel").once("onMouseup",function(){e.channel("DragAndDropChannel").unsubscribe("onMousemove",o)}),this._preventClickEvent(t)},_beginDrag:function(e){if(this._options.itemsDragNDrop)if(n.setDragging(true),n.onDragHandler(e),false!==this._beginDragHandler(n,e))if(false!==this._notify("onBeginDrag",n,e))this._initDragOverlay(),this._showAvatar(e),n.setOwner(this),n.setDragging(true);else n.reset();else n.reset()},_preparePageXY:function(e){if("touchstart"==e.type||"touchmove"==e.type)e.pageX=e.originalEvent.touches[0].pageX,e.pageY=e.originalEvent.touches[0].pageY;else if("touchend"==e.type)e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY},_isDrag:function(e,n){var t=e.pageX-n.pageX,i=e.pageY-n.pageY;if(Math.abs(t)<this._constShiftLimit&&Math.abs(i)<this._constShiftLimit)return false;return true},_endDrag:function(e,t){if($(".controls-DragNDropMixin-overlay").remove(),t||"touchend"==e.type)this._updateDragTarget(n,e);if(this._breakClickBySelf(e.target),false!==this._notify("onEndDrag",n,e))this._endDragHandler(n,t,e);this._position=null},_makeDragEntity:function(e){return t.resolve(this._options.dragEntity,e)},_makeDragEntityList:function(e){return t.resolve(this._options.dragEntityList,e)},_onDrag:function(e){var t=n.getTargetsControl(),i,r=this._getDragContainer();if(this._updateDragTarget(n,e),t===this)r.addClass("controls-dragndrop"),i=this._notify("onDragOver",n,e);else if(r.hasClass("controls-dragndrop"))r.removeClass("controls-dragndrop");if(n.getOwner()===this)this._notify("onDragMove",n,e);if(false!==i)this._onDragHandler(n,e)},_onMouseupOutside:function(e,n){this._mouseUp(n,false)},_mouseUp:function(e){if(this._options.itemsDragNDrop){this._preparePageXY(e),n.onDragHandler(e);var t=n.getTargetsControl();if(this._getDragContainer().removeClass("controls-dragndrop"),t=t&&i.instanceOfMixin(t,"SBIS3.CONTROLS/Mixins/DragNDropMixin")?t:null,n.isDragging()&&(t===this||n.getOwner()===this)){var r=this._getDragContainer(e,n.getTargetsDomElement()).find(n.getTargetsDomElement()).length>0?true:false;this._endDrag(e,r)}}},_getDragContainer:function(){return this.getContainer()},_onMousemove:function(e,t){if(this._options.itemsDragNDrop){if(!n.isDragging())return;if(this._preparePageXY(t),n.onDragHandler(t),n.getOwner()===this||n.getTargetsControl()===this)return this._onDrag(t),false}},_breakClickBySelf:function(e){if(this._beginDragTarget&&(this._beginDragTarget==e||$(e).find(this._beginDragTarget).length>0))$(e).one("click",function(e){return e.preventDefault(),false})},_preventClickEvent:function(e){if("mousedown"==e.type){e.preventDefault();var n=window.getSelection();if(n)if(n.removeAllRanges)n.removeAllRanges();else if(n.empty)n.empty()}},_initDragOverlay:function(){$("iframe:visible").each(function(e,n){var t=n.getBoundingClientRect(),i=$('<div class="controls-DragNDropMixin-overlay">');i.css({width:t.width,height:t.height,left:n.offsetLeft,top:n.offsetTop}),$(n).parent().prepend(i)})}}});
//# sourceMappingURL=DragNDropMixin.js.map
define("SBIS3.CONTROLS/ListView/resources/VirtualScrollController",["Core/Abstract"],function(t){var e=20,n=5,o=t.extend({$protected:{_options:{mode:"down",projection:null,viewport:null,itemsContainer:null},_projection:null,_currentVirtualPage:0,_heights:[],_notAddedAmount:0,_viewportHeight:0,_DEBUG:false,_con:null},init:function(){if(o.superclass.init.call(this),this._projection=this._options.projection,this._options.viewport)this.initHeights();if(this._projection)this._currentWindow=this._getRangeToShow(0,n);if(this._options.viewport);if(this._con=window&&window.console,!this._con)this._con={log:function(){}}},disableScrollHandler:function(t){this._scrollHandlerDisabled=!!t},reset:function(){this._currentVirtualPage=0,this._heights=[],this.initHeights(),this._currentWindow=this._getRangeToShow(0,n),clearTimeout(this._scrollTimeout),this.disableScrollHandler(false)},_scrollHandler:function(t,i){if(!this._scrollHandlerDisabled)clearTimeout(this._scrollTimeout),this._scrollTimeout=setTimeout(function(){var t=this._options.viewport.scrollTop(),i=this._getPage(t);if(this._currentVirtualPage!=i)this._currentVirtualPage=i,this._onVirtualPageChange(i)}.bind(this),25)},_getPage:function(t){for(var i=0,n=0;n<this._heights.length;n++)if(i+=this._heights[n],i>=t)return Math.ceil(n/e);return Math.ceil((this._heights.length-1)/e)},_onVirtualPageChange:function(t){var i=this._projection.getCount(),e=this._getRangeToShow(t,n),o=this._getDiff(this._currentWindow,e,i);if(o){if(this._DEBUG)this._con.log("page",t),this._con.log("Current widnow:",this._currentWindow[0],this._currentWindow[1],"New widnow:",e[0],e[1]),this._con.log("add from",o.add[0],"to",o.add[1],"at",o.addPosition),this._con.log("remove from",o.remove[0],"to",o.remove[1]),this._con.log("displayed from ",e[0],"to",e[1]);var h=this._getWrappersHeight(e);this._notify("onWindowChange",{remove:o.remove,add:o.add,addPosition:o.addPosition,topWrapperHeight:h.begin,bottomWrapperHeight:h.end})}this._currentWindow=e},_getWrappersHeight:function(t){for(var i=0,e=0,n=0;n<t[0];n++)i+=this._getHeightByIndex(n);for(n=t[1];n<this._heights.length-1;n++)e+=this._getHeightByIndex(n);if(this._DEBUG)this._con.log("top height",i),this._con.log("bottom height",e);return{begin:i,end:e}},_getHeightByIndex:function(t){if(!this._heights[t]){var i=this._projection.at(t);this._heights[t]=this._getItemHeight(i)}return this._heights[t]},_getRangeToShow:function(t,i){var n=Math.ceil(i/2),o=t+n<i?i:t+n,h=t-n<0?0:t-n+1;if(h*=e,o*=e,o>=this._heights.length)o=this._heights.length-1;return[h,o]},_getDiff:function(t,i,e){var n,o,h={},r=0;if(t[0]==i[0]&&t[1]==i[1])return false;if(t[0]<i[0]||t[1]<i[1])h.add=[t[1]+1,i[1]],h.remove=[t[0],i[0]-1],r=h.add[0];else h.add=[i[0],t[0]-1],h.remove=[i[1]+1,t[1]];if(t[1]<i[0])h.remove=t,h.add=i,r=h.add[0];if(t[0]>i[1])h.add=i,h.remove=t;if(h.add[0]>e)h.add[0]=e;return{remove:h.remove,add:h.add,addPosition:r}},initHeights:function(){var t=this,i=this._options.itemsContainer.find("> *").not(".ws-hidden, .ws-sticky-header__table-sticky-row");if(0===this._heights.length)this._viewportHeight=this._options.viewport[0].offsetHeight,i.each(function(){t._heights.push(this.offsetHeight)})},_getItemHeight:function(t){return $('[data-hash="'+t.getHash()+'"]',this._options.viewContainer).height()},addItems:function(t,i){for(var e=0;e<t.length;e++)if(this._heights.splice(i+e,0,this._getItemHeight(t[e])),e+i<this._currentWindow[0])this._currentWindow[0]+=1,this._currentWindow[1]+=1;else if(e+i-1<=this._currentWindow[1]+1)this._currentWindow[1]+=1;this._onVirtualPageChange(this._currentVirtualPage)},removeItems:function(t,e){for(this._heights.splice(e,t.length),i=0;i<t.length;i++)if(i+e<this._currentWindow[0])this._currentWindow[0]-=1,this._currentWindow[1]-=1;else if(i+e<=this._currentWindow[1])this._currentWindow[1]-=1;this._onVirtualPageChange(this._currentVirtualPage)},updateProjection:function(t){this._projection=t}});return o});
//# sourceMappingURL=VirtualScrollController.js.map
define("SBIS3.CONTROLS/ListView/resources/SwipeHandlers",[],function(){if("undefined"!=typeof $)$.event.special.swipe={xTreshold:50,yTreshold:25,scrollTreshold:30,durTreshold:600,eventInProgress:false,start:function(e){var t=e.originalEvent.touches?e.originalEvent.touches[0]:e,o=$.event.special.swipe.getLocation(t);return{time:(new Date).getTime(),coords:[o.x,o.y],origin:$(e.target)}},stop:function(e){var t=e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches[0]:e.touches[0],o=$.event.special.swipe.getLocation(t);return{time:(new Date).getTime(),coords:[o.x,o.y]}},getLocation:function(e){return{x:e.clientX,y:e.clientY}},handleSwipe:function(e,t,o,i){if(t.time-e.time<$.event.special.swipe.durTreshold){var n,s;if(Math.abs(e.coords[0]-t.coords[0])>$.event.special.swipe.xTreshold&&Math.abs(e.coords[1]-t.coords[1])<$.event.special.swipe.yTreshold)n=e.coords[0]>t.coords[0]?"left":"right",s="swipe";if(Math.abs(e.coords[1]-t.coords[1])>$.event.special.swipe.xTreshold&&Math.abs(e.coords[0]-t.coords[0])<$.event.special.swipe.yTreshold)n=e.coords[1]>t.coords[1]?"top":"bottom",s="swipeVertical";if(s)return $.event.trigger($.Event(s,{target:i,swipestart:e,swipestop:t,direction:n}),void 0,o),true}return false},setup:function(){var e={},t=this,o=$.data(this,"swipe-event");if(!o)o={},$.data(this,"swipe-event",o);o.swipe=e,e.start=function(o){if($.event.special.swipe.eventInProgress)return;$.event.special.swipe.eventInProgress=true;var i,n=$.event.special.swipe.start(o),s=o.target,a=false;e.move=function(e){if(!n||e.defaultPrevented)return;if(i=$.event.special.swipe.stop(e),!a)if(a=$.event.special.swipe.handleSwipe(n,i,t,s),a)$.event.special.swipe.eventInProgress=false},e.stop=function(){a=true,$.event.special.swipe.eventInProgress=false,document.removeEventListener("touchend",e.stop),document.removeEventListener("touchmove",e.move)},document.addEventListener("touchmove",e.move,true),document.addEventListener("touchend",e.stop,true)},$(this).bind("touchstart",e.start)},teardown:function(){var e,t;if(e=$.data(this,"swipe-event"),e)t=e.swipe,delete e.swipe,$.removeData(this,"swipe-event");if(t){if(t.start)$(this).off("ontouchstart",t.start);if(t.move)$(document).off("ontouchmove",t.move);if(t.stop)$(document).off("ontouchend",t.stop)}}},$.event.special.tap={tapholdThreshold:750,tapThreshold:100,xyThreshold:10,setup:function(){var e=$(this),t=this,o={},i=$.data(this,"tap-event"),n=false;if(!i)i={},$.data(this,"tap-event",i);i.tap=o,o.start=function(e){n=false;var i,s=e.target,a=(new Date).getTime(),r=$.event.special.swipe.getLocation(e.originalEvent.touches[0]),c=r;function p(){clearTimeout(i)}o.move=function(e){c=$.event.special.swipe.getLocation(e.originalEvent.touches[0])},$(document).on("touchmove",o.move),i=setTimeout(function(){if(n=true,Math.abs(r.x-c.x)+Math.abs(r.y-c.y)<$.event.special.tap.xyThreshold)$.event.trigger($.Event("taphold",{target:s}),void 0,t),e.stopPropagation()},$.event.special.tap.tapholdThreshold),$(document).one("touchend",function(e){p();var i=(new Date).getTime();if(!n&&e.target==s&&i-a<$.event.special.tap.tapThreshold)$.event.trigger($.Event("tap",{target:s}),void 0,t);$(document).off("touchmove",o.move)})},e.bind("touchstart",o.start)},teardown:function(){var e,t;if(e=$.data(this,"tap-event"),e)t=e.tap,delete e.tap,$.removeData(this,"tap-event");if(t){if(t.start)$(this).unbind("touchstart",t.strat);if(t.move)$(this).unbind("touchmove",t.move)}}},$.event.special.taphold={setup:function(){$(this).bind("tap",$.noop)},teardown:function(){$(this).unbind("tap")}}});
//# sourceMappingURL=SwipeHandlers.js.map
define("SBIS3.CONTROLS/ListView/resources/Mover",["WS.Data/Di","Core/core-instance","Core/Deferred","Core/Abstract","WS.Data/Utils","WS.Data/Source/ISource","SBIS3.CONTROLS/Utils/InformationPopupManager"],function(e,t,o,n,i,r,s){"use strict";var a=n.extend({$protected:{_options:{moveStrategy:void 0,items:void 0,projection:void 0,parentProperty:null,nodeProperty:null,dataSource:void 0,enabled:true}},$constructor:function(e){if(e=e||{},this._publish("onBeginMove","onEndMove"),e.moveStrategy)i.logger.stack(this._moduleName+"MoveStrategy have deprecated, and will be removed in 3.8.0, please use events onBeginMove or onEndMove on ListView instead of MoveStrategy",1)},moveRecordDown:function(e){this._moveToOneRow(e,"after")},moveRecordUp:function(e){this._moveToOneRow(e,"before")},getItems:function(){return this._options.items},setItems:function(e){this._options.items=e},_moveToOneRow:function(e,t){if(this.isEnabled()){var o=this.getItemsProjection(),n=o.getItemBySourceItem(e),i="after"==t?o.getNext(n):o.getPrevious(n);if(i)this.move([e],i.getContents(),t)}},getItemsProjection:function(){return this._options.projection},setItemsProjection:function(e){this._options.projection=e},moveFromOutside:function(e,n,i,r){var s=e.getOperation(),f=e.getAction(),c=false;if(this.isEnabled()){if("function"===typeof f)c=f.call(e);else if(r&&("add"===s||"move"===s)){var d=[];e.each(function(e){d.push(e.getModel())}),c=this.move(d,n.getModel(),n.getPosition())}c=c instanceof o?c:(new o).callback(c);var u=this.getItems().getIndex(n.getModel()),l=this.getItems();u="after"!=n.getPosition()?u:u+1,c.addCallback(function(o){if(false!==o&&o!==a.ON_BEGIN_MOVE_RESULT.CUSTOM)e.each(function(e){var o=e.getModel();if("add"===s||"move"===s)if(t.instanceOfModule(l,"WS.Data/Collection/RecordSet")){if(!l.getRecordById(o.getId()))l.add(o,u)}else if(-1===l.getIndex(o))l.add(o.clone(),u);if("delete"===s||"move"===s)i.remove(o)});return o})}return c instanceof o?c:(new o).callback(c)},move:function(e,n,i){var r=false,a=true,f="on"!==i;if(this.isEnabled()){if(null!==n&&!t.instanceOfModule(n,"WS.Data/Entity/Model"))n=this.getItems().getRecordById(n);var c=this.getMoveStrategy();if(e=e.filter(function(e){return this._checkRecordForMove(e,n,i)}.bind(this)),e.length>0)if(c)if(f)r=c.move(e,n,"after"==i);else r=c.hierarchyMove(e,n);else{if((r=this._notify("onBeginMove",e,n,i))instanceof o)r.addCallback(function(t){return this._move(e,n,i,t)}.bind(this));else r=this._move(e,n,i,r);r.addBoth(function(t){if(this._notify("onEndMove",t,e,n,i),t instanceof Error&&!t.processed&&!t._isOfflineMode)s.showMessageDialog({message:t.message,status:"error"}),t.processed=true;return t}.bind(this))}}return r instanceof o?r:(new o).callback(r)},_move:function(e,t,n,i){if(i==a.ON_BEGIN_MOVE_RESULT.MOVE_IN_ITEMS)this._moveInItems(e,t,n);else if(i!==a.ON_BEGIN_MOVE_RESULT.CUSTOM)return this._callMoveMethod(e,t,n,i).addCallback(function(o){return this._moveInItems(e,t,n),o}.bind(this));return(new o).callback(i)},isEnabled:function(){return this._options.enabled},setEnabled:function(e){this._options.enabled=e},getMoveStrategy:function(){return this._options.moveStrategy},setMoveStrategy:function(e){this._options.moveStrategy=e},_callMoveMethod:function(e,n,i,r){if(r!==a.ON_BEGIN_MOVE_RESULT.MOVE_IN_ITEMS){var s=[];e.forEach(function(e){if(t.instanceOfModule(e,"WS.Data/Entity/Model"))s.push(e.getId());else s.push(e)});var f=this._getDataSource();if(f)return f.move(s,null===n?null:n.getId(),{position:i,parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty})}return(new o).callback(r)},_getDataSource:function(){return this._options.dataSource},_moveInItems:function(e,t,o){var n=this.getItems();if(n)e.forEach(function(e){var i=n.getIndex(e);if(-1==i)n.add(e),i=n.getCount()-1,e=n.at(i);if("on"!==o){if(this._options.parentProperty)e.set(this._options.parentProperty,t.get(this._options.parentProperty));var s=n.getIndex(t);if(o==r.MOVE_POSITION.after&&s<i)s=s+1<n.getCount()?++s:n.getCount();else if(o==r.MOVE_POSITION.before&&s>i)s=0!==s?--s:0;n.move(i,s)}else if(this._options.parentProperty)e.set(this._options.parentProperty,t?t.getId():null)}.bind(this))},_checkRecordForMove:function(e,o,n){var i,r=[],s="on"!==n,a=this._options.parentProperty;if(void 0===o||!s&&!this._options.nodeProperty)return false;if(s&&(a&&o.get(a)==e.get(a)||!a)){var f=this.getItems().getIndex(o),c=this.getItems().getIndex(e);if(f="before"==n?f-1:f+1,c>-1&&c==f)return false}if(a){if(null!==o){if(this._options.nodeProperty&&!s&&null===o.get(this._options.nodeProperty))return false;r=this._getParentsMap(o.getId())}if(i=""+(t.instanceOfModule(e,"WS.Data/Entity/Model")?e.getId():e),-1!==r.indexOf(i))return false}return true},_getParentsMap:function(e){var t=this.getItems(),o=t.getMetaData().path,n=[];if(t.getMetaData().path)o.each(function(e){n.push(""+e.getId())});var i=t.getRecordById(e);while(i){if(e=""+i.getId(),-1===n.indexOf(e))n.push(e);e=i.get(this._options.parentProperty),i=t.getRecordById(e)}return n},checkRecordsForMove:function(e,t,o){if(-1===this.getItems().getIndex(t))return false;for(var n=0,i=e.length;n<i;n++)if(!this._checkRecordForMove(e[n],t,o))return false;return true}});return e.register("listview.mover",a),a.ON_BEGIN_MOVE_RESULT={CUSTOM:"Custom",MOVE_IN_ITEMS:"MoveInItems"},a.make=function(e,t){return(t=t||{})["handlers"]={onBeginMove:function(e,t,o,n){e.setResult(this._notify.call(this,"onBeginMove",t,o,n))}.bind(e),onEndMove:function(e,t,o,n,i){e.setResult(this._notify.call(this,"onEndMove",t,o,n,i))}.bind(e)},new a(t)},a});
//# sourceMappingURL=Mover.js.map
define("tmpl!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/editActions",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Button/IconButton","js!WSControls/Buttons/Button"],function(){var t=Array.prototype.slice.call(arguments),o=t[0],e={};e["js!SBIS3.CONTROLS/Button/IconButton"]=t[1],e["js!WSControls/Buttons/Button"]=t[2];var n=function t(n,r,s,i,l){function c(){}var a=0,u=void 0!==o&&o?o:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var m="string"==typeof s?s:"",p=void 0===e?void 0:e,S={id:[],def:void 0},v=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),B=this&&this.includedTemplates?this.includedTemplates:{},f=u.getMarkupGenerator(i);try{var C=f.joinElements([f.createTag("div",{class:"controls-ItemsToolbar__editActions ws-hidden"},[f.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{command:"commitEdit",commandArgs:[!0],allowChangeEnable:!1,className:"controls-IconButton__round-border-24",icon:"sprite:icon-size icon-Yes icon-done",tooltip:global.rk("Сохранить")},{class:"controls-ItemActions-button"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},s,p,B,u.config,d),f.createControl("wsControl","ws:WSControls/Buttons/Button",{command:"cancelEdit",allowChangeEnable:!1,tooltip:global.rk("Отмена")},{class:"controls-EditActions__cancelButton"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},s,p,B,u.config,d)],r,S,this)],m,S);S.def&&(C=f.chain(C,S,r),S=void 0)}catch(t){u.templateError("resources/SBIS3.CONTROLS/ListView/resources/ItemsToolbar/editActions.tmpl",t,n)}return C||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/editActions"}},n});
//# sourceMappingURL=editActions.tmpl.map
define("tmpl!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,o,n,l,s){function a(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var g={};s&&s.isSetts&&(g=s.fullContext||{});var u="string"==typeof n?n:"",m=void 0===r?void 0:r,d={id:[],def:void 0},v=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),S=this&&this.includedTemplates?this.includedTemplates:{},C=p.getMarkupGenerator(l);try{var h=C.joinElements([void(S._itemTpl=function(e,t){var r=this&&this.includedTemplates?this.includedTemplates:{},i=p.getMarkupGenerator(l);try{var o=i.joinElements([i.createControl("resolver",!p.getter(e,["icon"])||"icon"!==p.getter(e,["viewMode"])&&p.getter(e,["viewMode"])?"SBIS3.CONTROLS/Link":"SBIS3.CONTROLS/Button/IconButton",{visible:p.getter(e,["visible"]),caption:p.getter(e,["caption"]),tooltip:p.getter(e,["tooltip"]),allowChangeEnable:p.getter(e,["allowChangeEnable"]),icon:p.getter(e,["icon"])&&"caption"!==p.getter(e,["viewMode"])?p.getter(e,["icon"])+" controls-ItemActions__icon":""},{class:"controls-ItemActions__item "+p.utils.escape(p.getter(e,["cssClass"])?p.getter(e,["cssClass"]):"")},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},n,m,r,p.config,g,d)],u,d);d.def&&(o=i.chain(o,d,t),d=void 0)}catch(t){p.templateError("resources/SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemTpl.tmpl",t,e)}return o||""}.bind({includedTemplates:S})),function(e,t){p.prepareAttrsForFocus(t,e,"0");var r=this&&this.includedTemplates?this.includedTemplates:{},i=p.getMarkupGenerator(l);try{var o=i.joinElements([i.createControl("resolver",!p.getter(e,["icon"])||"icon"!==p.getter(e,["viewMode"])&&p.getter(e,["viewMode"])?"SBIS3.CONTROLS/Link":"SBIS3.CONTROLS/Button/IconButton",{visible:p.getter(e,["visible"]),caption:p.getter(e,["caption"]),tooltip:p.getter(e,["tooltip"]),allowChangeEnable:p.getter(e,["allowChangeEnable"]),icon:p.getter(e,["icon"])&&"caption"!==p.getter(e,["viewMode"])?p.getter(e,["icon"])+" controls-ItemActions__icon":""},{class:"controls-ItemActions__item "+p.utils.escape(p.getter(e,["cssClass"])?p.getter(e,["cssClass"]):"")},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},n,m,r,p.config,g,d)],u,d);d.def&&(o=i.chain(o,d,t),d=void 0)}catch(t){p.templateError("resources/SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemTpl.tmpl",t,e)}return o||""}(p.calculateScope({icon:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["icon"]),caption:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["caption"]),visible:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["visible"]),tooltip:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["tooltip"]),cssClass:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["cssClass"]),viewMode:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["toolbarViewMode"]),allowChangeEnable:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["allowChangeEnable"])},p.plainMerge),p.plainMerge(o,{}))],u,d);d.def&&(h=C.chain(h,d,o),d=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemTpl.tmpl",e,i)}return h||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemTpl"}},i});
//# sourceMappingURL=ItemTpl.tmpl.map
define("SBIS3.CONTROLS/Mixins/DSMixin",["Core/core-clone","Core/Deferred","Core/IoC","WS.Data/Source/Memory","WS.Data/Query/Query","WS.Data/Collection/ObservableList","WS.Data/Display/Display","WS.Data/Collection/IBind","SBIS3.CONTROLS/Utils/TemplateUtil","Core/core-instance","Core/helpers/Function/forAliveOnly","Core/helpers/Object/isEmpty","WS.Data/Display/Collection"],function(t,e,i,n,s,o,r,a,l,h,_,d){function u(t){return function(){return this.runInPropertiesUpdate(t,arguments)}}var f={$protected:{_needToRedraw:false,_itemsProjection:null,_items:null,_itemsInstances:{},_offset:0,_limit:void 0,_dataSource:void 0,_dataSet:null,_dotItemTpl:null,_options:{keyField:null,idProperty:null,displayField:null,displayProperty:null,items:null,dataSource:void 0,pageSize:void 0,groupBy:{},userItemAttributes:null,emptyHTML:"",filter:{},sorting:[],templateBinding:{},includedTemplates:{},footerTpl:void 0,autoRedraw:true},_loader:null,addedOnlyExtraNew:true},$constructor:function(){if(this._publish("onDrawItems","onDataLoad","onDataLoadError","onBeforeDataLoad","onItemsReady"),"string"===typeof this._options.pageSize)this._options.pageSize=1*this._options.pageSize;this._bindHandlers(),this._prepareConfig(this._options.dataSource,this._options.items)},_getItemProjectionByItemId:function(t){return this._getItemsProjection()?this._getItemsProjection().getItemBySourceItem(this.getItems().getRecordById(t)):null},_prepareConfig:function(t,e){if(!this._options.idProperty)i.resolve("ILogger").log("ListView","Option idProperty is required");if(t)this._dataSource=this._prepareSource(t),this._items=null;else if(e)if(h.instanceOfModule(e,"WS.Data/Display/Display"))this._itemsProjection=e,this._items=this._convertItems(this._itemsProjection.getCollection()),this._setItemsEventHandlers(),this._notify("onItemsReady"),this._itemsReadyCallback();else if(h.instanceOfModule(e,"WS.Data/Collection/RecordSet")){if(this._dataSource)this._dataSource=new n({data:e.getRawData(),idProperty:this._options.idProperty});this._processingData(e)}else if(e instanceof Array){if(!this._options.idProperty){var s=e[0];if(s)this._options.idProperty=Object.keys(s)[0]}this._dataSource=new n({data:e,idProperty:this._options.idProperty})}else this._items=e,this._dataSource=null,this._createDefaultProjection(this._items),this._itemsReadyCallback(),this._notify("onItemsReady")},before:{_modifyOptions:function(t){if(t.keyField)i.resolve("ILogger").log("DSMixin","Опция keyField является устаревшей, используйте idProperty"),t.idProperty=t.keyField;if(t.displayField)i.resolve("ILogger").log("DSMixin","Опция displayField является устаревшей, используйте displayProperty"),t.displayProperty=t.displayField}},after:{_modifyOptions:function(t){return t.footerTpl=l.prepareTemplate(t.footerTpl),t},destroy:function(){this._unsetItemsEventHandlers(),this._clearItems()}},_createDefaultProjection:function(t){this._itemsProjection=r.getDefaultDisplay(t)},_convertItems:function(t){if(t=t||[],t instanceof Array)t=new o({items:t});if(!h.instanceOfMixin(t,"WS.Data/Collection/IEnumerable"))throw new Error("Items should implement WS.Data/Collection/IEnumerable");return t},_prepareSource:function(t){var e;switch(typeof t){case"function":e=t.call(this);break;case"object":if(h.instanceOfMixin(t,"WS.Data/Source/ISource"))e=t;if("module"in t)e=new(require(t.module))(t.options||{})}return e},_convertDataSourceToItems:function(t){return new o({source:t})},_bindHandlers:function(){this._onCollectionChange=p.bind(this)},_setItemsEventHandlers:function(){this.subscribeTo(this._itemsProjection,"onCollectionChange",this._onCollectionChange)},_unsetItemsEventHandlers:function(){this.unsubscribeFrom(this._itemsProjection,"onCollectionChange",this._onCollectionChange)},setDataSource:function(t,e){if(this._unsetItemsEventHandlers(),this._prepareConfig(t),!e)return this.reload()},getDataSet:function(t){if(!t)i.resolve("ILogger").log("Получение DataSet явялется устаревшим функционалом используйте getItems()");return this._dataSet},reload:u(function(t,i,n,s){if(this._options.pageSize)this._limit=this._options.pageSize;var o,r=this,a="undefined"!==typeof t,l="undefined"!==typeof i,h="undefined"!==typeof n,d="undefined"!==typeof s;if(this._cancelLoading(),a)this.setFilter(t,true);if(l)this.setSorting(i,true);if(this._offset=h?n:this._offset,this._limit=d?s:this._limit,this._dataSource)this._toggleIndicator(true),this._notify("onBeforeDataLoad",this._options.filter,this.getSorting(),this._offset,this._limit),this._container.removeClass("controls-ListView__dataLoaded"),o=this._callQuery(this._options.filter,this.getSorting(),this._offset,this._limit).addCallback(_(function(t){var e=!!this._items;if(r._toggleIndicator(false),r._notify("onDataLoad",t),r._processingData(t),e){if(!r._options.autoRedraw)r.redraw()}else r.redraw();if("up"===r._options.infiniteScroll){var i=r._itemsProjection.at(0);if(i)r._scrollToItem(i.getContents().getId())}return t},r)).addErrback(_(function(t){if(!t.canceled)if(r._toggleIndicator(false),true!==r._notify("onDataLoadError",t))require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(e){e.showMessageDialog({message:t.message.toString().replace("Error: ",""),status:"success"})});return t},r)),this._loader=o;else{if(this._items)this._redraw();(o=new e).callback()}return this._notifyOnPropertyChanged("filter"),this._notifyOnPropertyChanged("sorting"),this._notifyOnPropertyChanged("offset"),this._notifyOnPropertyChanged("limit"),this._loader}),_processingData:function(t){if(!!this._items){if(this._dataSet.setMetaData(t.getMetaData()),this._items.assign(t),this._items!==this._dataSet)this._dataSet.assign(t)}else this._items=t,this._dataSet=t,this._createDefaultProjection(this._items),this._setItemsEventHandlers(),this._notify("onItemsReady"),this._itemsReadyCallback();this._dataLoadedCallback()},_callQuery:function(t,e,i,n){if(!this._dataSource)return;var o=new s;return o.where(t).offset(i).limit(n).orderBy(e),this._dataSource.query(o).addCallback(function(t){if(this._options.idProperty&&this._options.idProperty!==t.getIdProperty())t.setIdProperty(this._options.idProperty);return t.getAll()}.bind(this))},_toggleIndicator:function(){},_toggleEmptyData:function(){},setPageSize:function(t){this._options.pageSize=t,this._dropPageSave(),this.reload(this._options.filter,this.getSorting(),0,t)},getPageSize:function(){return this._options.pageSize},getFilter:function(){return this._options.filter},setFilter:function(t,e){if(this._options.filter=t,this._dropPageSave(),this._dataSource&&!e)this.reload(this._options.filter,this.getSorting(),0,this.getPageSize());else this._notifyOnPropertyChanged("filter")},getSorting:function(){return this._options.sorting},setSorting:function(t,e){if(this._options.sorting=t,this._dropPageSave(),this._dataSource&&!e)this.reload(this._options.filter,this.getSorting(),0,this.getPageSize())},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t},_setPageSave:function(t){},_dropPageSave:function(){},_isLoading:function(){return i.resolve("ILogger").log("ListView","Метод _isLoading() будет удален в 3.7.4 используйте isLoading()"),this.isLoading()},isLoading:function(){return this._loader&&!this._loader.isReady()},_cancelLoading:function(){if(this.isLoading())this._loader.cancel();this._loader=null},getItems:function(){return this._items},_getItemsProjection:function(){return this._itemsProjection},setItems:function(t){if(this._unsetItemsEventHandlers(),this._items=null,this._prepareConfig(void 0,t),t instanceof Array)this.reload();else this.redraw()},_drawItemsCallback:function(){},redraw:function(){this._redraw()},_redraw:function(){var t;if(this._items)this._clearItems(),this._needToRedraw=false,t=this._getRecordsForRedraw(),this._toggleEmptyData(!t.length&&this._options.emptyHTML),this._drawItems(t);this._container.addClass("controls-ListView__dataLoaded").removeClass("controls-ListView__dataNotLoaded")},_destroySearchBreadCrumbs:function(){},_getRecordsForRedraw:function(){var t=[];return this._itemsProjection.each(function(e){t.push(e.getContents())}),t},_drawItems:function(t,e){var i=e,n;if(t&&t.length>0){for(var s=0;s<t.length;s++)if(this._drawAndAppendItem(t[s],i,s===t.length-1),i&&i.at)i.at++}else this._notifyOnDrawItems();this._reviveItems()},_normalizeItems:function(t){if(!h.instanceOfMixin(t,"WS.Data/Collection/IList"))return t;var e=[];return t.each(function(t){e.push(t)}),e},_reviveItems:function(){this.reviveComponents().addCallback(this._notifyOnDrawItems.bind(this)).addErrback(function(t){throw t})},_notifyOnDrawItems:function(){this._notify("onDrawItems"),this._drawItemsCallback()},_clearItems:function(t){if(t=t||this._getItemsContainer(),!d(this._itemsInstances))for(var e in this._itemsInstances)if(this._itemsInstances.hasOwnProperty(e))this._itemsInstances[e].destroy();if(this._itemsInstances={},t.length){var i;if(t.get(0)==this._getItemsContainer().get(0))i=$(".controls-ListView__item, .controls-GroupBy",t.get(0)),this._destroyControls(i),i.remove();else this._destroyControls(t)}},_destroyControls:function(t){$("[data-component]",t).each(function(t,e){var i=e.wsControl;if(i)i.destroy()})},_getTargetContainer:function(t){return this._getItemsContainer()},_getItemsContainer:function(){return this._container},redrawItem:function(t){var e=this._getElementByModel(t),i=this._drawItem(t);e.after(i).remove(),this._reviveItems()},_getElementByModel:function(t){return this._getItemsContainer().find('.js-controls-ListView__item[data-id="'+t.getId()+'"]')},_drawItem:function(t,e,i){var n;if(false!==this._group(t,e,i))n=this._createItemInstance(t,this._getTargetContainer(t),e),this._addItemAttributes(n,t);return n},_drawAndAppendItem:function(t,e,i){var n=this._drawItem(t,e,i);if(n)this._appendItemTemplate(t,this._getTargetContainer(t),n,e)},_group:function(t,e,i){var n=this._options.groupBy,s,o,r=true;if(!d(n))if(s=n.method.apply(this,[t,e,i]),o="boolean"===typeof s?s:s instanceof Object&&s.hasOwnProperty("drawGroup")?!!s.drawGroup:false,r=s instanceof Object&&s.hasOwnProperty("drawItem")?!!s.drawItem:true,o)this._drawGroup(t,e,i);return r},_drawGroup:function(e,i,n){var s=this._options.groupBy,o={columns:t(this._options.columns||[]),multiselect:this._options.multiselect,hierField:this._options.hierField+"@"},r,a;if(r=this._getTargetContainer(e),o.item=e,o.colspan=o.columns.length+this._options.multiselect,a=this._buildTplItem(e,s.template(o)),this._appendItemTemplate(e,r,a,i),s.render&&"function"===typeof s.render)s.render.apply(this,[e,a,n]);a.addClass("controls-GroupBy").removeClass("controls-ListView__item")},setGroupBy:function(t,e){if(this._options.groupBy=t,!d(this._options.groupBy)){if(!this._options.groupBy.hasOwnProperty("method"))this._options.groupBy.method=this._groupByDefaultMethod;if(!this._options.groupBy.hasOwnProperty("template"))this._options.groupBy.template=this._getGroupTpl();if(!this._options.groupBy.hasOwnProperty("render"))this._options.groupBy.render=this._groupByDefaultRender}if(e)this._redraw()},_groupByDefaultMethod:function(){throw new Error("Method _groupByDefaultMethod() must be implemented")},_getGroupTpl:function(){throw new Error("Method _getGroupTpl() must be implemented")},_groupByDefaultRender:function(){throw new Error("Method _groupByDefaultRender() must be implemented")},_getItemTemplate:function(){throw new Error("Method _getItemTemplate() must be implemented")},_addItemAttributes:function(t,e){var i=e.getId();if(null==i)i+="";if(t.attr("data-id",i).addClass("controls-ListView__item"),this._options.userItemAttributes&&this._options.userItemAttributes instanceof Function)this._options.userItemAttributes(t,e)},_createItemInstance:function(t,e,i){return this._buildTplItem(t,this._getItemTemplate(t))},_buildTplItem:function(t,e){var i=l.prepareTemplate(e);if("function"==typeof i)return $(i(this._buildTplArgs(t)));else throw new Error("Ошибка в itemTemplate")},_buildTplArgs:function(t){var e={templateBinding:this._options.templateBinding,item:t};if(this._options.includedTemplates){var i=this._options.includedTemplates;e.included={};for(var n in i)if(i.hasOwnProperty(n))e.included[n]=l.prepareTemplate(i[n])}return e},_appendItemTemplate:function(t,e,i,n){if(n&&"undefined"!==typeof n.at){var s=0!==n.at&&$(".controls-ListView__item",this._getItemsContainer().get(0)).eq(n.at-1);if(s.length)s.after(i);else if(s=$("> .controls-ListView__item",this._getItemsContainer().get(0)).eq(n.at),s.length)s.before(i);else e.append(i)}else e.append(i)},_fillItemInstances:function(){this.addedOnlyExtraNew=true;for(var t=this.getChildControls(),e=0;e<t.length;e++)if(t[e].getContainer().hasClass("controls-ListView__item")){var i=t[e].getContainer().attr("data-id");if(this._itemsInstances[i]=t[e],!t[e]._template)this.addedOnlyExtraNew=false}},getItemsInstances:function(){if(this.addedOnlyExtraNew||d(this._itemsInstances))this._fillItemInstances();return this._itemsInstances},getItemInstance:function(t){return this.getItemsInstances()[t]},_hasNextPage:function(t,e){return e=void 0==e?this._offset:e,e<0?false:"boolean"!==typeof t?t>e+this._options.pageSize:!!t},_scrollToItem:function(t){var e=$('.controls-ListView__item[data-id="'+t+'"]',this._getItemsContainer());if(e.length)e.attr("tabindex",-1).focus()},setEmptyHTML:function(t){this._options.emptyHTML=t},getDataSource:function(){return this._dataSource},_dataLoadedCallback:function(){},_itemsReadyCallback:function(){},_addItem:function(t,e){var i=this._previousGroupBy,n=false;if(!d(this._options.groupBy)){var s=this._options.groupBy.method,o=this._itemsProjection.getPrevious(t),r=this._itemsProjection.getNext(t);if(o)s.call(this,o.getContents());if(s.call(this,t.getContents()),r&&!s.call(this,r.getContents()))n=true}t=t.getContents();var a=this._getTargetContainer(t),l=e>0?this._getItemContainerByIndex(a,e-1):null,h=this._getItemTemplate(t),_=this._buildTplItem(t,h),u;if(this._addItemAttributes(_,t),n)_.insertBefore(this._getItemContainerByIndex(a,e)),u=[_.prev().prev(),_.prev(),_,_.next(),_.next().next()];else if(l&&l.length)s&&s.call(this,o.getContents()),_.insertAfter(l),u=[_.prev().prev(),_.prev(),_,_.next(),_.next().next()];else if(0===e)this._previousGroupBy=void 0,_.prependTo(a),u=[_,_.next(),_.next().next()];else _.appendTo(a),u=[_.prev().prev(),_.prev(),_,_.next()];this._group(t,{at:e}),this._previousGroupBy=i},_isNeedToRedraw:function(){return this._options.autoRedraw&&this._needToRedraw&&!!this._getItemsContainer()},_moveItem:function(t,e){t=t.getContents();var i=this._getTargetContainer(t),n=this._getItemContainer(i,t),s=this._getItemContainerByIndex(i,e);if(n.length&&s.length)n.insertAfter(s)},_removeItem:function(t){t=t.getContents();var e=this._getItemContainer(this._getTargetContainer(t),t);if(!d(this._options.groupBy)){var i=e.prev(),n=e.next();if(i.length&&i.hasClass("controls-GroupBy"))if(!n.length||n.hasClass("controls-GroupBy"))i.remove()}if(e.length)this._clearItems(e),e.remove()},_updateItem:function(t){t=t.getContents();var e=this._getItemContainer(this._getTargetContainer(t),t),i=document.activeElement===e.get(0),n=this._getItemTemplate(t);if(e.length){var s=this._buildTplItem(t,n);if(this._addItemAttributes(s,t),this._clearItems(e),e.replaceWith(s),i)this.getContainer().focus()}},_getItemContainerByIndex:function(t,e){return t.find("> .controls-ListView__item:eq("+e+")")},_getItemContainer:function(t,e){return t.find('>[data-id="'+e.getId()+'"]')}},c=function(t,e,i,n){if(this._isNeedToRedraw())this._updateItem(e),this._reviveItems()},p=function(t,e,i,n,s,o){var r;if(this._isNeedToRedraw())switch(e){case a.ACTION_ADD:case a.ACTION_REMOVE:for(r=0;r<s.length;r++)this._removeItem(s[r]);for(r=0;r<i.length;r++)this._addItem(i[r],n+r);this._toggleEmptyData(!this._itemsProjection.getCount()),this._reviveItems();break;case a.ACTION_CHANGE:i.forEach(function(e,s){c.call(this,t,e,n+s,i.properties)},this);break;case a.ACTION_MOVE:break;case a.ACTION_REPLACE:for(r=0;r<i.length;r++)this._updateItem(i[r]);this._reviveItems();break;case a.ACTION_RESET:this.redraw()}};return f});
//# sourceMappingURL=DSMixin.js.map
define("SBIS3.CONTROLS/Button/ButtonGroup/ButtonGroupBaseDS",["Core/IoC","Lib/Control/CompoundControl/CompoundControl","SBIS3.CONTROLS/Mixins/DSMixin","SBIS3.CONTROLS/Mixins/DataBindMixin"],function(t,i,s,e){"use strict";var n=i.extend([s,e],{$protected:{_options:{displayProperty:""},_hasItems:null},$constructor:function(){if(this._options.displayField)this._options.displayProperty=this._options.displayField,t.resolve("ILogger").log("ButtonGroupBase",'Опция "captionField" устарела. Используйте опцию "displayProperty".');this._hasItems=this._container.hasClass("hasItems")},init:function(){n.superclass.init.call(this),this.reload()},setEnabled:function(t){n.superclass.setEnabled.call(this,t);var i=this.getItemsInstances();for(var s in i)if(i.hasOwnProperty(s))i[s].setEnabled(t)},redraw:function(){if(!this._hasItems)this._redraw();else this._drawItemsCallback();this._hasItems=false},_drawItemsCallback:function(){var t=this.getItemsInstances(),i=this;for(var s in t)if(t.hasOwnProperty(s))t[s].subscribe("onActivated",function(t,s){var e=this.getContainer().data("id");i._itemActivatedHandler(e,s)})},_itemActivatedHandler:function(t,i){},_setVisibility:function(t){this._container.toggleClass("ws-hidden",!t),this._isVisible=t}});return n});
//# sourceMappingURL=ButtonGroupBaseDS.js.map
define("tmpl!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Button/IconButton"],function(){var t=Array.prototype.slice.call(arguments),e=t[0],i={};i["js!SBIS3.CONTROLS/Button/IconButton"]=t[1];var n=function t(n,o,s,c,r){function a(){}var l=0,u=void 0!==e&&e?e:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var m={};r&&r.isSetts&&(m=r.fullContext||{});var h="string"==typeof s?s:"",d=void 0===i?void 0:i,A={id:[],def:void 0},_=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),p=this&&this.includedTemplates?this.includedTemplates:{},I=u.getMarkupGenerator(c);try{var v=I.joinElements([I.createTag("div",{class:"controls-ItemActions"},[I.createTag("div",{class:"controls-ItemActions__itemsContainer"},[I.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{name:"itemActionsMenuButton",allowChangeEnable:!1,visible:!1,command:"showMenu",caption:global.rk("Ещё..."),icon:"icon-size icon-ExpandDown icon-primary action-hover"},{class:"controls-ItemActions__menu-button controls-ItemActions__item ws-hidden",name:"itemActionsMenuButton",sbisname:"itemActionsMenuButton"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},s,d,p,u.config,m),I.createTag("div",{class:"controls-ItemActions__menu-container",style:"display:none;"},[],{},A,this)],{},A,this)],o,A,this)],h,A);A.def&&(v=I.chain(v,A,o),A=void 0)}catch(t){u.templateError("resources/SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup.tmpl",t,n)}return v||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup"}},n}),define("SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup",["Core/CommandDispatcher","SBIS3.CONTROLS/Button/ButtonGroup/ButtonGroupBaseDS","tmpl!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup","tmpl!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemTpl","Core/Deferred","Core/helpers/Object/find","Core/helpers/markup-helpers","Core/helpers/Function/forAliveOnly","Core/moduleStubs","SBIS3.CONTROLS/Button/IconButton","SBIS3.CONTROLS/Link","css!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup","i18n!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup"],function(t,e,i,n,o,s,c,r,a){"use strict";var l={verticalAlign:{side:"top",offset:0},horizontalAlign:{side:"right",offset:0},corner:"tr"},u={verticalAlign:{side:"top",offset:-13},horizontalAlign:{side:"right",offset:4},corner:"tr"},m=e.extend({_dotTplFn:i,$protected:{_itemActionsButtons:{},_itemActionsMenu:void 0,_itemActionsMenuButton:void 0,_activeItem:void 0,_activeCls:"controls-ItemActions__activeItem",_menuAlign:"standart",_options:{touchMode:!1,linkedControl:void 0}},$constructor:function(){this._publish("onShowMenu","onHideMenu","onActionActivated"),t.declareCommand(this,"showMenu",this.showItemActionsMenu),this.once("onInit",function(){this._itemActionsMenuButton=this.getChildControlByName("itemActionsMenuButton")}.bind(this))},applyItemActions:function(){function t(t,e,i){t[e?"show":"hide"](),this._itemActionsButtons[i].disabledHidden=!e}var e,i,n,o=!0,s=this.getItemsInstances();for(var c in s)s.hasOwnProperty(c)&&(n=this._itemActionsButtons[c].isMainAction,i=(e=s[c]).isVisible(),e.isEnabled()?this._itemActionsButtons[c].disabledHidden&&!i&&(t.call(this,e,!0,c),i=!0):i&&(t.call(this,e,!1,c),i=!1),o&&i&&!n&&(o=!1),!n&&i&&e.getContainer().addClass("ws-hidden"));this.isItemActionsMenuVisible()||this._itemActionsMenuButton.setVisible(!o)},setEnabled:function(){m.superclass.setEnabled.apply(this,arguments),this.applyItemActions()},getTarget:function(){return this._activeItem},_createItemActionMenu:function(t){var e,i=this,n={},o={},s="controls-ItemActions__menu",c=this.getParent().getContainer(),r=this.getItems().clone();r.getFormat&&r.getFormat().getFieldIndex("command")>0&&r.removeField("command"),this._options.touchMode?(n=l.verticalAlign,o=l.horizontalAlign,e=this._container,s+=" controls-ItemActions__menu-touchMode"):(n=u.verticalAlign,o=u.horizontalAlign,e=this._itemActionsMenuButton.getContainer()),s+=c.hasClass("controls-ItemsToolbar__small")?" controls-ItemsToolbar__small":"",this.addedOnlyExtraNew=!1,this._itemActionsMenu=new t({element:$("> .controls-ItemActions__menu-container",this._getItemsContainer()[0]).show(),items:r,idProperty:this._options.idProperty,allowChangeEnable:!1,displayProperty:"caption",parentProperty:"parent",parent:this,opener:this,visible:!0,target:e,className:s,corner:"tr",closeButton:!0,closeOnTargetMove:!0,verticalAlign:n,horizontalAlign:o,closeByExternalClick:!0,_canScroll:!0,handlers:{onClose:function(){i._activeItem.container.removeClass("controls-ItemActions__activeItem"),i._notify("onHideMenu")},onMenuItemActivate:function(t,e){i._itemActivatedHandler(e)}}})},showItemActionsMenu:function(t){a.require("SBIS3.CONTROLS/Menu/ContextMenu").addCallback(r(function(e){this.isVisible()&&(this._itemActionsMenu||this._createItemActionMenu(e[0]),this._setContextMenuMode(t),this._onBeforeMenuShowHandler(),this._itemActionsMenu.show(),this._activeItem.container.addClass(this._activeCls),this._itemActionsMenu.recalcPosition(!0),$(".controls-PopupMixin__closeButton",this._itemActionsMenu.getContainer()).addClass("icon-size"))},this))},_onBeforeMenuShowHandler:function(){var t=this._itemActionsMenu.getItemsInstances(),e=this.getItemsInstances();for(var i in t)t.hasOwnProperty(i)&&(t[i].getContainer().toggleClass("ws-hidden",!(e.hasOwnProperty(i)&&e[i].isVisible())),t[i].setCaption(e.hasOwnProperty(i)&&e[i].getCaption()),t[i].setTooltip(e.hasOwnProperty(i)&&e[i].getTooltip()),t[i].setIcon(e.hasOwnProperty(i)&&e[i].getIcon()));this._notify("onShowMenu")},hasVisibleActions:function(){return s(this.getItemsInstances(),function(t){return t.isVisible()&&t.isEnabled()})},ready:function(){var t=new o;return this.isLoading()?this.once("onDrawItems",function(){this.isDestroyed()?t.cancel():t.callback()}.bind(this)):t.callback(),t},show:function(t){var e=this._activeItem&&this._activeItem.container;this._activeItem=t,this._options.touchMode&&(e&&e.removeClass(this._activeCls),t.container.addClass(this._activeCls)),m.superclass.show.call(this)},hide:function(){this._activeItem&&this._activeItem.container&&this._options.touchMode&&this._activeItem.container.removeClass(this._activeCls),this._itemActionsMenu&&this.isItemActionsMenuVisible()&&this._itemActionsMenu.hide(),m.superclass.hide.call(this)},setItems:function(t){this._itemActionsButtons={},this._itemActionsMenu&&this._itemActionsMenu.setItems(t),m.superclass.setItems.apply(this,arguments),this.isVisible()&&this.applyItemActions(),this.isItemActionsMenuVisible()&&this._onBeforeMenuShowHandler()},isItemActionsMenuVisible:function(){return this._itemActionsMenu&&this._itemActionsMenu.isVisible()},_itemActivatedHandler:function(e){var i,n=this._itemActionsButtons[e].command;n?t.sendCommand(this,n,this._activeItem):((i=this._itemActionsButtons[e].handler)&&i.call(this._options.linkedControl,this._activeItem.container,this._activeItem.key,this._activeItem.record,e),this.isDestroyed()||this._notify("onActionActivated",this._activeItem.key))},_getItemsContainer:function(){return $(".controls-ItemActions__itemsContainer",this._container[0])},canAcceptFocus:function(){return!1},setTouchMode:function(t){this._options.touchMode=t,this._itemActionsMenu&&(this._itemActionsMenu.getContainer().toggleClass("controls-ItemActions__menu-touchMode",Boolean(t)),t?this.setMenuAlign(l,this._container):this.setMenuAlign(u,this._itemActionsMenuButton.getContainer()))},_setContextMenuMode:function(t){var e=!!t;this._itemActionsMenu&&(this._itemActionsMenu.getContainer().toggleClass("controls-ItemActions__contextMenu",Boolean(e)),e?(this.setMenuAlign(t,void 0),this._menuAlign="context"):"standart"!=this._menuAlign&&(this.setMenuAlign(u,this._itemActionsMenuButton.getContainer()),this._menuAlign="standart"))},setMenuAlign:function(t,e){this._itemActionsMenu&&(this._itemActionsMenu.setProperty("corner",t.corner),this._itemActionsMenu.setTarget(e),this._itemActionsMenu.setVerticalAlign(t.verticalAlign),this._itemActionsMenu.setHorizontalAlign(t.horizontalAlign))},_getItemTemplate:function(t){var e={isMainAction:t.get("isMainAction"),isContextAction:t.get("isContextAction"),isVisible:!0,command:t.get("command")},i=t.get("onActivated");return"string"==typeof i?i.beginsWith("wsFuncDecl::")&&(e.handler=c.getFuncFromDeclaration(i.replace("wsFuncDecl::",""))):e.handler=i,this._itemActionsButtons[t.get("name")]=e,n},destroy:function(){this._itemActionsButtons={},this._itemActionsMenuButton=void 0,this._itemActionsMenu=void 0,this._activeItem=void 0,m.superclass.destroy.apply(this,arguments)}});return m});
//# sourceMappingURL=ItemActionsGroup.tmpl.map
define("SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup",["Core/CommandDispatcher","SBIS3.CONTROLS/Button/ButtonGroup/ButtonGroupBaseDS","tmpl!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup","tmpl!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemTpl","Core/Deferred","Core/helpers/Object/find","Core/helpers/markup-helpers","Core/helpers/Function/forAliveOnly","Core/moduleStubs","SBIS3.CONTROLS/Button/IconButton","SBIS3.CONTROLS/Link","css!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup","i18n!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup"],function(t,e,i,n,s,o,c,r,a){"use strict";var l={verticalAlign:{side:"top",offset:0},horizontalAlign:{side:"right",offset:0},corner:"tr"},u={verticalAlign:{side:"top",offset:-13},horizontalAlign:{side:"right",offset:4},corner:"tr"},h=e.extend({_dotTplFn:i,$protected:{_itemActionsButtons:{},_itemActionsMenu:void 0,_itemActionsMenuButton:void 0,_activeItem:void 0,_activeCls:"controls-ItemActions__activeItem",_menuAlign:"standart",_options:{touchMode:false,linkedControl:void 0}},$constructor:function(){this._publish("onShowMenu","onHideMenu","onActionActivated"),t.declareCommand(this,"showMenu",this.showItemActionsMenu),this.once("onInit",function(){this._itemActionsMenuButton=this.getChildControlByName("itemActionsMenuButton")}.bind(this))},applyItemActions:function(){var t=true,e=this.getItemsInstances(),i,n,s;function o(t,e,i){t[e?"show":"hide"](),this._itemActionsButtons[i]["disabledHidden"]=!e}for(var c in e)if(e.hasOwnProperty(c)){if(s=this._itemActionsButtons[c]["isMainAction"],i=e[c],n=i.isVisible(),i.isEnabled()){if(this._itemActionsButtons[c]["disabledHidden"]&&!n)o.call(this,i,true,c),n=true}else if(n)o.call(this,i,false,c),n=false;if(t&&n&&!s)t=false;if(!s&&n)i.getContainer().addClass("ws-hidden")}if(this.isItemActionsMenuVisible())return;this._itemActionsMenuButton.setVisible(!t)},setEnabled:function(){h.superclass.setEnabled.apply(this,arguments),this.applyItemActions()},getTarget:function(){return this._activeItem},_createItemActionMenu:function(t){var e=this,i={},n={},s="controls-ItemActions__menu",o=this.getParent().getContainer(),c=this.getItems().clone(),r;if(c.getFormat&&c.getFormat().getFieldIndex("command")>0)c.removeField("command");if(this._options.touchMode)i=l.verticalAlign,n=l.horizontalAlign,r=this._container,s+=" controls-ItemActions__menu-touchMode";else i=u.verticalAlign,n=u.horizontalAlign,r=this._itemActionsMenuButton.getContainer();s+=o.hasClass("controls-ItemsToolbar__small")?" controls-ItemsToolbar__small":"",this.addedOnlyExtraNew=false,this._itemActionsMenu=new t({element:$("> .controls-ItemActions__menu-container",this._getItemsContainer()[0]).show(),items:c,idProperty:this._options.idProperty,allowChangeEnable:false,displayProperty:"caption",parentProperty:"parent",parent:this,opener:this,visible:true,target:r,className:s,corner:"tr",closeButton:true,closeOnTargetMove:true,verticalAlign:i,horizontalAlign:n,closeByExternalClick:true,_canScroll:true,handlers:{onClose:function(){e._activeItem.container.removeClass("controls-ItemActions__activeItem"),e._notify("onHideMenu")},onMenuItemActivate:function(t,i){e._itemActivatedHandler(i)}}})},showItemActionsMenu:function(t){a.require("SBIS3.CONTROLS/Menu/ContextMenu").addCallback(r(function(e){if(!this.isVisible())return;if(!this._itemActionsMenu)this._createItemActionMenu(e[0]);this._setContextMenuMode(t),this._onBeforeMenuShowHandler(),this._itemActionsMenu.show(),this._activeItem.container.addClass(this._activeCls),this._itemActionsMenu.recalcPosition(true),$(".controls-PopupMixin__closeButton",this._itemActionsMenu.getContainer()).addClass("icon-size")},this))},_onBeforeMenuShowHandler:function(){var t=this._itemActionsMenu.getItemsInstances(),e=this.getItemsInstances();for(var i in t)if(t.hasOwnProperty(i))t[i].getContainer().toggleClass("ws-hidden",!(e.hasOwnProperty(i)&&e[i].isVisible())),t[i].setCaption(e.hasOwnProperty(i)&&e[i].getCaption()),t[i].setTooltip(e.hasOwnProperty(i)&&e[i].getTooltip()),t[i].setIcon(e.hasOwnProperty(i)&&e[i].getIcon());this._notify("onShowMenu")},hasVisibleActions:function(){return o(this.getItemsInstances(),function(t){return t.isVisible()&&t.isEnabled()})},ready:function(){var t=new s;if(this.isLoading())this.once("onDrawItems",function(){if(this.isDestroyed())t.cancel();else t.callback()}.bind(this));else t.callback();return t},show:function(t){var e=this._activeItem&&this._activeItem.container;if(this._activeItem=t,this._options.touchMode){if(e)e.removeClass(this._activeCls);t.container.addClass(this._activeCls)}h.superclass.show.call(this)},hide:function(){if(this._activeItem&&this._activeItem.container&&this._options.touchMode)this._activeItem.container.removeClass(this._activeCls);this._itemActionsMenu&&this.isItemActionsMenuVisible()&&this._itemActionsMenu.hide(),h.superclass.hide.call(this)},setItems:function(t){if(this._itemActionsButtons={},this._itemActionsMenu&&this._itemActionsMenu.setItems(t),h.superclass.setItems.apply(this,arguments),this.isVisible())this.applyItemActions();if(this.isItemActionsMenuVisible())this._onBeforeMenuShowHandler()},isItemActionsMenuVisible:function(){return this._itemActionsMenu&&this._itemActionsMenu.isVisible()},_itemActivatedHandler:function(e){var i=this._itemActionsButtons[e]["command"],n;if(i)t.sendCommand(this,i,this._activeItem);else{if(n=this._itemActionsButtons[e]["handler"],n)n.call(this._options.linkedControl,this._activeItem.container,this._activeItem.key,this._activeItem.record,e);if(!this.isDestroyed())this._notify("onActionActivated",this._activeItem.key)}},_getItemsContainer:function(){return $(".controls-ItemActions__itemsContainer",this._container[0])},canAcceptFocus:function(){return false},setTouchMode:function(t){if(this._options.touchMode=t,this._itemActionsMenu)if(this._itemActionsMenu.getContainer().toggleClass("controls-ItemActions__menu-touchMode",Boolean(t)),t)this.setMenuAlign(l,this._container);else this.setMenuAlign(u,this._itemActionsMenuButton.getContainer())},_setContextMenuMode:function(t){var e=!!t;if(this._itemActionsMenu)if(this._itemActionsMenu.getContainer().toggleClass("controls-ItemActions__contextMenu",Boolean(e)),e)this.setMenuAlign(t,void 0),this._menuAlign="context";else if("standart"!=this._menuAlign)this.setMenuAlign(u,this._itemActionsMenuButton.getContainer()),this._menuAlign="standart"},setMenuAlign:function(t,e){if(this._itemActionsMenu)this._itemActionsMenu.setProperty("corner",t.corner),this._itemActionsMenu.setTarget(e),this._itemActionsMenu.setVerticalAlign(t.verticalAlign),this._itemActionsMenu.setHorizontalAlign(t.horizontalAlign)},_getItemTemplate:function(t){var e={isMainAction:t.get("isMainAction"),isContextAction:t.get("isContextAction"),isVisible:true,command:t.get("command")},i=t.get("onActivated");if("string"===typeof i){if(i.beginsWith("wsFuncDecl::"))e.handler=c.getFuncFromDeclaration(i.replace("wsFuncDecl::",""))}else e.handler=i;return this._itemActionsButtons[t.get("name")]=e,n},destroy:function(){this._itemActionsButtons={},this._itemActionsMenuButton=void 0,this._itemActionsMenu=void 0,this._activeItem=void 0,h.superclass.destroy.apply(this,arguments)}});return h});
//# sourceMappingURL=ItemActionsGroup.js.map
define("tmpl!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar",["Core/tmpl/js/tclosure"],function(){var t=Array.prototype.slice.call(arguments),i=t[0],o={},e=function t(e,s,n,r,a){function c(){}var h=0,l=void 0!==i&&i?i:arguments[arguments.length-1];void 0===l&&(eval("var thelpers = null;"),l=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var u="string"==typeof n?n:"",_=void 0===o?void 0:o,m={id:[],def:void 0},g=l.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,e),T=this&&this.includedTemplates?this.includedTemplates:{},p=l.getMarkupGenerator(r);try{var A=p.joinElements([p.createTag("div",{class:"controls-ItemsToolbar ws-hidden"},[p.createTag("div",{class:"controls-ItemsToolbar__container"},[],{},m,this)],s,m,this)],u,m);m.def&&(A=p.chain(A,m,s),m=void 0)}catch(t){l.templateError("resources/SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar.tmpl",t,e)}return A||""};return e.includedFunctions={},e.stable=!0,e.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar"}},e}),define("SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar",["SBIS3.CONTROLS/CompoundControl","SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup","tmpl!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar","tmpl!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/editActions","Core/Deferred","Core/helpers/Hcontrol/trackElement","SBIS3.CONTROLS/Utils/Contains","SBIS3.CONTROLS/Button/IconButton","i18n!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar","css!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar"],function(t,i,o,e,s,n,r){"use strict";var a={"itemsToolbar-rightSwipe":"itemsToolbar-rightSwipeAnimation","itemsToolbar-leftSwipe":"itemsToolbar-leftSwipeAnimation"},c=t.extend({_dotTplFn:o,$protected:{_options:{touchMode:!1,showEditActions:!1,itemsActions:[]},_itemsActions:null,_editActions:null,_target:null,_currentTarget:null,_lockingToolbar:!1,_isVisible:!1,_cachedMargin:null,_toolbarContent:null},$constructor:function(){this._publish("onShowItemActionsMenu","onCloseItemActionsMenu","onItemActionActivated","onItemsToolbarHide")},init:function(){this._toolbarContent=this._getToolbarContent(),this._toolbarContent.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",this._animationEndHandler.bind(this)),c.superclass.init.apply(this,arguments)},_getEditActions:function(){var t;return this._editActions||((t=this._toolbarContent).append(e()),this.reviveComponents(),this._editActions=t.find(".controls-ItemsToolbar__editActions")),this._editActions},showEditActions:function(){this._getEditActions().removeClass("ws-hidden"),this.getContainer().toggleClass("controls-ItemsToolbar__withEditActions",!0),this._toggleEditClass(!0)},hideEditActions:function(){this._editActions&&(this._editActions.addClass("ws-hidden"),this.getContainer().toggleClass("controls-ItemsToolbar__withEditActions",!1),this._toggleEditClass(!1))},_toggleEditClass:function(t){this.getContainer().toggleClass("controls-ItemsToolbar__edit",t)},_isEditActionsHidden:function(){return!this._editActions||this._editActions.hasClass("ws-hidden")},_initItemsActions:function(){var t=this;this._bigIconsFix(this._options.itemsActions),this._itemsActions=new i({items:this._options.itemsActions,element:$('<div class="controls-ListView__itemActions-container"></div>').prependTo(this._toolbarContent),idProperty:"name",parent:this,linkedControl:this.getParent(),touchMode:this._options.touchMode,handlers:{onActionActivated:function(i,o){t._notify("onItemActionActivated",o),t.isToolbarLocking()||t._itemsActions.hide(),t.hide(!1)},onShowMenu:function(){t.getContainer().addClass("ws-invisible"),t.lockToolbar(),t._notify("onShowItemActionsMenu")},onHideMenu:function(){t.getContainer().removeClass("ws-invisible"),t._isEditActionsHidden()&&t.unlockToolbar(),t._target&&!t._options.touchMode?t.show(t._target):t.hide(),t._notify("onCloseItemActionsMenu")}}})},getItemsActions:function(){return this.getItemsActionsGroup()},getItemsActionsGroup:function(){return!this._itemsActions&&this._options.itemsActions.length&&this._initItemsActions(),this._itemsActions},setItemsActions:function(t){this._options.itemsActions=t,this._bigIconsFix(t),this._itemsActions&&this._itemsActions.setItems(this._options.itemsActions)},showItemsActions:function(t){var i=this.getItemsActionsGroup();i.applyItemActions(),i.show(t)},hideItemsActions:function(){this._itemsActions&&this._itemsActions.hide()},_bigIconsFix:function(t){t&&t.forEach(function(t){t.hasOwnProperty("icon")&&t.icon&&(t.icon=t.icon.replace("icon-16","icon-size").replace("icon-24","icon-size").replace("icon-small","icon-size").replace("icon-medium","icon-size"))})},_isItemsActionsHidden:function(){return!this._options.itemsActions.length||this._itemsActions&&!this._itemsActions.hasVisibleActions()},lockToolbar:function(){this._lockingToolbar=!0,this._trackingTarget()},unlockToolbar:function(){this._lockingToolbar=!1,this._untrackingTarget()},isToolbarLocking:function(){return this._lockingToolbar},getCurrentTarget:function(){return this._currentTarget},setCurrentTarget:function(t){this._currentTarget=t},_trackingTarget:function(){n(this._currentTarget.container,!0).subscribe("onMove",this.recalculatePosition,this)},setTouchMode:function(t){this._options.touchMode=t,t?this.setHeightInTouchMode():this.getContainer()[0].style.height="",this._itemsActions&&this._itemsActions.setTouchMode(t)},getTouchMode:function(){return this._options.touchMode},setHeightInTouchMode:function(){var t,i,o;this._currentTarget&&(t=this._currentTarget.size.height,(i=this.getContainer()[0]).style.height=t+"px",i.className=i.className.replace(/(^|\s)controls-ItemsToolbar-item-size__\S+/g,""),t<40&&(o="1"),t>=40&&t<50&&(o="2"),t>=50&&t<60&&(o="3"),t>=60&&t<70&&(o="4"),t>=70&&(o="5"),this.getContainer().addClass("controls-ItemsToolbar-item-size__"+o))},_untrackingTarget:function(){this._currentTarget&&n(this._currentTarget.container,!1)},recalculatePosition:function(){var t,i,o=this.getParent().getContainer()[0],e=this._currentTarget.container[0];r(o,e)?this._options.itemsActionsInItemContainer&&!this._options.touchMode?this._setToolbarTarget(this._currentTarget.container):(i=o.getBoundingClientRect(),t=e.getBoundingClientRect(),this._currentTarget.position={top:Math.floor(t.top-i.top+o.scrollTop),left:t.left-i.left},this._currentTarget.size={height:e.offsetHeight,width:e.offsetWidth},this._setPosition(this._getPosition(this._currentTarget))):this._untrackingTarget()},_setToolbarTarget:function(t){var i;i="TR"===t[0].nodeName?t.children().last():t,this.getContainer().appendTo(i)},_setPosition:function(t){var i=this.getContainer()[0];for(var o in t)t.hasOwnProperty(o)&&(i.style[o]=t[o]+("number"==typeof t[o]?"px":""))},_getPosition:function(t){var i,o=t.position,e=t.size,s=this.getParent().getContainer(),n=t.container.hasClass("js-controls-CompositeView__verticalItemActions"),r=s[0].offsetWidth-(o.left+e.width),a=s[0].offsetHeight-(o.top+e.height),c=this.getContainer();return r<0&&!n&&(r=0),(this._cachedMargin||s.hasClass("controls-ListView__bottomStyle"))&&(this._cachedMargin||(i=c.height())&&(this._cachedMargin=i+parseInt(c.css("bottom"),10)),a-=this._cachedMargin),this.getContainer()[n?"addClass":"removeClass"]("controls-ItemsToolbar__vertical"),{marginRight:r,marginTop:o.top,marginBottom:a}},show:function(t,i){var o=function(){var o=this._isItemsActionsHidden()&&this._isEditActionsHidden(),s=this._options.itemsActions.length;e.callback(),this._target=t,this._lockingToolbar||o?o?this.hide():s&&this.getItemsActions().isItemActionsMenuVisible()&&this.getItemsActions().applyItemActions():(this._currentTarget=t,this._lockingToolbar&&this._trackingTarget(),s&&this.showItemsActions(t),this.getContainer().removeClass("ws-hidden"),this._options.itemsActionsInItemContainer&&!this._options.touchMode?this._setToolbarTarget(t.container):this._setPosition(this._getPosition(t)),this._isVisible=!0,this._options.touchMode&&(this._trackingTarget(),i&&(this._toolbarContent.addClass("itemsToolbar-leftSwipeAnimation"),this.setHeightInTouchMode())))}.bind(this),e=new s;return this._itemsActions?this._itemsActions.ready().addCallback(o):o(),e},_animationEndHandler:function(t){this._toolbarContent.removeClass(a[t.originalEvent.animationName]),t.originalEvent&&"itemsToolbar-rightSwipe"===t.originalEvent.animationName&&(this.getContainer().addClass("ws-hidden"),this.hideItemsActions(),this._notify("onItemsToolbarHide"))},_getToolbarContent:function(){return $(".controls-ItemsToolbar__container",this._container[0])},hide:function(t){var i;this._target=null,!this._lockingToolbar&&this._isVisible&&(this._isVisible=!1,i=this.getContainer(),(this._options.touchMode||t)&&this._untrackingTarget(),this._options.touchMode&&t?(this._itemsActions&&this._itemsActions.applyItemActions(),this._getToolbarContent().addClass("itemsToolbar-rightSwipeAnimation")):(i.addClass("ws-hidden"),this.hideItemsActions(),this._notify("onItemsToolbarHide")),this._currentTarget=null)},_onClickHandler:function(t){t.stopPropagation(),t.stopImmediatePropagation()},canAcceptFocus:function(){return!1},destroy:function(){this.unlockToolbar(),this.hide(),this._itemsActions=void 0,this._editActions=void 0,this._toolbarContent.off("*"),this._toolbarContent=void 0,c.superclass.destroy.apply(this,arguments)}});return c});
//# sourceMappingURL=ItemsToolbar.tmpl.map
define("SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar",["SBIS3.CONTROLS/CompoundControl","SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup","tmpl!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar","tmpl!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/editActions","Core/Deferred","Core/helpers/Hcontrol/trackElement","SBIS3.CONTROLS/Utils/Contains","SBIS3.CONTROLS/Button/IconButton","i18n!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar","css!SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar"],function(t,i,o,s,e,n,r){"use strict";var a={"itemsToolbar-rightSwipe":"itemsToolbar-rightSwipeAnimation","itemsToolbar-leftSwipe":"itemsToolbar-leftSwipeAnimation"},c=t.extend({_dotTplFn:o,$protected:{_options:{touchMode:false,showEditActions:false,itemsActions:[]},_itemsActions:null,_editActions:null,_target:null,_currentTarget:null,_lockingToolbar:false,_isVisible:false,_cachedMargin:null,_toolbarContent:null},$constructor:function(){this._publish("onShowItemActionsMenu","onCloseItemActionsMenu","onItemActionActivated","onItemsToolbarHide")},init:function(){this._toolbarContent=this._getToolbarContent(),this._toolbarContent.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",this._animationEndHandler.bind(this)),c.superclass.init.apply(this,arguments)},_getEditActions:function(){var t;if(!this._editActions)(t=this._toolbarContent).append(s()),this.reviveComponents(),this._editActions=t.find(".controls-ItemsToolbar__editActions");return this._editActions},showEditActions:function(){this._getEditActions().removeClass("ws-hidden"),this.getContainer().toggleClass("controls-ItemsToolbar__withEditActions",true),this._toggleEditClass(true)},hideEditActions:function(){if(this._editActions)this._editActions.addClass("ws-hidden"),this.getContainer().toggleClass("controls-ItemsToolbar__withEditActions",false),this._toggleEditClass(false)},_toggleEditClass:function(t){this.getContainer().toggleClass("controls-ItemsToolbar__edit",t)},_isEditActionsHidden:function(){return!this._editActions||this._editActions.hasClass("ws-hidden")},_initItemsActions:function(){var t=this;this._bigIconsFix(this._options.itemsActions),this._itemsActions=new i({items:this._options.itemsActions,element:$('<div class="controls-ListView__itemActions-container"></div>').prependTo(this._toolbarContent),idProperty:"name",parent:this,linkedControl:this.getParent(),touchMode:this._options.touchMode,handlers:{onActionActivated:function(i,o){if(t._notify("onItemActionActivated",o),!t.isToolbarLocking())t._itemsActions.hide();t.hide(false)},onShowMenu:function(){t.getContainer().addClass("ws-invisible"),t.lockToolbar(),t._notify("onShowItemActionsMenu")},onHideMenu:function(){if(t.getContainer().removeClass("ws-invisible"),t._isEditActionsHidden())t.unlockToolbar();if(t._target&&!t._options.touchMode)t.show(t._target);else t.hide();t._notify("onCloseItemActionsMenu")}}})},getItemsActions:function(){return this.getItemsActionsGroup()},getItemsActionsGroup:function(){if(!this._itemsActions&&this._options.itemsActions.length)this._initItemsActions();return this._itemsActions},setItemsActions:function(t){if(this._options.itemsActions=t,this._bigIconsFix(t),this._itemsActions)this._itemsActions.setItems(this._options.itemsActions)},showItemsActions:function(t){var i=this.getItemsActionsGroup();i.applyItemActions(),i.show(t)},hideItemsActions:function(){if(this._itemsActions)this._itemsActions.hide()},_bigIconsFix:function(t){if(t)t.forEach(function(t){if(t.hasOwnProperty("icon")&&t.icon)t.icon=t.icon.replace("icon-16","icon-size").replace("icon-24","icon-size").replace("icon-small","icon-size").replace("icon-medium","icon-size")})},_isItemsActionsHidden:function(){return!this._options.itemsActions.length||this._itemsActions&&!this._itemsActions.hasVisibleActions()},lockToolbar:function(){this._lockingToolbar=true,this._trackingTarget()},unlockToolbar:function(){this._lockingToolbar=false,this._untrackingTarget()},isToolbarLocking:function(){return this._lockingToolbar},getCurrentTarget:function(){return this._currentTarget},setCurrentTarget:function(t){this._currentTarget=t},_trackingTarget:function(){n(this._currentTarget.container,true).subscribe("onMove",this.recalculatePosition,this)},setTouchMode:function(t){if(this._options.touchMode=t,!t)this.getContainer()[0].style.height="";else this.setHeightInTouchMode();if(this._itemsActions)this._itemsActions.setTouchMode(t)},getTouchMode:function(){return this._options.touchMode},setHeightInTouchMode:function(){var t,i,o;if(this._currentTarget){if(t=this._currentTarget.size.height,i=this.getContainer()[0],i.style.height=t+"px",i.className=i.className.replace(/(^|\s)controls-ItemsToolbar-item-size__\S+/g,""),t<40)o="1";if(t>=40&&t<50)o="2";if(t>=50&&t<60)o="3";if(t>=60&&t<70)o="4";if(t>=70)o="5";this.getContainer().addClass("controls-ItemsToolbar-item-size__"+o)}},_untrackingTarget:function(){if(this._currentTarget)n(this._currentTarget.container,false)},recalculatePosition:function(){var t=this.getParent().getContainer()[0],i=this._currentTarget.container[0],o,s;if(!r(t,i))return void this._untrackingTarget();if(this._options.itemsActionsInItemContainer&&!this._options.touchMode)this._setToolbarTarget(this._currentTarget.container);else s=t.getBoundingClientRect(),o=i.getBoundingClientRect(),this._currentTarget.position={top:Math.floor(o.top-s.top+t.scrollTop),left:o.left-s.left},this._currentTarget.size={height:i.offsetHeight,width:i.offsetWidth},this._setPosition(this._getPosition(this._currentTarget))},_setToolbarTarget:function(t){var i;if("TR"===t[0].nodeName)i=t.children().last();else i=t;this.getContainer().appendTo(i)},_setPosition:function(t){var i=this.getContainer()[0];for(var o in t)if(t.hasOwnProperty(o))i.style[o]=t[o]+("number"===typeof t[o]?"px":"")},_getPosition:function(t){var i=t.position,o=t.size,s=this.getParent().getContainer(),e=t.container.hasClass("js-controls-CompositeView__verticalItemActions"),n=s[0].offsetWidth-(i.left+o.width),r=s[0].offsetHeight-(i.top+o.height),a=this.getContainer(),c;if(n<0&&!e)n=0;if(this._cachedMargin||s.hasClass("controls-ListView__bottomStyle")){if(!this._cachedMargin)if(c=a.height(),c)this._cachedMargin=c+parseInt(a.css("bottom"),10);r-=this._cachedMargin}return this.getContainer()[e?"addClass":"removeClass"]("controls-ItemsToolbar__vertical"),{marginRight:n,marginTop:i.top,marginBottom:r}},show:function(t,i){var o=function(){var o=this._isItemsActionsHidden()&&this._isEditActionsHidden(),e=this._options.itemsActions.length,n;if(s.callback(),this._target=t,this._lockingToolbar||o){if(o)this.hide();else if(e)if(n=this.getItemsActions(),n.isItemActionsMenuVisible())this.getItemsActions().applyItemActions();return}if(this._currentTarget=t,this._lockingToolbar)this._trackingTarget();if(e)this.showItemsActions(t);if(this.getContainer().removeClass("ws-hidden"),this._options.itemsActionsInItemContainer&&!this._options.touchMode)this._setToolbarTarget(t.container);else this._setPosition(this._getPosition(t));if(this._isVisible=true,this._options.touchMode)if(this._trackingTarget(),i)this._toolbarContent.addClass("itemsToolbar-leftSwipeAnimation"),this.setHeightInTouchMode()}.bind(this),s=new e;if(this._itemsActions)this._itemsActions.ready().addCallback(o);else o();return s},_animationEndHandler:function(t){if(this._toolbarContent.removeClass(a[t.originalEvent.animationName]),t.originalEvent&&"itemsToolbar-rightSwipe"===t.originalEvent.animationName)this.getContainer().addClass("ws-hidden"),this.hideItemsActions(),this._notify("onItemsToolbarHide")},_getToolbarContent:function(){return $(".controls-ItemsToolbar__container",this._container[0])},hide:function(t){var i;if(this._target=null,!this._lockingToolbar&&this._isVisible){if(this._isVisible=false,i=this.getContainer(),this._options.touchMode||t)this._untrackingTarget();if(this._options.touchMode&&t)this._itemsActions&&this._itemsActions.applyItemActions(),this._getToolbarContent().addClass("itemsToolbar-rightSwipeAnimation");else i.addClass("ws-hidden"),this.hideItemsActions(),this._notify("onItemsToolbarHide");this._currentTarget=null}},_onClickHandler:function(t){t.stopPropagation(),t.stopImmediatePropagation()},canAcceptFocus:function(){return false},destroy:function(){this.unlockToolbar(),this.hide(),this._itemsActions=void 0,this._editActions=void 0,this._toolbarContent.off("*"),this._toolbarContent=void 0,c.superclass.destroy.apply(this,arguments)}});return c});
//# sourceMappingURL=ItemsToolbar.js.map
define("SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Entity",["Core/Abstract"],function(n){"use strict";return n.extend({$protected:{_options:{owner:null}},getOwner:function(){return this._options.owner}})});
//# sourceMappingURL=Entity.js.map
define("SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Row",["SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Entity","WS.Data/Di"],function(t,o){"use strict";var i=t.extend({_moduleName:"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Row",$protected:{_options:{model:void 0,projectionItem:void 0,position:void 0,domElement:void 0}},getModel:function(){return this._options.model},setModel:function(t){this._options.model=t},getPosition:function(){return this._options.position},setPosition:function(t){this._options.position=t},getDomElement:function(){return this._options.domElement},setDomElement:function(t){this._options.domElement=t},setProjectioItem:function(t){this._options.projectionItem=t},getProjectionItem:function(){return this._options.projectionItem}});return o.register("dragentity.row",i),i});
//# sourceMappingURL=Row.js.map
define("SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/List",["WS.Data/Di","WS.Data/Collection/List"],function(t,i){"use strict";var n=i.extend({_moduleName:"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/List",_$action:void 0,_$operation:"move",getOperation:function(){return this._$operation},setOperation:function(t){this._$operation=t},getAction:function(){return this._$action},setAction:function(t){this._$action=t}});return t.register("dragentity.list",n),n});
//# sourceMappingURL=List.js.map
define("SBIS3.CONTROLS/ListView/resources/DragMove/DragMove",["Core/Abstract","SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragObject","WS.Data/Di","Core/core-instance","SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Row","SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/List","css!SBIS3.CONTROLS/ListView/resources/DragMove/DragMove"],function(e,t,r,o){var i={on:"on",after:"after",before:"before"},s=e.extend({$protected:{_options:{projection:null,view:null,dragEntity:"dragentity.row",dragEntityList:"dragentity.list",mover:null,useDragPlaceHolder:false,linkTemplateConfig:null,itemsDragNDrop:true,nodeProperty:null},_dragPlaceHolder:null,_dragPositioner:null},getItemsDragNDrop:function(){return this._options.itemsDragNDrop},setItemsDragNDrop:function(e){this._options.itemsDragNDrop=e},beginDrag:function(){var e=this._findItemByElement(t.getTargetsDomElemet());if(e.length){var r=this._getView().getSelectedItems(),o=this._getItemsProjection().getByHash(e.data("hash")).getContents(),i=[];if(this._getDragItems(o,r).forEach(function(e){var t=this._getItemsProjection().getItemBySourceItem(e);i.push(this._makeDragEntity({owner:this._getView(),model:e,domElement:t?$('.js-controls-ListView__item[data-hash="'+t.getHash()+'"]:not(.controls-editInPlace)',this.getContainer()):void 0,projectionItem:t}))}.bind(this)),t.setSource(this._makeDragEntityList({items:i})),this._addClassDragndrop(e),this._options.useDragPlaceHolder)this._makeDragPlaceHolder(),this._toggleDragItems(false);return true}return false},drag:function(){if(this._clearDragHighlight(),this._canDragMove()){var e=t.getTarget(),r=e.getModel(),o=t.getSource(),i=[];if(r){if(o.each(function(e){i.push(e.getModel())}),t.getOwner()!==this._getView())this._addClassDragndrop(e.getDomElement());if(this._drawDragHighlight(e),this._options.useDragPlaceHolder){var s=this._getDragPlaceHolder(t);if(s.show(),"before"==e.getPosition())s.insertBefore(e.getDomElement());else s.insertAfter(e.getDomElement())}else if(t.getOwner()!==this._getView()||i.indexOf(r)<0)this._drawDragHighlight(e)}}if(t.getTargetsControl()!==this._getView()&&this._dragPlaceHolder)this._dragPlaceHolder.hide();else if(this._dragPlaceHolder)this._dragPlaceHolder.show()},updateTarget:function(){var e=this._getDragTarget(),r=t.getTarget(),o;if(this._isCorrectSource(t.getSource())&&e.item&&!e.isPlaceholder){var i,s=[],n=[],a=e.item.getContents();if(t.getSource().each(function(e){s.push(e.getModel().getId()),n.push(e.getModel())}),i=this._getDirectionOrderChange(e),this._options.useDragPlaceHolder||this._getMover().checkRecordsForMove(n,a,i))o=this._makeDragEntity({owner:this._getView(),domElement:e.domElement,model:a,position:i,projectionItem:this._getItemsProjection().getItemBySourceItem(a)}),t.setTarget(o);else t.setTarget(void 0)}else if(r&&r.getOwner&&r.getOwner()==this._getView()&&!e.isPlaceholder)t.setTarget(void 0)},endDrag:function(){var e=t.getTarget(),r=[],i=false,s=t.getSource(),n=false;if(e&&this._isCorrectSource(s)){var a=e.getModel();if(s.each(function(e){var t=e.getModel();if(r.push(t),a==t)i=true}),t.getOwner()===this._getView()){var g=e.getPosition(),l=[];if(t.getSource().each(function(e){l.push(e.getDomElement())}),n=this._getMover().checkRecordsForMove(r,e.getModel(),g),n)this._getView().move(r,e.getModel(),g).addCallback(function(e){if(false!==e)this._getView().removeItemsSelectionAll();if(this._options.useDragPlaceHolder&&n)this._getView().once("onDrawItems",function(){this._clearDragHighlight(),l.forEach(function(e){e.removeClass("ws-hidden")}),this._removeDragPlaceHolder()}.bind(this));else this._removeDragPlaceHolder()}.bind(this)).addErrback(function(){this._removeDragPlaceHolder()}.bind(this))}else{var c=this._getView().getDataSource(),h=t.getOwner(),d=h.getDataSource?h.getDataSource():void 0,_=false;if(c&&h&&d&&c.getEndpoint().contract==d.getEndpoint().contract)_=true;this._getMover().moveFromOutside(t.getSource(),t.getTarget(),h.getItems(),_).addCallback(function(e){if(false!==e&&o.instanceOfMixin(h,"SBIS3.CONTROLS/Mixins/MultiSelectable"))h.removeItemsSelectionAll()})}}if(!n)this._toggleDragItems(t,true),this._removeDragPlaceHolder();this._dragPositioner=null,this._clearDragHighlight()},createAvatar:function(){if(!this._options.linkTemplateConfig){var e=t.getSource().getCount();return $('<div class="controls-DragNDrop__draggedItem"><span class="controls-DragNDrop__draggedCount">'+e+"</span></div>")}else{var r=t.getSource().at(0).getModel();return $('<div class="controls-dragNDrop-avatar">'+'<div class="controls-dragNDrop-avatar__img-wrapper">'+'<img class="controls-dragNDrop-avatar__img" src="'+r.get(this._options.linkTemplateConfig.image)+'">'+"</div>"+'<div class="controls-dragNDrop-avatar__text-wrapper">'+'<div class="controls-dragNDrop-avatar__title">'+(r.get(this._options.linkTemplateConfig.title)||"")+"</div>"+'<div class="controls-dragNDrop-avatar__description">'+(r.get(this._options.linkTemplateConfig.description)||"")+"</div>"+"</div>"+"</div>")}},getContainer:function(){return this._getView().getContainer()},_getDragItems:function(e,t){if(t){var r=[];if(t.getIndex(e)<0)r.push(e);return t.each(function(e){r.push(e)}),r}return[e]},_checkHorisontalDragndrop:function(e){if("inline-block"==e.css("display")||"none"!=e.css("float"))return true;var t=e.parent();if("flex"==t.css("display")&&"row"==t.css("flex-direction"))return true;return false},_isCorrectSource:function(e){return e&&o.instanceOfModule(e,"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/List")},_canDragMove:function(){var e=t.getSource();return t.getTarget()&&this._isCorrectSource(e)&&e.getCount()>0&&t.getTargetsControl()===this._getView()&&o.instanceOfModule(e.at(0),"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Row")&&this._isEqualDataSource()},_getDragTarget:function(){var e,r=this._getItemsProjection(),o=this._findItemByElement(t.getTargetsDomElemet()),i=false;if(this._options.useDragPlaceHolder){if(o.length>0)e=r.getByHash(o.data("hash")),i=o.hasClass("controls-DragNDrop__placeholder")}else if(o.length>0)e=r.getByHash(o.data("hash"));else if(this._horisontalDragNDrop){var s=t.getEvent(),n=document.elementsFromPoint(s.pageX+5,s.pageY+5);if(o=this._findItemByElement($(n[1])),o.length>0)e=r.getByHash(o.data("hash"))}return{item:e,domElement:o,isPlaceholder:i}},_isEqualDataSource:function(){if(this._getView()!==t.getOwner()){var e=this._getView().getDataSource(),r=t.getOwner(),o="function"==typeof r.getDataSource?r.getDataSource():void 0;if(o&&e&&o.getEndpoint().contract===e.getEndpoint().contract)return true;return false}else return true},_clearDragHighlight:function(){this.getContainer().find(".controls-DragNDrop__insertBefore, .controls-DragNDrop__insertAfter").removeClass("controls-DragNDrop__insertBefore controls-DragNDrop__insertAfter")},_drawDragHighlight:function(e){if(!this._options.useDragPlaceHolder){var t=e.getDomElement();t.toggleClass("controls-DragNDrop__insertAfter",e.getPosition()===i.after),t.toggleClass("controls-DragNDrop__insertBefore",e.getPosition()===i.before)}},_getDirectionOrderChange:function(e){var r,o,i=e.domElement,s=t.getEvent();return this._getDragPositioner().get(e.domElement,e.item)},_getDragPositioner:function(){if(!this._dragPositioner)this._dragPositioner=new n({itemsDragNDrop:this._options.itemsDragNDrop,projection:this._getItemsProjection(),mover:this._getMover(),horisontalDragNDrop:this._horisontalDragNDrop,useDragPlaceHolder:this._options.useDragPlaceHolder,nodeProperty:this._options.nodeProperty});return this._dragPositioner},_getDragPlaceHolder:function(){if(!this._dragPlaceHolder)this._makeDragPlaceHolder();return this._dragPlaceHolder},_makeDragPlaceHolder:function(){if(this._options.useDragPlaceHolder){var e=t.getSource().at(0);this._dragPlaceHolder=e.getDomElement().clone().removeAttr("data-hash").removeAttr("data-id").addClass("controls-DragNDrop__placeholder"),e.getDomElement().after(this._dragPlaceHolder)}},_toggleDragItems:function(e){var r=t.getSource();if(this._isCorrectSource(r))r.each(function(t){if(t.getDomElement())t.getDomElement().toggleClass("ws-hidden",!e)})},_removeDragPlaceHolder:function(){if(this._dragPlaceHolder)this._dragPlaceHolder.remove(),this._dragPlaceHolder=null},_findItemByElement:function(e){if(!e.length)return[];var t,r=this._getItemsProjection();if(e.hasClass(".js-controls-ListView__item"))t=e;else t=e.closest(".js-controls-ListView__item",this.getContainer()[0]);if(t.data("hash")&&r&&!r.getByHash(t.data("hash")))return this._findItemByElement(t.parent());return t},_getItemsProjection:function(){return this._options.projection},setItemsProjection:function(e){this._options.projection=e},_getView:function(){return this._options.view},_makeDragEntity:function(e){return r.resolve(this._options.dragEntity,e)},_makeDragEntityList:function(e){return r.resolve(this._options.dragEntityList,e)},_getMover:function(){return this._options.mover},_addClassDragndrop:function(e){if(this._checkHorisontalDragndrop(e))this._horisontalDragNDrop=true,this.getContainer().addClass("controls-ListView__horisontalDragNDrop"),this.getContainer().removeClass("controls-ListView__verticalDragNDrop");else this._horisontalDragNDrop=false,this.getContainer().removeClass("controls-ListView__horisontalDragNDrop"),this.getContainer().addClass("controls-ListView__verticalDragNDrop")}}),n=function(e){if(this._projection=e.projection,this._sourceExistNode=false,this._sourseItems=[],this._mover=e.mover,this._itemsDragNDrop=e.itemsDragNDrop,this._useDragPlaceHolder=e.useDragPlaceHolder,this._horisontalDragNDrop=e.horisontalDragNDrop,this._nodeProperty=e.nodeProperty,this._isTree=o.instanceOfModule(this._projection,"WS.Data/Display/Tree"),this._isTree){var r=t.getSource();if(r&&o.instanceOfModule(r,"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/List")&&this._nodeProperty)r.forEach(function(e){if(o.instanceOfModule(e,"SBIS3.CONTROLS/Mixins/DragAndDropMixin/DragEntity/Row")){if(null!==(e=e.getModel()).get(this._nodeProperty))this._sourceExistNode=true;this._sourseItems.push(e)}}.bind(this))}};return n.prototype.get=function(e,r){var o,i,s=t.getEvent();if(this._horisontalDragNDrop)o=s.pageX-(e.offset()?e.offset().left:0),i=e.width();else o=s.pageY-(e.offset()?e.offset().top:0),i=e.height();switch(this._itemsDragNDrop){case"onlyChangeOrder":return this._onlyChangeOrder(o,i);case"onlyChangeParent":return this._onlyChangeParent();case"separateParent":return this._separateParent(o,i,r);case"allow":default:if(this._isTree)return this._allow(o,i,r);else if(this._useDragPlaceHolder)return this._withDragPlaceHolder(o,i,e,s);else return this._onlyChangeOrder(o,i)}},n.prototype._onlyChangeOrder=function(e,t){return t/2-e>0?i.before:i.after},n.prototype._onlyChangeParent=function(){return i.on},n.prototype._separateParent=function(e,t,r){if(r.isNode()&&!this._sourceExistNode)return i.on;else if(!r.isNode()&&this._sourceExistNode)return i.on;return this._allow(e,t,r)},n.prototype._default=function(e,t){return e<10?i.before:e>t-10?i.after:i.on},n.prototype._allow=function(e,t,r){var o=this._default(e,t);if(r&&o==i.on&&!this._mover.checkRecordsForMove(this._sourseItems,r.getContents(),o))o=this._onlyChangeOrder(e,t);return o},n.prototype._withDragPlaceHolder=function(e,t,r,o){var s;if(this._horisontalDragNDrop){var n=o.pageY-(r.offset()?r.offset().top:0),a=r.height();s=this._default(n,a)}if(!s||s==i.on)s=this._onlyChangeOrder(e,t);return s==i.before?i.after:i.before},s});
//# sourceMappingURL=DragMove.js.map
define("SBIS3.CONTROLS/ListView/resources/CommonHandlers",function(){return{editItems:function(e,n){this.sendCommand("activateItem",n)}}});
//# sourceMappingURL=CommonHandlers.js.map
define("SBIS3.CONTROLS/Controllers/IListNavigation",[],function(){return{$protected:{_options:{type:"pages",config:{}}},$constructor:function(){},prepareQueryParams:function(n,e){},analyzeResponseParams:function(n){}}});
//# sourceMappingURL=IListNavigation.js.map
define("SBIS3.CONTROLS/Controllers/CursorListNavigation",["Core/Abstract","SBIS3.CONTROLS/Controllers/IListNavigation"],function(i,t){return i.extend([t],{$protected:{_hasMore:{before:false,after:false},_options:{type:"cursor",config:{field:"",position:"",direction:""}}},$constructor:function(){if(!(this._options.config.field instanceof Array))this._options.config.field=[this._options.config.field];if(!(this._options.config.position instanceof Array))this._options.config.position=[this._options.config.position]},_getCalculatedParams:function(){var i="",t={};switch(this._options.config.direction){case"after":i=">=";break;case"before":i="<=";break;case"both":i="~"}for(var o=0;o<this._options.config.field.length;o++)t[this._options.config.field[o]+i]=this._options.config.position[o];return{filter:t}},prepareQueryParams:function(i,t){var o,e,n=this._options.config.position,s=this._options.config.direction;if(t)if("up"==t)this.setDirection("before");else this.setDirection("after");if(i&&i.getCount()&&t){if("up"==t)o=i.getFirst().getContents();else o=i.getLast().getContents();for(var r=[],f=0;f<this._options.config.field.length;f++)e=o.get(this._options.config.field[f]),r.push(e);this.setPosition(r)}var a=this._getCalculatedParams();return this.setDirection(s),this.setPosition(n),a},analyzeResponseParams:function(i,t){var o=i.getMetaData().more;if("boolean"==typeof o){var e=this._options.config.direction;if("up"==t)e="before";else if("down"==t)e="after";this._hasMore[e]=o}else if(o instanceof Object)this._hasMore=o},setPosition:function(i){if(!(i instanceof Array))i=[i];this._options.config.position=i},setDirection:function(i){this._options.config.direction=i},hasNextPage:function(i){var t;if("up"==i)t="before";else if("down"==i)t="after";return this._hasMore[t]}})});
//# sourceMappingURL=CursorListNavigation.js.map
define("Core/SessionStorage",["Core/UserInfo"],function(e){var t,n,i={getItem:function(){},setItem:function(){},removeItem:function(){}};try{n="undefined"!==typeof window&&sessionStorage||i}catch(e){n=i}var o="wsss",r=n.getItem(o);if(r)try{r=JSON.parse(r)||{}}catch(e){r={}}else r={};if(!e.isValid(r.user))f(),r.user=r.sid=e.getCurrent();function f(){n.removeItem(o),r={}}function c(e){if(e)s(o,JSON.stringify(r));else if(!t)t=setTimeout(function(){s(o,JSON.stringify(r)),t=null},100)}function s(e,t){try{n.setItem(e,t)}catch(e){}}return{get:function(e){return r[e]},set:function(e,t,n){if(!e)return;if(null==t&&"object"==typeof e&&"[object Object]"==Object.prototype.toString.call(e)){for(var i in e)if(e.hasOwnProperty(i))r[i]=e[i]}else r[e]=t;c(n)},remove:function(e){delete r[e],c()},toObject:function(){return r}}});
//# sourceMappingURL=SessionStorage.js.map
define("SBIS3.CONTROLS/Storages/SessionStorage",["Core/SessionStorage"],function(e){"use strict";return{setItem:function(t,n){e.set(t,n,true)},getItem:function(t){return e.get(t)},removeItem:function(t){e.remove(t)}}});
//# sourceMappingURL=SessionStorage.js.map
define("SBIS3.CONTROLS/Interfaces/IStorage",[],function(){"use strict";return{getItem:function(e){throw new Error("Method must be implemented")},setItem:function(e,t){throw new Error("Method must be implemented")},removeItem:function(e){throw new Error("Method must be implemented")}}});
//# sourceMappingURL=IStorage.js.map
define("SBIS3.CONTROLS/Storages/SBIS/SBISStorageAdapter",["Core/core-extend","SBIS3.CONTROLS/Interfaces/IStorage"],function(t,e){"use strict";return t({},[e],{$constructor:function(t){this._storage=t.storage},setItem:function(t,e){return this._storage.setParam(t,e)},getItem:function(t){return this._storage.getParam(t)},removeItem:function(t){this._storage.removeParam(t)}})});
//# sourceMappingURL=SBISStorageAdapter.js.map
define("Core/AbstractConfig",["Core/Abstract","Core/Deferred","Core/SessionStorage","Core/constants","optional!WS.Data/Source/SbisService"],function(e,t,r,a,n){return e.extend({$protected:{_blo:null},$constructor:function(){this._publish("onChange")},_isConfigSupport:function(){throw new Error("AbstractConfig:_isConfigSupport must be implemented in child classes")},_getObjectName:function(){throw new Error("AbstractConfig:_getObjectName must be implemented in child classes")},_getBLObject:function(){if(!n)throw new Error("Для работы Core/AbstractConfig нужен модуль WS.Data/Source/SbisService");var e=new t,r=this;if(null===this._blo)return e.callback().addCallback(function(){return r._blo=new n({endpoint:r._getObjectName()}),r._blo});else e.callback(this._blo);return e},_callMethod:function(e,r){if(!this._isConfigSupport())return t.success();return this._getBLObject().addCallback(function(t){return t.call(e,r)})},_prepareParam:function(e,t){var r={"Путь":e};if(t)r["Контекст"]=t;return r},_processingParam:function(e,t,n){if(!a.isBrowserPlatform||!t)return;switch(e){case"update":r.set(t,n);break;case"delete":r.remove(t);break;case"read":return r.get(t)}this._notify("onChange",t,n)},_getParam:function(e,t,r){var a=this;return this._callMethod(e,this._prepareParam(t,r)).addCallback(function(e){if(!e)return a._processingParam("read",t);var r=e.getScalar();return a._processingParam("update",t,r),r})},getParam:function(e,t){return this._getParam("ПолучитьЗначение",e,t)},getParams:function(e){var t=this,r=e?{Names:e}:{};return this._callMethod("ПолучитьПараметры",r).addCallback(function(e){if(!e)return{};var r,a;if(r=e.getAll(),r)r.each(function(e){(a=e.get("Название"))&&t._processingParam("update",a,e.get("Значение"))});return r})},setParam:function(e,r,a){if(void 0===r)r=null;if(this._processingParam("update",e,r),!this._isConfigSupport())return(new t).callback(true);var n=this._prepareParam(e,a);return n["ЗначениеПараметра"]=r,this._callMethod("ВставитьЗначение",n).addCallback(function(e){return e&&e.getScalar()})},removeParam:function(e,r){if(this._processingParam("delete",e,null),!this._isConfigSupport())return(new t).callback(true);var a=this._prepareParam(e,r);return this._callMethod("УдалитьПараметр",a).addCallback(function(e){return e&&e.getScalar()})}})});
//# sourceMappingURL=AbstractConfig.js.map
define("Core/UserConfig",["Core/AbstractConfig","Core/Deferred","Core/constants"],function(r,e,t){return new(r.extend({_getObjectName:function(){return"ПользовательскиеПараметры"},_isConfigSupport:function(){return t.isNodePlatform||t.userConfigSupport},getParamValues:function(r,e){return this._getParam("ПолучитьСписокЗначений",r,e).addCallback(function(r){return r||[]})},setParamValue:function(r,t,n,a){var i=this._processingParam("read",r);if(i){if("string"==typeof i)i=[i];if(i.length>=(n||10))i.pop();i.unshift(t)}if(this._processingParam("update",r,i||[t]),!this._isConfigSupport())return(new e).callback(true);var o=this._prepareParam(r,a);return o["Значение"]=t,o["МаксимальноеКоличество"]=n||10,this._callMethod("ДобавитьЗначение",o).addCallback(function(r){return r&&r.getScalar()})}}))});
//# sourceMappingURL=UserConfig.js.map
define("SBIS3.CONTROLS/Storages/SBIS/SBISUserConfigStorage",["SBIS3.CONTROLS/Storages/SBIS/SBISStorageAdapter","Core/UserConfig","SBIS3.CONTROLS/Interfaces/IStorage"],function(S,e){"use strict";return new S({storage:e})});
//# sourceMappingURL=SBISUserConfigStorage.js.map
define("Core/ClientsGlobalConfig",["Core/AbstractConfig","Core/constants"],function(n,o){return new(n.extend({_getObjectName:function(){return"ГлобальныеПараметрыКлиента"},_isConfigSupport:function(){return o.isNodePlatform||o.globalConfigSupport}}))});
//# sourceMappingURL=ClientsGlobalConfig.js.map
define("SBIS3.CONTROLS/Storages/SBIS/SBISClientsGlobalConfigStorage",["SBIS3.CONTROLS/Storages/SBIS/SBISStorageAdapter","Core/ClientsGlobalConfig","SBIS3.CONTROLS/Interfaces/IStorage"],function(S,e){"use strict";return new S({storage:e})});
//# sourceMappingURL=SBISClientsGlobalConfigStorage.js.map
define("SBIS3.CONTROLS/Storages/SBIS/SBISHistoryStorage",["Core/EventBus","SBIS3.CONTROLS/Storages/SessionStorage","SBIS3.CONTROLS/Storages/SBIS/SBISUserConfigStorage","SBIS3.CONTROLS/Storages/SBIS/SBISClientsGlobalConfigStorage","Core/Abstract","Core/helpers/string-helpers-min","Core/Deferred","Core/helpers/Function/forAliveOnly","Core/IoC","Core/constants","Lib/Storage/LocalStorage"],function(t,s,e,i,o,r,a,n,h,l,_){"use strict";var S=function(t,s){return s?r[t?"serializeURLData":"deserializeURLData"](s):null},y="-global",d={},u=o.extend([],{$protected:{_options:{historyId:void 0,serialize:S,emptyValue:null,isGlobalUserConfig:false},_saveParamsDeferred:void 0,_history:void 0,_historyChannel:null,_SBISStorage:null},$constructor:function(){if(this._publish("onHistoryUpdate"),this._options.isGlobalUserConfig)this._options.historyId=this._options.historyId+y,this._SBISStorage=i;else this._SBISStorage=e;this._getLocalStorage(),this._updateHistory=this._updateHistory.bind(this),this._historyChannel=t.channel("HistoryChannel"+this._options.historyId),this._historyChannel.subscribe("onHistoryUpdate",this._updateHistory)},_updateHistory:function(t,s,e){if(e!==this)this._history=s,this._notify("onHistoryUpdate",s)},_setStorageValue:function(t){var e=this._options.serialize(true,t),i=this._options.historyId;if(this._getLocalStorage().setItem(i,e),s.setItem(i,e),d[this._options.historyId]=t,l.userConfigSupport)return this._SBISStorage.setItem(i,e);else return this._getLocalStorage().setItem(i,e),a.success()},_getStorageValue:function(){var t=this._options.historyId,e,i;try{e=l.userConfigSupport?s.getItem(t):this._getLocalStorage().getItem(t),i=!e||"string"===typeof e?this._options.serialize(false,e):e}catch(t){h.resolve("ILogger").error("HistoryController",t.message,t),i=null}return i},_getLocalStorage:function(){if(!this._localStorage)this._localStorage=new _(this._options.historyId),this._localStorage.subscribe("onChange",function(t,e){if(e===this._options.historyId)s.setItem(this._options.historyId,this._localStorage.getItem(e))}.bind(this));return this._localStorage},getHistory:function(){if(!this._history){if(!d[this._options.historyId])d[this._options.historyId]=this._getStorageValue();this._history=d[this._options.historyId]}return this._history},setHistory:function(t,s){if(this._history=t,s)this.saveHistory()},saveHistory:function(){var t=this;if(!this.isNowSaving())this._saveParamsDeferred=new a,this._setStorageValue(this._history).addCallback(n(function(s){return t._saveParamsDeferred.callback(),s},t)),this._notify("onHistoryUpdate",this._history),this._historyChannel.notify("onHistoryUpdate",this._history,this);else this._saveParamsDeferred.addCallback(function(s){return t.saveHistory(),s});return this._saveParamsDeferred},clearHistory:function(){this.setHistory(this._options.emptyValue,true)},isNowSaving:function(){return this._saveParamsDeferred&&!this._saveParamsDeferred.isReady()},getSaveDeferred:function(){return this._saveParamsDeferred},destroy:function(){if(this._saveParamsDeferred)this._saveParamsDeferred.cancel(),this._saveParamsDeferred=void 0;if(this._localStorage)this._localStorage.destroy(),this._localStorage=void 0;if(this._historyChannel.unsubscribe("onHistoryUpdate",this._updateHistory),!this._historyChannel.hasEventHandlers("onHistoryUpdate"))delete d[this._options.historyId],this._historyChannel.destroy();this._historyChannel=void 0,this._history=void 0,this._SBISStorage=void 0,u.superclass.destroy.call(this)}});return u});
//# sourceMappingURL=SBISHistoryStorage.js.map
define("SBIS3.CONTROLS/History/HistoryController",["SBIS3.CONTROLS/Storages/SBIS/SBISHistoryStorage"],function(S){return S});
//# sourceMappingURL=HistoryController.js.map
define("SBIS3.CONTROLS/Filter/HistoryController/FilterHistoryControllerUntil",["Core/core-clone","Core/helpers/Object/isEqual","Core/helpers/Object/find","Core/helpers/String/ucFirst"],function(e,r,t,i){"use strict";var n="itemTemplate",a="historyItemTemplate";function l(e,t){var n="reset"+i.call(e),a=t[n];if(t.hasOwnProperty(e))if(t.hasOwnProperty(n)&&!r(t[e],a))t[e]=a;else delete t[e]}return{prepareStructureToSave:function(r){var t=e(r);for(var i in t)if(t.hasOwnProperty(i)){if(t[i].value)if(t[i].value instanceof Date)t[i].value=t[i].value.toSQL(Date.SQL_SERIALIZE_MODE_AUTO);if(t[i].hasOwnProperty(n))delete t[i][n];if(t[i].hasOwnProperty(a))delete t[i][a]}return t},prepareStructureToApply:function(i,n,a){var u=e(n);this.prepareNewStructure(u,i);for(var o in u)if(u.hasOwnProperty(o)){var s=t(i,function(e){return u[o].internalValueField===e.internalValueField},false);if(s){if(void 0!==s.value)u[o].value=s.value;else l("value",u[o]);if(void 0!==s.caption)u[o].caption=s.caption;else l("caption",u[o]);if(void 0!==s.visibilityValue)u[o].visibilityValue=s.visibilityValue}else if(!a&&u[o].hasOwnProperty("value")&&u[o].hasOwnProperty("resetValue")&&!r(u[o].value,u[o].resetValue))l("value",u[o])}return u},prepareNewStructure:function(e,r){var i=[],l=false,u=function(e,r,t){if(r.hasOwnProperty(e))t[e]=r[e];else if(t.hasOwnProperty(e))delete t[e]};for(var o in r)if(r.hasOwnProperty(o))if(!t(e,function(e){if(!r[o])return false;else{if(l=r[o].internalValueField===e.internalValueField,l)u(n,e,r[o]),u(a,e,r[o]);return l}}))i.push(o);i.forEach(function(e){delete r[e]})},resetStructureElementsByFilterKeys:function(r,i,n){var a=i||e(r.getFilterStructure()),u=t(r._options.bindings,function(e){return"filterStructure"===e.propName}),o;function s(e){var r=e.split("/");return r[r.length-1]}function f(e){for(var r=e.subBindings,t=0,i=r.length;t<i;t++)if("value"===r[t].propName)return r[t]}if(!u||!u.subBindings||!u.subBindings.length)return false;for(var p=0,c=(u=u.subBindings).length;p<c;p++)if(o=f(u[p]),o)if(-1!==Array.indexOf(n,s(o.fieldName)))l("value",a[u[p].index])}}});
//# sourceMappingURL=FilterHistoryControllerUntil.js.map
define("Core/helpers/date-helpers",[],function(){return{periodTypes:{years:"years",year:"year",halfyears_different_years:"halfyears_different_years",halfyear:"halfyear",quarters:"quarters",quarters_different_years:"quarters_different_years",quarter:"quarter",months:"months",months_different_years:"months_different_years",month:"month",day:"day"},isISODate:function(e){return/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):?(\d\d))?$/g.test(e)},dateFromISO:function(e){var t,r,a=/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):?(\d\d))?$/.exec(e)||[];if(a[1]){(t=a[1].split(/\D/).map(function(e){return parseInt(e,10)||0}))[1]-=1;var n=void 0!==t[6]?t[6]+"":"";if(n.length>3)t[6]=parseInt(n.substr(0,3),10);if(t=new Date(Date.UTC.apply(Date,t)),!t.getDate())return NaN;if(a[5]){if(r=60*parseInt(a[5],10),a[6])r+=parseInt(a[6],10);if("+"==a[4])r*=-1;if(r)t.setUTCMinutes(t.getUTCMinutes()+r)}return t}return NaN},compareDates:function(e,t,r){if(!e||!r)return false;var a=e.toSQL()==r.toSQL();switch(t){case"<":return!a&&e<r;case"<=":return a||e<r;case"=":case"==":return a;case">=":return a||e>r;case">":return!a&&e>r;case"!=":return!a;default:return false}},getPeriodLength:function(e,t){var r=24*60*60*1e3;return Math.round(Math.abs((e.getTime()-t.getTime())/r))+1},getCurrentPeriod:function(e){var t=new Date;if(e===this.periodTypes.month)return[new Date(t.getFullYear(),t.getMonth(),1),new Date(t.getFullYear(),t.getMonth()+1,0)];else if("quarter"===e)return[new Date(t.getFullYear(),3*(t.getMonth()/3|0),1),new Date(t.getFullYear(),3*(t.getMonth()/3|0)+3,0)];else if("halfyear"===e)return[new Date(t.getFullYear(),6*(t.getMonth()/6|0),1),new Date(t.getFullYear(),6*(t.getMonth()/6|0)+6,0)];else if("year"===e)return[new Date(t.getFullYear(),0,1),new Date(t.getFullYear(),11,31)]},getPeriodType:function(e,t){var r,a,n,f,s,o,i,l,u;if(r=new Date(t).setLastMonthDay().getDate(),l=[e.getDate(),e.getMonth(),e.getFullYear(),Math.floor(e.getMonth()/6),Math.floor(e.getMonth()/3)],u=[t.getDate(),t.getMonth(),t.getFullYear(),Math.floor(t.getMonth()/6),Math.floor(t.getMonth()/3)],a=l[2]===u[2],n=1==l[0]&&u[0]==r,f=n&&l[1]%3===0&&(u[1]+1)%3===0,s=n&&l[1]%6===0&&(u[1]+1)%6===0,o=n&&0===l[1]&&11===u[1],i=l[0]==u[0]&&l[1]==u[1]&&l[2]==u[2],o)if(a)return this.periodTypes.year;else return this.periodTypes.years;else if(s)if(a)if(l[3]===u[3])return this.periodTypes.halfyear;else return this.periodTypes.halfyears;else return this.periodTypes.halfyears_different_years;else if(f)if(a)if(l[4]===u[4])return this.periodTypes.quarter;else return this.periodTypes.quarters;else return this.periodTypes.quarters_different_years;else if(n)if(a)if(l[1]==u[1])return this.periodTypes.month;else return this.periodTypes.months;else return this.periodTypes.months_different_years;else if(i)return this.periodTypes.day},getPeriodLengthInMonthByType:function(e){switch(e){case this.periodTypes.month:return 1;case this.periodTypes.quarter:return 3;case this.periodTypes.halfyear:return 6;case this.periodTypes.year:return 12}},getFormattedDateRange:function(e,t,r){(r=r||{}).fullNameOfMonth="undefined"!==typeof r.fullNameOfMonth?r.fullNameOfMonth:false,r.contractToMonth="undefined"!==typeof r.contractToMonth?r.contractToMonth:true,r.contractToQuarter="undefined"!==typeof r.contractToQuarter?r.contractToQuarter:false,r.contractToHalfYear="undefined"!==typeof r.contractToHalfYear?r.contractToHalfYear:false,r.contractToYear="undefined"!==typeof r.contractToYear?r.contractToYear:true,r.shortYear="undefined"!==typeof r.shortYear?r.shortYear:true;var a="undefined"!==typeof r.fullNameOfMonth?r.fullNameOfMonth:false,n="undefined"!==typeof r.contractToMonth?r.contractToMonth:false,f="undefined"!==typeof r.contractToQuarter?r.contractToQuarter:false,s="undefined"!==typeof r.contractToHalfYear?r.contractToHalfYear:false,o="undefined"!==typeof r.contractToYear?r.contractToYear:true,i="undefined"!==typeof r.shortYear?r.shortYear:true,l="undefined"!==typeof r.emptyPeriodTitle?r.emptyPeriodTitle:"...",u,d="",h=i?"'%y":" %Y",y,c,p,m,g,T,M,Y;if(e&&t)if(u=new Date(t).setLastMonthDay().getDate(),M=[e.getDate(),e.getMonth(),e.getFullYear(),Math.floor(e.getMonth()/6),Math.floor(e.getMonth()/3)],Y=[t.getDate(),t.getMonth(),t.getFullYear(),Math.floor(t.getMonth()/6),Math.floor(t.getMonth()/3)],y=M[2]===Y[2],c=1==M[0]&&Y[0]==u,p=c&&y&&M[1]%3===0&&(Y[1]+1)%3===0,m=c&&y&&M[3]===Y[3]&&M[1]%6===0&&(Y[1]+1)%6===0,g=c&&0===M[1]&&11===Y[1],T=M[0]==Y[0]&&M[1]==Y[1]&&M[2]==Y[2],g)if(y)d=e.strftime("%Y");else if(o)d=e.strftime("%Y")+"-"+t.strftime("%Y");else d=e.strftime("%d.%m.%y")+" - "+t.strftime("%d.%m.%y");else if(s&&m)d=e.strftime("%E полугодие"+h);else if(f&&p)if(M[4]===Y[4])d=e.strftime("%Q квартал"+h);else d=e.strftime("%Q")+"-"+t.strftime("%Q квартал"+h);else if(c)if(y)if(M[1]==Y[1])d=e.strftime("%B"+h);else if(n)d=e.strftime("%f")+" - "+t.strftime("%f"+h);else d=e.strftime("%d.%m.%y")+" - "+t.strftime("%d.%m.%y");else if(n)d=e.strftime("%f"+h)+" - "+t.strftime("%f"+h);else d=e.strftime("%d.%m.%y")+" - "+t.strftime("%d.%m.%y");else if(T)if(a)d=e.strftime("%i %q'%y");else d=e.strftime("%d.%m.%y");else d=e.strftime("%d.%m.%y")+" - "+t.strftime("%d.%m.%y");else if(e)d=e.strftime("%d.%m.%y")+" - ...";else if(t)d="... - "+t.strftime("%d.%m.%y");else d=l;return d}}});
//# sourceMappingURL=date-helpers.js.map
define("SBIS3.CONTROLS/Filter/Button/Utils/FilterToStringUtil",["SBIS3.CONTROLS/Utils/TemplateUtil","Core/helpers/Object/isEqual","Core/helpers/date-helpers","Core/helpers/String/escapeTagsFromStr"],function(e,t,r,n){function i(e,n){if(e&&n&&(e instanceof Date||n instanceof Date))return r.compareDates(new Date(e),"=",new Date(n));return t(e,n)}return{string:function(t,r){var a,u,l;return l=Object.keys(t).reduce(function(l,s){if(a=e.prepareTemplate(t[s][r]),a){if(u=a(t[s]),u&&u.trim())l.push(u);return l}else if(null===a)return l;if(t[s].caption&&t[s].hasOwnProperty("value")&&!i(t[s].value,t[s].resetValue))l.push(n(t[s].caption,""));return l},[]),l.join(", ")},isEqualValues:i}});
//# sourceMappingURL=FilterToStringUtil.js.map
define("SBIS3.CONTROLS/Filter/HistoryController",["Core/core-clone","Core/EventBus","SBIS3.CONTROLS/History/HistoryController","WS.Data/Collection/List","SBIS3.CONTROLS/Filter/Button/Utils/FilterToStringUtil","SBIS3.CONTROLS/Filter/HistoryController/FilterHistoryControllerUntil","Core/helpers/Object/isEqual","Core/helpers/generate-helpers","Core/helpers/Function/debounce","Core/helpers/Function/forAliveOnly","Core/helpers/Object/find","Core/HashManager","Core/core-instance","Core/core-merge","Core/Date"],function(t,i,e,r,s,n,o,l,a,h,f,u,c,p){"use strict";var y=10,F=9,_=i.channel("FilterHistoryChannel");function v(t){var i=[];return t.each(function(t){i.push(t)}),i}var d=e.extend({$protected:{_options:{view:void 0,filterButton:void 0,fastDataFilter:void 0,noSaveFilters:[],filtersForHistory:[]}},$constructor:function(){if(this._listHistory=new r({items:t(this.getHistory())||[]}),this._prepareListHistory(),this._changeHistoryFnc=this._changeHistoryHandler.bind(this),this._applyHandlerDebounced=a.call(h(this._onApplyFilterHandler,this)).bind(this),this._options.filterButton)this._initFilterButton();if(this._options.fastDataFilter)this._initFastDataFilter();if(_.subscribe("onChangeHistory",this._changeHistoryFnc),this._hashChangeHandlerFnc=this._hashChangeHandler.bind(this),this._options.filtersForHistory.length>0)if(u.subscribe("onChange",this._hashChangeHandlerFnc),c.instanceOfMixin(this._options.view,"SBIS3.CONTROLS/Mixins/TreeMixin")&&this._options.filtersForHistory.indexOf(this._options.view.getParentProperty())>-1)this._options.view.subscribe("onSetRoot",function(t,i){var e=this._getFiltersFormHash();e[this._options.view.getParentProperty()]=i,this._setFiltersToHash(e),this._onApplyFilterHandler()}.bind(this))},_changeHistoryHandler:function(i,e,r,s,l){if(this._options.historyId!==e)return;var a=o(this.getHistoryArr(),v(r)),h=this._options.filterButton,f=this.getActiveFilter();if(a||f&&s&&o(f,s)){if(!a&&false===s&&false===f)h.sendCommand("reset-filter");return}if(this._listHistory.assign(t(v(r))),this._saveParamsDeferred=l,s)h.setFilterStructure(n.prepareStructureToApply(s.filter,h.getFilterStructure()));else h.sendCommand("reset-filter");this._updateFilterButtonHistoryView()},_initFilterButton:function(){var t=this._options.filterButton,i=this;this.subscribeTo(t,"onResetFilter",function(e,r,s){if(!r)if(s&&!t.getLinkedContext().getValue("filterChanged")){if(i.clearActiveFilter(),!i.isNowSaving())i.saveToUserParams()}else i._applyHandlerDebounced()}),this.subscribeTo(t,"onApplyFilter",this._applyHandlerDebounced)},_initFastDataFilter:function(){this.subscribeTo(this._options.fastDataFilter,"onApplyFilter",this._applyHandlerDebounced)},_prepareListHistory:function(){var t=[],i=this._options.filterButton.getFilterStructure(),e=this,r=false;if(this._listHistory.each(function(e){n.prepareNewStructure(i,e.filter);var o=s.string(e.filter,"historyItemTemplate");if(o){if(e.linkText!==o)e.linkText=o,r=true}else t.push(e)}),t.length)t.forEach(function(t){e._listHistory.remove(t),r=true});if(r)this.setHistory(v(this._listHistory),true)},_onApplyFilterHandler:function(){var t=this._options.filterButton,i=t.getFilterStructure(),e=this;if(!t.getLinkedContext().getValue("filterChanged"))return e.clearActiveFilter(),void e.saveToUserParams();e.saveToHistory({linkText:s.string(i,"historyItemTemplate"),filter:n.prepareStructureToSave(i)}),e._updateFilterButtonHistoryView()},_updateFilterButtonHistoryView:function(){var t=this._options.filterButton._picker,i;if(t)(i=t.getChildControlByName("filterHistory")).updateHistoryViewItems(),i.toggleHistoryBlock(true)},activateFilterByKey:function(t){var i=this.findFilterByKey(t),e=this._options.filterButton;if(e._setFilterStructure(n.prepareStructureToApply(i.filter,e.getFilterStructure())),e.getContext().setValue("linkText",i.linkText),e.hidePicker(),!i.isActiveFilter)this.clearActiveFilter(),i.isActiveFilter=true,i.viewFilter=this.prepareViewFilter()},saveToHistory:function(t){var i=f(this.getHistoryArr(),function(i){return o(i.filter,t.filter)||i.linkText===t.linkText}),e=this.getActiveFilter();if(e)e.isActiveFilter=false;if(this._setFiltersToHash(t),this.isNowSaving()||i||!t.linkText){if(i&&!i.isActiveFilter)i.isActiveFilter=true,i.viewFilter=this.prepareViewFilter(),i.filter=t.filter,this.saveToUserParams();return}if(this._listHistory.getCount()===y)this._listHistory.removeAt(F);this._listHistory.add({id:l.randomId(),linkText:t.linkText,viewFilter:this.prepareViewFilter(),filter:t.filter,isActiveFilter:true,isMarked:false}),this.saveToUserParams()},prepareViewFilter:function(i){var e=this._options.view,r=t(i||(e?e.getFilter():{}));this._options.noSaveFilters.forEach(function(t){if(r[t])delete r[t]});for(var s in r)if(r.hasOwnProperty(s))if(r[s]instanceof Date)r[s]=r[s].toSQL(Date.SQL_SERIALIZE_MODE_AUTO);var n=this._getFiltersFormHash();return p(r,n)},clearActiveFilter:function(){var t=this.getActiveFilter();if(t)t.isActiveFilter=false},getActiveFilter:function(){return f(this.getHistoryArr(),function(t){return t.isActiveFilter},this,false)},_getFiltersFormHash:function(){var t=u.get(this._options.historyId),i=this._options.filtersForHistory,e={};if(t)if(t=JSON.parse(t),1==i.length)e[i[0]]=t;else e=t;return i.forEach(function(t){if(!e.hasOwnProperty(t))e[t]=null}),e},_setFiltersToHash:function(t){var i=this._options.filtersForHistory,e={};if(i.length>0){if(1==i.length)e=t[i[0]];else i.forEach(function(i){if(void 0!==typeof t[i])e[i]=t[i]}.bind(this)),e=JSON.stringify(e);if(e)u.set(this._options.historyId,JSON.stringify(e));else u.remove(this._options.historyId)}},findFilterByKey:function(t){return f(this.getHistoryArr(),function(i){return i.id==t},this,false)},saveToUserParams:function(){this._sortHistory(),this.setHistory(this.getHistoryArr(),true),_.notify("onChangeHistory",this._options.historyId,this._listHistory,this.getActiveFilter(),this.getSaveDeferred())},toggleMarkFilter:function(t){var i=this.findFilterByKey(t);if(i)i.isMarked=!i.isMarked,this.saveToUserParams()},getHistoryArr:function(){return v(this._listHistory)},getFilterButton:function(){return this._options.filterButton},_sortHistory:function(){this._listHistory.assign(this.getHistoryArr().sort(function(t,i){if(t.isMarked&&i.isMarked)return 0;else if(t.isMarked)return-1;else if(i.isMarked)return 1;else if(t.isActiveFilter&&i.isActiveFilter)return 0;else if(t.isActiveFilter)return-1;else if(i.isActiveFilter)return 1;return 0}))},_hashChangeHandler:function(){var t=this._options.view,i=t.getFilter(),e=this._getFiltersFormHash();if(c.instanceOfMixin(this._options.view,"SBIS3.CONTROLS/Mixins/TreeMixin")&&this._options.filtersForHistory.indexOf(t.getParentProperty())>-1)t.setCurrentRoot(e[t.getParentProperty()]||null);p(i,e),t.setFilter(i)},destroy:function(){_.unsubscribe("onChangeHistory",this._changeHistoryFnc),u.unsubscribe("onChange",this._hashChangeHandlerFnc),this._changeHistoryFnc=void 0,this._applyHandlerDebounced=void 0,d.superclass.destroy.apply(this,arguments)}});return d});
//# sourceMappingURL=HistoryController.js.map
define("SBIS3.CONTROLS/Utils/QueryUtil",["WS.Data/Query/Query","WS.Data/Source/SbisService","Core/core-instance"],function(e,r,n){"use strict";function t(r,n,t,u){var i=new e;return i.where(r||{}).offset(t).limit(u).orderBy(n||{}),i}return function e(u,i){if(!n.instanceOfModule(u,"WS.Data/Source/Base"))u=new r(u);return u.query(t.apply(null,i))}});
//# sourceMappingURL=QueryUtil.js.map
define("tmpl!SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Link"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],s={};s["js!SBIS3.CONTROLS/Link"]=e[1];var i=function e(i,r,o,n,l){function a(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var S={};l&&l.isSetts&&(S=l.fullContext||{});var p="string"==typeof o?o:"",d=void 0===s?void 0:s,v={id:[],def:void 0},m=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),C=this&&this.includedTemplates?this.includedTemplates:{},L=u.getMarkupGenerator(n);try{var f=L.joinElements([L.createTag("div",{class:"controls-MissSpell"},[L.createTag("span",{class:"controls-bold-text"},[L.createText(global.rk("Возможно, вы имели в виду")+"&nbsp;")],{},v,this),L.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"missSpellLink",caption:u.getter(i,["caption"])},{name:"missSpellLink",sbisname:"missSpellLink"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},o,d,C,u.config,S)],r,v,this)],p,v);v.def&&(f=L.chain(f,v,r),v=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell.tmpl",e,i)}return f||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell"}},i}),define("SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell",["Lib/Control/CompoundControl/CompoundControl","tmpl!SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell","css!SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell","SBIS3.CONTROLS/Link"],function(e,t){"use strict";return e.extend({_dotTplFn:t,$constructor:function(){var e=this;this._publish("onActivated"),this.subscribe("onInit",function(){this.subscribeTo(this.getChildControlByName("missSpellLink"),"onActivated",function(){e._notify("onActivated",this.getCaption())})})},setCaption:function(e){this.getChildControlByName("missSpellLink").setCaption(e)}})});
//# sourceMappingURL=MissSpell.tmpl.map
define("SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell",["Lib/Control/CompoundControl/CompoundControl","tmpl!SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell","css!SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell","SBIS3.CONTROLS/Link"],function(t,i){"use strict";return t.extend({_dotTplFn:i,$constructor:function(){var t=this;this._publish("onActivated"),this.subscribe("onInit",function(){this.subscribeTo(this.getChildControlByName("missSpellLink"),"onActivated",function(){t._notify("onActivated",this.getCaption())})})},setCaption:function(t){this.getChildControlByName("missSpellLink").setCaption(t)}})});
//# sourceMappingURL=MissSpell.js.map
define("SBIS3.CONTROLS/Utils/KbLayoutRevert/KbLayoutRevertUtil",[],function(){"use strict";var t={endpoint:"CoreUtils",binding:{query:"TranslitSearchProxyCall"}};return{_layouts:{"ru-en":"йцукенгшщзхъфывапролджэячсмитьбюЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЯЧСМИТЬБЮqwertyuiop[]asdfghjkl;'zxcvbnm,.QWERTYUIOP{}ASDFGHJKL:\"ZXCVBNM<>"},_cache:{layoutObjects:{},layoutObjectsSplit:{}},_getLayoutObject:function(t,r){var e,i,o;if(!this._layouts[t])return;if(i=this._layouts[t],r){if(e={},this._cache.layoutObjectsSplit.hasOwnProperty(t))return this._cache.layoutObjectsSplit[t];e.straight={},e.reverse={};var s=i.length/2;for(o=0;o<s;++o)e.straight[i[o]]=i[o+s],e.reverse[i[o+s]]=i[o];this._cache.layoutObjectsSplit[t]=e}else{if(e=[],this._cache.layoutObjects.hasOwnProperty(t))return this._cache.layoutObjects[t];for(o=0;o<i.length;++o)e[i[o]]=0;this._cache.layoutObjects[t]=e}return e},_figureLayout:function(t){var r={matches:0,layoutId:null};for(var e in this._layouts)if(this._layouts.hasOwnProperty(e)){for(var i=this._getLayoutObject(e),o=0,s=0;s<t.length;++s)if(i.hasOwnProperty(t[s]))++o;if(!r||r.matches<o)r={matches:o,layoutId:e}}return r},_figureConversionDirectionByWorlds:function(t,r){var e=this._getLayoutObject(r,true),i=0,o,s=[];return t.split(/\s/).forEach(function(t){if(!t)return void s.push({word:" "});for(var r=0,a=0,n=0;n<t.length;++n){if(e.straight.hasOwnProperty(t[n]))++r;if(e.reverse.hasOwnProperty(t[n]))++a}if(o=r>=a?1:-1,r&&a)o=r>=a?-1:1;i+=o,s.push({word:t,direction:o})}),{direction:i<0?-1:1,words:s}},process:function(t,r){if(r=r||this._figureLayout(t).layoutId,!r)return t;var e=this._figureConversionDirectionByWorlds(t,r),i=this._getLayoutObject(r,true),o=1===e.direction?i.straight:i.reverse,s="";return e.words.forEach(function(t){var r=t.word;if(" "===r)return void(s+=r);if(o=1===t.direction?i.straight:i.reverse,s.trim().length>0)s+=" ";for(var e=0;e<r.length;++e)if(o.hasOwnProperty(r[e]))s+=o[r[e]];else s+=r[e]}),s}}});
//# sourceMappingURL=KbLayoutRevertUtil.js.map
define("Core/helpers/String/diffAt",function(){return function t(n,r){if("string"===typeof n&&"string"===typeof r)for(var e=0,f=Math.max(n.length,r.length);e<f;e++)if(n[e]!==r[e])return e;return-1}});
//# sourceMappingURL=diffAt.js.map
define("SBIS3.CONTROLS/Utils/KbLayoutRevert/KbLayoutRevertObserver",["Core/core-extend","Core/helpers/String/diffAt","Core/core-clone","SBIS3.CONTROLS/Utils/KbLayoutRevert/KbLayoutRevertUtil","SBIS3.CONTROLS/Utils/KbLayoutRevert/resources/MissSpell","SBIS3.CONTROLS/Utils/QueryUtil","Core/core-instance"],function(e,t,s,i,n,a,r){"use strict";function l(){this.startTime=null,this.stared=false,this.start=function(){this.startTime=new Date,this.stared=true},this.stop=function(){this.startTime=null,this.stared=false},this.getTime=function(){return this.startTime?(new Date).getTime()-this.startTime.getTime():0}}function o(e,t){if(e.getCount()<this._options.view.getPageSize())t.prepend(e);else t.assign(e)}var f=750,_=e({},{$protected:{_options:{textBox:null,view:null,param:null,newStandart:false},_textBeforeTranslate:null,_itemsBeforeTranslate:null,_onViewDataLoadHandler:null,_observed:false,_oldSearchValue:"",_timer:null,_missSpell:null,_missSpellUsed:false,_currentItems:null},$constructor:function(){this._onViewDataLoadHandler=this._onViewDataLoad.bind(this),this._onBeforeDataLoadHandler=this._onBeforeDataLoad.bind(this)},startObserve:function(){if(!this._observed)this._toggleViewEvents(true),this._observed=true},stopObserve:function(){if(this._observed)this._toggleViewEvents(false),this._textBeforeTranslate=null,this._itemsBeforeTranslate=null,this._observed=false,this._oldSearchValue="",this._hideMissSpell(),this._toggleItemsEventRaising(true)},setParam:function(e){this._options.param=e},getParam:function(){return this._options.param},_toggleViewEvents:function(e){var t=this._options.view,s=e?"subscribeTo":"unsubscribeFrom";if(t.getDataSource())t[s](t.getDataSource(),"onBeforeProviderCall",this._onBeforeDataLoadHandler);t[s](t,"onDataLoad",this._onViewDataLoadHandler)},_onBeforeDataLoad:function(){var e=this._getTimer();if(!e.stared)e.start()},_getTimer:function(){if(!this._timer)this._timer=new l;return this._timer},_onViewDataLoad:function(e,t){var i=this._options.view,n=s(i.getFilter()),l=this._options.param,_=n[l],h=this._options.textBox,g=r.instanceOfModule(i.getDataSource(),"WS.Data/Source/Memory"),c=r.instanceOfMixin(i,"SBIS3.CONTROLS/Interfaces/IItemsControl")||g,m=this;function d(){var e=u(_,m._oldSearchValue);if(e!==_)if(m._textBeforeTranslate=_,n[l]=e,c)i.setFilter(n,true),a(i.getDataSource(),[n,i.getSorting(),i.getOffset(),i.getPageSize()]).addCallback(function(e){return m._onViewDataLoad(null,e.getAll()),e});else{if(m._toggleItemsEventRaising(false),m._getTimer().getTime()>f)i.getContainer().find(".controls-AjaxLoader").eq(0).toggleClass("ws-hidden controls-AjaxLoader__showIndication");m._getTimer().stop(),i.setFilter(n)}}function S(){n[l]=m._textBeforeTranslate,i.setFilter(n,true),m._itemsBeforeTranslate=null,m._textBeforeTranslate=null}function p(e){m._showMissSpell(e)}function T(){if(m._oldSearchValue=_,m._textBeforeTranslate)if(m._options.newStandart)if(m._itemsBeforeTranslate&&m._itemsBeforeTranslate.getCount())t.setMetaData(m._itemsBeforeTranslate.getMetaData()),o.call(m,m._itemsBeforeTranslate,t),S(),p(_),m._toggleItemsEventRaising(true);else{if(p(_),c)o.call(m,t,i.getItems());m._toggleItemsEventRaising(true,false),m._textBeforeTranslate=null}else{if(h.getText().length===_.length)h.setText(_),i.setHighlightText(_,false);if(g)o.call(m,t,m._itemsBeforeTranslate);m._textBeforeTranslate=null,m._toggleItemsEventRaising(true)}else if(m._options.newStandart)m._itemsBeforeTranslate=t,d()}function v(){if(m._textBeforeTranslate)if(m._options.newStandart){if(m._itemsBeforeTranslate)t.assign(m._itemsBeforeTranslate),t.setMetaData(m._itemsBeforeTranslate.getMetaData());m._toggleItemsEventRaising(true,!(m._itemsBeforeTranslate&&m._itemsBeforeTranslate.getCount())),S(),m._hideMissSpell()}else n[l]=m._textBeforeTranslate,i.setFilter(n,true),m._textBeforeTranslate=null,m._toggleItemsEventRaising(true);else{if(g)m._itemsBeforeTranslate=t;d()}}if(!_||this._missSpellUsed)return this._hideMissSpell(),void(this._missSpellUsed=false);if(t.getCount())T();else v()},_toggleItemsEventRaising:function(e,t){var s=this._options.view,i=this._currentItems;if(!i)if(r.instanceOfMixin(s,"SBIS3.CONTROLS/Mixins/ItemsControlMixin"))i=s._getItemsProjection();else i=s.getItems();if(t=void 0!==t?t:true,i)if(!(i.isEventRaising()===e))i.setEventRaising(e,t),this._currentItems=!e?i:null},_showMissSpell:function(e){var t=this._getMissSpell();t.setCaption(e),t.show()},_hideMissSpell:function(){if(this._missSpell)this._getMissSpell().hide()},_getMissSpell:function(){if(!this._missSpell){var e=this;this._missSpell=new n({element:document.createElement("div"),parent:this._options.view,handlers:{onReady:function(){this._container.insertBefore(e._options.view.getContainer())},onActivated:function(t,s){e._missSpellUsed=true,e._missSpell.hide(),e._options.textBox.setText(s),e._options.textBox.applySearch()}}})}return this._missSpell},destroy:function(){if(this._timer)this._timer.stop(),this._timer=null;if(this._missSpell)this._missSpell.destroy(),this._missSpell=null;this._toggleViewEvents(false),this._onViewDataLoadHandler=null,this._onBeforeDataLoadHandler=null,_.superclass.destroy.call(this)}});function u(e,s){var n,a;if(e&&s)if(e.length>s.length){var r=t(e,s);a=-1===r?false:[e.substr(0,r),e.substr(r),s.substr(r)]}if(a)if(a[0].length)n=s+i.process(a[1]);else n=i.process(e);else n=i.process(e);return n}return _});
//# sourceMappingURL=KbLayoutRevertObserver.js.map
define("SBIS3.CONTROLS/ComponentBinder/SearchController",["SBIS3.CONTROLS/Utils/KbLayoutRevert/KbLayoutRevertObserver","Core/constants","Core/core-clone","Core/core-merge","Core/Abstract","Core/core-instance","Core/helpers/Hcontrol/isElementVisible"],function(e,t,o,i,s,r,a){return s.extend({$protected:{_options:{view:null,searchForm:null,searchFormWithSuggest:false,searchParamName:null,searchCrumbsTpl:null,searchMode:null,doNotRespondOnReset:null,breadCrumbs:null,backButton:null,keyboardLayoutRevert:true,hierarchyViewMode:true,keyboardLayoutRevertNew:false},_kbLayoutRevertObserver:null,_firstSearch:true,_searchReload:true,_searchMode:false,_searchForm:void 0,_lastRoot:void 0,_lastDepth:null},_breakSearch:function(e){var t=this._options.searchForm;if(this._searchReload=!!e,this._firstSearch=!!e,t.getText())t.resetSearch()},_reloadView:function(e,t){e.reload(t,e.getSorting(),0,void 0,void 0,true)},_startHierSearch:function(e){var t=this._options.view.getFilter();if(!this._lastDepth&&!this._searchMode&&t["Разворот"])this._lastDepth=t["Разворот"];var s=this._options.searchParamName,r=i({"Разворот":"С разворотом",usePages:"full"},t,{preferSource:true}),a=this._options.view,n=this;function l(e,t){var o=a._getItemsProjection();if(o)o[e].apply(o,t)}if(r[s]=e,n._options.hierarchyViewMode){if(a._options.hierarchyViewMode=true,a._virtualScrollController)a._virtualScrollController.disableScrollHandler(true),a._options.virtualScrolling=false}else a.setExpand(true);if(a.setHighlightText(e,false),a.setHighlightEnabled(true),void 0==n._isInfiniteScroll)n._isInfiniteScroll=a.isInfiniteScroll();if(a.setInfiniteScroll(true,true),this._firstSearch)if(this._lastRoot=a.getCurrentRoot(),this._options.breadCrumbs&&this._options.breadCrumbs.getItems())this._pathDSRawData=o(this._options.breadCrumbs.getItems().getRawData());if(this._firstSearch=false,this._searchReload=true,"root"==this._options.searchMode)r[a.getParentProperty()]=void 0;a.once("onDataLoad",function(){var e=a._getItemsProjection()&&a._getItemsProjection().isEventRaising(),t;if(n._options.backButton)n._options.backButton.getContainer().css({display:"none"});if(n._options.breadCrumbs)n._options.breadCrumbs.getContainer().css({display:"none"});if("root"===n._options.searchMode){if(t=void 0!==a._options.root?a._options.root:null,e)l("setEventRaising",[false]);if(l("setRoot",[t]),a._options.currentRoot=t,e)l("setEventRaising",[true])}}),a.once("onDrawItems",function(){if(n._searchMode&&n._options.hierarchyViewMode)a.getContainer().addClass("controls-GridView__searchMode")}),this._reloadView(a,r),this._searchMode=true},_startSearch:function(e){var t=this._options.searchParamName,o=this._options.view,s=i({usePages:"full"},o.getFilter(),{preferSource:true});s[t]=e,o.setHighlightText(e,false),o.setHighlightEnabled(true),o.setInfiniteScroll(true,true),this._reloadView(o,s)},_resetSearch:function(){var e=this._options.view,t=e.getFilter();delete t[this._options.searchParamName],this._reloadView(e,t)},_resetGroup:function(){var e=this._options.view,t=o(e.getFilter()),i=this,s=function(){e._getItemsProjection().setRoot(i._lastRoot||e.getRoot()||null)},r=function(){if(e._options.currentRoot=i._lastRoot||e.getRoot()||null,e._getItemsProjection())s();else e.once("onItemsReady",function(){s()})};if(this._lastDepth)t["Разворот"]=this._lastDepth;else delete t["Разворот"];if(this._lastDepth=null,delete t[this._options.searchParamName],e.once("onDataLoad",function(){e._container.removeClass("controls-GridView__searchMode"),r()}),this._searchMode=false,this._options.hierarchyViewMode){if(e._options.hierarchyViewMode=false,e._virtualScrollController)e._options.virtualScrolling=true,e._virtualScrollController.updateProjection(e._getItemsProjection()),e._virtualScrollController.reset()}else e.setExpand(false),e._options.openedPath={};if(this._firstSearch)return;if(e.setInfiniteScroll(this._isInfiniteScroll,true),this._isInfiniteScroll=void 0,this._firstSearch=true,this._searchReload)t[e.getParentProperty()]=this._lastRoot,e.once("onDataLoad",function(){if(i._path=i._pathDSRawData||[],i._options.breadCrumbs)i._options.breadCrumbs.getContainer().css({display:""}),i._options.breadCrumbs._redraw();if(i._options.backButton)i._options.backButton.getContainer().css({display:""})}),this._reloadView(e,t);else e.setFilter(t,true)},bindSearch:function(){var t=this,o=this._options.view,i=r.instanceOfMixin(o,"SBIS3.CONTROLS/Mixins/TreeMixin"),s=this._options.searchForm;if(!this._kbLayoutRevertObserver)this._kbLayoutRevertObserver=new e({textBox:s,view:o,param:this._options.searchParamName,newStandart:t._options.keyboardLayoutRevertNew});else this._kbLayoutRevertObserver.setParam(this._options.searchParamName);if(i)this._lastRoot=o.getCurrentRoot(),o.subscribe("onBeforeSetRoot",function(e,o){if(t._lastRoot=o,t._searchMode)t._breakSearch(false)}),o.subscribe("onSetRoot",function(e,o,i){if(!t._searchMode){if(t._lastRoot=o,t._options.breadCrumbs&&t._options.breadCrumbs.getItems()){var s=t._options.breadCrumbs.getItems();t._pathDSRawData=s?s.getRawData():[],t._options.breadCrumbs.getContainer().css({display:""})}if(t._options.backButton)t._options.backButton.getContainer().css({display:""})}});if(this._subscribeOnSearchFormEvents(),s.getText())s.applySearch(false)},_subscribeOnSearchFormEvents:function(){var e=this._options.searchForm,o=this._options.view,i=this,s=r.instanceOfMixin(o,"SBIS3.CONTROLS/Mixins/TreeMixin");if(e.subscribe("onReset",function(){o.setHighlightText("",false),o.setHighlightEnabled(false),i._kbLayoutRevertObserver.stopObserve()}),!this._options.doNotRespondOnReset)e.subscribe("onReset",function(){if(s)i._resetGroup();else i._resetSearch()});e.subscribe("onSearch",function(t,r,a){if(e.getProperty("usePicker")&&r)if(!i._options.searchFormWithSuggest&&(!a||e.isPickerVisible())||i._options.searchFormWithSuggest&&a)return;if(i._options.keyboardLayoutRevert){if(o.isLoading())i._kbLayoutRevertObserver.stopObserve();i._kbLayoutRevertObserver.startObserve()}if(s)i._startHierSearch(r);else i._startSearch(r)}),e.subscribe("onKeyPressed",function(e,s){if(!a(o.getContainer()))return;if(s.which==t.key.down&&(""===this.getText()||this.getText().length===this._inputField[0].selectionStart)){var r=null,n=o._getItemsProjection();if(i._searchMode&&n.at(0).isNode)n.each(function(e,t){if(!r&&!e.isNode())r=t}),o.setSelectedIndex(r);else if(r=o.getSelectedIndex(),null===r)o.setSelectedIndex(0);else o.setSelectedIndex(r+1);o.setActive(true),s.stopPropagation(),s.preventDefault()}})},setSearchParamName:function(e){this._options.searchParamName=e}})});
//# sourceMappingURL=SearchController.js.map
define("SBIS3.CONTROLS/ComponentBinder/ScrollPagingController",["Core/Abstract","Core/core-instance","Core/WindowManager","Core/helpers/Function/throttle","Core/helpers/Hcontrol/isElementVisible","Core/detection","Core/helpers/Function/runDelayed","Core/helpers/Function/forAliveOnly","css!SBIS3.CONTROLS/ComponentBinder/ScrollPagingController"],function(e,t,i,n,o,s,r,l){var g=200,a={updatePaging:function(){var e=this._options.view,t;if(o(e.getContainer())){this._updateCachedSizes();var i=this._viewportHeight?Math.ceil(this._viewHeight/this._viewportHeight):0,n=e._getOption("infiniteScroll");if(t=i>1&&"up"!==n&&"both"!==n,e.getContainer().toggleClass("controls-ScrollPaging__pagesPadding",t),this._options.paging.getSelectedKey()>i)this._options.paging.setSelectedKey(i)}else t=false;if(t)this._options.paging.setPagesCount(i+(e._hasNextPage(e.getItems().getMetaData().more,e._scrollOffset.bottom,"after")?1:0));else this._options.paging.setPagesCount(1);this._options.paging.setVisible(t&&!this._options.hiddenPager)}},h=e.extend({$protected:{_freezePaging:false,_options:{view:null,zIndex:null},_viewHeight:0,_viewportHeight:0,_currentScrollPage:1,_windowResizeTimeout:null,_zIndex:null},init:function(){h.superclass.init.apply(this,arguments),this._options.paging.getContainer().css("z-index",this._options.zIndex||i.acquireZIndex()),this._options.paging._zIndex=this._options.zIndex,i.setVisible(this._options.zIndex),this._containerOffset=this._getViewportOffset(),this._scrollHandler=n.call(this,this._scrollHandler.bind(this),g,true)},_getViewportOffset:function(){var e=this._options.view._getScrollWatcher().getScrollContainer();if(e[0]==window)return 0;else return e.offset().top},bindScrollPaging:function(e){var i=this._options.view,n=t.instanceOfMixin(i,"SBIS3.CONTROLS/Mixins/TreeMixin");if(e=e||this._options.paging,n)i.subscribe("onSetRoot",this._changeRootHandler.bind(this)),i.subscribe("onNodeExpand",function(){this.updatePaging(true)}.bind(this));e.subscribe("onFirstPageSet",this._scrollToFirstPage.bind(this)),e.subscribe("onLastPageSet",this._scrollToLastPage.bind(this)).subscribe("onSelectedItemChange",this._pagingSelectedChange.bind(this)),i._getScrollWatcher().subscribe("onScroll",this._scrollHandler),$(window).on("resize.wsScrollPaging",this._resizeHandler.bind(this))},_changeRootHandler:function(){var e=this._options.view.getCurrentRoot();this._options.paging.setSelectedKey(1),this._options.paging.setPagesCount(1),this._currentScrollPage=1,this.updatePaging(true)},_scrollHandler:function(e,t){if(!this._freezePaging){var i=t/this._viewportHeight,n=this._options.paging,o=n.getPagesCount();if(i%1)i=Math.ceil(i);if(i+=1,this._currentScrollPage!==i)this._currentScrollPage=i,n.setSelectedKey(i>o?o:i)}},_pagingSelectedChange:function(e,t,i){var n=this._viewportHeight*(t-1);if(this._currentScrollPage!==t)this._currentScrollPage=t,this._options.view._getScrollWatcher().scrollTo(n)},_scrollToLastPage:function(){this._options.view.setPage(-1)},_scrollToFirstPage:function(){this._options.view.setPage(0)},_isPageStartVisisble:function(e){var t;if(0===e.element.parents("html").length)return false;if(this._options.view._getScrollWatcher().getScrollContainer()[0]==window)t=e.element[0].getBoundingClientRect().bottom;else t=e.element.offset().top+e.element.outerHeight(true)-this._containerOffset;return t>=0},_resizeHandler:function(){var e=$(window).height();if(clearTimeout(this._windowResizeTimeout),this._windowHeight!=e)this._windowHeight=e,this._windowResizeTimeout=setTimeout(function(){this.updatePaging(true)}.bind(this),200)},getScrollPage:function(){return this._currentScrollPage},getPagesCount:function(){return this._options.paging.getPagesCount()},updatePaging:function(){r(l(a.updatePaging,this))},freezePaging:function(e){this._freezePaging=e},_updateCachedSizes:function(){var e=this._options.view,t=$(e._scrollWatcher.getScrollContainer())[0];if(this._viewHeight=t===window?document.documentElement.scrollHeight:t.scrollHeight,this._viewportHeight=t===window?t.innerHeight:t.offsetHeight,s.isIE&&this._viewHeight-this._viewportHeight<=1)this._viewHeight--},destroy:function(){this._options.view._getScrollWatcher().unsubscribe("onScroll",this._scrollHandler),clearTimeout(this._windowResizeTimeout),$(window).off("resize.wsScrollPaging"),i.releaseZIndex(this._options.zIndex),h.superclass.destroy.apply(this,arguments)}});return h});
//# sourceMappingURL=ScrollPagingController.js.map
define("SBIS3.CONTROLS/ComponentBinder/PagingController",["Core/Abstract"],function(e){return e.extend({$protected:{_options:{view:null,paging:null}},bindPaging:function(e){var t=this._options.view,n=this;(e=e||this._options.paging).subscribe("onSelectedItemChange",function(e,n){var a,i;if(n>0)if(a=n-1,i=t.getPage(),i!=a)t.setPage(a)}),t.subscribe("onPageChange",function(t,n){var a,i;if(n>=0)if(a=n+1,i=parseInt(e.getSelectedKey(),10),i!=a)e.setSelectedKey(a)}),t.subscribe("onDataLoad",function(n,a){if("part"==e.getMode()){var i=a.getMetaData&&a.getMetaData().more;if(i&&e.getSelectedKey()==e.getItems().getCount()&&t._hasNextPage(i))e.setPagesCount(e.getPagesCount()+1)}})}})});
//# sourceMappingURL=PagingController.js.map
define("SBIS3.CONTROLS/ComponentBinder/FilterController",["Core/Abstract","Core/core-merge","Core/core-clone","SBIS3.CONTROLS/Filter/HistoryController/FilterHistoryControllerUntil"],function(t,e,r,i){var n="browser.filter";return t.extend({_$filterButton:null,_$fastDataFilter:null,_$view:null,bindFilters:function(t,o,l){var u=t||this._getOption("filterButton"),f=o||this._getOption("fastDataFilter"),s=l||this._getOption("view"),a=s.getParent().getContext(),c;if(u||f){var g=function(t,e){if(t&&e&&!c)c=true,e.setFilterStructure(i.prepareStructureToApply(r(t.getFilterStructure()),e.getFilterStructure(),true)),c=false},C=function(t,i){if(i)return;if(this===u&&f)g(u,f);else if(u)g(f,u);s.setPage(0,true);var o=e(u?u.getFilter():{},f?f.getFilter():{});if(a.getValue(n))o=e(r(a.getValue(n)),o,{rec:false});a.setValue(n,o)},F=function(t,e){if("filterStructure"===e&&!c)C.call(this)},S=function(t){t.subscribe("onPropertyChanged",F)},p=function(t){t.unsubscribe("onPropertyChanged",F)};if(u&&f)g(u,f);if(u)S(u);if(f)S(f);this.once("onDestroy",function(){if(u)p(u);if(f)p(f)})}}})});
//# sourceMappingURL=FilterController.js.map
define("SBIS3.CONTROLS/ComponentBinder/DateRangeRelationController",["Core/Abstract","Core/helpers/date-helpers"],function(t,e){return t.extend({$protected:{_options:{dateRanges:null,step:null,onlyByCapacity:false,showLock:null,lockButton:null},_updating:false,_steps:[]},bindDateRanges:function(){var t=arguments.length?arguments:this._options.dateRanges,e;if(this._options.lockButton)this._options.lockButton.setChecked(!this._options.onlyByCapacity),this._options.lockButton.subscribe("onCheckedChange",this._onLockedChanged.bind(this,-1));for(e=0;e<t.length;e++)t[e].subscribe("onRangeChange",this._onRangeChanged.bind(this,e)),t[e].subscribe("onLockedChanged",this._onLockedChanged.bind(this,e));if(this._updateSteps(true),"boolean"===typeof this._options.showLock)for(e=0;e<t.length;e++)t[e].setLocked(!this._options.onlyByCapacity),t[e].setShowLock(this._options.showLock);this._updateControls(0)},_onRangeChanged:function(t,e,n,i,o,s){this._updateControls(t,n,i,o,s)},_onLockedChanged:function(t,e,n){if(this._updatingLock)return;this._updateLocked(t,n),this._updateSteps(n),this._options.onlyByCapacity=!n},_updateLocked:function(t,e){var n=this._options.dateRanges,i;if(this._updatingLock)return;if(this._updatingLock=true,this._options.lockButton)this._options.lockButton.setChecked(e);for(i=0;i<n.length;i++)if(i!==t)n[i].setLocked(e);this._updatingLock=false},_updateSteps:function(t){var e=this._options.dateRanges;if(t)for(var n=0;n<e.length-1;n++)this._steps[n]=this._getMonthCount(e[n].getStartValue(),e[n+1].getStartValue())},_updateControls:function(t,n,i,o,s){var a,h,l,p,u,r,g,d,_,c,f=function(t){var e=this._options.onlyByCapacity?l:this._steps[t]||l;if(e<l)e=l;return e}.bind(this);if(this._updating)return;if(this._updating=true,a=this._options.dateRanges[t],n=n||a.getStartValue(),i=i||a.getEndValue(),o=o||a.getStartValue(),s=s||a.getEndValue(),!n||!i)return void(this._updating=false);if(h=e.getPeriodType(n,i),l=e.getPeriodLengthInMonthByType(h),p=o&&s?e.getPeriodType(o,s):null,u=p?e.getPeriodLengthInMonthByType(p):null,g=p!==h,!l)return void(this._updating=false);if(this._autoRelation(t,g),g&&!this._options.onlyByCapacity&&(this._options.step&&u&&l>u||!this._options.step))this._resetSteps();for(_=n,r=0,c=1;c<=t;c++){if(r+=f(t-c),d=this._options.dateRanges[t-c],this._options.onlyByCapacity&&!g&&_>d.getEndValue())break;d.setRange(this._slideStartDate(n,-r),this._slideEndDate(n,-r+l-1)),_=d.getStartValue()}for(_=i,r=0,c=1;c<this._options.dateRanges.length-t;c++){if(r+=f(t+c-1),d=this._options.dateRanges[t+c],this._options.onlyByCapacity&&!g&&_<d.getStartValue())break;d.setRange(this._slideStartDate(n,r),this._slideEndDate(n,r+l-1)),_=d.getEndValue()}this._updating=false,this._notify("onDatesChange")},_autoRelation:function(t,n){if(!this._options.onlyByCapacity)return;if(n)this._options.onlyByCapacity=false,this._updateLocked(-1,true);if(this._options.dateRanges.length>2)return;var i=this._options.dateRanges[t],o=i.getStartValue(),s=i.getEndValue(),a=e.getPeriodType(o,s),h=function(t){var n=this._options.dateRanges[t],i=n.getStartValue(),s=n.getEndValue(),h=e.getPeriodType(i,s);if(a===h&&o.getFullYear()!==i.getFullYear()&&o.getMonth()===i.getMonth()&&o.getDate()===i.getDate())this._options.onlyByCapacity=false,this._updateLocked(-1,true),this._resetSteps(12*Math.abs(o.getFullYear()-i.getFullYear()))}.bind(this);if(t<this._options.dateRanges.length-1)h(t+1);if(this._options.onlyByCapacity&&t>0)h(t-1)},_resetSteps:function(t){this._steps=[];for(var e=0;e<this._options.dateRanges.length-1;e++)this._steps.push(t||this._options.step)},_slideStartDate:function(t,e){return new Date(t.getFullYear(),t.getMonth()+e,1)},_slideEndDate:function(t,e){return new Date(t.getFullYear(),t.getMonth()+e+1,0)},_getMonthCount:function(t,e){return 12*e.getFullYear()+e.getMonth()-12*t.getFullYear()-t.getMonth()}})});
//# sourceMappingURL=DateRangeRelationController.js.map
define("SBIS3.CONTROLS/ComponentBinder/BreadCrumbsController",["Core/constants","Core/Abstract","Core/core-clone"],function(t,o,e){return o.extend({$protected:{_options:{view:null,breadCrumbs:null,backButton:null,backButtonTemplate:null},_currentRoot:null,_pathDSRawData:[],_path:[]},_createBreadCrumb:function(t){var o={},e=this._options.breadCrumbs;return o[e._options.displayProperty]=t.title,o[e._options.idProperty]=t.id,o[e._options.colorField]=t.color,o.data=t.data,o},_setPreviousRoot:function(){var t=this._path[this._path.length-1],o=this._options.view,e=this._options.breadCrumbs.getItems().getIdProperty();if(null!==this._currentRoot){if(this._currentRoot=t,this._path.length)this._path.splice(this._path.length-1);o.setCurrentRoot(t?t[e]:null)}o.reload()},bindBreadCrumbs:function(o,r){var n=this,s=this._options.view,a=s.getCurrentRoot(),u=s.getItems();r=r||this._options.backButton,o=o||this._options.breadCrumbs;function c(t){var e={};return e[o._options.displayProperty]=t.title,e[o._options.idProperty]=t.id,e[o._options.colorField]=t.color,e.data=t.data,e}function h(){var t=n._path[n._path.length-1];if(null!==n._currentRoot){if(n._currentRoot=t,n._path.length)n._path.splice(n._path.length-1);s.setCurrentRoot(t?t[o._options.idProperty]:null)}s.reload()}function _(t,a){var u=e(a);if(!n._searchMode){var h=u[u.length-1],_;if(n._currentRoot&&u.length&&h.parent!=n._currentRoot.id)n._currentRoot=u[0],n._path=u.reverse();else{if(t===s._options.root||!s._options.root&&null===t)n._currentRoot=null,n._path=[];for(i=u.length-1;i>=0;i--){var l=u[i];if(l){var p=c(l);if(n._currentRoot&&!Object.isEmpty(n._currentRoot))n._path.push(n._currentRoot);n._currentRoot=p}}}for(i=0;i<n._path.length;i++)if(n._path[i].id==t){n._path.splice(i,n._path.length-i);break}if(o.setItems(n._path.reduce(function(t,o){return t.push(c(o)),t},[])),!r.isDestroyed()){if(n._options.backButtonTemplate&&n._currentRoot)_=n._options.backButtonTemplate(n._currentRoot.data);else _=n._currentRoot?n._currentRoot.title:"";r.setCaption(_)}}}if(null!==a&&a!==s.getRoot()&&u)_(a,s.getHierarchy(u.getMetaData().path,a));this.subscribeTo(s,"onSetRoot",function(t,o,e){_(o,e)}),this.subscribeTo(s,"onKeyPressed",function(o,e){if(e.which===t.key.backspace)h(),e.preventDefault()}),this.subscribeTo(o,"onItemClick",function(t,o){if(n._currentRoot=this.getItems().getRecordById(o),n._currentRoot=n._currentRoot?n._currentRoot.getRawData():null,null===o)n._path=[];s.setCurrentRoot(o),s.reload()}),this.subscribeTo(r,"onActivated",function(){h()})},setPath:function(t){if(this._path=t,t.length)this._currentRoot=this._path.pop();else this._currentRoot={};this._options.breadCrumbs.setItems(this._path||[]),this._options.backButton.setCaption(this._currentRoot.title||"")},getCurrentRootRecord:function(){return this._currentRoot?this._currentRoot.data:null}})});
//# sourceMappingURL=BreadCrumbsController.js.map
define("SBIS3.CONTROLS/ComponentBinder",["Core/Abstract","SBIS3.CONTROLS/History/HistoryController","SBIS3.CONTROLS/ComponentBinder/SearchController","SBIS3.CONTROLS/ComponentBinder/ScrollPagingController","SBIS3.CONTROLS/ComponentBinder/PagingController","SBIS3.CONTROLS/ComponentBinder/BreadCrumbsController","SBIS3.CONTROLS/Filter/HistoryController","SBIS3.CONTROLS/Filter/HistoryController/FilterHistoryControllerUntil","SBIS3.CONTROLS/ComponentBinder/DateRangeRelationController","SBIS3.CONTROLS/ComponentBinder/FilterController","Core/core-instance","Core/helpers/Function/forAliveOnly","Core/helpers/Object/find","Core/Deferred","Core/UserConfig"],function(t,e,r,o,i,n,l,s,a,C,g,h,u,d,c){function f(t,e,r){if(e.getContainer().toggleClass("controls-ListView__showCheckBoxes",t),r)e.toggleCheckboxes(t);if(void 0!==e._options.startScrollColumn)e.updateScrollAndColumns();if(g.instanceOfModule(e,"SBIS3.CONTROLS/Tree/DataGridView"))e._updateEditArrow()}function _(t,e){var r=t.getItemsInstances();for(var o in r)if(r.hasOwnProperty(o))if("function"==typeof r[o].setLinkedView)r[o].setLinkedView(e);else r[o]._options.linkedView=e}var p=t.extend({$protected:{_options:{view:void 0,breadCrumbs:void 0,backButton:void 0,searchForm:void 0,operationPanel:void 0,filterButton:void 0,paging:void 0,dateRanges:void 0},_historyController:null,_searchController:null,_scrollPagingController:null,_pagingController:null,_breadCrumbsController:null,_filterHistoryController:null,_pagingHistoryController:null,_dateRangeRelationController:null,_filterController:null},setPath:function(t){if(this._breadCrumbsController)this._breadCrumbsController.setPath(t)},getCurrentRootRecord:function(){if(this._breadCrumbsController)return this._breadCrumbsController.getCurrentRootRecord();else return null},bindSearchGrid:function(t,e,o,i,n,l,s){if(!this._searchController){var a;if(t instanceof Object)a=t;else a={searchParamName:t,searchCrumbsTpl:e,searchMode:i,doNotRespondOnReset:n};a.view=this._options.view,a.searchForm=o||this._options.searchForm,a.breadCrumbs=this._options.breadCrumbs,a.backButton=this._options.backButton,a.keyboardLayoutRevert=void 0===l?true:l,a.hierarchyViewMode=void 0===s?true:s,this._searchController=new r(a)}this._searchController.bindSearch()},bindSearchComposite:function(){this.bindSearchGrid.apply(this,arguments)},bindBreadCrumbs:function(t,e,r){if(!this._breadCrumbsController)this._breadCrumbsController=new n({view:this._options.view,breadCrumbs:t||this._options.breadCrumbs,backButton:e||this._options.backButton,backButtonTemplate:r||this._options.backButtonTemplate});this._breadCrumbsController.bindBreadCrumbs(t,e)},bindOperationPanel:function(t,e){var r=this._options.view;(e=e||this._options.operationPanel).subscribe("onDrawItems",function(){_(e,r)}),_(e,r),f(e.isVisible(),r,t),r.subscribe("onSelectedItemsChange",function(t,r){if(r.length&&!e.isVisible())e.show();e.onSelectedItemsChange(r)}),e.subscribe("onToggle",function(){var o=e.isVisible();if(f(o,r,t),t&&!o)r.removeItemsSelectionAll()})},bindFilters:function(t,e,r){var o=this;if(!this._filterController)this._filterController=new C({view:r,filterButton:t,fastDataFilter:e});(this._dFiltersReady||d.success()).addCallback(h(function(t){return o._filterController.bindFilters(),t},r))},bindFilterHistory:function(t,e,r,o,i,n,a,C,g){var f=["Разворот","ВидДерева"],_=C&&o?c.getParam(o):d.success(),p=this,b=a&&a._hasOption("filterButtonConfig")&&u(a._getOptions().bindings,function(t){return t.propName&&-1!==t.propName.indexOf("filterButtonConfig")}),y,S,m;if(this._dFiltersReady=_,a)y=a.getView();if(r)f.push(r);if(i&&i.length)f=f.concat(i);if(this._filterHistoryController)this._filterHistoryController.destroy();_.addCallback(function(r){var C=[];if(g&&y)C.push(y.getParentProperty());if(p._filterHistoryController=new l({historyId:o,filterButton:t,fastDataFilter:e,view:y,noSaveFilters:f,filtersForHistory:C}),t.setHistoryController(p._filterHistoryController),n)if(S=p._filterHistoryController.getActiveFilter(),S){if(m=s.prepareStructureToApply(S.filter,t.getFilterStructure()),i&&i.length)s.resetStructureElementsByFilterKeys(t,m,i);if(!b)t.setFilterStructure(m)}if(a)setTimeout(h(function(){if(b&&S&&n){var e=a.getProperty("filterButtonConfig");if(e.filterStructure=m,a.setFilterButtonConfig(e),!y.isLoading()&&(!y.getItems()||!y.getItems().getCount()))t.applyFilter()}a._notifyOnFiltersReady()},y),0);return r})},bindPagingHistory:function(t,r){this._pagingHistoryController=new e({historyId:r});var o=this._pagingHistoryController.getHistory();if(o)t.setPageSize(o,true);var i=this;t.subscribe("onPageSizeChange",function(t,e){i._pagingHistoryController.setHistory(e,true)})},bindPaging:function(t){if(!this._pagingController)this._pagingController=new i({view:this._options.view,paging:t||this._options.paging})},_updateScrollPages:function(t){if(this._scrollPagingController)this._scrollPagingController.updatePaging(t)},_getScrollPage:function(){if(this._scrollPagingController)return this._scrollPagingController.getScrollPage()},bindScrollPaging:function(t,e){if(!this._scrollPagingController)this._scrollPagingController=new o({view:this._options.view,paging:t||this._options.paging,zIndex:this._options.pagingZIndex,hiddenPager:e});this._scrollPagingController.bindScrollPaging()},freezePaging:function(t){this._scrollPagingController.freezePaging(t)},bindDateRanges:function(t,e,r,o,i){if(!this._dateRangeRelationController)this._dateRangeRelationController=new a({dateRanges:t||this._options.dateRanges,step:e,showLock:r,onlyByCapacity:o,lockButton:i}),this._dateRangeRelationController.subscribe("onDatesChange",function(){this._notify("onDatesChange")}.bind(this));this._dateRangeRelationController.bindDateRanges()},destroy:function(){if(this._historyController)this._historyController.destroy(),this._historyController=null;if(this._searchController)this._searchController.destroy(),this._searchController=null;if(this._scrollPagingController)this._scrollPagingController.destroy(),this._scrollPagingController=null;if(this._pagingController)this._pagingController.destroy(),this._pagingController=null;if(this._breadCrumbsController)this._breadCrumbsController.destroy(),this._breadCrumbsController=null;if(this._filterHistoryController)this._filterHistoryController.destroy(),this._filterHistoryController=null;if(this._pagingHistoryController)this._pagingHistoryController.destroy(),this._pagingHistoryController=null;if(this._dateRangeRelationController)this._dateRangeRelationController.destroy(),this._dateRangeRelationController=null;p.superclass.destroy.call(this)}});return p});
//# sourceMappingURL=ComponentBinder.js.map
define("SBIS3.CONTROLS/ListView",["SBIS3.CONTROLS/Utils/ConfigByClasses","Core/core-merge","Core/core-clone","Core/helpers/Function/shallowClone","Core/CommandDispatcher","Core/constants","Core/Deferred","Core/IoC","Core/helpers/String/format","Lib/Control/CompoundControl/CompoundControl","Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager","SBIS3.CONTROLS/Mixins/ItemsControlMixin","SBIS3.CONTROLS/Mixins/MultiSelectable","WS.Data/Query/Query","WS.Data/Entity/Record","SBIS3.CONTROLS/Mixins/Selectable","SBIS3.CONTROLS/Mixins/DataBindMixin","SBIS3.CONTROLS/Mixins/DecorableMixin","SBIS3.CONTROLS/Mixins/DragNDropMixin","SBIS3.CONTROLS/Mixins/FormWidgetMixin","Lib/Mixins/BreakClickBySelectMixin","SBIS3.CONTROLS/ListView/resources/ItemsToolbar/ItemsToolbar","tmpl!SBIS3.CONTROLS/ListView/ListView","SBIS3.CONTROLS/Utils/TemplateUtil","SBIS3.CONTROLS/ListView/resources/CommonHandlers","SBIS3.CONTROLS/Utils/ImitateEvents","Lib/LayoutManager/LayoutManager","Core/helpers/markup-helpers","SBIS3.CONTROLS/Utils/ScrollWatcher","WS.Data/Collection/IBind","tmpl!SBIS3.CONTROLS/ListView/resources/ListViewGroupBy","tmpl!SBIS3.CONTROLS/ListView/resources/ItemTemplate","tmpl!SBIS3.CONTROLS/ListView/resources/ItemContentTemplate","tmpl!SBIS3.CONTROLS/ListView/resources/GroupTemplate","browser!SBIS3.CONTROLS/Utils/InformationPopupManager","SBIS3.CONTROLS/Paging","SBIS3.CONTROLS/ComponentBinder","WS.Data/Di","SBIS3.CONTROLS/Utils/ArraySimpleValuesUtil","Core/core-instance","Core/LocalStorageNative","Core/helpers/Function/forAliveOnly","Core/helpers/Function/memoize","Core/helpers/Hcontrol/isElementVisible","SBIS3.CONTROLS/Utils/Contains","SBIS3.CONTROLS/Controllers/CursorListNavigation","WS.Data/Source/SbisService","Core/detection","SBIS3.CONTROLS/ListView/resources/Mover","Core/helpers/Function/throttle","Core/helpers/Object/isEmpty","Core/Sanitize","Core/WindowManager","SBIS3.CONTROLS/ListView/resources/VirtualScrollController","SBIS3.CONTROLS/ListView/resources/DragMove/DragMove","Core/helpers/Function/once","SBIS3.CONTROLS/Link","browser!SBIS3.CONTROLS/ListView/resources/SwipeHandlers","WS.Data/Collection/RecordSet","i18n!SBIS3.CONTROLS/ListView","WS.Data/MoveStrategy/Base","css!SBIS3.CONTROLS/ListView/ListView","css!SBIS3.CONTROLS/ListView/resources/ItemActionsGroup/ItemActionsGroup"],function(t,e,i,o,s,n,r,a,l,h,c,d,_,g,f,u,m,p,I,S,v,C,b,y,P,w,T,E,M,L,O,D,k,B,H,A,N,R,V,x,j,W,z,F,K,G,U,q,Q,Y,Z,X,J,tt,et,it){"use strict";var ot=function(t){var e=t._buildTplArgsSt.call(this,t);return e.multiselect=t.multiselect,e.decorators=t._decorators,e.highlightText=t.highlightText,e.colorField=t.colorField,e.selectedKey=t.selectedKey,e.selectedKeys=t.selectedKeys,e.itemsHover=t.itemsHover,e.alwaysShowCheckboxes=t.alwaysShowCheckboxes,e},st=function(t,e){return e._getRecordsForRedrawSt.apply(this,arguments)},nt=".js-controls-ListView__notEditable",rt=750,at={CANCEL:"Cancel",WITHOUT_RELOAD:"WithoutReload"},lt=h.extend([p,d,S,_,u,m,I,P],{_dotTplFn:b,$protected:{_has_task1173941879Fix:true,_floatCheckBox:null,_dotItemTpl:null,_itemsContainer:null,_actsContainer:null,_onMetaDataResultsChange:null,_allowInfiniteScroll:true,_hoveredItem:{target:null,container:null,key:null,position:null,size:null},_loadingIndicator:void 0,_editInPlace:null,_createEditInPlaceDeferred:null,_pageChangeDeferred:void 0,_scrollPager:null,_pager:void 0,_pagerContainer:void 0,_previousGroupBy:void 0,_checkClickByTap:true,_keysWeHandle:[n.key.up,n.key.down,n.key.space,n.key.enter,n.key.right,n.key.left,n.key.m,n.key.o,n.key.del],_itemsToolbar:null,_notEndEditClassName:"controls-ListView__onFocusNotEndEdit",_addResultsMethod:void 0,_containerScrollHeight:void 0,_needScrollCompensation:null,_infiniteScrollState:{mode:null,reverse:false},_scrollOffset:{top:null,bottom:null},_setScrollPagerPositionThrottled:null,_updateScrollIndicatorTopThrottled:null,_removedItemsCount:false,_loadQueue:{},_loadId:0,_options:{itemsHover:true,alwaysShowCheckboxes:false,_canServerRender:true,_buildTplArgs:ot,_getRecordsForRedraw:st,_buildTplArgsLV:ot,_defaultItemTemplate:D,_defaultItemContentTemplate:k,_groupTemplate:B,_sanitize:function(t){return"string"===typeof t?X(t,{validNodes:{component:true},validAttributes:{config:true}}):t},itemTemplate:"",itemsActions:[{name:"delete",icon:"sprite:icon-16 icon-Erase icon-error",tooltip:rk("Удалить"),caption:rk("Удалить"),isMainAction:true,onActivated:function(t){this.deleteRecords(t.data("id"))}}],itemsDragNDrop:"allow",elemClickHandler:null,multiselect:false,infiniteScroll:null,infiniteScrollContainer:void 0,infiniteScrollPreloadOffset:400,showPaging:false,editMode:"",editingTemplate:void 0,resultsPosition:"none",resultsText:rk("Итого"),resultsTpl:void 0,partialPaging:true,navigation:null,scrollPaging:true,dragEntity:"dragentity.row",dragEntityList:"dragentity.list",moveStrategy:null,contextMenu:true,enabledMove:true,itemsActionsInItemContainer:false,virtualScrolling:false,linkTemplateConfig:null,useDragPlaceHolder:false,task1173941879:false},_scrollWatcher:void 0,_lastDeleteActionState:void 0,_componentBinder:null,_touchSupport:false,_editByTouch:false,_dragInitHandler:void 0,_inScrollContainerControl:false,_allowMouseMoveEvent:true,_loadingIndicatorTimer:void 0,_horisontalDragNDrop:false},$constructor:function(){var t=s;if(this._publish("onChangeHoveredItem","onItemClick","onItemActivate","onDataMerge","onItemValueChanged","onBeginEdit","onAfterBeginEdit","onEndEdit","onBeginAdd","onAfterEndEdit","onPrepareFilterOnMove","onPageChange","onBeginDelete","onEndDelete","onBeginMove","onEndMove"),this._setScrollPagerPositionThrottled=Y.call(this._setScrollPagerPosition,100,true).bind(this),this._updateScrollIndicatorTopThrottled=Y.call(this._updateScrollIndicatorTop,100,true).bind(this),this._eventProxyHdl=this._eventProxyHandler.bind(this),this._onScrollHandler=this._onScrollHandler.bind(this),this._prepareInfiniteScroll=it(this._prepareInfiniteScroll),this._toggleEventHandlers(this._container,true),this.initEditInPlace(),this._setItemsDragNDrop(this._options.itemsDragNDrop),t.declareCommand(this,"activateItem",this._activateItem),t.declareCommand(this,"beginAdd",this.beginAdd),t.declareCommand(this,"beginEdit",this.beginEdit),t.declareCommand(this,"cancelEdit",this.cancelEdit),t.declareCommand(this,"commitEdit",this.commitEdit),t.declareCommand(this,"resizeYourself",this._onResizeHandlerInner),this._isCursorNavigation())this._listNavigation=new G(this._options.navigation)},_updateItemData:function(t){t.selectedKey=this.getSelectedKey(),t.selectedKeys=this.getSelectedKeys()},getListNavigation:function(){return this._listNavigation},init:function(){if(q.isMobilePlatform&&window)requirejs(["SBIS3.CONTROLS/ListView/resources/EditInPlaceHoverController/EditInPlaceHoverController","SBIS3.CONTROLS/ListView/resources/EditInPlaceClickController/EditInPlaceClickController"]);if("string"===typeof this._options.pageSize)this._options.pageSize=1*this._options.pageSize;if(this._isSlowDrawing(this._options.easyGroup))this.setGroupBy(this._options.groupBy,false);if(this._options.scrollPaging)this._pagingZIndex=J.acquireZIndex(),J.setVisible(this._pagingZIndex);if(this._options.virtualScrolling||this._options.scrollPaging)this._getScrollWatcher().subscribe("onScroll",this._onScrollHandler);if(this.isInfiniteScroll())this._prepareInfiniteScroll();if(this.getItems()&&this._isCursorNavigation())this._listNavigation.analyzeResponseParams(this.getItems());lt.superclass.init.call(this),this._initLoadMoreButton()},setItems:function(t){if(t&&this._isCursorNavigation()&&this._listNavigation)this._listNavigation.analyzeResponseParams(t);lt.superclass.setItems.apply(this,arguments)},_initVirtualScrolling:function(){this._virtualScrollController=new tt({view:this,projection:this._getItemsProjection(),viewport:this._getScrollWatcher().getScrollContainer(),viewContainer:this.getContainer(),itemsContainer:this._getItemsContainer()}),this._topWrapper=$(".controls-ListView__virtualScrollTop",this.getContainer()),this._bottomWrapper=$(".controls-ListView__virtualScrollBottom",this.getContainer()),this.subscribeTo(this._virtualScrollController,"onWindowChange",function(t,e){for(var i=[],o=[],s,n=e.add[0];n<=e.add[1];n++)if(s=this._getItemsProjection().at(n),s)i.push(s);for(var n=e.remove[0];n<=e.remove[1];n++)if(s=this._getItemsProjection().at(n),s)o.push(s);this._addItems(i,e.addPosition),this._removeItemsLight(o),this._drawSelectedItems(this._options.selectedKeys,{}),this._topWrapper.get(0).style.height=e.topWrapperHeight+"px",this._bottomWrapper.get(0).style.height=e.bottomWrapperHeight+"px"}.bind(this))},_toggleEventHandlers:function(t,e){t[e?"on":"off"]("swipe tap mousemove mouseleave touchend taphold touchstart contextmenu mousedown mouseup",this._eventProxyHdl)},_addOptionsFromClass:function(e,i){var o=i&&i.class||e.element&&e.element.className||e.className||"";t(e,[{class:"controls-small-ListView",optionName:"isSmall",value:true,defaultValue:false},{class:"controls-ListView__disableHover",optionName:"itemsHover",value:false,defaultValue:true},{class:"controls-ListView__pagerNoSizePicker",optionName:"noSizePicker",value:true,defaultValue:false},{class:"controls-ListView__pagerNoAmount",optionName:"noPagerAmount",value:true,defaultValue:false},{class:"controls-ListView__pagerHideEndButton",optionName:"hideEndButton",value:true,defaultValue:false},{class:"controls-ListView__orangeMarker",optionName:"showSelectedMarker",value:true,defaultValue:false},{class:"controls-ListView__outside-scroll-loader",optionName:"outsideScroll",value:true,defaultValue:false},{class:"controls-ListView__showCheckboxes",optionName:"showCheckboxes",value:true,defaultValue:false},{class:"controls-ListView__hideCheckboxes",optionName:"hideCheckboxes",value:true,defaultValue:false}],o)},_prepareClassesByConfig:function(t){if(false!==t.multiselect)t.preparedClasses=" controls-ListView__multiselect";else t.preparedClasses=" controls-ListView__multiselect__off";if(t._serverRender)t.preparedClasses=" controls-ListView__dataLoaded";else t.preparedClasses=" controls-ListView__dataNotLoaded"},_modifyOptions:function(t,e,i){var o=lt.superclass._modifyOptions.apply(this,arguments);if(this._addOptionsFromClass(o,i),this._prepareClassesByConfig(o),o.hasOwnProperty("infiniteScroll"))o.infiniteScroll="boolean"===typeof o.infiniteScroll?o.infiniteScroll?"down":null:o.infiniteScroll;if(o.hasOwnProperty("itemsDragNDrop"))if("boolean"===typeof o.itemsDragNDrop)o.itemsDragNDrop=o.itemsDragNDrop?"allow":"";if(o.selectedKey&&o._itemData)o._itemData.selectedKey=o.selectedKey;return o},_getElementToFocus:function(){return $(".controls-ListView__fakeFocusElement",this._container).first()},_isAcceptKeyEvents:function(){return true},_setTouchSupport:function(t){var e=this._touchSupport;if(this._touchSupport=Boolean(t),this._itemsToolbar)this._setTouchMode(this._touchSupport);else if(e!==this._touchSupport)this._toggleTouchClass()},_setTouchMode:function(t){if(this._itemsToolbar.getProperty("touchMode")!==t&&!this._itemsToolbar.isToolbarLocking())this._toggleTouchClass(t),this._itemsToolbar.setTouchMode(t)},_toggleTouchClass:function(t){this.getContainer().toggleClass("controls-ListView__touchMode",t)},_eventProxyHandler:function(t){var e=this,i=t.originalEvent,o="controls-ListView__mobileSelected-fix",s=i?!i.movementX&&!i.movementY&&n.compatibility.touch&&(i.touches||n.browser.isMobilePlatform)||i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents:true;switch(t.type){case"mousemove":e._allowMouseMoveEvent&&!s&&this._mouseMoveHandler(t);break;case"touchstart":if(this._touchstartHandler(t),e._allowMouseMoveEvent&&!n.browser.isMobileIOS)e._allowMouseMoveEvent=false,setTimeout(function(){e._allowMouseMoveEvent=true},1e3);break;case"swipe":this._swipeHandler(t);break;case"tap":this._tapHandler(t);break;case"mouseleave":this._mouseLeaveHandler(t);break;case"touchend":this._container.addClass(o);break;case"taphold":this._container.removeClass(o);break;case"contextmenu":this._contextMenuHandler(t),this._clickState.detected=true;break;case"mousedown":this._mouseDownHandler(t);break;case"mouseup":this._mouseUpHandler(t)}},_createScrollPager:function(){var t=this._scrollWatcher.getScrollContainer(),e=$("> .controls-ListView__scrollPager",this._container);if(this._scrollPager=new A({noSizePicker:this._options.noSizePicker,noPagerAmount:this._options.noPagerAmount,element:e,visible:false,showPages:false,idProperty:"id",mode:this._options.navigation&&this._options.navigation.lastPage?"full":"part",parent:this,tabindex:0}),this._inScrollContainerControl)e.appendTo(t.parent());else if(e.addClass("controls-ListView__scrollPager_fixed"),n.browser.isMobilePlatform)t=t[0]==window||t.is("body")?$("body"):t.parent(),e.appendTo(t);this._setScrollPagerPosition(),this.subscribeTo(this,"onAfterVisibilityChange",this._onVisibleChange),this._scrollBinder=new N({view:this,pagingZIndex:this._pagingZIndex});var i=!this._options.scrollPaging&&this._options.saveReloadPosition;if(this._scrollBinder.bindScrollPaging(this._scrollPager,i),!this._inScrollContainerControl)$(window).on("resize scroll",this._setScrollPagerPositionThrottled);this._scrollBinder._updateScrollPages(!this._options.virtualScrolling||this._resetPaging)},_onVisibleChange:function(t,e){if(this._scrollPager)this._scrollPager.setVisible(e&&this._scrollPager.getPagesCount()>1);if(this._scrollBinder)this._scrollBinder.freezePaging(!e)},_onScrollHandler:function(t,e){var i;if(this.isVisible()&&i&&i.isItemActionsMenuVisible())(i=this.getItemsActions()).hide();if(this._virtualScrollController)this._virtualScrollController._scrollHandler(t,e)},_setScrollPagerPosition:function(){var t;if(!this._inScrollContainerControl)t=window.innerWidth-this.getContainer().get(0).getBoundingClientRect().right,this._scrollPager.getContainer().css("right",t)},_keyboardHover:function(t){var e,i=this.getSelectedKey(),o,s;switch(t.which){case n.key.up:s=this._getPrevItemByDOM(i);break;case n.key.down:s=this._getNextItemByDOM(i);break;case n.key.enter:if(void 0!==i&&null!==i){var r=$("[data-id='"+i+"']",this._getItemsContainer());this._elemClickHandler(i,this.getItems().getRecordById(i),r.get(0),t)}break;case n.key.space:if(s=this._getNextItemByDOM(i),!this._container.hasClass("controls-ListView__hideCheckBoxes"))this.toggleItemsSelection([i]);break;case n.key.o:if(t.ctrlKey&&t.altKey&&t.shiftKey)this.sendCommand("mergeItems",this.getSelectedKeys());break;case n.key.del:if(e=this._options.multiselect?this.getSelectedKeys():[],0===e.length&&i)e=[i];if(e.length&&this._allowDelete())this.deleteRecords(e)}if(s&&s.length)o=s.data("id"),this.setSelectedKey(o),this._scrollToItem(o,t.which===n.key.down);return false},_allowDelete:function(){var t,e=this.getItemsActions();if(e)t=e.getItemInstance("delete");return this.isEnabled()&&!!t},getNextItemById:function(t){return this._getSiblingItemById(t,"getNext")},getPrevItemById:function(t){return this._getSiblingItemById(t,"getPrevious")},_getSiblingItemById:function(t,e){var i=this._getItemsProjection(),o=i[e](i.getItemBySourceItem(this.getItems().getRecordById(t)));if(o)return this._getDomElementByItem(o)},_getNextItemByDOM:function(t){return this._getHtmlItemByDOM(t,true)},_getPrevItemByDOM:function(t){return this._getHtmlItemByDOM(t,false)},_getHtmlItemByDOM:function(t,e){var i=this._getChildrenDOMItems(),o=this.getItems(),s=o.getIndexByValue(o.getIdProperty(),t),n=this._getItemsProjection(),r=-1!==s?i.index(this._getDomElementByItem(n.getItemBySourceIndex(s))):-1,a;if(e){if(r+1<i.length)a=i.eq(r+1)}else if(false===e){if(r>0)a=i.eq(r-1)}else a=i.eq(r);if(a)return this.getItems().getRecordById(a.data("id"))?a:this._getHtmlItemByDOM(a.data("id"),e)},_getChildrenDOMItems:function(){return this._getItemsContainer().children(".js-controls-ListView__item").not(".ws-hidden, .controls-editInPlace")},_isViewElement:function(t){return K(this._getItemsContainer()[0],t[0])},_onClickHandler:function(t){lt.superclass._onClickHandler.apply(this,arguments);var e=$(t.target),i=this._findItemByElement(e),o,s;if(i.length&&this._isViewElement(i))o=this._getItemsProjection().getByHash(i.data("hash")).getContents(),this._elemClickHandler(o.getId(),o,t.target,t);if(this._options.multiselect&&e.length&&e.hasClass("controls-DataGridView__th__checkBox"))e.hasClass("controls-DataGridView__th__checkBox__checked")?this.setSelectedKeys([]):this.setSelectedItemsAll(),e.toggleClass("controls-DataGridView__th__checkBox__checked");if(this._options.groupBy&&!Z(this._options.groupBy)&&this._options.groupBy.clickHandler instanceof Function)if(e.closest(".controls-GroupBy",this._getItemsContainer()).length)this._options.groupBy.clickHandler.call(this,e);if(!Z(this._options.groupBy)&&this._options.easyGroup&&$(t.target).hasClass("controls-GroupBy__separatorCollapse")){var n=$(t.target).closest(".controls-GroupBy").attr("data-group");if(this.toggleGroup(n),e.closest(".controls-ListView").parent().hasClass("ws-sticky-header__header-container"))if(s=this._getItemsContainer().find('.controls-GroupBy[data-group="'+n+'"]'),this._isGroupCollapsed(n))this._getScrollWatcher().scrollToElement(s);else this._getScrollWatcher().scrollToElement(s.next())}},_touchstartHandler:function(){if(this._isHoverEditMode())this._editByTouch=true},_mouseMoveHandler:function(t){var e=$(t.target),i;if(i=this._findItemByElement(e),i.length){if(!this._touchSupport)this._changeHoveredItem(i)}else if(!this._isHoverControl(e))this._mouseLeaveHandler()},_getScrollContainer:function(){var t=this._scrollWatcher,e;function i(t){if(null===t)return null;if(t.scrollHeight>t.clientHeight)return t;else i(t.parentNode)}if(t)e=t.getScrollContainer();else if(e=$(i(this._container[0])),!e.length)e=n.$body;return $(e)},_changeHoveredItem:function(t){var e=t[0].getAttribute("data-id");if(void 0!==e&&this._hoveredItem.key!==e)this._updateHoveredItem(t)},_updateHoveredItem:function(t){if(this._hasHoveredItem())this.getHoveredItem().container.removeClass("controls-ListView__hoveredItem");if(this._options.itemsHover&&!t.hasClass("controls-EditAtPlace"))t.addClass("controls-ListView__hoveredItem");this._hoveredItem=this._getElementData(t),this._notifyOnChangeHoveredItem()},_updateHoveredItemAfterRedraw:function(){var t=this.getHoveredItem().container,e=this._getItemsProjection(),i,o,s;if(t){if(i=K(this._getItemsContainer()[0],t[0]),!i&&t){if(o=t.attr("data-hash"),e)s=e.getByHash(o);if(s)t=this._getDomElementByItem(s);else t=null}if(!i)if(!t||!t.length)this._mouseLeaveHandler();else this._updateHoveredItem(t);else this._updateHoveredItem(t)}else if(this._itemsToolbar&&this._itemsToolbar.isVisible())this._itemsToolbar.hide()},_getRecordElemByItem:function(t){return this._getItemsContainer().find('.js-controls-ListView__item[data-hash="'+t.getHash()+'"]:not(.controls-editInPlace)')},_getElementData:function(t){if(t.length){var e=this._container[0],i=t[0].getAttribute("data-id"),o=this.getItems()?this.getItems().getRecordById(i):void 0,s=this._options._itemsProjection?this._options._itemsProjection.getItemBySourceItem(o):null,n=t.hasClass("controls-editInPlace")&&s?this._getDomElementByItem(s):t;if(q.isIE)n.width();return{key:i,record:o,container:n,get position(){var t={top:0,left:0},i=e.getBoundingClientRect(),o=q.isIE10&&!n.width()?t:n[0].getBoundingClientRect();return{top:o.top-i.top+e.scrollTop,left:o.left-i.left}},set position(t){},get size(){var t=n[0].getBoundingClientRect();return{height:t.height,width:t.width}},set size(t){}}}},_notifyOnChangeHoveredItem:function(){this._notify("onChangeHoveredItem",this._hoveredItem),this._onChangeHoveredItem(this._hoveredItem)},_isHoverControl:function(t){var e=this._itemsToolbar&&this._itemsToolbar.getContainer();return e&&(e[0]===t[0]||$.contains(e[0],t[0]))},_mouseLeaveHandler:function(){var t=this.getHoveredItem(),e;if(t&&null===t.container)return;e=this._clearHoveredItem(),this._notify("onChangeHoveredItem",e),this._onChangeHoveredItem(e)},_onChangeHoveredItem:function(t){var e;if(this._isSupportedItemsToolbar())if(t.container){if(!this._touchSupport)if(this._showItemsToolbar(t),this._itemsToolbar.getTouchMode())this._itemsToolbar.setHeightInTouchMode();if(e=this.getItemsActions(),e)if(e.isVisible())e.applyItemActions()}else this._hideItemsToolbar()},_contextMenuHandler:function(t){var e=this.getItemsActions(),i={verticalAlign:{side:"top",offset:t.pageY},horizontalAlign:{side:"left",offset:t.pageX}};if(this._needShowContextMenu(t)){if(!this._checkItemAction())t.preventDefault(),e.showItemActionsMenu(i);else a.resolve("ILogger").info("ItemActionsGroup:","Опция caption не задана у одного из элементов, для отображения контекстного меню укажите опцию");this._hoveredItem&&this._hoveredItem.container&&t.stopPropagation()}},_needShowContextMenu:function(t){var e=this.getItemsActions();return this._options.contextMenu&&e&&e.hasVisibleActions()&&this._needProcessMouseEvent(t)&&this._hoveredItem&&this._hoveredItem.container&&!this._hoveredItem.container.hasClass("controls-editInPlace__editing")&&"false"!==j.getItem("controls-ListView-contextMenu")&&"a"!==t.target.nodeName.toLowerCase()&&-1===t.target.className.indexOf("LinkDecorator__image")},_checkItemAction:function(){var t=false;return this.getItemsActions().getItems().each(function(e){if(!e.get("caption"))t=true}),t},_mouseDownHandler:function(t){if(this._itemsToolbar&&2===t.button){var e=this.getItemsActions();if(e&&e.isItemActionsMenuVisible())this._itemsToolbar.getContainer().addClass("controls-ItemsToolbar__hidden")}},_mouseUpHandler:function(t){if(this._itemsToolbar&&2===t.button)this._itemsToolbar.getContainer().removeClass("controls-ItemsToolbar__hidden")},setEmptyHTML:function(t){lt.superclass.setEmptyHTML.apply(this,arguments),this._getEmptyDataContainer().empty().html(X(t,{validNodes:{component:true},validAttributes:{config:true}})),this._reviveItems(false,true),this._toggleEmptyData(this._getItemsProjection()&&!this._getItemsProjection().getCount())},_getEmptyDataContainer:function(){return $("> .controls-ListView__EmptyData",this._container.get(0))},setMultiselect:function(t){lt.superclass.setMultiselect.apply(this,arguments),this.getContainer().toggleClass("controls-ListView__multiselect",t).toggleClass("controls-ListView__multiselect__off",!t)},setItemTemplate:function(t){this._options.itemTemplate=t},_getItemsContainer:function(){return $(".controls-ListView__itemsContainer",this._container.get(0)).first()},_getItemContainer:function(t,e){return t.find('>[data-id="'+e.getId()+'"]:not(".controls-editInPlace")')},_addItemAttributes:function(t){t.addClass("js-controls-ListView__item"),lt.superclass._addItemAttributes.apply(this,arguments)},_elemClickHandler:function(t,e,i,o){var s=$(i),n=this,a=this._options.elemClickHandler,l=true,h=W(function(s){if(false!==s){if(l)if("append"==this._options.loadItemsStrategy){var r=this._findItemByElement($(i));if(r.length){var h=r.attr("data-hash"),c=this._getItemsProjection().getIndex(this._getItemsProjection().getByHash(h));n.setSelectedIndex(c)}}else n.setSelectedKey(t);n._elemClickHandlerInternal(e,t,i,o),a&&a.call(n,t,e,i,o)}},this),c;if(this._options.multiselect)if(s.hasClass("js-controls-ListView__itemCheckBox")){if(this._isItemSelected(t))l=false;this._onCheckBoxClick(s)}else c=this._notifyOnItemClick(t,e,i,o);else c=this._notifyOnItemClick(t,e,i,o);if(c instanceof r)c.addCallback(function(t){return h(t),t});else h(c)},_notifyOnItemClick:function(t,e,i,o){return this._notify("onItemClick",t,e,i,o)},_onCheckBoxClick:function(t){this.toggleItemsSelection([this._getItemsProjection().getByHash(t.closest(".controls-ListView__item").attr("data-hash")).getContents().getId()])},_elemClickHandlerInternal:function(t,e,i,o){if(!$(i).hasClass("js-controls-ListView__itemCheckBox"))this._activateItem(e)},setSelectedAll:function(){var t=1e3,e,i=this.getSelectedItems();if(this.isInfiniteScroll()&&this.getItems().getCount()<t&&this.getItems().getMetaData().more)e=this._loadFullData.apply(this,arguments).addCallback(function(e){if(this._limit=this._options.pageSize,this._scrollOffset.bottom=t-this._limit,i&&i.getCount())i.clear();if(this.setSelectedItemsAll.call(this),e.getCount()==t&&e.getMetaData().more)H.showMessageDialog({status:"default",opener:this,message:rk("Отмечено 1000 записей, максимально допустимое количество, обрабатываемое системой СБИС.")})}.bind(this));else this.setSelectedItemsAll.call(this),e=r.success();return e},_loadFullData:function(){return this.reload(this.getFilter(),this.getSorting(),0,1e3)},_drawSelectedItems:function(t,e){function i(t,e,i){var s=$([]),n;for(o=0;o<t.length;o++){if((t[o]+"").indexOf("'")<0)n=e.children(".controls-ListView__item[data-id='"+t[o]+"']");else n=e.children('.controls-ListView__item[data-id="'+t[o]+'"]');if(n.length)if("append"==i.loadItemsStrategy)n.each(function(t,e){s.push(e)});else s.push(n.get(0));else{if((t[o]+"").indexOf("'")<0)n=e.find(".controls-ListView__item[data-id='"+t[o]+"']");else n=e.find('.controls-ListView__item[data-id="'+t[o]+'"]');if(n.length)s.push(n.get(0))}}return s}var o,s=this._getItemsContainer();if(e&&!Z(e)){var n,r;r=i(e.added,s,this._options),n=i(e.removed,s,this._options),r.addClass("controls-ListView__item__multiSelected"),n.removeClass("controls-ListView__item__multiSelected")}else{var a=s.find(".controls-ListView__item");for(a.filter(".controls-ListView__item__multiSelected").removeClass("controls-ListView__item__multiSelected"),o=0;o<a.length;o++)if(V.hasInArray(t,a[o].getAttribute("data-id")))a.eq(o).addClass("controls-ListView__item__multiSelected")}},_drawSelectedItem:function(t,e,i){if(true!==i)if($(".controls-ListView__item",this._getItemsContainer()).removeClass("controls-ListView__item__selected").removeClass("controls-ListView__item__selected__withMarker"),this._isAdd()&&-1===e)this._addSelectedClasses(void 0,t);else if(this._getItemsProjection()){var o=this._getItemsProjection().at(e);if(o)this._addSelectedClasses(o.getHash())}},_addSelectedClasses:function(t,e){var i;if(t)i=$('.controls-ListView__item[data-hash="'+t+'"]',this._container);else i=$('.controls-ListView__item[data-id="'+(void 0===e?"":e)+'"]',this._container);if(i.addClass("controls-ListView__item__selected"),this._options.showSelectedMarker)i.addClass("controls-ListView__item__selected__withMarker")},reload:function(t,e,i,o,s,n){if(this._scrollBinder&&this._options.saveReloadPosition){var r=this._getReloadOffset();if(this._offset=r,this._scrollOffset.top=r,this._scrollOffset.bottom=r,r>0)this.setInfiniteScroll("both",true)}if(this._options.virtualScrolling&&this._virtualScrollController)this._virtualScrollController.disableScrollHandler(true),this.scrollToFirstPage(),this._resetPaging=true;if(this._topWrapper&&this._bottomWrapper)this._topWrapper.height(0),this._bottomWrapper.height(0);return this._reloadInfiniteScrollParams(),this._previousGroupBy=void 0,this._hoveredItem={},this._unlockItemsToolbar(),this._hideItemsToolbar(),this._destroyEditInPlace(),this._observeResultsRecord(false),lt.superclass.reload.apply(this,arguments)},_getReloadOffset:function(){return this._limit*this._getCurrentPage()},_getCurrentPage:function(){var t=0;if(this._scrollBinder){var e,i,o,s,n;e=this._scrollBinder._getScrollPage(),i=this._scrollPager.getPagesCount()||1,n=(e-1)*(o=(s=this._getItemsProjection()?this._getItemsProjection().getCount():0)/i),t=e?Math.ceil(n/this._limit):0}return t+Math.floor(this._scrollOffset.top/this._limit)},setElemClickHandler:function(t){this._options.elemClickHandler=t},redrawItem:function(t){lt.superclass.redrawItem.apply(this,arguments),this._drawSelectedItems(this.getSelectedKeys()),this._drawSelectedItem(this.getSelectedKey(),this.getSelectedIndex()),this._updateHoveredItemAfterRedraw()},_redrawItems:function(){if(lt.superclass._redrawItems.apply(this,arguments),this._options.virtualScrolling&&this._virtualScrollController)this._virtualScrollController.updateProjection(this._getItemsProjection()),this._virtualScrollController.reset()},scrollLoadMore:function(){if(this._options.infiniteScroll&&this._scrollWatcher&&!this._scrollWatcher.hasScroll())this._scrollLoadNextPage(this._options.infiniteScroll)},toggleCheckboxes:function(t){this.cancelEdit(),this._container.toggleClass("controls-ListView__hideCheckBoxes",!t),this._notifyOnSizeChanged(true)},_isHoverEditMode:function(){return-1!==this._options.editMode.indexOf("hover")},_isClickEditMode:function(){return-1!==this._options.editMode.indexOf("click")},initEditInPlace:function(){if(this._notifyOnItemClick=this.beforeNotifyOnItemClick(),this._isHoverEditMode())this._toggleEipHoveredHandlers(true);else if(this._isClickEditMode())this._toggleEipClickHandlers(true)},setActive:function(){var t=arguments;if(this.isEdit())this._getEditInPlace().addCallback(function(e){e.setActive.apply(e,t)});else lt.superclass.setActive.apply(this,t)},_toggleEipHoveredHandlers:function(t){var e=t?"subscribe":"unsubscribe";if(this[e]("onChangeHoveredItem",this._onChangeHoveredItemHandler),n.compatibility.touch)this[e]("onItemClick",this._startEditOnItemClick)},_toggleEipClickHandlers:function(t){this[t?"subscribe":"unsubscribe"]("onItemClick",this._startEditOnItemClick)},_itemsReadyCallback:function(){if(lt.superclass._itemsReadyCallback.apply(this,arguments),this._hasEditInPlace())this._getEditInPlace().addCallback(function(t){t.setItems(this.getItems()),t.setItemsProjection(this._getItemsProjection())}.bind(this));if(this._hasDragMove())this._getDragMove().setItemsProjection(this._getItemsProjection());if(this._hasMover())this._getMover().setItems(this.getItems()),this._getMover().setItemsProjection(this._getItemsProjection())},beforeNotifyOnItemClick:function(){var t=this._notifyOnItemClick;return function(){var e=arguments,i=this,o=new r;if(this._hasEditInPlace())return this._getEditInPlace().addCallback(function(s){s.commitEdit().addCallback(function(){var s=t.apply(i,e);if(s instanceof r)s.addCallback(function(t){o.callback(t)});else o.callback(s)})}),o;else return t.apply(this,e)}},setEditMode:function(t){if(""===t||t!==this._options.editMode){if(this._isHoverEditMode())this._toggleEipHoveredHandlers(false);else if(this._isClickEditMode())this._toggleEipClickHandlers(false);if(this._destroyEditInPlaceController(),this._options.editMode=t,this._isHoverEditMode())this._toggleEipHoveredHandlers(true);else if(this._isClickEditMode())this._toggleEipClickHandlers(true)}},getEditMode:function(){return this._options.editMode},setEditingTemplate:function(t){if(this._options.editingTemplate=t,this._hasEditInPlace())this._getEditInPlace().addCallback(function(e){e.setEditingTemplate(t)})},getEditingTemplate:function(){return this._options.editingTemplate},showEip:function(t,e,i){return this._canShowEip()?this._getEditInPlace().addCallback(function(o){return o.showEip(t,e,i)}):r.fail()},_canShowEip:function(){return this.isEnabled()},_setEnabled:function(t){lt.superclass._setEnabled.call(this,t),this._destroyEditInPlaceController()},_canStartEditOnItemClick:function(t){return!$(t).closest(nt).length},_startEditOnItemClick:function(t,e,i,o,s){var r;if(this._canStartEditOnItemClick(o)){if(r=this.showEip(i,{isEdit:true},false),"click"===s.type)r.addCallback(function(t){if(!n.browser.isMobileIOS||q.IOSVersion<11)w.imitateFocus(s.clientX,s.clientY);return t});t.setResult(r)}},_onChangeHoveredItemHandler:function(t,e){var i=e.container;if(this._editByTouch)return void(this._editByTouch=false);if(i&&!(i.hasClass("controls-editInPlace")||i.hasClass("controls-editInPlace__editing")))this.showEip(this.getItems().getRecordById(e.key),{isEdit:false});else if(this._hasEditInPlace())this._getEditInPlace().addCallback(function(t){t.hide()})},redraw:function(){if(this._options._decorators)this._options._decorators.update(this);if(this._hideItemsToolbar(),this._destroyEditInPlace(),this._headIsChanged=true,this._redrawResults(),lt.superclass.redraw.apply(this,arguments),this._options.saveReloadPosition)this._getScrollWatcher().scrollTo(0)},_getEditInPlace:function(){if(this._hasEditInPlace()){var t=new r;return t.callback(this._editInPlace),t}return this._createEditInPlace()},_hasEditInPlace:function(){return!!this._editInPlace},_createEditInPlace:function(){var t=this,e=new r,i,o=this._isHoverEditMode()?"SBIS3.CONTROLS/ListView/resources/EditInPlaceHoverController/EditInPlaceHoverController":"SBIS3.CONTROLS/ListView/resources/EditInPlaceClickController/EditInPlaceClickController";if(this._createEditInPlaceDeferred)return this._createEditInPlaceDeferred.addCallback(function(t){return e.callback(t),t}),e;if(requirejs.defined(o))return i=requirejs(o),e.callback(this._editInPlace=new i(t._getEditInPlaceConfig())),e;return this._createEditInPlaceDeferred=new r,requirejs([o],function(e){t._createEditInPlaceDeferred.callback(t._editInPlace=new e(t._getEditInPlaceConfig())),t._createEditInPlaceDeferred=void 0}),this._createEditInPlaceDeferred.addCallback(function(t){return e.callback(t),t}),e},_toggleGroup:function(t,e){var i=this;if(this.isEdit()&&e)this._getEditInPlace().addCallback(function(e){var o=e.getEditingRecord();if(i._options._prepareGroupId(o,i._options._getGroupId(o,i._options),i._options)===t)i.cancelEdit()});lt.superclass._toggleGroup.apply(this,arguments)},_editInPlaceMouseDownHandler:function(t){t.preventDefault()},validate:function(){var t=true;if(this.isEdit())this._getEditInPlace().addCallback(function(e){t=e.isValidChanges()});return lt.superclass.validate.apply(this,arguments)&&t},_destroyEditInPlaceController:function(){if(this._hasEditInPlace())this._editInPlace.destroy(),this._editInPlace=null},_destroyEditInPlace:function(){if(this._hasEditInPlace())this._getEditInPlace().addCallback(function(t){t.cancelEdit(),t._destroyEip()})},_isModeAutoAdd:function(){return-1!==this._options.editMode.indexOf("autoadd")},_onAfterBeginEdit:function(t,e){var i=this._itemsToolbar&&this._itemsToolbar.getContainer();if(this._itemsToolbar)this._setTouchMode(false);if(this._toggleEmptyData(false),this._showToolbar(e),this.setSelectedKey(e.getId()),e.getState()===f.RecordState.DETACHED)this._drawSelectedItem(e.getId(),-1);if(i&&this._isBottomStyleToolbar())T.scrollToElement(i,true);this.scrollToItem(e),t.setResult(this._notify("onAfterBeginEdit",e)),this._getItemsContainer().on("mousedown",".js-controls-ListView__item",this._editInPlaceMouseDownHandler)},_onAfterEndEdit:function(t,e,i,o){this.setSelectedKey(e.getId()),t.setResult(this._notify("onAfterEndEdit",e,i,o)),this._toggleEmptyData(!this.getItems()||!this.getItems().getCount()),this._hideToolbar(),this._getItemsContainer().off("mousedown",".js-controls-ListView__item",this._editInPlaceMouseDownHandler)},_getEditInPlaceConfig:function(){if(this._savedConfigs)for(var t=0;t<this._savedConfigs.length;t++){var e=this._savedConfigsMaps[t],o=this._savedConfigs[t][e],s={};if(!o._thisIsInstance)s[e]=i(o),E.mergeConfigStorage(s)}return{items:this.getItems(),idProperty:this._options.idProperty,ignoreFirstColumn:this._options.multiselect,dataSource:this._dataSource,itemsProjection:this._getItemsProjection(),notEndEditClassName:this._notEndEditClassName,editingTemplate:this._options.editingTemplate,itemsContainer:this._getItemsContainer(),element:$("<div>"),opener:this,endEditByFocusOut:-1===this._options.editMode.indexOf("toolbar"),modeAutoAdd:this._isModeAutoAdd(),modeSingleEdit:-1!==this._options.editMode.indexOf("single"),handlers:{onItemValueChanged:function(t,e,i){t.setResult(this._notify("onItemValueChanged",e,i))}.bind(this),onBeginEdit:function(t,e){t.setResult(this._notify("onBeginEdit",e))}.bind(this),onAfterBeginEdit:this._onAfterBeginEdit.bind(this),onHeightChange:function(t,e){if(-1!==this._options.editMode.indexOf("toolbar")&&this._getItemsToolbar().isToolbarLocking())this._showItemsToolbar(this._getElementData(this._getElementByModel(e)));this._notifyOnSizeChanged(true)}.bind(this),onBeginAdd:function(t,e){t.setResult(this._notify("onBeginAdd",e))}.bind(this),onEndEdit:function(t,e,i){t.setResult(this._notify("onEndEdit",e,i))}.bind(this),onAfterEndEdit:this._onAfterEndEdit.bind(this),onBeginSave:function(){this._toggleIndicator(true)}.bind(this),onEndSave:function(){this._toggleIndicator(false)}.bind(this),onDestroy:function(){this._hideToolbar(),this._toggleEmptyData(!this.getItems()||!this.getItems().getCount()),this._notifyOnSizeChanged(true)}.bind(this)}}},_redrawItemInner:function(t){var e=this._getItemsToolbar(),i=e.getCurrentTarget(),o=this._getDomElementByItem(t);if(i&&o&&i.container.get(0)===o.get(0))e.hide();if(lt.superclass._redrawItemInner.apply(this,arguments),i&&o&&i.container.get(0)===o.get(0))i.container=this._getDomElementByItem(t),e.setCurrentTarget(i)},_showToolbar:function(t){var e,i,s,n;if(-1!==this._options.editMode.indexOf("toolbar")){if(i=this._getItemsToolbar(),i.unlockToolbar(),n=this._getElementByModel(t),this._changeHoveredItem(n),i.showEditActions(),!this.getItems()||!this.getItems().getRecordById(t.getId()))if(this.getItemsActions())if(e=this.getItemsActions().getItemsInstances(),e["delete"])this._lastDeleteActionState=e["delete"].isVisible(),e["delete"].hide();if(s=o(this.getHoveredItem()),s.record=t,!K(this.getContainer(),s.container))s.container=n;this._showItemsToolbar(s),i.lockToolbar()}else if(this._touchSupport)this._mouseLeaveHandler();else this._updateItemsToolbar()},_hideToolbar:function(){if(-1!==this._options.editMode.indexOf("toolbar")){if(this._getItemsToolbar().unlockToolbar(),this._getItemsToolbar().hideEditActions(),void 0!==this._lastDeleteActionState)this.getItemsActions().getItemsInstances()["delete"].toggle(this._lastDeleteActionState),this._lastDeleteActionState=void 0;if(!this._touchSupport)this._updateHoveredItemAfterRedraw();else this._hideItemsToolbar()}else this._updateItemsToolbar()},_getElementByModel:function(t){var e=t.getId();return this._getItemsContainer().find('>.js-controls-ListView__item[data-id="'+(void 0===e?"":e)+'"]:not(".controls-editInPlace")')},isEdit:function(){var t=false;if(this._hasEditInPlace())this._getEditInPlace().addCallback(function(e){t=e.isEdit()});return t},_isAdd:function(){var t=false;if(this._hasEditInPlace())this._getEditInPlace().addCallback(function(e){t=e.isAdd()});return t},_isSupportedItemsToolbar:function(){return this._options.itemsActions.length||-1!==this._options.editMode.indexOf("toolbar")},_updateItemsToolbar:function(){var t=this.getHoveredItem();if(t.container&&this._isSupportedItemsToolbar())this._showItemsToolbar(t)},_swipeHandler:function(t){var e=this._findItemByElement($(t.target));if(!e.length)return;if(this._setTouchSupport(true),"left"==t.direction)this._changeHoveredItem(e),this._onLeftSwipeHandler();else if(this._onRightSwipeHandler(e),this._hasHoveredItem())this._clearHoveredItem(),this._notifyOnChangeHoveredItem();t.stopPropagation()},_onLeftSwipeHandler:function(){var t,e;if(this._isSupportedItemsToolbar())if(t=this.getItemsActions(),e=t.getTarget(),this._hasHoveredItem()){if(!this._itemsToolbar.isVisible()||e.key!==this._hoveredItem.key)this._showItemsToolbar(this._hoveredItem),this.setSelectedKey(this._hoveredItem.key)}else this._hideItemsToolbar()},_hasHoveredItem:function(){return!!this._hoveredItem.container},_onRightSwipeHandler:function(t){var e=this,i=this.getHoveredItem(),o=t[0].getAttribute("data-id"),s=t.find(".controls-DataGridView__td").not(".controls-DataGridView__td__checkBox"),n;if(i&&i.key!==o&&e.getMultiselect())s.addClass("rightSwipeAnimation"),setTimeout(function(){s.toggleClass("rightSwipeAnimation",false),e.setSelectedKey(o),e.toggleItemsSelection([o])},300);if(this._isSupportedItemsToolbar())n=!this._isBottomStyleToolbar(),this._hideItemsToolbar(n)},_isBottomStyleToolbar:function(){return this.getContainer().hasClass("controls-ListView__bottomStyle")},_tapHandler:function(t){var e=this._findItemByElement($(t.target));if(e.length)this.setSelectedKey(e.data("id"))},_findItemByElement:function(t){if(!t.length)return[];var e=t.closest(".js-controls-ListView__item",this._getItemsContainer()),i=e[0],o,s;if(i)o=i.getAttribute("data-id"),s=i.getAttribute("data-hash");else return e;if(this._getItemsProjection()&&this._getItemProjectionByItemId(o)&&this._getItemProjectionByHash(s))return e;else return this._findItemByElement(e.parent())},_showItemsToolbar:function(t){var e=this._getItemsToolbar();if(e.show(t,this._touchSupport&&!this._isBottomStyleToolbar()),-1===this._options.editMode.indexOf("toolbar"))if(this.isEdit())this._getEditInPlace().addCallback(function(i){e._toggleEditClass(i.getEditingRecord().getId()==t.key)});else e._toggleEditClass(false)},_unlockItemsToolbar:function(){if(this._itemsToolbar)this._itemsToolbar.unlockToolbar()},_hideItemsToolbar:function(t){if(this._itemsToolbar)this._itemsToolbar.hide(t)},_itemActionActivated:function(t){if(this.setSelectedKey(t),this._touchSupport)this._clearHoveredItem(),this._onChangeHoveredItem(this.getHoveredItem())},_getItemsToolbar:function(){var t=this;if(!this._itemsToolbar){this._setTouchSupport(this._touchSupport),this._itemsToolbar=new C({element:this.getContainer().find("> .controls-ListView__ItemsToolbar-container"),parent:this,visible:false,itemsActionsInItemContainer:this._options.itemsActionsInItemContainer,touchMode:this._touchSupport,className:this._notEndEditClassName,itemsActions:o(this._options.itemsActions),showEditActions:-1!==this._options.editMode.indexOf("toolbar"),handlers:{onShowItemActionsMenu:function(){var e=t.getHoveredItem().key;if(e)t.setSelectedKey(e)},onItemActionActivated:function(e,i){t._itemActionActivated(i)},onItemsToolbarHide:function(){if(t._touchSupport)t._setTouchSupport(false),t._clearHoveredItem();if(t._options.itemsActionsInItemContainer)t._itemsToolbar.getContainer().appendTo(t._container)}}});var e=this._itemsToolbar.getItemsActions();if(e)e.subscribe("onHideMenu",function(){t.setActive(true)})}return this._itemsToolbar},getItemsActions:function(){return this._getItemsToolbar().getItemsActions()},setItemsActions:function(t){if(this._options.itemsActions=t,this._itemsToolbar)if(this._itemsToolbar.setItemsActions(o(this._options.itemsActions)),this.getHoveredItem().container)this._notifyOnChangeHoveredItem();this._notifyOnPropertyChanged("itemsActions")},_isSearchMode:function(){return this._options.hierarchyViewMode},_drawItemsCallback:function(){if(lt.superclass._drawItemsCallback.apply(this,arguments),this.isInfiniteScroll())this._preScrollLoading();if(this._drawSelectedItems(this._options.selectedKeys,{}),this._scrollBinder)this._scrollBinder._updateScrollPages(!this._options.virtualScrolling||this._resetPaging),this._resetPaging=false;else if("down"==this._options.infiniteScroll&&this._options.scrollPaging)this._createScrollPager();this.sendCommand("resizeYourself"),this._onResizeHandler()},_drawItemsCallbackSync:function(){if(lt.superclass._drawItemsCallbackSync.call(this),this.isInfiniteScroll())if(this._needScrollCompensation)this._moveTopScroll();if(this._virtualScrollController){if(this._resetPaging)this.scrollToFirstPage(),this._virtualScrollController.disableScrollHandler(false);this._virtualScrollController.initHeights()}this._updateHoveredItemAfterRedraw()},_onResizeHandler:function(){lt.superclass._onResizeHandler.call(this),this._onResizeHandlerInner()},_onResizeHandlerInner:function(){if(this.getItems()){if(this.isInfiniteScroll()&&this._scrollWatcher&&!this._scrollWatcher.hasScroll())this._scrollLoadNextPage();if(this._scrollPager)this._scrollBinder&&this._scrollBinder._updateScrollPages(),this._setScrollPagerPositionThrottled()}if(this._itemsToolbar&&this._itemsToolbar.isVisible()){if(this._touchSupport&&!this._editInPlace.isVisible())this._itemsToolbar.setHeightInTouchMode();this._itemsToolbar.recalculatePosition()}if(this.isEdit())this._getEditInPlace().addCallback(function(t){t._onResizeHandler()})},_removeItems:function(t){if(this._checkDeletedItems(t),lt.superclass._removeItems.call(this,t),this.isInfiniteScroll())this._preScrollLoading()},_onCollectionAddMoveRemove:function(t,e,i,o,s,n){if("Offset"==this._getSourceNavigationType())if(e==L.ACTION_ADD)this._scrollOffset.bottom+=this._getAdditionalOffset(i);else if(e==L.ACTION_REMOVE)this._scrollOffset.bottom-=this._getAdditionalOffset(s);if(q.firefox||q.isMobileSafari)this._beforeFixScrollTop(e,i,o,s,n);if(lt.superclass._onCollectionAddMoveRemove.apply(this,arguments),this._virtualScrollController)this._virtualScrollController.addItems(i,o),this._virtualScrollController.removeItems(s,n);if(q.firefox||q.isMobileSafari)this._fixScrollTop(e,i,o,s,n)},_beforeFixScrollTop:function(t,e,i,o,s){if(t==L.ACTION_REMOVE)this._ffScrollPosition=this._getScrollWatcher().getScrollContainer().scrollTop(),this._ffRemoveIndex=s},_fixScrollTop:function(t,e,i,o,s){if(t==L.ACTION_ADD)if(this._ffRemoveIndex==i)this._scrollWatcher.scrollTo(this._ffScrollPosition);setTimeout(function(){this._ffScrollPosition=null,this._ffRemoveIndex=null}.bind(this),0)},_getAdditionalOffset:function(t){return t.length},_cancelLoading:function(){if(lt.superclass._cancelLoading.apply(this,arguments),this.isInfiniteScroll())this._hideLoadingIndicator()},_checkDeletedItems:function(t){var e=this,i,o,s;if(e._itemsToolbar&&e._itemsToolbar.isToolbarLocking())if(i=e.getItemsActions(),i)o=e.getItemsActions().getTarget(),s=o.container.data("hash"),t.forEach(function(t){if(t.getHash()==s)e._itemsToolbar.unlockToolbar(),e._itemsToolbar.hide()})},_prepareInfiniteScroll:function(){var t=this.getTopParent(),e=this;if(!this._scrollWatcher)this._createScrollWatcher();if(this._createLoadingIndicator(),"demand"==this._options.infiniteScroll)return void this._setInfiniteScrollState("down");if(this._setInfiniteScrollState("down","up"==this._options.infiniteScroll),x.instanceOfModule(t,"Lib/Control/FloatArea/FloatArea")){var i=function(){if(e.getItems()){if("up"==e._options.infiniteScroll)e._moveTopScroll();e._preScrollLoading()}t.unsubscribe("onAfterShow",i)};this.subscribeTo(t,"onAfterShow",i)}this._scrollWatcher.subscribe("onTotalScroll",this._onTotalScrollHandler.bind(this))},_setInfiniteScrollState:function(t,e){if(this._options.infiniteScroll){if(t)this._infiniteScrollState.mode=t;if(e)this._infiniteScrollState.reverse=e}},_moveTopScroll:function(){var t=this._scrollWatcher.getScrollHeight()-this._containerScrollHeight;if(t)this._scrollWatcher.scrollTo(t)},_createScrollWatcher:function(){var t={totalScrollOffset:this._options.infiniteScrollPreloadOffset,opener:this,element:this.getContainer().closest(this._options.infiniteScrollContainer),initOnBottom:"up"==this._options.infiniteScroll};this._scrollWatcher=new M(t),this._inScrollContainerControl=this._scrollWatcher.getScrollContainer().hasClass("controls-ScrollContainer__content")},_onTotalScrollHandler:function(t,e){if(this._options.task1173941879&&!this._has_task1173941879Fix)e="bottom",this._has_task1173941879Fix=true;var i=this._infiniteScrollState.mode,o="up"===i&&"top"===e||"down"===i&&"bottom"===e&&!this._infiniteScrollState.reverse||"down"===i&&"top"===e&&this._infiniteScrollState.reverse||"both"===this._options.infiniteScroll,s=this._getOption("infiniteScroll"),n;if(o&&this.getItems()){if("top"==e&&this._infiniteScrollState.reverse)this._setInfiniteScrollState("down");else this._setInfiniteScrollState("top"==e?"up":"down");if(this._isCursorNavigation())if("both"===s){if("bottom"===e){if(this.getListNavigation().hasNextPage("down"))n="down"}else if(this.getListNavigation().hasNextPage("up"))n="up"}else n=s;this._scrollLoadNextPage(n)}},_isCursorNavigation:function(){return this._options.navigation&&"cursor"===this._options.navigation.type},_preScrollLoading:function(){var t="down"===this._infiniteScrollState.mode&&!this._infiniteScrollState.reverse,e=this._getOption("infiniteScroll"),i=this._isCursorNavigation();if(i)if("both"===e||"down"===e)t=this.getListNavigation().hasNextPage("down");if(t&&this.isScrollOnBottom()||!this._scrollWatcher.hasScroll()&&"both"!==e)this._scrollLoadNextPage(i?"down":null);else if("both"===e&&this.isScrollOnTop())this._setInfiniteScrollState("up"),this._scrollLoadNextPage(i?"up":null)},isInfiniteScroll:function(){var t=null!==this._options.infiniteScroll;return this._allowInfiniteScroll&&t},_reloadInfiniteScrollParams:function(){if(this._containerScrollHeight=0,this._needScrollCompensation="up"==this._options.infiniteScroll,this.isInfiniteScroll())this._scrollOffset.top=this._offset,this._scrollOffset.bottom=this._offset},_scrollLoadNextPage:function(t){var e=this.isInfiniteScroll()&&("demand"!==this._options.infiniteScroll||"demand"===t),i=this.getItems().getMetaData().more,o=F(this.getContainer()),s=this._scrollWatcher.hasScroll(this._getLoadingIndicatorHeight()),n;if(this._isCursorNavigation())n=this._listNavigation.hasNextPage(t||this._infiniteScrollState.mode);else n=this._hasNextPage(i,this._scrollOffset.bottom);if(this._loadingIndicator)this._loadingIndicator.toggleClass("controls-ListView-scrollIndicator_outside",!s);if(this._updateScrollIndicatorTopThrottled(),e&&o&&n&&!this.isLoading())this._loadNextPage(t)},_getLoadingIndicatorHeight:function(){return this.getContainer().hasClass("controls-ListView__indicatorVisible")?this._loadingIndicator.height():0},_updateScrollIndicatorTop:function(){var t="";if(this._isScrollingUp()&&this.getItems()&&this._hasNextPage(this.getItems().getMetaData().more,this._scrollOffset.top)||this._loadingIndicator.hasClass("controls-ListView-scrollIndicator__up"))t=c.getStickyHeaderIntersectionHeight(this.getContainer())-this._scrollWatcher.getScrollContainer().scrollTop();this._loadingIndicator.css("top",t)},_hasNextPage:function(t,e,i){if("up"===this._infiniteScrollState.mode){if(!i)i="before";if(this._options.saveReloadPosition)return this._scrollOffset.top>=0;else if("before"===i)return this._scrollOffset.top>0;else return lt.superclass._hasNextPage.apply(this,arguments)}else return!this._lastPageLoaded&&lt.superclass._hasNextPage.apply(this,arguments)},_isScrollingUp:function(){return"up"==this._infiniteScrollState.mode||"down"==this._infiniteScrollState.mode&&true===this._infiniteScrollState.reverse},_loadNextPage:function(t){if(this._dataSource){var e=this._getNextOffset(),i=this;if(this._loadingIndicator.toggleClass("controls-ListView-scrollIndicator__up",this._isScrollingUp()),this._showLoadingIndicator(),this._toggleEmptyData(false),!this._options.navigation||"cursor"!=this._options.navigation.type)this._notify("onBeforeDataLoad",this.getFilter(),this.getSorting(),e,this._limit);var s=this._loadId++;this._loadQueue[s]=o(this._infiniteScrollState),this._loader=this._callQuery(this.getFilter(),this.getSorting(),e,this._limit,t||this._infiniteScrollState.mode).addBoth(W(function(t){return this._loader=null,t},this)).addCallback(W(function(e){var i=this._loadQueue[s],o;if(this._isCursorNavigation())this._listNavigation.analyzeResponseParams(e,t||i.mode),o=this._listNavigation.hasNextPage(t||i.mode);else o=this._hasNextPage(e.getMetaData().more,this._scrollOffset.bottom);if(this._updateScrollOffset(),this.getItems().setMetaData(e.getMetaData()),!o)this._toggleEmptyData(!this.getItems().getCount());if(this._notify("onDataMerge",e),this._onDataMergeCallback(e),e.getCount()){if(this._isSlowDrawing(this._options.easyGroup))this._needToRedraw=false;if(this._drawPage(e,t&&{mode:t}||i),this._dogNailSavedMode)this._setInfiniteScrollState(this._dogNailSavedMode),this._dogNailSavedMode=null;if(this._isSlowDrawing(this._options.easyGroup))this._needToRedraw=true}else{if(this._dogNailSavedMode)this._setInfiniteScrollState(this._dogNailSavedMode),this._dogNailSavedMode=null;if(o)this._scrollLoadNextPage(t);else if(this._hideLoadingIndicator(),!this._dogNailSavedMode)if(this._options.task1173941879&&this.isScrollOnTop())this._dogNailSavedMode=i.mode,this._setInfiniteScrollState("up"),this._scrollLoadNextPage()}},this)).addErrback(W(function(t){return this._hideLoadingIndicator(),t},this))}},_getNextOffset:function(){if("down"==this._infiniteScrollState.mode||"demand"==this._infiniteScrollState.mode)if("Offset"==this._getSourceNavigationType)return Math.min(this._scrollOffset.bottom+this._limit,this._getRootCount());else return this._scrollOffset.bottom+this._limit;else return Math.max(this._scrollOffset.top-this._limit,0)},_getRootCount:function(){return this._getItemsProjection().getCount()},_updateScrollOffset:function(){if("down"===this._infiniteScrollState.mode||"demand"==this._infiniteScrollState.mode){if("Offset"!==this._getSourceNavigationType())this._scrollOffset.bottom+=this._limit}else this._scrollOffset.top-=this._limit},_onDataMergeCallback:function(t){},_drawPage:function(t,e){var i=null,o=this,s=function(t){o._getScrollContainer().css({"-webkit-overflow-scrolling":t?"":"initial"})};if("up"===e.mode||"down"==e.mode&&e.reverse){if(n.browser.isMobileIOS)s(false);this._needScrollCompensation=true,this._containerScrollHeight=this._scrollWatcher.getScrollHeight()-this._scrollWatcher.getScrollContainer().scrollTop(),i={at:0}}this._hideItemsToolbar();var r;if("down"==e.mode)r=this.getItems().append(t);else r=this.getItems().prepend(t);if(n.browser.isMobileIOS)s(true);if(this._isSlowDrawing(this._options.easyGroup))this._drawItems(r,i);this._needScrollCompensation=false,this._dataLoadedCallback(),this._toggleEmptyData()},_setLoadMoreCaption:function(t){var e,i,o=t.getMetaData().more;if("number"===typeof o){if($(".controls-ListView__counterValue",this._container.get(0)).text(o),$(".controls-ListView__counter",this._container.get(0)).removeClass("ws-hidden"),e=o-(this._scrollOffset.bottom+this._options.pageSize),e>0)i=l({count:e},rk("Еще $count$s$"))}else if($(".controls-ListView__counter",this._container.get(0)).addClass("ws-hidden"),false!==o)i=rk("Еще")+"...";if(i)this._loadMoreButton.setCaption(i),this._loadMoreButton.setVisible(true);else this._loadMoreButton.setVisible(false)},_onLoadMoreButtonActivated:function(t){this._loadNextPage("down")},scrollToItem:function(t,e,i){if(t.getId&&t.getId instanceof Function)this._scrollToItem(t.getId(),e,i)},scrollToFirstPage:function(){if("down"==this._options.infiniteScroll)this._getScrollWatcher().scrollTo("top")},_getScrollWatcher:function(){if(!this._scrollWatcher)this._createScrollWatcher();return this._scrollWatcher},isScrollOnBottom:function(t){return this._getScrollWatcher().isScrollOnBottom(t)},isScrollOnTop:function(){return this._getScrollWatcher().isScrollOnTop()},_showLoadingIndicator:function(){if(!this._loadingIndicator)this._createLoadingIndicator();this.getContainer().addClass("controls-ListView__indicatorVisible")},_hideLoadingIndicator:function(){if(this._loadingIndicator&&!this._loader)this.getContainer().removeClass("controls-ListView__indicatorVisible")},_createLoadingIndicator:function(){if(this._loadingIndicator=$("> .controls-ListView-scrollIndicator",this._container),"up"==this._options.infiniteScroll)this._loadingIndicator.prependTo(this._container)},setInfiniteScroll:function(t,e){if("boolean"===typeof t)this._allowInfiniteScroll=t;else if(t)if(this._options.infiniteScroll=t,this._allowInfiniteScroll=true,"down"===t)this._setInfiniteScrollState("down");if(this.isInfiniteScroll())this._prepareInfiniteScroll();if("demand"===t)if(this._loadMoreButton)this._loadMoreButton.show();else this._initLoadMoreButton();else if(this._loadMoreButton)this._loadMoreButton.hide();if(t&&!e)return void this._scrollLoadNextPage(t);if(!t&&this._loadingIndicator&&this._loadingIndicator.is(":visible"))this._cancelLoading();this._hideLoadingIndicator()},getHoveredItem:function(){return this._hoveredItem},_setHoveredItem:function(t){if(t.container){if(this._options.itemsHover&&!t.container.hasClass("controls-EditAtPlace"))t.container.addClass("controls-ListView__hoveredItem");this._hoveredItem=t}},_clearHoveredItem:function(){var t=this.getHoveredItem(),e=t.container,i={};e&&e.removeClass("controls-ListView__hoveredItem");for(var o in t)if(t.hasOwnProperty(o))i[o]=null;return this._hoveredItem=i},_onDataLoad:function(t){if(this._isCursorNavigation())this._listNavigation.analyzeResponseParams(t);lt.superclass._onDataLoad.call(this,t)},_dataLoadedCallback:function(t){if(t)this.scrollToFirstPage();if(this._options.showPaging)this._processPaging(),this._updateOffset();if(this.isInfiniteScroll()){if(!this._hasNextPage(this.getItems().getMetaData().more,this._scrollOffset.bottom)||"demand"===this._options.infiniteScroll)this._hideLoadingIndicator();if("demand"===this._options.infiniteScroll&&this._loadMoreButton)this._setLoadMoreCaption(this.getItems())}if(this._observeResultsRecord(true),lt.superclass._dataLoadedCallback.apply(this,arguments),this._needScrollCompensation=false,this._options.virtualScrolling&&!this._virtualScrollController)this._initVirtualScrolling()},_getAjaxLoaderContainer:z(function(){return this.getContainer().find(".controls-AjaxLoader").eq(0)},"_getAjaxLoaderContainer"),_toggleIndicator:function(t){if(this._showedLoading=t,t){if(!this.isDestroyed()&&this._showedLoading)this._showLoadingOverlay();if(!this._loadingIndicatorTimer)this._loadingIndicatorTimer=setTimeout(this._showIndicator.bind(this),rt)}else clearTimeout(this._loadingIndicatorTimer),this._loadingIndicatorTimer=void 0,this._hideLoadingOverlayAndIndicator()},_showLoadingOverlay:function(){var t=this.getContainer(),e=this._getAjaxLoaderContainer(),i=this._getScrollContainer()[0],o,s;if(o=e.find(".controls-AjaxLoader__outer"),e.removeClass("ws-hidden"),o.length&&i&&i.offsetHeight&&t[0].scrollHeight>i.offsetHeight)s=(Math.max(i.getBoundingClientRect().bottom,0)-Math.max(e[0].getBoundingClientRect().top,0))/2,o[0].style.top=s+i.scrollTop+"px";else o[0].style.top=""},_showIndicator:function(){this._loadingIndicatorTimer=void 0,this._getAjaxLoaderContainer().addClass("controls-AjaxLoader__showIndication")},_hideLoadingOverlayAndIndicator:function(){this._getAjaxLoaderContainer().addClass("ws-hidden").removeClass("controls-AjaxLoader__showIndication")},_toggleEmptyData:function(t){if(t=t&&this._options.emptyHTML,this._getEmptyDataContainer().toggleClass("ws-hidden",!t),this._pagerContainer)this._pagerContainer.toggleClass("ws-hidden",t)},_processPaging:function(){this._processPagingStandart()},_processPagingStandart:function(){var t=this;if(!this._pager)requirejs(["SBIS3.CONTROLS/Pager"],function(e){if(t._pager||t.isDestroyed())return;var i=t.getItems().getMetaData().more,o=t._hasNextPage(i),s={hideEndButton:t._options.hideEndButton,recordsPerPage:t._options.pageSize||i,currentPage:1,recordsCount:i||0,pagesLeftRight:1,onlyLeftSide:"boolean"===typeof i,rightArrow:o},n=t.getContainer().find(".controls-Pager-container").append("<div/>");t._pager=new e({noSizePicker:t._options.noSizePicker,noPagerAmount:t._options.noPagerAmount,pageSize:t._options.pageSize,opener:t,element:n.find("div"),allowChangeEnable:false,pagingOptions:s,handlers:{onPageChange:function(e,i,o){var s=t.getItems().getMetaData().more,n=t._hasNextPage(s,t._scrollOffset.bottom),r=t._pager.getPaging()._maxPage,a=t._options.navigation&&t._options.navigation.lastPage;if(t._pager._lastPageReached=t._pager._lastPageReached||!n,0===i&&t._pager._options.pagingOptions.onlyLeftSide&&!a)i=t._pager._lastPageReached?r:r+1;t._setPageSave(i),t.setPage(i-1),t._pageChangeDeferred=o}}}),t._updateHoveredItemAfterRedraw(),t._pagerContainer=t.getContainer().find(".controls-Pager-container"),t._updatePaging()});else this._updatePaging()},_getQueryForCall:function(t,i,s,n,r){var a=new g,l=t;if(this._isCursorNavigation()){var h=this._dataSource.getOptions();h.navigationType=U.prototype.NAVIGATION_TYPE.POSITION,this._dataSource.setOptions(h),l=o(t);var c=this._listNavigation.prepareQueryParams(this._getItemsProjection(),r);e(l,c.filter)}if(this._isCursorNavigation())this._notify("onBeforeDataLoad",l,i,s,n);return a.where(l).offset(s).limit(n).orderBy(i).meta({hasMore:this._options.partialPaging}),a},_updatePaging:function(){var t=this.getItems().getMetaData().more,e=this._hasNextPage(t,this._scrollOffset.bottom),i=0;if(this._pager){var o=this._pager.getPaging().getPage();if(this._pageChangeDeferred)this._pageChangeDeferred.callback([this.getPage()+1,e,e]),this._pageChangeDeferred=void 0;if(0===this.getItems().getCount()&&o>1)this._pager.getPaging().setPage(1);if(this._pager.getPaging().update(this.getPage(this.isInfiniteScroll()?this._scrollOffset.bottom:this._offset)+1,t,e),this._pager.getContainer().toggleClass("ws-hidden",!this.getItems().getCount()),this._options.multiselect)i=this.getSelectedKeys().length;this._pager.updateAmount(this.getItems().getCount(),e,i)}},setPage:function(t,e){t=parseInt(t,10);var i=this._offset;if(-1==t)if(this._lastPageLoaded)this._getScrollWatcher().scrollTo("bottom");else this._setLastPage(e);else{if(this.isInfiniteScroll()&&this._isPageLoaded(t)){if(this._getItemsProjection()&&this._getItemsProjection().getCount()){var o,s,n,r;if(o=t*this._options.pageSize-this._scrollOffset.top,s=this._getItemsProjection().at(o),s)this._scrollToProjItem(s)}}else{if(0===t)this._setInfiniteScrollState("down");if(this._offset=this._options.pageSize*t,this._scrollOffset.top=this._offset,this._scrollOffset.bottom=this._offset,!e&&this._offset!==i)this.setSelectedIndex(-1),this.reload()}this._lastPageLoaded=false}this._notify("onPageChange",t)},_setLastPage:function(t){var e=this.getItems()?this.getItems().getMetaData().more:false,i;this._setInfiniteScrollState("up");var o=function(t){if(e=t.getMetaData().more,"number"==typeof e)i=Math.floor(e/this._options.pageSize),this._scrollOffset.bottom=e,this.getFilter()["СлужебныйКоличествоЗаписей"]=t.getCount(),this._scrollOffset.top=e-t.getCount(),this.setPage(i,true),this._updatePaging(),this._getScrollWatcher().scrollTo("bottom");this._lastPageLoaded=true}.bind(this);if(t)this._offset=-1,this.once("onDataLoad",function(t,e){o(e)});else this.reload(void 0,void 0,-1).addCallback(o)},_isPageLoaded:function(t){var e=t*this._options.pageSize;if(!this._options.pageSize)return true;else return e<=this._scrollOffset.bottom&&e>=this._scrollOffset.top},getPage:function(t){if(this.getItems()){var t=t||this._offset,e=this.getItems().getMetaData().more;return Math.ceil((t<0?e+t:t)/this._options.pageSize)}},_updateOffset:function(){var t=this.getItems().getMetaData().more;if(-1===this.getPage())this._offset=t-this._options.pageSize},_getGroupTpl:function(){return this._options.groupBy.template||O},_groupByDefaultRender:function(t,e){return e},setDataSource:function(t,e){if(!e&&this._pager)this._pager.destroy(),this._pager=void 0,this._pagerContainer=void 0;this._destroyEditInPlaceController(),lt.superclass.setDataSource.apply(this,arguments)},_activateItem:function(t){var e=this.getItems().getRecordById(t);this._notify("onItemActivate",{id:t,item:e})},beginAdd:function(t,e){if(!t)t={};return t.target=this._getItemProjectionByItemId(t.parentId),this.showEip(null,t,e)},beginEdit:function(t,e){if(!(t instanceof f))t=this.getItems().getRecordById(t);if(!t)return r.fail();return this.showEip(t,{isEdit:true},e)},cancelEdit:function(){if(this._hasEditInPlace())return this._getEditInPlace().addCallback(function(t){var e=t.cancelEdit();return this._notifyOnSizeChanged(true),e}.bind(this));else return r.success()},commitEdit:function(t){var e=this,i=this._getEditInPlace();return i.addCallback(function(i){return t&&i.isAdd()&&e._isModeAutoAdd()?i.editNextTarget(true):i.commitEdit(true)}),i},destroy:function(){if(this._destroyEditInPlaceController(),this._scrollBinder)this._scrollBinder.destroy(),this._scrollBinder=null;if(this._scrollWatcher){if(this._options.scrollPaging)this._scrollWatcher.unsubscribe("onScroll",this._onScrollHandler);this._scrollWatcher.unsubscribe("onTotalScroll",this._onTotalScrollHandler),this._scrollWatcher.destroy(),this._scrollWatcher=void 0}if(this._pager)this._pager.destroy(),this._pager=void 0,this._pagerContainer=void 0;if(this._scrollPager){if(!this._inScrollContainerControl)$(window).off("resize scroll",this._setScrollPagerPositionThrottled);this._scrollPager.destroy()}if(this._listNavigation)this._listNavigation.destroy();if(this._mover)this._mover.destroy();if(this._toggleEventHandlers(this._container,false),lt.superclass.destroy.call(this),this._hasDragMove())this._getDragMove().destroy()},_moveItemTo:function(t,e,i){var o=this._getItemsContainer(),s=o.find('tr[data-id="'+t+'"]'),e=o.find('tr[data-id="'+e+'"]'),n;if(i)n=[e.prev(),s,e,s.next()],s.insertBefore(e);else n=[s.prev(),e,s,e.next()],s.insertAfter(e)},setItemsDragNDrop:function(t){if(this._options.itemsDragNDrop!=t)this._setItemsDragNDrop(t)},_setItemsDragNDrop:function(t){if(this.isEnabledMove())if(this._options.itemsDragNDrop=t,this._getItemsContainer()[t?"on":"off"]("mousedown",".js-controls-ListView__item",this._getDragInitHandler()),this._dragMoveController)this._dragMoveController.setItemsDragNDrop(t)},_getDragInitHandler:function(){return this._dragInitHandler?this._dragInitHandler:this._dragInitHandler=function(t){if(this._canDragStart(t))this._initDrag.call(this,t)}.bind(this)},_getDragMove:function(){if(!this._dragMoveController)this._dragMoveController=new et({view:this,mover:this._getMover(),projection:this._getItemsProjection(),useDragPlaceHolder:this._options.useDragPlaceHolder,linkTemplateConfig:this._options.linkTemplateConfig,dragEntity:this._options.dragEntity,dragEntityList:this._options.dragEntityList,itemsDragNDrop:this.getItemsDragNDrop(),nodeProperty:this._options.nodeProperty,enabled:this.isEnabledMove()});return this._dragMoveController},_hasDragMove:function(){return!!this._dragMoveController},_canDragStart:function(t){return this._options.enabled&&this._needProcessMouseEvent(t)},_needProcessMouseEvent:function(t){return!x.instanceOfModule($(t.target).wsControl(),"SBIS3.CONTROLS/TextBox/TextBoxBase")},_beginDragHandler:function(){return this._getDragMove().beginDrag()},_endDragHandler:function(){return this._getDragMove().endDrag()},_onDragHandler:function(){return this._getDragMove().drag()},_updateDragTarget:function(){return this._getDragMove().updateTarget()},_createAvatar:function(){return this._getDragMove().createAvatar()},moveRecordsWithDialog:function(t){if(this.isEnabledMove())require(["SBIS3.CONTROLS/Action/List/InteractiveMove","WS.Data/Utils"],function(e,i){var o=new e({linkedObject:this,parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty,dialogOptions:{opener:this},moveStrategy:this.getMoveStrategy(),handlers:{onExecuted:function(){this.destroy()}}}),s=this.getItems(),n;if(t)n=[],t.forEach(function(t,e){if(!x.instanceOfModule(t,"WS.Data/Entity/Record")){var i=s.getRecordById(t);if(!i){var o=this.getSelectedItems().getEnumerator().getIndexByValue(this._options.idProperty,t);i=this.getSelectedItems().at(o)}if(i)n.push(i)}else n.push(t)},this);var r=this._notify("onPrepareFilterOnMove",{});o.execute({movedItems:n,componentOptions:{filter:r}})}.bind(this))},selectedMoveTo:function(t){this._getMover().move(this._normalizeItems(this.getSelectedItems(false)),t).addCallback(function(t){if(false!==t)this.removeItemsSelectionAll()}.bind(this))},moveRecordDown:function(t){this._getMover().moveRecordDown(arguments[2]||t)},moveRecordUp:function(t){this._getMover().moveRecordUp(arguments[2]||t)},getMoveStrategy:function(){return this._moveStrategy||(this._moveStrategy=this._makeMoveStrategy())},_makeMoveStrategy:function(){if(this._options.moveStrategy)return R.resolve(this._options.moveStrategy,{dataSource:this.getDataSource(),hierField:this._options.parentProperty,parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty,listView:this})},setMoveStrategy:function(t){if(!x.instanceOfMixin(t,"WS.Data/MoveStrategy/IMoveStrategy"))throw new Error("The strategy must implemented interfaces the WS.Data/MoveStrategy/IMoveStrategy.");this._moveStrategy=t},_getMover:function(){if(!this._mover)this._mover=Q.make(this,{moveStrategy:this.getMoveStrategy(),items:this.getItems(),projection:this._getItemsProjection(),parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty,dataSource:this.getDataSource()});return this._mover},_hasMover:function(){return!!this._mover},move:function(t,e,i){return this._getMover().move(t,e,i)},isEnabledMove:function(){return this._options.enabledMove},setResultsPosition:function(t){this._options.resultsPosition=t},_observeResultsRecord:function(t){var e=t?"subscribeTo":"unsubscribeFrom",i;if(!this._onMetaDataResultsChange)this._onMetaDataResultsChange=function t(){this._headIsChanged=true,this._redrawResults(true)}.bind(this),this._onRecordSetPropertyChange=function t(e,i){if(i.metaData&&i.metaData.results)this.subscribeTo(i.metaData.results,"onPropertyChange",this._onMetaDataResultsChange);this._onMetaDataResultsChange()}.bind(this);if(!t||!this._isResultObserved())if(this.getItems())if(this[e](this.getItems(),"onPropertyChange",this._onRecordSetPropertyChange),i=this.getItems().getMetaData(),i&&i.results)this[e](i.results,"onPropertyChange",this._onMetaDataResultsChange)},_isResultObserved:function(){return this.getItems()&&this.getItems().getEventHandlers("onPropertyChange").indexOf(this._onRecordSetPropertyChange)>-1},_redrawFoot:function(){var t,e;if("function"===typeof this._options.footerTpl)e=$(".controls-ListView__footer",this._container[0]),this._destroyControls(e),t=$(this._options.footerTpl(this._options)),e.empty().append(t),this.reviveComponents(e)},_redrawResults:function(t){var e=$(".controls-ListView__results",this.getContainer()),i="top"==this._options.resultsPosition?"before":"after",o=this.getItems()&&this.getItems().getMetaData().results,s;if(e.length)this._destroyControls(e),e.remove();if(o&&this._options.resultsTpl&&"none"!==this._options.resultsPosition)s=y.prepareTemplate(this._options.resultsTpl)({item:o,multiselect:this._options.multiselect}),this._getItemsContainer()[i](s);if(t)this.reviveComponents($(".controls-ListView__results",this.getContainer()));this._resultsChanged=false},_setNewDataAfterReload:function(){if(this._resultsChanged=true,lt.superclass._setNewDataAfterReload.apply(this,arguments),this._resultsChanged&&this._getItemsProjection()&&this._getItemsProjection().isEventRaising())this._redrawResults(true)},deleteRecords:function(t,e){var i=this,s=new r,n;return t=Array.isArray(t)?o(t):[t],e=e||(1!==t.length?rk("Удалить записи?","ОперацииНадЗаписями"):rk("Удалить текущую запись?","ОперацииНадЗаписями")),H.showConfirmDialog({message:e,hasCancelButton:false,opener:i},function(){if(n=i._notify("onBeginDelete",t),n instanceof r)n.addCallback(function(e){i._deleteRecords(t,e)}).addErrback(function(t){H.showMessageDialog({message:t.message,opener:i,status:"error"})});else i._deleteRecords(t,n);s.callback(true)},function(){s.callback(false)},function(){s.callback()}),s},_deleteRecords:function(t,e){var i=this,o;if(false===e)e=at.CANCEL,a.resolve("ILogger").log("onBeginDelete","Boolean result is deprecated. Use constants ListView.BeginDeleteResult.");if(e!==at.CANCEL)this._toggleIndicator(true),this._deleteRecordsFromSource(t).addCallback(W(function(s){if(i.getDataSource()&&e!==at.WITHOUT_RELOAD)o=i._reloadViewAfterDelete(t).addCallback(function(){return i.removeItemsSelection(t),s});else i._deleteRecordsFromRecordSet(t),i.removeItemsSelection(t),o=r.success(s);return o},this)).addErrback(function(t){return H.showMessageDialog({message:t.message,opener:i,status:"error"}),t}).addBoth(function(e){i._toggleIndicator(false),i._notify("onEndDelete",t,e)})},_deleteRecordsFromSource:function(t){var e=this.getDataSource();return e?e.destroy(t):r.success(true)},_deleteRecordsFromRecordSet:function(t){var e,i=this.getItems();i.setEventRaising(false,true);for(var o=0;o<t.length;o++)if(e=i.getRecordById(t[o]),e)i.remove(e);return i.setEventRaising(true,true),r.success(true)},_reloadViewAfterDelete:function(){return this.reload()},_initLoadMoreButton:function(){if("demand"==this._options.infiniteScroll&&!this._loadMoreButton){if(this._loadMoreButton=this.getChildControlByName("loadMoreButton"),this.getItems())this._setLoadMoreCaption(this.getItems());this.subscribeTo(this._loadMoreButton,"onActivated",this._onLoadMoreButtonActivated.bind(this))}},getTextValue:function(){var t,e=[];if(this._options.multiselect)this.getSelectedItems().each(function(t){e.push(t.get(this._options.displayProperty))},this);else if(t=this.getItems().getRecordById(this.getSelectedKey()),t)e.push(t.get(this._options.displayProperty));return e.join(", ")},setItemsHover:function(t){this._options.itemsHover=t}});return lt.mixin([v])});
//# sourceMappingURL=ListView.js.map
define("SBIS3.CONTROLS/DataGridView",["Core/CommandDispatcher","Core/core-clone","Core/core-merge","Core/constants","Core/Deferred","Core/detection","Core/EventBus","Core/helpers/Function/memoize","SBIS3.CONTROLS/ListView","tmpl!SBIS3.CONTROLS/DataGridView/DataGridView","tmpl!SBIS3.CONTROLS/DataGridView/resources/rowTpl","tmpl!SBIS3.CONTROLS/DataGridView/resources/colgroupTpl","tmpl!SBIS3.CONTROLS/DataGridView/resources/headTpl","tmpl!SBIS3.CONTROLS/DataGridView/resources/footTpl","tmpl!SBIS3.CONTROLS/DataGridView/resources/ResultsTpl","SBIS3.CONTROLS/Mixins/DragAndDropMixin","SBIS3.CONTROLS/Utils/ImitateEvents","tmpl!SBIS3.CONTROLS/DataGridView/resources/DataGridViewGroupBy","WS.Data/Display/Ladder","SBIS3.CONTROLS/Utils/HtmlDecorators/LadderDecorator","SBIS3.CONTROLS/Utils/TemplateUtil","tmpl!SBIS3.CONTROLS/DataGridView/resources/ItemTemplate","tmpl!SBIS3.CONTROLS/DataGridView/resources/ItemResultTemplate","tmpl!SBIS3.CONTROLS/DataGridView/resources/ItemContentTemplate","tmpl!SBIS3.CONTROLS/DataGridView/resources/cellTemplate","tmpl!SBIS3.CONTROLS/DataGridView/resources/headColumnTpl","tmpl!SBIS3.CONTROLS/DataGridView/resources/GroupTemplate","tmpl!SBIS3.CONTROLS/DataGridView/resources/SortingTemplate","Core/helpers/Object/isEmpty","Core/helpers/String/escapeHtml","SBIS3.CONTROLS/Utils/TitleUtil","Core/Sanitize","Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager","css!SBIS3.CONTROLS/DataGridView/DataGridView"],function(t,e,i,o,s,r,l,n,a,h,c,d,_,u,p,f,m,g,C,S,w,v,T,y,P,b,I,H,D,V,R,O,G){"use strict";var k=function(t,i){for(var o=e(t),s=0;s<o.length;s++){if(o[s].cellTemplate)o[s].contentTpl=w.prepareTemplate(o[s].cellTemplate);else o[s].contentTpl=w.prepareTemplate(i._defaultCellTemplate);if(o[s].includedTemplates){var r=o[s].includedTemplates;o[s].included={};for(var l in r)if(r.hasOwnProperty(l))o[s].included[l]=w.prepareTemplate(r[l])}}return o},A=function(t,e){if(!e||!(0==e.indexOf("['")&&e.indexOf("']")==e.length-2))return V(t.get(e));for(var i=e.slice(2,-2).split("."),o=t,s,r=0;r<i.length;r++)if(r!==i.length-1)o=o.get(i[r]);else s=o.get(i[r]);return s},L=function(t,e,i,o,s){return s.indexOf(e)>-1&&!o.isPrimary(i,e)?"":t},E=function(t,e){t.ladder=e._ladderInstance,t.ladderColumns=e.ladder||[]},x=function(t){var e=t._buildTplArgsLV.call(this,t);return e.columns=k.call(this,t.columns,t),e.cellData={hierField:t.hierField,parentProperty:t.parentProperty,nodeProperty:t.nodeProperty,getColumnVal:A,getCellValue:L,decorators:e.decorators,highlightText:t.highlightText,displayField:e.displayProperty,displayProperty:e.displayProperty,escapeHtml:e.escapeHtml},e.startScrollColumn=t.startScrollColumn,e.columnsShift=t._columnsShift,e.hoveredColumn=t._hoveredColumn,E(e.cellData,t),e},B=function(t){for(var e=0;e<t.columns.length;e++){var i=t.columns[e];if(void 0===i.highlight)i.highlight=true}},M=function(t){var i={},o=e(t.columns),s,r,l,n,a,h;if(i.countRows=1,i.content=[[],[]],!t.transformHead)return i.content[1]=o,i;for(var c=0,d=o.length;c<d;c++){if(l=o[c],n=o[c+1],a=l.title||"",a.saveProtoM)a=""+a;if(a=a.split("."),h=n&&n.title||"",h.saveProtoM)h=""+h;if(h=h.split("."),!r)r=e(l);else a=[r.value,a];if(2==a.length){if(r.value=r.title=a[0],r.colspan=r.colspan||1,l.title=a[1],n&&a.length==h.length&&a[0]==h[0])n.title=h[1],r.colspan++;else{if(r.title){if(!r.className)r.className="";r.className+=" controls-DataGridView__th__topRow-has_text"}i.content[0].push(r),r=null}i.countRows=2}else r.rowspan=l.rowspan=2,i.content[0].push(r),r=null;if(!s)s=e(l);if(n&&s.title==n.title){if(l.rowspan)i.content[0].pop();s.colspan=++s.colspan||2}else{if(l.rowspan){var _=i.content[0].pop();_.colspan=s.colspan,_.value=_.title=s.title,i.content[0].push(_),s.ignore=true}i.content[1].push(s),s=null}}return i},N=function(t){var o={columns:e(t.columns),multiselect:t.multiselect,startScrollColumn:t.startScrollColumn,resultsPosition:t.resultsPosition,resultsTpl:w.prepareTemplate(t.resultsTpl),showHead:t.showHead},s,r,l=M(t);if(t.headTpl=w.prepareTemplate(t.headTpl),t.allowToggleHead&&t.emptyHTML)o.isVisible=t._itemsProjection&&t._itemsProjection.getCount();else o.isVisible=true;i(o,l);for(var n=0;n<o.content[1].length;n++){if(r=o.content[0][n],s=o.content[1][n],r)if(r.rowspan>1&&r.headTemplate)r.value=F(r);else r.value=j(r.title);if(s.sorting)s.value=W(s,t);else if(s.headTemplate)s.value=F(s);else s.value=j(s.title)}if(t._items&&t._items.getMetaData().results)q(t,o,t._items.getMetaData().results),o.hasResults=true;return o.sanitize=t.sanitize,o},W=function(t,e){var i=e.sorting,o;if(i instanceof Array)i.forEach(function(e){if(e[t.field])o=e[t.field]});return w.prepareTemplate(H)({column:t,sortingValue:o})},F=function(t){return w.prepareTemplate(t.headTemplate)({column:t})},j=function(t){return b({title:t})},q=function(t,e,i){for(var o=[],s,r,l=0,n=e.columns.length;l<n;l++){if(r=e.columns[l],s=i.get(r.field),void 0==s)s=0==l?t.resultsText:"";if(!r.resultTemplate)r.resultTemplate=T;else r.resultTemplate=w.prepareTemplate(r.resultTemplate);r.resultTemplateData={result:s,item:i,column:r,index:l,resultsText:t.resultsText},o.push(w.prepareTemplate(r.resultTemplate)(r.resultTemplateData))}e.results=o,e.item=i},z=function(t){return{columns:t.columns,multiselect:t.multiselect}},U=a.extend([f],{_dotTplFn:h,$protected:{_headIsChanged:false,_rowTpl:c,_rowData:[],_isPartScrollVisible:false,_movableElements:void 0,_arrowLeft:void 0,_arrowRight:void 0,_thumb:void 0,_stopMovingCords:{left:0,right:0},_partScrollRequestAnimationId:null,_currentScrollPosition:0,_scrollingNow:false,_partScrollRow:void 0,_isHeaderScrolling:false,_lastLeftPos:null,_options:{_footTpl:u,_colGroupTpl:d,_defaultCellTemplate:P,_defaultItemTemplate:v,_defaultItemContentTemplate:y,_canServerRender:true,_buildTplArgs:x,_buildTplArgsDG:x,_groupTemplate:I,_columnsShift:0,_hoveredColumn:{cells:null,columnIndex:null},columns:[],headTpl:_,showHead:true,startScrollColumn:void 0,ladder:void 0,resultsTpl:p,transformHead:false,allowToggleHead:true,stickyHeader:false,stickyGroup:true}},_modifyOptions:function(t,e){if(e._ladderInstance)t._ladderInstance=e._ladderInstance;else if(!t._ladderInstance)t._ladderInstance=e._ladderInstance=new C;var i=U.superclass._modifyOptions.apply(this,arguments);if(i.sanitize=function(t){return O(t.value,{validNodes:{component:true},validAttributes:{config:true}})},B(i),i._colgroupData=z(i),i._headData=N(i),i._footData=i._headData,!i.ladder)i.ladder=[];if(t._itemsProjection)t._ladderInstance.setCollection(t._itemsProjection);if(i._decorators.ladder=new S({ladderInstance:t._ladderInstance}),i._decorators.add(i._decorators.ladder),D(i.groupBy)||!i.stickyHeader)i.stickyGroup=false;return i},$constructor:function(){this._publish("onDrawHead","onChangeHeadVisibility"),this._tfoot=$(".controls-DataGridView__tfoot",this._container[0]),this._tbody=$(".controls-DataGridView__tbody",this._container[0])},init:function(){U.superclass.init.call(this),this._updateHeadAfterInit(),t.declareCommand(this,"ColumnSorting",this._setColumnSorting)},_onDataLoad:function(t){if(this._isPartScrollVisible&&this._currentScrollPosition&&this.getContainer().hasClass("controls-DataGridView__tableLayout-auto"))this._setPartScrollShift(0);U.superclass._onDataLoad.call(this,t)},_prepareConfig:function(){if(U.superclass._prepareConfig.apply(this,arguments),this._options._ladderInstance){var t=this._getItemsProjection();if(t)this._options._ladderInstance.setCollection(t)}},_updateHeadAfterInit:function(){this._bindHead()},_getCellContainerByElement:function(t){return t=t instanceof jQuery?t:$(t),t.closest(".controls-DataGridView__td, .controls-DataGridView__th",this.getContainer())},_getHoveredColumn:function(){return this._options._hoveredColumn},_mouseMoveHandler:function(t){U.superclass._mouseMoveHandler.apply(this,arguments);var e=this._getCellContainerByElement(t.target),i=this.getColumns(),o,s,r,l,n;if(e.length){if(o=e.index(),s=this._getHoveredColumn(),r=o-(this.getMultiselect()?1:0),i[r]&&!i[r].cellTemplate&&!e[0].getAttribute("title"))l=e.find(".controls-DataGridView__columnValue")[0],R.setTitle(l);if(s.columnIndex!==o)this._clearHoveredColumn(),s.columnIndex=o,this._updateHoveredColumnCells()}},_mouseLeaveHandler:function(){U.superclass._mouseLeaveHandler.apply(this,arguments),this._clearHoveredColumn()},_clearHoveredColumn:function(){var t=this._getHoveredColumn();if(null!==t.columnIndex)t.cells.removeClass("controls-DataGridView__hoveredColumn__cell"),t.cells=null,t.columnIndex=null},_updateHoveredColumnCells:function(){var t=this._getHoveredColumn();if(null!==t.columnIndex){var e=[],i,o;if(i=$(this._tbody[0].children),this._options.showHead)i.push(this.getTHead()[0].children[0]);for(var s=0,r=i.length;s<r;s++)if(o=i[s].children[t.columnIndex],o)e.push(o);t.cells=$(e).addClass("controls-DataGridView__hoveredColumn__cell")}},_notifyOnItemClick:function(t,e,i,o){var s=this._getCellContainerByElement(o.target),r={cellContainer:s,cellIndex:this._getHoveredColumn().columnIndex||s.index()};return this._notify("onItemClick",t,e,i,o,r)},_getItemsContainer:function(){return $(".controls-DataGridView__tbody",this._container).first()},_buildTplArgs:function(t){var e=U.superclass._buildTplArgs.apply(this,arguments);return e.columns=k.call(this,t.columns,this._options),e.cellData={hierField:t.hierField,parentProperty:t.parentProperty,nodeProperty:t.nodeProperty,getColumnVal:A,decorators:e.decorators,displayField:e.displayProperty,displayProperty:e.displayProperty,isSearch:e.isSearch,escapeHtml:e.escapeHtml},e.startScrollColumn=t.startScrollColumn,e.columnsShift=this._getColumnsScrollPosition(),E(e.cellData,t),e},_itemsReadyCallback:function(){var t=this._getItemsProjection();if(t)this._options._ladderInstance.setCollection(t);return U.superclass._itemsReadyCallback.apply(this,arguments)},_toggleIndicator:function(t){if(U.superclass._toggleIndicator.apply(this,arguments),!t)this._setMinHeight(""),this._getAjaxLoaderContainer().css({top:"",height:""})},_showIndicator:function(){U.superclass._showIndicator.apply(this,arguments),this._updateAjaxLoaderPosition()},_updateAjaxLoaderPosition:function(){var t,e;if(!this._thead)return;if(t=this._thead.outerHeight(),e={top:t||""},r.webkit)e.height=t?"calc(100% - "+t+"px)":"";this._getAjaxLoaderContainer().css(e),this._setMinHeight(t+this._getAjaxLoaderMinHeight()+"px")},_getMinHeightContainer:n(function(){return this.getContainer().find(".js-controls-DataGridView__minHeight")},"_getMinHeightContainer"),_setMinHeight:function(t){this._getMinHeightContainer().css("height",t)},_getAjaxLoaderMinHeight:n(function(){return parseInt(this._getAjaxLoaderContainer().css("min-height"),10)},"_getAjaxLoaderMinHeight"),_redrawHead:function(){var t,e;if(!this._thead)this._bindHead();(t=N(this._options)).columnsShift=this._getColumnsScrollPosition(),t.thumbPosition=this._currentScrollPosition,e=this._options.headTpl(t);var i=$(".controls-DataGridView__tbody",this._container),o=$(e);if(this._options.stickyHeader)this._toggleEventHandlers(o,true);if(this._thead&&this._thead.length)this._destroyControls(this._thead),this._thead.replaceWith(o),this._thead=o;else this._thead=o.insertBefore(i);if(this._redrawColgroup(),this.hasPartScroll())this.getContainer().removeClass("controls-DataGridView__PartScroll__shown");if(this._bindHead(),this._options.stickyHeader&&!this._options.showHead&&"top"===this._options.resultsPosition)this._updateStickyHeader(t.hasResults)},_redrawFoot:function(){var t=N(this._options),e=$(this._options._footTpl(t));if(this._tfoot&&this._tfoot.length)this._destroyControls(this._tfoot),this._tfoot.replaceWith(e),this._tfoot=e;U.superclass._redrawFoot.call(this)},_redrawTheadAndTfoot:function(){this._redrawHead(),this._redrawFoot(),this._headIsChanged=true},_bindHead:function(){var t=this._getTableContainer();if(!this._thead)this._thead=t.find(">.controls-DataGridView__thead");if(this._colgroup=t.find(">.controls-DataGridView__colgroup"),this._options.showHead)this._isPartScrollVisible=false;if(this.hasPartScroll())this._initPartScroll(),this.updateDragAndDrop(),this._setColumnWidthForPartScroll()},getTHead:function(){return this._thead},setStickyHeader:function(t){if(this._options.stickyHeader!==t){if(this._options.stickyHeader=t,t&&!this._options.showHead)return;this._getTableContainer().toggleClass("ws-sticky-header__table",t)}},_updateStickyHeader:function(t){if(!this._options.stickyHeader)return;var e=this._getTableContainer();if(e.hasClass("ws-sticky-header__table")===t)return;if(e.toggleClass("ws-sticky-header__table",Boolean(t)),t)l.channel("stickyHeader").notify("onForcedStickHeader",this.getContainer());else G.unfixOne(e,true)},_redrawColgroup:function(){var t,e,i;e=z(this._options),t=d(e),i=$(".controls-DataGridView__tbody",this._container);var o=$(t);if(this._colgroup&&this._colgroup.length)this._colgroup.replaceWith(o),this._colgroup=o;else this._colgroup=o.insertBefore(this._thead||i)},_drawItemsCallback:function(){if(this.hasPartScroll()){if(!this._thead)this._bindHead();this._updatePartScroll()}if(U.superclass._drawItemsCallback.call(this),o.browser.isIE)$("<div></div>").appendTo(this._getTableContainer()).remove()},_editFieldFocusHandler:function(t){if(this._itemsToolbar)this._hideItemsToolbar();if(this._isPartScrollVisible)this._scrollToEditControl(t)},_onResizeHandler:function(){if(U.superclass._onResizeHandler.apply(this,arguments),this._containerOffsetWidth=this.getContainer().outerWidth(),this.hasPartScroll())this._updatePartScroll()},redrawItem:function(){if(U.superclass.redrawItem.apply(this,arguments),this.hasPartScroll())this.updateScrollAndColumns()},_redrawItems:function(){this._redrawTheadAndTfoot(),U.superclass._redrawItems.apply(this,arguments)},_startEditOnItemClick:function(t,e,i,s,l){var n,a;if(this._canStartEditOnItemClick(s)){if(!this._options.editingTemplate)if(n=$(s).closest(".controls-DataGridView__td"),n.length)a=n.index();t.setResult(this.showEip(i,{isEdit:true},false,a).addCallback(function(t){if("click"===l.type)if(!o.browser.isMobileIOS||r.IOSVersion<11)m.imitateFocus(l.clientX,l.clientY);return!t}).addErrback(function(){return true}))}},showEip:function(t,e,i,o){return this._canShowEip(o)?this._getEditInPlace().addCallback(function(o){return o.showEip(t,e,i)}):s.fail()},_canShowEip:function(t){var e=this,i=0,o=this.isEnabled(),s=function(t){return!!e._options.columns[t].editor&&(o||false===e._options.columns[t].allowChangeEnable)};if(this._options.editingTemplate||void 0===t)while(!o&&i<this._options.columns.length)if(false===this._options.columns[i].allowChangeEnable)o=true;else i++;else o=this._options.multiselect?t>0&&s(t-1):s(t);return o},_getEditInPlaceConfig:function(){var t=this,e=this._options.enabled?this._options.columns:[];if(!this._options.enabled)this._options.columns.forEach(function(t){e.push(false===t.allowChangeEnable?t:{})});return i(U.superclass._getEditInPlaceConfig.apply(this,arguments),{columns:e,getCellTemplate:function(t,e){return this._getCellTemplate(t,e)}.bind(this),handlers:{onInitEditInPlace:function(e,i){var o,s;if(!t._options.editingTemplate&&t.hasPartScroll()){if(o=i.getContainer().find("td"),s=t._options.startScrollColumn,t._options.multiselect)s+=1;for(var r=0,l=o.length;r<l;r++)o.eq(r).addClass(s<=r?"controls-DataGridView__scrolledCell":"controls-DataGridView__notScrolledCell");i.subscribe("onChildControlFocusIn",function(e,i){t._scrollToEditControl(i)}),t.updateScrollAndColumns(true)}}}},{preferSource:true})},hasPartScroll:function(){return void 0!==this._options.startScrollColumn},_updatePartScroll:function(){var t=this._isTableWide();this._isPartScrollVisible?t?this.updateScrollAndColumns():this._hidePartScroll():t?this._showPartScroll():this._hidePartScroll()},_initPartScroll:function(){(this._arrowLeft=this._thead.find(".controls-DataGridView__PartScroll__arrowLeft")).click(this._arrowClickHandler.bind(this,true)),(this._arrowRight=this._thead.find(".controls-DataGridView__PartScroll__arrowRight")).click(this._arrowClickHandler.bind(this,false)),(this._thumb=this._thead.find(".controls-DataGridView__PartScroll__thumb")).mousedown(this._thumbClickHandler.bind(this)),this._partScrollRow=this._thead.find(".controls-DataGridView__PartScroll__row"),this.initializeDragAndDrop()},_scrollToEditControl:function(t){var e=t.getContainer()[0].getBoundingClientRect(),i=this._container[0].getBoundingClientRect(),o=i.left+this._stopMovingCords.left,s;if(e.right>i.right)s=this._currentScrollPosition+(e.right-i.right)/this._partScrollRatio;else if(e.left<o)s=this._currentScrollPosition-(o-e.left)/this._partScrollRatio;if(s)this._moveThumbAndColumns({left:s},true)},_setColumnWidthForPartScroll:function(){for(var t=this._colgroup.find("col"),e=this.getColumns(),i=0,s,r,l,n=0;n<e.length;n++)i+=e[n].width&&parseInt(e[n].width)||e[n].minWidth&&parseInt(e[n].minWidth)||0;if(o.browser.isIE&&this._containerOffsetWidth)s=this._containerOffsetWidth;else s=this._container[0].offsetWidth;if(i>s)for(var a=0;a<e.length;a++)if(r=this._options.multiselect?a+1:a,l=e[a].minWidth&&parseInt(e[a].minWidth,10),l)t[r].width=l+"px"},_dragStart:function(t){if(o.$body.addClass("ws-unSelectable"),this._isHeaderScrolling=t.currentTarget!==this._thumb[0]&&this._thead&&this._thead.find(t.currentTarget).length,this._isHeaderScrolling)this.getContainer().addClass("controls-DataGridView__scrollingNow");if(this._touchSupport)this._thumb.focus();this._scrollingNow=true},updateScrollAndColumns:function(t){this._updatePartScrollWidth(),this._findMovableCells(),this._moveThumbAndColumns({left:this._currentScrollPosition},t)},_arrowClickHandler:function(t){var e=this._getPartScrollContainer()[0].offsetWidth/100*5;this._moveThumbAndColumns({left:(parseInt(this._thumb[0].style.left)||0)+(t?-e:e)})},_thumbClickHandler:function(){this._thumb.addClass("controls-DataGridView__PartScroll__thumb-clicked")},_dragEnd:function(){if(o.$body.removeClass("ws-unSelectable"),this._isHeaderScrolling)this.getContainer().removeClass("controls-DataGridView__scrollingNow");this._thumb.removeClass("controls-DataGridView__PartScroll__thumb-clicked"),this._scrollingNow=false,this._lastLeftPos=null},_getDragAndDropContainer:function(){return this._thead.find(".controls-DataGridView__PartScroll__thumb, .controls-DataGridView__scrolledCell")},_getPartScrollContainer:function(){return this._thead.find(".controls-DataGridView__PartScroll__container")},_dragMove:function(t,e){if(this._isHeaderScrolling){var i;if(!this._isPartScrollVisible)return;if(null===this._lastLeftPos)this._lastLeftPos=e.left;i=this._currentScrollPosition-(e.left-this._lastLeftPos),this._lastLeftPos=e.left,e.left=i}this._moveThumbAndColumns(e)},_moveThumbAndColumns:function(t,e){var i=this;if(this._cancelScrollRequest(),!e)this._partScrollRequestAnimationId=window.requestAnimationFrame(function(){i._scrollColumns(t)});else this._scrollColumns(t)},_cancelScrollRequest:function(){if(this._partScrollRequestAnimationId)window.cancelAnimationFrame(this._partScrollRequestAnimationId),this._partScrollRequestAnimationId=null},_scrollColumns:function(t){this._setPartScrollShift(t);for(var e="translateX("+Math.round(this._getColumnsScrollPosition())+"px)",i=0,o=this._movableElems.length;i<o;i++)this._movableElems[i].style.transform=e},_setPartScrollShift:function(t){this._currentScrollPosition="object"===typeof t?this._checkThumbPosition(t):this._checkThumbPosition({left:t}),this._options._columnsShift=-this._currentScrollPosition*(this._partScrollRatio||0),this._thumb[0].style.left=this._currentScrollPosition+"px"},_getColumnsScrollPosition:function(){return this._options._columnsShift},_updatePartScrollWidth:function(){var t=this._container[0].offsetWidth,e=this._getPartScrollContainer(),i=this._thumb[0].offsetWidth,o=0,s=this._stopMovingCords.right,r=2*this._arrowRight[0].offsetWidth,l,n;if(this._options.startScrollColumn>0){for(var a=0,h=(l=this._thead.find("tr").eq(0).find(".controls-DataGridView__notScrolledCell")).length;a<h;a++)o+=l[a].offsetWidth;e[0].style.marginLeft=o+"px"}if(e[0].style.width=t-o+"px",this._partScrollRatio=(this._getTableContainer()[0].offsetWidth-t)/(t-o-i-r),this._stopMovingCords={right:e[0].offsetWidth-i-r,left:o},n=this._checkThumbPosition({left:this._currentScrollPosition}),this._currentScrollPosition!==n||s<this._stopMovingCords.right)this._currentScrollPosition=n,this.updateScrollAndColumns()},_findMovableCells:function(){this._movableElems=this._container.find("tbody .controls-DataGridView__scrolledCell").add(this._thead.find(".controls-DataGridView__scrolledCell"))},_checkThumbPosition:function(t){if(t.left<=0)return this._toggleActiveArrow(this._arrowLeft,false),0;else if(!this._arrowLeft.hasClass("icon-primary"))this._toggleActiveArrow(this._arrowLeft,true);if(t.left>=this._stopMovingCords.right)return this._toggleActiveArrow(this._arrowRight,false),this._stopMovingCords.right;else if(!this._arrowRight.hasClass("icon-primary"))this._toggleActiveArrow(this._arrowRight,true);return t.left},_toggleActiveArrow:function(t,e){t.toggleClass("icon-disabled",!e).toggleClass("icon-primary action-hover",e)},_isTableWide:function(){return this._container[0].offsetWidth<this._getTableContainer()[0].offsetWidth},_hidePartScroll:function(){if(this._isPartScrollVisible){if(this._partScrollRow.addClass("ws-hidden"),this._isPartScrollVisible=false,this.getContainer().removeClass("controls-DataGridView__PartScroll__shown"),0!==this._currentScrollPosition)this._moveThumbAndColumns({left:0});this._resizeChilds()}},_showPartScroll:function(){if(!this._isPartScrollVisible)this._partScrollRow.removeClass("ws-hidden"),this.getContainer().addClass("controls-DataGridView__PartScroll__shown"),this._updatePartScrollWidth(),this._findMovableCells(),this._isPartScrollVisible=true,this._resizeChilds()},isNowScrollingPartScroll:function(){return this._scrollingNow},getColumns:function(){return this._options.columns},setColumns:function(t){if(this._options.columns=t,this.hasPartScroll())this._setPartScrollShift(0);B(this._options),this._updateEditInPlaceColumns(this._options.columns)},_updateEditInPlaceColumns:function(t){if(this._hasEditInPlace())this._getEditInPlace().addCallback(function(e){e.setColumns(t)}),this._destroyEditInPlace()},_oldRedraw:function(){U.superclass._oldRedraw.apply(this,arguments),this._redrawTheadAndTfoot()},setMultiselect:function(){if(U.superclass.setMultiselect.apply(this,arguments),this._updateEditInPlaceColumns(),this.getItems())this.redraw();else if(this._options.showHead)this._redrawTheadAndTfoot(),this.reviveComponents(this._thead),this._notify("onDrawHead"),this._headIsChanged=false,this.reviveComponents(this._tfoot)},_toggleEmptyData:function(t){if(U.superclass._toggleEmptyData.apply(this,arguments),this.getContainer().toggleClass("controls-DataGridView__emptyTable",!!t),this._options.emptyHTML&&this._options.allowToggleHead){if(this._thead)this._thead.toggleClass("ws-hidden",!!t);this._notify("onChangeHeadVisibility")}},_showItemsToolbar:function(t){if(!this.isNowScrollingPartScroll())U.superclass._showItemsToolbar.call(this,t)},_getLeftOfItemContainer:function(t){return $(".controls-DataGridView__td",t.get(0)).first()},_getGroupTpl:function(){return this._options.groupBy.template||g},_prepareItemsData:function(){var t=U.superclass._prepareItemsData.apply(this,arguments);return this._addStickyToGroups(t.records),t},_getItemsForRedrawOnAdd:function(t){var e=U.superclass._getItemsForRedrawOnAdd.apply(this,arguments);return this._addStickyToGroups(e),e},_addStickyToGroups:function(t){if(this._options.stickyHeader&&!D(this._options.groupBy))t.forEach(function(t){if(t.hasOwnProperty("data")&&t.hasOwnProperty("tpl"))t.data.stickyHeader=this._options.stickyHeader},this)},_redrawResults:function(t){if(this._headIsChanged&&"none"!==this._options.resultsPosition)if(this._redrawTheadAndTfoot(),t){var e=this;this.reviveComponents(this._thead).addCallback(function(){e._notify("onDrawHead"),e._headIsChanged=false}),this.reviveComponents(this._tfoot)}},destroy:function(){if(this.hasPartScroll())this._cancelScrollRequest(),this._thumb.unbind("click"),this._thumb=void 0,this._arrowLeft.unbind("click"),this._arrowLeft=void 0,this._arrowRight.unbind("click"),this._arrowRight=void 0,this._movableElems=[];if(this._options.showHead&&this._options.stickyHeader&&this._thead)this._toggleEventHandlers(this._thead,false);if(this._options.stickyHeader&&!this._options.showHead&&"top"===this._options.resultsPosition)this._updateStickyHeader(false);this._thead=void 0,this._tbody=void 0,this._tfoot=void 0,U.superclass.destroy.call(this)},_setColumnSorting:function(t,e){var i,o,s=true;if(i=this.getSorting(),"single"!=e||1==i.length&&i[0][t])o=i.filter(function(e){if("ASC"==e[t])return s=false,false;else if("DESC"==e[t])return e[t]="ASC",s=false,true;else return true});else o=[];if(s){var r={};r[t]="DESC",o.push(r)}this.setSorting(o)},_getCellTemplate:function(t,e){var i=this._getColumnValue(t,e.field);if(e.cellTemplate){var o=w.prepareTemplate(e.cellTemplate),s={item:t,hierField:this._options.hierField,parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty,isNode:t.get(this._options.nodeProperty),decorators:this._options._decorators,field:e.field,value:i,highlight:e.highlight,ladderColumns:this._options.ladder};if(e.templateBinding)s.templateBinding=e.templateBinding;if(e.includedTemplates){var r=e.includedTemplates;s.included={};for(var l in r)if(r.hasOwnProperty(l))s.included[l]=w.prepareTemplate(r[l])}i=o(s)}else{if(Array.indexOf(this._options.ladder,e.field)>-1&&!this._options._ladderInstance.isPrimary(t,e.field))i=null;i=this._options._decorators.applyOnly(void 0===i||null===i?"":V(i),{highlight:e.highlight})}return i},_getColumnValue:function(t,i){if(!i||!this._isCompositeRecordValue(i))return t.get(i);for(var o=i.slice(2,-2).split("."),s=e(t),r,l=0;l<o.length;l++)if(l!==o.length-1)s=s.get(o[l]);else r=s.get(o[l]);return r},_isCompositeRecordValue:function(t){return 0==t.indexOf("['")&&t.indexOf("']")==t.length-2},_getTableContainer:function(){return this.getContainer().find(">.controls-DataGridView__table")},_reviveItems:function(){if(0==this._container.find(this._thead).length)this.reviveComponents(this._thead);U.superclass._reviveItems.apply(this,arguments)},_onReviveItems:function(t,e){if(this._headIsChanged&&!e)this._notify("onDrawHead"),this._headIsChanged=false;U.superclass._onReviveItems.apply(this,arguments)}});return U});
//# sourceMappingURL=DataGridView.js.map
define("SBIS3.CONTROLS/Tree/DataGridView",["Core/core-merge","Core/constants","Core/CommandDispatcher","SBIS3.CONTROLS/Utils/Contains","SBIS3.CONTROLS/DataGridView","tmpl!SBIS3.CONTROLS/Tree/DataGridView/TreeDataGridView","SBIS3.CONTROLS/Mixins/TreeMixin","SBIS3.CONTROLS/Mixins/TreeViewMixin","SBIS3.CONTROLS/Button/IconButton","tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/ItemTemplate","tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/ItemContentTemplate","tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/FooterWrapperTemplate","tmpl!SBIS3.CONTROLS/Tree/DataGridView/resources/searchRender","Core/helpers/Function/runDelayed","Core/helpers/Function/forAliveOnly","Core/ConsoleLogger","SBIS3.CONTROLS/Link","css!SBIS3.CONTROLS/Tree/DataGridView/TreeDataGridView","css!SBIS3.CONTROLS/Tree/View/TreeView"],function(e,t,i,r,o,s,n,a,d,l,h,c,p,_,u){var g=24,f=12,w=5,m=26,C=1,I=function(t){var i,r;return i=t._buildTplArgsDG.call(this,t),r=t._buildTplArgsTV.call(this,t),e(i,r),i.arrowActivatedHandler=t.arrowActivatedHandler,i.editArrow=t.editArrow,i.hasScroll=void 0!==i.startScrollColumn,i.foldersColspan=t.foldersColspan,i.getItemContentTplData=A,i.hasChildrenProperty=t.hasChildrenProperty,i.partialyReload=t.partialyReload,i.expanderDisplayMode=t.expanderDisplayMode,i.cellData.isSearch=r.isSearch,i},y=function(e){return{idProperty:e.idProperty,displayProperty:e.displayProperty,highlightEnabled:e.highlightEnabled,highlightText:e.highlightText,colorMarkEnabled:e.colorMarkEnabled,colorField:e.colorField,allowEnterToFolder:e.allowEnterToFolder,task1173671799:e.task1173671799,colspan:e.columns.length,multiselect:e.multiselect}},S=function(e){var t=e._getFolderFooterOptionsTVM.apply(this,arguments);return t.colspan=e.columns.length,t},T=function(){return false},v=function(e){var t={nodePropertyValue:e.item.get(e.nodeProperty),projection:e.projItem.getOwner()};if(t.children=e.hierarchy.getChildren(e.item,t.projection.getCollection()),t.isLoaded=e.projItem.isLoaded(),t.classIsLoaded=t.isLoaded?" controls-ListView__item-loaded":"",e.partialyReload&&"withChild"===e.expanderDisplayMode&&!t.isLoaded)t.hasLoadedChild=e.item.get(e.hasChildrenProperty);else t.hasLoadedChild=t.children.length>0;if(t.classHasLoadedChild=t.hasLoadedChild?" controls-ListView__item-with-child":" controls-ListView__item-without-child",t.classNodeType=" controls-ListView__item-type-"+(null==t.nodePropertyValue?"leaf":true==t.nodePropertyValue?"node":"hidden"),t.classNodeState=null!==t.nodePropertyValue?" controls-TreeView__item-"+(e.projItem.isExpanded()?"expanded":"collapsed"):"",t.classIsSelected=e.selectedKey==e.item.getId()?" controls-ListView__item__selected":"",t.isColumnScrolling=void 0!==e.startScrollColumn,t.columnsShift=e.columnsShift,t.addClasses="controls-DataGridView__tr controls-ListView__item js-controls-ListView__item "+(e.className?e.className:"")+t.classNodeType+t.classNodeState+t.classIsLoaded+t.classHasLoadedChild+t.classIsSelected,e.selectedKey===e.item.get(e.idProperty))t.addClasses+=" controls-ListView__item__selected";return t},A=function(e){var t={};return t.hierField$=e.projItem.getContents().get(e.parentProperty+"$"),t.hasScroll=void 0!==e.startScrollColumn,t.itemLevel=e.projItem.getLevel()-1,t.isNode=e.projItem.getContents().get(e.nodeProperty),t.hasChilds=e.hierarchy.getChildren(e.item,e.projItem.getOwner().getCollection()).length>0,t},V=o.extend([n,a],{_dotTplFn:s,$protected:{_options:{_buildTplArgs:I,_buildTplArgsTDG:I,_canServerRender:true,_defaultItemTemplate:l,_defaultItemContentTemplate:h,_defaultSearchRender:p,_getItemTemplateData:v,_footerWrapperTemplate:c,_getFolderFooterOptions:S,_getSearchCfg:y,_hasFolderFooters:T,arrowActivatedHandler:void 0,editArrow:false,foldersColspan:false,expandByItemClick:true},_dragStartHandler:void 0,_editArrow:void 0},$constructor:function(){i.declareCommand(this,"loadNode",this._folderLoad)},init:function(){var e=this;if(V.superclass.init.call(this),this.once("onDrawItems",function(){this._options._ladderInstance._columnNames.forEach(function(t){e._options._ladderInstance.setConverter(t,function(t,i){if(e._isSearchMode()&&(!i.get||i.get(e._options.nodeProperty)))return;else return t})})}),this._options._serverRender)this._createAllFolderFooters()},redraw:function(){if(this._hideEditArrow(),V.superclass.redraw.apply(this,arguments),this._getItemsProjection())this._createAllFolderFooters();this.once("onDrawItems",function(){this._checkBreadCrumbsWidth()})},_afterAddItems:function(){V.superclass._afterAddItems.apply(this,arguments),this._checkBreadCrumbsWidth()},_checkBreadCrumbsWidth:function(){if((this._options.startScrollColumn||this.getContainer().hasClass("controls-DataGridView__tableLayout-auto"))&&this._isSearchMode()){var e=this.getContainer().find(".controls-TreeView__searchBreadCrumbs"),t,i,r,o;if(e.length){if(t=$("td:first",this._getItemsContainer()),i=this._options.multiselect?t.outerWidth():0,r=t.next("td"),!r.length)r=t;o=r.outerWidth()-r.width(),e.width(this.getContainer().width()-o-i)}}},_drawItemsCallback:function(){var e=this.getItemsActions();if(e)e.ready(function(){this._updateEditArrow()}.bind(this));V.superclass._drawItemsCallback.apply(this,arguments)},_getInsertMarkupConfig:function(e,t){var i=V.superclass._getInsertMarkupConfig.apply(this,arguments),r=this._options._itemsProjection.at(e-1),o,s,n,a;if(i.inside&&!i.prepend)if(i.inside=false,o=r&&r.isNode?r.getContents().get(this._options.parentProperty):void 0,a=t[0].isNode?t[0]:t[1],s=a?a.getContents().get(this._options.parentProperty):void 0,this._isSearchMode()&&o!==s)if(n=this._getItemsContainer().find('.controls-DataGridView__tr.controls-HierarchyDataGridView__path[data-id="'+s+'"]'),n.length)i.container=n;else i.container=this._getDomElementByItem(r);else i.container=this._getDomElementByItem(r);if(this._isSearchMode()&&!i.container.length&&r&&r.isNode&&r.isNode())i.container=this._getItemsContainer().find('.js-controls-BreadCrumbs__crumb[data-id="'+r.getContents().getId()+'"]').parents(".controls-DataGridView__tr.controls-HierarchyDataGridView__path");return i},_getEditorOffset:function(e,t){var i=this.getContainer(),r=this._getItemProjectionByItemId(e.get(this._options.parentProperty)),o=!this._isSearchMode()&&r?r.getLevel()*this._getLevelPaddingWidth():0,s=i.hasClass("controls-ListView__multiselect"),n=0,a;if(this._options.editingTemplate&&s)n=i.hasClass("controls-ListView__hideCheckBoxes")?f:g;if(a=n+this._getRowPadding(t)+o+(this._isSearchMode()||i.hasClass("controls-TreeView__hideExpands")?0:m),!this._options.editingTemplate&&s)a+=C;else a-=w;return a},_getRowPadding:function(e){var t=e.find(".controls-DataGridView__firstContentCell").get(0);return t?parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-left")):0},_getLevelPaddingWidth:function(){var e=$('<div class="controls-TreeDataGridView__levelPadding" style="position: absolute; visibility: hidden;">'),t;return e.appendTo(this._getItemsContainer()),t=parseInt(e.width()),e.remove(),t},_keyboardHover:function(e){var i=V.superclass._keyboardHover.apply(this,arguments),r,o;if(e.which===t.key.right||e.which===t.key.left)if(r=this.getSelectedKey(),o=this.getItems().getRecordById(r),o&&o.get(this._options.nodeProperty))this[e.which===t.key.right?"expandNode":"collapseNode"](r);return i},collapseNode:function(e,t){return this._hideItemsToolbar(),V.superclass.collapseNode.apply(this,arguments)},expandNode:function(e,t){var i=this,r;return this._hideItemsToolbar(),r=V.superclass.expandNode.apply(this,arguments),r.addCallback(function(e){return i._updateHoveredColumnCells(),e}),r},getEditArrow:function(){var e=this;if(!this._editArrow&&(this._options.editArrow||this._options.arrowActivatedHandler))this._editArrow=new d({element:this._container.find("> .controls-TreeView__editArrow-container"),icon:"icon-View icon-size",cssClassName:"ws-hidden",parent:this,allowChangeEnable:false,handlers:{onActivated:function(){var t=e.getHoveredItem().key;e._activateItem(t),e._itemActionActivated(t)}}});return this._editArrow},_getEditArrowPosition:function(e,t,i){var r=this._container[0].getBoundingClientRect(),o=this._getItemsToolbar().getContainer(),s,n,a,d,l;if(s=parseInt(e.css("padding-right"),10),2===i.length)if(e[0].getBoundingClientRect().right-s<t[0].getBoundingClientRect().right)i=i[1];else i=i[0];else i=i[0];if(n=i.getBoundingClientRect(),a=n.left-r.left,this._isSupportedItemsToolbar()&&this._getItemsToolbar().isVisible()){if(d=o[0].offsetLeft,this._options.itemsActionsInItemContainer)l=this.getContainer().width()-(a+n.width)-o.width()<0;else l=d&&d<a+n.width;if(l)a-=a-d+this.getEditArrow().getContainer().outerWidth(true);this.getEditArrow().getContainer().toggleClass("controls-TreeView__editArrow-background",l)}return{top:n.top-r.top+this._container[0].scrollTop,left:a}},_getEditArrowMarker:function(e){var t=e.find(".js-controls-TreeView__editArrow");if(!t.length)t=e.find(".controls-TreeView__editArrow");return t},_onChangeHoveredItem:function(){if(V.superclass._onChangeHoveredItem.apply(this,arguments),!this._touchSupport||!this._hasHoveredItem())this._updateEditArrow()},_onAfterBeginEdit:function(){V.superclass._onAfterBeginEdit.apply(this,arguments),this._updateEditArrow()},_onAfterEndEdit:function(){V.superclass._onAfterEndEdit.apply(this,arguments),this._updateEditArrow()},_updateEditArrow:function(){if(this._options.editArrow||this._options.arrowActivatedHandler)if(this._hasHoveredItem())this._showEditArrow();else this._hideEditArrow()},reload:function(){return this._hideEditArrow(),V.superclass.reload.apply(this,arguments)},_showEditArrow:function(){var e=this.getHoveredItem(),t,i,r,o,s,n;if(this._hasHoveredItem())s=this._getItemsProjection().getItemBySourceItem(e.record);if(s&&s.isNode()&&this.getEditArrow().isVisible()&&!this._isSearchMode())_(u(function(){if(n=e.container,i=n.find(".controls-TreeView__folderTitle"),r=i.closest(".controls-DataGridView__td",n),o=this._getEditArrowMarker(r),o.length)(t=this.getEditArrow().getContainer()).removeClass("ws-hidden"),t.css(this._getEditArrowPosition(r,i,o))},this));else this._hideEditArrow()},_hideEditArrow:function(){if(this._editArrow)this._editArrow.getContainer().addClass("ws-hidden")},_onLeftSwipeHandler:function(){if(V.superclass._onLeftSwipeHandler.apply(this,arguments),this._options.editArrow||this._options.arrowActivatedHandler)this._showEditArrow()},_onRightSwipeHandler:function(){if(this._options.editArrow||this._options.arrowActivatedHandler)this._hideEditArrow();V.superclass._onRightSwipeHandler.apply(this,arguments)},_mouseDownHandler:function(e){if(e.originalEvent.detail>1&&this._needProcessMouseEvent(e))e.preventDefault();V.superclass._mouseDownHandler.apply(this,arguments)},_isHoverControl:function(e){var t=V.superclass._isHoverControl.apply(this,arguments);if(!t&&(this._options.editArrow||this._options.arrowActivatedHandler))return r(this.getEditArrow().getContainer()[0],e[0])||this.getEditArrow().getContainer()[0]===e[0];return t},_addItemAttributes:function(e,t){V.superclass._addItemAttributes.call(this,e,t);var i=t.getContents(),r=i.get(this._options.nodeProperty),o=null==r?"leaf":true==r?"node":"hidden";e.addClass("controls-ListView__item-type-"+o);var s=i.getId(),n=i.get(this._options.parentProperty),a=$('.controls-ListView__item[data-id="'+n+'"]',this._getItemsContainer().get(0)).get(0);if(e.attr("data-parent",n),this._options.openedPath[s])if(this._options._getHierarchyRelation(this._options).getChildren(s,this.getItems()).length)$(".js-controls-TreeView__expand",e).addClass("controls-TreeView__expand__open");else delete this._options.openedPath[s];if("undefined"!=typeof n&&null!==n&&a){var d=parseInt($(".controls-TreeView__expand",a).parent().css("padding-left"));$(".controls-TreeView__expand",e).parent().css("padding-left",d+this._options.paddingSize)}},_elemClickHandlerInternal:function(e,t,i,r){var o=$(i),s=this._findExpandByElement(o);if(o.hasClass("js-controls-TreeView__editArrow")||o.hasClass("js-controls-ListView__itemCheckBox"))return;if(s.hasClass("js-controls-TreeView__expand")){if("append"==this._options.loadItemsStrategy){var n=this._findItemByElement($(i)).attr("data-hash");this.toggleNode(t,n)}else this.toggleNode(t);return}if(this._options.allowEnterToFolder)if(o.hasClass("js-controls-TreeView__editArrow")||o.hasClass("js-controls-ListView__itemCheckBox"))return false;else if(e.get(this._options.nodeProperty))this.setCurrentRoot(t),this.reload();else this._activateItem(t);else if(e.get(this._options.nodeProperty)){if(!this._options.hierarchyViewMode&&this._options.expandByItemClick)this.toggleNode(t)}else this._activateItem(t)},_groupByDefaultMethod:function(e){if(e.get(this._options.parentProperty)!=this.getCurrentRoot())return false;return V.superclass._groupByDefaultMethod.apply(this,arguments)},_getEditInPlaceConfig:function(){var e=V.superclass._getEditInPlaceConfig.apply(this,arguments);return e.getEditorOffset=this._getEditorOffset.bind(this),e.parentProperty=this._options.parentProperty,e.currentRoot=this.getCurrentRoot(),e},_canStartEditOnItemClick:function(e){return!$(e).hasClass("js-controls-TreeView__expand")&&V.superclass._canStartEditOnItemClick.apply(this,arguments)},_onDragHandler:function(e,t){o.superclass._onDragHandler.call(this,e,t),this._onDragCallback(e,t)}});return V});
//# sourceMappingURL=DataGridView.js.map
define("tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},r=function e(r,o,s,a,n){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var m="string"==typeof s?s:"",u=void 0===i?void 0:i,g={id:[],def:void 0},h=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),v=this&&this.includedTemplates?this.includedTemplates:{},w=c.getMarkupGenerator(a);try{var f=w.joinElements([void(v.tileTemplate=function(e,t){var i=this&&this.includedTemplates?this.includedTemplates:{},r=c.getMarkupGenerator(a);try{var o=r.joinElements([r.createTag("div",{class:"controls-CompositeView__tileItem controls-ListView__item js-controls-ListView__item"+c.wrapUndef(c.utils.escape(c.getter(e,["tileMode"])?"":" controls-CompositeView__verticalItemActions js-controls-CompositeView__verticalItemActions"))+c.wrapUndef(c.utils.escape(c.getter(e,["className"]))),"data-hash":""+c.wrapUndef(c.utils.escape(c.getter(e,["projItem","getHash"]).apply(c.getter(e,["projItem"]),[]))),"data-id":""+c.wrapUndef(c.utils.escape(c.getter(e,["item","getId"]).apply(c.getter(e,["item"]),[]))),style:""+c.wrapUndef(c.utils.escape("tile"===c.getter(e,["viewMode"])&&"dynamic"===c.getter(e,["tileMode"])?"max-width: "+c.getter(e,["width"])+"px; flex-basis: "+(c.getter(e,["width"])+c.getter(e,["minWidth"]))/2+"px;":""))},[r.createTag("div",{class:"controls-CompositeView__tileContainer"},[r.createControl("resolver",c.getter(e,["tileContent"]),c.uniteScope(c.utils.escape(c.uniteScope(e,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,u,i,c.config,d,g)],{},g,this)],t,g,this)],m,g);g.def&&(o=r.chain(o,g,t),g=void 0)}catch(t){c.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileTemplate.tmpl",t,e)}return o||""}.bind({includedTemplates:v})),function(e,t){c.prepareAttrsForFocus(t,e,"0");var i=this&&this.includedTemplates?this.includedTemplates:{},r=c.getMarkupGenerator(a);try{var o=r.joinElements([r.createTag("div",{class:"controls-CompositeView__tileItem controls-ListView__item js-controls-ListView__item"+c.wrapUndef(c.utils.escape(c.getter(e,["tileMode"])?"":" controls-CompositeView__verticalItemActions js-controls-CompositeView__verticalItemActions"))+c.wrapUndef(c.utils.escape(c.getter(e,["className"]))),"data-hash":""+c.wrapUndef(c.utils.escape(c.getter(e,["projItem","getHash"]).apply(c.getter(e,["projItem"]),[]))),"data-id":""+c.wrapUndef(c.utils.escape(c.getter(e,["item","getId"]).apply(c.getter(e,["item"]),[]))),style:""+c.wrapUndef(c.utils.escape("tile"===c.getter(e,["viewMode"])&&"dynamic"===c.getter(e,["tileMode"])?"max-width: "+c.getter(e,["width"])+"px; flex-basis: "+(c.getter(e,["width"])+c.getter(e,["minWidth"]))/2+"px;":""))},[r.createTag("div",{class:"controls-CompositeView__tileContainer"},[r.createControl("resolver",c.getter(e,["tileContent"]),c.uniteScope(c.utils.escape(c.uniteScope(e,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,u,i,c.config,d,g)],{},g,this)],t,g,this)],m,g);g.def&&(o=r.chain(o,g,t),g=void 0)}catch(t){c.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileTemplate.tmpl",t,e)}return o||""}(c.calculateScope(c.uniteScope(c.utils.escape(c.uniteScope(r,{parent:void 0,element:void 0})(c.plainMerge)),{width:c.getter(r,["item","get"]).apply(c.getter(r,["item"]),[c.getter(r,["widthProperty"])])>c.getter(r,["maxWidth"])?c.getter(r,["maxWidth"]):c.getter(r,["item","get"]).apply(c.getter(r,["item"]),[c.getter(r,["widthProperty"])])<c.getter(r,["minWidth"])?c.getter(r,["minWidth"]):c.getter(r,["item","get"]).apply(c.getter(r,["item"]),[c.getter(r,["widthProperty"])])}),c.plainMerge),c.plainMerge(o,{}))],m,g);g.def&&(f=w.chain(f,g,o),g=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileTemplate.tmpl",e,r)}return f||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileTemplate"}},r});
//# sourceMappingURL=TileTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},o=function e(o,r,s,l,c){function a(){}var n=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};c&&c.isSetts&&(d=c.fullContext||{});var m="string"==typeof s?s:"",u=void 0===i?void 0:i,g={id:[],def:void 0},h=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),C=this&&this.includedTemplates?this.includedTemplates:{},_=p.getMarkupGenerator(l);try{var w=_.joinElements([_.createTag("div",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox "+p.wrapUndef(p.utils.escape(p.getter(o,["_options","showCheckboxes"])?" controls-ListView__itemCheckBox__showAlways":""))+" "+p.wrapUndef(p.utils.escape(p.getter(o,["_options","showCheckboxes"])||p.getter(o,["_options","hideCheckboxes"])?"":" controls-ListView__itemCheckBox__showByHover"))},[],r,g,this),_.createTag("div",{class:"controls-CompositeView__tileImg-container"},[_.createTag("img",{class:"controls-CompositeView__tileImg",src:""+p.wrapUndef(p.utils.escape(p.getter(o,["item","get"]).apply(p.getter(o,["item"]),[p.getter(o,["image"])])||p.getter(o,["resourceRoot"])+"SBIS3.CONTROLS/themes/online/img/defaultItem.v1516270649826335cf4508dd597be4bfc9caa3e08b901.png"))},[],{},g,this)],r,g,this),_.createTag("div",{class:"controls-CompositeView__tileTitle"},[_.createTag("div",{class:"controls-CompositeView__tileTitle-text",style:""+p.wrapUndef(p.utils.escape(p.getter(o,["decorators","apply"]).apply(p.getter(o,["decorators"]),[p.getter(o,["color"]),"color"])))},[_.createText(" "+p.wrapUndef(p.utils.escape(p.getter(o,["decorators","apply"]).apply(p.getter(o,["decorators"]),[p.getter(o,["item","get"]).apply(p.getter(o,["item"]),[p.getter(o,["description"])])])))+" ")],{},g,this)],r,g,this)],m,g);g.def&&(w=_.chain(w,g,r),g=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileContentTemplate.tmpl",e,o)}return w||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileContentTemplate"}},o});
//# sourceMappingURL=TileContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ListTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,o,s,n,a){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var u="string"==typeof s?s:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),g=this&&this.includedTemplates?this.includedTemplates:{},y=c.getMarkupGenerator(n);try{var h=y.joinElements([y.createTag("div",{class:"controls-CompositeView__listItem controls-ListView__item js-controls-ListView__item "+c.wrapUndef(c.utils.escape(c.getter(i,["className"]))),style:""+c.wrapUndef(c.utils.escape(c.getter(i,["decorators","apply"]).apply(c.getter(i,["decorators"]),[c.getter(i,["color"]),"color"]))),"data-hash":""+c.wrapUndef(c.utils.escape(c.getter(i,["projItem","getHash"]).apply(c.getter(i,["projItem"]),[]))),"data-id":""+c.wrapUndef(c.utils.escape(c.getter(i,["item","getId"]).apply(c.getter(i,["item"]),[])))},[y.createControl("resolver",c.getter(i,["listContent"]),c.uniteScope(c.utils.escape(c.uniteScope(i,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},s,m,g,c.config,d,v)],o,v,this)],u,v);v.def&&(h=y.chain(h,v,o),v=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ListTemplate.tmpl",e,i)}return h||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ListTemplate"}},i});
//# sourceMappingURL=ListTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ListContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,n,o,s,l){function a(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var d="string"==typeof o?o:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),g=this&&this.includedTemplates?this.includedTemplates:{},C=p.getMarkupGenerator(s);try{var S=C.joinElements([C.createText(""+p.wrapUndef(p.utils.escape(p.getter(i,["decorators","apply"]).apply(p.getter(i,["decorators"]),[p.getter(i,["item","get"]).apply(p.getter(i,["item"]),[p.getter(i,["description"])])]))))],d,v);v.def&&(S=C.chain(S,v,n),v=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ListContentTemplate.tmpl",e,i)}return S||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ListContentTemplate"}},i});
//# sourceMappingURL=ListContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ItemsTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,o,a,n,l){function s(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var u="string"==typeof a?a:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),g=this&&this.includedTemplates?this.includedTemplates:{},y=p.getMarkupGenerator(n);try{var S=y.joinElements(["list"===p.getter(i,["tplData","viewMode"])||"tile"===p.getter(i,["tplData","viewMode"])?[y.createControl("resolver",p.getter(i,["tplData","_itemsTemplate"]),{records:p.getter(i,["records"]),tplData:p.getter(i,["tplData"])},{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},a,m,g,p.config,d,v)]:y.createText(""),"static"===p.getter(i,["tplData","tileMode"])?[y.createControl("resolver",p.getter(i,["tplData","invisibleItemsTemplate"]),p.uniteScope(p.utils.escape(p.uniteScope(i,{parent:void 0,element:void 0})(p.plainMerge)),{}),{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},a,m,g,p.config,d,v)]:y.createText("")],u,v);v.def&&(S=y.chain(S,v,o),v=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ItemsTemplate.tmpl",e,i)}return S||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ItemsTemplate"}},i});
//# sourceMappingURL=ItemsTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/InvisibleItemsTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),i=e[0],t={},r=function e(r,o,s,n,l){function a(){}var c=0,u=void 0!==i&&i?i:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var v={};l&&l.isSetts&&(v=l.fullContext||{});var d="string"==typeof s?s:"",p=void 0===t?void 0:t,m={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),S=this&&this.includedTemplates?this.includedTemplates:{},I=u.getMarkupGenerator(n);try{var h=I.joinElements([function(){for(var e=void 0,i=0;i<u.iterators.length&&!e;i++)u.iterators[i].is(10)&&(e=u.iterators[i].iterator);var t=[];return function(){var i=u.createScope(r);if(r=i,e){var o=s,l=0;e(10,function(e,i){u.presetScope(e,r,i,{value:"i"}),s&&void 0!==n&&n&&(s=o+"-for_"+l,l++);var a=[I.createTag("div",{class:"controls-CompositeView__tileItem-invisible controls-CompositeView__tileItem controls-ListView__item "+u.wrapUndef(u.utils.escape(u.getter(r,["className"])))},[],{},m,this)];void 0===a[0]&&void 0!==n&&n||(t=t.concat(a))}.bind(r))}else t=""}.call(r),t}()],d,m);m.def&&(h=I.chain(h,m,o),m=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/InvisibleItemsTemplate.tmpl",e,r)}return h||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/InvisibleItemsTemplate"}},r});
//# sourceMappingURL=InvisibleItemsTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/CompositeItemsTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,o,a,n,l){function s(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var u="string"==typeof a?a:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),C=this&&this.includedTemplates?this.includedTemplates:{},g=c.getMarkupGenerator(n);try{var y=g.joinElements([g.createTag("div",{class:"controls-CompositeView__foldersContainer"},[],o,v,this),"list"===c.getter(i,["tplData","viewMode"])||"tile"===c.getter(i,["tplData","viewMode"])?[g.createControl("resolver",c.getter(i,["tplData","_itemsTemplate"]),{records:c.getter(i,["records"]),tplData:c.getter(i,["tplData"])},{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},a,m,C,c.config,d,v)]:g.createText(""),"static"===c.getter(i,["tplData","tileMode"])?[g.createControl("resolver",c.getter(i,["tplData","invisibleItemsTemplate"]),c.uniteScope(c.utils.escape(c.uniteScope(i,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},a,m,C,c.config,d,v)]:g.createText("")],u,v);v.def&&(y=g.chain(y,v,o),v=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/CompositeItemsTemplate.tmpl",e,i)}return y||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/CompositeItemsTemplate"}},i});
//# sourceMappingURL=CompositeItemsTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/CompositeViewMixin",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Panel","js!SBIS3.CONTROLS/Link"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Panel"]=e[1],r["js!SBIS3.CONTROLS/Link"]=e[2];var o=function e(o,i,a,s,n){function l(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};n&&n.isSetts&&(p=n.fullContext||{});var u="string"==typeof a?a:"",g=void 0===r?void 0:r,w={id:[],def:void 0},_=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},v=d.getMarkupGenerator(s);try{var f=v.joinElements([v.createTag("div",{class:"controls-CompositeView controls-DataGridView controls-ListView            "+d.wrapUndef(d.utils.escape(d.getter(o,["preparedClasses"])))+"            "+d.wrapUndef(d.utils.escape(!1!==d.getter(o,["multiselect"])?"controls-ListView__multiselect":"controls-ListView__multiselect__off"))+"            "+d.wrapUndef(d.utils.escape(void 0!==d.getter(o,["startScrollColumn"])?"controls-DataGridView__with-partScroll":""))+"            "+d.wrapUndef(d.utils.escape("controls-CompositeView-"+d.getter(o,["viewMode"])))+"            "+d.wrapUndef(d.utils.escape("tile"===d.getter(o,["viewMode"])?"controls-CompositeView-tile__"+d.getter(o,["tileMode"]):""))+d.wrapUndef(d.utils.escape(d.getter(o,["_serverRender"])?" controls-ListView__dataLoaded":" controls-ListView__dataNotLoaded"))},[v.createTag("div",{class:"js-controls-DataGridView__minHeight controls-DataGridView__minHeight"},[],{},w,this),v.createControl("wsControl","ws:SBIS3.CONTROLS/Panel",{tabindex:1,allowChangeEnable:!1},{class:"controls-ListView__fakeFocusElement"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},a,g,m,d.config,p),v.createTag("div",{class:"controls-AjaxLoader ws-hidden"},[v.createTag("div",{class:"controls-AjaxLoader__outer"},[v.createTag("div",{class:"controls-AjaxLoader__block"},[v.createTag("div",{class:"controls-AjaxLoader__LoadingIndicator"},[],{},w,this)],{},w,this)],{},w,this)],{},w,this),d.getter(o,["virtualScrolling"])?[v.createTag("div",{class:"controls-ListView__virtualScrollTop"},[],{},w,this)]:v.createText(""),v.createTag("div",{class:"controls-CompositeView__itemsContainer"+d.wrapUndef(d.utils.escape("table"==d.getter(o,["viewMode"])?" ws-hidden":""))},[d.getter(o,["_serverRender"])?[v.createControl("resolver",d.getter(o,["_compositeItemsTemplate"]),{records:d.getter(o,["_records"]),tplData:d.getter(o,["_itemData"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},a,g,m,d.config,p,w)]:[v.createTag("div",{class:"controls-CompositeView__foldersContainer"},[],{},w,this)]],{},w,this),v.createTag("table",{class:"controls-DataGridView__table "+d.wrapUndef(d.utils.escape("table"!==d.getter(o,["viewMode"])?"ws-hidden":""))+" "+d.wrapUndef(d.utils.escape(d.getter(o,["stickyHeader"])?"ws-sticky-header__table":""))},[v.createControl("resolver",d.getter(o,["_colGroupTpl"]),d.uniteScope(d.utils.escape(d.getter(o,["_colgroupData"])),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},a,g,m,d.config,p,w),v.createControl("resolver",d.getter(o,["headTpl"]),d.uniteScope(d.utils.escape(d.getter(o,["_headData"])),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},a,g,m,d.config,p,w),v.createTag("tbody",{class:"controls-DataGridView__tbody"},[d.getter(o,["_serverRender"])&&"table"===d.getter(o,["viewMode"])?[v.createControl("resolver",d.getter(o,["_itemsTemplate"]),{records:d.getter(o,["_records"]),tplData:d.getter(o,["_itemData"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},a,g,m,d.config,p,w)]:v.createText("")],{},w,this),v.createControl("resolver",d.getter(o,["_footTpl"]),d.uniteScope(d.utils.escape(d.uniteScope(o,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},a,g,m,d.config,p,w)],{},w,this),v.createTag("div",{class:"controls-ListView__EmptyData "+d.wrapUndef(d.utils.escape(d.getter(o,["isSmall"])?" controls-ListView__small__EmptyData":" controls-ListView__normal__EmptyData"))+" "+d.wrapUndef(d.utils.escape(!d.getter(o,["_serverRender"])||d.getter(o,["_records","length"])||!d.getter(o,["emptyHTML"])||d.getter(o,["_hideEmpty"])?"ws-hidden":""))},[v.createControl("resolver",d.getter(o,["_sanitize"]).apply(o,[d.getter(o,["emptyHTML"])]),{},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},a,g,m,d.config,p,w)],{},w,this),d.getter(o,["footerTpl"])?[v.createTag("div",{class:"controls-ListView__footer"},[v.createControl("resolver",d.getter(o,["footerTpl"]),d.uniteScope(d.utils.escape(d.uniteScope(o,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},a,g,m,d.config,p,w)],{},w,this)]:v.createText(""),d.getter(o,["showPaging"])?[v.createTag("div",{class:"controls-Pager-container"},[],{},w,this),v.createTag("div",{class:"controls-TreePager-container"},[],{},w,this)]:v.createText(""),d.getter(o,["editArrow"])||d.getter(o,["arrowActivatedHandler"])?[v.createTag("div",{class:"controls-TreeView__editArrow-container ws-hidden"},[],{},w,this)]:v.createText(""),"demand"===d.getter(o,["infiniteScroll"])?[v.createTag("div",{class:"controls-ListView__serviceFooter"},[v.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"loadMoreButton",cssClassName:"controls-ListView__loadMoreButton",caption:"Ещё...",visible:!1},{name:"loadMoreButton",sbisname:"loadMoreButton"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},a,g,m,d.config,p),v.createTag("span",{class:"controls-ListView__counter ws-hidden"},[v.createText(" "+global.rk("Всего:")+" "),v.createTag("span",{class:"controls-ListView__counterValue"},[],{},w,this)],{},w,this)],{},w,this)]:v.createText(""),d.getter(o,["virtualScrolling"])?[v.createTag("div",{class:"controls-ListView__virtualScrollBottom"},[],{},w,this)]:v.createText(""),v.createTag("div",{class:"controls-ListView-scrollIndicator "+d.wrapUndef(d.utils.escape("up"===d.getter(o,["infiniteScroll"])?"controls-ListView-scrollIndicator__up":""))},[],{},w,this),v.createTag("div",{class:"controls-ListView__ItemsToolbar-container ws-hidden"},[],{},w,this),v.createTag("div",{class:"controls-ListView__scrollPager "+d.wrapUndef(d.utils.escape(d.getter(o,["infiniteScroll"])?"":"ws-hidden"))},[],{},w,this)],i,w,this)],u,w);w.def&&(f=v.chain(f,w,i),w=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/Mixins/CompositeViewMixin/CompositeViewMixin.tmpl",e,o)}return f||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/CompositeViewMixin"}},o});
//# sourceMappingURL=CompositeViewMixin.tmpl.map
define("SBIS3.CONTROLS/Mixins/CompositeViewMixin",["Core/constants","Core/Deferred","tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/CompositeViewMixin","Core/IoC","tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/CompositeItemsTemplate","SBIS3.CONTROLS/Utils/TemplateUtil","tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileTemplate","tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/TileContentTemplate","tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ListTemplate","tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ListContentTemplate","tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/ItemsTemplate","tmpl!SBIS3.CONTROLS/Mixins/CompositeViewMixin/resources/InvisibleItemsTemplate","tmpl!SBIS3.CONTROLS/ListView/resources/GroupTemplate","tmpl!SBIS3.CONTROLS/DataGridView/resources/GroupTemplate","Core/core-merge","Core/core-instance","SBIS3.CONTROLS/Link"],function(e,t,i,o,s,l,n,a,r,p,c,d,m,_,h,u){"use strict";var T={DYNAMIC:"dynamic",STATIC:"static"},C={_dotTplFn:i,$protected:{_tileWidth:null,_folderWidth:null,_options:{_getGroupTemplate:function(e){if("table"===e.viewMode)return _;return m},_ListViewGroupTemplate:m,_DataGridGroupTemplate:_,_defaultTileContentTemplate:a,_defaultTileTemplate:n,_defaultListContentTemplate:p,_defaultListTemplate:r,_invisibleItemsTemplate:d,_canServerRender:true,_canServerRenderOther:function(e){return!(e.itemTemplate||e.listTemplate||e.tileTemplate)},_compositeItemsTemplate:s,_buildTplArgs:function(e){var t=e._buildTplArgsDG(e),i=e._buildTplArgsComposite(e);return h(t,i),t},_buildTplArgsComposite:function(t){var i=t._buildTplArgsLV.call(this,t);if("list"==t.viewMode||"tile"==t.viewMode){var o,s,n,a;if(i.image=t.imageField,i.widthProperty=t.widthProperty,i.description=t.displayProperty,i.viewMode=t.viewMode,i._itemsTemplate=t._itemsTemplate,i.resourceRoot=e.resourceRoot,i.tileMode=t.tileMode,i.invisibleItemsTemplate=l.prepareTemplate(t._invisibleItemsTemplate),t.itemsHeight)i.minWidth=t.itemsHeight/1.4,i.maxWidth=1.5*t.itemsHeight;if(t.tileContentTpl)o=t.tileContentTpl;else o=t._defaultTileContentTemplate;if(i.tileContent=l.prepareTemplate(o),t.tileTpl)s=t.tileTpl;else s=t._defaultTileTemplate;if(i.tileTpl=l.prepareTemplate(s),i.defaultTileTpl=l.prepareTemplate(t._defaultTileTemplate),t.listContentTpl)n=t.listContentTpl;else n=t._defaultListContentTemplate;if(i.listContent=l.prepareTemplate(n),t.listTpl)a=t.listTpl;else a=t._defaultListTemplate;switch(i.listTpl=l.prepareTemplate(a),i.defaultListTpl=l.prepareTemplate(t._defaultListTemplate),t.viewMode){case"tile":i.itemTpl=s;break;case"list":i.itemTpl=a}}return i},viewMode:"table",tileMode:"",imageField:null,widthProperty:null,itemsHeight:void 0,listTemplate:null,tileTemplate:null,tileContentTpl:null,tileTpl:null,listContentTpl:null,listTpl:null}},$constructor:function(){if(this._container.addClass("controls-CompositeView-"+this._options.viewMode),this._calculateTileHandler=this._calculateTile.bind(this),this.subscribe("onDrawItems",this._calculateTileHandler),$(window).bind("resize",this._calculateTileHandler),this.subscribe("onAfterVisibilityChange",this._calculateTileHandler),this._options.tileTemplate)o.resolve("ILogger").log("CompositeView","Контрол "+this.getName()+" отрисовывается по неоптимальному алгоритму. Задан tileTemplate");if(this._options.listTemplate)o.resolve("ILogger").log("CompositeView","Контрол "+this.getName()+" отрисовывается по неоптимальному алгоритму. Задан listTemplate")},_calculateTile:function(){if("tile"==this._options.viewMode&&!this._options.tileMode)this._calculateTileWidth()},_setHoveredStyles:function(e){if(e&&!e.hasClass("controls-CompositeView__hoverStylesInit"))this._calculateHoveredStyles(e),this._hasItemsActions().addCallback(function(t){e.toggleClass("controls-CompositeView__item-withoutItemsAction",!t)}),e.addClass("controls-CompositeView__hoverStylesInit")},_hasItemsActions:function(){var e,i=this.getItemsActions();if(i)e=i.ready().addCallback(function(){return!!i.hasVisibleActions()});else e=t.success(false);return e},_calculateHoveredStyles:function(e){if(this._options.tileMode===T.DYNAMIC)this._setDynamicHoveredStyles(e);else if(this._options.tileMode===T.STATIC&&!this._container.hasClass("controls-CompositeView-tile__static-smallImage"))this._setStaticHoveredStyles(e)},_setDynamicHoveredStyles:function(e){var t,i,o;i=e.outerWidth()/2,t=e.outerWidth(true)/2-i,o=e.outerHeight()/2,e.css("padding",o/2+"px "+i/2+"px").css("margin",-o/2+"px "+-(i/2-t)+"px")},_setStaticHoveredStyles:function(e){var t,i;t=$(".controls-CompositeView__tileTitle",e).outerHeight(true)-(e.hasClass("controls-CompositeView__item-withTitle")?25:0),i=(e.outerHeight(true)-e.outerHeight())/2,e.css("padding-bottom",t).css("margin-bottom",-(t-i)),$(".controls-CompositeView__tileContainer",e).css("margin-bottom",t)},_updateHeadAfterInit:function(){if("table"==this._options.viewMode)this._redrawTheadAndTfoot()},setViewMode:function(e){if(this._options.viewMode===e)return;var t=this.getItemsDragNDrop();if(this.setItemsDragNDrop(false),this._options.viewMode=e,this.setItemsDragNDrop(t),this._drawViewMode(e),"table"===e)this._updateAjaxLoaderPosition();this._notify("onViewModeChanged")},getViewMode:function(){return this._options.viewMode},_getItemsTemplate:function(){if("table"==this._options.viewMode)return this._options._itemsTemplate;else return l.prepareTemplate(this._options._compositeItemsTemplate)},_drawViewMode:function(e){var t=this._options.tileMode;if(this._container.toggleClass("controls-CompositeView-table","table"==e).toggleClass("controls-CompositeView-list","list"==e).toggleClass("controls-CompositeView-tile","tile"==e).toggleClass("controls-CompositeView-tile__static","tile"==e&&t==T.STATIC).toggleClass("controls-CompositeView-tile__dynamic","tile"==e&&t==T.DYNAMIC),"table"==this._options.viewMode)$(".controls-DataGridView__table",this._container.get(0)).removeClass("ws-hidden"),$(".controls-CompositeView__itemsContainer",this._container.get(0)).addClass("ws-hidden");else $(".controls-CompositeView__itemsContainer",this._container.get(0)).removeClass("ws-hidden"),$(".controls-DataGridView__table",this._container.get(0)).addClass("ws-hidden")},_isAllowInfiniteScroll:function(){var e=this._allowInfiniteScroll&&("table"===this._options.viewMode||!this._options.showPaging);if(!e)this._hideLoadingIndicator();return e},_calculateTileWidth:function(){var e=this._getItemsContainer(),t=$(".controls-CompositeView__tileItem:not(.controls-ListView__item-type-node)",e),i=$(".controls-ListView__item-type-node",e);if(!this._tileWidth)this._tileWidth=$(t[0]).outerWidth(true);if(!this._folderWidth)this._folderWidth=$(i[0]).outerWidth(true);this._calcWidth(t,this._tileWidth),this._calcWidth(i,this._folderWidth)},_calcWidth:function(e,t){if(e.length){var i=Math.floor(this._getItemsContainer()[0].getBoundingClientRect().width),o=i/Math.floor(i/t);e.outerWidth(o,true)}},setListTemplate:function(e){this._options.listTemplate=e},setTileTemplate:function(e){this._options.tileTemplate=e},around:{_getItemTemplate:function(t,i){var o,s,l=i.getContents();switch(this._options.viewMode){case"table":o=t.call(this,i);break;case"list":if(this._options.listTemplate)s=this._options.listTemplate;else s="<div style=\"{{=it.decorators.apply(it.color, 'color')}}\">{{=it.decorators.apply(it.item.get(it.description))}}</div>";o=s;break;case"tile":if(this._options.tileTemplate)s=this._options.tileTemplate;else{var n;if(!l.get(this._options.imageField))n=e.resourceRoot+"SBIS3.CONTROLS/themes/online/img/defaultItem.png";else n="{{=it.item.get(it.image)}}";s='<div class="controls-CompositeView__verticalItemActions js-controls-CompositeView__verticalItemActions"><div class="controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox"></div><img class="controls-CompositeView__tileImg" src="'+n+'"/><div class="controls-CompositeView__tileTitle" style="{{=it.decorators.apply(it.color, \'color\')}}">{{=it.decorators.apply(it.item.get(it.description))}}</div></div>'}o=s}return o},_buildTplArgs:function(e,t){var i=e.call(this,t);if("list"==this._options.viewMode||"tile"==this._options.viewMode)i.image=this._options.imageField,i.description=this._options.displayProperty;return i},expandNode:function(e,t,i){if("table"===this.getViewMode())e.call(this,t,i)},collapseNode:function(e,t,i){if("table"===this.getViewMode())e.call(this,t,i)},_getItemsContainer:function(e){if("table"==this._options.viewMode)return e.call(this);else return $(".controls-CompositeView__itemsContainer",this._container.get(0))},_addItemAttributes:function(e,t,i){switch(this._options.viewMode){case"list":t.addClass("controls-CompositeView__listItem");break;case"tile":t.addClass("controls-CompositeView__tileItem")}e.call(this,t,i)},_isSlowDrawing:function(e,t){var i=e.call(this,t);if("list"==this._options.viewMode)if(this._options.listTemplate)i=true;if("tile"==this._options.viewMode)if(this._options.tileTemplate)i=true;return i},destroy:function(e){$(window).unbind("resize",this._calculateTileHandler),e.call(this)},_onCollectionAddMoveRemove:function(e,t,i,o,s){var l=Array.prototype.slice.call(arguments,1);if("table"==this._options.viewMode)e.apply(this,l);else if(this._getItemsProjection().getCount()-o.length==s&&!(u.instanceOfModule(o[0],"WS.Data/Display/TreeItem")&&o[0].isNode())&&!this._redrawOnCollectionChange||"rm"==i)e.apply(this,l);else this._redrawOnCollectionChange=true,this.redraw()},_afterCollectionChange:function(e){e.call(this),this._redrawOnCollectionChange=false},_getItemsTemplateForAdd:function(e){if("table"==this._options.viewMode)return e.call(this);else return c}}};return C.TILE_MODE=T,C});
//# sourceMappingURL=CompositeViewMixin.js.map
define("Deprecated/helpers/fast-control-helpers",["require","Core/IoC","Core/constants","Core/core-functions","Core/Deferred","Core/ParallelDeferred","Core/helpers/String/escapeTagsFromStr","Core/Context","Core/moduleStubs","Core/WindowManager","Core/core-ready"],function(e,r,n,t,o,a,c,i,l,s,d){var u=[],f={showDatePicker:function(e,r,n){var t=new o;return d.addCallback(function(){l.require(["cdn!jquery-ui/1.8.9/jquery-ui-1.8.5.2.custom.min.js","cdn!css!jquery-ui/1.8.9/jquery-ui-1.8.5.custom.css","Deprecated/Controls/FieldDate/resources/ext/jquery.ui.datepicker-local"]).addCallback(function(){(e instanceof $?e:$("#"+e)).datepicker({beforeShowDay:r,defaultDate:n}),t.callback()})}),t},question:function(e,r,a){var c=new o,i=false,d=s;return l.require(["Deprecated/Controls/DialogConfirm/DialogConfirm"]).addCallback(function(o){new o[0](t.merge({message:e,opener:a||d&&d.getActiveWindow(),handlers:{onKeyPressed:function(e,r){if(r.keyCode===n.key.esc)i=true},onConfirm:function(e,r){if(!c.isReady())if(i)c.callback(void 0);else c.callback(r)}}},r||{}))}).addErrback(function(e){c.errback(e)}),c},_messageBox:function(e,n,a,i){var d=new o,u=s;return d.addErrback(function(e){return e}),l.requireModule("Deprecated/Controls/DialogAlert/DialogAlert").addCallback(function(r){var o=t.merge({message:e,type:a,opener:i||u&&u.getActiveWindow(),handlers:{onAfterClose:function(){d.callback()}}},n||{});return new r[0](o)}).addErrback(function(n){r.resolve("ILogger").log("$ws.helpers._messageBox",n.message);var t=e.replace(/<br>/g,"\n");alert(c(t,"\\w+")),d.errback(n)}),d},alert:function(e,r,n){var t=e,a;if(r=r||{},e instanceof Error){if(0===e.httpError)return(new o).callback();if(r.checkAlreadyProcessed)if(e.processed)return(new o).callback();else e.processed=true;t=(e.message||"").replace(/\n/gm,"<br />"),a=e.details}if(a=r.detail||a,!t)return(new o).callback();var c=u.filter(function(e){return e.text===t&&e.detail===a})[0];if(c)return c.def.createDependent();return c={detail:a,text:t,def:f._messageBox(t,r,"error",n).addBoth(function(e){return u=u.filter(function(e){return!(e.text===t&&e.detail===a)}),e})},u.push(c),c.def},message:function(e,r,n){return f._messageBox(e,r,"info",n)},newContextMenu:function(r,n){for(var t=[],a=0,c=r.length;a<c;a++)if(t[a]={caption:r[a],id:r[a],handlers:{}},"function"==typeof n)t[a].handlers["onActivated"]=n;var i=new o;return e(["Deprecated/core-attach"],function(e){i.dependOn(e.attachInstance("Control/Menu",{data:t}))}),i},toggleIndicator:function(){var e,r;function n(r,n){if(!!r)if(r instanceof o)if(!r.isReady()&&!r.isCallbacksLocked())e.setDelay(n),e.show(),r.addBoth(function(r){return e.hide(),r});else e.hide();else e.setDelay(n),e.show();else e.hide()}return function(t,o){if(r=r||l.requireModule("Deprecated/Controls/LoadingIndicator/LoadingIndicator").addCallback(function(r){return e=new r[0]({message:rk("Пожалуйста, подождите…"),delay:o}),e}),!r.isReady())r.addCallback(function(){n(t,o)});else n(t,o)}}(),_showSelector:function(r,n,c,l){var s=new o,d=new o,u=i.createContext(d,null,c),g=false;return s.addErrback(function(e){return e}),e(["Deprecated/core-attach"],function(e){e.attachInstance(l,t.merge({linkedContext:u,handlers:{onChange:function(e,r){var t=this;if(r&&r[0]){var c=new a({stopOnFirstError:false});if(r.forEach(function(){var e=n.apply(t,arguments),r=e instanceof o;if(g|=r,r)c.push(e)}),g)f.toggleIndicator(true);this.close(c.done().getResult())}},onAfterClose:function(e,r){if(r&&r instanceof o)s.dependOn(r);else s.callback(r)},onDestroy:function(){d.callback()}}},r)).addErrback(function(e){return s.errback(e),e})}),s.addBoth(function(e){if(g)f.toggleIndicator(false);return e}),s},showDialogSelector:function(e,r,n){return f._showSelector(e,r,n,"Deprecated/Controls/DialogSelector/DialogSelector")},showFloatAreaSelector:function(e,r,n){return f._showSelector(e,r,n,"Deprecated/Controls/DialogSelector/FloatAreaSelector")}};return f});
//# sourceMappingURL=fast-control-helpers.js.map
define("Core/helpers/Hcontrol/toggleLocalIndicator",function(){return function(i,d){var s=i.children(".ws-browser-ajax-loader").first();if(!s.length)s=$('<div class="ws-browser-ajax-loader ws-hidden"><div class="ws-loading-indicator-outer">'+'<div class="ws-loading-indicator-block"><div class="ws-loading-indicator ws-browser-loading-indicator">'+"</div></div></div></div>"),i.append(s);if(d)s.removeClass("ws-hidden");else s.addClass("ws-hidden")}});
//# sourceMappingURL=toggleLocalIndicator.js.map
define("Core/helpers/Hcontrol/showFloatArea",["Core/moduleStubs"],function(e){var t=function(r){function i(){if(void 0!==a)l.id[a]=f;if(void 0!==n)l.name[n]=f}function o(){if(void 0!==a)delete l.id[a];if(void 0!==n)delete l.name[n]}var a=r.id,n=r.name,l=t.storage,f,d,u;if(!l)t.storage=l={id:{},name:{}};var s;if(r.path)s=r.path;else if(r.filter)s="Deprecated/Controls/FilterFloatArea/FilterFloatArea";else s="Lib/Control/FloatArea/FloatArea";if(f=l.id[a]||l.name[n],f)if(u=f.config,u.path!==r.path||u.filter!==r.filter||u.template!==r.template)f=null,o();if(f)d=f.instDfr.addCallback(function(t){var i=t;if(t.isDestroyed())i=e.requireModule(s).addCallback(function(e){return new e[0](r)});else{if(r.target)t.setTarget(r.target);if(r.hoverTarget)t.setHoverTarget(r.hoverTarget,true);if(r.opener)t.setOpener(r.opener);if(r.autoShow||void 0===r.autoShow)t.show()}return i});else d=e.requireModule(s).addCallback(function(e){return new e[0](r)}),f={instDfr:d,config:r},i(),d.addCallback(function(e){if(e.isDestroyed())o();else e.once("onDestroy",function(){o()});return e});return d.createDependent()};return t});
//# sourceMappingURL=showFloatArea.js.map
define("Core/helpers/Hcontrol/openErrorsReportDialog",["Core/Deferred","Core/WindowManager","Core/Context"],function(e,r,o){return function(t){var s=t.numSelected||0,a=t.numSuccess||0,n=s-a,i=t.errors||[],l=new e,c=o.createContext(l),d=t.title||"",p=[];c.setValue("Отмечено",s),c.setValue("Обработано",a),c.setValue("НеВыполнено",n);for(var u=0,f=i.length;u<f;u++){var g=i[u]instanceof Error?i[u].message:i[u];if(-1===$.inArray(g,p))if(p.push(g),p.length>5)break}require(["Deprecated/core-attach"],function(e){c.setValue("ТекстОшибки",p.join("<br>")),e.attachInstance("Deprecated/res/wsmodules/ErrorsReportDialog/ErrorsReportDialog",{}).addCallback(function(){e.attachInstance("Control/Dialog",{template:"Deprecated/res/wsmodules/ErrorsReportDialog/ErrorsReportDialog",cssClassName:"ws-errorsReportDialog",context:c,resizable:false,isReadOnly:true,opener:r&&r.getActiveWindow(),handlers:{onAfterLoad:function(e){if(d)this.setTitle(d);if($(".ws-errorsReportDialog-errorsDescription",this.getContainer()).html('<div style="overflow: auto;">'+p.join("<br>")+"</div>"),0===n)this.getContainer().find(".ws-errorsReportDialog-process-panel").css("display","none")},onDestroy:function(){l.callback()}}})}.bind(this))})}});
//# sourceMappingURL=openErrorsReportDialog.js.map
define("Core/PrintDialogHTMLView",["Core/core-merge","Core/helpers/Function/shallowClone","Core/WindowManager","Core/moduleStubs"],function(e,r,n,t){return function o(a,l,i,u){var d="string"===typeof a?{}:r(a),c=n,f;function g(e){for(var r in e)if(e.hasOwnProperty(r))if(void 0===e[r])delete e[r];return e}return e(d,g({top:l,left:i,opener:u||c&&c.getActiveWindow()}),{clone:false,rec:false}),e(d,{htmlText:String(a),resizable:true,parent:null,handlers:{},maxHTMLLength:null},{preferSource:true}),f=d.errorHandler,t.requireModule("Deprecated/Controls/PrintDialog/PrintDialog").addCallback(function(e){var r=new e[0](d);return r.getReadyDeferred().addCallback(function(){return r}).addErrback(f||function(){return r})})}});
//# sourceMappingURL=PrintDialogHTMLView.js.map
define("Core/helpers/fast-control-helpers",["require","Core/PrintDialogHTMLView","Core/deprecated","Core/helpers/Hcontrol/toggleLocalIndicator","Core/helpers/Hcontrol/showFloatArea","Deprecated/helpers/fast-control-helpers","Core/helpers/Hcontrol/openErrorsReportDialog","Core/IoC","Core/constants","Core/Deferred","Core/Context"],function(e,o,r,t,a,s,l){var n=r.callNextWrapper,c=function(e){return function(){r.showInfoLog("Хелпер Core/helpers/fast-control-helpers::"+e+" помечен как deprecated и будет удален в 3.18.")}},i={showDatePicker:n(s.showDatePicker,c("showDatePicker")),question:n(s.question,c("question")),_messageBox:n(s._messageBox,c("_messageBox")),alert:n(s.alert,c("alert")),message:n(s.message,c("message")),newContextMenu:n(s.newContextMenu,c("newContextMenu")),showHTMLForPrint:o,toggleIndicator:s.toggleIndicator,toggleLocalIndicator:t,showFloatArea:a,showHoverFloatArea:function(e,o,r){var t=o||false,a=$(e).bind("mouseenter.wsShowHoverFloatArea",function(){t=true}).bind("mouseleave.wsShowHoverFloatArea",function(){t=false});return r.autoShow=false,r.hoverTarget=e,i.showFloatArea(r).addCallback(function(e){if(a.unbind(".wsShowHoverFloatArea"),t)e.show();return e})},showDialogSelector:n(s.showDialogSelector,c("showDialogSelector")),showFloatAreaSelector:n(s.showFloatAreaSelector,c("showFloatAreaSelector")),openErrorsReportDialog:l};return i});
//# sourceMappingURL=fast-control-helpers.js.map
define("SBIS3.CONTROLS/Tree/CompositeView",["Core/core-clone","Core/constants","Core/Deferred","Core/ParallelDeferred","Core/helpers/Object/isEmpty","SBIS3.CONTROLS/Tree/DataGridView","SBIS3.CONTROLS/Mixins/CompositeViewMixin","tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/CompositeView__folderTpl","tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/TreeCompositeItemsTemplate","tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/FolderTemplate","tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/ListFolderTemplate","tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/FolderContentTemplate","tmpl!SBIS3.CONTROLS/Tree/CompositeView/resources/StaticFolderContentTemplate","Core/helpers/fast-control-helpers","SBIS3.CONTROLS/Utils/TemplateUtil","Core/core-merge","Core/core-instance","css!SBIS3.CONTROLS/CompositeView/CompositeView","css!SBIS3.CONTROLS/Tree/CompositeView/TreeCompositeView"],function(e,t,i,o,l,s,r,n,a,p,d,c,f,_,u,m,h){"use strict";var T=r.TILE_MODE,g=function(e){var t=e._buildTplArgsTDG(e),i,o,l,s,r=e._buildTplArgsComposite(e);if(m(t,r),e.folderContentTpl)i=e.folderContentTpl;else i=e.tileMode===T.STATIC&&-1===e.className.indexOf("controls-CompositeView-tile__static-smallImage")?u.prepareTemplate(f):e._defaultFolderContentTemplate;if(t.folderContent=u.prepareTemplate(i),e.folderTpl)o=e.folderTpl;else o=e._defaultFolderTemplate;if(t.folderTpl=u.prepareTemplate(o),t.defaultFolderTpl=u.prepareTemplate(e._defaultFolderTemplate),e.listFolderContentTpl)s=e.listFolderContentTpl;else if(e.folderContentTpl)s=e.folderContentTpl;else s=e._defaultFolderContentTemplate;if(t.listFolderContent=u.prepareTemplate(s),e.listFolderTpl)l=e.listFolderTpl;else if(e.folderTpl)l=e.folderTpl;else l=e._defaultListFolderTemplate;return t.listFolderTpl=u.prepareTemplate(l),t._itemsTemplate=e._itemsTemplate,t.drawFolders=C,t.drawLeafs=w,t.defaultlistFolderTpl=u.prepareTemplate(e._defaultListFolderTemplate),t},C=function(e){var t=e.tplData.itemTpl,i="",o;if("list"==e.tplData.viewMode)e.tplData.itemTpl=e.tplData.listFolderTpl;else if("tile"==e.tplData.viewMode)if(e.tplData.itemTpl=e.tplData.folderTpl,e.tplData.tileMode)i=e.tplData.invisibleItemsTemplate({className:"controls-ListView__item-type-node"});return o=e.tplData._itemsTemplate({records:e.records.folders||[],tplData:e.tplData})+i,e.tplData.itemTpl=t,o},w=function(e){var t=e.tplData.itemTpl,i="",o;if("list"==e.tplData.viewMode)e.tplData.itemTpl=e.tplData.listTpl;else if("tile"==e.tplData.viewMode)if(e.tplData.itemTpl=e.tplData.tileTpl,"static"===e.tplData.tileMode)i=e.tplData.invisibleItemsTemplate({});return o=e.tplData._itemsTemplate({records:e.records.leafs||[],tplData:e.tplData})+i,e.tplData.itemTpl=t,o},v=function(e,t,i){if("table"==t.viewMode||i)return t._getRecordsForRedrawTree.call(this,e,t);else{var o={folders:[],leafs:[]},s=!l(t.groupBy)&&t.easyGroup;return e.each(function(e,i,l){if(!h.instanceOfModule(e,"WS.Data/Display/GroupItem"))if(e.isNode())o.folders.push(e),t._hideEmpty=true;else o.leafs.push(e),t._hideEmpty=true}),o}},y=function(e){return!(e.itemTemplate||e.listTemplate||e.tileTemplate||e.folderTemplate||e.listFolderTemplate)},I=s.extend([r],{$protected:{_prevMode:null,_options:{_buildTplArgs:g,_getRecordsForRedraw:v,folderTemplate:void 0,folderTpl:null,folderContentTpl:null,listFolderTemplate:void 0,listFolderTpl:null,listFolderContentTpl:null,_defaultFolderTemplate:p,_defaultFolderContentTemplate:c,_defaultListFolderTemplate:d,_compositeItemsTemplate:a,_canServerRenderOther:y}},_getChildrenDOMItems:function(){var e=this._getFoldersContainer().children(".js-controls-ListView__item"),t=I.superclass._getChildrenDOMItems.apply(this,arguments);return e.add(t)},_getEditArrowPosition:function(){if("tile"===this._options.viewMode)return this._getEditArrowPositionTile.apply(this,arguments);else return I.superclass._getEditArrowPosition.apply(this,arguments)},_getEditArrowMarker:function(){if("tile"===this._options.viewMode)return this.getHoveredItem().container.find(".js-controls-TreeView__editArrow");else return I.superclass._getEditArrowMarker.apply(this,arguments)},_getInsertMarkupConfig:function(){var e;if("table"===this._options.viewMode)e=I.superclass._getInsertMarkupConfig.apply(this,arguments);else if(e=this._getInsertMarkupConfigICM.apply(this,arguments),e.inside&&e.prepend)e.inside=false,e.prepend=false,e.container=this._getFoldersContainer();return e},_modifyOptions:function(){var e=I.superclass._modifyOptions.apply(this,arguments);return e.className=(e.className||"")+" controls-TreeDataGridView",e},_getEditArrowPositionTile:function(){var e,t,i,o,l=this.getHoveredItem().container.find(".controls-CompositeView__tileTitle"),s=this._container[0].getBoundingClientRect(),r=l.find(".js-controls-TreeView__editArrow");if(r.length){if(i=r.get(0).getBoundingClientRect(),o=l.get(0).getBoundingClientRect(),i.top>o.top+o.height)i=r.get(1).getBoundingClientRect();return t=i.left-s.left,e=i.top-s.top+this._container[0].scrollTop,{top:e,left:t}}},_onChangeHoveredItem:function(e){this._setHoveredStyles(e.container),I.superclass._onChangeHoveredItem.apply(this,arguments)},_calculateHoveredStyles:function(e){if(e.hasClass("controls-ListView__item-type-node")){if(this._options.tileMode===T.DYNAMIC)this._setStaticHoveredStyles(e)}else I.superclass._calculateHoveredStyles.apply(this,arguments)},_elemClickHandlerInternal:function(e,t,i,o){if("table"==this._options.viewMode)I.superclass._elemClickHandlerInternal.apply(this,arguments);else{var l,s=$(i);if(s.hasClass("js-controls-TreeView__editArrow")||s.hasClass("js-controls-ListView__itemCheckBox"))return;if(l=s.closest(".controls-ListView__item").data("id"),this.getItems().getRecordById(l).get(this._options.nodeProperty))this.setCurrentRoot(l),this.reload();else this._activateItem(t)}},_needShowEmptyData:function(e){var t;if(e instanceof Array)t=I.superclass._needShowEmptyData.apply(this,arguments);else t=!(e&&(e.leafs.length||e.folders.length));return t},_getItemTemplate:function(e){var i,o,l=e.getContents();switch(this._options.viewMode){case"table":i=I.superclass._getItemTemplate.call(this,e);break;case"list":if(l.get(this._options.nodeProperty))o=this._options.listFolderTemplate||this._options.folderTemplate||n;else if(this._options.listTemplate)o=this._options.listTemplate;else o="<div style=\"{{=it.decorators.apply(it.color, 'color')}}\">{{=it.decorators.apply(escapeHtml(it.item.get(it.description)))}}</div>";i=o;break;case"tile":if(l.get(this._options.nodeProperty))o=this._options.folderTemplate?this._options.folderTemplate:n;else if(this._options.tileTemplate)o=this._options.tileTemplate;else{var s;if(!l.get(this._options.imageField))s=l.get(this._options.nodeProperty)?t.resourceRoot+"SBIS3.CONTROLS/themes/online/img/defaultFolder.png":t.resourceRoot+"SBIS3.CONTROLS/themes/online/img/defaultItem.png";else s="{{=it.item.get(it.image)}}";o='<div class="controls-CompositeView__verticalItemActions js-controls-CompositeView__verticalItemActions"><div class="controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox"></div><img class="controls-CompositeView__tileImg" src="'+s+'"/><div class="controls-CompositeView__tileTitle" style="{{=it.decorators.apply(it.color, \'color\')}}">{{=it.decorators.apply(escapeHtml(it.item.get(it.description)))}}</div></div>'}i=o}return i},_isSlowDrawing:function(){var e=I.superclass._isSlowDrawing.apply(this,arguments);if("list"===this._options.viewMode&&this._options.listFolderTemplate)e=true;return e},_buildTplArgs:function(e){var t=I.superclass._buildTplArgs.call(this,e);if("list"==this._options.viewMode||"tile"==this._options.viewMode)t.image=this._options.imageField,t.description=this._options.displayProperty,t.color=this._options.colorField?e.get(this._options.colorField):"";return t},_getTargetContainer:function(e){if("table"!=this.getViewMode()&&e.get(this._options.nodeProperty))return this._getFoldersContainer();return this._getItemsContainer()},_getFoldersContainer:function(){return $(".controls-CompositeView__foldersContainer",this._container)},_insertItemContainer:function(e,t,i,o,l,s){var r=false;if("table"!=this.getViewMode()&&!s&&!e.get(this._options.nodeProperty)){if(0===o)r=true;else{var n=this._getItemsProjection().at(o-1);if(n.isNode())r=true}if(r)this._previousGroupBy=void 0,t.insertAfter(this._getFoldersContainer());else t.insertAfter(this._getDomElementByItem(n))}else I.superclass._insertItemContainer.apply(this,arguments)},_processPaging:function(){I.superclass._processPaging.call(this),this._processPagingStandart()},setFolderTemplate:function(e){this._options.folderTemplate=e},setListFolderTemplate:function(e){this._options.listFolderTemplate=e},setListFolderTpl:function(e){this._options.listFolderTpl=e},setListFolderContentTpl:function(e){this._options.listFolderContentTpl=e},redraw:function(){if(this._options.hierarchyViewMode){if(!this._prevMode){var e=this._options.viewMode;this.setViewMode("table"),this._prevMode=e}}else{if(this._prevMode&&this._prevMode!==this._options.viewMode)this.setViewMode(this._prevMode);this._prevMode=null}I.superclass.redraw.apply(this,arguments)},setViewMode:function(){this._prevMode=null,this.setOpenedPath({}),I.superclass.setViewMode.apply(this,arguments)},_calculateDataBeforeRedraw:function(t,i){function o(e,t){e.itemTpl=e[t[0]],e.itemContent=e[t[1]],e.defaultItemTpl=e[t[2]]}var l=e(t);if("tile"==this._options.viewMode)if(i.isNode())o(l,["folderTpl","folderContent","defaultFolderTpl"]);else o(l,["tileTpl","tileContent","defaultTileTpl"]);if("list"==this._options.viewMode)if(i.isNode())o(l,["listFolderTpl","listFolderContent","defaultListFolderTpl"]);else o(l,["listTpl","listContent","defaultListTpl"]);return l},partialyReload:function(t){var l=this,s,r,n,a,p,d,c,f,u={},m={},h=this.getContainer(),T=void 0===l._options.currentRoot?null:l._options.currentRoot,g=function(e,t){var i=function(e,t){var o={key:e,$row:h.find('[data-id="'+e+'"]'),childs:[]};if(void 0!==t)o.parentKey=t;if(o.$row.hasClass("controls-ListView__item-type-node")||o.$row.hasClass("controls-ListView__item-type-hidden"))h.find('.controls-ListView__item[data-parent="'+e+'"]').each(function(t,l){var s=l.getAttribute("data-id");o.childs.push(i(s,e))});return o};return i(e,t)},C=function(e,t,i){var o,s=p?e.getRecordById(t.key):false,r=[t.$row.prev(),t.$row.next()];if(s)n.getRecordById(t.key).merge(s),l.redrawItem(s);else{if(o=n.getIndexByValue(n.getIdProperty(),t.key),o>=0)n.removeAt(o);if(l._destroyItemsFolderFooter([t.key]),t.$row.remove(),p&&n.getCount()<e.getCount())s=e.at(e.getCount()-i),n.addRecord(s),l._drawItems([s])}},w=function(e,t){if(e.childs&&e.childs.length)if(e.childs.forEach(function(t,i){w(t,e.childs.length-i)}),!p)C(null,e,t);else v(e.parentKey).addCallback(function(i){C(i,e,t)});else v(e.parentKey).addCallback(function(i){C(i,e,t)})},v=function(e){if(m[e])return(new i).addCallback(function(){return m[e]}).callback();else{s[l._options.parentProperty]="null"===e?null:e;var t;if(String(T)==e&&l._infiniteScrollOffset)t=l._infiniteScrollOffset+l._options.pageSize;else if(void 0!==l._limit)t=(l._options._folderOffsets.hasOwnProperty(e)?l._options._folderOffsets[e]:0)+l._limit;return l._notify("onBeforeDataLoad",s,l.getSorting(),l._offset,t),l._callQuery(s,l.getSorting(),l._offset,t).addCallback(function(t){return m[e]=t,t}).addErrback(function(e){l._notify("onDataLoadError",e)})}};if(!this._showedLoading)_.toggleIndicator(true);if(t)if(n=this.getItems(),s=e(this.getFilter()),t.forEach(function(e){if(d=this._options._items.getRecordById(e),d)if(c=this.getParentKey(void 0,this._options._items.getRecordById(e)),void 0!==c){if(!u[c])u[c]=[];u[c].push(e)}},this),Object.isEmpty(u)){if(!this._showedLoading)_.toggleIndicator(false)}else return r=new o,Object.keys(u).forEach(function(e){r.push(v(e).addCallback(function(t){if(t)if(u[e].forEach(function(i,o){a=n.getRecordById(i),f=g(i,e),p=!!t.getRecordById(i),w(f,u[e].length-o)}),String(T)==e)l.getItems().setMetaData(t.getMetaData())}).addBoth(function(){if(!l._showedLoading)_.toggleIndicator(false)}))}),r.done().getResult();return i.success()},_reloadViewAfterDelete:function(e){if("table"===this.getViewMode())return this.partialyReload(e);else return I.superclass._reloadViewAfterDelete.apply(this,arguments)}});return I.TILE_MODE=T,I});
//# sourceMappingURL=CompositeView.js.map
define("tmpl!SBIS3.CONTROLS/ScrollContainer/ScrollContainer",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},n=function e(n,o,l,i,a){function c(){}var s=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};a&&a.isSetts&&(u=a.fullContext||{});var p="string"==typeof l?l:"",v=void 0===r?void 0:r,S={id:[],def:void 0},C=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),f=this&&this.includedTemplates?this.includedTemplates:{},g=d.getMarkupGenerator(i);try{var h=g.joinElements([g.createTag("div",{class:"controls-ScrollContainer ws-scrolling-content "+d.wrapUndef(d.utils.escape(d.getter(n,["stickyContainer"])?" ws-sticky-header__wrapper":""))},[g.createTag("div",{class:"controls-ScrollContainer__content ws-scrolling-content "+d.wrapUndef(d.utils.escape(d.getter(n,["_isMobileIOS"])?"":" controls-ScrollContainer__content-overflowHidden"))+d.wrapUndef(d.utils.escape(d.getter(n,["stickyContainer"])?" ws-sticky-header__scrollable-container":""))},[g.createControl("resolver",d.getter(n,["content"]),{},{},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:C},l,v,f,d.config,u,S)],{},S,this),g.createTag("div",{class:"controls-ScrollContainer__scrollbar"},[],{},S,this),d.getter(n,["stickyContainer"])?[g.createTag("div",{class:"ws-sticky-header__header-container"},[],{},S,this)]:g.createText(""),g.createTag("div",{class:"js-controls-ScrollContainer__paging"},[],{},S,this)],o,S,this)],p,S);S.def&&(h=g.chain(h,S,o),S=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/ScrollContainer/ScrollContainer.tmpl",e,n)}return h||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ScrollContainer/ScrollContainer"}},n});
//# sourceMappingURL=ScrollContainer.tmpl.map
define("tmpl!SBIS3.CONTROLS/ScrollContainer/Scrollbar/Scrollbar",["Core/tmpl/js/tclosure"],function(){var r=Array.prototype.slice.call(arguments),e=r[0],l={},t=function r(t,o,n,a,c){function i(){}var s=0,u=void 0!==e&&e?e:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};c&&c.isSetts&&(d=c.fullContext||{});var S="string"==typeof n?n:"",v=void 0===l?void 0:l,p={id:[],def:void 0},b=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,t),f=this&&this.includedTemplates?this.includedTemplates:{},m=u.getMarkupGenerator(a);try{var h=m.joinElements([m.createTag("div",{class:"controls-Scrollbar"},[m.createTag("div",{class:"controls-Scrollbar__thumb js-controls-Scrollbar__thumb"},[],{},p,this)],o,p,this)],S,p);p.def&&(h=m.chain(h,p,o),p=void 0)}catch(r){u.templateError("resources/SBIS3.CONTROLS/ScrollContainer/Scrollbar/Scrollbar.tmpl",r,t)}return h||""};return t.includedFunctions={},t.stable=!0,t.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ScrollContainer/Scrollbar/Scrollbar"}},t});
//# sourceMappingURL=Scrollbar.tmpl.map
define("SBIS3.CONTROLS/ScrollContainer/Scrollbar",["SBIS3.CONTROLS/CompoundControl","tmpl!SBIS3.CONTROLS/ScrollContainer/Scrollbar/Scrollbar","SBIS3.CONTROLS/Mixins/DragNDropMixin","Core/detection","css!SBIS3.CONTROLS/ScrollContainer/Scrollbar/Scrollbar"],function(t,i,e,o){"use strict";var n=t.extend([e],{_dotTplFn:i,$protected:{_options:{position:0,contentHeight:1,tabindex:0},_thumb:void 0,_beginClient:void 0,_thumbPosition:0,_viewportRatio:void 0,_scrollRatio:void 0,_thumbHeight:void 0,_containerHeight:void 0,_containerOuterHeight:void 0,_isConstThumb:void 0,_browserScrollbarMinHeght:void 0},$constructor:function(){this._publish("onScrollbarStartDrag","onScrollbarDrag","onScrollbarEndDrag")},init:function(){if(n.superclass.init.call(this),this._thumb=this._container.find(".js-controls-Scrollbar__thumb"),this._wheelHandler=this._wheelHandler.bind(this),this._container.on("mousedown touchstart",".js-controls-Scrollbar__thumb",this._getDragInitHandler()),this._container.on("mousedown touchstart",this._onClickDragHandler.bind(this)),o.firefox)this._container.on("MozMousePixelScroll",this._wheelHandler);else this._container.on("wheel",this._wheelHandler);this._containerHeight=this._container.height(),this._containerOuterHeight=this._container.outerHeight(true),this._scrollbarMargin=2*parseFloat(getComputedStyle(this._thumb[0]).marginTop),this._browserScrollbarMinHeght=parseFloat(getComputedStyle(this._thumb[0]).minHeight),this._setViewportRatio(),this._setThumbHeight(),this._setScrollRatio(),this._setThumbPosition()},getPosition:function(){return this._options.position},setPosition:function(t){var i=this.getContentHeight()-this._containerOuterHeight;t=this._calcPosition(t,0,i),this._options.position=t,this._setThumbPosition()},getContentHeight:function(){return this._options.contentHeight},setContentHeight:function(t){this._containerHeight=this._container.height(),this._containerOuterHeight=this._container.outerHeight(true),this._options.contentHeight=t,this._setViewportRatio(),this._setThumbHeight(),this._setScrollRatio()},_calcPosition:function(t,i,e){if(t<i)t=i;else if(t>e)t=e;return t},_onClickDragHandler:function(t){if(!$(t.target).hasClass("js-controls-Scrollbar__thumb"))this._beginClient=this._thumb.get(0).getBoundingClientRect().top+this._thumbHeight/2,this._onDragHandler(null,t)},_getDragInitHandler:function(){return function(t){this._initDrag.call(this,t),t.preventDefault()}.bind(this)},_setThumbPosition:function(){if(this._thumb)this._thumbPosition=this._calcProjectionSize(this.getPosition(),this._scrollRatio),this._thumb.get(0).style.top=this._thumbPosition+"px"},_setThumbHeight:function(){if(this.getContainer().toggleClass("ws-invisible",this._viewportRatio>=1),this._thumbHeight=this._calcProjectionSize(this._containerHeight,this._viewportRatio),this._thumbHeight<this._browserScrollbarMinHeght)this._thumbHeight=this._browserScrollbarMinHeght,this._isConstThumb=true;else this._isConstThumb=false;if(this._thumb)this._thumb.height(this._thumbHeight-this._scrollbarMargin),this._thumbHeight=this._thumb.outerHeight(true)},_calcProjectionSize:function(t,i){return t*i},_onResizeHandler:function(){this._containerHeight=this._container.height(),this._containerOuterHeight=this._container.outerHeight(true),this._setThumbHeight()},_setViewportRatio:function(){if(this.getContentHeight()-this._containerOuterHeight>1)this._viewportRatio=this._containerOuterHeight/this.getContentHeight();else this._viewportRatio=1},_setScrollRatio:function(){this._scrollRatio=(this.getContainer().height()-this._thumbHeight)/(this.getContentHeight()-this._containerOuterHeight)},_beginDragHandler:function(t,i){this._container.addClass("controls-Scrollbar__dragging"),this._beginClient=i.pageY,this._notify("onScrollbarStartDrag",this.getPosition())},_onDragHandler:function(t,i){var e=this._thumbPosition+i.pageY-this._beginClient;this.setPosition(e/this._scrollRatio),this._notify("onScrollbarDrag",this.getPosition()),this._beginClient=i.pageY-e+this._thumbPosition},_endDragHandler:function(t,i,e){this._container.removeClass("controls-Scrollbar__dragging"),this._notify("onScrollbarEndDrag",this.getPosition())},_wheelHandler:function(t){var i;switch(t.type){case"wheel":i=t.originalEvent.deltaY;break;case"MozMousePixelScroll":i=t.originalEvent.detail}this.setPosition(this.getPosition()+i),this._notify("onScrollbarDrag",this.getPosition()),t.preventDefault()},destroy:function(){n.superclass.destroy.call(this),this.getContainer().off("mousedown touchstart"),this._thumb=void 0}});return n});
//# sourceMappingURL=Scrollbar.js.map
define("Core/helpers/event-helpers",["Core/constants"],function(e){return{keyDown:function(i,t){i[e.compatibility.correctKeyEvents?"keydown":"keypress"](function(i){if(!e.compatibility.correctKeyEvents){if(i.which===i.keyCode)if(i.which>=97&&i.which<=122)i.which=i.keyCode-32;else if(i.which in e.operaKeys)i.which=e.key[e.operaKeys[i.which]];if(0===i.which)i.which=i.keyCode;i.keyCode=i.which}t(i)})},checkCapsLock:function(e){if(!e||!e.which)return;var i=e.which,t=String.fromCharCode(i),n=t.toUpperCase(),r=t.toLowerCase(),o=e.shiftKey;if(n!==r)if(t===n&&!o)return true;else if(t===r&&!o)return false;else if(t===r&&o)return true;else if(t===n&&o)if(-1!==navigator.platform.toLowerCase().indexOf("win"))return false;else if(-1!==navigator.platform.toLowerCase().indexOf("mac"))return false;else return;else return;else return},wheel:function(i,t){var n=e.compatibility.wheel;return i.bind(n,function(e){var i=e.originalEvent;if("wheel"===n){if(e.wheelDelta=-i.deltaY,1===i.deltaMode)e.wheelDelta*=40}else if("DOMMouseScroll"===n)e.wheelDelta=40*-i.detail;else if("mousewheel"===n)e.wheelDelta=i.wheelDelta;t.call(this,e)})},getTouchEventCoords:function(e){var i=e.pageX,t=e.pageY;if(!i){var n=e.originalEvent.touch||e.originalEvent.touches&&e.originalEvent.touches[0]||e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0];if(n)i=n.pageX,t=n.pageY}return{x:i,y:t}},getTouchEventClientCoords:function(e){var i=e.clientX,t=e.clientY;if(void 0===i){var n=e.originalEvent.touch||e.originalEvent.touches&&e.originalEvent.touches[0]||e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0];if(n)i=n.clientX,t=n.clientY}return{x:i,y:t}}}});
//# sourceMappingURL=event-helpers.js.map
define("Core/helpers/Hcontrol/getScrollWidth",function(){var e=function(){if(document&&document.body){var t=document.createElement("div");t.style.cssText="position:absolute;height:50px;overflow-y:scroll;visibility:hidden",t.innerHTML='<div style="height:100px"></div>',document.body.appendChild(t);var r=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e=function(){return r},r}else if(!document)throw new Error(rk("Ошибка: функция $ws.helpers.getScrollWidth вызвана на сервере. Она должна вызываться только в клиентском браузере"));else throw new Error(rk("Ошибка: функция $ws.helpers.getScrollWidth вызвана на клиентском браузере, однако body ещё не готово"))};return e});
//# sourceMappingURL=getScrollWidth.js.map
define("Lib/FloatAreaManager/FloatAreaManager",["Core/constants","Core/Deferred","Core/WindowManager","Core/EventBus","Core/core-functions","Core/core-instance","Lib/LayoutManager/LayoutManager","Core/helpers/Object/find","Core/helpers/Array/findIndex","Core/helpers/Function/memoize","Core/helpers/Hcontrol/getScrollWidth","Core/helpers/event-helpers","Core/Abstract","css!Lib/FloatAreaManager/FloatAreaManager"],function(t,e,i,n,a,r,o,s,l,h,c,d){"use strict";var f="Lib/Control/FloatArea/FloatArea",_=t.browser.chrome&&!t.browser.isMobilePlatform,u=.05,g=50,w=50,v=10,m=1e3,p=700,b=_&&!t.browser.isMobileSafari&&t.compatibility.cssTransform&&t.compatibility.cssAnimations;function A(){return"undefined"!==typeof window&&(A.value||(A.value=$("body")))}function S(){return"undefined"!==typeof window&&(S.value||(S.value=$("#min-width")))}function C(t,e,i){if(t<e)t=e;if(t>i)t=i;return t}var y=function(){this.size={width:0,height:0}};(y.prototype={control:void 0,right:0,methods:void 0,hideSideBar:true,id:"",scrollTop:0,preparedToShow:false}).width=function(){return this.control._containerShadow.width()};var W={_areas:{},_areaInfos:{},_$content:void 0,_contentIsBody:true,_$contentParent:void 0,_$sideBar:void 0,_sideBarVisible:true,_sideBarWidth:0,_stack:[],_topFloatArea:null,_maximizedWindows:[],_scrollableContainers:{},_$floatAreaContainer:void 0,_floatAreaContainerWidth:0,_settingAreaSize:false,_$rightShadow:void 0,_maxContentWidth:0,_hasAnyFloatArea:false,_animationLength:0,_panelHideAnimationDelay:0,_minContentWidth:m,_animationQueue:void 0,_transitionEndHandler:void 0,_prevBodyMargin:void 0,_isCalculatingVariables:false,_getFloatAreaContentRoot:function(){var t=$(".ws-float-area-stack-root:first");if(0===t.length)t=$("body");return t},_getFloatAreaBodyContainerRoot:h(function(){if(t.compat)return $('<div class="ws-float-area-body-container-root"></div>').insertAfter(".ws-focus-in");else return $('<div class="ws-float-area-body-container-root"></div>').appendTo(".vdom-black-box")},"_getFloatAreaBodyContainerRoot"),_bodyCanScroll:function(){return 0!==this._bodyScrollWidth()},_bodyScrollWidth:h(function(){var t=A().css("overflow-y");return"hidden"!==t&&"visible"!==t?c():0},"_bodyScrollWidth"),_fixCss3TransitionEndEvent:function(t,e,i,n){function a(t){var e=""+t,n=""+i;if("matrix(1, 0, 0, 1, 0, 0)"===e)e="translateX(0px)";return e===n||"0"===e&&"0px"===n||"0px"===e&&"0"===n}var r=Math.max(3*n,p);setTimeout(function(){var i=$(t),n=+new Date,o;if(a(i.css(e)))i.trigger("transitionend");else o=setInterval(function(){if(a(i.css(e)))clearInterval(o),i.trigger("transitionend");else if(+new Date-n>r)clearInterval(o)},50)},n)},_addToAnimationQueue:function(t,i){return i.addBoth(function(i){var n=e.fromTimer(p);return e.nearestOf([t,n])})},_init:function(){this._calcVariables(),t.$win.bind("resize.wsFloatAreaManager",this._resize.bind(this)),i.subscribe("onAreaFocus",this._focusMoved.bind(this)),n.channel("navigation").subscribe("onAccTransform",this._onAccTransform.bind(this))},_calcVariables:function(){if(!this._isCalculatingVariables){if(this._animationQueue=e.success(void 0),this._$content)this._$content.unbind("transitionend");this._$content=this._getFloatAreaContentRoot(),this._$content.bind("transitionend",function(){if(this._transitionEndHandler){var t=this._transitionEndHandler;this._transitionEndHandler=void 0,t.call(this)}}.bind(this)),this._maxContentWidth=this._$content.parents().toArray().reduce(function(t,e){var i=parseInt($(e).css("max-width"),10);if(!isNaN(i)&&i>0)if(i<t)t=i;return t},parseInt(this._$content.css("max-width"),10)||1/0),this._contentIsBody=this._$content.is("body"),this._isNewPageTemplate=t.$body.hasClass("ws-new-page-template"),this._$contentParent=this._contentIsBody||this._isNewPageTemplate?this._$content:this._$content.parent(),this._$sideBar=$(".ws-float-area-stack-sidebar, .engine-OnlineBaseInnerMinCoreView__sideLeft"),this._sideBarWidth=this._$sideBar.width()||0,this._$rightShadow=$(".ws-float-area-stack-right-shadow")}},_onAccTransform:function(){var t=this._$sideBar.width()||0;if(t>0)this._sideBarWidth=t,this._calcSizeParams.reset()},scrollParentFloatArea:function(e,i){function n(t,e){return t.scrollHeight>t.offsetHeight&&/auto|scroll/.test($(t).css("overflow-y"))&&(e<0&&0!==t.scrollTop||e>0&&t.scrollTop!==t.scrollHeight-t.clientHeight)}function a(t,e){if(n(t,e))return true;return t.parents().filter(function(){return!!n(this,e)}).length}function r(t){var e=$(t.target,document),i=-t.wheelDelta;if(!a(e,i)){t.stopPropagation(),t.preventDefault();var n=$(o);n.scrollTop(n.scrollTop()+i)}}if(!e||!i)return null;var o=i.parents().filter(function(){return $(this).is(".ws-float-area-stack-scroll-wrapper")});if(!o.length)return null;return d.wheel($(e),r),function(){var i=t.compatibility.wheel;$(e).unbind(i,r)}},_getPanelHideAnimationDelay:function(){return 1===this._stack.length?this._panelHideAnimationDelay:0},_useAnimation:function(){return _},_useCss3:function(){return b},_updateAreaPositions:function(){for(var t in this._areas)if(this._areas.hasOwnProperty(t)){var e=this._areas[t];if(e.isVisible()&&!e._options.isStack)e._recalcPosition()}},_resetWindowSizes:function(){this._getWindowHeight.reset(),this._calcSizeParams.reset()},_resize:function(){var t=this._$sideBar.width()||0;if(0!==t)this._sideBarWidth=t;this._recalculateShadow();var e=function(){this._resetWindowSizes();for(var t in this._areas)if(this._areas.hasOwnProperty(t))this._areas[t]._sizeUpdated(true);this._updateSideBarVisibility()}.bind(this);e(),e()},_getWindowHeight:h(function(){return t.$win.height()},"_getWindowHeight"),setContentMinWidth:function(t){this._minContentWidth=t+this._sideBarWidth+16||m,S().css("min-width",this._minContentWidth),this._resize()},_getPanelRootPaddingRight:function(t,e){var i=A().get(0).getBoundingClientRect().right,n=this._$contentParent.get(0),a=this._needBodyRight(t)||!n,r=Math.ceil(a?i:n.getBoundingClientRect().right),o=e?this._bodyCanScroll()||c():0;return Math.max(0,i-r-o)},_calcSizeParams:h(function(){var e=C(t.$win.width()-c(),this._minContentWidth,this._maxContentWidth);return{contentWidth:e,minimumPanelDistance:Math.floor(e*u+this._sideBarWidth),minimumPanelDistanceNoAcc:Math.floor(e*u)}},"_calcSizeParams"),_canHideSidebar:function(){return this._sideBarWidth>0},_updateSideBarVisibility:function(){var t,e,i,a,r,o;function s(t){return n.channel("navigation").notify("accordeonVisibilityStateChange",t)}if(this._canHideSidebar())if(t=this._calcSizeParams(),e=this._stack.reduce(function(t,e){return Math.max(t,e.width())},0),i=t.contentWidth-e>=t.minimumPanelDistance,i!==this._sideBarVisible)this._sideBarVisible=i,s(this._sideBarVisible),$(window).trigger("resize")},_getMaxWidthForAreaNew:function(t,e){var i=t._options,n=Math.min(this._getMaxPanelWidth(),i.maxWidth);if(n<e)return e;else if(n<w)return w;return n},_getMaxPanelWidth:function(){var t=this._calcSizeParams();return t.contentWidth-t.minimumPanelDistance},_getMaxWidthForArea:function(t,e){var i=this._calcSizeParams(),n=l(this._stack,function(e){return e.control===t}),a=-1!==n?n-1:this._stack.length-1,r=-1!==a?this._stack[a].width():i.contentWidth,o=t._options,s,h;switch(a){case-1:s=i.minimumPanelDistance;break;case 0:s=g;break;default:s=v}if(o.autoWidth||o.maxWidth!==1/0){if(h=Math.max(r-s,w),-1===a&&h<e)h=Math.max(r-i.minimumPanelDistanceNoAcc,w)}else h=Math.max(i.contentWidth-i.minimumPanelDistanceNoAcc,w);return h},_hideAreaWithParents:function(t,e){var i;if(!t.isDestroyed()&&t.isVisible()){if(t.hide(true),i=t.getOpener(),i)i=i.getParentByClass(f);else i=t.getParentByClass(f);if(i&&i.isVisible()&&i.isAutoHide()&&!i.isLockShowed()&&i.getId()in e)this._hideAreaWithParents(i,e)}},_hideUnnecessaryAreas:function(t){var e={},i=a.shallowClone(this._areas);for(var n in i)if(i.hasOwnProperty(n)){var r=i[n];if(r&&t!==r&&r.isVisible()&&r.isAutoHide()&&r._shouldHideByFocusMoveTo(t))e[r.getId()]=true}this._hideAreas(i,e)},_hideDependentAreas:function(t){var e={},i=a.shallowClone(this._areas);for(var n in i)if(i.hasOwnProperty(n)){var r=i[n];if(r&&r.getOpener()&&r.getOpener()===t)e[r.getId()]=true}this._hideAreas(i,e)},_hideAreas:function(t,e){var i=this;for(var n in e)if(e.hasOwnProperty(n))i._hideAreaWithParents(t[n],e)},_focusMoved:function(t,e){if(this._prevArea)if(r.instanceOfModule(this._prevArea,f)||this._prevArea.getParentByClass(f)||this._prevArea.getContainer&&this._prevArea.getContainer().closest(".ws-float-area").length)this._hideUnnecessaryAreas(e);this._prevArea=e},_beforeShowStarted:function(e){if(e._options.isStack){var i=e.getId(),n=this._areaInfos[i];if(n.preparedToShow=false,this._hideUnnecessaryAreas(n.control),t.browser.isMobilePlatform)this._setTopFloatAreaWebkitOverflowScrolling("auto");if(this._stack.push(n),t.browser.isMobilePlatform){var a=this._setTopFloatAreaWebkitOverflowScrolling("touch"),r=false===a?false:a.getContainer();this._strictOverflowScrollingOnScrollContainersUnderTopFloatArea(r)}this._checkToggleContentScroll()}},_showStarted:function(t){if(t._options.isStack){var e=t.getId(),i=this._areaInfos[e];if(1===this._stack.length)this._animationLength=i.control._options.animationLength,this._panelHideAnimationDelay=_?Math.max(10,.1*this._animationLength):0;if(_)this._updateSideBarVisibility();i.preparedToShow=true}},_finishShow:function(t){if(t._options.isStack)if(this._stack.length>1)this._hideShadow(this._areaInfos[t.getId()]);this._updateSideBarVisibility()},_hideShadow:function(t){for(var e=t.control.getContainer().width(),i=0,n=this._stack.length-1;i<n;i++){var a=this._stack[i].control;if(a!==t.control&&a.getContainer().width()===e)this._toggleAreaShadow(a,false)}},_showShadow:function(t){for(var e=t.control.getContainer().width(),i=this._stack.length-1;i>-1;i--){var n=this._stack[i].control;if(n.getContainer().width()===e)return void this._toggleAreaShadow(n,true)}},_toggleAreaShadow:function(t,e){t.getContainer().closest(".ws-float-area-stack-panel-shadow").toggleClass("ws-float-area-stack-panel-no-shadow",!e)},_beforeClose:function(t){if(t._options.isStack){var e=t.getId(),i=this._areaInfos[e];this._removeAreaFromStack(i,false),this._showShadow(i)}},_recalculateShadow:function(){for(var t=[],e=this._stack.length-1;e>-1;e--){var i=this._stack[e].control,n=i.getContainer().width(),a=t.indexOf(n)>-1;if(this._toggleAreaShadow(i,!a),!a)t.push(n)}},_afterClose:function(t){if(t._options.isStack)this._checkToggleContentScroll();if(this._prevArea===t)this._prevArea=null},_changeMaximizeMode:function(){this._recalculateShadow()},_setAreaInfo:function(t,e){var i=t.getId(),n=new y;n.control=t,n.hideSideBar=e.hideSideBar,n.id=i,this._areaInfos[i]=n},_addArea:function(t){this._calcVariables(),this._isCalculatingVariables=true,this._areas[t.getId()]=t},_removeArea:function(t){var e=t.getId(),i=this._areaInfos[e];if(i)delete this._areaInfos[e],this._removeAreaFromStack(i,true);delete this._areas[e]},_useTouch:function(){return t.compatibility.touch&&0===c()},_haveMaximizedWindows:function(){return this._maximizedWindows.length>0},_needBodyRight:function(t){for(var e=-1,i=0,n=this._maximizedWindows.length;i<n;i++){if(this._maximizedWindows[i]===t)return true;if(this._maximizedWindows[i].getZIndex()>e)e=this._maximizedWindows[i].getZIndex()}return e>-1&&t.getZIndex()>e},_setWindowMaximized:function(t,e){var i=this._haveMaximizedWindows(),n=-1!==l(this._maximizedWindows,function(e){return e===t});if(e&&!n)this._maximizedWindows.push(t);else if(!e&&n)this._maximizedWindows=this._maximizedWindows.filter(function(e){return e!==t});if(i!==this._haveMaximizedWindows())this._checkToggleContentScroll(),this._resize()},_checkToggleContentScroll:function(){var t=this._stack.length+this._maximizedWindows.length>0;if(t!==this._hasAnyFloatArea)this._hasAnyFloatArea=t,o.setHasAnyFloatArea(t)},_removeAreaFromStack:function(e,i){var n=this._stack.indexOf(e),a=-1!==n;if(a){if(t.browser.isMobilePlatform)this._setTopFloatAreaWebkitOverflowScrolling("auto");if(this._stack.splice(n,1),t.browser.isMobilePlatform){var r=this._setTopFloatAreaWebkitOverflowScrolling("touch"),o=false===r?false:r.getContainer();this._strictOverflowScrollingOnScrollContainersUnderTopFloatArea(o)}if(i)this._checkToggleContentScroll();if(this._canHideSidebar())this._updateSideBarVisibility()}return a},_compareZIndex:function(t,e){if(t.control.getZIndex()<e.control.getZIndex())return-1;if(t.control.getZIndex()>e.control.getZIndex())return 1;return 0},_getMaxZIndex:function(){var t=i.getDefaultZIndex();return s(this._stack.sort(this._compareZIndex),function(e){var i=e.control.getZIndex();return t=i>t?i:t,false}),t},_getTopFloatArea:function(){if(this._stack.length>0)return this._stack.sort(this._compareZIndex),this._stack[this._stack.length-1];else return false},_setTopFloatAreaWebkitOverflowScrolling:function(t){var e=this._getTopFloatArea();if(e)return e.control._visibleRoot.css("-webkit-overflow-scrolling",t),this._topFloatArea=e.control,this._topFloatArea;else return false},_strictOverflowScrollingOnScrollContainersUnderTopFloatArea:function(t){for(var e in this._scrollableContainers)if(this._scrollableContainers.hasOwnProperty(e)){var i=this._scrollableContainers[e];if(false===t)i.css("-webkit-overflow-scrolling","touch");else if(0===t.find(i).length)i.css("-webkit-overflow-scrolling","auto");else i.css("-webkit-overflow-scrolling","touch")}},_toggleHasPopupInside:function(e,i){if(console.log(e,i),t.browser.isMobilePlatform)if(this._topFloatArea&&this._topFloatArea.getId()===e)if(i){this._setTopFloatAreaWebkitOverflowScrolling("auto");for(var n in this._scrollableContainers)if(this._scrollableContainers.hasOwnProperty(n))this._scrollableContainers[n].css("-webkit-overflow-scrolling","auto")}else{var a=this._setTopFloatAreaWebkitOverflowScrolling("touch"),r=false===a?false:a.getContainer();this._strictOverflowScrollingOnScrollContainersUnderTopFloatArea(r)}}};if("undefined"!==typeof window)$(function(){W._init()});return W});
//# sourceMappingURL=FloatAreaManager.js.map
define("SBIS3.CONTROLS/ScrollContainer",["SBIS3.CONTROLS/CompoundControl","SBIS3.CONTROLS/ScrollContainer/Scrollbar","tmpl!SBIS3.CONTROLS/ScrollContainer/ScrollContainer","Core/detection","Core/compatibility","Lib/FloatAreaManager/FloatAreaManager","Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager","Core/constants","Core/EventBus","Core/CommandDispatcher","css!SBIS3.CONTROLS/ScrollContainer/ScrollContainer"],function(e,t,i,n,r,o,s,l,a,c){"use strict";var h=null,_=e.extend({_dotTplFn:i,$protected:{_options:{content:"",stickyContainer:false,activableByClick:false,isPaging:false,shadowStyle:"standart",navigationToolbar:{begin:false,prev:false,pages:false,next:false,end:false},takeScrollbarHidden:true},_content:null},$constructor:function(){this._headerHeight=0,this._craftedContext=false,this._context=this._context.getPrevious(),c.declareCommand(this,"resizeYourself",function(){this._resizeInner()}.bind(this))},_modifyOptions:function(e){return(e=_.superclass._modifyOptions.apply(this,arguments))._isMobileIOS=n.isMobileIOS,e},_modifyOptionsAfter:function(e){delete e.content},init:function(){_.superclass.init.call(this);var e;if(this._content=$("> .controls-ScrollContainer__content",this.getContainer()),e=!(n.isMobileIOS||n.isMobileAndroid),this._bindOfflainEvents(),e){if(this._hideScrollbar=this._hideScrollbar.bind(this),this._initScrollbar=this._initScrollbar.bind(this),this._container.one("mouseenter",this._initScrollbar),this._container.one("wheel",this._initScrollbar),this._requestTakeScrollbarHandler=this._requestTakeScrollbarHandler.bind(this),this._returnTakeScrollbarHandler=this._returnTakeScrollbarHandler.bind(this),this._onMouseenter=this._onMouseenter.bind(this),this._onMouseleave=this._onMouseleave.bind(this),!this._options.takeScrollbarHidden)this._subscribeTakeScrollbar();else this._subscribeMouseEnterLeave();this._isTakeScrollbar=3}this._subscribeOnScroll(),this.subscribeTo(a.channel("stickyHeader"),"onStickyHeadersChanged",this._stickyHeadersChangedHandler.bind(this)),this._content.removeClass("controls-ScrollContainer__content-overflowHidden"),this._hideBrowserScrollbar(),o._scrollableContainers[this.getId()]=this.getContainer().find(".controls-ScrollContainer__content"),this._initPaging()},_hideBrowserScrollbar:function(){var e;if(null===h)h=this._getBrowserScrollbarWidth();if(e={marginRight:-h},r.touch&&n.isIE)e.paddingRight=h;this._content.css(e)},_getBrowserScrollbarWidth:function(){var e=null,t,i;if(/AppleWebKit/.test(navigator.userAgent))e=0;else if(n.isMac)e=15;if(n.isIE12)e=16;if(n.isIE10||n.isIE11)e=17;if(null===e)(i=(t=document.createElement("div")).style).position="absolute",i.width="100px",i.height="100px",i.overflow="scroll",i.top="-9999px",document.body.appendChild(t),e=t.offsetWidth-t.clientWidth,document.body.removeChild(t);return e},_stickyHeadersChangedHandler:function(){if(this._scrollbar)this._recalcSizeScrollbar()},_toggleGradient:function(){var e;if(this._getContainerHeight()&&"none"!==this._options.shadowStyle)e=this._getScrollHeight()-this._getContainerHeight(),this._container.toggleClass("controls-ScrollContainer__bottom-gradient",e>1&&this._getScrollTop()<e),this._container.toggleClass("controls-ScrollContainer__top-gradient",this._getScrollTop()>0)},_initScrollbar:function(){if(!this._scrollbar)this._scrollbar=new t({element:$("> .controls-ScrollContainer__scrollbar",this._container),contentHeight:this._getScrollHeight(),position:this._getScrollTop(),parent:this}),this.subscribeTo(this._scrollbar,"onScrollbarDrag",this._scrollbarDragHandler.bind(this)),this._resizeInner();this._toggleGradient()},_showScrollbar:function(){this._container.toggleClass("controls-ScrollContainer__scrollbar_show",true)},_hideScrollbar:function(){this._container.toggleClass("controls-ScrollContainer__scrollbar_show",false)},_subscribeOnScroll:function(){this._content.on("scroll",this._onScroll.bind(this))},_subscribeTakeScrollbar:function(){if(this._getScrollHeight()-this._getContainerHeight()>1)this._subscribeMouseEnterLeave();else this._unsubscribeMouseEnterLeave()},_subscribeMouseEnterLeave:function(){this._container.on("mouseenter",this._onMouseenter).on("mouseleave",this._onMouseleave)},_unsubscribeMouseEnterLeave:function(){this._container.off("mouseenter",this._onMouseenter).off("mouseleave",this._onMouseleave)},_getScrollContainerChannel:function(){return a.channel("ScrollContainerChannel")},_onScroll:function(e){var t=this._getScrollTop();if(this._scrollbar)this._scrollbar.setPosition(t);if(this._paging)this._calcPagingSelectedKey(t);this._toggleGradient()},_onMouseenter:function(){var e=this._getScrollContainerChannel();if(this._isHover)return;if(this._isHover=true,this._isTakeScrollbar=2,e.subscribe("onReturnTakeScrollbar",this._returnTakeScrollbarHandler),e.once("onReturnTakeScrollbar",this._subscribeOnMousemove.bind(this)),e.hasEventHandlers("onRequestTakeScrollbar"))e.notify("onRequestTakeScrollbar",1);else e.notify("onReturnTakeScrollbar",true)},_onMouseleave:function(){var e=this._getScrollContainerChannel();if(this._isTakeScrollbar)e.notify("onRequestTakeScrollbar",1),e.unsubscribe("onRequestTakeScrollbar",this._requestTakeScrollbarHandler),e.unsubscribe("onReturnTakeScrollbar",this._returnTakeScrollbarHandler);else this._isTakeScrollbar=2;this._isHover=false},_subscribeOnMousemove:function(){this._container.one("mousemove",this._oneMousemove.bind(this))},_oneMousemove:function(){this._isTakeScrollbar=3},_requestTakeScrollbarHandler:function(e,t){var i=this._getScrollContainerChannel();if(this._isTakeScrollbar&t)i.unsubscribe("onRequestTakeScrollbar",this._requestTakeScrollbarHandler),this._hideScrollbar();else t=0;if(this._getScrollContainerChannel().notify("onReturnTakeScrollbar",t),t)i.subscribe("onReturnTakeScrollbar",this._returnTakeScrollbarHandler)},_returnTakeScrollbarHandler:function(e,t){var i=this._getScrollContainerChannel();if(t)i.subscribe("onRequestTakeScrollbar",this._requestTakeScrollbarHandler),i.unsubscribe("onReturnTakeScrollbar",this._returnTakeScrollbarHandler),this._showScrollbar()},_setTakeScrollbar:function(e){this._isTakeScrollbar=e},_calcPagingSelectedKey:function(e){var t=e/this._getContainerHeight();if(!(t%1))t+=1;else if(t=Math.ceil(t),t+1===this._paging.getPagesCount())t+=1;if(this._page!==t)t=Math.min(t,this._paging.getPagesCount()),this._page=t,this._paging.setSelectedKey(t)},_scrollbarDragHandler:function(e,t){if(t!=this._getScrollTop())if(this._scrollTo(t),this._paging)this._calcPagingSelectedKey(t)},_onResizeHandler:function(){_.superclass._onResizeHandler.apply(this,arguments),this._resizeInner()},_toggleOverflowHidden:function(e){if(this._content.toggleClass("controls-ScrollContainer__content-overflowHidden",e),e)this._content.css({marginRight:0,paddingRight:0});else this._hideBrowserScrollbar()},_resizeInner:function(){if(this._scrollbar)this._recalcSizeScrollbar(),this._scrollbar.setContentHeight(this._getScrollHeight()),this._scrollbar.setPosition(this._getScrollTop());if(this._content){if(this._toggleGradient(),n.firefox)this._toggleOverflowHidden(!this._getChildContentHeight());if(n.isIE)this._toggleOverflowHidden(this._getScrollHeight()-Math.floor(this._container.height())<=1);if(!this._options.takeScrollbarHidden)this._subscribeTakeScrollbar()}if(this._paging){var e=this._getContainerHeight();if(e)this._setPagesCount(Math.ceil(this._getScrollHeight()/e))}},_recalcSizeScrollbar:function(){var e,t;if(this._options.stickyContainer)if(e=s.getStickyHeaderHeight(this._content),this._headerHeight!==e)(t=this._scrollbar._container).css("margin-top",e),t.height("calc(100% - "+e+"px)"),this._headerHeight=e},_getChildContentHeight:function(){var e=0;return Array.prototype.forEach.call(this._content.children(),function(t){e+=$(t).outerHeight(true)}),e},_getScrollTop:function(){return this._content[0].scrollTop},_scrollTo:function(e){this._content[0].scrollTop=e},_getScrollHeight:function(){var e;if(e=this._content[0].scrollHeight,this.getContainer().hasClass("controls-ScrollContainer__withHead"))e-=24;return e},_getContainerHeight:function(){return this._container.get(0).offsetHeight},destroy:function(){if(this._content)this._content.off("scroll",this._onScroll);this._container.off("mousemove",this._initScrollbar),this._unsubscribeMouseEnterLeave(),this._getScrollContainerChannel().unsubscribe("onReturnTakeScrollbar",this._returnTakeScrollbarHandler).unsubscribe("onRequestTakeScrollbar",this._requestTakeScrollbarHandler),_.superclass.destroy.call(this),delete o._scrollableContainers[this.getId()]},_bindOfflainEvents:function(){if(l.browser.retailOffline)this._content[0].addEventListener("touchstart",function(e){this._startPos=this._content.scrollTop()+e.targetTouches[0].pageY}.bind(this),true),this._content[0].addEventListener("touchmove",function(e){this._moveScroll(this._startPos-e.targetTouches[0].pageY),e.preventDefault()}.bind(this))},_moveScroll:function(e){this._content.scrollTop(e)},_initPaging:function(){if(this._options.isPaging)requirejs(["SBIS3.CONTROLS/Paging"],function(e){this._paging=new e({element:this._container.find(".js-controls-ScrollContainer__paging"),className:"controls-ScrollContainer__paging controls-ListView__scrollPager",visiblePath:this._options.navigationToolbar,parent:this});var t=this._getContainerHeight();if(t)this._setPagesCount(Math.ceil(this._getScrollHeight()/t));this._paging.subscribe("onSelectedItemChange",this._pageChangeHandler.bind(this)),this._page=1}.bind(this))},_setPagesCount:function(e){if(this._paging.setPagesCount(e),1===e)this._paging.hide();else this._paging.show()},_pageChangeHandler:function(e,t){var i=this._getContainerHeight()*(t-1);if(this._page!==t)this._page=t,this._scrollTo(i)}});return _});
//# sourceMappingURL=ScrollContainer.js.map
define("tmpl!SBIS3.CONTROLS/Button/BackButton/BackButton",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Link"],function(){var t=Array.prototype.slice.call(arguments),e=t[0],o={};o["js!SBIS3.CONTROLS/Link"]=t[1];var r=function t(r,n,a,c,i){function s(){}var l=0,u=void 0!==e&&e?e:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var p={};i&&i.isSetts&&(p=i.fullContext||{});var B="string"==typeof a?a:"",d=void 0===o?void 0:o,m={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),k=this&&this.includedTemplates?this.includedTemplates:{},_=u.getMarkupGenerator(c);try{var g=_.joinElements([_.createTag("div",{class:"controls-BackButton "+u.wrapUndef(u.utils.escape(u.getter(r,["caption"])?"":"controls-BackButton__empty"))+" "+u.wrapUndef(u.utils.escape(u.getter(r,["visible"])?"":"ws-hidden"))+" controls-BackButton_color-hover_"+u.wrapUndef(u.utils.escape(u.getter(r,["style"])))},[_.createTag("a",{href:""+u.wrapUndef(u.utils.escape(u.getter(r,["href"]))),class:"controls-BackButton__captionArrow_size_"+u.wrapUndef(u.utils.escape("h2"===u.getter(r,["size"])?"1":"2"))+"      ws-backArrow_color_"+u.wrapUndef(u.utils.escape(u.getter(r,["style"])))+" ws-backArrow_size_"+u.wrapUndef(u.utils.escape(u.getter(r,["size"])))},[],{},m,this),_.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"BackButton-caption",className:"controls-BackButton__caption controls-BackButton__caption_color_"+u.getter(r,["style"])+"      controls-BackButton__caption_size_"+u.getter(r,["size"])+" controls-BackButton__caption_size_bold",caption:u.getter(r,["caption"]),tooltip:u.getter(r,["tooltip"])||u.getter(r,["caption"]),icon:u.getter(r,["icon"]),href:u.getter(r,["href"]),escapeCaptionHtml:u.getter(r,["escapeCaptionHtml"]),command:u.getter(r,["command"]),commandArgs:u.getter(r,["commandArgs"])},{name:"BackButton-caption",sbisname:"BackButton-caption"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},a,d,k,u.config,p),_.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"BackButton-arrow",className:"controls-BackButton__arrow controls-Link__disabledHover",icon:"icon-16 icon-View icon-primary action-hover",tabindex:"0",activableByClick:!1},{name:"BackButton-arrow",sbisname:"BackButton-arrow"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},a,d,k,u.config,p)],n,m,this)],B,m);m.def&&(g=_.chain(g,m,n),m=void 0)}catch(t){u.templateError("resources/SBIS3.CONTROLS/Button/BackButton/BackButton.tmpl",t,r)}return g||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Button/BackButton/BackButton"}},r});
//# sourceMappingURL=BackButton.tmpl.map
define("Deprecated/helpers/String/parseComplexKey",function(){return function(e){if("string"==typeof e){var r=e.indexOf(",");if(-1!=r)return{objName:e.substr(r+1),objKey:e.substr(0,r)}}return{objName:"",objKey:e}}});
//# sourceMappingURL=parseComplexKey.js.map
define("Core/helpers/String/escapeASCII",function(){return function(e){if("string"==typeof e){var n={"&minus;":"-","&nbsp;":" ","&#92;":"\\"},r;for(r in n)e=e.replace(new RegExp(r,"g"),n[r])}return e}});
//# sourceMappingURL=escapeASCII.js.map
define("Deprecated/helpers/string-helpers",["Core/helpers/string-helpers-min","Deprecated/helpers/String/parseComplexKey","Core/helpers/String/escapeTagsFromStr","Core/helpers/String/escapeUnicode","Core/helpers/String/unEscapeASCII","Core/helpers/String/escapeASCII"],function(e,r,a,s,n,p){var t={urlRegExpString:"(https?|ftp|file)://[-A-Za-zА-ЯЁа-яё0-9.]+(?::[0-9]+)?(/([-A-Za-zА-ЯЁа-яё0-9+&@#$/%№=~_{|}!?:,.;()'[\\]](?!&nbsp;|amp;nbsp;))*)*",excludeLinkString:"<[\\s]*a[\\s\\S]*?>[\\s\\S]*?</a>|",removeWhiteSpaces:function(e){return"string"===typeof e?e.replace(/\s/g,""):void 0},escapeTagsFromStr:a,htmlToText:function(e){var r=e.replace(/<br>/g,"\n");return t.escapeTagsFromStr(r,"\\w+")},escapeASCII:p,unEscapeASCII:n,unEscapeHtmlSpecialChars:function(e){if("string"==typeof e){var r={"&minus;":"-","&nbsp;":" ","&#92;":"\\"},a;for(a in r)e=e.replace(new RegExp(a,"g"),r[a])}return e},serializeURLData:e.serializeURLData,deserializeURLData:e.deserializeURLData,parseComplexKey:r,removeInvalidXMLChars:function(e){if("string"==typeof e)e=e.replace(/[^\x09\x0A\x0D\x20-\uD7FF\uE000-\uFFFD\u10000-\u10FFFF]*/g,"");return e},escapeUnicode:s};return t});
//# sourceMappingURL=string-helpers.js.map
define("Core/helpers/i18n/moneyToWritten",function(){var r={0:"",1:"один",2:"два",3:"три",4:"четыре",5:"пять",6:"шесть",7:"семь",8:"восемь",9:"девять",10:"десять",11:"одиннадцать",12:"двенадцать",13:"тринадцать",14:"четырнадцать",15:"пятнадцать",16:"шестнадцать",17:"семнадцать",18:"восемнадцать",19:"девятнадцать"},t={1:"одна",2:"две"},e={2:"двадцать",3:"тридцать",4:"сорок",5:"пятьдесят",6:"шестьдесят",7:"семьдесят",8:"восемьдесят",9:"девяносто"},n={0:"",1:"сто",2:"двести",3:"триста",4:"четыреста",5:"пятьсот",6:"шестьсот",7:"семьсот",8:"восемьсот",9:"девятьсот"},a={0:{0:"",1:"",2:""},1:{0:"тысяч",1:"тысяча",2:"тысячи"},2:{0:"миллионов",1:"миллион",2:"миллиона"},3:{0:"миллиардов",1:"миллиард",2:"миллиарда"},4:{0:"триллионов",1:"триллион",2:"триллиона"},5:{0:"квадриллионов",1:"квадриллион",2:"квадриллиона"},6:{0:"квинтиллионов",1:"квинтиллион",2:"квинтиллиона"},7:{0:"сикстиллионов",1:"сикстиллион",2:"сикстиллиона"},8:{0:"септиллионов",1:"септиллион",2:"септиллиона"},9:{0:"октиллионов",1:"октиллион",2:"октиллиона"},10:{0:"нониллионов",1:"нониллион",2:"нониллиона"},11:{0:"дециллионов",1:"дециллион",2:"дециллиона"}},i=function(a,i){var s=r,f,u;if(i)(s=Object.create(r))["1"]=t["1"],s["2"]=t["2"];if(u=a%100,u=u<=19?s[u]:e[Math.floor(u/10)]+(u%10?" ":"")+s[u%10],f=n[Math.floor(a/100)],f&&u)f+=" ";return f+u},s=function(r){var t=Math.abs(r%10),e=Math.abs(r%100);if(0===t||t>=5||e>=11&&e<=19)return 0;if(1===t)return 1;return 2},f=function(r,t,e){e=e||true;var n="",f=0,u,h,c;if("-"===r.charAt(0))if(e)c=true,r=r.slice(1);else return"ОШИБКА";if(0===parseInt(r,10))return"ноль";if(isNaN(r))return"ОШИБКА";if(""===r)return"";while(r.length>0){u=parseInt(r.substr(Math.max(r.length-3,0),3),10);var l=s(u);if(h=a[f]&&a[f][l]?" "+a[f][l]:"",u>0){if(f&&""===h)return"ОШИБКА";n=i(u,1===f||t)+h+(n?" "+n:"")}r=r.slice(0,-3),f++}if(c)n="минус "+n;return n};return function r(t,e){if(t=(t+"").replace(/\s/g,""),isNaN(t)||!t.match(/^[-0-9.]*$/))return"ОШИБКА";if(""===t)return"";var n=(t+"").split("."),a=n[0]||"0",i=n[1]||"00",u={0:"рублей",1:"рубль",2:"рубля"},h={0:"копеек",1:"копейка",2:"копейки"},c,l,o;if("-"===a)a="-0";if(1===i.length)i+="0";if(i.length>2){var p=i.charAt(2);if(i=i.substr(0,2),p>="5"){if(i=parseInt(i,10)+1+"",1===i.length)i="0"+i;if("100"===i){if(i="00",""===a)a=1;var b=a.length-1,g="";while(true)if(b<0||isNaN(parseInt(a.charAt(b),10))){g=(b>=0?a.substr(0,b+1):"")+"1"+g;break}else if("9"===a.charAt(b))g="0"+g,b--;else{g=a.substr(0,b)+(parseInt(a.charAt(b),10)+1)+g;break}a=g}}}if(c=f(a),"ОШИБКА"===c)return"ОШИБКА";if(c=c||"ноль",c+=" "+(e?"руб":u[s(parseInt(a.substr(Math.max(0,a.length-2),2),10))]),l=" "+i+" "+(e?"коп":h[s(parseInt(i,10))]),parseInt(i.substr(0,2),10)>0&&"-"===a.charAt(0)&&"м"!==c.charAt(0))c="минус "+c;return o=c+l,o=o.charAt(0).toUpperCase()+o.substr(1),o}});
//# sourceMappingURL=moneyToWritten.js.map
define("Core/helpers/string-helpers",["Core/helpers/String/linkWrap","Core/helpers/i18n/moneyToWritten","Core/helpers/i18n/wordCaseByNumber","Core/helpers/string-helpers-min","Core/IoC","Core/helpers/String/diffAt","Core/helpers/String/format","Core/deprecated","Deprecated/helpers/string-helpers","Core/helpers/String/escapeHtml","Core/helpers/String/escapeTagsFromStr","Core/helpers/String/unEscapeHtml","Core/helpers/String/escapeUnicode","Core/helpers/String/unEscapeASCII","Core/helpers/String/escapeASCII","Core/constants","Core/ConsoleLogger"],function(e,r,s,a,n,t,o,i,l,p,c,C,h,m,u){var S=i.callNextWrapper,g=function(e,r){return function(){i.showInfoLog("Хелпер Core/helpers/string-helpers::"+e+" помечен как deprecated и будет удален в 3.18."+(r?" Подключите явно "+r+", чтобы им пользоваться.":""))}};return{urlRegExpString:e.urlRegExpString,excludeLinkString:e.excludeLinkString,removeWhiteSpaces:S(l.removeWhiteSpaces,g("removeWhiteSpaces")),escapeTagsFromStr:c,htmlToText:S(l.htmlToText,g("htmlToText")),escapeHtml:p,unEscapeHtml:C,escapeASCII:S(u,g("escapeASCII","Core/helpers/String/escapeASCII")),unEscapeASCII:S(m,g("unEscapeASCII","Core/helpers/String/unEscapeASCII")),unEscapeHtmlSpecialChars:S(l.unEscapeHtmlSpecialChars,g("unEscapeHtmlSpecialChars")),serializeURLData:a.serializeURLData,deserializeURLData:a.deserializeURLData,removeInvalidXMLChars:S(l.removeInvalidXMLChars,g("removeInvalidXMLChars")),numToWritten:S(r,g("numToWritten","Core/helpers/i18n/moneyToWritten")),wordCaseByNumber:S(s,g("wordCaseByNumber","Core/helpers/i18n/wordCaseByNumber")),escapeUnicode:h,transliterate:a.transliterate,parseComplexKey:S(l.parseComplexKey,g("parseComplexKey","Deprecated/helpers/string-helpers::parseComplexKey()")),searchSymbolsDifference:S(function(e,r){var s=t(e,r);return-1===s?false:[e.substr(0,s),e.substr(s),r.substr(s)]},g("searchSymbolsDifference","Core/helpers/String/diffAt")),wrapURLs:e.wrapURLs,wrapFiles:e.wrapFiles,prepareMoneyByPrecision:function(e,r){var s=/^\-?(\d+)(\.\d{0,})?$/.exec(e);if(null!==s){r=+r||4;var a=s[2],t=s[1];if("undefined"===typeof a)a=".";var o=r-a.length+1;if(o>0)for(var i=0;i<o;i++)a+="0";else if(o<0)a=a.slice(0,o);return t+a}else n.resolve("ILogger").error("prepareMoneyByPrecision","Value containing not valid characters only numbers allowed.");return e},format:S(o,g("format","Core/helpers/String/format"))}});
//# sourceMappingURL=string-helpers.js.map
define("SBIS3.CONTROLS/Button/BackButton",["Lib/Control/CompoundControl/CompoundControl","Core/helpers/string-helpers","tmpl!SBIS3.CONTROLS/Button/BackButton/BackButton","SBIS3.CONTROLS/Link","css!SBIS3.CONTROLS/Button/BackButton/BackButton"],function(t,n,o){"use strict";var i=t.extend({_dotTplFn:o,$protected:{_link:null,_options:{caption:"",icon:"",href:"",style:"default-backButton",size:"default-backButton"}},init:function(){this._publish("onActivated","onArrowActivated"),i.superclass.init.call(this);var t=this;this._link=this.getChildControlByName("BackButton-caption"),this._container.on("click",function(n){if(!$(n.target).hasClass("controls-BackButton__arrow"))if(t._notify("onActivated"),!!t._options.command&&t.isEnabled()){var o=[t._options.command].concat(t._options.commandArgs);t.sendCommand.apply(t,o)}}),this.subscribeTo(this.getChildControlByName("BackButton-arrow"),"onActivated",function(){t._notify("onArrowActivated")}),this._link.subscribe("onActivated",function(){t._notify("onActivated")})},getCaption:function(){return this._options.caption},getHref:function(){return this._options.href},setCaption:function(t){var o=null===t||""===t||"undefined"===typeof t;this._link.setCaption(t),this.setTooltip(n.htmlToText(t||"")),this._options.caption=t,this._container.toggleClass("controls-BackButton__empty",o)},setIcon:function(t){this._link.setIcon(t),this._options.icon=t},setHref:function(t){this._link.setHref(t),this._options.href=t},setTooltip:function(t){this._link.setTooltip.apply(this._link,arguments),i.superclass.setTooltip.apply(this,arguments)}});return i});
//# sourceMappingURL=BackButton.js.map
define("tmpl!SBIS3.DOCVIEW.List",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Tree/CompositeView","js!SBIS3.CONTROLS/Button/BackButton","js!SBIS3.CONTROLS/BreadCrumbs","js!SBIS3.CONTROLS/Link"],function(){var t=Array.prototype.slice.call(arguments),e=t[0],i={};i["js!SBIS3.CONTROLS/Tree/CompositeView"]=t[1],i["js!SBIS3.CONTROLS/Button/BackButton"]=t[2],i["js!SBIS3.CONTROLS/BreadCrumbs"]=t[3],i["js!SBIS3.CONTROLS/Link"]=t[4];var o=function t(o,r,s,l,a){function n(){}var p=0,d=void 0!==e&&e?e:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var c={};a&&a.isSetts&&(c=a.fullContext||{});var g="string"==typeof s?s:"",m=void 0===i?void 0:i,u={id:[],def:void 0},O=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),y=this&&this.includedTemplates?this.includedTemplates:{},v=d.getMarkupGenerator(l);try{var w=v.joinElements([void(y.tree=function(t,e){var i=this&&this.includedTemplates?this.includedTemplates:{},o=d.getMarkupGenerator(l);try{var r=o.joinElements([o.createControl("wsControl","ws:SBIS3.CONTROLS/Tree/CompositeView",{filter:{catalogId:d.getter(t,["mainOptions","fixId"])},templateBinding:{doNotRequestPreview:d.getter(t,["listOptions","doNotRequestPreview"]),folderAsPreview:d.getter(t,["listOptions","visibilityMode","folderAsPreview"])},name:"attachments",className:(!1!==d.getter(t,["listOptions","visibilityMode","hasSeparator"])?"controls-DataGridView__hasSeparator":"")+("bigPreview"===d.getter(t,["listOptions","visibilityMode","defaultMode"])||d.getter(t,["listOptions","visibilityMode","withoutMarker"])?" controls-ListView__withoutMarker":""),activableByClick:!!d.getter(t,["listOptions","activableByClick"]),allowChangeEnable:!1,allowEmptySelection:d.getter(t,["listOptions","allowEmptySelection"]),allowEnterToFolder:!0,autoRedraw:!1,columns:d.getter(t,["listOptions","columns"]),displayProperty:d.getter(t,["listOptions","displayField"]),easyGroup:!0,emptyHTML:d.getter(t,["listOptions","emptyHTML"]),enabled:!0,groupBy:d.getter(t,["listOptions","groupBy"]),idProperty:"attachId",includedTemplates:d.getter(t,["listOptions","includedTemplates"]),infiniteScroll:!d.getter(t,["listOptions","needMoreButton"])&&!d.getter(t,["mainOptions","useOnlyCtx"])&&d.getter(t,["listOptions","infiniteScroll"]),items:d.getter(t,["listOptions","items"]),itemsDragNDrop:d.getter(t,["listOptions","itemsDragNDrop"]),itemsSortMethod:d.getter(t,["listOptions","itemsSortMethod"]),listFolderTpl:d.getter(t,["listOptions","itemTpl"]),listTpl:d.getter(t,["listOptions","itemTpl"]),loadItemsStrategy:d.getter(t,["listOptions","loadItemsStrategy"]),multiselect:d.getter(t,["listOptions","multiselect"]),nodeProperty:d.getter(t,["listOptions","visibilityMode","folderAsPreview"])&&!d.getter(t,["listOptions","goToFolder"])?"someValueForShowFoldersAsPlainItems":void 0,pageSize:d.getter(t,["listOptions","pageSize"])+1,parentProperty:d.getter(t,["listOptions","parentProperty"]),root:d.getter(t,["listOptions","root"]),scrollPaging:!1,showHead:!1,showPaging:d.getter(t,["listOptions","showPaging"]),viewMode:"diskClassic"===d.getter(t,["listOptions","visibilityMode","defaultMode"])?"table":"list",esc:!1,bindings:[{fieldName:""+d.getter(t,["mainOptions","ctxLinkId"]),propName:"filter/catalogId",propPath:["catalogId"],fullPropName:"filter/catalogId",propPathStr:"catalogId",oneWay:!0,direction:"fromContext",bindNonExistent:!0}]},d.plainMerge(e,{name:"attachments",sbisname:"attachments"}),{data:t,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:O,internal:{__dirtyCheckingVars_0:d.getter(t,["listOptions","doNotRequestPreview"]),__dirtyCheckingVars_1:d.getter(t,["listOptions","visibilityMode","folderAsPreview"])}},s,m,i,d.config,c)],g,u);u.def&&(r=o.chain(r,u,e),u=void 0)}catch(e){d.templateError("resources/Docview/List/List.tmpl",e,t)}return r||""}.bind({includedTemplates:y})),v.createTag("div",{class:"docview-list docview-list_mode-"+d.wrapUndef(d.utils.escape(d.getDecorators().toLowerCase.apply(void 0,[d.getter(o,["listOptions","visibilityMode","defaultMode"])])))+" "+d.wrapUndef(d.utils.escape(d.getter(o,["_privateMegaFixOption"])?"preview-is-width":""))+" "+d.wrapUndef(d.utils.escape(d.getter(o,["listOptions","visibilityMode","folderAsPreview"])?"dv-folder-as-preview":""))+" "+d.wrapUndef(d.utils.escape(d.getter(o,["listOptions","enableExpand"])?"":"docview-list_no-expand"))+" "+d.wrapUndef(d.utils.escape(d.getter(o,["listOptions","stickyPath"])?"docview-list_sticky-path":""))+" "+d.wrapUndef(d.utils.escape(d.getter(o,["mainOptions","useOnlyCtx"])?"docview-list_context":""))},[!d.getter(o,["listOptions","hideBreadCrumbs"])&&d.getter(o,["listOptions","hasHierarchy"])?[v.createTag("div",{class:"docview-list__path "+d.wrapUndef(d.utils.escape(d.getter(o,["listOptions","stickyPath"])?"ws-sticky-header__block":""))+d.wrapUndef(d.utils.escape(d.getter(o,["_hidePath"])?"ws-hidden":""))},[v.createTag("div",{class:"docview-list__path-navigation"},[v.createControl("wsControl","ws:SBIS3.CONTROLS/Button/BackButton",{name:"MyBackButton",allowChangeEnable:!1},{name:"MyBackButton",sbisname:"MyBackButton"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:O},s,m,y,d.config,c),v.createControl("wsControl","ws:SBIS3.CONTROLS/BreadCrumbs",{name:"MyBreadCrumbs",allowChangeEnable:!1},{name:"MyBreadCrumbs",sbisname:"MyBreadCrumbs"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:O},s,m,y,d.config,c)],{},u,this),d.getter(o,["listOptions","pathPlaceholderTemplate"])?[v.createTag("div",{class:"docview-list__path-placeholder"},[v.createControl("resolver",d.getter(o,["listOptions","pathPlaceholderTemplate"]),{},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:O},s,m,y,d.config,c,u)],{},u,this)]:v.createText("")],{},u,this)]:v.createText(""),d.getter(o,["listOptions","wrapInScrollContainer"])?[v.createTag("component",{"data-component":"SBIS3.CONTROLS/ScrollContainer",class:"docview-list__container",style:""+d.wrapUndef(d.utils.escape(d.getter(o,["_containerStyle"])))},[v.createTag("option",{name:"content"},[function(t,e){d.prepareAttrsForFocus(e,t,"0");var i=this&&this.includedTemplates?this.includedTemplates:{},o=d.getMarkupGenerator(l);try{var r=o.joinElements([o.createControl("wsControl","ws:SBIS3.CONTROLS/Tree/CompositeView",{filter:{catalogId:d.getter(t,["mainOptions","fixId"])},templateBinding:{doNotRequestPreview:d.getter(t,["listOptions","doNotRequestPreview"]),folderAsPreview:d.getter(t,["listOptions","visibilityMode","folderAsPreview"])},name:"attachments",className:(!1!==d.getter(t,["listOptions","visibilityMode","hasSeparator"])?"controls-DataGridView__hasSeparator":"")+("bigPreview"===d.getter(t,["listOptions","visibilityMode","defaultMode"])||d.getter(t,["listOptions","visibilityMode","withoutMarker"])?" controls-ListView__withoutMarker":""),activableByClick:!!d.getter(t,["listOptions","activableByClick"]),allowChangeEnable:!1,allowEmptySelection:d.getter(t,["listOptions","allowEmptySelection"]),allowEnterToFolder:!0,autoRedraw:!1,columns:d.getter(t,["listOptions","columns"]),displayProperty:d.getter(t,["listOptions","displayField"]),easyGroup:!0,emptyHTML:d.getter(t,["listOptions","emptyHTML"]),enabled:!0,groupBy:d.getter(t,["listOptions","groupBy"]),idProperty:"attachId",includedTemplates:d.getter(t,["listOptions","includedTemplates"]),infiniteScroll:!d.getter(t,["listOptions","needMoreButton"])&&!d.getter(t,["mainOptions","useOnlyCtx"])&&d.getter(t,["listOptions","infiniteScroll"]),items:d.getter(t,["listOptions","items"]),itemsDragNDrop:d.getter(t,["listOptions","itemsDragNDrop"]),itemsSortMethod:d.getter(t,["listOptions","itemsSortMethod"]),listFolderTpl:d.getter(t,["listOptions","itemTpl"]),listTpl:d.getter(t,["listOptions","itemTpl"]),loadItemsStrategy:d.getter(t,["listOptions","loadItemsStrategy"]),multiselect:d.getter(t,["listOptions","multiselect"]),nodeProperty:d.getter(t,["listOptions","visibilityMode","folderAsPreview"])&&!d.getter(t,["listOptions","goToFolder"])?"someValueForShowFoldersAsPlainItems":void 0,pageSize:d.getter(t,["listOptions","pageSize"])+1,parentProperty:d.getter(t,["listOptions","parentProperty"]),root:d.getter(t,["listOptions","root"]),scrollPaging:!1,showHead:!1,showPaging:d.getter(t,["listOptions","showPaging"]),viewMode:"diskClassic"===d.getter(t,["listOptions","visibilityMode","defaultMode"])?"table":"list",esc:!1,bindings:[{fieldName:""+d.getter(t,["mainOptions","ctxLinkId"]),propName:"filter/catalogId",propPath:["catalogId"],fullPropName:"filter/catalogId",propPathStr:"catalogId",oneWay:!0,direction:"fromContext",bindNonExistent:!0}]},d.plainMerge(e,{name:"attachments",sbisname:"attachments"}),{data:t,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:O,internal:{__dirtyCheckingVars_0:d.getter(t,["listOptions","doNotRequestPreview"]),__dirtyCheckingVars_1:d.getter(t,["listOptions","visibilityMode","folderAsPreview"])}},s,m,i,d.config,c)],g,u);u.def&&(r=o.chain(r,u,e),u=void 0)}catch(e){d.templateError("resources/Docview/List/List.tmpl",e,t)}return r||""}(d.calculateScope({listOptions:d.getter(o,["listOptions"]),mainOptions:d.getter(o,["mainOptions"])},d.plainMerge),{})],{},u,this)],{},u,this)]:[v.createTag("div",{class:"docview-list__container",style:""+d.wrapUndef(d.utils.escape(d.getter(o,["_containerStyle"])))},[function(t,e){d.prepareAttrsForFocus(e,t,"0");var i=this&&this.includedTemplates?this.includedTemplates:{},o=d.getMarkupGenerator(l);try{var r=o.joinElements([o.createControl("wsControl","ws:SBIS3.CONTROLS/Tree/CompositeView",{filter:{catalogId:d.getter(t,["mainOptions","fixId"])},templateBinding:{doNotRequestPreview:d.getter(t,["listOptions","doNotRequestPreview"]),folderAsPreview:d.getter(t,["listOptions","visibilityMode","folderAsPreview"])},name:"attachments",className:(!1!==d.getter(t,["listOptions","visibilityMode","hasSeparator"])?"controls-DataGridView__hasSeparator":"")+("bigPreview"===d.getter(t,["listOptions","visibilityMode","defaultMode"])||d.getter(t,["listOptions","visibilityMode","withoutMarker"])?" controls-ListView__withoutMarker":""),activableByClick:!!d.getter(t,["listOptions","activableByClick"]),allowChangeEnable:!1,allowEmptySelection:d.getter(t,["listOptions","allowEmptySelection"]),allowEnterToFolder:!0,autoRedraw:!1,columns:d.getter(t,["listOptions","columns"]),displayProperty:d.getter(t,["listOptions","displayField"]),easyGroup:!0,emptyHTML:d.getter(t,["listOptions","emptyHTML"]),enabled:!0,groupBy:d.getter(t,["listOptions","groupBy"]),idProperty:"attachId",includedTemplates:d.getter(t,["listOptions","includedTemplates"]),infiniteScroll:!d.getter(t,["listOptions","needMoreButton"])&&!d.getter(t,["mainOptions","useOnlyCtx"])&&d.getter(t,["listOptions","infiniteScroll"]),items:d.getter(t,["listOptions","items"]),itemsDragNDrop:d.getter(t,["listOptions","itemsDragNDrop"]),itemsSortMethod:d.getter(t,["listOptions","itemsSortMethod"]),listFolderTpl:d.getter(t,["listOptions","itemTpl"]),listTpl:d.getter(t,["listOptions","itemTpl"]),loadItemsStrategy:d.getter(t,["listOptions","loadItemsStrategy"]),multiselect:d.getter(t,["listOptions","multiselect"]),nodeProperty:d.getter(t,["listOptions","visibilityMode","folderAsPreview"])&&!d.getter(t,["listOptions","goToFolder"])?"someValueForShowFoldersAsPlainItems":void 0,pageSize:d.getter(t,["listOptions","pageSize"])+1,parentProperty:d.getter(t,["listOptions","parentProperty"]),root:d.getter(t,["listOptions","root"]),scrollPaging:!1,showHead:!1,showPaging:d.getter(t,["listOptions","showPaging"]),viewMode:"diskClassic"===d.getter(t,["listOptions","visibilityMode","defaultMode"])?"table":"list",esc:!1,bindings:[{fieldName:""+d.getter(t,["mainOptions","ctxLinkId"]),propName:"filter/catalogId",propPath:["catalogId"],fullPropName:"filter/catalogId",propPathStr:"catalogId",oneWay:!0,direction:"fromContext",bindNonExistent:!0}]},d.plainMerge(e,{name:"attachments",sbisname:"attachments"}),{data:t,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:O,internal:{__dirtyCheckingVars_0:d.getter(t,["listOptions","doNotRequestPreview"]),__dirtyCheckingVars_1:d.getter(t,["listOptions","visibilityMode","folderAsPreview"])}},s,m,i,d.config,c)],g,u);u.def&&(r=o.chain(r,u,e),u=void 0)}catch(e){d.templateError("resources/Docview/List/List.tmpl",e,t)}return r||""}(d.calculateScope({listOptions:d.getter(o,["listOptions"]),mainOptions:d.getter(o,["mainOptions"])},d.plainMerge),{})],{},u,this)],d.getter(o,["listOptions","needMoreButton"])?[v.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"moreButton",caption:global.rk("Ещё")+"..."},{class:"docview-list__moreButton",name:"moreButton",sbisname:"moreButton"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:O},s,m,y,d.config,c)]:v.createText("")],r,u,this)],g,u);u.def&&(w=v.chain(w,u,r),u=void 0)}catch(t){d.templateError("resources/Docview/List/List.tmpl",t,o)}return w||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.List"}},o});
//# sourceMappingURL=List.tmpl.map
define("tmpl!SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/RichEditorRoundToolbar",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,n,a,l){function d(){}var c=0,s=void 0!==t&&t?t:arguments[arguments.length-1];void 0===s&&(eval("var thelpers = null;"),s=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var p="string"==typeof n?n:"",R=void 0===r?void 0:r,m={id:[],def:void 0},v=s.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),h=this&&this.includedTemplates?this.includedTemplates:{},T=s.getMarkupGenerator(a);try{var f=T.joinElements([T.createTag("div",{class:"controls-RichEditorRoundToolbar"},[T.createTag("div",{class:"controls-RichEditorRoundToolbar__itemsContainer"},[s.getter(o,["_serverRender"])?[T.createControl("resolver",s.getter(o,["_itemsTemplate"]),{records:s.getter(o,["_records"]),tplData:s.getter(o,["_itemData"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},n,R,h,s.config,u,m)]:T.createText("")],{},m,this)],i,m,this)],p,m);m.def&&(f=T.chain(f,m,i),m=void 0)}catch(e){s.templateError("resources/SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/RichEditorRoundToolbar.tmpl",e,o)}return f||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/RichEditorRoundToolbar"}},o});
//# sourceMappingURL=RichEditorRoundToolbar.tmpl.map
define("tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/presetItemTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},n=function e(n,l,o,i,a){function s(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var p={};a&&a.isSetts&&(p=a.fullContext||{});var d="string"==typeof o?o:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),S=this&&this.includedTemplates?this.includedTemplates:{},y=u.getMarkupGenerator(i);try{var N=y.joinElements([y.createControl("resolver",u.getter(n,["defaultItemTpl"]),u.uniteScope(u.utils.escape(u.uniteScope(n,{parent:void 0,element:void 0})(u.plainMerge)),{className:"controls-MenuItem"}),{},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},o,m,S,u.config,p,v)],d,v);v.def&&(N=y.chain(N,v,l),v=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/StylesPanelNew/resources/presetItemTemplate.tmpl",e,n)}return N||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/presetItemTemplate"}},n});
//# sourceMappingURL=presetItemTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/presetItemContentTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},l=function e(l,n,s,i,o){function a(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var u={};o&&o.isSetts&&(u=o.fullContext||{});var d="string"==typeof s?s:"",m=void 0===r?void 0:r,y={id:[],def:void 0},f=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,l),v=this&&this.includedTemplates?this.includedTemplates:{},S=p.getMarkupGenerator(i);try{var g=S.joinElements([S.createTag("span",{class:"controls-StylesPanelNew__historyView-item-title",style:""+p.wrapUndef(p.utils.escape(p.getter(l,["item","get"]).apply(p.getter(l,["item"]),["style"])))},[S.createText(""+p.wrapUndef(p.utils.escape(p.getter(l,["item","get"]).apply(p.getter(l,["item"]),["name"])||"Образец")))],n,y,this)],d,y);y.def&&(g=S.chain(g,y,n),y=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/StylesPanelNew/resources/presetItemContentTpl.tmpl",e,l)}return g||""};return l.includedFunctions={},l.stable=!0,l.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/presetItemContentTpl"}},l});
//# sourceMappingURL=presetItemContentTpl.tmpl.map
define("tmpl!SBIS3.CONTROLS/StylesPanelNew/StylesPanelNew",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Button/IconButton","js!SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle","js!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/ColorStyle","js!SBIS3.CONTROLS/CheckBox","js!SBIS3.CONTROLS/ListView"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={};o["js!SBIS3.CONTROLS/Button/IconButton"]=e[1],o["js!SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle"]=e[2],o["js!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/ColorStyle"]=e[3],o["js!SBIS3.CONTROLS/CheckBox"]=e[4],o["js!SBIS3.CONTROLS/ListView"]=e[5];var r=function e(r,l,n,s,a){function c(){}var i=0,S=void 0!==t&&t?t:arguments[arguments.length-1];void 0===S&&(eval("var thelpers = null;"),S=global.requirejs("View/Runner/tclosure"));var y={};a&&a.isSetts&&(y=a.fullContext||{});var p="string"==typeof n?n:"",u=void 0===o?void 0:o,d={id:[],def:void 0},N=S.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),m=this&&this.includedTemplates?this.includedTemplates:{},C=S.getMarkupGenerator(s);try{var w=C.joinElements([C.createTag("div",{class:"controls-StylesPanel controls-StylesPanelNew"+S.wrapUndef(S.utils.escape(S.getter(r,["paletteRenderStyle"])?" controls-StylesPanel__colorPalette":""))+" controls-FloatArea"},[S.getter(r,["paletteRenderStyle"])?C.createText(""):[C.createTag("div",{class:"controls-StylesPanel__header"},[C.createTag("div",{class:"controls-StylesPanel__title",title:""+global.rk("Стиль и цвет")},[C.createText(""+global.rk("Стиль и цвет"))],{},d,this),C.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{name:"Apply",command:"saveStylesPanel",activableByClick:!1,icon:"sprite:icon-16 icon-Yes icon-done",className:"controls-StylesPanel__applyButton controls-IconButton__round-border controls-IconButton__round icon-size"},{name:"Apply",sbisname:"Apply"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:N},n,u,m,S.config,y)],{},d,this),C.createControl("wsControl","ws:SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle",{style:S.getter(r,["style"]),fontSizes:S.getter(r,["fontSizes"]),activableByClick:!1},{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:N},n,u,m,S.config,y)],C.createControl("wsControl","ws:SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/ColorStyle",{name:"Pallete",items:S.getter(r,["colors"]),selectedKey:S.getter(r,["style","color"]),className:"controls-StylesPanel__colors",allowEmptySelection:S.getter(r,["allowAutoColor"])},{name:"Pallete",sbisname:"Pallete"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:N},n,u,m,S.config,y),C.createControl("wsControl","ws:SBIS3.CONTROLS/CheckBox",{name:"CheckBox",visible:S.getter(r,["allowAutoColor"]),caption:global.rk("Автоматически (под фон)"),checked:"auto"===S.getter(r,["style","color"]),className:"controls-StylesPanel__checkBox"},{name:"CheckBox",sbisname:"CheckBox"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:N},n,u,m,S.config,y),S.getter(r,["paletteRenderStyle"])||!S.getter(r,["historyId"])&&!S.getter(r,["presets"])?C.createText(""):[C.createTag("div",{class:"controls-StylesPanel-presetFormats_wrapper"},[C.createControl("wsControl","ws:SBIS3.CONTROLS/ListView",{name:"presetView",itemsActions:[],itemsDragNDrop:!1,activableByClick:!1,itemTpl:"tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/presetItemTemplate",className:"controls-ListView__withoutMarker controls-StylesPanel__presetView",itemContentTpl:"tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/presetItemContentTpl"},{name:"presetView",sbisname:"presetView"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:N},n,u,m,S.config,y)],{},d,this)]],l,d,this)],p,d);d.def&&(w=C.chain(w,d,l),d=void 0)}catch(e){S.templateError("resources/SBIS3.CONTROLS/StylesPanelNew/StylesPanelNew.tmpl",e,r)}return w||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/StylesPanelNew/StylesPanelNew"}},r});
//# sourceMappingURL=StylesPanelNew.tmpl.map
define("SBIS3.CONTROLS/Mixins/Checkable",[],function(){return{$protected:{_options:{checked:false}},$constructor:function(){this._publish("onCheckedChange")},setChecked:function(e){var c=!!e;if(this._options.checked!=c)this._options.checked=c,this._container.toggleClass("controls-Checked__checked",this._options.checked),this._notify("onCheckedChange",this._options.checked),this._notifyOnPropertyChanged("checked")},isChecked:function(){return this._options.checked},_changeCheckedByClick:function(){this.setChecked(!this.isChecked())},before:{_clickHandler:function(){this._changeCheckedByClick()}}}});
//# sourceMappingURL=Checkable.js.map
define("js!WSControls/Buttons/ToggleButton",["js!WSControls/Buttons/Button","SBIS3.CONTROLS/Mixins/Checkable"],function(t,s){"use strict";return t.extend([s],{$protected:{_options:{}},_modifyOptions:function(){var s=t.superclass._modifyOptions.apply(this,arguments);return s.cssClassName+=s.checked?" controls-Checked__checked":"",s}})});
//# sourceMappingURL=ToggleButton.js.map
define("tmpl!SBIS3.CONTROLS/ComboBox/resources/textFieldWrapper",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,l,a,i,n){function s(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var u="string"==typeof a?a:"",f=void 0===r?void 0:r,x={id:[],def:void 0},m=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(i);try{var _=v.joinElements([v.createTag("span",{class:"controls-InputRender__field controls-TextBox__field controls-ComboBox__fieldNotEditable js-controls-ComboBox__fieldNotEditable   "+c.wrapUndef(c.utils.escape(c.getter(o,["text"])?"":" controls-ComboBox__fieldNotEditable__placeholder"))},[v.createText(""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(o,["text"])||c.getter(o,["placeholder"])||"&nbsp;"])])))],l,x,this),v.createTag("input",{class:"controls-InputRender__field js-controls-TextBox__field controls-ComboBox__field "+c.wrapUndef(c.utils.escape("uppercase"===c.getter(o,["textTransform"])?"controls-TextBox__field-uppercase":""))+" "+c.wrapUndef(c.utils.escape("lowercase"===c.getter(o,["textTransform"])?"controls-TextBox__field-lowercase":"")),type:""+c.wrapUndef(c.utils.escape(c.getter(o,["type"])||"text")),autocomplete:"off",value:""+c.wrapUndef(c.utils.escape(c.getter(o,["text"]))),maxlength:""+c.wrapUndef(c.utils.escape(c.getter(o,["maxLength"])?c.getter(o,["maxLength"]):"")),required:"true",title:""+c.wrapUndef(c.utils.escape(c.getter(o,["tooltip"])?c.getter(o,["tooltip"]):" "))},[],l,x,this),c.getter(o,["enabled"])&&c.getter(o,["placeholder"])?[v.createControl("resolver",c.getter(o,["compatiblePlaceholderTemplate"]),c.uniteScope(c.utils.escape(c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},a,f,g,c.config,d,x)]:v.createText("")],u,x);x.def&&(_=v.chain(_,x,l),x=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/ComboBox/resources/textFieldWrapper.tmpl",e,o)}return _||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ComboBox/resources/textFieldWrapper"}},o});
//# sourceMappingURL=textFieldWrapper.tmpl.map
define("tmpl!SBIS3.CONTROLS/ComboBox/resources/ItemTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,a,s,l){function n(){}var p=0,m=void 0!==t&&t?t:arguments[arguments.length-1];void 0===m&&(eval("var thelpers = null;"),m=global.requirejs("View/Runner/tclosure"));var c={};l&&l.isSetts&&(c=l.fullContext||{});var u="string"==typeof a?a:"",d=void 0===r?void 0:r,g={id:[],def:void 0},f=m.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),v=this&&this.includedTemplates?this.includedTemplates:{},y=m.getMarkupGenerator(s);try{var C=y.joinElements([y.createTag("div",{class:"controls-ComboBox__item            js-controls-ComboBox__item            controls-ListView__item            js-controls-ListView__item            "+m.wrapUndef(m.utils.escape(m.getter(o,["prepareItemClassesByConfig"]).apply(o,[m.getter(o,["item"]),m.getter(o,["className"])])))+"            "+m.wrapUndef(m.utils.escape(m.getter(o,["className"])))+"            "+m.wrapUndef(m.utils.escape(m.getter(o,["item","get"])&&m.getter(o,["item","get"]).apply(m.getter(o,["item"]),["className"])))+"            "+m.wrapUndef(m.utils.escape(m.getter(o,["item","get"])&&m.getter(o,["item","get"]).apply(m.getter(o,["item"]),["isEmptyValue"])?" controls-ComboBox__item_empty":"")),"data-hash":""+m.wrapUndef(m.utils.escape(m.getter(o,["projItem","getHash"]).apply(m.getter(o,["projItem"]),[]))),"data-id":""+m.wrapUndef(m.utils.escape(m.getter(o,["item","getId"])&&m.getter(o,["item","getId"]).apply(m.getter(o,["item"]),[])))},[y.createControl("resolver",m.getter(o,["itemContent"]),m.uniteScope(m.utils.escape(m.uniteScope(o,{parent:void 0,element:void 0})(m.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},a,d,v,m.config,c,g)],i,g,this)],u,g);g.def&&(C=y.chain(C,g,i),g=void 0)}catch(e){m.templateError("resources/SBIS3.CONTROLS/ComboBox/resources/ItemTemplate.tmpl",e,o)}return C||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ComboBox/resources/ItemTemplate"}},o});
//# sourceMappingURL=ItemTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/ComboBox/resources/ItemContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,n,l,i,a){function s(){}var u=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var p={};a&&a.isSetts&&(p=a.fullContext||{});var d="string"==typeof l?l:"",m=void 0===r?void 0:r,v={id:[],def:void 0},f=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),y=this&&this.includedTemplates?this.includedTemplates:{},C=c.getMarkupGenerator(i);try{var S=C.joinElements([C.createText(""+c.wrapUndef(c.utils.escape(c.getter(o,["getPropertyValue"]).apply(o,[c.getter(o,["item"]),c.getter(o,["displayProperty"])]))))],d,v);v.def&&(S=C.chain(S,v,n),v=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/ComboBox/resources/ItemContentTemplate.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ComboBox/resources/ItemContentTemplate"}},o});
//# sourceMappingURL=ItemContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/ComboBox/resources/ComboBoxPicker",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/ScrollContainer"],function(){var e=Array.prototype.slice.call(arguments),o=e[0],r={};r["js!SBIS3.CONTROLS/ScrollContainer"]=e[1];var t=function e(t,n,i,l,a){function c(){}var s=0,u=void 0!==o&&o?o:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var m={};a&&a.isSetts&&(m=a.fullContext||{});var d="string"==typeof i?i:"",S=void 0===r?void 0:r,C={id:[],def:void 0},v=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,t),p=this&&this.includedTemplates?this.includedTemplates:{},f=u.getMarkupGenerator(l);try{var b=f.joinElements([f.createControl("wsControl","ws:SBIS3.CONTROLS/ScrollContainer",{content:u.createDataArray([(new function(){var e=Object.create(t),o=function e(o,r,t,n,i){if(void 0===t)var t=arguments[2];var l=0,a="content";if(void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure")),i&&i.isSetts)var c=i.fullContext||{};o=u.isolateScope(Object.create(this),o,a);var s="string"==typeof t?t:"",m={id:[],def:void 0},d=this&&this.includedTemplates?this.includedTemplates:{},S=u.getMarkupGenerator(n);try{var C=S.joinElements([S.createTag("div",{class:"controls-ComboBox__list controls-ComboBox__list_column"},[],r,m,this)],s,m);m.def&&(C=S.chain(C,m,r),m=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/ComboBox/resources/ComboBoxPicker.tmpl",e,o)}return C||""};this.func=u.makeFunctionSerializable(o,e)}).func]),name:"ComboBoxScroll",cssClassName:"controls-ComboBox__scrollContainer",shadowStyle:"none",esc:!1},u.plainMerge(n,{name:"ComboBoxScroll",sbisname:"ComboBoxScroll"}),{data:t,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},i,S,p,u.config,m)],d,C);C.def&&(b=f.chain(b,C,n),C=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/ComboBox/resources/ComboBoxPicker.tmpl",e,t)}return b||""};return t.includedFunctions={},t.stable=!0,t.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ComboBox/resources/ComboBoxPicker"}},t});
//# sourceMappingURL=ComboBoxPicker.tmpl.map
define("tmpl!SBIS3.CONTROLS/ComboBox/resources/ComboBoxArrowDown",["Core/tmpl/js/tclosure"],function(){var o=Array.prototype.slice.call(arguments),e=o[0],r={},t=function o(t,n,i,s,l){function a(){}var c=0,u=void 0!==e&&e?e:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var m="string"==typeof i?i:"",p=void 0===r?void 0:r,v={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,t),C=this&&this.includedTemplates?this.includedTemplates:{},b=u.getMarkupGenerator(s);try{var w=b.joinElements([b.createTag("div",{class:"js-controls-ComboBox__arrowDown            controls-ComboBox__Arrow            controls-ComboBox__afterFieldWrapper            icon-ExpandLight            icon-size            "+u.wrapUndef(u.utils.escape(u.getter(t,["enabled"])?"":" ws-invisible"))},[],n,v,this)],m,v);v.def&&(w=b.chain(w,v,n),v=void 0)}catch(o){u.templateError("resources/SBIS3.CONTROLS/ComboBox/resources/ComboBoxArrowDown.tmpl",o,t)}return w||""};return t.includedFunctions={},t.stable=!0,t.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/ComboBox/resources/ComboBoxArrowDown"}},t});
//# sourceMappingURL=ComboBoxArrowDown.tmpl.map
define("SBIS3.CONTROLS/TextBox/resources/TextBoxUtils",["Core/constants"],function(e){return{getTextFromDropEvent:function(e){return e.originalEvent.dataTransfer.getData("text")},getTextFromPasteEvent:function(e){return e.originalEvent.clipboardData?e.originalEvent.clipboardData.getData("text"):window.clipboardData.getData("text")},getCaretPosition:function(e){var t=0;if("undefined"!=typeof window.getSelection){var n=window.getSelection().getRangeAt(0),o=n.cloneRange();o.selectNodeContents(e),o.setEnd(n.endContainer,n.endOffset),t=o.toString().length}else if("undefined"!=typeof document.selection&&"Control"!=document.selection.type){var i=document.selection.createRange(),r=document.body.createTextRange();r.moveToElementText(e),r.setEndPoint("EndToEnd",i),t=r.text.length}return[t,t]},setCaretPosition:function(t,n,o){o=o||n;var r=0,a=0,d=n,c;if(e.browser.isIE&&e.browser.IEVersion<12){var l=document.body.createTextRange();l.moveToElementText(t.parentNode),l.move("character",n),l.select()}else{var s=window.getSelection();try{do{if(3===t.childNodes[a].nodeType)if(c=t.childNodes[a].length,r+=c,r<n)d-=c;i++}while(r<n&&t.childNodes[a]);s.collapse(t.childNodes[i-1],d)}catch(e){}}},setEqualPickerWidth:function(e){var t=e.getTarget()[0].getBoundingClientRect().width,n=e.getContainer()[0],o=n.scrollTop,i;if(e&&t!==n.clientWidth){if(i=parseInt(e.getContainer().css("min-width")),i&&i>t)t=i;n.style.minWidth=t+"px",n.style.maxWidth=t+"px",e.recalcPosition(true,true),n.style.width=t+"px",n.style.minWidth="",n.scrollTop=o}}}});
//# sourceMappingURL=TextBoxUtils.js.map
define("tmpl!SBIS3.CONTROLS/TextBox/resources/textFieldWrapper",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,l,a,n,i){function s(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};i&&i.isSetts&&(u=i.fullContext||{});var d="string"==typeof a?a:"",f=void 0===r?void 0:r,x={id:[],def:void 0},m=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(n);try{var T=v.joinElements([v.createTag("input",{class:"controls-InputRender__field controls-TextBox__field js-controls-TextBox__field"+c.wrapUndef(c.utils.escape("uppercase"===c.getter(o,["textTransform"])?" controls-TextBox__field-uppercase":""))+c.wrapUndef(c.utils.escape("lowercase"===c.getter(o,["textTransform"])?" controls-TextBox__field-lowercase":"")),type:""+c.wrapUndef(c.utils.escape(c.getter(o,["type"])||"text")),autocomplete:"off",value:""+c.wrapUndef(c.utils.escape(c.getter(o,["text"]))),maxlength:""+c.wrapUndef(c.utils.escape(c.getter(o,["maxLength"])?c.getter(o,["maxLength"]):"")),required:"true",title:""+c.wrapUndef(c.utils.escape(c.getter(o,["tooltip"])?c.getter(o,["tooltip"]):" "))},[],l,x,this),c.getter(o,["enabled"])&&c.getter(o,["placeholder"])?[v.createControl("resolver",c.getter(o,["compatiblePlaceholderTemplate"]),c.uniteScope(c.utils.escape(c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},a,f,g,c.config,u,x)]:v.createText("")],d,x);x.def&&(T=v.chain(T,x,l),x=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/TextBox/resources/textFieldWrapper.tmpl",e,o)}return T||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/TextBox/resources/textFieldWrapper"}},o});
//# sourceMappingURL=textFieldWrapper.tmpl.map
define("tmpl!SBIS3.CONTROLS/TextBox/resources/compatiblePlaceholder",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={},o=function e(o,l,n,c,a){function i(){}var s=0,d=void 0!==r&&r?r:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};a&&a.isSetts&&(p=a.fullContext||{});var u="string"==typeof n?n:"",h=void 0===t?void 0:t,v={id:[],def:void 0},f=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},_=d.getMarkupGenerator(c);try{var x=_.joinElements([_.createTag("div",{class:"controls-InputRender__placeholder controls-TextBox__placeholder"+d.wrapUndef(d.utils.escape(d.getter(o,["_isSimplePlaceholder"])?" controls-InputRender__placeholder_simple":""))},[_.createTag("span",{class:"controls-InputRender__placeholder__overflow controls-TextBox__placeholder__overflow"},[_.createControl("resolver",d.getter(o,["placeholder"]),{},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},n,h,m,d.config,p,v)],{},v,this)],l,v,this)],u,v);v.def&&(x=_.chain(x,v,l),v=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/TextBox/resources/compatiblePlaceholder.tmpl",e,o)}return x||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/TextBox/resources/compatiblePlaceholder"}},o});
//# sourceMappingURL=compatiblePlaceholder.tmpl.map
define("tmpl!SBIS3.CONTROLS/TextBox/TextBox",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,n,i,a,p){function l(){}var c=0,s=void 0!==t&&t?t:arguments[arguments.length-1];void 0===s&&(eval("var thelpers = null;"),s=global.requirejs("View/Runner/tclosure"));var d={};p&&p.isSetts&&(d=p.fullContext||{});var u="string"==typeof i?i:"",f=void 0===r?void 0:r,v={id:[],def:void 0},g=s.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},x=s.getMarkupGenerator(a);try{var y=x.joinElements([x.createTag("div",{class:"controls-InputRender controls-TextBox "+s.wrapUndef(s.utils.escape(s.getter(s.getter(o,["_prepareClassesByConfig"]).apply(o,[s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)]),["container"]))),title:""+s.wrapUndef(s.utils.escape(s.getter(o,["tooltip"])))},[x.createTag("div",{class:"controls-InputRender__wrapper controls-TextBox__wrapper "+s.wrapUndef(s.utils.escape(s.getter(s.getter(o,["_prepareClassesByConfig"]).apply(o,[s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)]),["wrapper"]))),title:""+s.wrapUndef(s.utils.escape(s.getter(o,["tooltip"])))},[s.getter(o,["beforeFieldWrapper"])?[x.createControl("resolver",s.getter(o,["beforeFieldWrapper"]),s.uniteScope(s.utils.escape(s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},i,f,m,s.config,d,v)]:x.createText(""),x.createTag("div",{class:"controls-InputRender__fieldWrapper controls-TextBox__fieldWrapper"},[x.createControl("resolver",s.getter(o,["textFieldWrapper"]),s.uniteScope(s.utils.escape(s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)),{}),{class:s.utils.escape(s.getter(s.getter(o,["_prepareClassesByConfig"]).apply(o,[s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)]),["field"]))},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},i,f,m,s.config,d,v)],{},v,this),s.getter(o,["afterFieldWrapper"])?[x.createControl("resolver",s.getter(o,["afterFieldWrapper"]),s.uniteScope(s.utils.escape(s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},i,f,m,s.config,d,v)]:x.createText("")],{},v,this),s.getter(o,["informationIconColor"])?[x.createTag("div",{class:"controls-InputRender__tagStyle controls-TextBox__informationIcon "+s.wrapUndef(s.utils.escape(" controls-InputRender__tagStyle-"+s.getter(o,["informationIconColor"])))+" "+s.wrapUndef(s.utils.escape(" controls-TextBox__informationIcon-"+s.getter(o,["informationIconColor"])))},[],{},v,this)]:x.createText("")],n,v,this)],u,v);v.def&&(y=x.chain(y,v,n),v=void 0)}catch(e){s.templateError("resources/SBIS3.CONTROLS/TextBox/TextBox.tmpl",e,o)}return y||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/TextBox/TextBox"}},o});
//# sourceMappingURL=TextBox.tmpl.map
define("Lib/Mixins/CompoundActiveFixMixin",["Lib/Control/AreaAbstract/AreaAbstract","Lib/Control/Control"],function(t,i){var e=i.Control;return CompoundActiveFixMixin={instead:{setActive:function(){return e.prototype.setActive.apply(this,arguments)},setChildActive:function(){var t=this._isControlActive;if(this._isControlActive=true,this._updateActiveStyles(),t!==this._isControlActive&&this._isControlActive)this._notify("onFocusIn")},_onClickHandler:function(){return e.prototype._onClickHandler.apply(this,arguments)},canAcceptFocus:function(){return e.prototype.canAcceptFocus.apply(this,arguments)},onBringToFront:function(){if((this._childControls||[]).length){var i=this.getActiveChildControl(true);if(i)if(i instanceof t)i.onBringToFront();else i.setActive(true);else this.setActive(true)}else this.setActive(true)}}}});
//# sourceMappingURL=CompoundActiveFixMixin.js.map
define("SBIS3.CONTROLS/TextBox/TextBoxBase",["Core/constants","Core/IoC","Lib/Control/CompoundControl/CompoundControl","SBIS3.CONTROLS/Mixins/FormWidgetMixin","SBIS3.CONTROLS/Mixins/DataBindMixin","Lib/Mixins/CompoundActiveFixMixin","SBIS3.CONTROLS/ControlHierarchyManager"],function(t,e,i,n,s,o,a){"use strict";var l=i.extend([n,s,o],{$protected:{_keysWeHandle:[t.key.del,t.key.backspace,t.key.left,t.key.right,t.key.minus,t.key.space,t.key.m,t.key.o],_textChanged:false,_options:{_isMultiline:false,_prepareClassesByConfig:function(){var t=[],e=[],i=[],n=function(t){if(~t.indexOf("controls-TextBox_"))t+=" "+t.replace(/controls-TextBox_/g,"controls-InputRender_");return t};if(i.push("controls-TextBox_state_"+(this.enabled?"default":"disabled")),!this.enabled&&i.push("controls-TextBox_state_disabled_"+(this._isMultiline?"multiLine":"singleLine")),i.push("controls-TextBox_size_"+(this.size?this.size:"default")),i.push("controls-TextBox_text-align_"+this.textAlign),i.push(this._paddingClass),this.textTransform)t.push("controls-TextBox__field-"+this.textTransform);return e.push("controls-TextBox__wrapper_"+(this._isMultiline?"multiLine":"singleLine")),{container:i.map(n).join(" "),field:t.map(n).join(" "),wrapper:e.map(n).join(" ")}},_paddingClass:" controls-InputRender_paddingBoth controls-TextBox_paddingBoth",text:"",trim:false,maxLength:null,focusOnActivatedOnMobiles:false,textAlign:"left"}},$constructor:function(){this._publish("onTextChange"),this._options.text=this._options.text?this._options.text.toString():"",this.subscribe("onFocusOut",this._focusOutHandler.bind(this))},setText:function(t){var e=this._isEmptyValue(t),i=e?t:this._formatText(t.toString());if(i!==this._options.text){if(!this._textChanged&&!(e&&this._isEmptyValue(this._options.text)))this._textChanged=true;this._options.text=i,this._drawText(i),this.clearMark(),this._notify("onTextChange",i),this._notifyOnPropertyChanged("text")}},_isEmptyValue:function(t){return null===t||""===t||"undefined"===typeof t},getText:function(){return this._options.text},setMaxLength:function(t){this._options.maxLength=t},isChanged:function(){return this._textChanged},_formatText:function(t){return t||""},_onClickHandler:function(t){var e=this._getElementToFocus();if(this.isEnabled()&&e[0]!==document.activeElement&&t.target===this.getContainer()[0])e.focus();l.superclass._onClickHandler.call(this,t)},_getElementToFocus:function(){return this._inputField||l.superclass._getElementToFocus.apply(this,arguments)},_drawText:function(){},_focusOutHandler:function(t,e,i){if(this._textChanged&&!a.checkInclusion(this,i&&i.getContainer()))this.validate()},_keyboardHover:function(t){return t.stopPropagation(),true},getValue:function(){return e.resolve("ILogger").log("getValue()","getValue is deprecated. Use getText()"),this.getText()},setValue:function(t){e.resolve("ILogger").log("setValue()","setValue is deprecated. Use setText()"),this.setText(t)},_setEnabled:function(t){l.superclass._setEnabled.apply(this,arguments),this._toggleState()},clearMark:function(){l.superclass.clearMark.apply(this,arguments),this._toggleState()},markControl:function(){l.superclass.markControl.apply(this,arguments),this._toggleState()},_updateActiveStyles:function(){l.superclass._updateActiveStyles.apply(this,arguments),this._toggleState()},_getStateToggleContainer:function(){return this._container},_toggleState:function(){var t=this._getStateToggleContainer()[0];t.className=t.className.replace(/(^|\s)controls-TextBox_state_\S+/gi,""),t.className=t.className.replace(/(^|\s)controls-InputRender_state_\S+/gi,""),this._getStateToggleContainer().addClass(this._getToggleState())},_getToggleState:function(){var t=this.isActive(),e=this.isEnabled(),i=this.isMarked();return"controls-TextBox_state_"+(i?"error":!e?"disabled"+(this._options._isMultiline?" controls-TextBox_state_disabled_multiLine":" controls-TextBox_state_disabled_singleLine"):t?"active":"default")+" controls-InputRender_state_"+(i?"error":!e?"disabled"+(this._options._isMultiline?" controls-InputRender_state_disabled_multiLine":" controls-InputRender_state_disabled_singleLine"):t?"active":"default")}});return l.runDefaultAction=function(e,i){var n=e.getTarget(),s,o;if(i.which===t.key.enter)if(!(i.altKey||i.shiftKey||i.ctrlKey||i.metaKey)){o=n;while(o){while(o&&!o._defaultAction)o=o.getParent();if(!o)break;if(o._defaultAction)s=o._defaultAction(i);if(s)o=o.getParent();else break}}},l});
//# sourceMappingURL=TextBoxBase.js.map
define("SBIS3.CONTROLS/TextBox",["Core/EventBus","Core/constants","SBIS3.CONTROLS/TextBox/TextBoxBase","tmpl!SBIS3.CONTROLS/TextBox/TextBox","tmpl!SBIS3.CONTROLS/TextBox/resources/textFieldWrapper","tmpl!SBIS3.CONTROLS/TextBox/resources/compatiblePlaceholder","SBIS3.CONTROLS/Utils/TemplateUtil","SBIS3.CONTROLS/TextBox/resources/TextBoxUtils","SBIS3.CONTROLS/Utils/GetTextWidth","Core/helpers/Function/forAliveOnly","SBIS3.CONTROLS/ControlHierarchyManager","SBIS3.CONTROLS/Button/IconButton","css!Controls/Input/resources/InputRender/InputRender","css!SBIS3.CONTROLS/TextBox/TextBox"],function(t,e,o,i,n,s,r,l,a,c,p){"use strict";var h=o.extend({_dotTplFn:i,$protected:{_fromTouch:false,_pasteProcessing:0,_inputField:null,_compatPlaceholder:null,_tooltipText:null,_beforeFieldWrapper:null,_afterFieldWrapper:null,_textFieldWrapper:null,_informationIcon:null,_options:{compatiblePlaceholderTemplate:s,textFieldWrapper:n,beforeFieldWrapper:null,afterFieldWrapper:null,textTransform:"none",selectOnClick:false,placeholder:"",inputRegExp:"",informationIconColor:"",size:""}},$constructor:function(){this._publish("onPaste","onInformationIconMouseEnter","onInformationIconActivated");var t=this;this._inputField=this._getInputField(),this._inputField.on("paste",function(e){if(false!==t._notify("onPaste",l.getTextFromPasteEvent(e)))t._pasteProcessing++,window.setTimeout(function(){if(t._pasteProcessing--,!t._pasteProcessing)t._pasteHandler(e)},100);else e.preventDefault()}).on("drop",function(e){window.setTimeout(function(){t._pasteHandler(e)},100)}).on("change",function(){var e=$(this).val(),o=t._options.inputRegExp;if(e!=t._options.text){if(o)e=t._checkRegExp(e,o);t.setText(e)}}).on("focusin",this._inputFocusInHandler.bind(this)).on("focusout",this._inputFocusOutHandler.bind(this)).on("click",this._inputClickHandler.bind(this)),this._container.on("keypress keydown keyup",this._keyboardDispatcher.bind(this)).on("keyup mouseenter",function(){t._applyTooltip()}).on("touchstart",function(){t._fromTouch=true})},_modifyOptions:function(){var t=h.superclass._modifyOptions.apply(this,arguments);if(t.beforeFieldWrapper=r.prepareTemplate(t.beforeFieldWrapper),t.afterFieldWrapper=r.prepareTemplate(t.afterFieldWrapper),t.placeholder)t._isSimplePlaceholder="string"===typeof t.placeholder&&-1===t.placeholder.indexOf("data-component");return t},_checkRegExp:function(t,e){for(var o="",i=new RegExp(e),n=0;n<t.length;n++)if(i.test(t[n]))o+=t[n];return o},init:function(){var t=this;if(h.superclass.init.apply(this,arguments),this._options.informationIconColor)this._informationIcon=$(".controls-TextBox__informationIcon",this.getContainer());this._container.on("mouseenter",function(e){if($(e.target).hasClass("controls-TextBox__informationIcon"))t._notify("onInformationIconMouseEnter")}),this._container.on("click",function(e){if($(e.target).hasClass("controls-TextBox__informationIcon"))t._notify("onInformationIconActivated")}),this._compatPlaceholder=this._getCompatiblePlaceholder(),this._initPlaceholderEvents(this._compatPlaceholder),this._checkInputVal(true)},setInformationIconColor:function(t){if(!t)return void this._destroyInformationIcon();if(!this._informationIcon)this._createInformationIcon(t);this._informationIcon.removeClass("controls-TextBox__informationIcon-"+this._options.informationIconColor),this._informationIcon.removeClass("controls-InputRender__tagStyle-"+this._options.informationIconColor),this._options.informationIconColor=t,this._informationIcon.addClass("controls-TextBox__informationIcon-"+t),this._informationIcon.addClass("controls-InputRender__tagStyle-"+t)},_createInformationIcon:function(t){this._informationIcon=$('<div class="controls-InputRender__tagStyle controls-TextBox__informationIcon controls-TextBox__informationIcon-'+t+" controls-InputRender__tagStyle-"+t+'"></div>'),this.getContainer().append(this._informationIcon)},_getCompatiblePlaceholder:function(){if(!this._compatPlaceholder)this._compatPlaceholder=this._container.find(".controls-TextBox__placeholder");return this._compatPlaceholder},_destroyInformationIcon:function(){if(this._informationIcon)this._informationIcon.remove(),this._informationIcon=void 0},_keyboardDispatcher:function(t){return c(function(t){var e=true;switch(t.type){case"keydown":e=this._keyDownBind.call(this,t);break;case"keyup":e=this._keyUpBind.call(this,t);break;case"keypress":e=this._keyPressBind.call(this,t)}return e}).call(this,t)},_checkInputVal:function(t){var e=this._getInputValue();if(this._options.trim&&!t)e=e.trim();if(e!==this._options.text&&!(this._isEmptyValue(this._options.text)&&!(e||"").length))this.setText(e)},_applyTooltip:function(){var t=this._getFieldForTooltip();if(this._tooltipText!=this._options.text){var o;if(e.browser.isIE)o=a(this._options.text);else o=t[0].scrollWidth;if(o>t[0].clientWidth)this._container.attr("title",this._options.text),t.attr("title",this._options.text);else if(this._options.tooltip)this.setTooltip(this._options.tooltip);else this._container.attr("title",""),t.attr("title",e.browser.isIE?"":" ");this._tooltipText=this._options.text}},_getFieldForTooltip:function(){return this._inputField},setTooltip:function(t){this._getFieldForTooltip().attr("title",t),h.superclass.setTooltip.apply(this,arguments)},_drawText:function(t){if(this._getInputValue()!=t)this._setInputValue(t||"")},setMaxLength:function(t){h.superclass.setMaxLength.call(this,t),this._inputField.attr("maxlength",t)},setPlaceholder:function(t){this._options.placeholder=t,this._setPlaceholder(t)},_setPlaceholder:function(t){this._destroyCompatPlaceholder(),this._createCompatiblePlaceholder()},setTextTransform:function(t){switch(t){case"uppercase":this._inputField.removeClass("controls-TextBox__field-lowercase").addClass("controls-TextBox__field-uppercase");break;case"lowercase":this._inputField.removeClass("controls-TextBox__field-uppercase").addClass("controls-TextBox__field-lowercase");break;default:this._inputField.removeClass("controls-TextBox__field-uppercase").removeClass("controls-TextBox__field-lowercase")}},_keyDownBind:function(t){if(13==t.which)this._checkInputVal()},_keyUpBind:function(t){var o=this._getInputValue(),i=this._isEmptyValue(this._options.text)&&this._isEmptyValue(o);if(this._options.text!==o&&!i)this._setTextByKeyboard(o);var n=t.which||t.keyCode;if(Array.indexOf([e.key.up,e.key.down],n)>=0)t.stopPropagation()},_setTextByKeyboard:function(t){this.setText(t)},_getInputValue:function(){return this._inputField&&this._inputField.val()},_setInputValue:function(t){this._inputField&&this._inputField.val(t)},_getInputField:function(){return $(".js-controls-TextBox__field",this.getContainer().get(0))},_keyPressBind:function(t){if(this._options.inputRegExp&&!t.ctrlKey)return this._inputRegExp(t,new RegExp(this._options.inputRegExp))},_getElementToFocus:function(){return this._inputField},_setEnabled:function(t){if(h.superclass._setEnabled.call(this,t),t)this._createCompatiblePlaceholder();else this._destroyCompatPlaceholder();this._inputField.prop("readonly",!t)},_inputRegExp:function(t,e){var o=t.which||t.keyCode;if(!t.charCode)return true;if(o<32||t.ctrlKey||t.altKey)return false;if(!e.test(String.fromCharCode(o)))return false;return true},_inputFocusOutHandler:function(e){if(this._fromTouch)t.globalChannel().notify("MobileInputFocusOut"),this._fromTouch=false},_pasteHandler:function(t){var e=this._getInputValue(),o=this._options.inputRegExp;if(o)e=this._checkRegExp(e,o);if(this._options.trim)e=e.trim();e=this._formatText(e),this._drawText(e),this._setTextByKeyboard(e)},_focusOutHandler:function(t,e,o){if(!e&&(!o||!p.checkInclusion(this,o.getContainer()[0])))this._checkInputVal();h.superclass._focusOutHandler.apply(this,arguments)},_inputClickHandler:function(t){},_inputFocusInHandler:function(o){if(this._fromTouch)t.globalChannel().notify("MobileInputFocus");if(this._options.selectOnClick)this._inputField.select();if(!this.isActive())this.setActive(true,false,true),o.stopPropagation();if(!this.isEnabled()&&e.browser.isMobilePlatform)this._inputField.blur()},_destroyCompatPlaceholder:function(){if(this._compatPlaceholder)this._compatPlaceholder.off("*"),this._compatPlaceholder.remove(),this._compatPlaceholder=void 0},_initPlaceholderEvents:function(t){var e=this;t.on("click",function(){e._getInputField().focus(),e._inputClickHandler()})},_createCompatiblePlaceholder:function(){if(!this._compatPlaceholder)this._options._isSimplePlaceholder="string"===typeof this._options.placeholder&&-1===this._options.placeholder.indexOf("data-component"),this._compatPlaceholder=$(this._options.compatiblePlaceholderTemplate(this._options)),this._inputField.after(this._compatPlaceholder),this.reviveComponents(),this._initPlaceholderEvents(this._compatPlaceholder)},_getAfterFieldWrapper:function(){},_getBeforeFieldWrapper:function(){},destroy:function(){this._afterFieldWrapper=void 0,this._beforeFieldWrapper=void 0,this._inputField.off("*"),this._inputField=void 0,this._destroyCompatPlaceholder(),this._destroyInformationIcon(),h.superclass.destroy.apply(this,arguments)}});return h});
//# sourceMappingURL=TextBox.js.map
define("SBIS3.CONTROLS/Mixins/SearchMixin/SearchMixinUtil",[],function(){var n=function(n){return(n||"").replace(/^([<|>][\s])|([\s][<|>][\s])|([\s][<|>])$/g,"")},e=function(n){return null!==n};return{prepareText:n,needSearch:function(r,t,i){var u=n(r).trim().length;return e(t)&&u>=t||i&&u},needReset:function(r,t,i){var t=e(t),u=n(r).trim().length;return t||!t&&!u||i}}});
//# sourceMappingURL=SearchMixinUtil.js.map
define("SBIS3.CONTROLS/Mixins/SearchMixin",["Core/helpers/Function/forAliveOnly","Core/CommandDispatcher","SBIS3.CONTROLS/Mixins/SearchMixin/SearchMixinUtil"],function(e,t,i){return{$protected:{_onResetIsFired:true,_searchText:"",_searchDelay:null,_options:{startCharacter:3,searchDelay:500}},$constructor:function(){this._publish("onSearch","onReset"),t.declareCommand(this,"applySearch",this.applySearch)},before:{_setTextByKeyboard:function(e){if(e!==this._searchText)this._startSearch(e)}},after:{setText:function(e){this._searchText=e},destroy:function(){this._clearSearchDelay()},init:function(){var e=this.getText();if(e&&e.length>=this._options.startCharacter)this._onResetIsFired=false,this._searchText=e}},_startSearch:function(t){this._clearSearchDelay(),this._searchDelay=setTimeout(e(function(){this._applySearch(t)},this),this._options.searchDelay)},_clearSearchDelay:function(){if(this._searchDelay)clearTimeout(this._searchDelay),this._searchDelay=null},_applySearch:function(e,t){var s=[e,this._options.startCharacter,t];if(this._clearSearchDelay(),i.needSearch.apply(null,s))this._notify("onSearch",e,t),this._onResetIsFired=false;else if(i.needReset.apply(null,s))this._notifyOnReset()},_notifyOnReset:function(){if(!this._onResetIsFired)this._notify("onReset"),this._onResetIsFired=true},resetSearch:function(){this.setText(""),this.applySearch(true)},applySearch:function(e){this._applySearch(this.getText(),e)}}});
//# sourceMappingURL=SearchMixin.js.map
define("SBIS3.CONTROLS/ComboBox",["Core/constants","Core/Deferred","Core/IoC","Core/detection","Lib/LayoutManager/LayoutManager","SBIS3.CONTROLS/TextBox","SBIS3.CONTROLS/TextBox/resources/TextBoxUtils","tmpl!SBIS3.CONTROLS/ComboBox/resources/textFieldWrapper","tmpl!SBIS3.CONTROLS/ComboBox/resources/ComboBoxPicker","SBIS3.CONTROLS/Mixins/PickerMixin","SBIS3.CONTROLS/Mixins/ItemsControlMixin","WS.Data/Collection/RecordSet","WS.Data/Display/Display","SBIS3.CONTROLS/Mixins/Selectable","SBIS3.CONTROLS/Mixins/DataBindMixin","SBIS3.CONTROLS/Mixins/SearchMixin","SBIS3.CONTROLS/Utils/TitleUtil","tmpl!SBIS3.CONTROLS/ComboBox/resources/ComboBoxArrowDown","tmpl!SBIS3.CONTROLS/ComboBox/resources/ItemTemplate","tmpl!SBIS3.CONTROLS/ComboBox/resources/ItemContentTemplate","Core/core-instance","SBIS3.CONTROLS/ScrollContainer","i18n!SBIS3.CONTROLS.СomboBox","css!SBIS3.CONTROLS/ComboBox/ComboBox"],function(e,t,i,s,o,l,r,n,a,c,_,d,h,p,u,m,f,y,C,g,x){"use strict";function b(e,t){var i;if(i=t._getRecordsForRedrawSt.apply(this,arguments),t.emptyValue)i.unshift(t._emptyRecordProjection);return i}function I(e){if(!e.displayProperty&&e._items&&!x.instanceOfModule(e._items,"WS.Data/Type/Enum"))i.resolve("ILogger").error("SBIS3.CONTROLS/ComboBox","Не задана опция displayProperty"),e.displayProperty="title"}function S(e,t){return~(e.className||e.get&&e.get("className")||t||"").indexOf("controls-ComboBox__multiline")?"controls-ComboBox__item_multiLine":"controls-ComboBox__item_singleLine"}var B=l.extend([c,_,p,u,m],{_dotTplFnPicker:a,$protected:{_checkClickByTap:true,_delayedSettingTextByKey:false,_isClearing:false,_options:{textFieldWrapper:n,_emptyRecordProjection:void 0,_getRecordsForRedraw:b,_defaultItemTemplate:C,_defaultItemContentTemplate:g,searchDelay:0,startCharacter:1,focusOnActivatedOnMobiles:false,itemTemplate:"",afterFieldWrapper:y,editable:true,emptyValue:false,valueFormat:"",autocomplete:false}},$constructor:function(){var t=this;if(this._keysWeHandle[e.key.up]=100,this._keysWeHandle[e.key.down]=101,this._keysWeHandle[e.key.enter]=102,this._keysWeHandle[e.key.esc]=103,this._options.autocomplete)this.subscribe("onSearch",this._onSearch),this.subscribe("onReset",this._onResetSearch);this._container.click(function(e){var i=$(e.target),s=i.hasClass("js-controls-ComboBox__arrowDown");if(s||i[0]===$(".controls-ComboBox__Arrow",t.getContainer())[0]||false===t.isEditable())if(t.isEnabled()&&t._getItemsProjection())if(t.togglePicker(),s||!t.isEditable())e.preventDefault()})},_modifyOptions:function(){var e=B.superclass._modifyOptions.apply(this,arguments);if(I(e),e.emptyValue){var t={},i,s;t[e.idProperty]=null,t[e.displayProperty]=rk("Не выбрано"),t.isEmptyValue=true,s=new d({rawData:[t],idProperty:e.idProperty}),i=h.getDefaultDisplay(s).at(0),e._emptyRecordProjection=i}if(e.cssClassName+=" controls-ComboBox",!e.editable)e.cssClassName+=" controls-ComboBox__editable-false";if(!e.selectedKey)e.cssClassName+=" controls-ComboBox__emptyValue";if(e.selectedKey&&e._items){var o=x.instanceOfModule(e._items,"WS.Data/Type/Enum")?e._items.get():e._items.getRecordById(e.selectedKey);if(o)e.text=e._propertyValueGetter(o,e.displayProperty)||""}return e},init:function(){if(B.superclass.init.apply(this,arguments),void 0!==this._options.selectedIndex&&null!==this._options.selectedIndex);else if(this._options.text)this._setKeyByText()},_searchFilter:function(e){var t=e.get(this._options.displayProperty).toLowerCase(),i=this.getText().toLowerCase();return t.indexOf(i)>-1},_onSearch:function(){if(this.setSelectedIndex(-1),this._getItemsProjection().setFilter(this._searchFilter.bind(this)),this.redraw(),this._getItemsProjection().getCount()){if(!this.getPicker().isVisible())this.showPicker()}else this.hidePicker();this._setKeyByText()},_onResetSearch:function(){if(this.setSelectedIndex(-1),this._getItemsProjection().setFilter(null),this._setKeyByText(),this._picker)this._picker.recalcPosition(true,true),r.setEqualPickerWidth(this._picker)},_keyboardHover:function(t){var i=this.getSelectedKey(),s,o,l,r;if(t.which!==e.key.up&&t.which!==e.key.down&&t.which!==e.key.enter&&t.which!==e.key.esc)return B.superclass._keyboardHover.apply(this,arguments);if(t.ctrlKey&&t.which===e.key.enter)return true;if(this._picker){if(!this._picker.isVisible()&&t.which===e.key.esc)return true;var n=$(".controls-ListView__item",this._picker.getContainer().get(0));if(s=$(".controls-ComboBox__item_selected",this._picker.getContainer()),t.which===e.key.up)o=i?s.prev(".controls-ListView__item"):n.eq(0);else if(t.which===e.key.down)o=i?s.next(".controls-ListView__item"):n.eq(0);if(o&&o.length)l=o.data("id"),r=o.data("hash"),this.setSelectedKey(l),this._scrollToItem(r),this.setActive(true)}else if(this.getItems()){var a=null,c=0,_,d;if(this.getItems().getCount()){if(i){if(this.getItems().each(function(e){if(e.getId()==i)a=c;c++}),null!==a)if(0==a)_=this.getItems().at(a+1),d=this.getItems().at(0);else if(a==this.getItems().getCount()-1)_=this.getItems().at(this.getItems().getCount()-1),d=this.getItems().at(a-1);else _=this.getItems().at(a+1),d=this.getItems().at(a-1)}else d=this.getItems().at(0),_=this.getItems().at(0);if(t.which===e.key.up)this.setSelectedKey(d.getId());else if(t.which===e.key.down)this.setSelectedKey(_.getId());else if(t.which===e.key.esc)return true}}if(t.which===e.key.enter||t.which===e.key.esc)this.hidePicker();return false},_drawText:function(e){B.superclass._drawText.apply(this,arguments);var t=$(".js-controls-ComboBox__fieldNotEditable",this._container.get(0));if(this._drawNotEditablePlaceholder(e),t.text(e||this._options.placeholder||""),this._options.editable)this._setKeyByText()},_drawNotEditablePlaceholder:function(e){$(".js-controls-ComboBox__fieldNotEditable",this._container.get(0)).toggleClass("controls-ComboBox__fieldNotEditable__placeholder",!e)},_getFieldForTooltip:function(){if(this.isEditable())return B.superclass._getFieldForTooltip.apply(this,arguments);else return $(".js-controls-ComboBox__fieldNotEditable",this._container)},_clearSelection:function(){if(B.superclass.setText.call(this,""),this._drawNotEditablePlaceholder(""),$(".js-controls-ComboBox__fieldNotEditable",this._container.get(0)).text(""),this._picker)$(".controls-ComboBox__item_selected",this._picker.getContainer().get(0)).removeClass("controls-ComboBox__item_selected");this._container.addClass("controls-ComboBox__emptyValue")},_drawSelectedItem:function(e,i){var s,o=e;if(s=new t,this._getItemsProjection()){if(!this._isEmptyIndex(i)){var l=this._getItemsProjection().at(i);s.callback(l.getContents())}else if(this._dataSource)if(void 0!=o&&null!==o)this._dataSource.read(o).addCallback(function(e){s.callback(e)});s.addCallback(this._drawSelectedItemText.bind(this,o))}if(this._isClearing)this._clearSelection(),this._isClearing=false},_drawSelectedItemText:function(e,t){if(t){var i=this._getPropertyValue(t,this._options.displayProperty);if(i!=this._options.text)B.superclass.setText.call(this,i),this._drawNotEditablePlaceholder(i),$(".js-controls-ComboBox__fieldNotEditable",this._container.get(0)).text(i);this._toggleEmptyValue(e)}else this._clearSelection();if(this._picker)$(".controls-ComboBox__item_selected",this._picker.getContainer().get(0)).removeClass("controls-ComboBox__item_selected"),$(".controls-ComboBox__item[data-id='"+e+"']",this._picker.getContainer().get(0)).addClass("controls-ComboBox__item_selected")},_toggleEmptyValue:function(e){if(!x.instanceOfModule(this.getItems(),"WS.Data/Type/Enum"))this._container.toggleClass("controls-ComboBox__emptyValue",null===e);else this._container.removeClass("controls-ComboBox__emptyValue")},_drawSelectedEmptyRecord:function(){if(this.isEditable()||!!this._options.placeholder)B.superclass.setText.call(this,"");else this._drawSelectedItemText(null,this._options._emptyRecordProjection.getContents());this._options.selectedKey=null,this.setSelectedIndex(-1),this.hidePicker()},_addItemAttributes:function(e,t){B.superclass._addItemAttributes.call(this,e,t),e.addClass("controls-ComboBox__item").addClass("js-controls-ComboBox__item")},_setPickerContent:function(){var e=this;this._picker.getContainer().mousedown(function(e){e.stopPropagation()}),this.redraw(),this._picker.subscribe("onClick",function(t,i){var s=$(i.target).closest(".js-controls-ComboBox__item");if(s.length){var o=$(s).attr("data-hash"),l,r;if(l=e._getItemsProjection().getByHash(o),!l&&e._options.emptyValue)return void e._drawSelectedEmptyRecord();if(r=e._getItemsProjection().getIndex(l),e._options.activableByClick)e.setActive(true);if(e.hidePicker(),e.setSelectedIndex(r),e._options.autocomplete)e._getItemsProjection().setFilter(null),e.redraw()}i.stopPropagation()}),this._picker.getContainer().addClass("controls-ComboBox__picker")},_setPickerConfig:function(){return{corner:"bl",verticalAlign:{side:"top",offset:-1},horizontalAlign:{side:"left"},closeByExternalClick:true,_canScroll:true,targetPart:true,activableByClick:false,closeOnTargetMove:true,template:this._dotTplFnPicker}},_getItemsContainer:function(){if(this._picker)return $(".controls-ComboBox__list",this._picker.getContainer()[0]);else return null},setPlaceholder:function(e){B.superclass.setPlaceholder.apply(this,arguments),$(".controls-ComboBox__fieldNotEditable__placeholder",this._container.get(0)).text(e)},_getItemTemplate:function(e){var t=e.getContents(),i=t.get(this._options.displayProperty);if(this._options.itemTemplate)return doT.template(this._options.itemTemplate)({item:t,displayProperty:i,displayField:i});else return"<div>"+i+"</div>"},_prepareItemData:function(){var e=B.superclass._prepareItemData.apply(this,arguments);return e.prepareItemClassesByConfig=S,e},_keyDownBind:function(e){},_keyUpBind:function(t){var i=e.key;if(B.superclass._keyUpBind.apply(this,arguments),t.which!=i.enter&&t.which!=i.esc)t.stopPropagation()},_setKeyByText:function(){var e=this,t={};if(this.getItems())this._findItemByKey(this.getItems()),this._toggleEmptyValue(this.getSelectedKey());else if(this._dataSource)t[this._options.displayProperty]=e._options.text,e._callQuery(t).addCallback(function(t){e._findItemByKey(t)});else this._delayedSettingTextByKey=true},_findItemByKey:function(e){var t=false,i=false,s,o=this._options.selectedKey,l=this._options.selectedIndex,r=this.getText(),n=this;if(e.each(function(e){if(t=true,n._getPropertyValue(e,n._options.displayProperty)==n._options.text)if(i=true,x.instanceOfModule(e,"WS.Data/Entity/Model")){if(s=e.getId(),n._options.selectedKey=null!==s&&void 0!==s&&s==s?s:null,n._getItemsProjection())n._options.selectedIndex=n._getItemIndexByKey(n._options.selectedKey);if(o!==n._options.selectedKey)n._notifySelectedItem(n._options.selectedKey,n._options.selectedIndex),n._drawSelectedItem(n._options.selectedKey,n._options.selectedIndex)}else if(n._options.selectedIndex=n._getItemsProjection().getIndexBySourceItem(e),l!==n._options.selectedKey)n._notifySelectedItem(null,n._options.selectedIndex),n._drawSelectedItem(null,n._options.selectedIndex)}),(!i||!t)&&null!==o)B.superclass.setSelectedKey.call(n,null),n._drawText(r)},_dataLoadedCallback:function(){if(this._delayedSettingTextByKey)this._setKeyByText()},_clearItems:function(e){if(this._picker)B.superclass._clearItems.call(this,e)},redraw:function(){if(I(this._options),this._picker)B.superclass.redraw.call(this),this._picker.getContainer().css("height",""),this._picker.recalcPosition(true,true),r.setEqualPickerWidth(this._picker),this._onResizeHandler();else this._drawSelectedItem(this._options.selectedKey,this._options.selectedIndex)},setEditable:function(e){this._options.editable=e,this._container.toggleClass("controls-ComboBox__editable-false",false===e)},isEditable:function(){return this._options.editable},_getElementToFocus:function(){return this.isEditable()?B.superclass._getElementToFocus.apply(this,arguments):this.getContainer()},_setEnabled:function(e){if(l.superclass._setEnabled.call(this,e),false===e)this._inputField.attr("readonly","readonly");else this._inputField.attr("readonly",!this._options.editable);$(".controls-ComboBox__Arrow",this.getContainer()).toggleClass("ws-invisible",!e)},showPicker:function(){var e=this._getItemsProjection(),t=e.at(this.getSelectedIndex()),i=t&&t.getHash();if(!this._picker||this._picker.isDestroyed())this._initializePicker();if(B.superclass.showPicker.call(this),r.setEqualPickerWidth(this._picker),!i&&e.getCount()>0)i=e.at(0).getHash();$(".controls-ComboBox__item",this._picker.getContainer()).bind("mouseenter",function e(t){if(!s.isMobilePlatform){var i=t.target.closest(".controls-ComboBox__item");if(1===i.innerText.split("\n").length)f.setTitle(i)}}),this._scrollToItem(i)},hidePicker:function(){if(this._picker)$(".controls-ComboBox__item",this._picker.getContainer()).unbind();B.superclass.hidePicker.apply(this,arguments)},_initializePicker:function(){var e=this;B.superclass._initializePicker.call(e),this._scrollContainer=this.getChildControlByName("ComboBoxScroll"),e._picker.subscribe("onKeyPressed",function(t,i){e._keyboardHover(i)}),r.setEqualPickerWidth(this._picker)},_onAlignmentChangeHandler:function(e){B.superclass._onAlignmentChangeHandler.apply(this,arguments);var t=$(".controls-ComboBox__list",this._picker.getContainer());if(t[0].className=t[0].className.replace(/(^|\s)controls-ComboBox__list_column(\S*)/gi,""),"bottom"===e.verticalAlign.side)this._picker.getContainer().addClass("controls-ComboBox__picker_column_reverse"),t.addClass("controls-ComboBox__list_column_reverse");else this._picker.getContainer().removeClass("controls-ComboBox__picker_column_reverse"),t.addClass("controls-ComboBox__list_column")},reviveComponents:function(){var e=new t;return e.callback(),e},_getKeyByIndex:function(e){if(this._options.emptyValue&&-1===e)return null;return B.superclass._getKeyByIndex.apply(this,arguments)},setSelectedKey:function(e){if(this._options.emptyValue&&null===e)return void this._drawSelectedEmptyRecord();if(null==e&&!(this.getItems()&&this.getItems().getRecordById(e)))this._isClearing=true;else this._isClearing=false;B.superclass.setSelectedKey.apply(this,arguments)},setActive:function(e){B.superclass.setActive.apply(this,arguments),$(".controls-ComboBox__Arrow",this.getContainer()).toggleClass("controls-ComboBox__Arrow_active",e)},_scrollToItem:function(e){var t=$('.controls-ListView__item[data-hash="'+e+'"]',this._getItemsContainer());if(t.length)o.scrollToElement(t,true),this._scrollContainer._initScrollbar(),this._scrollContainer._scrollbar.setPosition(t.position().top)}});return B});
//# sourceMappingURL=ComboBox.js.map
define("tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/ComboBox","js!WSControls/Buttons/ToggleButton"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={};o["js!SBIS3.CONTROLS/ComboBox"]=e[1],o["js!WSControls/Buttons/ToggleButton"]=e[2];var n=function e(n,r,l,s,i){function a(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};i&&i.isSetts&&(d=i.fullContext||{});var y="string"==typeof l?l:"",S=void 0===o?void 0:o,p={id:[],def:void 0},m=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),g=this&&this.includedTemplates?this.includedTemplates:{},C=u.getMarkupGenerator(s);try{var B=C.joinElements([C.createTag("div",{class:"controls-StylesPanel__buttons"},[C.createControl("wsControl","ws:SBIS3.CONTROLS/ComboBox",{name:"FontSize",idProperty:"key",editable:!1,displayProperty:"value",activableByClick:!1,className:"controls-ComboBox__ellipsis",items:u.getter(n,["fontSizes","map"]).apply(u.getter(n,["fontSizes"]),[u.getter(n,["_fontSizesConvert"])]),selectedKey:u.getter(n,["style","font-size","substr"]).apply(u.getter(n,["style","font-size"]),[0,u.getter(n,["style","font-size","length"])-2])},{name:"FontSize",sbisname:"FontSize"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},l,S,g,u.config,d),C.createControl("wsControl","ws:WSControls/Buttons/ToggleButton",{name:"Bold",activableByClick:!1,checked:!!u.getter(n,["style","font-weight"]),icon:"sprite:icon-16 icon-Bold icon-primary",cssClassName:"controls-ToggleButton__square"},{name:"Bold",sbisname:"Bold"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},l,S,g,u.config,d),C.createControl("wsControl","ws:WSControls/Buttons/ToggleButton",{name:"Italic",activableByClick:!1,checked:!!u.getter(n,["style","font-style"]),cssClassName:"controls-ToggleButton__square",icon:"sprite:icon-16 icon-Italic icon-primary"},{name:"Italic",sbisname:"Italic"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},l,S,g,u.config,d),C.createControl("wsControl","ws:WSControls/Buttons/ToggleButton",{name:"Underline",activableByClick:!1,cssClassName:"controls-ToggleButton__square",icon:"sprite:icon-16 icon-Underline icon-primary",checked:u.getter(n,["style","text-decoration"])&&-1!==u.getter(n,["style","text-decoration","indexOf"]).apply(u.getter(n,["style","text-decoration"]),["underline"])},{name:"Underline",sbisname:"Underline"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},l,S,g,u.config,d),C.createControl("wsControl","ws:WSControls/Buttons/ToggleButton",{name:"Strikethrough",activableByClick:!1,cssClassName:"controls-ToggleButton__square",icon:"sprite:icon-16 icon-Stroked icon-primary",checked:u.getter(n,["style","text-decoration"])&&-1!==u.getter(n,["style","text-decoration","indexOf"]).apply(u.getter(n,["style","text-decoration"]),["line-through"])},{name:"Strikethrough",sbisname:"Strikethrough"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},l,S,g,u.config,d)],r,p,this)],y,p);p.def&&(B=C.chain(B,p,r),p=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle.tmpl",e,n)}return B||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle"}},n}),define("SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle",["Lib/Control/CompoundControl/CompoundControl","tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle","SBIS3.CONTROLS/Button/IconButton","js!WSControls/Buttons/ToggleButton","SBIS3.CONTROLS/ComboBox","css!SBIS3.CONTROLS/Button/ToggleButton/resources/ToggleButton__square"],function(e,t){"use strict";function o(e){var t={};return t.key=e,t.value=e+"px",t}var n=e.extend({_dotTplFn:t,$protected:{_options:{style:void 0,fontSizes:[8,9,10,11,12,14,16,18,20,22,24,26,28,36,48,72]}},init:function(){n.superclass.init.call(this)},_modifyOptions:function(e){return n.superclass._modifyOptions.call(this,e),e._fontSizesConvert=o,e}});return n});
//# sourceMappingURL=FontStyle.tmpl.map
define("SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle",["Lib/Control/CompoundControl/CompoundControl","tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle","SBIS3.CONTROLS/Button/IconButton","js!WSControls/Buttons/ToggleButton","SBIS3.CONTROLS/ComboBox","css!SBIS3.CONTROLS/Button/ToggleButton/resources/ToggleButton__square"],function(t,o){"use strict";function n(t){var o={};return o.key=t,o.value=t+"px",o}var e=t.extend({_dotTplFn:o,$protected:{_options:{style:void 0,fontSizes:[8,9,10,11,12,14,16,18,20,22,24,26,28,36,48,72]}},init:function(){e.superclass.init.call(this)},_modifyOptions:function(t){return e.superclass._modifyOptions.call(this,t),t._fontSizesConvert=n,t}});return e});
//# sourceMappingURL=FontStyle.js.map
define("tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ItemTemplate",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew"]=e[1];var o=function e(o,l,s,a,n){function i(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var p="string"==typeof s?s:"",m=void 0===r?void 0:r,S={id:[],def:void 0},y=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),C=this&&this.includedTemplates?this.includedTemplates:{},g=u.getMarkupGenerator(a);try{var N=g.joinElements([g.createControl("wsControl","ws:SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew",{activableByClick:!1,color:u.getter(o,["item","get"]).apply(u.getter(o,["item"]),["color"]),command:"stylesPanelColorPicked",className:"controls-ListView__item",commandArgs:[u.getter(o,["item","get"]).apply(u.getter(o,["item"]),["color"])]},u.plainMerge(l,u.plainMerge({"data-hash":u.getter(o,["projItem","getHash"]).apply(u.getter(o,["projItem"]),[]),"data-id":u.getter(o,["getPropertyValue"]).apply(o,[u.getter(o,["item"]),u.getter(o,["idProperty"])])},{})),{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:y},s,m,C,u.config,d)],p,S);S.def&&(N=g.chain(N,S,l),S=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ItemTemplate.tmpl",e,o)}return N||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ItemTemplate"}},o});
//# sourceMappingURL=ItemTemplate.tmpl.map
define("SBIS3.CONTROLS/Radio/Button/RadioButtonBase",["js!WSControls/Buttons/ButtonBase","SBIS3.CONTROLS/Mixins/Checkable"],function(t,e){"use strict";return t.extend([e],{$protected:{_options:{escapeCaptionHtml:false}},$constructor:function(){},_clickHandler:function(){if(!this._checked)this.setChecked(true)}})});
//# sourceMappingURL=RadioButtonBase.js.map
define("tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),o=e[0],t={},r=function e(r,l,n,s,a){function u(){}var i=0,c=void 0!==o&&o?o:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var S="string"==typeof n?n:"",C=void 0===t?void 0:t,p={id:[],def:void 0},R=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),B=this&&this.includedTemplates?this.includedTemplates:{},N=c.getMarkupGenerator(s);try{var y=N.joinElements([N.createTag("span",{class:"controls-RadioButton"+c.wrapUndef(c.utils.escape(c.getter(r,["checked"])?" controls-Checked__checked":""))+" controls-ColorRadioButton "},[N.createTag("span",{class:"controls-ColorRadioButton__color",style:"background-color: "+c.wrapUndef(c.utils.escape(c.getter(r,["color"])))+";"},[],{},p,this)],l,p,this)],S,p);p.def&&(y=N.chain(y,p,l),p=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew.tmpl",e,r)}return y||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew"}},r}),define("SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew",["SBIS3.CONTROLS/Radio/Button/RadioButtonBase","tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew"],function(e,o){"use strict";return e.extend({_dotTplFn:o})});
//# sourceMappingURL=ColorRadioButtonNew.tmpl.map
define("SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew",["SBIS3.CONTROLS/Radio/Button/RadioButtonBase","tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew"],function(o,e){"use strict";return o.extend({_dotTplFn:e})});
//# sourceMappingURL=ColorRadioButtonNew.js.map
define("tmpl!SBIS3.CONTROLS/Radio/Group/resources/ItemTemplate",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Radio/Button"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Radio/Button"]=e[1];var o=function e(o,i,a,n,l){function d(){}var p=0,s=void 0!==t&&t?t:arguments[arguments.length-1];void 0===s&&(eval("var thelpers = null;"),s=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var c="string"==typeof a?a:"",m=void 0===r?void 0:r,g={id:[],def:void 0},S=s.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),v=this&&this.includedTemplates?this.includedTemplates:{},y=s.getMarkupGenerator(n);try{var f=y.joinElements([y.createControl("wsControl","ws:SBIS3.CONTROLS/Radio/Button",{className:"controls-ListView__item",caption:s.getter(o,["getPropertyValue"]).apply(o,[s.getter(o,["item"]),s.getter(o,["displayProperty"])]),checked:!(!s.getter(o,["item","getId"])||s.getter(o,["item","getId"]).apply(s.getter(o,["item"]),[])!==s.getter(o,["selectedKey"]))||""},s.plainMerge(i,s.plainMerge({"data-hash":s.getter(o,["projItem","getHash"]).apply(s.getter(o,["projItem"]),[]),"data-id":s.getter(o,["item","getId"])&&s.getter(o,["item","getId"]).apply(s.getter(o,["item"]),[])},{})),{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},a,m,v,s.config,u)],c,g);g.def&&(f=y.chain(f,g,i),g=void 0)}catch(e){s.templateError("resources/SBIS3.CONTROLS/Radio/Group/resources/ItemTemplate.tmpl",e,o)}return f||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Radio/Group/resources/ItemTemplate"}},o});
//# sourceMappingURL=ItemTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/Radio/Group/RadioGroup",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={},o=function e(o,i,a,n,l){function d(){}var u=0,c=void 0!==r&&r?r:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var s={};l&&l.isSetts&&(s=l.fullContext||{});var p="string"==typeof a?a:"",v=void 0===t?void 0:t,m={id:[],def:void 0},f=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),R=this&&this.includedTemplates?this.includedTemplates:{},g=c.getMarkupGenerator(n);try{var S=g.joinElements([g.createTag("div",{class:"controls-RadioGroup"},[c.getter(o,["_serverRender"])?[g.createControl("resolver",c.getter(o,["_itemsTemplate"]),{records:c.getter(o,["_records"]),tplData:c.getter(o,["_itemData"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},a,v,R,c.config,s,m)]:g.createText("")],i,m,this)],p,m);m.def&&(S=g.chain(S,m,i),m=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Radio/Group/RadioGroup.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Radio/Group/RadioGroup"}},o});
//# sourceMappingURL=RadioGroup.tmpl.map
define("tmpl!SBIS3.CONTROLS/Button/ButtonGroup/resources/ItemTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,n,i,a,l){function u(){}var p=0,s=void 0!==t&&t?t:arguments[arguments.length-1];void 0===s&&(eval("var thelpers = null;"),s=global.requirejs("View/Runner/tclosure"));var c={};l&&l.isSetts&&(c=l.fullContext||{});var m="string"==typeof i?i:"",d=void 0===r?void 0:r,g={id:[],def:void 0},v=s.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},y=s.getMarkupGenerator(a);try{var h=y.joinElements([y.createControl("resolver",s.getter(o,["item","get"]).apply(s.getter(o,["item"]),["componentType"]),s.uniteScope(s.utils.escape(s.getter(o,["item","getRawData"]).apply(s.getter(o,["item"]),[])),{}),s.plainMerge({"data-hash":s.getter(o,["projItem","getHash"]).apply(s.getter(o,["projItem"]),[]),"data-id":s.getter(o,["item","getId"]).apply(s.getter(o,["item"]),[])},{class:"controls-ListView__item"}),{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},i,d,f,s.config,c,g)],m,g);g.def&&(h=y.chain(h,g,n),g=void 0)}catch(e){s.templateError("resources/SBIS3.CONTROLS/Button/ButtonGroup/resources/ItemTemplate.tmpl",e,o)}return h||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Button/ButtonGroup/resources/ItemTemplate"}},o});
//# sourceMappingURL=ItemTemplate.tmpl.map
define("SBIS3.CONTROLS/Button/ButtonGroup/ButtonGroupBase",["Lib/Control/CompoundControl/CompoundControl","SBIS3.CONTROLS/Mixins/ItemsControlMixin","tmpl!SBIS3.CONTROLS/Button/ButtonGroup/resources/ItemTemplate"],function(t,e,n){"use strict";return t.extend([e],{$protected:{_options:{_defaultItemTemplate:n},_hasItems:null,_activatedHandler:null},$constructor:function(){this._hasItems=this._container.hasClass("hasItems")},_drawItemsCallbackSync:function(){var t=this.getItemsInstances(),e=this;if(!this._activatedHandler)this._activatedHandler=function(t,n){var i=this.getContainer().data("hash");e._itemActivatedHandler(i,n)};for(var n in t)if(t.hasOwnProperty(n))t[n].unsubscribe("onActivated",this._activatedHandler),t[n].subscribe("onActivated",this._activatedHandler)},_itemActivatedHandler:function(t,e){},_setVisibility:function(t){this._container.toggleClass("ws-hidden",!t),this._isVisible=t}})});
//# sourceMappingURL=ButtonGroupBase.js.map
define("SBIS3.CONTROLS/Radio/Group/RadioGroupBase",["SBIS3.CONTROLS/Button/ButtonGroup/ButtonGroupBase","SBIS3.CONTROLS/Mixins/Selectable"],function(e,t){"use strict";var s=function(e){var t=e._buildTplArgsSt.call(this,e);return t.selectedKey=e.selectedKey,t};return e.extend([t],{$protected:{_options:{allowEmptySelection:false,_buildTplArgs:s}},_itemActivatedHandler:function(e){var t,s;t=this._getItemsProjection().getByHash(e),s=this._getItemsProjection().getIndex(t),this.setSelectedIndex(s)},_drawSelectedItem:function(e,t){var s=this._getItemsProjection().at(t),i=this.getItemsInstances();if(s){var n=s.getHash();for(var o in i)if(i.hasOwnProperty(o))if(void 0===n)i[o].setChecked(false);else if(i[o].getContainer().data("hash")==n)i[o].setChecked(true);else i[o].setChecked(false)}else if(this._options.allowEmptySelection)for(var o in i)if(i.hasOwnProperty(o))i[o].setChecked(false)}})});
//# sourceMappingURL=RadioGroupBase.js.map
define("tmpl!SBIS3.CONTROLS/Radio/Button/RadioButton",["Core/tmpl/js/tclosure"],function(){var t=Array.prototype.slice.call(arguments),e=t[0],o={},r=function t(r,n,a,i,c){function l(){}var s=0,d=void 0!==e&&e?e:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};c&&c.isSetts&&(u=c.fullContext||{});var p="string"==typeof a?a:"",v=void 0===o?void 0:o,f={id:[],def:void 0},h=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),R=this&&this.includedTemplates?this.includedTemplates:{},m=d.getMarkupGenerator(i);try{var g=m.joinElements([m.createTag("span",{class:"controls-RadioButton"+d.wrapUndef(d.utils.escape(!0===d.getter(r,["checked"])?" controls-Checked__checked":""))},[m.createTag("i",{class:"controls-RadioButton__icon"},[m.createText(""+global.rk("&nbsp;"))],{},f,this),m.createTag("span",{class:"js-controls-RadioButton__caption controls-RadioButton__caption"},[m.createControl("resolver",d.getter(r,["sanitize"]),{caption:d.getter(r,["caption"])},{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},a,v,R,d.config,u,f)],{},f,this)],n,f,this)],p,f);f.def&&(g=m.chain(g,f,n),f=void 0)}catch(t){d.templateError("resources/SBIS3.CONTROLS/Radio/Button/RadioButton.tmpl",t,r)}return g||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Radio/Button/RadioButton"}},r});
//# sourceMappingURL=RadioButton.tmpl.map
define("SBIS3.CONTROLS/Radio/Button",["SBIS3.CONTROLS/Radio/Button/RadioButtonBase","tmpl!SBIS3.CONTROLS/Radio/Button/RadioButton","Core/Sanitize","css!SBIS3.CONTROLS/Radio/Button/RadioButton"],function(t,o,n){"use strict";var i=t.extend({_dotTplFn:o,$protected:{_radioButtonCaption:"",_options:{}},$constructor:function(){this._radioButtonCaption=$(".js-controls-RadioButton__caption",this._container)},setCaption:function(t){i.superclass.setCaption.call(this,t),this._radioButtonCaption.html(t||"")},_modifyOptions:function(t){return i.superclass._modifyOptions.call(this,t),t.sanitize=function(t){return n(t.caption,{validNodes:{component:true},validAttributes:{config:true}})},t}});return i});
//# sourceMappingURL=Button.js.map
define("SBIS3.CONTROLS/Mixins/ITextValue",[],function(){"use strict";return{getTextValue:function(){throw new Error("Method must be implemented")}}});
//# sourceMappingURL=ITextValue.js.map
define("SBIS3.CONTROLS/Radio/Group",["SBIS3.CONTROLS/Radio/Group/RadioGroupBase","tmpl!SBIS3.CONTROLS/Radio/Group/RadioGroup","tmpl!SBIS3.CONTROLS/Radio/Group/resources/ItemTemplate","SBIS3.CONTROLS/Mixins/ITextValue","SBIS3.CONTROLS/Radio/Button","css!SBIS3.CONTROLS/Radio/Group/RadioGroup"],function(e,t,o,i){"use strict";return e.extend([i],{_dotTplFn:t,$protected:{_options:{_canServerRender:true,_defaultItemTemplate:o}},getTextValue:function(){var e="",t;if(this._getItemsProjection())if(t=this._getItemsProjection().at(this._options.selectedIndex),t)e=this._getPropertyValue(t.getContents(),this._options.displayProperty);return e}})});
//# sourceMappingURL=Group.js.map
define("SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/ColorStyle",["SBIS3.CONTROLS/Radio/Group","tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ItemTemplate","SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/resources/ColorRadioButton/ColorRadioButtonNew"],function(e,o){"use strict";return e.extend({$protected:{_options:{items:[{color:"#000000"},{color:"#EF463A"},{color:"#72BE44"},{color:"#0055BB"},{color:"#A426D9"},{color:"#999999"}],allowEmptySelection:false,_defaultItemTemplate:o}}})});
//# sourceMappingURL=ColorStyle.js.map
define("tmpl!SBIS3.CONTROLS/CheckBox/resources/ContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={},r=function e(r,n,i,c,a){function s(){}var l=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var u={};a&&a.isSetts&&(u=a.fullContext||{});var d="string"==typeof i?i:"",v=void 0===o?void 0:o,h={id:[],def:void 0},f=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),m=this&&this.includedTemplates?this.includedTemplates:{},C=p.getMarkupGenerator(c);try{var S=C.joinElements([C.createTag("div",{class:"js-controls-CheckBox__caption controls-CheckBox__caption controls-CheckBox__caption_size"+p.wrapUndef(p.utils.escape(p.getter(r,["caption"])?"":" controls-CheckBox__caption_empty"))},[C.createText(""+p.wrapUndef(p.Sanitize.apply(void 0,[p.getDecorators().sanitize.apply(void 0,[p.getter(r,["caption"])])||"&nbsp;"])))],n,h,this)],d,h);h.def&&(S=C.chain(S,h,n),h=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/CheckBox/resources/ContentTemplate.tmpl",e,r)}return S||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/CheckBox/resources/ContentTemplate"}},r});
//# sourceMappingURL=ContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/CheckBox/CheckBox",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={},r=function e(r,c,n,i,l){function s(){}var a=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var p="string"==typeof n?n:"",h=void 0===o?void 0:o,v={id:[],def:void 0},C=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),f=this&&this.includedTemplates?this.includedTemplates:{},B=d.getMarkupGenerator(i);try{var k=B.joinElements([B.createTag("div",{class:"controls-CheckBox"+d.wrapUndef(d.utils.escape(d.getter(r,["checked"])?" controls-Checked__checked":""))+d.wrapUndef(d.utils.escape(null===d.getter(r,["checked"])&&d.getter(r,["threeState"])?" controls-ToggleButton__null":"")),title:""+d.wrapUndef(d.utils.escape(d.getter(r,["tooltip"])))},[B.createTag("div",{class:"controls-CheckBox__icon controls-CheckBox__icon_size controls-CheckBox__iconBox controls-CheckBox__iconBox_size controls-CheckBox__iconBox_color"},[],{},v,this),B.createControl("resolver",d.getter(r,["contentTemplate"]),d.uniteScope(d.utils.escape(d.uniteScope(r,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:C},n,h,f,d.config,u,v)],c,v,this)],p,v);v.def&&(k=B.chain(k,v,c),v=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/CheckBox/CheckBox.tmpl",e,r)}return k||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/CheckBox/CheckBox"}},r});
//# sourceMappingURL=CheckBox.tmpl.map
define("SBIS3.CONTROLS/CheckBox",["Core/constants","js!WSControls/Buttons/ButtonBase","SBIS3.CONTROLS/Mixins/Checkable","tmpl!SBIS3.CONTROLS/CheckBox/CheckBox","tmpl!SBIS3.CONTROLS/CheckBox/resources/ContentTemplate","SBIS3.CONTROLS/Mixins/ITextValue","css!SBIS3.CONTROLS/CheckBox/CheckBox"],function(t,e,s,o,i,n){"use strict";var c=function(t,e){return t},h=e.extend([s,n],{_dotTplFn:o,$protected:{_checkBoxCaption:null,_keysWeHandle:[t.key.space],_options:{threeState:false,textValue:"",contentTemplate:null,escapeCaptionHtml:false}},_modifyOptions:function(){var t=h.superclass._modifyOptions.apply(this,arguments);return t.contentTemplate=t.contentTemplate||i,t},$constructor:function(){if(this._checkBoxCaption=$(".js-controls-CheckBox__caption",this._container),this._options.checked=c(this._options.checked,this._options.threeState),this._options.checked)this._options.textValue=this._options.caption},setCaption:function(t){if(h.superclass.setCaption.call(this,t),t){if(this._checkBoxCaption.html(t).removeClass("controls-CheckBox__caption_empty"),this._options.checked)this._options.textValue=this._options.caption}else this._checkBoxCaption.html("&nbsp;").addClass("controls-CheckBox__caption_empty"),this._options.textValue=""},getTextValue:function(){return this._options.textValue},_keyboardHover:function(e){if(e.which===t.key.space)this.setChecked(!this.isChecked());return false},setChecked:function(t){if(this._options.checked=c(t,this._options.threeState),this._options.checked)this._options.textValue=this._options.caption;else this._options.textValue="";this._container.toggleClass("controls-Checked__checked",!!this._options.checked),this._container.toggleClass("controls-ToggleButton__null",!!(this._options.threeState&&null==this._options.checked)),this.validate(),this._notify("onCheckedChange",this._options.checked),this._notifyOnPropertyChanged("checked")},_changeCheckedByClick:function(){if(!this._options.threeState)this.setChecked(!this.isChecked());else if(false===this._options.checked)this.setChecked(true);else if(true===this._options.checked)this.setChecked(null);else this.setChecked(false)}});return h});
//# sourceMappingURL=CheckBox.js.map
define("SBIS3.CONTROLS/StylesPanelNew",["Core/CommandDispatcher","Lib/Control/CompoundControl/CompoundControl","SBIS3.CONTROLS/Mixins/PopupMixin","SBIS3.CONTROLS/History/HistoryController","Core/helpers/Object/find","Core/helpers/generate-helpers","tmpl!SBIS3.CONTROLS/StylesPanelNew/StylesPanelNew","Core/EventBus","tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/presetItemTemplate","tmpl!SBIS3.CONTROLS/StylesPanelNew/resources/presetItemContentTpl","SBIS3.CONTROLS/ListView","SBIS3.CONTROLS/StylesPanelNew/resources/FontStyle/FontStyle","SBIS3.CONTROLS/StylesPanelNew/resources/ColorStyle/ColorStyle","SBIS3.CONTROLS/Button/IconButton","SBIS3.CONTROLS/CheckBox","css!SBIS3.CONTROLS/StylesPanelNew/StylesPanelNew","css!SBIS3.CONTROLS/Menu/MenuItem/MenuItem"],function(e,t,i,s,n,o,l,r){"use strict";var h=t.extend([i],{_dotTplFn:l,$protected:{_options:{closeButton:true,closeByExternalClick:true,colors:null,paletteRenderStyle:false,instantFireMode:false,fontSizes:[8,9,10,11,12,14,16,18,20,22,24,26,28,36,48,72],style:{"font-size":"14px",color:"#000000"},columnsCount:null,historyId:null,presets:null,allowAutoColor:false},_backup:null,_currentStyle:null,_historyController:null,_history:null,_presetItems:null,_presetView:null,_palleteWidth:void 0,_palette:null,_size:null,_bold:null,_italic:null,_underline:null,_strikethrough:null,_pickerOpenHandler:void 0,_currentPresetId:null},$constructor:function(){var t=this.getContainer(),i=this._options.columnsCount,s,n;if(this._publish("changeFormat"),e.declareCommand(this,"saveStylesPanel",this.saveHandler),e.declareCommand(this,"stylesPanelColorPicked",this._paletteClickHandler),this._options.paletteRenderStyle){if(s=this._options.colors.length,i)this._palleteWidth=i<=6?32*i:192;else if(s<=6)this._palleteWidth=32;else while(!this._palleteWidth){n=2;while(n<=6&&!this._palleteWidth){if(s%n===0&&s/n<=6)this._palleteWidth=32*n;n++}if(!this._palleteWidth)s++}$(".controls-PopupMixin__closeButton",t).addClass("ws-hidden")}},init:function(){var e=this;if(h.superclass.init.call(this),e._palette=e.getChildControlByName("Pallete"),e._checkBox=e.getChildControlByName("CheckBox"),e._checkBox.subscribe("onCheckedChange",function(t,i){if(i){if(e._palette.setSelectedKey("auto"),e._palette.redraw(),true===e._options.paletteRenderStyle)e.saveHandler({color:"auto"})}else if(-1==e._palette.getSelectedIndex())e._palette.setSelectedIndex(0)}),e._palette.subscribe("onSelectedItemChange",function(t,i){if(i)e._checkBox.setChecked(false)}),e._options.paletteRenderStyle)e._palette.getContainer().width(e._palleteWidth);else{if(this._size=this.getChildControlByName("FontSize"),this._bold=this.getChildControlByName("Bold"),this._italic=this.getChildControlByName("Italic"),this._underline=this.getChildControlByName("Underline"),this._strikethrough=this.getChildControlByName("Strikethrough"),e._options.historyId||e._options.presets){if(e._presetView=this.getChildControlByName("presetView"),e.subscribeTo(e._presetView,"onItemActivate",function(t,i){e._activatePresetByKey(i["id"])}),e._options.presets)e._preparePreset(),e._presetView.setItems(this._prepareItems(this._presetItems)),e._presetView._container.on("mousedown focus",e._blockFocusEvents);if(e._options.historyId)e._historyInit()}e._pickerOpenHandler=function(){e._size._picker._container.on("mousedown focus",e._blockFocusEvents)}.bind(e),e._container.on("mousedown focus",e._blockFocusEvents),e._size._scrollToItem=function(){},e._size.setActive=function(){},e._size.once("onPickerOpen",e._pickerOpenHandler)}if(true===this._options.instantFireMode){var t=this.saveHandlerForInstanceFireMode.bind(this);this._palette.subscribe("onSelectedItemChange",t),this._size.subscribe("onSelectedItemChange",t),this._bold.subscribe("onActivated",t),this._italic.subscribe("onActivated",t),this._underline.subscribe("onActivated",t),this._strikethrough.subscribe("onActivated",t)}this.subscribe("onClose",this.onClose.bind(this)),this._currentStyle=this._getStyle(),this._backup=this._getStyle()},saveHandler:function(e){if(this._currentStyle=e?e:this._getStyle(),this._backup=e?e:this._getStyle(),this._notify("changeFormat",this._getInlineStyle(this._currentStyle)),this.hide(),this._options.historyId&&!e)this._saveHistory();this._currentPresetId=null},saveHandlerForInstanceFireMode:function(){this._currentStyle=this._getStyle(),this._notify("changeFormat",this._getInlineStyle(this._currentStyle))},onClose:function(){if(true===this._options.instantFireMode&&this._getInlineStyle(this._backup)!==this._getInlineStyle(this._currentStyle))this.setInlineStyle(this._getInlineStyle(this._backup))},_getStyle:function(){var e={};if(this._options.paletteRenderStyle)e={color:this._palette.getSelectedKey()};else if(e["font-size"]=this._size.getSelectedKey()+"px",e["color"]=this._palette.getSelectedKey()||"auto",this._bold.isChecked()&&(e["font-weight"]="bold"),this._italic.isChecked()&&(e["font-style"]="italic"),this._underline.isChecked()&&(e["text-decoration"]="underline"),this._strikethrough.isChecked())e["text-decoration"]=this._underline.isChecked()?e["text-decoration"]+" line-through":"line-through";return e},_preparePreset:function(){var e=[],t=this._options.presets,i;for(var s in t)if(t.hasOwnProperty(s)){if(i={id:o.randomId(),json:t[s]},t[s].name)i.name=t[s].name,delete i.json.name;e.push(i)}this._presetItems=e},_prepareItems:function(e){var t=this,i=[],s;if(e instanceof Array)e.forEach(function(e){if(s={id:e.id,style:t._getInlineStyle(e.json)},e.name)s.name=e.name;i.push(s)});else for(var n in e)if(e.hasOwnProperty(n)){if(s={id:e[n].id,style:t._getInlineStyle(e[n].json)},e[n].name)s.name=e[n].name;i.push(s)}return i},setInlineStyle:function(e){var t='{"'+e.split(";").filter(function(e){return e.length>0}).join(";").replace(/;/gi,'","').replace(/:/gi,'":"')+'"}',i={};try{i=JSON.parse(t)}catch(e){}if(i.hasOwnProperty("font-size"))this._size.setSelectedKey(i["font-size"].slice(0,-2));if(i.hasOwnProperty("color"))this._palette.setSelectedKey(i["color"]);if(i.hasOwnProperty("font-weight")&&"bold"===i["font-weight"])this._bold.setChecked(true);else this._bold.setChecked(false);if(i.hasOwnProperty("font-style")&&"italic"===i["font-style"])this._italic.setChecked(true);else this._italic.setChecked(false);if(i.hasOwnProperty("text-decoration")){if(i["text-decoration"].indexOf("underline")>=0)this._underline.setChecked(true);else this._underline.setChecked(false);if(i["text-decoration"].indexOf("line-through")>=0)this._strikethrough.setChecked(true);else this._strikethrough.setChecked(false)}else this._underline.setChecked(false),this._strikethrough.setChecked(false);this.saveHandler()},getInlineStyle:function(){return this._getInlineStyle(this._currentStyle)},getJSONStyle:function(){return this._currentStyle},_historyInit:function(){if(this._historyController=new s({historyId:this._options.historyId}),this._history=this._historyController.getHistory(),this._history)this._presetView.setItems(this._prepareItems(this._history));else this._history=[],this._presetView.toggle()},_getInlineStyle:function(e){var t="";for(var i in e)if(e.hasOwnProperty(i))t+=i+":"+e[i]+";";return t},_activatePresetByKey:function(e){var t;t=n(this._options.presets?this._presetItems:this._history,function(t){return t.id==e},this,false),this._currentPresetId=null!==t.json.id?t.json.id:null,this.saveHandler(t.json)},_paletteClickHandler:function(e){if(this._options.paletteRenderStyle)this.saveHandler({color:e})},_saveHistory:function(){var e;!this._history.length&&this._presetView.toggle(),this._history.length>4&&this._history.pop(),e={id:o.randomId(),json:this._currentStyle},this._history.unshift(e),this._historyController.setHistory(this._history,true),this._presetView.setItems(this._prepareItems(this._history))},getStylesObject:function(){var e={};if(this._options.paletteRenderStyle)e={color:this._palette.getSelectedKey()};else e={id:this._currentPresetId,fontsize:this._size.getSelectedKey(),color:this._palette.getSelectedKey(),bold:this._bold.isChecked(),italic:this._italic.isChecked(),underline:this._underline.isChecked(),strikethrough:this._strikethrough.isChecked()};return e},setStylesFromObject:function(e){if(this._palette.setSelectedKey(e.color),!this._options.paletteRenderStyle)this._size.setSelectedKey(e.fontsize),this._bold.setChecked(e.bold),this._italic.setChecked(e.italic),this._underline.setChecked(e.underline),this._strikethrough.setChecked(e.strikethrough)},_blockFocusEvents:function(e){var t=r.channel("WindowChangeChannel");if(e.preventDefault(),e.stopPropagation(),"mousedown"===e.type)t.notify("onDocumentClick",e)},destroy:function(){if(h.superclass.destroy.apply(this,arguments),!this._options.paletteRenderStyle)this._container.off("mousedown focus",this._blockFocusEvents),this._size.unsubscribe("onPickerOpen",this._pickerOpenHandler)}});return h});
//# sourceMappingURL=StylesPanelNew.js.map
define("SBIS3.CONTROLS/RichEditor/Components/ToolbarBase",["Core/core-clone","Core/core-merge","Core/EventBus","SBIS3.CONTROLS/Button/ButtonGroup/ButtonGroupBase","Core/helpers/String/escapeHtml","SBIS3.CONTROLS/StylesPanelNew","css!SBIS3.CONTROLS/RichEditor/Components/ToolbarBase/RichEditorToolbarBase"],function(t,e,n,i,o,s){"use strict";var r={INLINE_TEMPLATE:"6"},a=i.extend({$protected:{_options:{items:void 0,defaultConfig:void 0,_canServerRender:true,activableByClick:false,linkedEditor:void 0,idProperty:"name",expanded:true},_itemsContainer:void 0,_handlersInstances:{format:void 0},_stylesPanel:void 0,_buttons:{bold:false,italic:false,underline:false,strikethrough:false}},_modifyOptions:function(t){return t.items=this._prepareItems(t.items,t.defaultConfig,t.expanded),t=a.superclass._modifyOptions.apply(this,arguments),t},$constructor:function(){this._publish("onExpandedChange"),this._itemsContainer=this._container.find('[class*="__itemsContainer"]'),this._container.on("mousedown focus",this._blockFocusEvents),this._itemsContainer.on("mousedown focus",this._blockFocusEvents)},setEnabled:function(t){i.superclass.setEnabled.call(this,t)},setLinkedEditor:function(t){this._unbindEditor(),this._options.linkedEditor=t,this._bindEditor()},getLinkedEditor:function(){return this._options.linkedEditor},toggleToolbar:function(){this.setExpanded(!this._options.expanded)},setExpanded:function(t){this._options.expanded=t,this._notify("onExpandedChange",t)},getExpanded:function(){return this._options.expanded},_unbindEditor:function(){var t=this._options.linkedEditor;if(t)this.unsubscribeFrom(t,"onFormatChange",this._handlersInstances.format)},_bindEditor:function(){var t=this._options.linkedEditor;this._handlersInstances.format=this._formatChangeHandler.bind(this),this.subscribeTo(t,"onFormatChange",this._handlersInstances.format),this._fillHistory()},_formatChangeHandler:function(){},_blockFocusEvents:function(t){var e=n.channel("WindowChangeChannel");if(t.preventDefault(),t.stopPropagation(),"mousedown"===t.type)e.notify("onDocumentClick",t)},_prepareItems:function(n,i){var o,s=[];o=t(i);for(var r in n)if(n.hasOwnProperty(r)){var a=false;for(var l in i)if(o.hasOwnProperty(l))if(o[l].name==n[r].name){e(o[l],n[r]),a=true;break}if(!a)o.push(n[r])}for(var r in o)if(o.hasOwnProperty(r))if(o[r]=e({activableByClick:false},o[r]),false===o[r].visible)s.push(r);for(var r in s)if(o.hasOwnProperty(r))o.splice(s[r]-r,1);return o.sort(function(t,e){return(t.order||99999)-(e.order||99999)}),o},_getItemsContainer:function(){return this._itemsContainer},_fillHistory:function(){var t=function(t){var e,n,i=$("<div/>").append(t);if(i.find(".ws-fre__smile").each(function(){var t=$(this).attr("title");$(this).replaceWith("["+(t?t:rk("смайл"))+"]")}),e=n=o(i.text()),e=e.replace("/\n/gi","").replace(/{/g,"&#123;").replace(/}/g,"&#125;"),!e&&t)e=rk("Контент содержит только html-разметку, без текста.");else if(e&&e.length>140)e=e.substr(0,140)+" ...";return e};if(this.getItems().getRecordById("history"))this.getLinkedEditor().getHistory().addCallback(function(e){if(!this.isDestroyed()){var n=[],i=this.getItemInstance("history");for(var o in e)if(e.hasOwnProperty(o))n.push({key:n.length,title:t(e[o]),value:e[o]});if(!e.length)i.setEnabled(false);i.setItems(n)}}.bind(this))},_setText:function(t){if(this._options.linkedEditor)this._options.linkedEditor.setText(t)},_codeSample:function(t){this.getLinkedEditor().showCodeSample()},_openStylesPanel:function(t){var e=this.getStylesPanel(t),n=this.getLinkedEditor();e.setStylesFromObject(n?n.getCurrentFormats():{}),e.show()},_toggleState:function(t,e){var n={bold:"strong",italic:"em",underline:'span[style*="decoration: underline"]',strikethrough:'span[style*="decoration: line-through"]'};if(!t&&$(e.node).closest(n[e.format]).length)t=true;if(-1!=["bold","italic","underline","strikethrough"].indexOf(e.format))this._buttons[e.format]=t;return{state:t,name:e.format}},getStylesPanel:function(t){var e=this;if(!this._stylesPanel){var n=this.getLinkedEditor();this._stylesPanel=new s({parent:n,target:t.getContainer(),corner:"tl",verticalAlign:{side:"top",offset:-4},horizontalAlign:{side:"left"},element:$("<div></div>"),fontSizes:[12,14,15,18],colors:[{color:"black"},{color:"red"},{color:"green"},{color:"blue"},{color:"purple"},{color:"grey"}],presets:[{id:"mainText",name:rk("Основной")},{id:"title",color:"#313E78","font-size":"18px","font-weight":"bold",name:rk("Заголовок")},{id:"subTitle",color:"#313E78","font-size":"15px","font-weight":"bold",name:rk("Подзаголовок")},{id:"additionalText",color:"#999999","font-size":"12px",name:rk("Дополнительный")}],activableByClick:false}),this._stylesPanel.subscribe("changeFormat",function(){e.getLinkedEditor().applyFormats(e._stylesPanel.getStylesObject())})}return this._stylesPanel},_execCommand:function(t){if(this._options.linkedEditor)this._options.linkedEditor.execCommand(t)},destroy:function(){if(this._unbindEditor(),this._handlersInstances=null,this._stylesPanel)this._stylesPanel.destroy();a.superclass.destroy.apply(this,arguments),this._itemsContainer=null}});return a});
//# sourceMappingURL=ToolbarBase.js.map
define("SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/resources/handlers",[],function(){"use strict";return{toggle:function(){this.getParent().toggleToolbar()},styles:function(){this.getParent()._openStylesPanel(this)},list:function(t,e){this.getParent()._execCommand(e)},link:function(){this.getParent()._insertLink()},image:function(t,e){this.getParent()._startFileLoad(this._container)},smile:function(t,e){this.getParent()._insertSmile(e)},history:function(t,e){this.getParent()._setText(this.getItems().getRecordById(e).get("value"))}}});
//# sourceMappingURL=handlers.js.map
define("SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/smiles",["i18n!SBIS3.CONTROLS/RichEditor"],function(){"use strict";return[{key:"first",code:"128514",title:"&#128514;"},{key:"second",code:"128516",title:"&#128516;"},{key:"third",code:"128565",title:"&#128565;"},{key:"fourth",code:"128520",title:"&#128520;"},{key:"fifth",code:"128521",title:"&#128521;"},{key:"sixth",code:"128523",title:"&#128523;"},{key:"seventh",code:"128525",title:"&#128525;"},{key:"eighth",code:"128526",title:"&#128526;"},{key:"ninth",code:"128528",title:"&#128528;"},{key:"tenth",code:"128532",title:"&#128532;"},{key:"eleventh",code:"128536",title:"&#128536;"},{key:"twelfth",code:"128544",title:"&#128544;"},{key:"thirteenth",code:"128547",title:"&#128547;"},{key:"fourteenth",code:"128553",title:"&#128553;"},{key:"fifteenth",code:"128554",title:"&#128554;"},{key:"sixteenth",code:"128555",title:"&#128555;"},{key:"seventeenth",code:"128557",title:"&#128557;"},{key:"eighteenth",code:"128562",title:"&#128562;"},{key:"nineteenth",code:"128567",title:"&#128567;"},{key:"twentieth",code:"128584",title:"&#128584;"},{key:"twenty first",code:"128585",title:"&#128585;"},{key:"twenty second",code:"128586",title:"&#128586;"},{key:"twenty third",code:"128522",title:"&#128522;"},{key:"twenty fourth",code:"128515",title:"&#128515;"}]});
//# sourceMappingURL=smiles.js.map
define("SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/resources/config",["SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/resources/handlers","SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/smiles","i18n!SBIS3.CONTROLS/RichEditor"],function(o,e){"use strict";return function(){return[{name:"toggle",componentType:"SBIS3.CONTROLS/Button/IconButton",icon:"sprite:icon-16 icon-View icon-primary",handlers:{onActivated:o.toggle},basic:true,order:1},{name:"styles",componentType:"SBIS3.CONTROLS/Button/IconButton",tooltip:rk("Стили"),icon:"sprite:icon-16 icon-TFCurtailRTE2 icon-primary",className:"controls-IconButton__round-border",handlers:{onActivated:o.styles},order:10},{name:"list",componentType:"SBIS3.CONTROLS/Menu/MenuIcon",tooltip:rk("Вставить/Удалить список"),withoutHeader:true,icon:"sprite:icon-16 icon-ListMarked icon-primary",className:"controls-IconButton__round-border",pickerClassName:"controls-Menu__hide-menu-header controls-RichEditorToolbarMenu fre-list",items:[{key:"InsertUnorderedList",title:" ",icon:"sprite:icon-24 icon-ListMarked icon-primary"},{key:"InsertOrderedList",title:" ",icon:"sprite:icon-24 icon-ListNumbered icon-primary"}],handlers:{onMenuItemActivate:o.list},idProperty:"key",order:20,pickerConfig:{verticalAlign:{side:"top",offset:2},horizontalAlign:{side:"left",offset:6}}},{name:"link",componentType:"SBIS3.CONTROLS/Button/IconButton",tooltip:rk("Вставить/редактировать ссылку"),icon:"sprite:icon-16 icon-Link icon-primary",className:"controls-IconButton__round-border",handlers:{onActivated:o.link},order:30},{name:"image",componentType:"SBIS3.CONTROLS/Button/IconButton",tooltip:rk("Вставить картинку"),icon:"sprite:icon-16 icon-PicBtr icon-primary",className:"controls-IconButton__round-border",handlers:{onActivated:o.image},order:40},{name:"smile",basic:true,tooltip:rk("Вставить смайлик"),componentType:"SBIS3.CONTROLS/Menu/MenuIcon",icon:"sprite:icon-16 icon-EmoiconSmile icon-primary",items:e,pickerClassName:"controls-Menu__hide-menu-header controls-RichEditorToolbar__smilesPicker",multiselect:false,className:"controls-IconButton__round-border",handlers:{onMenuItemActivate:o.smile},idProperty:"key",order:50},{name:"history",caption:rk("История ввода"),componentType:"SBIS3.CONTROLS/Menu/MenuIcon",icon:"sprite:icon-16 icon-InputHistory icon-primary",pickerClassName:"controls-RichEditorRoundToolbar__historyPicker",multiselect:false,className:"controls-IconButton__round-border",handlers:{onMenuItemActivate:o.history},idProperty:"key",order:60}]}});
//# sourceMappingURL=config.js.map
define("js!WSControls/Buttons/MenuButton",["js!WSControls/Buttons/Button","SBIS3.CONTROLS/Mixins/PickerMixin","SBIS3.CONTROLS/Mixins/DSMixin","Core/IoC","Core/detection","Core/Sanitize","Core/helpers/String/escapeHtml"],function(t,e,i,n,o,s,r){"use strict";function a(t,e){var i=e?"SBIS3.CONTROLS/Menu/SbisMenu":"SBIS3.CONTROLS/Menu/ContextMenu";if(requirejs.defined(i))return t(requirejs(i));else requirejs([i],function(e){return t(e)})}var p=t.extend([e,i],{$protected:{_options:{parentProperty:null,nodeProperty:null,menuCaption:"",historyId:null,pinned:false,frequent:false,blParams:{blEndpoint:{contract:null},binding:{query:null,read:null},displayField:null}}},_modifyOptions:function(t){if(t.hierField)n.resolve("ILogger").log("MenuButton","Опция hierField является устаревшей, используйте parentProperty"),t.parentProperty=t.hierField;if(t.parentProperty&&!t.nodeProperty)t.nodeProperty=t.parentProperty+"@";var e=p.superclass._modifyOptions.apply(this,arguments);return e.caption=s(e.caption,{validNodes:{component:true}}),e.menuCaption=s(e.menuCaption,{validNodes:{component:true}}),e},$constructor:function(){if(this._publish("onMenuItemActivate"),this._container.hasClass("controls-Menu__hide-menu-header"))this._options.pickerClassName+=" controls-Menu__hide-menu-header"},_checkItemsIcons:function(t){var e=this,i="controls-MenuItem__",n=["16","24","32","small","medium","large"];if(this._options.icon&&t&&!this._container.hasClass("controls-Menu__hide-menu-header"))n.forEach(function(t){if(-1!==e._options.icon.indexOf("icon-"+t))i+="padding-"+t});$("> .controls-MenuItem",this._picker.getContainer().find(".controls-Menu__itemsContainer")).each(function(){var t=$(this);if(!t.find(".controls-MenuItem__icon").length)t.addClass(i)})},init:function(){if(this._container.addClass("controls-MenuButton"),this._container.hasClass("controls-Button__big"))this._options.pickerClassName+=" controls-Menu__big";this.reload(),p.superclass.init.call(this)},_clickHandler:function(t){if(this._items)if(this._items.getCount()>1)this.togglePicker();else if(1==this._items.getCount()){var e=this._items.at(0).getId(),i=this._items.at(0).get("command"),n,o;if(i)n=this._items.at(0).get("commandArgs"),o=[i].concat(n?n:[]),this.sendCommand.apply(this,o);this._notify("onMenuItemActivate",e,t)}},showPicker:function(){var t=this;a(function(){p.superclass.showPicker.call(t),t._picker.subscribe("ondrawitems",function(){t._checkItemsIcons(t._picker.getItems())})},t._options.historyId)},getPicker:function(){if(!requirejs.defined("SBIS3.CONTROLS/Menu/ContextMenu"))return void n.resolve("ILogger").log("MenuButton","ContextMenu не загружено");return p.superclass.getPicker.call(this)},_createPicker:function(t){var e={parent:this.getParent(),opener:this,groupBy:this._options.groupBy,context:this.getParent()?this.getParent().getLinkedContext():{},element:t,target:this.getContainer(),className:this._options.pickerClassName,items:this._options.items||this._items,corner:"tl",filter:this._options.filter,enabled:this.isEnabled(),parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty,idProperty:this._options.idProperty,additionalProperty:this._options.additionalProperty,allowChangeEnable:this._options.allowChangeEnable,displayProperty:this._options.displayProperty||"title",verticalAlign:{side:"top"},horizontalAlign:{side:"left"},closeByExternalClick:true,closeOnTargetMove:true,targetPart:true,footerTpl:this._options.footerTpl};if(this._options.historyId)e["historyId"]=this._options.historyId,e["pinned"]=this._options.pinned,e["frequent"]=this._options.frequent,e["recent"]=this._options.recent,e["blParams"]={blEndpoint:{contract:this._options.blParams.blEndpoint.contract},binding:{query:this._options.blParams.binding.query,read:this._options.blParams.binding.read},displayField:this._options.blParams.displayField};if(this._options.pickerConfig)for(var i in this._options.pickerConfig)if(this._options.pickerConfig.hasOwnProperty(i))e[i]=this._options.pickerConfig[i];if(e=this._modifyPickerOptions(e),this._dataSource)e.dataSource=this._dataSource;return a(function(t){return new t(e)},this._options.historyId)},_modifyPickerOptions:function(t){return t},_setWidth:function(){},_initializePicker:function(){p.superclass._initializePicker.call(this);var t=this;if(this._picker._oppositeCorners.tl.horizontal.top="tr",this._picker._oppositeCorners.tr.horizontal.top="tl",this._picker.subscribe("onDrawItems",function(){t._picker.recalcPosition(true)}),this._picker.subscribe("onMenuItemActivate",function(e,i,n){t._notify("onMenuItemActivate",i,n)}),this._setWidth(),o.firefox||o.isIE)this.getPicker().subscribe("onAlignmentChange",function(){var t=this.getPicker(),e=t.getContainer().hasClass("controls-popup-revert-vertical"),i=$(".controls-Menu__header",t.getContainer());if(i.length)if(e)t.getContainer().append(i);else t.getContainer().prepend(i)}.bind(this))},setEnabled:function(t){if(p.superclass.setEnabled.apply(this,arguments),this._picker)this._picker.setEnabled(t)},setAllowChangeEnable:function(t){if(p.superclass.setAllowChangeEnable.apply(this,arguments),this._picker)this._picker.setAllowChangeEnable(t)},_setPickerContent:function(){var t=this,e=this._getHeader();e.bind("click",function(){t._onHeaderClick()}),this._picker.getItems()&&this._checkItemsIcons(this._picker.getItems()),this._picker.getContainer().prepend(e)},setCaption:function(t){p.superclass.setCaption.apply(this,arguments),!this._options.menuCaption&&this._drawMenuCaption(t)},setMenuCaption:function(t){this._options.menuCaption=t||"",this._drawMenuCaption(t)},_drawMenuCaption:function(t){if(this._picker&&t){if(this._options.escapeCaptionHtml)t=r(t);t=s(t,{validNodes:{component:true}}),$(".controls-Menu__header-caption",this._picker._container).html(t)}},getMenuCaption:function(){return this._options.menuCaption},_drawIcon:function(t){if(p.superclass._drawIcon.apply(this,arguments),this._picker){var e=$(".controls-Menu__header-icon",this._picker.getContainer()),i="controls-Menu__header-icon "+this._options._iconClass;if(t)if(e.length)e.get(0).className=i;else{var n=$(".controls-Menu__header-caption",this._picker.getContainer().get(0));e=$('<i class="'+i+'"></i>'),n.before(e)}else e&&e.remove()}},_getHeader:function(){var t=$('<div class="controls-Menu__header">'),e=$('<div class="controls-Menu-headWrapper">');if(this._options.icon)e.append('<i class="controls-Menu__header-icon '+this._iconTemplate(this._options)+'"></i>');return e.append('<span class="controls-Menu__header-caption">'+(this._options.menuCaption||this._options.caption||"")+"</span>"),t.append(e),t},_onHeaderClick:function(){this.togglePicker()},getItemsInstances:function(){if(!this._picker)throw new Error("WSControls/Buttons/MenuButton::getItemsInstances  Попытка получения инстансов элементов меню до инициализации пикера.");return this._picker.getItemsInstances.apply(this._picker,arguments)},_redraw:function(){if(this._picker)this._picker.destroy(),this._initializePicker()},_dataLoadedCallback:function(){if(this._picker)this.hidePicker(),this._picker.setItems(this.getItems())},setKeyField:function(t){n.resolve("ILogger").log("MenuButton","Метод setKeyField устарел, используйте setIdProperty"),this.setIdProperty(t)},setIdProperty:function(t){this._options.idProperty=t},setDisplayField:function(t){n.resolve("ILogger").log("MenuButton","Метод setDisplayField устарел, используйте setDisplayProperty"),this.setDisplayProperty(t)},setDisplayProperty:function(t){this._options.displayProperty=t},setHierField:function(t){n.resolve("ILogger").log("MenuButton","Метод setHierField устарел, используйте setParentProperty/setNodeProperty"),this.setParentProperty(t)},setParentProperty:function(t){this._options.parentProperty=t},setNodeProperty:function(t){this._options.nodeProperty=t}});return p});
//# sourceMappingURL=MenuButton.js.map
define("SBIS3.CONTROLS/Menu/MenuIcon",["js!WSControls/Buttons/MenuButton","css!SBIS3.CONTROLS/Button/IconButton/IconButton","css!SBIS3.CONTROLS/Menu/MenuIcon/MenuIcon"],function(n){"use strict";var o=n.extend([],{_hasHeader:false,$protected:{_zIndex:""},_modifyOptions:function(){var n=o.superclass._modifyOptions.apply(this,arguments),e=["16","24","32","small","medium","large"];if(n.pickerClassName+=" controls-MenuIcon__Menu",n.cssClassName+=" controls-MenuIcon controls-IconButton",n.cssClassName+=n.caption?"":" controls-Button__withoutCaption",!n.tooltip&&n.caption)n.tooltip=n.caption;if(n.className&&-1!==n.className.indexOf("controls-IconButton__round-border"))if(-1!==n.className.indexOf("controls-IconButton__round-border-24"))n.pickerClassName+=" controls-IconButton__round-border-24";else n.pickerClassName+=" controls-IconButton__round-border";if(n.icon)e.forEach(function(o){if(-1!==n.icon.indexOf("icon-"+o))n.pickerClassName+=" controls-Menu_offset_icon-"+o});if(n.icon&&(-1!==n.icon.indexOf("icon-24")||-1!==n.icon.indexOf("icon-large"))&&-1===n.className.indexOf("controls-Menu__hide-menu-header"))n.pickerClassName+=" controls-Menu__big-header";return n},init:function(){this.reload(),o.superclass.init.call(this)}});return o});
//# sourceMappingURL=MenuIcon.js.map
define("SBIS3.CONTROLS/RichEditor/Components/RoundToolbar",["SBIS3.CONTROLS/RichEditor/Components/ToolbarBase","tmpl!SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/RichEditorRoundToolbar","SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/resources/config","WS.Data/Di","SBIS3.CONTROLS/Menu/MenuIcon","SBIS3.CONTROLS/Button/IconButton","css!SBIS3.CONTROLS/RichEditor/Components/RoundToolbar/RichEditorRoundToolbar","SBIS3.CONTROLS/Button/IconButton"],function(i,t,o,e){"use strict";var n={INLINE_TEMPLATE:"6"},s=i.extend({_dotTplFn:t,$protected:{_options:{items:void 0,expanded:false,side:"right"}},_modifyOptions:function(i){return i.defaultConfig=o(),i.defaultConfig[0].order="right"===i.side?1e3:1,i.defaultConfig[0].icon="right"===i.side?"sprite:icon-16 icon-View icon-primary":"sprite:icon-16 icon-ViewBack icon-primary",i=s.superclass._modifyOptions.apply(this,arguments),i},setExpanded:function(i){var t=this.getItemsInstances(),o=this.getItemInstance("toggle"),e=i&&"right"===this._options.side||!i&&"left"===this._options.side?"Back":"";for(var n in t)if(t.hasOwnProperty(n))if(!t[n]._options.basic)t[n].setVisible(i);o.setIcon("sprite:icon-16 icon-View"+e+" icon-primary"),s.superclass.setExpanded.apply(this,arguments)},_formatChangeHandler:function(i,t,o){if(-1!=["bold","italic","underline","strikethrough"].indexOf(t.format))this._toggleState(o,t)},_prepareItems:function(i,t,o){var i=s.superclass._prepareItems.apply(this,arguments);for(var e in i)if(i.hasOwnProperty(e))i[e].visible=i[e].basic||o;return i},_insertLink:function(i,t){if(this._options.linkedEditor)this._options.linkedEditor.insertLink(i,t)},_selectFile:function(i){if(this._options.linkedEditor)this._options.linkedEditor._getFileLoader().selectFile(i)},getFileLoader:function(){return e.resolve("ImageUploader").getFileLoader()},_startFileLoad:function(i){var t=this;if(t._options.linkedEditor)this.getFileLoader().startFileLoad(i,false,"images").addCallback(function(i){t._options.linkedEditor.insertImageTemplate(n.INLINE_TEMPLATE,i)}.bind(this))},_insertSmile:function(i){if(this._options.linkedEditor)this._options.linkedEditor.insertSmile(i)}});return s});
//# sourceMappingURL=RoundToolbar.js.map
define("js!SBIS3.CONTROLS.RichEditorRoundToolbar",["SBIS3.CONTROLS/RichEditor/Components/RoundToolbar"],function(o){return o});
//# sourceMappingURL=RichEditorRoundToolbar.module.js.map
define("tmpl!SBIS3.CONTROLS/RichEditor/RichEditor",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/RichEditor/Components/Toolbar"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/RichEditor/Components/Toolbar"]=e[1];var i=function e(i,a,o,s,n){function l(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};n&&n.isSetts&&(p=n.fullContext||{});var g="string"==typeof o?o:"",h=void 0===r?void 0:r,m={id:[],def:void 0},u=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},v=d.getMarkupGenerator(s);try{var R=v.joinElements([v.createTag("div",{class:"controls-RichEditor"},[d.getter(i,["enabled"])&&d.getter(i,["toolbar"])?[v.createControl("wsControl","ws:SBIS3.CONTROLS/RichEditor/Components/Toolbar",{name:"RichEditorToolbar",expanded:d.getter(i,["toolbarVisible"]),items:d.getter(i,["items"])},{name:"RichEditorToolbar",sbisname:"RichEditorToolbar"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:u},o,h,f,d.config,p)]:v.createText(""),v.createTag("div",{class:"controls-RichEditor__dataReview ws-basic-style "+d.wrapUndef(d.utils.escape(d.getter(i,["editorConfig","className"])))+d.wrapUndef(d.utils.escape(d.getter(i,["enabled"])?" ws-hidden":"")),tabindex:"1",style:d.wrapUndef(d.utils.escape(d.getter(i,["autoHeight"])&&d.getter(i,["minimalHeight"])?"min-height:"+d.getter(i,["minimalHeight"])+"px;":""))+" "+d.wrapUndef(d.utils.escape(d.getter(i,["autoHeight"])&&d.getter(i,["maximalHeight"])?"max-height:"+d.getter(i,["maximalHeight"])+"px;":""))},[v.createText(""+d.wrapUndef(d.Sanitize.apply(void 0,[!d.getter(i,["enabled"])&&d.getter(i,["text"])?d.getDecorators().sanitize.apply(void 0,[d.getter(i,["_prepareReviewContent"]).apply(i,[d.getter(i,["text"])])]):""])))],{},m,this),v.createTag("div",{class:"controls-RichEditor__placeholder"},[v.createText(""+d.wrapUndef(d.utils.escape(d.getter(i,["placeholder"]))))],{},m,this),v.createTag("div",{class:"controls-RichEditor__editorFrame ws-basic-style "+d.wrapUndef(d.utils.escape(d.getter(i,["editorConfig","className"])))+d.wrapUndef(d.utils.escape(d.getter(i,["enabled"])?"":" ws-hidden")),style:d.wrapUndef(d.utils.escape(d.getter(i,["autoHeight"])&&d.getter(i,["minimalHeight"])?"min-height:"+d.getter(i,["minimalHeight"])+"px;":""))+" "+d.wrapUndef(d.utils.escape(d.getter(i,["autoHeight"])&&d.getter(i,["maximalHeight"])?"max-height:"+d.getter(i,["maximalHeight"])+"px;":""))},[v.createText(""+d.wrapUndef(d.Sanitize.apply(void 0,[d.getter(i,["enabled"])&&d.getter(i,["text"])?d.getDecorators().sanitize.apply(void 0,[d.getter(i,["_prepareContent"]).apply(i,[d.getter(i,["_prepareReviewContent"]).apply(i,[d.getter(i,["text"])])])]):""])))],{},m,this),v.createTag("textarea",{class:"controls-RichEditor__fakeArea",tabindex:"0"},[],{},m,this),v.createTag("div",{class:"controls-RichEditor__sourceContainer ws-hidden"},[v.createTag("textarea",{class:"controls-RichEditor__sourceArea"},[],{},m,this)],{},m,this)],a,m,this)],g,m);m.def&&(R=v.chain(R,m,a),m=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/RichEditor/RichEditor.tmpl",e,i)}return R||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/RichEditor/RichEditor"}},i});
//# sourceMappingURL=RichEditor.tmpl.map
define("tmpl!SBIS3.CONTROLS/RichEditor/Components/Toolbar/RichEditorToolbar",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,a,n,l){function c(){}var s=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var p="string"==typeof a?a:"",h=void 0===r?void 0:r,m={id:[],def:void 0},v=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),T=this&&this.includedTemplates?this.includedTemplates:{},f=d.getMarkupGenerator(n);try{var g=f.joinElements([f.createTag("div",{class:"controls-RichEditorToolbar"+d.wrapUndef(d.utils.escape(d.getter(o,["expanded"])?"":" controls-RichEditorToolbar__hide"))},[f.createTag("button",{class:"controls-RichEditorToolbar__toggleButton",tabindex:"-1"},[],{},m,this),f.createTag("div",{class:"controls-RichEditorToolbar__itemsContainer"},[d.getter(o,["_serverRender"])?[f.createControl("resolver",d.getter(o,["_itemsTemplate"]),{records:d.getter(o,["_records"]),tplData:d.getter(o,["_itemData"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},a,h,T,d.config,u,m)]:f.createText("")],{},m,this)],i,m,this)],p,m);m.def&&(g=f.chain(g,m,i),m=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/RichEditor/Components/Toolbar/RichEditorToolbar.tmpl",e,o)}return g||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/RichEditor/Components/Toolbar/RichEditorToolbar"}},o});
//# sourceMappingURL=RichEditorToolbar.tmpl.map
define("SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/handlers",[],function(){"use strict";var t=function(){this.getParent()._execCommand(this._options.name)};return{undo:t,redo:t,styles:function(){this.getParent()._openStylesPanel(this)},style:function(t,e){this.getParent()._setFontStyle(e)},bold:t,italic:t,underline:t,strikethrough:t,blockquote:t,align:function(t,e){this.getParent()._setTextAlign(e)},color:function(t,e){this.getParent()._setFontColor(e)},list:function(t,e){this.getParent()._execCommand(e)},link:function(){this.setChecked(true),this.getParent()._insertLink(function(){this.setChecked(false)}.bind(this),this._container)},unlink:t,image:function(){this.getParent()._openImagePanel(this)},smile:function(t,e){this.getParent()._insertSmile(e)},paste:function(t,e){this.getParent()._pasteFromBufferWithStyles(false,this._container,"style"===e)},source:function(){this.getParent()._toggleContentSource()},history:function(t,e){this.getParent()._setText(this.getItems().getRecordById(e).get("value"))},codesample:function(){this.getParent()._codeSample(this)}}});
//# sourceMappingURL=handlers.js.map
define("SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/config",["Core/constants","SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/handlers","SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/smiles","i18n!SBIS3.CONTROLS/RichEditor"],function(o,e,t){"use strict";return function(){return[{name:"undo",componentType:"WSControls/Buttons/Button",tooltip:rk("Шаг назад"),className:"controls-ToggleButton__square controls-ToggleButton-square__medium",icon:"sprite:icon-24 icon-Undo2 icon-primary",handlers:{onActivated:e.undo},enabled:false,order:10,tabindex:0},{name:"redo",componentType:"WSControls/Buttons/Button",tooltip:rk("Шаг вперед"),className:"controls-ToggleButton__square controls-ToggleButton-square__medium",icon:"sprite:icon-24 icon-Redo2 icon-primary",handlers:{onActivated:e.redo},enabled:false,order:10,tabindex:0},{name:"styles",componentType:"WSControls/Buttons/Button",tooltip:rk("Стили"),icon:"sprite:icon-24 icon-TFCurtailRTE2 icon-primary",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",handlers:{onActivated:e.styles},visible:false,order:25,tabindex:0},{name:"style",componentType:"SBIS3.CONTROLS/ComboBox",items:[{key:"mainText",title:rk("Основной")},{key:"title",title:rk("Заголовок"),className:"titleText"},{key:"subTitle",title:rk("Подзаголовок"),className:"subTitleText"},{key:"additionalText",title:rk("Дополнительный"),className:"additionalText"}],pickerClassName:"controls-RichEditorToolbar__stylePicker",idProperty:"key",selectedKey:"mainText",editable:false,handlers:{onSelectedItemChange:e.style},order:20,tabindex:0},{name:"bold",componentType:"WSControls/Buttons/ToggleButton",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",tooltip:rk("Полужирный"),icon:"sprite:icon-24 icon-Bold icon-primary",handlers:{onActivated:e.bold},order:30,tabindex:0},{name:"italic",componentType:"WSControls/Buttons/ToggleButton",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",tooltip:rk("Курсив"),icon:"sprite:icon-24 icon-Italic icon-primary",handlers:{onActivated:e.italic},order:40,tabindex:0},{name:"underline",componentType:"WSControls/Buttons/ToggleButton",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",tooltip:rk("Подчеркнутый"),icon:"sprite:icon-24 icon-Underline icon-primary",handlers:{onActivated:e.underline},order:50,tabindex:0},{name:"strikethrough",componentType:"WSControls/Buttons/ToggleButton",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",tooltip:rk("Зачеркнутый"),icon:"sprite:icon-24 icon-Stroked icon-primary",handlers:{onActivated:e.strikethrough},order:60,tabindex:0},{name:"blockquote",componentType:"WSControls/Buttons/ToggleButton",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",tooltip:rk("Цитата"),icon:"sprite:icon-24 icon-Quote icon-primary",handlers:{onActivated:e.blockquote},order:65,tabindex:0},{name:"align",componentType:"WSControls/Buttons/MenuButton",tooltip:rk("Выравнивание текста"),items:[{key:"alignleft",title:" ",tooltip:rk("По левому краю"),icon:"icon-24 icon-AlignmentLeft icon-primary"},{key:"aligncenter",title:" ",tooltip:rk("По центру"),icon:"icon-24 icon-AlignmentCenter icon-primary"},{key:"alignright",title:" ",tooltip:rk("По правому краю"),icon:"icon-24 icon-AlignmentRight icon-primary"},{key:"alignjustify",title:" ",tooltip:rk("По ширине"),icon:"icon-24 icon-AlignmentWidth icon-primary"}],idProperty:"key",editable:false,icon:"icon-24 icon-AlignmentLeft icon-primary",selectedKey:"alignleft",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",pickerClassName:"controls-RichEditorToolbarMenu controls-MenuIcon__Menu controls-Menu__hide-menu-header",handlers:{onMenuItemActivate:e.align},pickerConfig:{verticalAlign:{side:"top",offset:2},horizontalAlign:{side:"left",offset:6}},order:80,tabindex:0},{name:"color",componentType:"WSControls/Buttons/MenuButton",tooltip:rk("Цвет текста"),icon:"sprite:icon-24 icon-LetterA icon-primary",className:"fre-color controls-ToggleButton__square controls-ToggleButton-square__medium",pickerClassName:"fre-color controls-MenuIcon__Menu controls-Menu__hide-menu-header",items:[{key:"black",tooltip:rk("Черный"),title:'<div  unselectable ="on" class="controls-RichEditorToolbar__color controls-RichEditorToolbar__colorBlack"></div>'},{key:"red",tooltip:rk("Красный"),title:'<div  unselectable ="on" class="controls-RichEditorToolbar__color controls-RichEditorToolbar__colorRed"></div>'},{key:"green",tooltip:rk("Зеленый"),title:'<div  unselectable ="on" class="controls-RichEditorToolbar__color controls-RichEditorToolbar__colorGreen"></div>'},{key:"blue",tooltip:rk("Синий"),title:'<div  unselectable ="on" class="controls-RichEditorToolbar__color controls-RichEditorToolbar__colorBlue"></div>'},{key:"purple",tooltip:rk("Пурпурный"),title:'<div  unselectable ="on" class="controls-RichEditorToolbar__color controls-RichEditorToolbar__colorPurple"></div>'},{key:"grey",tooltip:rk("Серый"),title:'<div  unselectable ="on" class="controls-RichEditorToolbar__color controls-RichEditorToolbar__colorGrey"></div>'}],handlers:{onMenuItemActivate:e.color},pickerConfig:{verticalAlign:{side:"top",offset:2},horizontalAlign:{side:"left",offset:6}},order:70,tabindex:0},{name:"list",componentType:"WSControls/Buttons/MenuButton",tooltip:rk("Вставить/Удалить список"),className:"controls-ToggleButton__square controls-ToggleButton-square__medium",pickerClassName:"fre-list controls-RichEditorToolbarMenu controls-MenuIcon__Menu controls-Menu__hide-menu-header",icon:"sprite:icon-24 icon-ListMarked icon-primary",items:[{key:"InsertUnorderedList",title:" ",icon:"sprite:icon-24 icon-ListMarked icon-primary"},{key:"InsertOrderedList",title:" ",icon:"sprite:icon-24 icon-ListNumbered icon-primary"}],idProperty:"key",handlers:{onMenuItemActivate:e.list},pickerConfig:{verticalAlign:{side:"top",offset:2},horizontalAlign:{side:"left",offset:6}},order:90,tabindex:0},{name:"link",componentType:"WSControls/Buttons/ToggleButton",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",tooltip:rk("Вставить/редактировать ссылку"),icon:"sprite:icon-24 icon-Link icon-primary",handlers:{onActivated:e.link},visible:true,order:100,tabindex:0},{name:"unlink",componentType:"WSControls/Buttons/Button",tooltip:rk("Убрать ссылку"),icon:"sprite:icon-24 icon-Unlink icon-primary",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",handlers:{onActivated:e.unlink},enabled:false,visible:true,order:110,tabindex:0},{name:"image",componentType:"WSControls/Buttons/Button",icon:"sprite:icon-24 icon-PicBtr icon-primary",tooltip:rk("Вставить изображение"),className:"controls-ToggleButton__square controls-ToggleButton-square__medium",handlers:{onActivated:e.image},order:140,tabindex:0},{name:"smile",tooltip:rk("Вставить смайлик"),componentType:"WSControls/Buttons/MenuButton",icon:"sprite:icon-24 icon-SmileBtr icon-primary",pickerClassName:"controls-RichEditorToolbar__smilesPicker controls-Menu__hide-menu-header controls-MenuButton__Menu",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",items:t,handlers:{onMenuItemActivate:e.smile},idProperty:"key",visible:false,order:150,tabindex:0},{name:"paste",componentType:"WSControls/Buttons/MenuButton",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",pickerClassName:"controls-MenuButton__Menu",caption:rk("Вставка"),tooltip:rk("Вставка"),icon:"sprite:icon-24 icon-PasteBtr icon-primary",pickerConfig:{verticalAlign:{side:"top",offset:2},horizontalAlign:{side:"left",offset:-10}},items:[{key:"style",title:rk("С сохранением стилей"),icon:"sprite:icon-24 icon-PasteStyle icon-primary"},{key:"empty",title:rk("Без форматирования"),icon:"sprite:icon-24 icon-PasteAsText icon-primary"}],handlers:{onMenuItemActivate:e.paste},idProperty:"key",visible:!o.browser.isMobilePlatform&&!o.browser.isMacOSDesktop,order:120,tabindex:0},{name:"source",componentType:"WSControls/Buttons/ToggleButton",className:"controls-ToggleButton__square controls-ToggleButton-square__medium",tooltip:rk("html-разметка"),icon:"sprite:icon-24 icon-Html icon-primary",handlers:{onActivated:e.source},order:160,tabindex:0},{name:"history",caption:rk("История ввода"),componentType:"WSControls/Buttons/MenuButton",pickerClassName:"controls-MenuIcon__Menu",icon:"sprite:icon-24 icon-InputHistory icon-primary",multiselect:false,className:"controls-ToggleButton__square controls-ToggleButton-square__medium",handlers:{onMenuItemActivate:e.history},idProperty:"key",pickerConfig:{verticalAlign:{side:"top",offset:2},horizontalAlign:{side:"left",offset:-10}},visible:false,order:160,tabindex:0},{name:"codesample",tooltip:rk("Вставка кода"),componentType:"WSControls/Buttons/Button",icon:"sprite:icon-24 icon-PasteCodeBtr icon-primary",multiselect:false,className:"controls-ToggleButton__square controls-ToggleButton-square__medium",handlers:{onActivated:e.codesample},visible:false,order:130,tabindex:0}]}});
//# sourceMappingURL=config.js.map
define("tmpl!SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={},o=function e(o,a,i,l,s){function r(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};s&&s.isSetts&&(u=s.fullContext||{});var _="string"==typeof i?i:"",g=void 0===n?void 0:n,h={id:[],def:void 0},m=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),p=this&&this.includedTemplates?this.includedTemplates:{},I=d.getMarkupGenerator(l);try{var f=I.joinElements([I.createTag("div",{class:"controls-Menu__Popup controls-ImagePanel  controls-FloatArea"},[I.createTag("div",{class:"controls-ImagePanel__header"},[I.createTag("div",{class:"controls-ImagePanel__title",title:""+d.wrapUndef(d.utils.escape(d.getter(o,["windowTitle"])))},[I.createText(""+d.wrapUndef(d.utils.escape(d.getter(o,["windowTitle"]))))],{},h,this)],{},h,this),I.createTag("div",{class:"controls-ImagePanel__mainButtons"},[I.createTag("div",{class:"controls-ImagePanel__Button controls-ImagePanel__Button__Left","data-id":"1",title:""+global.rk("Слева, с обтеканием по рамке")},[],{},h,this),I.createTag("div",{class:"controls-ImagePanel__Button controls-ImagePanel__Button__Middle","data-id":"2",title:""+global.rk("По центру, с обтеканием сверху и снизу")},[],{},h,this),I.createTag("div",{class:"controls-ImagePanel__Button controls-ImagePanel__Button__Right","data-id":"3",title:""+global.rk("Справа, с обтеканием по рамке")},[],{},h,this),I.createTag("div",{class:"controls-ImagePanel__Button controls-ImagePanel__Button__Inside","data-id":"6",title:""+global.rk("В тексте, без обтекания")},[],{},h,this)],{},h,this)],a,h,this)],_,h);h.def&&(f=I.chain(f,h,a),h=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel.tmpl",e,o)}return f||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel"}},o}),define("SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel",["SBIS3.CONTROLS/CompoundControl","SBIS3.CONTROLS/Mixins/PopupMixin","Lib/Mixins/LikeWindowMixin","WS.Data/Di","tmpl!SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel","Core/EventBus","js!SBIS3.CORE.FileStorageLoader","css!SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel"],function(e,t,n,o,a,i){"use strict";var l=e.extend([t,n],{_dotTplFn:a,$protected:{_options:{windowTitle:rk("Выберите шаблон вставки изображения:"),closeButton:!0,canMultiSelect:!1,corner:"tr",closeByExternalClick:!0,onlyTemplate:!1}},_selectedTemplate:void 0,_buttonHandlerInstance:void 0,_modifyOptions:function(e){return e=l.superclass._modifyOptions.apply(this,arguments),e.canMultiSelect=o.resolve("ImageUploader").canMultiSelect,e},$constructor:function(){var e=this;this._publish("onImageChange","onTemplateChange"),this._buttonHandlerInstance=this._buttonClickHandler.bind(this),this._buttonHandlerInstance=this._buttonClickHandler.bind(this),this._container.find(".controls-ImagePanel__Button").wsControl=function(){return e},this._container.find(".controls-ImagePanel__Button").on("click",this._buttonHandlerInstance),this._container.on("mousedown focus",this._blockFocusEvents)},getFileLoader:function(){return o.resolve("ImageUploader").getFileLoader(this.getParent())},_blockFocusEvents:function(e){var t=i.channel("WindowChangeChannel");e.preventDefault(),e.stopPropagation(),"mousedown"===e.type&&t.notify("onDocumentClick",e)},_onTargetChangeVisibility:function(){},_buttonClickHandler:function(e){var t=$(e.delegateTarget);this._selectedTemplate=t.attr("data-id"),this._options.onlyTemplate?(this._notify("onTemplateChange",this._selectedTemplate),this.hide()):this.getFileLoader().startFileLoad(t,4===this._selectedTemplate,this._options.imageFolder).addCallback(function(e){this._notify("onImageChange",this._selectedTemplate,e),this.hide()}.bind(this))},destroy:function(){this._container.find(".controls-ImagePanel__Button").off("click",this._buttonHandlerInstance),this._container.off("mousedown focus",this._blockFocusEvents),l.superclass.destroy.apply(this,arguments)}});return l});
//# sourceMappingURL=ImagePanel.tmpl.map
define("SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel",["SBIS3.CONTROLS/CompoundControl","SBIS3.CONTROLS/Mixins/PopupMixin","Lib/Mixins/LikeWindowMixin","WS.Data/Di","tmpl!SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel","Core/EventBus","js!SBIS3.CORE.FileStorageLoader","css!SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel"],function(e,t,n,o,i,a){"use strict";var s=4,l=e.extend([t,n],{_dotTplFn:i,$protected:{_options:{windowTitle:rk("Выберите шаблон вставки изображения:"),closeButton:true,canMultiSelect:false,corner:"tr",closeByExternalClick:true,onlyTemplate:false}},_selectedTemplate:void 0,_buttonHandlerInstance:void 0,_modifyOptions:function(e){return e=l.superclass._modifyOptions.apply(this,arguments),e.canMultiSelect=o.resolve("ImageUploader").canMultiSelect,e},$constructor:function(){var e=this;this._publish("onImageChange","onTemplateChange"),this._buttonHandlerInstance=this._buttonClickHandler.bind(this),this._buttonHandlerInstance=this._buttonClickHandler.bind(this),this._container.find(".controls-ImagePanel__Button").wsControl=function(){return e},this._container.find(".controls-ImagePanel__Button").on("click",this._buttonHandlerInstance),this._container.on("mousedown focus",this._blockFocusEvents)},getFileLoader:function(){return o.resolve("ImageUploader").getFileLoader(this.getParent())},_blockFocusEvents:function(e){var t=a.channel("WindowChangeChannel");if(e.preventDefault(),e.stopPropagation(),"mousedown"===e.type)t.notify("onDocumentClick",e)},_onTargetChangeVisibility:function(){},_buttonClickHandler:function(e){var t=$(e.delegateTarget);if(this._selectedTemplate=t.attr("data-id"),this._options.onlyTemplate)this._notify("onTemplateChange",this._selectedTemplate),this.hide();else this.getFileLoader().startFileLoad(t,this._selectedTemplate===s,this._options.imageFolder).addCallback(function(e){this._notify("onImageChange",this._selectedTemplate,e),this.hide()}.bind(this))},destroy:function(){this._container.find(".controls-ImagePanel__Button").off("click",this._buttonHandlerInstance),this._container.off("mousedown focus",this._blockFocusEvents),l.superclass.destroy.apply(this,arguments)}});return l});
//# sourceMappingURL=ImagePanel.js.map
define("SBIS3.CONTROLS/Menu/MenuButton",["js!WSControls/Buttons/MenuButton","css!SBIS3.CONTROLS/Button/Button","css!SBIS3.CONTROLS/Menu/MenuButton/MenuButton"],function(t){"use strict";var s=t.extend([],{_modifyOptions:function(){var t=s.superclass._modifyOptions.apply(this,arguments);return t.cssClassName+=" controls-Button",t.cssClassName+=" controls-Button-size__"+(!!t.size?t.size:"default"),t.cssClassName+=" controls-Button-color__"+(!!t.primary?"primary":"default"),t.cssClassName+=!!t.primary?" controls-Button__primary":"",t.pickerClassName+=" controls-MenuButton__Menu",t}});return s});
//# sourceMappingURL=MenuButton.js.map
define("SBIS3.CONTROLS/RichEditor/Components/Toolbar",["Core/core-merge","SBIS3.CONTROLS/RichEditor/Components/ToolbarBase","tmpl!SBIS3.CONTROLS/RichEditor/Components/Toolbar/RichEditorToolbar","SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/config","SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel","js!WSControls/Buttons/Button","js!WSControls/Buttons/ToggleButton","SBIS3.CONTROLS/Menu/MenuButton","SBIS3.CONTROLS/ComboBox","css!SBIS3.CONTROLS/RichEditor/Components/Toolbar/RichEditorToolbar","css!SBIS3.CONTROLS/Button/ToggleButton/resources/ToggleButton__square","css!SBIS3.CONTROLS/Menu/MenuIcon/MenuIcon"],function(t,e,n,i,o){"use strict";var s={toolbarHeight:32},a=e.extend({_dotTplFn:n,$protected:{_options:{items:void 0},_toggleToolbarButton:void 0,_itemsContainer:void 0,_doAnimate:false,_textFormats:{title:false,subTitle:false,additionalText:false},_textAlignState:{alignleft:false,alignright:false,aligncenter:false,alignjustify:false},_styleBox:void 0,_pickerOpenHandler:void 0,_fromFormatChange:false},init:function(){var t=this;if(a.superclass.init.call(this),this.getItems().getRecordById("style"))this._styleBox=this.getItemInstance("style"),t._pickerOpenHandler=function(){t._styleBox._picker._container.on("mousedown focus",t._blockFocusEvents)}.bind(t),t._styleBox.once("onPickerOpen",t._pickerOpenHandler)},$constructor:function(){this._toggleToolbarButton=this._container.find(".controls-RichEditorToolbar__toggleButton").bind("click",this.toggleToolbar.bind(this)),this._toggleToolbarButton.on("mousedown focus",this._blockFocusEvents)},_modifyOptions:function(t){return t.defaultConfig=i(),t=a.superclass._modifyOptions.apply(this,arguments),t},setExpanded:function(t){var e=this;if(!this._doAnimate)this._doAnimate=true,this._itemsContainer.animate({height:t?s.toolbarHeight:0},"fast",function(){e._doAnimate=false,e._container.toggleClass("controls-RichEditorToolbar__hide",!t)}),a.superclass.setExpanded.apply(this,arguments)},_undoRedoChangeHandler:function(t,e){this._buttonSetEnabled("redo",e.hasRedo),this._buttonSetEnabled("undo",e.hasUndo)},_nodeChangeHandler:function(t,e){this._buttonSetEnabled("unlink",$(e.element).closest("a").length)},_formatChangeHandler:function(t,e,n){switch(e.format){case"bold":case"italic":case"underline":case"strikethrough":case"blockquote":this._toggleState(n,e);break;case"alignleft":case"aligncenter":case"alignright":case"alignjustify":this._updateTextAlignButtons(n,e);break;case"title":case"subTitle":case"additionalText":this._updateTextFormat(n,e)}},_toggleState:function(t,e){var n=a.superclass._toggleState.apply(this,arguments);if(this.getItems().getRecordById(n.name)&&this.getItemInstance(n.name))this.getItemInstance(n.name).setChecked(n.state)},_updateTextAlignButtons:function(t,e){this._textAlignState[e.format]=t;var n=this.getItemInstance("align");if(n){var i="alignleft";for(var o in this._textAlignState)if(this._textAlignState[o])i=o;n.setIcon(n.getItems().getRecordById(i).get("icon"))}},_updateTextFormat:function(t,e){this._textFormats[e.format]=t;var n=this.getItemInstance("style");if(n){var i="mainText";for(var o in this._textFormats)if(this._textFormats[o])i=o;this._fromFormatChange=true,n.setSelectedKey(n.getItems().getRecordById(i).get("key")),this._fromFormatChange=false}},_buttonSetEnabled:function(t,e){this.getItemInstance(t).setEnabled(e)},_toggleContentSourceHandler:function(t,e){var n=this.getItemsInstances();if(e&&!this._buttonsState){this._buttonsState={};for(var i in n)if("source"!==n[i].getName())this._buttonsState[i]=n[i].isEnabled(),n[i].setEnabled(false)}else if(this._buttonsState){for(var o in this._buttonsState)if("source"!==n[o].getName())n[o].setEnabled(this._buttonsState[o]);this._buttonsState=void 0}},_prepareItems:function(){var e=a.superclass._prepareItems.apply(this,arguments);for(var n in e)if(e.hasOwnProperty(n))e[n]=t({cssClassName:"controls-RichEditorToolbar__item mce-",tabindex:-1,caption:"",idProperty:"key",displayProperty:"title"},e[n]);return e},_unbindEditor:function(){var t=this._options.linkedEditor;if(a.superclass._unbindEditor.apply(this,arguments),t)t.unsubscribe("onUndoRedoChange",this._handlersInstances.undoRedo),t.unsubscribe("onNodeChange",this._handlersInstances.node),t.unsubscribe("onToggleContentSource",this._handlersInstances.source)},_bindEditor:function(){var t=this._options.linkedEditor;if(a.superclass._bindEditor.apply(this,arguments),this._handlersInstances.undoRedo=this._undoRedoChangeHandler.bind(this),this._handlersInstances.node=this._nodeChangeHandler.bind(this),this._handlersInstances.source=this._toggleContentSourceHandler.bind(this),this.getItems().getRecordById("undo")&&this.getItems().getRecordById("redo"))t.subscribe("onUndoRedoChange",this._handlersInstances.undoRedo);if(this.getItems().getRecordById("unlink"))t.subscribe("onNodeChange",this._handlersInstances.node);if(this.getItems().getRecordById("source"))t.subscribe("onToggleContentSource",this._handlersInstances.source)},getImagePanel:function(t){var e=this;if(!this._imagePanel||this._imagePanel.isDestroyed())this._imagePanel=new o({parent:t,target:t.getContainer(),verticalAlign:{side:"top",offset:-10},horizontalAlign:{side:"right"},element:$("<div></div>"),imageFolder:e.getLinkedEditor()._options.imageFolder}),this._imagePanel.subscribe("onImageChange",function(t,n,i){e._insertImageTemplate(n,i)});return this._imagePanel},_setFontStyle:function(t){if(this._options.linkedEditor&&!this._fromFormatChange)this._options.linkedEditor.setFontStyle(t)},_setTextAlign:function(t){if(this._options.linkedEditor)this._options.linkedEditor.setTextAlign(t)},_setFontColor:function(t){if(this._options.linkedEditor)this._options.linkedEditor.setFontColor(t)},_insertLink:function(t,e){if(this._options.linkedEditor)this._options.linkedEditor.insertLink(t,e)},_insertSmile:function(t){if(this._options.linkedEditor)this._options.linkedEditor.insertSmile(t)},_pasteFromBufferWithStyles:function(t,e,n){if(this._options.linkedEditor)this._options.linkedEditor.pasteFromBufferWithStyles(t,e,n)},_toggleContentSource:function(){if(this._options.linkedEditor)this._options.linkedEditor.toggleContentSource()},_insertImageTemplate:function(t,e){if(this._options.linkedEditor)this._options.linkedEditor.insertImageTemplate(t,e)},_openImagePanel:function(t){this.getImagePanel(t).show()},destroy:function(){if(this._toggleToolbarButton.unbind("click"),this._toggleToolbarButton=null,this.getItems().getRecordById("style")&&this._pickerOpenHandler)this._styleBox.unsubscribe("onPickerOpen",this._pickerOpenHandler),this._pickerOpenHandler=null;a.superclass.destroy.apply(this,arguments),this._itemsContainer=null}});return a});
//# sourceMappingURL=Toolbar.js.map
define("tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/RichTextArea",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},r=function e(r,a,s,n,o){function l(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};o&&o.isSetts&&(p=o.fullContext||{});var g="string"==typeof s?s:"",h=void 0===i?void 0:i,u={id:[],def:void 0},m=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),x=this&&this.includedTemplates?this.includedTemplates:{},f=d.getMarkupGenerator(n);try{var v=f.joinElements([f.createTag("div",{class:"controls-RichEditor"},[f.createTag("div",{class:"controls-RichEditor__dataReview ws-basic-style "+d.wrapUndef(d.utils.escape(d.getter(r,["editorConfig","className"])))+d.wrapUndef(d.utils.escape(d.getter(r,["enabled"])?" ws-hidden":"")),tabindex:"1",style:d.wrapUndef(d.utils.escape(d.getter(r,["autoHeight"])&&d.getter(r,["minimalHeight"])?"min-height:"+d.getter(r,["minimalHeight"])+"px;":""))+" "+d.wrapUndef(d.utils.escape(d.getter(r,["autoHeight"])&&d.getter(r,["maximalHeight"])?"max-height:"+d.getter(r,["maximalHeight"])+"px;":""))},[f.createText(""+d.wrapUndef(d.Sanitize.apply(void 0,[!d.getter(r,["enabled"])&&d.getter(r,["text"])?d.getDecorators().sanitize.apply(void 0,[d.getter(r,["_prepareReviewContent"]).apply(r,[d.getter(r,["text"])])]):""])))],{},u,this),f.createTag("div",{class:"controls-RichEditor__placeholder"},[f.createText(""+d.wrapUndef(d.utils.escape(d.getter(r,["placeholder"]))))],{},u,this),f.createTag("div",{class:"controls-RichEditor__editorFrame ws-basic-style "+d.wrapUndef(d.utils.escape(d.getter(r,["editorConfig","className"])))+d.wrapUndef(d.utils.escape(d.getter(r,["enabled"])?"":" ws-hidden")),style:d.wrapUndef(d.utils.escape(d.getter(r,["autoHeight"])&&d.getter(r,["minimalHeight"])?"min-height:"+d.getter(r,["minimalHeight"])+"px;":""))+" "+d.wrapUndef(d.utils.escape(d.getter(r,["autoHeight"])&&d.getter(r,["maximalHeight"])?"max-height:"+d.getter(r,["maximalHeight"])+"px;":""))},[f.createText(""+d.wrapUndef(d.Sanitize.apply(void 0,[d.getter(r,["enabled"])&&d.getter(r,["text"])?d.getDecorators().sanitize.apply(void 0,[d.getter(r,["_prepareContent"]).apply(r,[d.getter(r,["_prepareReviewContent"]).apply(r,[d.getter(r,["text"])])])]):""])))],{},u,this),f.createTag("textarea",{class:"controls-RichEditor__fakeArea",tabindex:"0"},[],{},u,this),f.createTag("div",{class:"controls-RichEditor__sourceContainer ws-hidden"},[f.createTag("textarea",{class:"controls-RichEditor__sourceArea"},[],{},u,this)],{},u,this)],a,u,this)],g,u);u.def&&(v=f.chain(v,u,a),u=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/RichEditor/Components/RichTextArea/RichTextArea.tmpl",e,r)}return v||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/RichTextArea"}},r});
//# sourceMappingURL=RichTextArea.tmpl.map
define("SBIS3.CONTROLS/Utils/RichTextAreaUtil/RichTextAreaUtil",["Core/constants","Core/markup/ParserUtilities"],function(e,t){"use strict";return{markRichContentOnCopy:function(t){t=t.get(0);var i=e.browser;if(i.chrome||i.firefox||i.isIE)if(t.addEventListener)t.addEventListener("copy",this._markingRichContent,true),t.addEventListener("cut",this._markingRichContent,true);else $(t).on("cut copy",this._markingRichContent)},unmarkRichContentOnCopy:function(t){t=t.get(0);var i=e.browser;if(i.chrome||i.firefox||i.isIE)if(t.removeEventListener)t.removeEventListener("copy",this._markingRichContent,true),t.removeEventListener("cut",this._markingRichContent,true);else $(t).off("cut copy",this._markingRichContent)},_markingRichContent:function(t){var i=t.originalEvent?t.originalEvent:t,n=document.getSelection();if(n&&(i.currentTarget===n.focusNode||$.contains(i.currentTarget,n.focusNode))){var o=function(e,t){if(1===t.nodeType)if(e)t.setAttribute("data-ws-is-rich-text","true");else t.removeAttribute("data-ws-is-rich-text")},r=function(t,i){if(o(t,i),[].slice.call(i.childNodes).forEach(o.bind(null,t)),e.browser.firefox||e.browser.isIE)if(t){var n=$(i),r=[];if(["color","fontSize"].forEach(function(e){if(!i.style[e])i.style[e]=n.css(e),r.push(e)}),r.length)i.setAttribute("data-ws-back-styles",r.join(","))}else if((r=(i.getAttribute("data-ws-back-styles")||"").split(",")).length)r.forEach(function(e){i.style[e]=""})},s=e.browser.firefox?n.focusNode!==n.anchorNode?n.getRangeAt(0).commonAncestorContainer:3===n.focusNode.nodeType?n.focusNode.parentNode:n.focusNode:i.target;r(true,s),setTimeout(r.bind(null,false,s),1)}},unDecorateLinks:function(e){var i=t.parse(e),n=function(e){var t=0;if(e.childNodes)while(t<e.childNodes.length){var i=o(e.childNodes[t],"class");if("LinkDecorator__link"===i||"LinkDecorator"==i||"LinkDecorator__simpleLink"==i||"LinkDecorator__linkWrap"==i)r(e,t);else if("LinkDecorator__decoratedLink"==i)e.childNodes.splice(t,1);else if("LinkDecorator__wrap"==i)s(e,t);else n(e.childNodes[t]);t++}},o=function(e,t){if(e&&e.attributes&&e.attributes[t])return e.attributes[t].value;return false},r=function(e,i){var n=o(e.childNodes[i],"href"),r=new t.Node({childNodes:[],parentNode:e,text:n,nodeType:3});e.childNodes[i]=r},s=function(e,i){var n,r,s,c,a=0;while(a<e.childNodes[i].childNodes.length){if("LinkDecorator__linkWrap"==o(e.childNodes[i].childNodes[a],"class")){var d=e.childNodes[i].childNodes[a].childNodes[0];if(s=e.childNodes[i].childNodes[a],d&&"img"===d.nodeName)c=d;break}a++}n=(d?o(d,"alt"):o(s,"href"))||"",r=new t.Node({childNodes:[],parentNode:e,text:n,nodeType:3,nodeValue:n}),e.childNodes[i]=r};return n(i),i.innerHTML()}}});
//# sourceMappingURL=RichTextAreaUtil.js.map
define("SBIS3.CONTROLS/Utils/ImageUtil",["Core/Deferred","Core/constants"],function(e,t){"use strict";return{getDimensions:function(e){var t=document.documentElement,r=.05,n=200,i=t.clientWidth,o=t.clientHeight,s=function(e,t){return e>t?1:e/t},a=function(e){var t=s(e.docW,e.imgW),n=s(e.docH,e.imgH),i=t>=n,o=0;if(t!==n)if(o=i?n:t,o>r)o-=r;return o},c=function(e,t,r){if(r)t*=r;return t<n?n:t},u=this.getNaturalSizes(e),f=u.width,d=u.height,l=a({docW:i,docH:o,imgW:f,imgH:d});return{width:c(i,f,l),height:c(o,d,l)}},getNaturalSizes:function(e){var t=new Image;return t.src=e.src,{width:t.width||e.naturalWidth,height:t.height||e.naturalHeight}},reloadImage:function(r,n){var i,o,s=new e;if(s.addErrback(function(e){return e}),r instanceof jQuery)i=r;else if("string"===typeof r||r instanceof HTMLElement)i=$(r);else return;function a(e,r){var n=function(){s.callback(),e.removeEventListener("load",n),e.removeEventListener("error",i)},i=function(){s.errback(),e.removeEventListener("error",i),e.removeEventListener("load",n)},a=function(e){e.addEventListener("load",n),e.addEventListener("error",i)};if(t.browser.firefox||t.browser.isIE12){if(r.indexOf("id=")>-1)r=r.replace(/\?id=(.+?)&/,function(e,t){return e.replace(t,(new Date).getTime())});else r+=(r.indexOf("?")>-1?"&":"?")+"&t="+(new Date).getTime();a(e),e.setAttribute("src",r)}else(o=new XMLHttpRequest).open("GET",r,true),o.responseType="blob",o.onreadystatechange=function(){if(4===o.readyState)if(o.status>=200&&o.status<400)a(e),e.setAttribute("originsrc",r),e.setAttribute("src",t.browser.chrome?r:URL.createObjectURL(o.response));else i()},o.send(null)}function c(e){if(n=n||i.attr("originsrc")||i.attr("src"),!/^(data:|blob:)/.test(n))a(e,n)}for(var u=0,f=i.length;u<f;u++)c(i[u]);return s}}});
//# sourceMappingURL=ImageUtil.js.map
define("SBIS3.CONTROLS/Commands/CommandsButton",["js!WSControls/Buttons/MenuButton","css!SBIS3.CONTROLS/Commands/CommandsButton","css!SBIS3.CONTROLS/Button/IconButton/IconButton"],function(n){"use strict";var o=n.extend({_modifyOptions:function(n){if(n.cssClassName+=" controls-Menu__hide-menu-header controls-IconButton controls-CommandsButton",n.icon="sprite:icon-size icon-ExpandDown icon-primary",n.pickerClassName+=" controls-CommandsButton__picker",n.className+=" ",n.pickerConfig)n.pickerConfig.locationStrategy="bodyBounds";else n.pickerConfig={locationStrategy:"bodyBounds"};return o.superclass._modifyOptions.call(this,n)},_modifyPickerOptions:function(n){return n.horizontalAlign.side="right",n.closeButton=true,n},_setPickerContent:function(){o.superclass._setPickerContent.apply(this,arguments),$(".controls-PopupMixin__closeButton",this._picker.getContainer()).addClass("icon-size icon-Close icon-primary")}});return o});
//# sourceMappingURL=CommandsButton.js.map
define("tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Link","js!SBIS3.CONTROLS/Commands/CommandsButton"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={};n["js!SBIS3.CONTROLS/Link"]=e[1],n["js!SBIS3.CONTROLS/Commands/CommandsButton"]=e[2];var i=function e(i,o,a,s,r){function c(){}var l=0,m=void 0!==t&&t?t:arguments[arguments.length-1];void 0===m&&(eval("var thelpers = null;"),m=global.requirejs("View/Runner/tclosure"));var d={};r&&r.isSetts&&(d=r.fullContext||{});var u="string"==typeof a?a:"",h=void 0===n?void 0:n,p={id:[],def:void 0},g=m.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),C=this&&this.includedTemplates?this.includedTemplates:{},_=m.getMarkupGenerator(s);try{var I=_.joinElements([_.createTag("div",{class:"controls-Menu__Popup controls-ImageOptionsPanel"},[_.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"replaceButton",tooltip:global.rk("Заменить"),caption:global.rk("Заменить"),icon:"sprite:icon-16 icon-PicBtr icon-primary"},{class:"controls-ImageOptionsPanel__changeButton",name:"replaceButton",sbisname:"replaceButton"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},a,h,C,m.config,d),_.createControl("wsControl","ws:SBIS3.CONTROLS/Commands/CommandsButton",{items:[{id:"template",icon:"icon-16 icon-PicLeftT icon-primary",title:""+global.rk("Сменить шаблон"),visible:Boolean(m.getter(i,["templates"]))},{id:"size",icon:"sprite:icon-16 icon-FullScrin icon-primary",title:""+global.rk("Изменить размер")},{id:"edit",icon:"sprite:icon-16 icon-Edit icon-primary",title:""+global.rk("Редактировать"),visible:Boolean(m.getter(i,["imageUuid"]))},{id:"change",icon:"sprite:icon-16 icon-PicBtr icon-primary",title:""+global.rk("Заменить")},{id:"delete",icon:"sprite:icon-16 icon-Erase icon-error",title:""+global.rk("Удалить")}],name:"commandsButton",pickerClassName:"controls-ImageOptionsPanel__commandsButton__picker",esc:!1},{class:"controls-ImageOptionsPanel__commandsButton",name:"commandsButton",sbisname:"commandsButton"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g,internal:{__dirtyCheckingVars_1:m.getter(i,["templates"]),__dirtyCheckingVars_4:m.getter(i,["imageUuid"])}},a,h,C,m.config,d)],o,p,this)],u,p);p.def&&(I=_.chain(I,p,o),p=void 0)}catch(e){m.templateError("resources/SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel.tmpl",e,i)}return I||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel"}},i}),define("SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel",["SBIS3.CONTROLS/CompoundControl","SBIS3.CONTROLS/Mixins/PopupMixin","WS.Data/Di","tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel","SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel","js!SBIS3.CORE.FileStorageLoader","SBIS3.CONTROLS/Commands/CommandsButton","SBIS3.CONTROLS/Link","css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel","css!SBIS3.CONTROLS/Menu/Menu"],function(e,t,n,i,o){"use strict";var a=e.extend([t],{_dotTplFn:i,$protected:{_options:{imageUuid:null}},_replaceButton:void 0,_commandsButton:void 0,_imageViewer:void 0,_imagePanel:void 0,$constructor:function(){this._publish("onImageChange","onImageDelete","onImageSizeChange")},init:function(){a.superclass.init.call(this),this._replaceButton=this.getChildControlByName("replaceButton"),this._replaceButton.subscribe("onActivated",this._commandsButtonItemActivateHandler.bind(this,null,"change")),this._commandsButton=this.getChildControlByName("commandsButton"),this._commandsButton.subscribe("onMenuItemActivate",this._commandsButtonItemActivateHandler.bind(this));try{this._updateCommandsButtonItems()}catch(e){require(["SBIS3.CONTROLS/Menu/ContextMenu"],function(e){this._updateCommandsButtonItems()}.bind(this))}},setImageUuid:function(e){this._options.imageUuid=e||null,this._updateCommandsButtonItems()},getImageUuid:function(){return this._options.imageUuid},_updateCommandsButtonItems:function(){n.isRegistered("ImageEditor")&&this._commandsButton.getPicker()&&this._commandsButton.getItemInstance("edit").setVisible(!!this._options.imageUuid)},updateTemplate:function(){var e,t,n,i,o=function(){(i=this._commandsButton.getItemsInstances())&&i.template.setIcon("icon-16 icon-"+e+" icon-primary")}.bind(this);this._options.templates&&this._commandsButton&&((n=(t=this.getTarget()).attr("class"))?(e="PicRight","image-template-left"===n&&(e="PicLeftT")):e=t.parent(".image-template-center").length?"PicCenter":"PicLeft",this._commandsButton.getPicker()?o():this.subscribeOnceTo(this._commandsButton,"onPickerOpen",o))},recalcPosition:function(){a.superclass.recalcPosition.apply(this,arguments),this.updateTemplate();var e=this.getParent(),t=e.getContainer().parent(".controls-ScrollContainer__content"),n=t.length?t:e.getInputContainer(),i=n.offset().top,o=this._container.offset().top,s=n.height(),r=n.offset().left,c=this._container.offset().left;this._container.css("width",this.getTarget().width()),this._container.css("max-width",this.getParent().getInputContainer().width()-24),this._container.css("height","32px"),this._container.css("overflow-y","hidden"),this._container.hasClass("controls-popup-revert-vertical")?o+24<i-16&&this._container.css("top",i-24):o>i+s+4&&this._container.css("top",i+s-16),c<r&&this._container.css("left",r)},getFileLoader:function(){return n.resolve("ImageUploader").getFileLoader()},getEditor:function(){return n.resolve("ImageEditor")},getImagePanel:function(e){var t=this;return this._imagePanel||(this._imagePanel=new o({windowTitle:"Смена шаблона",onlyTemplate:!0,parent:e,target:e.getContainer(),verticalAlign:{side:"top"},horizontalAlign:{side:"left",offset:-100},element:$("<div></div>")}),this._imagePanel.subscribe("onTemplateChange",function(e,n){t._notify("onTemplateChange",n),t._imagePanel.hide()})),this._imagePanel},_openImagePanel:function(e){this.getImagePanel(e).show()},_commandsButtonItemActivateHandler:function(e,t){switch(t){case"delete":this._notify("onImageDelete"),this.hide();break;case"size":this._notify("onImageSizeChange"),this.hide();break;case"change":this.getFileLoader().startFileLoad(this._replaceButton._container,!1,this._options.imageFolder).addCallback(function(e){this._notify("onImageChange",e),this.hide()}.bind(this));break;case"template":this._openImagePanel(this);var n=window.getSelection?window.getSelection():null;n&&n.removeAllRanges();break;case"edit":var i=this,o=this._options.imageUuid;o&&this.getEditor().openFullScreenByFileId(o).addCallback(function(e){i._notify("onImageChange",e)}),this.hide()}}});return a});
//# sourceMappingURL=ImageOptionsPanel.tmpl.map
define("SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel",["SBIS3.CONTROLS/CompoundControl","SBIS3.CONTROLS/Mixins/PopupMixin","WS.Data/Di","tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel","SBIS3.CONTROLS/RichEditor/Components/Toolbar/resources/ImagePanel/ImagePanel","js!SBIS3.CORE.FileStorageLoader","SBIS3.CONTROLS/Commands/CommandsButton","SBIS3.CONTROLS/Link","css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel","css!SBIS3.CONTROLS/Menu/Menu"],function(t,e,i,n,o){"use strict";var s=24,a=4,c=32,r=t.extend([e],{_dotTplFn:n,$protected:{_options:{imageUuid:null}},_replaceButton:void 0,_commandsButton:void 0,_imageViewer:void 0,_imagePanel:void 0,$constructor:function(){this._publish("onImageChange","onImageDelete","onImageSizeChange")},init:function(){r.superclass.init.call(this),this._replaceButton=this.getChildControlByName("replaceButton"),this._replaceButton.subscribe("onActivated",this._commandsButtonItemActivateHandler.bind(this,null,"change")),this._commandsButton=this.getChildControlByName("commandsButton"),this._commandsButton.subscribe("onMenuItemActivate",this._commandsButtonItemActivateHandler.bind(this));try{this._updateCommandsButtonItems()}catch(t){require(["SBIS3.CONTROLS/Menu/ContextMenu"],function(t){this._updateCommandsButtonItems()}.bind(this))}},setImageUuid:function(t){this._options.imageUuid=t||null,this._updateCommandsButtonItems()},getImageUuid:function(){return this._options.imageUuid},_updateCommandsButtonItems:function(){if(i.isRegistered("ImageEditor")&&this._commandsButton.getPicker())this._commandsButton.getItemInstance("edit").setVisible(!!this._options.imageUuid)},updateTemplate:function(){var t,e,i,n,o=function(){if(n=this._commandsButton.getItemsInstances(),n)n.template.setIcon("icon-16 icon-"+t+" icon-primary")}.bind(this);if(this._options.templates&&this._commandsButton){if(e=this.getTarget(),i=e.attr("class"),i){if(t="PicRight","image-template-left"===i)t="PicLeftT"}else if(e.parent(".image-template-center").length)t="PicCenter";else t="PicLeft";if(this._commandsButton.getPicker())o();else this.subscribeOnceTo(this._commandsButton,"onPickerOpen",o)}},recalcPosition:function(){r.superclass.recalcPosition.apply(this,arguments),this.updateTemplate();var t=this.getParent(),e=t.getContainer().parent(".controls-ScrollContainer__content"),i=e.length?e:t.getInputContainer(),n=i.offset().top,o=this._container.offset().top,l=i.height(),m=i.offset().left,h=this._container.offset().left;if(this._container.css("width",this.getTarget().width()),this._container.css("max-width",this.getParent().getInputContainer().width()-s),this._container.css("height",c+"px"),this._container.css("overflow-y","hidden"),this._container.hasClass("controls-popup-revert-vertical")){if(o+s<n-c/2)this._container.css("top",n-s)}else if(o>n+l+a)this._container.css("top",n+l-c/2);if(h<m)this._container.css("left",m)},getFileLoader:function(){return i.resolve("ImageUploader").getFileLoader()},getEditor:function(){return i.resolve("ImageEditor")},getImagePanel:function(t){var e=this;if(!this._imagePanel)this._imagePanel=new o({windowTitle:"Смена шаблона",onlyTemplate:true,parent:t,target:t.getContainer(),verticalAlign:{side:"top"},horizontalAlign:{side:"left",offset:-100},element:$("<div></div>")}),this._imagePanel.subscribe("onTemplateChange",function(t,i){e._notify("onTemplateChange",i),e._imagePanel.hide()});return this._imagePanel},_openImagePanel:function(t){this.getImagePanel(t).show()},_commandsButtonItemActivateHandler:function(t,e){switch(e){case"delete":this._notify("onImageDelete"),this.hide();break;case"size":this._notify("onImageSizeChange"),this.hide();break;case"change":this.getFileLoader().startFileLoad(this._replaceButton._container,false,this._options.imageFolder).addCallback(function(t){this._notify("onImageChange",t),this.hide()}.bind(this));break;case"template":this._openImagePanel(this);var i=window.getSelection?window.getSelection():null;if(i)i.removeAllRanges();break;case"edit":var n=this,o=this._options.imageUuid;if(o)this.getEditor().openFullScreenByFileId(o).addCallback(function(t){n._notify("onImageChange",t)});this.hide()}}});return r});
//# sourceMappingURL=ImageOptionsPanel.js.map
define("tmpl!SBIS3.CONTROLS/TextArea/resources/inputField",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,l,n,s){function o(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var u="string"==typeof l?l:"",g=void 0===r?void 0:r,f={id:[],def:void 0},m=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),v=this&&this.includedTemplates?this.includedTemplates:{},x=p.getMarkupGenerator(n);try{var _=x.joinElements([x.createTag("textarea",{class:"controls-TextArea__field__size__"+p.wrapUndef(p.utils.escape(p.getter(i,["size"])?p.getter(i,["size"]):"m"))+"   controls-TextArea__field   controls-InputRender__field   controls-TextBox__field   js-controls-TextBox__field   ws-invisible",maxLength:""+p.wrapUndef(p.utils.escape(p.getter(i,["maxLength"]))),rows:""+p.wrapUndef(p.utils.escape(p.getter(i,["minLinesCount"])?p.getter(i,["minLinesCount"]):"")),required:"true"},[x.createText(""+p.wrapUndef(p.utils.escape(p.getter(i,["text"])?p.getter(i,["text"]):"")))],a,f,this),p.getter(i,["enabled"])&&p.getter(i,["placeholder"])?[x.createControl("resolver",p.getter(i,["compatiblePlaceholderTemplate"]),p.uniteScope(p.utils.escape(p.uniteScope(i,{parent:void 0,element:void 0})(p.plainMerge)),{}),{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},l,g,v,p.config,d,f)]:x.createText(""),x.createTag("div",{class:"controls-TextArea__view__size__"+p.wrapUndef(p.utils.escape(p.getter(i,["size"])?p.getter(i,["size"]):"m"))+"            "+p.wrapUndef(p.utils.escape(p.getter(i,["heightclassName"])?p.getter(i,["heightclassName"]):""))+"            "+p.wrapUndef(p.utils.escape(p.getter(i,["text"])?"":"controls-TextArea__view_empty"))+"            controls-TextArea__view"},[x.createText(""+p.wrapUndef(p.Sanitize.apply(void 0,[p.getDecorators().sanitize.apply(void 0,[p.getter(i,["text"])?p.getter(i,["wrapUrls"]).apply(i,[p.getter(i,["escapeHtml"]).apply(i,[p.getter(i,["text"])])]):p.getter(i,["placeholder"])&&p.getter(i,["enabled"])?p.getter(i,["placeholder"]):""])])))],a,f,this)],u,f);f.def&&(_=x.chain(_,f,a),f=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/TextArea/resources/inputField.tmpl",e,i)}return _||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/TextArea/resources/inputField"}},i});
//# sourceMappingURL=inputField.tmpl.map
define("tmpl!SBIS3.CONTROLS/TextArea/resources/compatiblePlaceholder",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={},o=function e(o,l,a,c,n){function i(){}var s=0,d=void 0!==r&&r?r:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};n&&n.isSetts&&(p=n.fullContext||{});var u="string"==typeof a?a:"",v=void 0===t?void 0:t,h={id:[],def:void 0},m=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},S=d.getMarkupGenerator(c);try{var T=S.joinElements([S.createTag("div",{class:"controls-TextArea__placeholder"+d.wrapUndef(d.utils.escape(d.getter(o,["_isSimplePlaceholder"])?" controls-InputRender__placeholder_simple":""))},[S.createTag("span",{class:"controls-TextArea__placeholder__overflow"},[S.createControl("resolver",d.getter(o,["placeholder"]),{},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},a,v,f,d.config,p,h)],{},h,this)],l,h,this)],u,h);h.def&&(T=S.chain(T,h,l),h=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/TextArea/resources/compatiblePlaceholder.tmpl",e,o)}return T||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/TextArea/resources/compatiblePlaceholder"}},o});
//# sourceMappingURL=compatiblePlaceholder.tmpl.map
define("SBIS3.CONTROLS/Utils/LinkWrapUtils",["Core/helpers/String/linkWrap"],function(i){return i});
//# sourceMappingURL=LinkWrapUtils.js.map
define("SBIS3.CONTROLS/TextArea",["Core/constants","SBIS3.CONTROLS/TextBox","tmpl!SBIS3.CONTROLS/TextArea/resources/inputField","tmpl!SBIS3.CONTROLS/TextArea/resources/compatiblePlaceholder","Core/helpers/String/escapeHtml","SBIS3.CONTROLS/Utils/LinkWrapUtils","Core/IoC","browser!js!Deprecated/Controls/FieldText/resources/Autosize-plugin","css!SBIS3.CONTROLS/TextArea/TextArea"],function(i,e,t,s,n,a,o){"use strict";function l(i,e){if(!e||e<i)e=i;return"controls-TextArea__field_minheight-"+i+" controls-TextArea__field_maxheight-"+e}function r(i,e){var t="";t=(t=(t=i.className.replace(/controls\-TextArea__field_maxheight\-[0-9]*/g,"")).replace(/controls\-TextArea__field_minheight\-[0-9]*/g,""))+" "+e,i.className=t}var h=e.extend({$protected:{_inputField:null,_cachedW:null,_cachedH:null,_pasteCommand:"insertText",_autoSizeInitialized:false,_myResize:false,_autoHeightInitialized:false,_options:{_isMultiline:true,_paddingClass:" controls-TextArea_padding",compatiblePlaceholderTemplate:s,textFieldWrapper:t,wrapUrls:a.wrapURLs,escapeHtml:n,placeholder:"",minLinesCount:0,maxLinesCount:0,newLineMode:"enter",breakClickBySelect:false,size:"auto"}},_modifyOptions:function(i){var e=h.superclass._modifyOptions.apply(this,arguments);if(i.autoResize&&i.autoResize.maxLinesCount)i.maxLinesCount=i.autoResize.maxLinesCount,o.resolve("ILogger").log("TextArea","Опция cfg.autoResize устарела - используйте maxLinesCount");if(i.autoResize&&i.autoResize.state&&!i.maxLinesCount)i.maxLinesCount=10;if(i.minLinesCount>i.maxLinesCount)i.maxLinesCount=i.minLinesCount;return e.heightclassName=l(i.minLinesCount,i.maxLinesCount),e.cssClassName+=" controls-TextArea",e},$constructor:function(){var e=this;this._inputField=$(".controls-TextArea__field",this._container),this._disabledWrapper=$(".controls-TextArea__view",this._container),this._drawText(this.getText()),this._inputField.bind("focusout",function(){var i=e._inputField.val();if(e._options.trim)i=i.trim();if(i!==e._options.text&&!(e._isEmptyValue(e._options.text)&&!i.length))e.setText(i)}),this._container.bind("keyup",function(i){e._keyUpBind(i)}),this._inputField.bind("keydown",function(t){if(!e._processNewLine(t)&&!t.altKey&&!t.ctrlKey&&t.which!==i.key.esc&&t.which!==i.key.tab)t.stopPropagation();e._myResize=true}),this._inputField.bind("paste",function(){if(e._pasteProcessing++,!e._myResize)e._myResize=true;window.setTimeout(function(){if(e._pasteProcessing--,!e._pasteProcessing)e.setText.call(e,e._formatText(e._inputField.val())),e._inputField.val(e._options.text)},100)})},init:function(){h.superclass.init.call(this);var i=this;if(this._options.maxLinesCount!=this._options.minLinesCount){if(this._inputField.data("minLinesCount",this._options.minLinesCount),this._inputField.data("maxLinesCount",this._options.maxLinesCount),this._cachedW=this._inputField.width(),this._cachedH=this._inputField.height(),this.isVisible())this._autosizeTextArea();this.subscribeTo(this,"onAfterVisibilityChange",function(i,e){if(e)this._autosizeOnShow()})}else{if(this._options.minLinesCount)this._inputField.attr("rows",parseInt(this._options.minLinesCount,10));this._removeAutoSizeDognail()}},show:function(){h.superclass.show.apply(this,arguments),this._autosizeOnShow()},_autosizeOnShow:function(){var i=this._inputField.width(),e=this._inputField.height();if(i!=this._cachedW||e!=this._cachedH)this._cachedW=i,this._cachedH=e,this._autosizeTextArea(true)},_getCompatiblePlaceholder:function(){if(!this._compatPlaceholder)this._compatPlaceholder=this._container.find(".controls-TextArea__placeholder");return this._compatPlaceholder},_removeAutoSizeDognail:function(){if(this.isEnabled())this._disabledWrapper.removeClass("ws-invisible").addClass("ws-hidden"),this._inputField.removeClass("ws-invisible").removeClass("ws-hidden");else this._inputField.removeClass("ws-hidden").addClass("ws-invisible");if(!this._options.text)this._disabledWrapper.empty(),this._disabledWrapper.removeClass("controls-TextArea__view_empty");var i=l(this._options.minLinesCount,this._options.maxLinesCount);r(this._inputField.get(0),i),this._disabledWrapper.addClass("controls-TextArea__view_init"),this._inputField.addClass("controls-TextArea__field_init"),this._autoHeightInitialized=true},_autosizeTextArea:function(i){var e=this;this._inputField.autosize({callback:function(){if(e._myResize)e._notifyOnSizeChanged(e,e),e._myResize=false},hard:i}),this._removeAutoSizeDognail()},_autoSizeRecalc:function(){this._inputField.trigger("autosize.resize")},_setEnabled:function(i){if(h.superclass._setEnabled.call(this,i),this._inputField.toggleClass("ws-invisible",!i),this._autoHeightInitialized)this._disabledWrapper.toggleClass("ws-hidden",i);else this._disabledWrapper.toggleClass("ws-invisible",i);this._updateDisabledWrapper()},setText:function(i){h.superclass.setText.call(this,i),this._updateDisabledWrapper()},_updateDisabledWrapper:function(){if(this._disabledWrapper&&!this.isEnabled()){var i=n(this.getText());this._disabledWrapper.html(a.wrapURLs(i))}},_processNewLine:function(e){if("shiftEnter"===this._options.newLineMode&&e.which===i.key.enter){if(e.shiftKey)e.stopPropagation();else e.preventDefault();return true}},_keyUpBind:function(e){var t=this._inputField.val(),s=e.which||e.keyCode,n=this._isEmptyValue(this._options.text)&&this._isEmptyValue(t);if(t!=this._options.text&&!n)this.setText.call(this,t);if(!this._processNewLine(e)&&(s===i.key.enter&&!e.ctrlKey||Array.indexOf([i.key.up,i.key.down],s)>=0))e.stopPropagation()},setMinLinesCount:function(i){var e=parseInt(i,10);this._options.minLinesCount=e,this._inputField.attr("rows",e),this._inputField.data("minLinesCount",i),this._inputField.trigger("autosize.resize");var t=l(e,this._options.maxLinesCount);r(this._inputField.get(0),t)},_drawText:function(i){if(this._inputField.val()!=i)this._inputField.val(i||""),this._autoSizeRecalc()},setMaxLength:function(i){h.superclass.setMaxLength.call(this,i),this._inputField.attr("maxlength",i)},_onResizeHandler:function(){this._autoSizeRecalc(),h.superclass._onResizeHandler.apply(this,arguments)},destroy:function(){this._inputField instanceof $&&this._inputField.trigger("autosize.destroy"),h.superclass.destroy.apply(this,arguments)}});return h});
//# sourceMappingURL=TextArea.js.map
define("tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Button/IconButton","js!SBIS3.CONTROLS/ComboBox","js!SBIS3.CONTROLS/TextArea"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={};o["js!SBIS3.CONTROLS/Button/IconButton"]=e[1],o["js!SBIS3.CONTROLS/ComboBox"]=e[2],o["js!SBIS3.CONTROLS/TextArea"]=e[3];var i=function e(i,a,r,n,l){function s(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var S="string"==typeof r?r:"",u=void 0===o?void 0:o,C={id:[],def:void 0},m=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),T=this&&this.includedTemplates?this.includedTemplates:{},h=p.getMarkupGenerator(n);try{var y=h.joinElements([h.createTag("div",{class:"controls-Menu__Popup controls-CodeSampleDialog  controls-FloatArea"},[h.createTag("div",{class:"controls-CodeSampleDialog__header"},[h.createTag("div",{class:"controls-CodeSampleDialog__title",title:""+p.wrapUndef(p.utils.escape(p.getter(i,["windowTitle"])))},[h.createText(""+p.wrapUndef(p.utils.escape(p.getter(i,["windowTitle"]))))],{},C,this),h.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{name:"Apply",icon:"sprite:icon-16 icon-Yes icon-done",activableByClick:"false"},{class:"controls-CodeSampleDialog__applyButton controls-IconButton__round-border controls-IconButton__round icon-size",name:"Apply",sbisname:"Apply"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},r,u,T,p.config,d)],{},C,this),h.createTag("div",{class:"controls-CodeSampleDialog__type_wrap"},[h.createControl("wsControl","ws:SBIS3.CONTROLS/ComboBox",{name:"Type",items:p.getter(i,["languages"]),idProperty:"key",displayProperty:"title",selectedKey:"markup",editable:"false",activableByClick:"false"},{class:"controls-CodeSampleDialog__type",name:"Type",sbisname:"Type"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},r,u,T,p.config,d)],{},C,this),h.createTag("div",{class:"controls-CodeSampleDialog__area_wrap"},[h.createControl("wsControl","ws:SBIS3.CONTROLS/TextArea",{name:"Area",minLinesCount:"10",maxLinesCount:"15",autoResize:"true"},{class:"controls-CodeSampleDialog__area",name:"Area",sbisname:"Area"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},r,u,T,p.config,d)],{},C,this)],a,C,this)],S,C);C.def&&(y=h.chain(y,C,a),C=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog.tmpl",e,i)}return y||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog"}},i}),define("SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog",["tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog","SBIS3.CONTROLS/CompoundControl","SBIS3.CONTROLS/Mixins/PopupMixin","Lib/Mixins/LikeWindowMixin","SBIS3.CONTROLS/TextArea","SBIS3.CONTROLS/ComboBox","SBIS3.CONTROLS/Button","SBIS3.CONTROLS/Button/IconButton","css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog"],function(e,t,o,i){"use strict";var a=t.extend([o,i],{_dotTplFn:e,$protected:{_options:{modal:!0,languages:[{key:"markup",title:"HTML/XML"},{key:"javascript",title:"JavaScript"},{key:"css",title:"CSS"},{key:"php",title:"PHP"}],windowTitle:"Вставка кода",closeButton:!0,closeByExternalClick:!0}},init:function(){var e=this;a.superclass.init.apply(this,arguments),this._okBtn=this.getChildControlByName("Apply"),this._area=this.getChildControlByName("Area"),this._type=this.getChildControlByName("Type"),this._okBtn.subscribe("onActivated",function(){e._notify("onApply",e._area.getText(),e._type.getSelectedKey()),e.hide()})},show:function(){a.superclass.show.apply(this,arguments),this._area.setActive(!0)},setText:function(e){this._area.setText(e)},$constructor:function(){this._publish("onApply")}});return a});
//# sourceMappingURL=CodeSampleDialog.tmpl.map
define("SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog",["tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog","SBIS3.CONTROLS/CompoundControl","SBIS3.CONTROLS/Mixins/PopupMixin","Lib/Mixins/LikeWindowMixin","SBIS3.CONTROLS/TextArea","SBIS3.CONTROLS/ComboBox","SBIS3.CONTROLS/Button","SBIS3.CONTROLS/Button/IconButton","css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog"],function(t,e,i,o){"use strict";var n=e.extend([i,o],{_dotTplFn:t,$protected:{_options:{modal:true,languages:[{key:"markup",title:"HTML/XML"},{key:"javascript",title:"JavaScript"},{key:"css",title:"CSS"},{key:"php",title:"PHP"}],windowTitle:"Вставка кода",closeButton:true,closeByExternalClick:true}},init:function(){var t=this;n.superclass.init.apply(this,arguments),this._okBtn=this.getChildControlByName("Apply"),this._area=this.getChildControlByName("Area"),this._type=this.getChildControlByName("Type"),this._okBtn.subscribe("onActivated",function(){t._notify("onApply",t._area.getText(),t._type.getSelectedKey()),t.hide()})},show:function(){n.superclass.show.apply(this,arguments),this._area.setActive(true)},setText:function(t){this._area.setText(t)},$constructor:function(){this._publish("onApply")}});return n});
//# sourceMappingURL=CodeSampleDialog.js.map
define("SBIS3.CONTROLS/RichEditor/Components/RichTextArea",["Core/UserConfig","Core/pathResolver","Core/Context","Core/Indicator","Core/core-clone","Core/CommandDispatcher","Core/constants","Core/Deferred","SBIS3.CONTROLS/TextBox/TextBoxBase","tmpl!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/RichTextArea","SBIS3.CONTROLS/Utils/RichTextAreaUtil/RichTextAreaUtil","SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/smiles","WS.Data/Di","SBIS3.CONTROLS/Utils/ImageUtil","Core/Sanitize","Core/helpers/String/escapeTagsFromStr","Core/helpers/String/escapeHtml","Core/helpers/String/linkWrap","SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/ImageOptionsPanel/ImageOptionsPanel","SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/CodeSampleDialog/CodeSampleDialog","Core/EventBus","css!SBIS3.CORE.RichContentStyles","i18n!SBIS3.CONTROLS/RichEditor","css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/RichTextArea"],function(t,e,i,n,o,s,a,r,l,d,c,h,f,u,g,p,_,m,y,C,b){"use strict";var v=["css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/tinymce/skins/lightgray/skin.min","css!SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/tinymce/skins/lightgray/content.inline.min","SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/tinymce/tinymce"],w={baseAreaWidth:768,defaultImagePercentSize:25,defaultPreviewerSize:768,imageOffset:40,defaultYoutubeHeight:300,minYoutubeHeight:214,defaultYoutubeWidth:430,minYoutubeWidth:350,dataReviewPaddings:8,styles:{title:{inline:"span",classes:"titleText"},subTitle:{inline:"span",classes:"subTitleText"},additionalText:{inline:"span",classes:"additionalText"}},colorsMap:{"rgb(0, 0, 0)":"black","rgb(255, 0, 0)":"red","rgb(0, 128, 0)":"green","rgb(0, 0, 255)":"blue","rgb(128, 0, 128)":"purple","rgb(128, 128, 128)":"grey"},ipadCoefficient:{top:{vertical:.65,horizontal:.39},bottom:{vertical:.7,horizontal:.44}}},T=l.extend({_dotTplFn:d,$protected:{_options:{templates:true,autoHeight:false,minimalHeight:200,maximalHeight:300,editorConfig:{className:null,plugins:"media,paste,lists,noneditable,codesample",inline:true,relative_urls:false,convert_urls:false,formats:w.styles,paste_webkit_styles:"color font-size text-align text-decoration width height max-width padding padding-left padding-right padding-top padding-bottom",paste_retain_style_properties:"color font-size text-align text-decoration width height max-width padding padding-left padding-right padding-top padding-bottom",paste_as_text:true,extended_valid_elements:"div[class|onclick|style|id],img[unselectable|class|src|alt|title|width|height|align|name|style]",body_class:"ws-basic-style",invalid_elements:"script",paste_data_images:false,paste_convert_word_fake_lists:false,statusbar:false,toolbar:false,menubar:false,browser_spellcheck:true,smart_paste:true,noneditable_noneditable_class:"controls-RichEditor__noneditable",object_resizing:false},placeholder:"",highlightLinks:false,imageFolder:"images",saveHistory:true,validateClass:void 0},_fakeArea:void 0,_tinyEditor:void 0,_lastHeight:void 0,_tinyReady:null,_readyContolDeffered:null,_saveBeforeWindowClose:null,_sourceArea:void 0,_sourceContainer:void 0,_tinyIsInit:false,_enabled:void 0,_typeInProcess:false,_clipboardText:void 0,_mouseIsPressed:false,_imageOptionsPanel:void 0,_lastReview:void 0,_fromTouch:false,_codeSampleDialog:void 0,_beforeFocusOutRng:void 0,_images:{},_lastActive:void 0,_lastSavedText:void 0},_modifyOptions:function(t){return t=T.superclass._modifyOptions.apply(this,arguments),t._prepareReviewContent=this._prepareReviewContent.bind({_options:t}),t._prepareContent=this._prepareContent.bind(this),t._sanitizeClasses=this._sanitizeClasses.bind(this),t},$constructor:function(){var t=this;this._publish("onInitEditor","onUndoRedoChange","onNodeChange","onFormatChange","onToggleContentSource"),this._sourceContainer=this._container.find(".controls-RichEditor__sourceContainer"),this._sourceArea=this._sourceContainer.find(".controls-RichEditor__sourceArea").bind("input",this._onChangeAreaValue.bind(this)),this._readyContolDeffered=(new r).addCallbacks(function(){this._notify("onReady")}.bind(this),function(t){return t}),this._dChildReady.push(this._readyContolDeffered),this._dataReview=this._container.find(".controls-RichEditor__dataReview"),this._tinyReady=new r,this._inputControl=this._container.find(".controls-RichEditor__editorFrame"),this._fakeArea=this._container.find(".controls-RichEditor__fakeArea"),this._initInputHeight(),this._options.editorConfig.selector="#"+this.getId()+" > .controls-RichEditor__editorFrame",this._options.editorConfig.fixed_toolbar_container="#"+this.getId()+" > .controls-RichEditor__fakeArea",this._options.editorConfig.setup=function(e){t._tinyEditor=e,t._bindEvents()},this.once("onInit",function(){if(c.markRichContentOnCopy(this._dataReview),!this.isEnabled())this._readyContolDeffered.callback();this._updateDataReview(this.getText())}.bind(this)),this._togglePlaceholder(),this._needDebounceTextChanged().addCallback(function(e){if(e)t._notifyTextChanged=t._notifyTextChanged.debounce(500)}),this._fillImages(false)},_needDebounceTextChanged:function(){var t=a.browser;if(t.isMobileAndroid)return r.success(true);if(!t.isWin10||"undefined"===typeof TouchEvent)return r.success(false);var e=window.screen.orientation||window.screen.mozOrientation||window.screen.msOrientation;if(!(e&&e.type&&e.lock&&e.unlock))return r.success(false);var i=new r;return e.lock(e.type).then(function(){e.unlock(),i.callback(true)},function(t){var e=t.message.toLowerCase();i.callback(false)}),i},addYouTubeVideo:function(t){if(!(t&&"string"===typeof t))return false;var e=p(t,[]),i=this._getYouTubeVideoId(e);if(i){var n=function(t){var i=e.match(t);return i?i[1]:null},o=n(/^(https?:)/i)||"",s=n(/\?(?:t|start)=([0-9]+)/i);return this.insertHtml(["<iframe",' width="'+w.defaultYoutubeWidth+'"',' height="'+w.defaultYoutubeHeight+'"',' style="min-width:'+w.minYoutubeWidth+"px; min-height:"+w.minYoutubeHeight+'px;"',' src="'+o+"//www.youtube.com/embed/"+i+(s?"?start="+s:"")+'"'," allowfullscreen",' frameborder="0" >',"</iframe>"].join("")),true}return false},_getYouTubeVideoId:function(t){var e=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return t.match(e)?RegExp.$1:false},setMinimalHeight:function(t){var e=this._options.editorConfig.inline?this._inputControl:$(this._tinyEditor.iframeElement);if(this._options.autoHeight&&"number"===typeof t){if(this._options.minimalHeight=t,this._options.minimalHeight){if(this._options.maximalHeight&&this._options.maximalHeight<t)this._options.maximalHeight=t}else this._options.minimalHeight="";e.css({"max-height":this._options.maximalHeight,"min-height":this._options.minimalHeight})}},setMaximalHeight:function(t){var e=this._options.editorConfig.inline?this._inputControl:$(this._tinyEditor.iframeElement);if(this._options.autoHeight&&"number"===typeof t){if(this._options.maximalHeight=t,this._options.maximalHeight){if(this._options.minimalHeight&&this._options.maximalHeight<this._options.minimalHeight)this._options.minimalHeight=t}else this._options.maximalHeight="";e.css({"max-height":this._options.maximalHeight,"min-height":this._options.minimalHeight})}},insertHtml:function(t){if("string"===typeof t&&this._tinyEditor)this._performByReady(function(){t=this._prepareContent(t);var e=this._tinyEditor,i=this._tinyLastRng;if(i)if((n=e.selection.getRng()).startContainer!==i.startContainer||n.startOffset!==i.startOffset||n.endContainer!==i.endContainer||n.endOffset!==i.endOffset)e.selection.setRng(i);if(e.insertContent(t),a.browser.firefox){var n=e.selection.getRng(),o=e.getBody();if(n.startContainer===o&&n.endContainer===o)this.setCursorToTheEnd()}if(a.browser.isMobilePlatform)this._notifyMobileInputFocus()}.bind(this))},getMinimalHeight:function(){if(this._options.autoHeight)return this._options.minimalHeight},getMaximalHeight:function(){if(this._options.autoHeight)return this._options.maximalHeight},setText:function(t){if(t!==this._curValue())this._drawText(t);this._setText(t)},setActive:function(t){var e=[].slice.call(arguments),i,n;if(this._lastActive=t,t&&this._needFocusOnActivated()&&this.isEnabled())this._performByReady(function(){if(this._lastActive){if(this._tinyEditor.focus(),a.browser.isMobileAndroid){var t=function(){this._inputControl[0].scrollIntoView(false),$(window).off("resize",t)}.bind(this);$(window).on("resize",t)}if(a.browser.isMobilePlatform)this._notifyMobileInputFocus()}}.bind(this));else{if(!t){if(i=this._tinyEditor,i)if(n=i.editorManager,n&&n.focusedEditor===i)n.focusedEditor=null;this._removeTinyFakeCaret()}if(a.browser.isMobilePlatform)b.globalChannel().notify("MobileInputFocusOut")}T.superclass.setActive.apply(this,e)},destroy:function(){if(a.$win.unbind("beforeunload",this._saveBeforeWindowClose),this.saveToHistory(this.getText()),c.unmarkRichContentOnCopy(this._dataReview),c.unmarkRichContentOnCopy(this._inputControl),this._tinyEditor&&this._tinyReady.isReady()){if(this._tinyEditor.destroy(),this._tinyEditor.theme){if(this._tinyEditor.theme.panel)this._tinyEditor.theme.panel._elmCache=null,this._tinyEditor.theme.panel.$el=null;this._tinyEditor.theme.panel=null}for(var t in this._tinyEditor)if(this._tinyEditor.hasOwnProperty(t))this._tinyEditor[t]=null;this._tinyEditor.destroyed=true}if(this._container.unbind("keydown keyup"),this._sourceArea.unbind("input"),this._tinyEditor=null,this._sourceContainer=null,this._fakeArea=null,this._sourceArea=null,this._dataReview=null,this._options.editorConfig.setup=null,!this._readyContolDeffered.isReady())this._readyContolDeffered.errback();if(this._inputControl.unbind("mouseup dblclick click mousedown touchstart scroll"),this._imageOptionsPanel)this._imageOptionsPanel.destroy();T.superclass.destroy.apply(this,arguments)},pasteFromBufferWithStyles:function(t,e,i){var o="undefined"===typeof i?true:i,s=this,a,r,l=function(t){t=t.replace(new RegExp("\x3c!--StartFragment--\x3e|\x3c!--EndFragment--\x3e|<html>|<body>|</html>|</body>","img"),"").trim(),r=s.getTinyEditor().fire("BeforePastePreProcess",{content:t,withStyles:true}),s.insertHtml(r.content),s._updateTextByTiny()},d=function(t){var e=t.clipboardData.getData?t.clipboardData.getData("text/html"):"";if(!e||!o)(e=t.clipboardData.getData?t.clipboardData.getData("text/plain"):window.clipboardData.getData("Text")).replace('data-ws-is-rich-text="true"',"");return l(e),a.close(),c(),t.stopPropagation(),t.preventDefault(),false},c=function(){if(document.removeEventListener("paste",d,true),"function"===typeof t)t()},h={destroy:function(){}},u=function(){n.hide(),require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(t){document.addEventListener("paste",d,true),a=t.showMessageDialog({className:"controls-RichEditor__pasteWithStyles-alert",message:rk("Нажмите CTRL + V для вставки текста из буфера обмена с сохранением стилей"),details:null,submitButton:{caption:rk("Отменить")},isModal:true,closeByExternalClick:true,opener:s},c)}),h.destroy()};if(n.show(),f.isRegistered("SBIS3.Plugin/Source/LocalService"))(h=f.resolve("SBIS3.Plugin/Source/LocalService",{endpoint:{address:"Clipboard-1.0.1.0",contract:"Clipboard"},options:{mode:"silent"}})).isReady().addCallback(function(){h.call("getContentType",{}).addCallback(function(e){h.call(("Text/Html"===e||"Text/Rtf"===e||"Html"===e||"Rtf"===e)&&o?"getHtml":"getText",{}).addCallback(function(e){if(n.hide(),l(e),"function"===typeof t)t();h.destroy()}).addErrback(function(){u()})}).addErrback(function(){u()})}).addErrback(function(){u()});else u()},saveToHistory:function(t){var e=this,i=false;if(t&&"string"===typeof t&&e._textChanged&&e._options.saveHistory&&this._lastSavedText!==t)this._lastSavedText=t,this.getHistory().addCallback(function(n){if(n.forEach(function(e){if(t===e)i=true}),!i)e._addToHistory(t)})},getHistory:function(){return t.getParamValues(this._getNameForHistory()).addCallback(function(t){if("string"===typeof t)t=[t];return t.forEach(function(e,i){t[i]=this._replaceCodesToSmile(e)},this),t}.bind(this))},_clearBrDataMceBogus:function(){$(this._tinyEditor.selection.getNode()).find('br[data-mce-bogus="1"]').remove()},setFontStyle:function(t){if(a.browser.firefox)this._clearBrDataMceBogus();["fontsize","forecolor","bold","italic","underline","strikethrough"].forEach(function(t){this._removeFormat(t)},this);for(var e in w.styles)if(t!==e)this._removeFormat(e);if("mainText"!==t)this._applyFormat(t,true);this._tinyEditor.execCommand(""),this._updateTextByTiny()},setFontColor:function(t){this._applyFormat("forecolor",t),this._tinyEditor.execCommand(""),this._updateTextByTiny()},setFontSize:function(t){if(this._removeFormat("fontsize"),t)this._tinyEditor.execCommand("FontSize",false,t+"px");this._tinyEditor.execCommand(""),this._updateTextByTiny()},getCurrentFormats:function(){var t=this._tinyEditor;if(t){var e=t.selection.getNode(),i=$(e),n=t.dom.getStyle(e,"color",true);return{fontsize:+t.dom.getStyle(e,"font-size",true).replace("px",""),color:w.colorsMap[n]||n,bold:!!i.closest("strong").length,italic:!!i.closest("em").length,underline:!!i.closest('span[style*="decoration: underline"]').length,strikethrough:!!i.closest('span[style*="decoration: line-through"]').length}}},getDefaultFormats:function(){if(!this._defaultFormats){var t=$(this._inputControl),e=t.css("color");this._defaultFormats={fontsize:+t.css("font-size").replace("px",""),color:w.colorsMap[e]||e}}return this._defaultFormats},applyFormats:function(t){var e=this.getDefaultFormats();for(var i in e)if(i in t&&t[i]==e[i])delete t[i];if(a.browser.firefox)this._clearBrDataMceBogus();if(t.id)this.setFontStyle(t.id);else{for(var n=0,o=["title","subTitle","additionalText","forecolor"];n<o.length;n++)this._removeFormat(o[n]);var s=this.getCurrentFormats(),r=t.fontsize&&t.fontsize===s.fontsize;if(!r)this.setFontSize(t.fontsize);for(var l,n=0,o=["bold","italic","underline","strikethrough"];n<o.length;n++){var d=o[n];if(d in t&&t[d]!==s[d])this.execCommand(d),l=t[d]||l}if(t.color&&t.color!==s.color)this.setFontColor(t.color),l=true;if(r&&!l)this.setFontSize(t.fontsize)}},getTinyEditor:function(){return this._tinyEditor},insertSmile:function(t){if(!this.isActive())this.setActive(true);if("string"===typeof t)if(h.forEach(function(e){if(e.key===t)return t=e,false}),"object"===typeof t)this.insertHtml(this._smileHtml(t))},execCommand:function(t){var e=this._tinyEditor,i,n;if("blockquote"===t)i=true,n="mceBlockQuote";else if("InsertOrderedList"===t||"InsertUnorderedList"===t)i=true;if(i&&!e.formatter.match(t)){var o=e.selection.getRng(),s=o.startContainer;if(o.endContainer===s)if(3===s.nodeType&&s.previousSibling&&1===s.previousSibling.nodeType){var r=o.startOffset,l=o.endOffset;e.dom.split(s.parentNode,s);var d=e.getDoc().createRange();d.setStart(s,r),d.setEnd(s,l),e.selection.setRng(d)}else if(a.browser.firefox&&1===s.nodeType&&o.collapsed&&!e.dom.isEmpty(s)){var c=e.dom.create(s.nodeName);c.innerHTML='<br data-mce-bogus="1" />',s.parentNode.insertBefore(c,s.nextSibling),e.selection.select(c,true)}}if(e.execCommand(n||t),(a.browser.firefox||a.browser.isIE)&&"undo"==t&&""==this._getTinyEditorValue())e.selection.select(e.getBody(),true)},insertLink:function(t,e){var n=this._tinyEditor,s=n.selection,r=o(s.getRng()),l=s.getNode(),d=n.dom.getParent(l,"a[href]"),c=d?n.dom.getAttrib(d,"href"):"",h=this,f=i.createContext(this),u=n.dom,g=/(https?|ftp|file):\/\//gi,p=440;require(["Lib/Control/Dialog/Dialog","Deprecated/Controls/FieldString/FieldString","SBIS3.CONTROLS/Button"],function(i,o,d){new i({title:rk("Вставить/редактировать ссылку"),disableActions:true,resizable:false,width:p,height:48,autoHeight:false,keepSize:false,opener:h,context:f,top:e&&e.offset().top+e.height()-$(window).scrollTop(),left:e&&e.offset().left-(p-e.width()),handlers:{onReady:function(){var t=this,e=$('<div class="controls-RichEditor__insertLinkHrefLabel">'+rk("Адрес")+"</div>"),i=$('<div class="controls-RichEditor__insertLinkButton"></div>'),p={target:"_blank",rel:null,class:null,title:null};this._fieldHref=$('<div class="controls-RichEditor__insertLinkHref"></div>'),this.getContainer().append(e).append(this._fieldHref),this._fieldHref=new o({value:c,parent:this,element:this._fieldHref,linkedContext:f,name:"fre_link_href"}),this._fieldHref.getContainer().on("keydown",function(t){if(t.which==a.key.enter)return t.preventDefault(),t.stopPropagation(),false}),this._titleBar.prepend($('<a href="javascript:void(0)"></a>').addClass("ws-float-close ws-float-close-right").click(function(){return t.close(),false})).append(i),new d({caption:rk("ОК"),primary:true,parent:this,handlers:{onActivated:function(){if(c=this.getParent()._fieldHref.getValue(),c&&-1===c.search(g))c="http://"+c;if(l&&"A"===l.nodeName&&l.className.indexOf("ws-focus-out")<0){if(c)u.setAttribs(l,{target:"_blank",href:_(c)});else n.execCommand("unlink");n.undoManager.add()}else if(c){if(p.href=c,n.selection.setRng(r),""===n.selection.getContent()||h._isOnlyTextSelected()&&a.browser.firefox){var e=s.getContent({format:"text"})||c;n.insertContent(u.createHTML("a",p,u.encode(e)))}else if(n.execCommand("mceInsertLink",false,p),a.browser.firefox){for(var i=n.selection.getRng(),o=i.endContainer;o&&"A"!==o.nodeName;o=o.parentNode);if(o)n.selection.select(o),n.selection.collapse(false),h.insertHtml("&#65279;"),n.selection.setRng(i)}n.undoManager.add()}t.close()}},element:i})},onAfterShow:function(){if(a.browser.isMobileIOS)this._fieldHref.getContainer().focus(),$(".controls-RichEditor__insertLinkButton").focus()},onAfterClose:function(){if("function"===typeof t)t()}}})})},setCursorToTheEnd:function(){var t=this._tinyEditor;if(t&&this.isActive()&&!this._sourceContainerIsActive()){var e=t.getBody();if(t.isGecko){var i=t.dom.getRoot();e=(e=i.childNodes[i.childNodes.length-1]).childNodes[e.childNodes.length-1]}t.selection.select(e,true),t.selection.collapse(false);try{t.lastRng=t.selection.getRng()}catch(t){}}},getInputContainer:function(){return this._inputControl},setTextAlign:function(t){var e=$(this._tinyEditor.selection.getNode()),i=e.find("ol,ul");if(!i.length)i=e.closest("ol,ul");if(i.length)i.css("list-style-position","alignjustify"===t||"alignleft"===t?"":"inside");this._tinyEditor.formatter.apply(t,true),this._updateTextByTiny()},toggleContentSource:function(t){var e=void 0!==t?!!t:this._sourceContainer.hasClass("ws-hidden"),i=this._tinyEditor.getContainer()?$(this._tinyEditor.getContainer()):this._inputControl,n=e?this._sourceArea:i;if(e)this._sourceContainer.css({height:i.outerHeight(),width:i.outerWidth()}),this._sourceArea.val(this.getText());this._sourceContainer.toggleClass("ws-hidden",!e),i.toggleClass("ws-hidden",e),this._notify("onToggleContentSource",e),n.focus()},insertImageTemplate:function(t,e){var i=a.browser.chrome?"&#xFEFF;{$caret}":"{$caret}",n,o,s;switch(t){case"1":n="image-template-left",s=i;break;case"2":o='<p class="controls-RichEditor__noneditable image-template-center">',s="</p>"+i;break;case"3":n="image-template-right",s=i;break;case"6":s=i;break;case"4":default:return}var r=w.defaultImagePercentSize;this._makeImgPreviewerUrl(e,r,null,false).addCallback(function(t){var i=e.id;if(i)this._images[i]=false;this._insertImg(t,r+"%",null,n,null,o,s,i)}.bind(this))},codeSample:function(t,e){if(this._beforeFocusOutRng)this._tinyEditor.selection.setRng(this._beforeFocusOutRng);var i=!this._tinyEditor.plugins.codesample.getCurrentCode(this._tinyEditor);if(this._tinyEditor.plugins.codesample.insertCodeSample(this._tinyEditor,e,t),i)this._tinyEditor.selection.collapse(),this.insertHtml("<p>{$caret}</p>");this._beforeFocusOutRng=false},getCodeSampleDialog:function(){var t=this;if(!this._codeSampleDialog)this._codeSampleDialog=new C({parent:this,element:$("<div></div>")}),this._codeSampleDialog.subscribe("onApply",function(e,i,n){t.codeSample(i,n)});return this._codeSampleDialog},showCodeSample:function(){var t=this._tinyEditor,e=this.getCodeSampleDialog();this._beforeFocusOutRng=t.selection.getRng(),e.setText(t.plugins.codesample.getCurrentCode(t)||""),e.show()},getImages:function(){return this._fillImages(true)},_updateTextByTiny:function(){if(this._tinyEditor&&this._tinyEditor.initialized&&this.isEnabled())this._setTrimmedText(this._getTinyEditorValue())},_setTrimmedText:function(t){this._setText(this._trimText(t))},_setText:function(t){if(t!==this.getText()){if(!this._isEmptyValue(t))this._textChanged=true;this._options.text=t,this._notify("onTextChange",t),this._notifyTextChanged(),this._updateDataReview(t),this.clearMark()}this._updateHeight(),this._togglePlaceholder(t)},_notifyTextChanged:function(){this._notifyOnPropertyChanged("text")},_showImagePropertiesDialog:function(t){var e=$(t),i=this._tinyEditor,n=this._inputControl.scrollTop(),o=this;require(["Lib/Control/Dialog/Dialog"],function(t){new t({name:"imagePropertiesDialog",template:"SBIS3.CONTROLS/RichEditor/Components/ImagePropertiesDialog",selectedImage:e,editorWidth:o._inputControl.width(),handlers:{onBeforeShow:function(){s.declareCommand(this,"saveImage",function(){var t=o._changeImgSize(e,this.getChildControlByName("imageWidth").getValue(),this.getChildControlByName("imageHeight").getValue(),"per"!==this.getChildControlByName("valueType").getValue());if(n)t.addCallback(function(){setTimeout(function(){o._inputControl.scrollTop(n)},1)});i.undoManager.add()}.bind(this))}}})})},_changeImgSize:function(t,e,i,n){var o={width:"",height:""},s=[];if(0<e)o.width=e+(n?"px":"%"),s.push("width:"+o.width);if(0<i&&n)o.height=i+"px",s.push("height:"+o.height);t.css(o),t.attr("data-mce-style",s.join("; "));var a=t.attr("src");return this._makeImgPreviewerUrl(t,0<e?e:null,0<i?i:null,n).addCallback(function(e){if(a!==e)t.attr("src",e),t.attr("data-mce-src",e)})},_smileHtml:function(t){return"&#"+t.code+";"},_bindEvents:function(){var t=this,e=this._tinyEditor;if(e.on("initContentBody",function(){var i=function(e,i){t._inputControl.bind(e,function(e){if("false"!==t._inputControl.attr("contenteditable")){var n=e.target;if("IMG"===n.nodeName&&-1===n.className.indexOf("mce-object-iframe"))i(e,n)}})};if(i("dblclick",function(e,i){t._showImagePropertiesDialog(i)}),i("mouseup touchstart",function(e,i){t._showImageOptionsPanel($(i))}),a.browser.isIE)i("mousedown",function(t){t.preventDefault()});if(i("click",function(){var t=window.getSelection?window.getSelection():null;if(t)t.removeAllRanges()}),this._inputControl.bind("scroll",function(t){if(this._imageOptionsPanel)this._imageOptionsPanel.hide()}.bind(this)),this._inputControl.on("keyup",function(t){if("Delete"===t.key||46===t.keyCode){var i=this._imageOptionsPanel;if(i&&i.isVisible()){var n=i.getTarget();if(n&&n.length){var o=e.selection;o.select(n[0]),o.getRng().deleteContents(),i.hide()}}}}.bind(this)),this._inputControl.attr("tabindex",1),!a.browser.firefox)this._inputControl.bind("mouseup",function(t){if(t.ctrlKey){var e="A"===t.target.nodeName?t.target:$(t.target).parent("a")[0];if(e&&"A"===e.nodeName&&e.href)window.open(e.href,"_blank")}});if(this._notifyOnSizeChanged(),!t._readyContolDeffered.isReady())t._tinyReady.addCallback(function(){t._readyContolDeffered.callback()});for(var n=1;n<=9;n++)e.shortcuts.remove("access+"+n);this._inputControl=$(e.getBody()),c.markRichContentOnCopy(this._inputControl),t._tinyReady.callback(),e.formatter.formatChanged("bold,italic,underline,strikethrough,alignleft,aligncenter,alignright,alignjustify,title,subTitle,additionalText,blockquote",function(e,i){t._notify("onFormatChange",i,e)}),t._notify("onInitEditor")}.bind(this)),e.on("onBeforePaste",function(e){if(t.addYouTubeVideo(e.content))return false}),e.on("Paste",function(i){t._clipboardText=i.clipboardData?i.clipboardData.getData(a.browser.isMobileIOS?"text/plain":"text"):window.clipboardData.getData("text"),e.plugins.paste.clipboard.pasteFormat="html"}),e.on("BeforePastePreProcess",function(e){var i=a.browser.isIE12&&a.browser.isWin10?false:-1!==e.content.indexOf('data-ws-is-rich-text="true"');if(e.content=e.content.replace('data-ws-is-rich-text="true"',""),e.content=t._prepareContent(e.content),e.content=e.content.replace(/&quot;TensorFont Regular&quot;/gi,"'TensorFont Regular'"),!t._mouseIsPressed&&t._options.editorConfig.paste_as_text)e.content=t._options._sanitizeClasses(e.content,false);if(t._mouseIsPressed=false,e.withStyles)return e;if(!i)if(t._options.editorConfig.paste_as_text)if(false!==t._clipboardText)e.content=t._getTextBeforePaste()}),e.on("PastePostProcess",function(t){var e=t.node,i=$(e),n=i.find("img:not(.ws-fre__smile)");if(i.find('[unselectable ="on"]').attr("data-mce-resize","false"),n.length){if(/data:image/gi.test(e.innerHTML))return false;var o,s,a,r;o=this._inputControl.width()-w.imageOffset;for(var l=0;l<n.length;l++)if(r=u.getNaturalSizes(n[l]),a=$(n[l]).width(),s=a>o?o:0===a?r.width>o?o:r.width:a,!n[l].style||(!n[l].style.width||n[l].style.width.indexOf("%")<0)&&r.width>r.height)$(n[l]).css({width:s,height:"auto"})}var d=e.innerHTML;d=d.replace(/([^>])\n(?!<)/gi,"$1<br />"),d=this._replaceWhitespaces(d),e.innerHTML=d}.bind(this)),this._options.editorConfig.browser_spellcheck){var i=function(){setTimeout(function(){a.$doc.one("selectionchange",n)},1),setTimeout(function(){a.$doc.off("selectionchange",n)},12e4)}.bind(this),n=function(){this._updateTextByTiny()}.bind(this);e.on("mousedown",function(t){if(2===t.button)if(t.currentTarget===this._inputControl[0]&&(t.target===t.currentTarget||$.contains(t.currentTarget,t.target)))if(a.$doc.off("selectionchange",n),a.browser.safari||a.browser.chrome&&!a.browser.yandex)setTimeout(function(){a.$doc.one("selectionchange",i)},1);else a.$doc.one("selectionchange",i)}.bind(this))}if(e.on("drop",function(e){if(t._clipboardText=false,!t._mouseIsPressed&&!a.browser.isIE&&(!e.targetClone||!$(e.targetClone).hasClass("controls-RichEditor__noneditable")))e.preventDefault()}),e.on("dragstart",function(t){if(t.target&&$(t.target).hasClass("mce-object-iframe"))t.preventDefault()}),a.browser.isMobileIOS||a.browser.isMobileAndroid)this._inputControl.on("input",function(){t._updateTextByTiny()});this._container.bind("keydown",function(t){if(!(t.which===a.key.enter&&t.ctrlKey)&&t.which!==a.key.esc)t.stopPropagation()}),this._container.bind("keyup",function(t){if(t.which===a.key.enter&&!t.ctrlKey||t.which===a.key.up||t.which===a.key.down)t.stopPropagation(),t.preventDefault()}),e.on("keyup",function(e){if(t._typeInProcess=false,!(e.keyCode===a.key.enter&&e.ctrlKey))t._updateTextByTiny()}),e.on("keydown",function(e){if(t._typeInProcess=true,e.which===a.key.pageDown||e.which===a.key.pageUp||e.which===a.key.insert&&!e.shiftKey&&!e.ctrlKey)e.stopPropagation(),e.preventDefault();if(e.keyCode==a.key.tab){var i=t.getParent().getNextActiveChildControl(e.shiftKey);if(i)t._fakeArea.focus(),i.setActive(true,e.shiftKey);return e.stopImmediatePropagation(),e.preventDefault(),t._typeInProcess=false,false}else if(e.ctrlKey||e.which>=a.key.f1&&e.which<=a.key.f12){if(e.which===a.key.enter)e.preventDefault();t._typeInProcess=false}t._updateHeight()});var o=function(){var t=e.selection.getNode();if("A"===t.nodeName&&t.hasChildNodes()&&!t.children.length){var i=t.href,n=t.innerHTML,o=n===i,s,a;if(!o)if(s=i.substring(0,i.indexOf("://")+3),n=s+n,o=i===n,!o)o=i===n+(a="/");if(o){if(!t.dataset)t.dataset={};t.dataset.wsPrev=JSON.stringify({url:i,prefix:s||"",suffix:a||""})}}},s=function(){var t=e.selection.getNode();if("A"===t.nodeName&&t.dataset&&"wsPrev"in t.dataset){if(t.hasChildNodes()&&!t.children.length){var i=JSON.parse(t.dataset.wsPrev),n=t.href,o=t.innerHTML;if(i.url===n)n=i.prefix+o+i.suffix,t.href=n,t.setAttribute("data-mce-href",n)}delete t.dataset.wsPrev}};if(a.browser.chrome)e.on("keydown",function(t){if("Backspace"===t.key){var i=this._tinyEditor.selection;if(i.isCollapsed()){var n=i.getRng(),o=n.startContainer,s=n.startOffset;if(3===o.nodeType&&0<s){var a=o.nodeValue;if(65279===a.charCodeAt(s-1)){o.nodeValue=1<a.length?a.substring(0,s-1)+a.substring(s):"";var r=e.dom.createRng();r.setStart(o,s-1),r.setEnd(o,s-1),i.setRng(r)}}}}}.bind(this));if(e.on("keydown",function(e){if(e.key&&1<e.key.length)o(),setTimeout(function(){if(!t.isDestroyed())s()},1)}),e.on("keypress",function(i){if(o(),!i.ctrlKey&&!(i.metaKey&&a.browser.isMacOSDesktop)&&0!==i.charCode)if(!e.selection.isCollapsed())if(e.selection.getContent()==t._getTinyEditorValue())e.bodyElement.innerHTML="";setTimeout(function(){if(!t.isDestroyed())s();t._togglePlaceholder(t._getTinyEditorValue())},1)}),e.on("change",function(e){t._updateTextByTiny()}),e.on("cut",function(e){setTimeout(function(){t._updateTextByTiny()},1)}),e.on("resizeEditor",function(){t._notifyOnSizeChanged()}),e.on("undo",function(){t._updateTextByTiny()}),e.on("redo",function(){t._updateTextByTiny()}),!a.browser.isMobileIOS&&!a.browser.isMobileAndroid)e.on("mousedown",function(e){t._mouseIsPressed=true}),e.on("mouseup",function(e){t._mouseIsPressed=false}),e.on("focusout",function(i){if(t._mouseIsPressed)e.editorManager.activeEditor=false;t._mouseIsPressed=false});this._saveBeforeWindowClose=function(){this.saveToHistory(this.getText())}.bind(this),a.$win.bind("beforeunload",this._saveBeforeWindowClose),e.on("TypingUndo AddUndo ClearUndos redo undo",function(){t._notify("onUndoRedoChange",{hasRedo:t._tinyEditor.undoManager.hasRedo(),hasUndo:t._tinyEditor.undoManager.hasUndo()})}),e.on("NodeChange",function(e){t._notify("onNodeChange",e)}),e.on("focus focusin",function(e){t._tinyLastRng=null}),e.on("blur focusout",function(i){var n=e.selection.getRng();if(!(n.collapsed&&0===n.startOffset&&n.startContainer===e.getBody()))t._tinyLastRng=n}),e.on("focusin",function(e){if(t._fromTouch)t._notifyMobileInputFocus()}),e.on("focusout",function(e){if(t._fromTouch)b.globalChannel().notify("MobileInputFocusOut"),t._fromTouch=false}),e.on("touchstart",function(e){t._fromTouch=true})},_notifyMobileInputFocus:function(){b.globalChannel().notify("MobileInputFocus")},_showImageOptionsPanel:function(t){this._getImageOptionsPanel(t).show()},_changeImageTemplate:function(t,e){t.removeClass();var i=t.parent(),n=i.hasClass("image-template-center");if(n&&"2"!=e)t.unwrap();switch(e){case"1":t.addClass("image-template-left");break;case"2":var o=t[0].style.width||t.width()+"px",s='<p class="controls-RichEditor__noneditable image-template-center" contenteditable="false">'+"<img"+' src="'+t.attr("src")+'"'+' style="width:'+(o?o:w.defaultImagePercentSize+"%")+'"'+' alt="'+t.attr("alt")+'"'+' data-img-uuid="'+t.attr("data-img-uuid")+'"'+"></img>"+"</p>";this._tinyEditor.dom.replace($(s)[0],(n?i:t)[0],false);break;case"3":t.addClass("image-template-right")}this._updateTextByTiny()},_getImageOptionsPanel:function(t){var e=this,i=this.checkImageUuid(t[0]);if(!this._imageOptionsPanel)this._imageOptionsPanel=new y({templates:e._options.templates,parent:e,target:t,imageUuid:i,targetPart:true,corner:"bl",closeByExternalClick:true,element:$("<div></div>"),imageFolder:e._options.imageFolder,verticalAlign:{side:"top"},horizontalAlign:{side:"left"}}),this._imageOptionsPanel.subscribe("onImageChange",function(t,i){var n=this.getTarget(),o=n[0].style.width||n.width()+"px",s="%"!==o.charAt(o.length-1);e._makeImgPreviewerUrl(i,+o.substring(0,o.length-(s?2:1)),null,s).addCallback(function(t){n.attr("src",t),n.attr("data-mce-src",t);var o=i.id;if(n.attr("data-img-uuid",o),n.attr("alt",o),e._tinyEditor.undoManager.add(),e._updateTextByTiny(),o)e._images[o]=false})}),this._imageOptionsPanel.subscribe("onImageDelete",function(){var t=this.getTarget(),i=t.parent()[0];t.remove(),e._tinyEditor.selection.select(i,false),e._tinyEditor.selection.collapse(),e._tinyEditor.undoManager.add(),e._updateTextByTiny()}),this._imageOptionsPanel.subscribe("onTemplateChange",function(t,i){e._changeImageTemplate(this.getTarget(),i)}),this._imageOptionsPanel.subscribe("onImageSizeChange",function(){e._showImagePropertiesDialog(this.getTarget())});else this._imageOptionsPanel.setTarget(t),this._imageOptionsPanel.setImageUuid(i);return this._imageOptionsPanel},checkImageUuid:function(t){for(var e=[/(?:\?|&)id=([0-9a-f]{8}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{12})(?:&|$)/i,/\/disk\/api\/v[0-9\.]+\/([0-9a-f]{8}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{12})(?:_|$)/i],i=t.src,n=0;n<e.length;n++){var o=i.match(e[n]);if(o)return o[1]}},_makeImgPreviewerUrl:function(t,e,i,n){if(!(0<e))throw new Error("Size is not specified");var o=new r,s;if(t.jquery){if(s=t.attr("src"),!/\/disk\/api\/v[0-9\.]+\//i.test(s))return o.callback(s),o;s=s.replace(/^\/previewer(?:\/r\/[0-9]+\/[0-9]+)?/i,"")}else s=t.filePath||t.url;if(o=o.addCallback(function(t){return"/previewer"+(t?"/r/"+t+"/"+t:"")+s}),0<e){var a=n?e:e*w.baseAreaWidth/100;if(0<i)o.callback(Math.round(e<i?a*i/e:a));else if(!t.jquery&&0<t.width&&0<t.height)o.callback(Math.round(t.width<t.height?a*t.height/t.width:a));else{var l=new Image;l.onload=function(){o.callback(Math.round(l.width<l.height?a*l.height/l.width:a))},l.onerror=function(){o.callback(w.defaultPreviewerSize)},l.src=s}}else o.callback(w.defaultPreviewerSize);return o},_replaceWhitespaces:function(t){var e="",i=null,n=false;if("string"!==typeof t)return t;for(var o=0;o<t.length;o++)if(" "!==t[o])e+=t[o];else{if("&nbsp;"===t.substr(o-6,6))n=false;else if(0===o||"\n"===t[o-1]||">"===t[o-1])n=true;else if(i!==o-1)n=" "===t[o+1];else n=!n;if(n)e+="&nbsp;";else e+=" ";i=o}return e},_performByReady:function(t){if(this._tinyReady.isReady())t();else this._tinyReady.addCallback(t)},_getElementToFocus:function(){return this._inputControl||false},_setEnabled:function(t){if(this._enabled=t,!this._tinyReady.isReady()&&t)this._tinyReady.addCallback(function(){this._applyEnabledState(this._enabled)}.bind(this)),this._initTiny();else this._applyEnabledState(t)},_applyEnabledState:function(t){var e=this._tinyEditor?this._tinyEditor.getContainer()?$(this._tinyEditor.getContainer()):this._inputControl:this._inputControl;if(this._dataReview){if(this._options.autoHeight)this._dataReview.css({"max-height":this._options.maximalHeight?this._options.maximalHeight:"","min-height":this._options.minimalHeight});else this._dataReview.height(this._container.height()-w.dataReviewPaddings);this._updateDataReview(this.getText()||""),this._dataReview.toggleClass("ws-hidden",t)}if(e.toggleClass("ws-hidden",!t),this._inputControl.toggleClass("ws-hidden",!t),this._notifyOnSizeChanged(),t&&!this.isActive())setTimeout(this._removeTinyFakeCaret.bind(this),1);T.superclass._setEnabled.apply(this,arguments)},_requireTinyMCE:function(){var t=false,e=new r;if(v.forEach(function(e){if(!require.defined(e))t=true}),t)require(v,function(){e.callback()});else e.callback();return e},_initTiny:function(){var t=this;if(!this._tinyEditor&&!this._tinyIsInit)this._tinyIsInit=true,this._requireTinyMCE().addCallback(function(){tinyMCE.baseURL="SBIS3.CONTROLS/RichEditor/Components/RichTextArea/resources/tinymce",tinyMCE.init(t._options.editorConfig)});this._tinyReady.addCallback(function(){var t=this._tinyEditor,e=this._prepareContent(this.getText())||"";if(t.setContent(e),e)this.setCursorToTheEnd(),this._togglePlaceholder(e);t.undoManager.clear(),t.undoManager.add()}.bind(this))},_getTinyEditorValue:function(){var t=this._tinyEditor.getContent({no_events:true});return this._tinyEditor.fire("PostProcess",{content:t}).content},_trimText:function(t){if(!t)return"";var e={regShiftLine1:/<p>[\s\xA0]*(?:<br[^<>]*>)+[\s\xA0]*/gi,regShiftLine2:/[\s\xA0]*(?:<br[^<>]*>)+[\s\xA0]*<\x2Fp>/gi,beginReg:/^<p>[\s\xA0]*<\x2Fp>[\s\xA0]*/i,endReg:/[\s\xA0]*<p>[\s\xA0]*<\x2Fp>$/i},i={regShiftLine1:"<p>",regShiftLine2:"</p>"};t=(t=this._removeEmptyTags(t)).replace(/&nbsp;/gi,String.fromCharCode(160));for(var n in e){for(var o=-1,s=t.length;s!==o;o=s,s=t.length)t=t.replace(e[n],i[n]||"");if(t=t.replace(/^[\s\xA0]+|[\s\xA0]+$/g,""),!t)return""}return t=t.replace(/\xA0/gi,"&nbsp;"),t},_removeEmptyTags:function(t){var e=$("<div>"+t+"</div>");while(e.find(":empty:not(img, iframe, br)").length)e.find(":empty:not(img, iframe)").remove();return e.html()},_curValue:function(){return this._tinyEditor&&this._tinyEditor.initialized&&this.isEnabled()?this._getTinyEditorValue():this.getText()},_prepareContent:function(t){return t="string"===typeof t?t:null===t||void 0===t?"":t+"",c.unDecorateLinks(t)},_togglePlaceholder:function(t){var e=t||this.getText();this.getContainer().toggleClass("controls-RichEditor__empty",(""===e||void 0===e||null===e)&&this._inputControl.html().indexOf("</li>")<0&&this._inputControl.html().indexOf("<p>&nbsp;")<0&&this._inputControl.html().indexOf("<p><br>&nbsp;")<0&&this._inputControl.html().indexOf("<blockquote>")<0)},_replaceSmilesToCode:function(t){return h.forEach(function(e){t=t.replace(new RegExp(String.fromCodePoint(e.code),"gi"),e.title)}),t},_replaceCodesToSmile:function(t){return h.forEach(function(e){t=t.replace(new RegExp(e.title,"gi"),String.fromCodePoint(e.code))}),t},_removeTinyFakeCaret:function(){var t=this._tinyEditor;if(t){var e=t._selectionOverrides;if(e)e.hideFakeCaret()}},_addToHistory:function(e){return t.setParamValue(this._getNameForHistory(),this._replaceSmilesToCode(e))},_getNameForHistory:function(){return this.getName().replace("/","#")+"ИсторияИзменений"},_insertImg:function(t,e,i,n,o,s,a,l){var d=new r,c=this;return $('<img src="'+t+'"></img>').css({visibility:"hidden",position:"absolute",bottom:0,left:0}).on("load",function(){c.insertHtml((s||"")+"<img"+(n?' class="'+n+'"':"")+' src="'+t+'"'+(e||i?' style="'+(e?"width:"+e+";":"")+(i?"height:"+i+";":"")+'"':"")+' data-img-uuid="'+l+'" alt="'+l+'"'+"></img>"+(a||"")),d.callback()}),d},_onChangeAreaValue:function(){if(this._sourceContainerIsActive())this.setText(this._sourceArea.val())},_sourceContainerIsActive:function(){return!this._sourceContainer.hasClass("ws-hidden")},_updateHeight:function(){var t;if(this.isVisible())if(t=this._container.height(),t!==this._lastHeight)this._lastHeight=t,this._notifyOnSizeChanged()},_elementIsUnderKeyboard:function(t,e){var i=t.getBoundingClientRect(),n=window.innerHeight>window.innerWidth?w.ipadCoefficient[e].vertical:w.ipadCoefficient[e].horizontal;return a.browser.isMobileIOS&&this.isEnabled()&&i[e]>window.innerHeight*n},_updateDataReview:function(t){if(this._dataReview&&!this.isEnabled()&&(null==this._lastReview||this._lastReview!==t))this._lastReview=t||"",this._dataReview.html(this._prepareReviewContent(t))},_prepareReviewContent:function(t){if(t&&"<"!==t[0])t="<p>"+t.replace(/\n/gi,"<br/>")+"</p>";return t=this._options._sanitizeClasses(t,true),this._options.highlightLinks?m.wrapURLs(m.wrapFiles(t),true):t},_drawText:function(t){var e=true;if(t=this._prepareContent(t),!this._typeInProcess&&t!=this._curValue()){if(t&&"<"!==t[0])t="<p>"+t.replace(/\n/gi,"<br/>")+"</p>",e=false;if(t=this._replaceWhitespaces(t),this.isEnabled()&&this._tinyReady.isReady()){if(this._tinyEditor.setContent(t,e?void 0:{format:"raw"}),this._tinyEditor.undoManager.add(),t)this.setCursorToTheEnd()}else if(t=t||"",this._tinyReady.isReady())this._tinyEditor.setContent(t);else this._inputControl.html(this._options._sanitizeClasses(t,true))}},_applyFormat:function(t,e){this._tinyEditor.focus(),this._tinyEditor.formatter.apply(t,{value:e}),this._tinyEditor.nodeChanged(),this._tinyEditor.undoManager.add()},_removeFormat:function(t,e){this._tinyEditor.focus(),this._tinyEditor.formatter.remove(t,{value:e},null,true),this._tinyEditor.nodeChanged()},_focusOutHandler:function(){this.saveToHistory(this.getText()),T.superclass._focusOutHandler.apply(this,arguments)},_initInputHeight:function(){if(!this._options.autoHeight)this._inputControl.css("height",this._container.height())},_isOnlyTextSelected:function(){var t=this._tinyEditor.selection.getContent();return-1===t.indexOf("<")||-1!==t.indexOf("href=")&&/^<a [^>]+>[^<]+<\/a>$/.test(t)},_sanitizeClasses:function(t,e){var i=this;return g(t,{validNodes:{img:e},validAttributes:{class:function(t,e){var i=this._options&&"function"===typeof this._options.validateClass,n=t.attributes[e].value,o=n.split(" "),s=["titleText","subTitleText","additionalText","controls-RichEditor__noneditable","image-template-left","image-template-center","image-template-right","mce-object-iframe","ws-hidden","language-javascript","language-css","language-markup","language-php","token","comment","prolog","doctype","cdata","punctuation","namespace","property","tag","boolean","number","constant","symbol","deleted","selector","attr-name","string","char","builtin","inserted","operator","entity","url","style","attr-value","keyword","function","regex","important","variable","bold","italic","LinkDecorator__link","LinkDecorator","LinkDecorator__simpleLink","LinkDecorator__linkWrap","LinkDecorator__decoratedLink","LinkDecorator__wrap","LinkDecorator__image"],a=o.length-1;while(a>=0){if(!~s.indexOf(o[a])&&(!i||!this._options.validateClass(o[a])))o.splice(a,1);a-=1}if(n=o.join(" "),n)t.attributes[e].value=n;else delete t.attributes[e]}.bind(i)},checkDataAttribute:false,escapeInvalidTags:false})},_getTextBeforePaste:function(){return this._tinyEditor.plugins.paste.clipboard.prepareTextBeforePaste(this._clipboardText)},_fillImages:function(t){return $("<div>"+this.getText()+"</div>").find("img").toArray().forEach(function(e){var i=this.checkImageUuid(e);if(i)this._images[i]=t},this),this._images}});return T.EDITOR_MODULES=v,T});
//# sourceMappingURL=RichTextArea.js.map
define("SBIS3.CONTROLS/RichEditor",["SBIS3.CONTROLS/RichEditor/Components/RichTextArea","tmpl!SBIS3.CONTROLS/RichEditor/RichEditor","SBIS3.CONTROLS/RichEditor/Components/Toolbar"],function(t,o,i){"use strict";var e={toolbarHeight:32},n=t.extend({_dotTplFn:o,$protected:{_options:{toolbar:true,toolbarVisible:true,items:void 0},_toolbar:void 0},_initToolbar:function(){if(this._container.find(".controls-RichEditorToolbar").length)this._toolbar=this.getChildControlByName("RichEditorToolbar");else{var t=$("<div></div>");this._dataReview.before(t),this._toolbar=new i({element:t,name:"RichEditorToolbar",expanded:this._options.toolbarVisible,items:this._options.items})}this._toolbar.setLinkedEditor(this),this._toolbar.subscribe("onExpandedChange",function(t,o){var i=this._inputControl.outerHeight();if(i+=o?-e.toolbarHeight:e.toolbarHeight,!this._options.autoHeight)this._inputControl.animate({height:i},"fast");this.execCommand("")}.bind(this))},_getToolbar:function(){if(!this._toolbar)this._initToolbar();return this._toolbar},_setEnabled:function(t){if(this._options.toolbar&&(this._hasToolbar()||t))this._performByReady(function(){this._getToolbar().setEnabled(t)}.bind(this));n.superclass._setEnabled.apply(this,arguments)},_hasToolbar:function(){return!!this._toolbar},getToolbarItem:function(t){return this._toolbar&&this._toolbar.getItemInstance(t)},_initInputHeight:function(){var t=this._options.toolbar&&this._options.toolbarVisible?e.toolbarHeight:0;if(!this._options.autoHeight)this._inputControl.css("height",this._container.height()-t)}});return n});
//# sourceMappingURL=RichEditor.js.map
define("js!SBIS3.CONTROLS.RichEditor",["SBIS3.CONTROLS/RichEditor"],function(i){return i});
//# sourceMappingURL=RichEditor.module.js.map
define("Deprecated/Enum",[],function(){var t=Object.prototype.toString,e={boolean:1,string:1,number:1};function a(t){return t+="",t.split("").reduce(function(t,e){return t+31*e.charCodeAt(0)},17)}function l(a){this._curValIndex=void 0,this._availableValues={},this._hashCode=0,this._fallbackVal=void 0,this._initialValue=void 0;var l=a.availableValues,i=a.currentValue,n;if(i=null===i||"null"===i?"null":parseInt(i,10),"[object Object]"==t.call(l)&&l){for(var r in l)if(l.hasOwnProperty(r)){var u=l[r];if(null===u||typeof u in e){if(n=null===r||"null"===r?"null":parseInt(r,10),void 0===this._fallbackVal)this._fallbackVal=n;if(i===n)this._curValIndex=n;this._availableValues[r]=l[r]}}}else throw new Error("Class Enum. Option availableValues must be set to object");if(void 0===this._curValIndex)if(void 0===this._fallbackVal)throw new Error("Class Enum. No values to build");else this._curValIndex=n;this._initialValue=this._curValIndex}return l.prototype.valueOf=function(){return this.getCurrentValue()},l.prototype.getCurrentValue=function(){return"null"==this._curValIndex?null:this._curValIndex},l.prototype.getValues=function(){return this._availableValues},l.prototype.set=function(t){if(t=null===t?"null":t,t in this._availableValues)this._hashCode=0,this._curValIndex=t;else if("null"===t)this.set(this._initialValue);else throw new Error("Class Enum. Unsupported index: "+t)},l.prototype.toObject=function(){return{availableValues:this.getValues(),currentValue:this.getCurrentValue()}},l.prototype.hashCode=function(){if(0===this._hashCode){this._hashCode=17+31*Object.keys(this._availableValues).length;for(var t in this._availableValues)if(this._availableValues.hasOwnProperty(t)){var e=this._availableValues[t],l=parseInt(t,10);this._hashCode+=31*((isNaN(l)?-1:l)+a(e))}}return this._hashCode},l.prototype.equals=function(t){return t instanceof l&&this.hashCode()==t.hashCode()&&this.getCurrentValue()==t.getCurrentValue()},l.prototype.commit=function(){this._initialValue=this._curValIndex},l.prototype.rollback=function(t){this.set(t)},l.prototype.toString=function(){return""+this._availableValues[this._curValIndex]},l.prototype.clone=function(){return new l({currentValue:this.getCurrentValue(),availableValues:this.getValues()})},l.prototype.isChanged=function(){return this._curValIndex!==this._initialValue},l});
//# sourceMappingURL=Enum.js.map
define("Lib/CoreValidators/CoreValidators",["Lib/Control/Control","Deprecated/Enum"],function(r,t){"use strict";var e,n=/^([0-9A-Z]+)$/,u=/^([0-9]+)$/;function i(r,t,e){for(var n=0,u=t,i=r.length,a=0;a<i-1;a++,u++){if(u%=e+1,0===u)u++;n+=parseInt(r.charAt(a),10)*u}return n%11}function a(r){if(void 0===r||null===r||""===r)return"";return r}return e={required:function(){var r=this.getText?this.getText():this.getValue();if(r instanceof t)r=r.getCurrentValue();if(void 0===r||null===r||""===r)return rk("Поле обязательно для заполнения");return true},kpp:function(r){var i=(this.getParentWindow()||this.getTopParent()).getChildControlByName(r);if(true===e.inn.call(i)){var a=i.getValue()+"";if(10==a.length){var s=this.getValue()||"",f=s.substr(0,4),l=s.substr(4,2),h=s.substr(6,3);if(s instanceof t)s=s.getCurrentValue();return 9==(""+s).length&&u.test(f)&&n.test(l)&&u.test(h)||!(s+"").length?true:rk("КПП должен состоять из 9 символов:")+" "+rk("1-4 и 7-9 должны быть цифрами, 5-6 могут быть цифрами или заглавными латинскими буквами")}else if(12==a.length)return true!==e.required.call(this)?true:rk("КПП не должен быть заполнен");else return true}else return true},kppAtPlace:function(r){var t=this.getLinkedContext().getRecord().get(r);if(e.innCheckValue(t))if(10==t.length){var n=this.getValue();return/^([0-9]+)$/.test(n)&&9==(""+n).length||!(n+"").length?true:rk("КПП должен состоять из 9 цифр")}else if(12==t.length)if(!n)return rk("КПП не должен быть заполнен");return true},innCheckSum:function(){var r=a(this.getValue());return e.innCheckValue(r)},innCheckValue:function(r){if(""===r)return true;if("000000000000"===r||"0000000000"===r)return rk("ИНН не может состоять из одних нулей");var t=[3,7,2,4,10,3,5,9,4,6,8],e=r.toString(),n=0,u,i;if(12===e.length){for(u=0,i=1;u<10;u++,i++)n+=e.charAt(u)*t[i];if(n%11%10==e.charAt(10)){for(n=0,u=0,i=0;u<11;u++,i++)n+=e.charAt(u)*t[i];if(n%11%10==e.charAt(11))return true}}else if(10===e.length){for(u=0,i=2;u<9;u++,i++)n+=e.charAt(u)*t[i];if(n%11%10==e.charAt(9))return true}else return true;return rk("Неверная контрольная сумма ИНН")},inn:function(r){r=parseInt(r,10)||0;var t=a(this.getValue());if(""===t)return true;var n=(""+t).length,u=/^([0-9]+)$/.test(t),i=r>0?(""+t).length==r:10===n||12===n;if(!u||!i)return rk("ИНН должен состоять из")+" "+(r>0?r:rk("10 или 12"))+" "+rk("цифр");return e.innCheckSum.apply(this)},email:function(){var r=a(this.getValue());if(""===r)return true;if(/^[a-z0-9+_][-a-z0-9+_]*(\.[-a-z0-9+_]+)*@([a-z0-9]([-a-z0-9]{0,61}[a-z0-9])?\.)+([a-z]{1,10})$/i.test(r))return true;if(/^(([a-z0-9+_][-a-z0-9+_]*(\.[-a-z0-9+_]+)*)|([-а-яё0-9+_]+(\.[-а-яё0-9+_]+)*))@([а-яё0-9]([-а-яё0-9]{0,61}[а-яё0-9])?\.)+([а-яё]{1,10})$/i.test(r))return true;return rk("В поле требуется ввести адрес электронной почты")},inRange:function(r,t){var e=a(this.getValue());if(""===e)return true;r=parseFloat(r),t=parseFloat(t);var n=isNaN(r)?e:r,u=isNaN(t)?e:t;return!isNaN(parseFloat(e))&&isFinite(e)&&e>=n&&e<=u?true:rk("Значение должно попадать в диапазон [")+(isNaN(r)?"*":r)+";"+(isNaN(t)?"*":t)+"]"},length:function(r,t){var e=this.getStringValue()||"";if(""===e)return true;r=parseInt(r,10),t=parseInt(t,10);var n=e.length,u=isNaN(r)?n:r,i=isNaN(t)?n:t;return n>=u&&n<=i?true:rk("Длина должна попадать в указанный диапазон [")+(isNaN(r)?"*":r)+";"+(isNaN(t)?"*":t)+"]"},url:function(){var r=a(this.getValue());if(""===r)return true;return/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/i.test(r)?true:rk("Должен быть указан корректный URL")},compare:function(t){var e=this.getStringValue()||"",n;try{n=r.ControlStorage.getByName(t).getStringValue()||""}catch(r){return false}return e===n?true:rk("Значение поля должно совпадать с полем '")+t+"'"},okpo:function(){var r=a(this.getValue()).trim(),t,e,n;if(""===r)return true;if(t=r.length,8!=t&&14!=t)return rk("ОКПО должен содержать 8 или 14 цифр");if(14==t)r=r.substr(0,8),t=8;if(e=parseInt(r.charAt(t-1),10),n=i(r,1,10),10===n)n=i(r,3,10);if(10===n)n=0;if(n!==e)return rk("Неверная контрольная сумма ОКПО");return true},ogrn:function(r,t){var e=a(this.getValue()).trim(),n,u,i,s,f,l=parseInt(e,10).toString().length,h=[1,2,3,5],o=false;if(""===e)return true;if(n=e.length,t=t||(15==r?rk("ОГРНИП"):rk("ОГРН")),r&&n!=r||!r&&13!==n&&15!==n)return t+" "+rk("должен состоять из")+" "+(r||rk("13 или 15"))+" "+rk("цифр");if(f=parseInt(e.charAt(0),10),u=parseInt(e.charAt(n-1),10),i=parseInt(e.substr(0,n-1),10)%(l-2),s=i%10,o=-1!==h.indexOf(f),s!==u||!o)return rk("Неверная контрольная сумма")+" "+t;return true},snils:function(){var r=a(this.getValue());if(""===r)return true;if(11!==r.length)return rk("СНИЛС должен состоять из 11 цифр");if(!/^[\d]+$/.test(r))return rk("СНИЛС должен состоять из 11 цифр");for(var t=r%100,e=r.substr(0,9),n=0,u=1;u<10;u++)n+=e.substr(u-1,1)*(10-u);if(n=n%101%100,n!=t)return rk("Неверная контрольная сумма СНИЛС");return true},snilsValidalion:function(){var r=this.getValue();if(""===r||"___-___-___ __"===r||null===r)return true;else if(/^[0-9]{3}\-[0-9]{3}\-[0-9]{3} [0-9]{2}$/.test(r)){for(var t="",e=Number(r[12]+r[13]),n=0;n<12;n+=4){for(var u="",i=n;i<n+3;i++)u+=r[i];t+=u}if(Number(t)>1001998){for(var a=0,s=0;s<9;s++)a+=(9-s)*Number(t[s]);if(a<100&&Number(e)==a||(100===a||101===a)&&0===Number(e)||a>101&&Number(e)==a%101%100)return true}else return true}return rk("Неверный номер страхового свидетельства ПФ")},PFNumber:function(){var r=a(this.getValue());if(""===r||!/^[0-9]{3}-[0-9]{3}-[0-9]{6}$/.test(r))return rk("Регистрационный номер в ПФ должен состоять из 12 цифр");return true},FSSNumber:function(){var r=a(this.getValue());if(""===r)return true;if(10!=r.length)return rk("Номер в ФСС должен состоять из 10 цифр");return true},kodPodchinennostiFSS:function(){var r=a(this.getValue());if(""===r||!/^[0-9]{4}[1-3]{1}$/.test(r))return rk("Код подчиненности в ФСС должен состоять из 5 цифр. Последняя цифра может быть равна 1, 2 или 3.");return true},TFOMS:function(){var r=[3,5,7,9,11,13,15,13,11,9,7,5,3,1],t=0,e=a(this.getValue()).trim(),n=parseInt(e.charAt(e.length-1),10);if(""===e)return true;if(15!=e.length)return rk("Номер должен состоять из 15 цифр");else if("000000000000000"===e)return rk("Номер ТФОМС не может состоять из одних нулей");for(var u=0;u<e.length-1;u++)t+=parseInt(e.charAt(u),10)*r[u];if(t%9===n)return true;return rk("Неверная контрольная сумма ТФОМС")},removeExcessSpaces:function(){var r=a(this.getValue()).trim().replace(/\s+/g," ");return this.setValue(r),true}}});
//# sourceMappingURL=CoreValidators.js.map
define("SBIS3.CONTROLS/Utils/ControlsValidators",["Lib/CoreValidators/CoreValidators","Core/core-instance","Core/IoC","i18n!SBIS3.CONTROLS/Utils/ControlsValidators"],function(e,r,t){"use strict";function n(r,t){var n={getValue:function(){return t}};return e.inn.call(n,r)}return{required:function(e){var n=false;switch(typeof e){case"string":n=!Boolean(e);break;case"number":n=isNaN(e);break;case"object":if(r.instanceOfModule(e,"Deprecated/Enum"))t.resolve("ILogger").error("SBIS3.CONTROLS/Utils/ControlsValidators","использует устаревший модуль Deprecated/Enum. Выпишите ошибку на Интерфейсный фреймворк со скриншотом."),n=null===e.getCurrentValue();else if(r.instanceOfModule(e,"WS.Data/Collection/List"))n=!Boolean(e.getCount());else if(e instanceof Array)n=!Boolean(e.length);else if(e instanceof Object)n=Object.isEmpty(e);else if(null===e)n=true;break;case"undefined":n=true}return n?rk("Поле обязательно для заполнения"):true},inRange:function(e,r,t){var n;if(e=parseFloat(e),r=parseFloat(r),""===t||isNaN(t)||isNaN(e)||isNaN(r)||void 0==t)return true;return n=!isNaN(parseFloat(t))&&isFinite(t)&&t>=e&&t<=r,n?true:"Значение должно попадать в диапазон ["+e+";"+r+"]"},inn:n.bind(void 0,void 0),inn10:n.bind(void 0,10),inn12:n.bind(void 0,12),compare:function(e,r){var t;try{t=this.getTopParent().getChildControlByName(e).getText()||""}catch(e){return false}return r===t?true:'Значение поля должно совпадать с полем "'+e+'"'},email:function(e){var r=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Zа-яА-Я\-0-9]+\.)+[a-zA-Zа-яА-Я]{2,}))$/;return(e?r.test(e):true)?true:rk("В поле требуется ввести адрес электронной почты")},snils:function(e){if(!e)return true;if(e=e.replace(/\D+/g,""),11!==e.length)return rk("СНИЛС должен состоять из 11 цифр");for(var r=e%100,t=e.substr(0,9),n=0,i=1;i<10;i++)n+=t.substr(i-1,1)*(10-i);return n=n%101%100,n==r?true:rk("Неверная контрольная сумма СНИЛС")}}});
//# sourceMappingURL=ControlsValidators.js.map
define("js!SBIS3.CONTROLS.ControlsValidators",["SBIS3.CONTROLS/Utils/ControlsValidators"],function(o){return o});
//# sourceMappingURL=ControlsValidators.module.js.map
define("html!SBIS3.Contacts.MessageEditor/Editor",function(){var o=function(o){var n=function(){var o=/\{\{([\s\S]+?)\}\}/g;return function(n){for(;o.test(n);)n=n.replace(o,"&#123;&#123;$1&#125;&#125;");return n}}(),t=function(o){return o.join?o.join(""):o.toString()},e=function(o){return void 0===o?"":o&&"object"==typeof o?t(o):""+o},i="undefined"!=typeof process,a=("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),p=function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,r="<div> ";return o.showToolbar&&(r+=' <div class="contacts-EditorAbove-panel"> <component data-component=\'SBIS3.CONTROLS.RichEditorRoundToolbar\' name="EditorInPlaceToolbar"> <options name="items" type="array"> <options> <option name="name">smile</option> <option name="basic">true</option> </options> <options> <option name="name">link</option> <option name="basic">true</option> </options> <options> <option name="name">styles</option> <option name="basic">true</option> </options> <options> <option name="name">toggle</option> <option name="basic">true</option> <option name="visible">false</option> </options> </options> </component> </div> '),r+=' <component data-component=\'SBIS3.CONTROLS.RichEditor\' name="EditorInPlace" class="contacts-EditorAbove_editor"> <option name="text" bind="'+n(e(o.editingField))+'" type="ref">'+n(e(function(o,n){var t=a.randomId();return o[t]=n,t}(p,o.item?o.item.get(o.editingField):void 0)))+"</option> <option name=\"uploadImageOnDrop\">false</option> <option name='toolbarVisible' type='boolean'>false</option> <option name='toolbar' type='boolean'>false</option> <option name='autoHeight' type='boolean'>true</option> <option name=\"maxLength\">16384</option> <option name='maximalHeight'>"+n(e(o.maximalHeight))+"</option> <option name='minimalHeight'>"+n(e(o.minimalHeight))+"</option> ",o.focusOnActivatedOnMobiles?r+=" <option name='focusOnActivatedOnMobiles'>true</option> ":r+=" <option name='focusOnActivatedOnMobiles'>false</option> ",r+=' <options name="validators" type="array"> <options> <option name="validator" type="function">SBIS3.CONTROLS/Utils/ControlsValidators:required</option> <option name="option">text</option> <option name="errorMessage">'+n(e(rk("Введите текст сообщения")))+'</option> <option name="noFailOnError">false</option> </options> </options> <options name=\'handlers\'> <option name="onBeforeShow" type="function">js!SBIS3.Contacts.MessageEditor:prototype.onBeforeShowEditor</option> <option name="onAfterShow" type="function">js!SBIS3.Contacts.MessageEditor:prototype.onAfterShowEditor</option> <option name="onKeyPressed" type="function">js!SBIS3.Contacts.MessageEditor:prototype.onKeyPressedHandler</option> </options> </component> <div id="message-edit-files"></div> </div>',(r=n(r))+(i&&-1!==r.indexOf("{{")?String.fromCharCode(8203,8203):"")};return o.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.MessageEditor/Editor"}},o});
//# sourceMappingURL=Editor.xhtml.map
define("js!SBIS3.Contacts.MessageEditor",["js!SBIS3.CONTROLS.CompoundControl","html!SBIS3.Contacts.MessageEditor/Editor","js!SBIS3.CONTROLS.ControlsValidators","js!SBIS3.CONTROLS.RichEditor","js!SBIS3.CONTROLS.RichEditorRoundToolbar"],function(o,t){"use strict";var i=o.extend({_dotTplFn:t,$protected:{_options:{showToolbar:false,item:null,maximalHeight:150,minimalHeight:18,editingField:"ТекстДляРедактирования",focusOnActivatedOnMobiles:false,handlers:{}}},$constructor:function(){this._publish("onKeyPressed")},init:function(){if(i.superclass.init.call(this),this._options.showToolbar){var o=this.getChildControlByName("EditorInPlaceToolbar"),t=this.getChildControlByName("EditorInPlace");o.setLinkedEditor(t)}},onBeforeShowEditor:function(o){var t=this.getParentByClass(i);if(t&&t._options&&t._options.handlers&&t._options.handlers.onBeforeShowEditor)t._options.handlers.onBeforeShowEditor.call(t,o)},onAfterShowEditor:function(o){this.setCursorToTheEnd();var t=this.getParentByClass(i);if(t&&t._options&&t._options.handlers&&t._options.handlers.onAfterShowEditor)t._options.handlers.onAfterShowEditor.call(t,o)},onKeyPressedHandler:function(o,t){this.getParentByClass(i)._notify("onKeyPressed",o,t)},getRichEditor:function(){return this.hasChildControlByName("EditorInPlace")?this.getChildControlByName("EditorInPlace"):void 0}});return i});
//# sourceMappingURL=Editor.module.js.map
define("html!SBIS3.Contacts.EditInPlaceMixin/templates/EditorAbove",function(){var o=function(o){var n=function(){var o=/\{\{([\s\S]+?)\}\}/g;return function(n){for(;o.test(n);)n=n.replace(o,"&#123;&#123;$1&#125;&#125;");return n}}(),t=function(o){return o.join?o.join(""):o.toString()},e=function(o){return void 0===o?"":o&&"object"==typeof o?t(o):""+o},r="undefined"!=typeof process,i=("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),a=function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,d="<div class=\"contacts-EditorAbove\"> <component data-component='SBIS3.Contacts.MessageEditor' name=\"MessageEditor\"> <option name='showToolbar' type='boolean'>"+n(e(o.showToolbar))+'</option> <option name="item" type="ref">'+n(e(function(o,n){var t=i.randomId();return o[t]=n,t}(a,o.item)))+"</option> <option name='maximalHeight'>"+n(e(o.maxHeightEditor))+"</option> <option name='minimalHeight'>"+n(e(o.newHeightEditor))+'</option> <option name="handlers" type="ref">'+n(e(function(o,n){var t=i.randomId();return o[t]=n,t}(a,o.handlers)))+"</option> </component> </div>";return(d=n(d))+(r&&-1!==d.indexOf("{{")?String.fromCharCode(8203,8203):"")};return o.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.EditInPlaceMixin/templates/EditorAbove"}},o});
//# sourceMappingURL=EditorAbove.xhtml.map
define("js!SBIS3.Contacts.EditInPlaceMixin",["Core/core-merge","Core/helpers/fast-control-helpers","Core/IoC","Core/Deferred","Core/Indicator","Core/UserInfo","html!SBIS3.Contacts.EditInPlaceMixin/templates/EditorAbove","js!SBIS3.Contacts.Mixins.Services.Consumer","js!WS.Data/Source/SbisService","js!WS.Data/Query/Query","js!SBIS3.DOCVIEW.List","js!SBIS3.Contacts.CoreMiniFunctions","css!SBIS3.Contacts.EditInPlaceMixin/styles/EditorAbove","js!SBIS3.Contacts.MessageEditor"],function(e,t,i,s,n,a,o,d,l,r,c,g){"use strict";return e(e({},{$protected:{_options:{linkedView:""},_editorTemplate:o,_linkedModelId:void 0,_linkedViewRow:void 0},showEdit:function(e,t){if(e=e||this._options.linkedView,!e||!t)return;var s=this,n=e.getItems();n.doBeginMessageEditing(t).addCallbacks(function(i){if(i&&"function"===typeof i.getRow){var a=i.getRow().get("ТекстСообщения");n.getRecordById(t).set("ТекстДляРедактирования",a),s.oldText=a,s._linkedModelId=t,s._linkedViewRow=e.getContainer().find('[data-id="'+t+'"]'),s._editorTemplate=o,s._showEditInPlace(e,n)}},function(e){i.resolve("ILogger").error("EditInPlaceMixin.showEdit",e.details||e.message)})},_updateEditing:function(e,t){var n=e.doBeginMessageEditing(t),a=this;if(n instanceof s)n.addErrback(function(e){i.resolve("ILogger").error(e.details||e.message),a._clearTimer()})},_clearTimer:function(){if(this.timerId)clearInterval(this.timerId)},_addDocViewList:function(e,t){var i=this,s=t.clone(),o="ФайлыDocViewEdit",d=i.getLinkedContext();if(s.addField({name:"canDelete",type:"boolean"},null,true),d.setValue(o,s),i.files_changed=false,!i._docViewList)i._docViewList=new c({element:e,name:"attachmentsSendMessage",parent:i,opener:i,mainOptions:{ctxLinkList:o,useOnlyCtx:true,objectName:"FileSD",serviceBLName:"СБИСДиск.Приватный",serviceUrl:"/disk/api/v1/",commands:{rights:false,print:false,sendMessage:false,deletePermanentlyDoc:false,restore:false,move:false,fullScreen:false,saveToPdf:false,copyToBuffer:true,signDocument:false,redactions:false,links:false,encrypt:false}},listOptions:{goToFolder:false,activableByClick:true,calcMargin:false,previewWidth:68,previewHeight:68,visibilityMode:{defaultMode:"bigPreview",folderAsPreview:true},multiselect:false,itemsDragNDrop:false,hasHierarchy:false,hideBreadCrumbs:true,itemsSortMethod:null,serializedItems:s.getRawData()},handlers:{onReady:function(){if(this.setCommandCfg)this.setCommandCfg("rename",{inList:false});this.getContainer().on("dragover dragenter",function(e){e.stopPropagation(),e.preventDefault()})},onStartCommand:function(e,t,n,a){if(t&&"deleteDoc"===t)e.setResult(false),g.question(rk("Удалить файл?"),i).addCallback(function(e){if(e){var t=n.records;if(a&&a.instance){var o=a.instance._getCommandsManager?a.instance._getCommandsManager():null,d=o.hasChildControlByName("closeFullScreen")?o.getChildControlByName("closeFullScreen"):null;if(o&&d)o.startCommand("closeFullScreen",n.records,{records:n,instance:d})}if(t&&t.length)s.removeAt(s.getIndexByValue(s.getIdProperty(),t[0].getId())),i.files_changed=true}})},onFinishCommand:function(e,t,o){var d=o.finishParams,c=o.records[0];if("imageEdit"===t&&d&&d.saving&&d.saving.addCallback)setTimeout(function(){n.setMessage("")},20),d.saving.addCallbacks(function(){var e=s.at(s.getIndexByValue("attachId",c.get("attachId")));e.set("redactionId",c.get("lastRedactionId")),e.set("size",c.get("lastRedactionSize")),i.files_changed=true,setTimeout(function(){n.hide()},1e3)},function(){setTimeout(function(){n.hide()},50)});else if("saveChanges"===t||"editInApp"===t){n.setMessage("");var g=c.get("attachId"),f=(new r).where({attachId:g});setTimeout(function(){new l({endpoint:{address:"/disk/api/v1/service/",contract:"FileSD"},binding:{query:"RedactionsList"}}).query(f).addCallbacks(function(e){for(var t=e.getAll(),o=s.at(s.getIndexByValue("attachId",g)),d=a.get("ИдентификаторСервисаПрофилей"),l,r=0;r<t.getCount();r++)if(l=t.at(r),l.get("responsibleProfileId")===d)break;if(o&&l)o.set("redactionId",l.get("redactionId")),o.set("size",l.get("size")),i.files_changed=true;n.hide()},function(){n.hide()})},100)}}}})},_showEditInPlace:function(e,n){if(e=e||this._options.linkedView,!e||!n)return;var a=18,o=150,d=this,l=d._linkedModelId,r=d._linkedViewRow,c=r.outerHeight(),g=r.offset(),f=r.find(".message-text"),u=f.offset(),h=e.getContainer(),m=h.find(".contacts-ThemeMessage-row"),v=m.first(),C=m.last(),p=n.getRecordById(l),I=i.resolve("ILogger"),w=function(){d._linkedModelId=null},_=function(e){I.error("EditInPlaceMixin._showEditInPlace",e)},b=0,E=0,k=0,S=0,M=r.hasClass("contacts-Discussion-row"),y="question"===e._listType,V,x;if(!f.length)(u=r.find(".contacts-ThemeMessage-row-content").offset()).left+=8,u.top+=3;if(!M)d.consume("sendButtonEnable",{enabled:false});if(v.length)v.addClass("first-message-row");if(C.length)C.addClass("last-message-row");d.timerId=setInterval(d._updateEditing.bind(d,n,l),15e3),b=u.top-g.top-3,E=u.left-g.left-8;var B=f.length?f.outerHeight():0;if(k=c-(B+b+5),S=c-b-k,S<a)S=a;if(y)k-=3;if(M||y)b=32;var T=function(){var e=this.getContainer().parent();if(r.hasClass("last-message-row"))e.addClass("last-message-row");if(h.addClass("contacts-EditInPlace__linkedView"),e.length){var t=r.find(".attach-file"),i=h.find("#message-edit-files");if(t.length){try{var s=parseInt(r.css("padding-right").split("px")[0],10)+10;if(r.find(".contacts-ThemeMessage-output__content-wrapper").length)s+=58}catch(e){s=void 0}var n=t.height();if(M)e.find(".contacts-EditorAbove_editor").after("<div"+(void 0===s?"":' style="padding-right: '+s+'px;"')+">"+t.html()+"</div>");else if(void 0!==s&&i&&i.length)i.css({"padding-right":s,"min-height":n});k-=n-2}var a=(t=r.find(".contacts-ServiceMessage")).find(".docview-list");if(t.length&&a.length){if(M)k-=a.outerHeight()-4;else k-=t.outerHeight()+4;e.find(".contacts-EditorAbove_editor").after('<div class="'+t.attr("class")+'">'+t.html()+"</div>")}if(e.css("padding-top",b),e.css("padding-bottom",k),e.css("padding-left",E),r.find(".message-time-date").css("display","none"),M)e.find(".contacts-EditorAbove_editor").css("margin-right",68);else{var o=p.get("FileForPreview");if(o&&o.getCount()&&!a.length)i.addClass("file-thumbnail-container"),d._addDocViewList(i,o);else if(d._docViewList)d._docViewList.destroy(),d._docViewList=null;d.consume("setRightSideOpenerVisible",false)}}};x=d._editorTemplate.apply(d,[{item:p,newHeightEditor:S,showToolbar:y||M,maxHeightEditor:S>o?S:o,handlers:{onBeforeShowEditor:T}}]),e.setEditingTemplate(x),e.setEditMode("single|toolbar"),e.once("onBeginEdit",function(e){e.setResult("PendingAll")}),e.once("onAfterBeginEdit",function(){if(M||y)h.find(".controls-EditActions__cancelButton").removeClass("controls-EditActions__cancelButton").addClass("icon-16 icon-Close controls-IconButton");var e=h.find(".controls-ItemsToolbar__edit");if(e&&e.length)if(r.hasClass("snd_group__center")||r.hasClass("snd_group__begin"))e.css("padding-bottom","0px");else e.css("padding-bottom","3px");this.getItemsActions().hide()}),e.subscribeTo(e,"onEndEdit",function(i,a,o){V=a.get("ТекстДляРедактирования");var c=d.getLinkedContext().getValue("ФайлыDocViewEdit"),g=c?c.getCount():0;e._alreadyCancelEdit=false;var f=this.getContainer().find(".contacts-EditorAbove");if(f.length)f.css("height",f.height());if(o&&!V&&(!c||0===g))return i.setResult("Cancel"),i.cancelBubble(),this.validate(),t.alert(rk("Невозможно отправить пустое сообщение.")).addCallback(function(){d.setActive(e)}),e._alreadyCancelEdit=true,false;if(h.removeClass("contacts-EditInPlace__linkedView"),m.find(".contacts-ThemeMessage-row.first-message-row").removeClass("first-message-row"),m.find(".contacts-ThemeMessage-row.last-message-row").removeClass("last-message-row"),!M)d.consume("sendButtonEnable",{enabled:true}),d.consume("setRightSideOpenerVisible",true);r.find(".message-time-date").show(),d._clearTimer.bind(d)();var u=e.getItems(),v=u.getMyMessageIndex(a.get("Сообщение")),C=v?v.index:null,p=null!==C?u.at(C):null,I=p?p.get("ПрочитаноПолучателем"):[],b=p?p.get("МожноРедактировать"):null;if(I.length)I=I[0];if(o&&b){if(d.files_changed)c=d.getLinkedContext().getValue("ФайлыDocViewEdit");if(V===d.oldText&&!c)i.setResult("NotSave"),d.oldText=null,n.doCancelMessageEditing(l).addCallbacks(w,_);else{var E=n.doSaveEditedText(l,V,c),k=new s,S=p?p.get("FileForPreview"):null,y=S&&c?S.clone():null,x=[];if(S&&c){S.each(function(e){var t=e.get("attachId");if(-1===c.getIndexByValue("attachId",t))x.push(t)});for(var B=0;B<x.length;B++)S.removeAt(S.getIndexByValue("attachId",x[B]))}E.addCallbacks(w,function(){if(d._linkedModelId=null,y)p.set("FileForPreview",y)}),E.addBoth(function(){k.callback("NotSave")}),e._getItemsToolbar().hideEditActions(),i.setResult(k)}}else{if(i.setResult("NotSave"),o&&!b&&V&&I&&V!==d.oldText)t.message(rk("Пользователь уже прочитал ваше сообщение.")).addCallback(function(){d.consume("setMsgText",{text:V})});if(p)n.doCancelMessageEditing(l).addCallbacks(w,_)}if(d._docViewList)d._docViewList.destroy(),d._docViewList=null,d.getLinkedContext().setValue("ФайлыDocViewEdit",null);e.unsubscribeFrom(e,"onEndEdit")}),e.sendCommand("beginEdit",p)}},{clone:true}),d)});
//# sourceMappingURL=EditInPlace.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.MessageActions.EditMessage",["Core/IoC","js!SBIS3.Contacts.EditInPlaceMixin","js!SBIS3.Contacts.Mixins.Services.Executor.Base"],function(e,t,i){"use strict";return i.mergeMixin(i.mergeMixin(i,t),{$protected:{isShowed:false,_options:{}},before:{init:function(){var e=this;if(e.register(["changeContextQuery"]),"function"==typeof e.getItemsActions&&"function"==typeof e.setItemsActions)e.once("onAfterShow",function(){var t=e.getItemsActions(),i;for(t=t?e.getItemsActions().getItems().getRawData():[],i=0;i<t.length;i++)if("edit"==t[i].name)return;t.push({name:"edit",icon:"sprite:icon-16 icon-Edit icon-primary",caption:rk("Редактировать"),tooltip:rk("Редактировать"),isMainAction:true,onActivated:e._selectAction.bind(e)}),e.setItemsActions(t)}),e.subscribeTo(e,"onChangeHoveredItem",e._handlerOnChangeHoveredItem.bind(e))},isShowEditAction:function(e){return e.record.get("МожноРедактировать")}},seChangeContextQuery:function(t){if("object"!==typeof t||!t.context)return e.resolve("ILogger").log("Services.Executor.ChangeContextQuery","context in params required"),{result:null,executed:false};if("textEntered"===t.context)return this.hideEditMessage(),{result:true,executed:true};return{result:true,executed:true}},_handlerOnChangeHoveredItem:function(e,t){var i=this;if(t.record){var n=i.getItemsActions(),s=n?n.getItemsInstances():{};if(s.edit){var o=t.record.get("НачатаПравка")[0]?(new Date-new Date(t.record.get("НачатаПравка")[0]))/1e3:null,r=o&&o<31||"function"==typeof i.isEdit&&i.isEdit(),c=i.isShowEditAction(t);s.edit[!r&&c?"show":"hide"]()}}},_selectAction:function(e,t,i){this.showEditMessage(i)},showEditMessage:function(e){var t=e.getId(),i=this._options.linkedView?this._options.linkedView:this;if(!i||!t||"function"!=typeof this.showEdit)return;this.hideEditMessage(),this.isShowed=true,this.showEdit(i,t)},hideEditMessage:function(){if(this.isShowed&&"function"==typeof this._cancelEdit)this._cancelEdit(),this.isShowed=false}})});
//# sourceMappingURL=EditMessage.module.js.map
(function(){"use strict";var e=function(){return this||(0,eval)("this")}();(e.define||e.requirejs&&e.requirejs.define||requirejsVars&&requirejsVars.define)("is-api",function(){var e={};return e.normalize=function(u,t){var r=e.parse(u);if(r.feature=t(r.feature),r.yesModuleId)r.yesModuleId=t(r.yesModuleId);if(r.noModuleId)r.noModuleId=t(r.noModuleId);if("lookup"==r.type)return r.feature;if(!r.yesBuild)r.yesModuleId="["+r.yesModuleId+"]";if(!r.noBuild)r.noModuleId="["+r.noModuleId+"]";if("load_if_not"==r.type)return"~"+r.feature+"?"+r.yesModuleId+(r.noModuleId?":"+r.noModuleId:"");if("load_if"==r.type)return r.feature+"?"+r.yesModuleId+(r.noModuleId?":"+r.noModuleId:"")},e.parse=function(e){var u=e.substr(0,e.indexOf("?")),t=e.substr(u.length+1,e.length-u.length-1),r=t.substr(0,t.indexOf(":"));if("//"==t.substr(r.length+1,2))r=t.substr(0,t.indexOf(":",r.length+1));var d=t.substr(r.length+1,t.length-r.length-1);if(""==r)r=t,d=null;var s=true,n=true;if(r&&"["==r.substr(0,1)&&"]"==r.substr(r.length-1,1))r=r.substr(1,r.length-2),s=false;if(d&&"["==d.substr(0,1)&&"]"==d.substr(d.length-1,1))d=d.substr(1,d.length-2),n=false;if(""==u)return{feature:e,type:"lookup"};if("~"==u.substr(0,1))return{feature:u.substr(1,e.length-1),type:"load_if_not",yesModuleId:r,noModuleId:d,yesBuild:s,noBuild:n};else return{feature:u,type:"load_if",yesModuleId:r,noModuleId:d,yesBuild:s,noBuild:n}},e})})();
//# sourceMappingURL=is-api.js.map
(function(){"use strict";var e=function(){return this||(0,eval)("this")}();(e.define||e.requirejs&&e.requirejs.define||requirejsVars&&requirejsVars.define)("is",["module","./is-api","require","Core/constants"],function(e,r,o,t){var u={};if(u.pluginBuilder="./is-builder",u.normalize=r.normalize,u.features=e.config()||{},void 0===u.features.browser)u.features.browser="undefined"!=typeof window;if(void 0===u.features.build)u.features.build=false;u.curModule=null,u.modules=null,u.empty=function(){return null};var i=u.features.browser&&navigator;if(i)i=navigator.appVersion.match(/MSIE\s+(\d+)/);return u.features.msIe=!!i,u.features.msIe8=u.features.browser&&navigator&&!!navigator.appVersion.match(/MSIE 8/),u.features.compatibleLayer=t.compat,u.lookup=function(e,r){if(void 0!==u.features[e])return void r(u.features[e]);o([e],function(o){if(true!==o&&false!==o)throw"Feature module "+e+" must return true or false.";u.features[e]=o,r(o)})},u.load=function(e,t,i,a){var n=r.parse(e);if("lookup"==n.type)u.lookup(n.feature,i);if("load_if"==n.type||"load_if_not"==n.type)u.lookup(n.feature,function(e){if(e&&"load_if"==n.type||!e&&"load_if_not"==n.type)o([n.yesModuleId],i,function(e){i.error(e)});else if(!e&&"load_if"==n.type&&n.noModuleId||e&&"load_if_not"==n.type&&n.noModuleId)o([n.noModuleId],i,function(e){i.error(e)});else i(u.empty())})},u})})();
//# sourceMappingURL=is.js.map
define("Core/MicroSession",["Core/cookie","Core/helpers/Object/isEmpty","Core/constants","Core/detection"],function(t,e){var s={_available:true,_ms:{},_msid:"",_storage:null,_sessionsLimit:5,_storageChangeHandler:function(t){if(!t)t=window.event;if("key"in t){if(t.key==this._msid&&null===t.newValue)try{localStorage.setItem(this._msid,JSON.stringify(this._ms))}catch(t){}}else if(!localStorage.getItem(this._msid))try{localStorage.setItem(this._msid,JSON.stringify(this._ms))}catch(t){}},syncMsid:function(){this._set("ws-msid",this._msid)},init:function(){var e=this;function s(t){var s=(t=t||window.event).target||t.srcElement;if(s.hasAttribute&&s.hasAttribute("href"))e.syncMsid()}if(this._prepareStorage(),!this._available)return;this._msid=this._getId();var i=this._get("ws-msid"),n=i?this._get(i):"";if(this._ms=n?JSON.parse(n):{},this._ms.sid=t.get("s3su"),this._set("ws-msid",""),this._set(this._msid,JSON.stringify(this._ms)),window.addEventListener)window.addEventListener("storage",this._storageChangeHandler.bind(this),false);else window.attachEvent("onstorage",this._storageChangeHandler.bind(this));if($(window).on("unload",function(){e._garbageCollector(),e.syncMsid()}),window.addEventListener)document.addEventListener("click",s,true);else document.attachEvent("onclick",s);(function(t){window.open=function(){e.syncMsid();var s;switch(arguments.length){case 1:s=t(arguments[0]);break;case 2:s=t(arguments[0],arguments[1]);break;case 3:s=t(arguments[0],arguments[1],arguments[2])}return s}})(window.open)},_prepareStorage:function(){if("undefined"!==typeof localStorage)this._storage=window.localStorage;else this._available=false},_get:function(t){var e;return e=this._storage.getItem(t),e="undefined"===e?void 0:e,e?e.toString():void 0},_set:function(t,e){try{this._storage.setItem(t,e)}catch(t){}},_garbageCollector:function(){var e=[],s=t.get("s3su"),i,n,r,a;for(n in this._storage)if(this._storage.hasOwnProperty?this._storage.hasOwnProperty(n):true)if(/^s\d+$/.exec(n))e.push(parseInt(n.substr(1),10));e.sort();while(e.length>this._sessionsLimit){try{this._storage.removeItem("s"+e[0])}catch(t){}e.shift()}for(n=0,r=e.length;n<r-1;++n){if(a=this._get("s"+e[n]),a)try{i=JSON.parse(a)}catch(t){i=null}else i=null;if(i&&(!i.hasOwnProperty("sid")||s!==i.sid))this._storage.removeItem("s"+e[n])}},_clear:function(){this._storage.clear()},clearCurrentSession:function(){if(this._available)this._ms={},this._set(this._msid,"{}");else return false},isEmpty:function(){return e(this.toObject())},_getId:function(){if(this._available)return["s",""+(new Date).getTime()].join("");else return""},set:function(t,e){if(this._available)this._ms[t]=e,this._set(this._msid,JSON.stringify(this._ms));else return false},get:function(t){if(this._available)return this._ms[t];else return false},setPermanently:function(t,e){this._set(t,e)},getPermanently:function(t){return this._get(t)},remove:function(t){if(this._available)delete this._ms[t],this._set(this._msid,JSON.stringify(this._ms));else return false},toObject:function(){return this._ms}};return s.init(),s});
//# sourceMappingURL=MicroSession.js.map
define("js!SBIS3.Contacts.Mixins.Interface.MessageActions.Delete",["Core/core-instance","Core/MicroSession","is!browser?js!SBIS3.CONTROLS.Utils.InformationPopupManager","i18n!SBIS3.Contacts.Mixins.Interface.MessageActions.Delete"],function(e,t,i){"use strict";return{$protected:{_options:{messagesRegistry:void 0}},before:{init:function(){this.once("onAfterShow",function(){var t=this,i=this._options.messagesRegistry;if(e.instanceOfModule(this,"SBIS3.CONTROLS/ListView"))t.subscribeTo(t,"onChangeHoveredItem",t._changeHoveredDelete),t._addDeleteActionToView();else if(i&&"string"!==typeof i)this.waitChildControlByName(i).addCallback(function(i){if(e.instanceOfModule(i,"SBIS3.CONTROLS/ListView"))i.subscribeTo(i,"onChangeHoveredItem",t._changeHoveredDelete),t._addDeleteActionToView.call(i)})})},isShowDeleteAction:function(e){return e.record&&e.record.get("МожноУдалить")}},_addDeleteActionToView:function(){var e=this,t=e.getItemsActions()?e.getItemsActions().getItems():null,i=t&&t.getCount()?t.getRawData():[];i.push({name:"deleteMessage",icon:"sprite:icon-16 icon-Erase icon-error",isMainAction:true,caption:rk("Удалить"),tooltip:rk("Удалить"),onActivated:e._handler_Delete}),e.setItemsActions(i)},_changeHoveredDelete:function(e,t){var i=this;if(t.record){var n=i.getItemsActions().getItemsInstances();if(n.hasOwnProperty("deleteMessage")){var o=n["deleteMessage"],s=i._isBeginEdit(t),a=i.isShowDeleteAction(t);o[!s&&a?"show":"hide"]()}}},_handler_Delete:function(e,n){var o=this,s=o.getItems().getRecordById(n).get("Я")[0],a=t.get("hideDeleteDialog");if(!s)if(!a)var r=function(){return['<div class="hideDeleteDialogContent" style="padding-left: 34px;"><component data-component="SBIS3.CONTROLS/CheckBox" name="hideDeleteDialog" class="position" ><option name="caption">',rk("Больше не показывать это окно"),'</option><option name="checked">false</option></component></div>'].join("")},c=i.showConfirmDialog({message:rk("Удалить это сообщение?"),detailsTemplate:r},function(){if(c.getChildControlByName("hideDeleteDialog").isChecked())a=true,t.set("hideDeleteDialog",a);o.getItems().doDeleteSentMessage([n])}.bind(c),function(){});else o.getItems().doDeleteSentMessage([n]);else o.getItems().doDeleteSentMessage([n])},_isBeginEdit:function(e){var t=this,i=e.record&&e.record.get("НачатаПравка")[0]?(new Date-new Date(e.record.get("НачатаПравка")[0]))/1e3:null;return i&&i<31||"function"==typeof t.isEdit&&t.isEdit()}}});
//# sourceMappingURL=Delete.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.EmptyViewInfo",["Core/core-instance"],function(e){"use strict";return{$protected:{_options:{messagesRegistry:void 0,emptyContext:rk("Нет контекста"),emptyHTMLView:void 0,emptySearch:void 0}},before:{init:function(){var t=this;if(e.instanceOfModule(t,"SBIS3.CONTROLS/ListView"))t.subscribeTo(t,"onReady",t._onReady__EmptyViewInfo.bind(t,t));else{var i=t._options.messagesRegistry;if(i&&"string"===typeof i)t.waitChildControlByName(i).addCallback(function(i){if(i.isDestroyed())return;if(i.setEmptyHTML(t._options.emptyHTMLView),e.instanceOfModule(i,"SBIS3.CONTROLS/ListView"))t.subscribeTo(i,"onReady",t._onReady__EmptyViewInfo.bind(t,i))})}}},_onReady__EmptyViewInfo:function(e){var t=this;e.setEmptyHTML(t._options.emptyHTMLView),t.subscribeTo(e,"onDataLoad",function(){t._setEmptyDataMessage(this.getFilter(),t._options)})},_setEmptyDataMessage:function(e,t){if(e)if(!e.hasOwnProperty("ТипСписка")||!e["ТипСписка"])this.setEmptyHTML(t.emptyContext);else if(e.hasOwnProperty("Поиск")&&e["Поиск"]||e.hasOwnProperty("ПоискПерсоны")&&e["ПоискПерсоны"])this.setEmptyHTML(t.emptySearch||t.emptyHTMLView);else this.setEmptyHTML(t.emptyHTMLView)}}});
//# sourceMappingURL=EmptyViewInfo.module.js.map
define("tmpl!SBIS3.Activity.ActivityHelper/activityMarker",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,c,s,l){function n(){}var o=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var p="string"==typeof c?c:"",v=void 0===r?void 0:r,y={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),m=this&&this.includedTemplates?this.includedTemplates:{},g=u.getMarkupGenerator(s);try{var h=g.joinElements([g.createTag("span",{class:"activity__ActivityMarker "+u.wrapUndef(u.utils.escape(u.getter(i,["useBorder"])?"activity__ActivityMarker-withBorder":""))+" icon-16 "+u.wrapUndef(u.utils.escape(u.getter(i,["markerClassName"])))+" "+u.wrapUndef(u.utils.escape(u.getter(i,["className"]))),title:""+u.wrapUndef(u.utils.escape(u.getter(i,["title"])||""))},[u.getter(i,["useBorder"])?[g.createTag("img",{src:""+u.wrapUndef(u.utils.escape(u.getter(i,["markerImage"])))},[],{},y,this)]:g.createText("")],a,y,this)],p,y);y.def&&(h=g.chain(h,y,a),y=void 0)}catch(e){u.templateError("resources/User_activity/ActivityHelper/activityMarker.tmpl",e,i)}return h||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Activity.ActivityHelper/activityMarker"}},i});
//# sourceMappingURL=activityMarker.tmpl.map
define("js!SBIS3.Activity.ActivityHelper",["tmpl!SBIS3.Activity.ActivityHelper/activityMarker","Core/core-instance","WS.Data/Chain","Core/helpers/Function/debounce","Core/helpers/vital/processImagePath","css!SBIS3.Activity.ActivityHelper/ActivityHelper"],function(e,t,i,r,n){var a=[],o={},c;c=r(function e(){a.forEach(function(e){u.apply(null,e)}),a.length=0},100);function s(e){this._data=e}s.prototype.get=function(e){return this._data[e]};function l(e,t,i){var r=false,n=f(i);if(e)r|=o[e]!=n;if(t)r|=o[t]!=n;if(r){if(a.push([e,t,i]),e)o[e]=n;if(t)o[t]=n;c()}}function u(e,t,i){var r=$(),n;if(t)r=r.add(".activity__ActivityMarker.activity__ActivityMarker__person"+t);if(e)r=r.add(".activity__ActivityMarker.activity__ActivityMarker__user"+e);if(r.attr("title",p(i)).removeClass("icon-hover icon-disabled icon-PhoneGetManually icon-PhoneGetAutomatically").addClass(y(i)),r.hasClass("activity__ActivityMarker-withBorder"))n=v(i),r.find("img").attr("src",n).toggleClass("ws-hidden",!n)}function f(e){return[e.get("comment"),e.get("className"),e.get("atWorkplace"),e.get("online")].join("#")}function y(e){var t=e.get("user"),i=e.get("person");return[e.get("online")?"icon-hover":"icon-disabled",e.get("atWorkplace")?"icon-PhoneGetAutomatically":"icon-PhoneGetManually",e.get("className")||"",t?"activity__ActivityMarker__user"+t:"",i?"activity__ActivityMarker__person"+i:""].join(" ")}function v(e){var t;switch((e.get("atWorkplace")?2:0)+(e.get("online")?1:0)){case 3:t="on-line-marker-at-work";break;case 2:t="off-line-marker";break;case 1:t="on-line-marker";break;default:t=""}return t&&n("js!SBIS3.Activity.ActivityHelper/images/"+t+".png")}function p(e){var t=e.get("comment");if(t)return rk(t);else return[rk(e.get("atWorkplace")?"На рабочем месте":"Не на рабочем месте"),rk(e.get("online")?"активен":"неактивен")].join(", ")}function d(e){if(e&&"object"==typeof e&&(!e.get||"function"!==typeof e.get))return new s(e);else return e}function g(e){if(t.instanceOfModule(e,"Deprecated/Record")||t.instanceOfModule(e,"WS.Data/Entity/Model")||t.instanceOfModule(e,"WS.Data/Entity/Record"))return new i(e).toObject();return e}function k(e,t){if(t)return{get:function(i){return e.get(t[i]||i)}};else return e}return{activityMarker:function(t,i){var r,n,a,o,c=false;if(i&&"object"===typeof i)o=i.className||"",r=i.mapping,c=!!i.useBorder;else if("string"===typeof i)o=i;if(t){if(t=k(d(g(t)),r),n=t.get("user"),a=t.get("person"),"undefined"!==typeof window&&(n||a))l(n,a,t);return e({userID:n,personUUID:a,markerClassName:y(t),useBorder:c,markerImage:c&&v(t),className:o||"",title:p(t)})}else return""}}});
//# sourceMappingURL=ActivityHelper.module.js.map
define("js!SBIS3.Contacts.CachingActivity",["Core/core-instance","Core/Deferred","Core/Abstract","js!WS.Data/Source/SbisService","js!WS.Data/Entity/Record","js!WS.Data/Adapter/Json","js!SBIS3.Activity.ActivityHelper"],function(e,t,a,r,c){"use strict";var n=1e4;return new(a.extend({$protected:{_activityCache:{}},_updateCacheRecord:function(e,t,a){a[e.get("person")]={record:e,updateDate:t}},_addPersonsToCache:function(t){if(e.instanceOfModule(t,"WS.Data/Collection/RecordSet")&&t.getCount()){var a=new Date,r=this;t.each(function(e){r._updateCacheRecord(e,a,r._activityCache)})}},getPersonsFromCache:function(e){var a=this,c=new Date,i=[],o,s,d=function(){i=[],o=[];for(var t=0;t<e.length;t++)if(s=a._activityCache[e[t]],s&&c-s.updateDate<n)i.push(s.record);else o.push(e[t]);return o};if(o=d(),o.length){var u=new r({endpoint:{address:"/activity/service/",contract:"Местоположение"}}),l=new t;return u.call("GetActivity",{person_uuids:o,users:[]}).addCallbacks(function(e){a._addPersonsToCache(e.getAll()),d(),l.callback(i)},function(e){l.errback(e)}),l}else return t.success(i)},getRenderData:function(e){var t=this._activityCache[e];if(t)return t.record;else return new c({rawData:{person:e,atWorkplace:false,online:false},adapter:"adapter.json"})}}))});
//# sourceMappingURL=CachingActivity.module.js.map
define("Contacts.Base/Utils/Manager/Base",["Core/Abstract","Core/IoC","Core/core-instance"],function(e,i,t){var n=e.extend({$protected:{_options:{view:null},_view:null,_viewChecked:false},init:function(){if(n.superclass.init.call(this),this._view=this._options.view,this._viewChecked=this._checkView(this._view),this._viewChecked)this.subscribeTo(this._view,"onDestroy",function(){this.destroy()}.bind(this))},getView:function(){return this._view},isViewValid:function(){return this._viewChecked},_checkView:function(e){if(!e||!t.instanceOfModule(e,"SBIS3.CONTROLS/ListView"))return i.resolve("ILogger").log("ViewExpander.init","Переданы не все ключевые компоненты"),false;return true}});return n});
//# sourceMappingURL=Base.js.map
define("Contacts.Base/Utils/Manager/DataLoaderBase",["Contacts.Base/Utils/Manager/Base","Core/IoC","js!WS.Data/Chain","Core/core-instance"],function(t,i,e,n){"use strict";var s=t.extend({$protected:{_options:{view:null,items:null}},init:function(){if(s.superclass.init.call(this),this._initSource(),this._initHandlers(),!this.isViewValid())return;this._prepareComponents(),this.subscribe("onDestroy",function(){this._options.view=null,this._options.items=null})},_initSource:function(){return null},_initHandlers:function(){this._collectFunction=function(t){setTimeout(this._collectData.bind(this,t),50)}.bind(this)},_prepareComponents:function(){var t=this._options.items;if(t)this.collectByItems(t),this._subscribeList(t)},collectByItems:function(t){if(t&&n.instanceOfModule(t,"WS.Data/Collection/RecordSet")){var s=new e(t);this._collectFunction(s.toArray())}else i.resolve("ILogger").log("ManagerBase.collectByItems","Нужно передать RecordSet")},collect:function(t){this._collectFunction(t)},_collectData:function(t){}});return s});
//# sourceMappingURL=DataLoaderBase.js.map
define("js!SBIS3.Contacts.PersonActivityManager",["Contacts.Base/Utils/Manager/DataLoaderBase","Core/core-instance","Core/IoC","js!SBIS3.Activity.ActivityHelper","js!SBIS3.Contacts.CachingActivity","js!WS.Data/Entity/Record","js!WS.Data/Chain"],function(t,e,i,s,n,a,o){"use strict";var r=t.extend({$protected:{_options:{view:null,list:null,dataHandler:null,personGUIDGetter:null,isDual:false,templateData:true,storeDataInModel:false},_dataHandler:null,_collectFunction:null},init:function(){r.superclass.init.call(this)},_prepareComponents:function(){r.superclass._prepareComponents.call(this);var t=this._options.view,s=this._options.list,n=this._options.dataHandler;if(t&&e.instanceOfModule(t,"SBIS3.CONTROLS/ListView"))this._subscribeView();else if(s&&e.instanceOfModule(s,"WS.Data/Collection/RecordSet"))this._subscribeList(s);else if(n&&"function"===typeof n)return void(this._dataHandler=n);else i.resolve("ILogger").log("PersonActivityManager.init","Не переданы ключевые компоненты для запроса активности");this._dataHandler=this._processCollectedActivity,this.subscribeTo(this,"onDestroy",function(){if(this._options.view=null,this._options.list=null,this._dataHandler=null,this._tickerHandlerBinded=null,this._prevDataSet)this.unsubscribeFrom(this._prevDataSet,"onCollectionChange"),this._prevDataSet=null})},_subscribeView:function(){var t=this._options.view;if(t.isDestroyed())return;this.subscribeTo(t,"onDataLoad",function(t,e){if(!e.isDestroyed()){this.appendClientsFields(e);var i=new o(e);this._collectFunction(i.toArray())}}.bind(this)),this.subscribeTo(t,"onItemsReady",function(){this._options.list=t.getItems(),this._subscribeList(this._options.list)}.bind(this)),this.subscribeTo(t,"onDataMerge",function(t,e){this.appendClientsFields(e)}.bind(this))},_subscribeList:function(t){var e=this;if(e._prevDataSet)e.unsubscribeFrom(e._prevDataSet,"onCollectionChange"),e._prevDataSet=null;e._prevDataSet=t,this.subscribeTo(t,"onCollectionChange",function(t,i,s,n,a){var o="a"===i;if(o||"rp"===i){var r=s&&s.length?s[0]:null,l=a&&a.length?a[0]:null;if(o&&r||r&&l&&(r.get("Сообщение")!==l.get("Сообщение")||r.get("СообщениеПоследнее")!==l.get("СообщениеПоследнее"))){if(o)s.forEach(function(t){e.appendClientsFields(t)});e._collectFunction(s)}}})},_collectData:function(t){for(var i=[],r={},l=this._options.personGUIDGetter,c=function(t,e){if(this[t]){if(-1===this[t].indexOf(e))this[t].push(e)}else this[t]=[e]},u,d=0,h=t.length;d<h;d++){var f=t[d];if(f.isDestroyed()||f.get("Раздел@"))continue;if(this._options.isDual)for(var p=(u=l.call(t[d])).length;p--;){if(!u[p])continue;if(i.push(u[p]),!r[p])r[p]={};c.call(r[p],u[p],d)}else{if(u=l.call(t[d]),!u)continue;if(this._options.storeDataInModel)if(!e.instanceOfModule(f.getAdapter(),"WS.Data/Adapter/Json")){var v=n.getRenderData(u),_=new o(v),g=new a({adapter:"adapter.sbis",format:v.getFormat()});g.set(_.toObject()),t[d].set("КонтактАктивностьОбъект",this._options.templateData?g:s.activityMarker(g,{className:"contacts-PersonPhoto-activity",useBorder:true}))}if(i.indexOf(u)<0)i.push(u);c.call(r,u,d)}}if(i.length)this.getActivityData(i,r,t)},getActivityData:function(t,e,s){var a=this;if(t&&t.length)n.getPersonsFromCache(t).addCallback(function(t){if(t.length)try{if(a._options.view&&!a._options.view.isDestroyed())a._dataHandler(t,this.ids,this.items)}catch(t){i.resolve("ILogger").error("PersonActivityManager.getBLActivityData",t.stack)}}.bind({ids:e,items:s}))},_processCollectedActivity:function(t){t.forEach(function(t){s.activityMarker(t,{className:"contacts-PersonPhoto-activity",useBorder:true})})},appendClientsFields:function(t){if(!this._options.storeDataInModel)return;var s=false,n=this._options.isDual,a=this._options.templateData,o={name:"КонтактАктивностьОбъект",type:n?"array":a?"record":"string",defaultValue:n?[null,null]:null,nullable:!n};try{if(e.instanceOfMixin(t,"WS.Data/Entity/FormattableMixin"))if(t.has&&t.getOwner){if(!t.has("КонтактАктивностьОбъект")&&!t.getOwner())t.addField(o),s=true}else if(t.getFormat&&t.getFormat().getFieldIndex("КонтактАктивностьОбъект")<0)t.addField(o),s=true}catch(t){i.resolve("ILogger").error("PersonActivityManager.appendClientsFields",t.stack),s=false}return s}});return r});
//# sourceMappingURL=PersonActivity.module.js.map
define("js!SBIS3.CONTROLS.Link",["SBIS3.CONTROLS/Link"],function(n){return n});
//# sourceMappingURL=Link.module.js.map
define("js!SBIS3.CONTROLS.Button",["SBIS3.CONTROLS/Button"],function(n){return n});
//# sourceMappingURL=Button.module.js.map
define("tmpl!SBIS3.Contacts.ServiceMessageBase/ServiceMessage",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS.Link","js!SBIS3.CONTROLS.Button"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS.Link"]=e[1],r["js!SBIS3.CONTROLS.Button"]=e[2];var s=function e(s,a,c,i,o){function n(){}var l=0,v=void 0!==t&&t?t:arguments[arguments.length-1];void 0===v&&(eval("var thelpers = null;"),v=global.requirejs("View/Runner/tclosure"));var u={};o&&o.isSetts&&(u=o.fullContext||{});var g="string"==typeof c?c:"",p=void 0===r?void 0:r,d={id:[],def:void 0},S=v.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),b=this&&this.includedTemplates?this.includedTemplates:{},f=v.getMarkupGenerator(i);try{var m=f.joinElements([f.createTag("div",{class:"contacts-ServiceMessageBase service-message "+v.wrapUndef(v.utils.escape(v.getter(s,["serviceObject","buttons"])?"with-buttons":""))},[v.getter(s,["serviceObject"])&&v.getter(s,["serviceObject","serviceIcon"])?[f.createTag("div",{class:"service-message-icon "+v.wrapUndef(v.utils.escape(v.getter(s,["serviceObject","serviceIcon"])))},[],{},d,this)]:f.createText(""),v.getter(s,["serviceObject","serviceMessage"])?[f.createTag("div",{class:"contacts-ServiceMessageBase__message",style:""+v.wrapUndef(v.utils.escape(v.getter(s,["style"])))},[f.createText(""+v.wrapUndef(v.Sanitize.apply(void 0,[v.getDecorators().sanitize.apply(void 0,[v.getter(s,["serviceObject","serviceMessage"])])])))],{},d,this)]:f.createText(""),v.getter(s,["serviceObject","labels"])?[f.createTag("div",{class:"contacts-ServiceMessageBase__labels",style:""+v.wrapUndef(v.utils.escape(v.getter(s,["style"])))},[function(){for(var e=void 0,t=0;t<v.iterators.length&&!e;t++)v.iterators[t].is(v.utils.escape(v.getter(s,["serviceObject","labels"])))&&(e=v.iterators[t].iterator);var r=[];return function(){var t=v.createScope(s);if(s=t,e){var a=c,o=0;e(v.utils.escape(v.getter(s,["serviceObject","labels"])),function(e,t){v.presetScope(e,s,t,{value:"label"}),c&&void 0!==i&&i&&(c=a+"-for_"+o,o++);var n=[f.createTag("div",{style:""+v.wrapUndef(v.utils.escape(v.getter(s,["label","color"])?"color: "+v.getter(s,["label","color"]):""))},[f.createText(""+v.wrapUndef(v.utils.escape(v.getter(s,["label","caption"]))))],{},d,this)];void 0===n[0]&&void 0!==i&&i||(r=r.concat(n))}.bind(s))}else r=""}.call(s),r}()],{},d,this)]:f.createText(""),v.getter(s,["serviceObject","links"])?[f.createTag("div",{class:"contacts-ServiceMessageBase__links",style:""+v.wrapUndef(v.utils.escape(v.getter(s,["style"])))},[function(){for(var e=void 0,t=0;t<v.iterators.length&&!e;t++)v.iterators[t].is(v.utils.escape(v.getter(s,["serviceObject","links"])))&&(e=v.iterators[t].iterator);var r=[];return function(){var t=v.createScope(s);if(s=t,e){var a=c,o=0;e(v.utils.escape(v.getter(s,["serviceObject","links"])),function(e,t){v.presetScope(e,s,t,{value:"link"}),c&&void 0!==i&&i&&(c=a+"-for_"+o,o++);var n=[v.getter(s,["showButtons"])||v.getter(s,["link","showForAll"])?[f.createControl("wsControl","ws:SBIS3.CONTROLS.Link",{handlers:{onActivated:v.getTypeFunc("js!SBIS3.Contacts.ServiceMessageBase:prototype._onLinkActivate",{})},style:v.getter(s,["style"])+(v.getter(s,["link","color"])?"color: "+v.getter(s,["link","color"])+";":""),name:v.getter(s,["link","name"]),caption:v.getter(s,["link","caption"]),tooltip:v.getter(s,["link","caption"]),className:"contacts-serviceMessage__"+v.getter(s,["type"]),esc:!1},{name:v.getter(s,["link","name"]),sbisname:v.getter(s,["link","name"])},{data:s,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},c,p,b,v.config,u)]:f.createText("")];void 0===n[0]&&void 0!==i&&i||(r=r.concat(n))}.bind(s))}else r=""}.call(s),r}()],{},d,this)]:f.createText(""),v.getter(s,["serviceObject","buttons"])?[f.createTag("div",{class:"contacts-ServiceMessageBase__buttons"},[function(){for(var e=void 0,t=0;t<v.iterators.length&&!e;t++)v.iterators[t].is(v.utils.escape(v.getter(s,["serviceObject","buttons"])))&&(e=v.iterators[t].iterator);var r=[];return function(){var t=v.createScope(s);if(s=t,e){var a=c,o=0;e(v.utils.escape(v.getter(s,["serviceObject","buttons"])),function(e,t){v.presetScope(e,s,t,{value:"button"}),c&&void 0!==i&&i&&(c=a+"-for_"+o,o++);var n=[v.getter(s,["showButtons"])||v.getter(s,["button","showForAll"])?[f.createControl("wsControl","ws:SBIS3.CONTROLS.Button",{handlers:{onActivated:v.getTypeFunc("js!SBIS3.Contacts.ServiceMessageBase:prototype._onButtonActivate",{})},name:v.getter(s,["button","name"]),caption:v.getter(s,["button","caption"]),esc:!1},{class:"contacts-ServiceMessageBase__buttons-item                        "+v.utils.escape(v.getter(s,["button","className"])?" "+v.getter(s,["button","className"]):"")+v.utils.escape(v.getter(s,["button","active"])?" controls-Button__primary":""),name:v.getter(s,["button","name"]),sbisname:v.getter(s,["button","name"])},{data:s,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},c,p,b,v.config,u)]:f.createText("")];void 0===n[0]&&void 0!==i&&i||(r=r.concat(n))}.bind(s))}else r=""}.call(s),r}()],{},d,this)]:f.createText("")],a,d,this)],g,d);d.def&&(m=f.chain(m,d,a),d=void 0)}catch(e){v.templateError("resources/Contacts.Mini/ServiceMessage.tmpl",e,s)}return m||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.ServiceMessageBase/ServiceMessage"}},s});
//# sourceMappingURL=ServiceMessage.tmpl.map
define("js!SBIS3.Contacts.ServiceMessageBase",["js!SBIS3.CONTROLS.CompoundControl","tmpl!SBIS3.Contacts.ServiceMessageBase/ServiceMessage","css!SBIS3.Contacts.ServiceMessageBase/ServiceMessage","js!SBIS3.CONTROLS.Button","js!SBIS3.CONTROLS.Link"],function(e,t){var i=e.extend({_dotTplFn:t,$protected:{_options:{type:"",serviceObject:null,key:"",style:"",showButtons:true,activableByClick:false}},_modifyOptions:function(){var e=i.superclass._modifyOptions.apply(this,arguments),t=e.serviceObject;if(t&&!n){var n="";if(t.serviceMessageColor)n+="color: "+t.serviceMessageColor+";";if(t.serviceMessageFontSize)n+="font-size: "+t.serviceMessageFontSize+"px;";if(t.links||t.serviceIcon)n+="display: inline;";e.style=n}return e},$constructor:function(){},init:function(){i.superclass.init.call(this),this.subscribeTo(this,"onAfterShow",this._handlerOnAfterShow)},_callHandler:function(e,t,i,n,s){var r=e.split(":"),o=null,a=this;if(r.length>1){var c=r[0],l=r[1];if(t)o=i.getParent().getDataSet().getRecordById(t);if(c&&l){var f=l.split("."),v;if(f.length>1)v=f[0],l=f[1];require([c],function(e){if(v)e[v][l].bind(a)(n,s,o);else e[l].bind(a)(n,s,o)})}}},_handlerOnAfterShow:function(){var e=this,t=e._options.serviceObject;if(!t)return;if(t.links&&t.links.length&&!e.isEnabled())e.setEnabled(true);if(t.handlers&&t.handlers.onShow)e._callHandler(t.handlers.onShow,e._options.key,e,arguments[0],t)},_serviceObjectActivate:function(e){var t=this,i=t.getParent(),n=i._options.serviceObject,s;if(n[e]){s=false;for(var r=0;r<n[e].length;r++)if(n[e][r].name===t._options.name){s=n[e][r];break}if(s&&s.handler)i._callHandler.bind(i)(s.handler,i._options.key,i,arguments[0],n)}},_onButtonActivate:function(){this.setEnabled(false),this.getParent()._serviceObjectActivate.bind(this)("buttons")},_onLinkActivate:function(){this.getParent()._serviceObjectActivate.bind(this)("links")}});return i});
//# sourceMappingURL=ServiceMessage.module.js.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MiniServiceMessageBlock",["Core/tmpl/js/tclosure","js!SBIS3.Contacts.ServiceMessageBase"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.Contacts.ServiceMessageBase"]=e[1];var i=function e(i,s,a,n,c){function o(){}var l=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var g={};c&&c.isSetts&&(g=c.fullContext||{});var p="string"==typeof a?a:"",v=void 0===r?void 0:r,m={id:[],def:void 0},u=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),S=this&&this.includedTemplates?this.includedTemplates:{},M=d.getMarkupGenerator(n);try{var f=M.joinElements([d.getter(i,["item","get"]).apply(d.getter(i,["item"]),["ServiceObject"])?[M.createControl("wsControl","ws:SBIS3.Contacts.ServiceMessageBase",{name:"ServiceMessage_"+d.getter(i,["id"]),type:d.getter(d.getter(i,["item","get"]).apply(d.getter(i,["item"]),["СлужебныйТип"]),[d.getter(i,["index"])]),serviceObject:d.getter(i,["item","get"]).apply(d.getter(i,["item"]),[d.getter(i,["serviceField"])||"ServiceObject"]),key:d.getter(i,["item","getId"]).apply(d.getter(i,["item"]),[])},{class:d.utils.escape(d.getter(i,["className"])),name:"ServiceMessage_"+d.getter(i,["id"]),sbisname:"ServiceMessage_"+d.getter(i,["id"])},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:u},a,v,S,d.config,g)]:M.createText("")],p,m);m.def&&(f=M.chain(f,m,s),m=void 0)}catch(e){d.templateError("resources/Contacts.Mini/Models/templates/MiniServiceMessageBlock.tmpl",e,i)}return f||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MiniServiceMessageBlock"}},i});
//# sourceMappingURL=MiniServiceMessageBlock.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageTitleBlock",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},a=function e(a,i,s,g,p){function l(){}var n=0,m=void 0!==t&&t?t:arguments[arguments.length-1];void 0===m&&(eval("var thelpers = null;"),m=global.requirejs("View/Runner/tclosure"));var d={};p&&p.isSetts&&(d=p.fullContext||{});var o="string"==typeof s?s:"",c=void 0===r?void 0:r,y={id:[],def:void 0},f=m.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),u=this&&this.includedTemplates?this.includedTemplates:{},h=m.getMarkupGenerator(g);try{var x=h.joinElements([h.createTag("div",{class:m.wrapUndef(m.utils.escape(m.getter(a,["item","getClassName"]).apply(m.getter(a,["item"]),["MessageTitle>wrapBlock"])))+" contacts-ThemeMessage__title "+m.wrapUndef(m.utils.escape(m.getter(a,["item","isDiscussion"]).apply(m.getter(a,["item"]),[])?"":"contacts-ThemeMessage__from-me-margin__reverse"))+"            ws-flexbox ws-justify-content-start ws-flex-nowrap "+m.wrapUndef(m.utils.escape(m.getter(a,["className"])))},[m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["NeedPersonName",m.getter(a,["index"])])?[h.createTag("div",{class:m.wrapUndef(m.utils.escape(m.getter(a,["item","getClassName"]).apply(m.getter(a,["item"]),["MessageTitle>personName"])))+" message-person-name ws-flex-shrink-0 contacts-Modify__person-name fade-mask--right            "+m.wrapUndef(m.utils.escape(!m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["hideFadeMask"])||m.getter(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["hideFadeMask"]),["message-person-name"])?"fade-mask--hidden":""))+"            "+m.wrapUndef(m.utils.escape(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["PersonNameClickable",m.getter(a,["index"])])?" contacts-IsClickable":""))+"            "+m.wrapUndef(m.utils.escape(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["NeedPersonNameCount"])?" with-count":"")),title:""+m.wrapUndef(m.utils.escape(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["PersonTitle",m.getter(a,["index"])]))),"data-clickable":""+m.wrapUndef(m.utils.escape(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["PersonNameClickable",m.getter(a,["index"])]))),"data-personguid":""+m.wrapUndef(m.utils.escape(m.getter(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["КонтактПерсона"]),[m.getter(a,["index"])||0])))},[h.createText(" "+m.wrapUndef(m.Sanitize.apply(void 0,[m.getDecorators().sanitize.apply(void 0,[m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["PersonName",m.getter(a,["index"])])])]))+" ")],{},y,this),m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["NeedPersonNameCount"])?[h.createTag("div",{title:""+m.wrapUndef(m.utils.escape(m.getter(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["ЕщёNTitle"]),[m.getter(a,["index"])]))),class:"participants-count ws-flex-shrink-0"},[h.createText("(+"+m.wrapUndef(m.utils.escape(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["ReceiversOtherCount",m.getter(a,["index"])])))+")")],{},y,this)]:h.createText("")]:h.createText(""),m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["NeedPersonPlace",m.getter(a,["index"])])?[m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["EmploymentName",m.getter(a,["index"])])?[m.getter(a,["item","isDiscussion"]).apply(m.getter(a,["item"]),[])&&m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["NeedPersonName",m.getter(a,["index"])])?[h.createTag("div",{class:"title-separator ws-flex-shrink-0"},[h.createText(""+global.rk("/"))],{},y,this)]:h.createText(""),h.createControl("resolver",m.getter(a,["item","_personEmployment"]),{employmentName:m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["EmploymentName",m.getter(a,["index"])]),isDepartment:m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["IsDepartment"]),miniCardAttributes:m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["EmploymentCardAttributes",m.getter(a,["index"])]),className:"person-place ws-flex-shrink-4 fade-mask--right                        "+(!m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["hideFadeMask"])||m.getter(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["hideFadeMask"]),["person-place"])?" fade-mask--hidden":"")},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},s,c,u,m.config,d,y)]:h.createText(""),!m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["УчастникиТемы"])||m.getter(a,["item","isSubChat"]).apply(m.getter(a,["item"]),[])||m.getter(a,["item","isSubDiscussion"]).apply(m.getter(a,["item"]),[])?h.createText(""):[h.createTag("div",{class:" theme-participants ws-flex-shrink-3 fade-mask--right               "+m.wrapUndef(m.utils.escape(!m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["hideFadeMask"])||m.getter(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["hideFadeMask"]),["theme-participants"])?"fade-mask--hidden":""))},[h.createTag("span",{class:"vertical-slash"},[h.createText(""+global.rk("|"))],{},y,this),h.createTag("span",{class:"icon-16 icon-EmptyMessage icon-disabled"},[],{},y,this),h.createText(" "+m.wrapUndef(m.Sanitize.apply(void 0,[m.getDecorators().sanitize.apply(void 0,[m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["УчастникиТемы"])])]))+" ")],{},y,this)]]:h.createText(""),m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["NeedReceivers",m.getter(a,["index"])])?[h.createTag("div",{class:"message-receivers ws-flex-shrink-2 contacts-Modify__message-receivers fade-mask--right            "+m.wrapUndef(m.utils.escape(!m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["hideFadeMask"])||m.getter(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["hideFadeMask"]),["message-receivers"])?"fade-mask--hidden":"")),title:""+m.wrapUndef(m.utils.escape(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["ReceiversTitle",m.getter(a,["index"])])))},[h.createText(" "+m.wrapUndef(m.utils.escape(m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["ReceiversCountString",m.getter(a,["index"])])))+" "+m.wrapUndef(m.Sanitize.apply(void 0,[m.getDecorators().sanitize.apply(void 0,[m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["ReceiversString",m.getter(a,["index"])])])]))+" ")],{},y,this)]:h.createText(""),m.getter(a,["item","isDialogs"]).apply(m.getter(a,["item"]),[])?[h.createControl("resolver",m.getter(a,["item","_tagsTpl"]),{themeUUID:m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["Тема"]),activateHandler:m.getter(a,["item","_tagItemActivate"]),removeHandler:m.getter(a,["item","_tagItemRemove"]),showInfoboxHandler:m.getter(a,["item","_tagInfoboxShow"]),hideInfoboxHandler:m.getter(a,["item","_tagInfoboxHide"]),initCompleteHandler:m.getter(a,["item","_tagInitComplete"])},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},s,c,u,m.config,d,y),h.createControl("resolver",m.getter(a,["item","_dateAndIconsTpl"]),{className:"contacts-Modify__time-date ws-flex-shrink-0",item:m.getter(a,["item"]),index:m.getter(a,["index"])||0,date:m.getter(a,["ladder"])&&!m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["IsOldDate",m.getter(a,["index"])])?m.getter(a,["item","getMessageDate"]).apply(m.getter(a,["item"]),[m.getter(a,["ladder","get"]).apply(m.getter(a,["ladder"]),[m.getter(a,["item"]),m.getter(a,["index"])?"DateCheck1":"DateCheck"]),m.getter(a,["index"])]):m.getter(a,["item","get"]).apply(m.getter(a,["item"]),["DateCheck",m.getter(a,["index"])])},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},s,c,u,m.config,d,y)]:h.createText("")],i,y,this)],o,y);y.def&&(x=h.chain(x,y,i),y=void 0)}catch(e){m.templateError("resources/Contacts.Mini/Models/templates/MessageTitleBlock.tmpl",e,a)}return x||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageTitleBlock"}},a});
//# sourceMappingURL=MessageTitleBlock.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageTextBlock",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],a={},s=function e(s,r,l,i,o){function n(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};o&&o.isSetts&&(p=o.fullContext||{});var g="string"==typeof l?l:"",u=void 0===a?void 0:a,v={id:[],def:void 0},m=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),f=this&&this.includedTemplates?this.includedTemplates:{},x=d.getMarkupGenerator(i);try{var T=x.joinElements([d.getter(s,["text"])?[x.createTag("div",{class:"message-text ws-basic-style contacts-Modify__message-text "+d.wrapUndef(d.utils.escape(d.getter(s,["className"])))},[d.getter(s,["needLimiter"])?[x.createTag("div",{class:"text-expand-button"},[x.createTag("span",{title:""+global.rk("Сообщение показано не полностью")},[x.createText(""+global.rk("..."))],{},v,this)],{},v,this)]:x.createText(""),d.getter(s,["needDateFloat"])?[x.createTag("span",{class:"date-float "+d.wrapUndef(d.utils.escape(d.getter(s,["dateFloatClassName"])))},[],{},v,this)]:x.createText(""),x.createText(" "+d.wrapUndef(d.Sanitize.apply(void 0,[d.getDecorators().sanitize.apply(void 0,[d.getter(s,["text"])])]))+" "),d.getter(s,["needCollapse"])?[x.createTag("div",{class:"text-collapse-button"},[x.createTag("span",{title:""+global.rk("Свернуть текст сообщения")},[x.createText(""+global.rk("Свернуть"))],{},v,this)],{},v,this)]:x.createText("")],{},v,this)]:x.createText("")],g,v);v.def&&(T=x.chain(T,v,r),v=void 0)}catch(e){d.templateError("resources/Contacts.Mini/Models/templates/MessageTextBlock.tmpl",e,s)}return T||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageTextBlock"}},s});
//# sourceMappingURL=MessageTextBlock.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageItem",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},a=function e(a,i,g,s,p){function o(){}var l=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var n={};p&&p.isSetts&&(n=p.fullContext||{});var m="string"==typeof g?g:"",c=void 0===r?void 0:r,u={id:[],def:void 0},y=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),f=this&&this.includedTemplates?this.includedTemplates:{},h=d.getMarkupGenerator(s);try{var w=h.joinElements([h.createTag("div",{class:d.wrapUndef(d.utils.escape(d.getter(a,["item","getClassName"]).apply(d.getter(a,["item"]),["MessageItem>row"])))+" contacts-ThemeMessage-row contacts-Modify__message-row "+d.wrapUndef(d.utils.escape(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["RowSelector",d.getter(a,["index"])])))+" "+d.wrapUndef(d.utils.escape(d.getter(a,["className"])))+"            "+d.wrapUndef(d.utils.escape(d.getter(a,["drawHiddenGroup"])?" ws-hidden":""))+" "+d.wrapUndef(d.utils.escape(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["IsUnviewedDialog"])?" contacts-ThemeMessage__unviewedDialog":"")),"data-hash":""+d.wrapUndef(d.utils.escape(d.getter(a,["item","isPairs"]).apply(d.getter(a,["item"]),[])?"":d.getter(a,["projItem","getHash"]).apply(d.getter(a,["projItem"]),[]))),"data-id":""+d.wrapUndef(d.utils.escape(d.getter(a,["item","isPairs"]).apply(d.getter(a,["item"]),[])?"":d.getter(a,["item","getId"]).apply(d.getter(a,["item"]),[]))),"data-separatorid":""+d.wrapUndef(d.utils.escape(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["GroupId"]))),"data-folderid":""+d.wrapUndef(d.utils.escape(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["Раздел"]))),"data-personguid":""+d.wrapUndef(d.utils.escape(d.getter(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["КонтактПерсона"]),[d.getter(a,["index"])||0]))),"data-clientid":""+d.wrapUndef(d.utils.escape(d.getter(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["КонтактКлиент"]),[d.getter(a,["index"])||0]))),"data-themeguid":""+d.wrapUndef(d.utils.escape(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["Тема"]))),"data-messageguid":""+d.wrapUndef(d.utils.escape(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["MessageGUID",d.getter(a,["index"])]))),"data-documentguid":""+d.wrapUndef(d.utils.escape(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["Документ"]))),"data-read-owner":""+d.wrapUndef(d.utils.escape(d.getter(a,["item","isChat"]).apply(d.getter(a,["item"]),[])?d.getter(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["ПрочитаноВладельцем"]),[d.getter(a,["index"])||0]):""))},[d.getter(a,["item","_groupSeparatorTpl"])&&d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["IsGroupTitle"])?[h.createControl("resolver",d.getter(a,["item","_groupSeparatorTpl"]),{item:d.getter(a,["item"])},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:y},g,c,f,d.config,n,u)]:h.createText(""),d.getter(a,["item","isDialogs"]).apply(d.getter(a,["item"]),[])||d.getter(a,["item","isContactMsg"]).apply(d.getter(a,["item"]),[])?[h.createTag("span",{class:"controls-ListView__itemCheckBox js-controls-ListView__itemCheckBox"},[],{},u,this)]:h.createText(""),d.getter(a,["item","isChat"]).apply(d.getter(a,["item"]),[])&&d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["IsHiddenRow"])&&d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["IsGroupTitle"])&&"unreadGroup"!==d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["ДляИнтерфейса"])?h.createText(""):[h.createControl("resolver",d.getter(a,["item","_personPhoto"]),{size:d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["PhotoSize"]),className:"person-photo contacts-Modify__person-photo",photoURL:d.getter(a,["item","isDialogs"]).apply(d.getter(a,["item"]),[])&&d.getter(a,["ladder"])?d.getter(a,["ladder","get"]).apply(d.getter(a,["ladder"]),[d.getter(a,["item"]),"PhotoLink"]):d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["PhotoLink",d.getter(a,["index"])]),srcSetPhotoURL:d.getter(a,["item","isDialogs"]).apply(d.getter(a,["item"]),[])&&d.getter(a,["ladder"])?d.getter(a,["ladder","get"]).apply(d.getter(a,["ladder"]),[d.getter(a,["item"]),"SrcSetPhotoLink"]):d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["SrcSetPhotoLink",d.getter(a,["index"])]),activity:d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["ActivityData",d.getter(a,["index"])]),miniCardAttributes:d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["ContactCardAttributes",d.getter(a,["index"])])},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:y},g,c,f,d.config,n,u),d.getter(d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["Я"]),[d.getter(a,["index"])||0])&&d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["NeedOutputBubble"])?[h.createTag("div",{class:d.wrapUndef(d.utils.escape(d.getter(a,["item","getClassName"]).apply(d.getter(a,["item"]),["MessageItem>outputBlock"])))+" contacts-ThemeMessage-output__content-wrapper contacts-Modify__output-content-wrapper"},[h.createControl("resolver",d.getter(a,["item","_messageContentTpl"]),{item:d.getter(a,["item"]),index:d.getter(a,["index"])||0},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:y},g,c,f,d.config,n,u)],{},u,this)]:[h.createControl("resolver",d.getter(a,["item","_messageContentTpl"]),{item:d.getter(a,["item"]),ladder:d.getter(a,["ladder"]),index:d.getter(a,["index"])||0},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:y},g,c,f,d.config,n,u)],d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["DateCheck",d.getter(a,["index"])])&&!d.getter(a,["item","isDialogs"]).apply(d.getter(a,["item"]),[])?[h.createControl("resolver",d.getter(a,["item","_dateAndIconsTpl"]),{className:d.getter(a,["item","getClassName"]).apply(d.getter(a,["item"]),["MessageItem>dateBlock"])+" contacts-Modify__time-date",item:d.getter(a,["item"]),index:d.getter(a,["index"])||0,date:d.getter(a,["item","isDiscussion"]).apply(d.getter(a,["item"]),[])?d.getter(a,["item","getMessageDate"]).apply(d.getter(a,["item"]),[!0,d.getter(a,["index"])]):d.getter(a,["ladder"])&&!d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["IsOldDate",d.getter(a,["index"])])?d.getter(a,["item","getMessageDate"]).apply(d.getter(a,["item"]),[d.getter(a,["ladder","get"]).apply(d.getter(a,["ladder"]),[d.getter(a,["item"]),d.getter(a,["index"])?"DateCheck1":"DateCheck"]),d.getter(a,["index"])]):d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["DateCheck",d.getter(a,["index"])])},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:y},g,c,f,d.config,n,u)]:h.createText(""),d.getter(a,["item","get"]).apply(d.getter(a,["item"]),["IsGroupTitle"])?[h.createTag("div",{class:"separator-content-load-indicator"},[h.createTag("div",{class:"ws-browser-ajax-loader"},[h.createTag("div",{class:"ws-loading-indicator-outer"},[h.createTag("div",{class:"ws-loading-indicator-block"},[h.createTag("div",{class:"ws-loading-indicator ws-browser-loading-indicator"},[],{},u,this)],{},u,this)],{},u,this)],{},u,this)],{},u,this)]:h.createText("")],h.createTag("div",{class:"contacts-MessageItem__tagAreaTarget"},[],{},u,this)],i,u,this)],m,u);u.def&&(w=h.chain(w,u,i),u=void 0)}catch(e){d.templateError("resources/Contacts.Mini/Models/templates/MessageItem.tmpl",e,a)}return w||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageItem"}},a});
//# sourceMappingURL=MessageItem.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageContentBlock",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},a=function e(a,i,s,n,g){function m(){}var c=0,o=void 0!==t&&t?t:arguments[arguments.length-1];void 0===o&&(eval("var thelpers = null;"),o=global.requirejs("View/Runner/tclosure"));var l={};g&&g.isSetts&&(l=g.fullContext||{});var p="string"==typeof s?s:"",d=void 0===r?void 0:r,u={id:[],def:void 0},h=o.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),y=this&&this.includedTemplates?this.includedTemplates:{},M=o.getMarkupGenerator(n);try{var T=M.joinElements([void(y.serviceMessage=function(e,t){var r=this&&this.includedTemplates?this.includedTemplates:{},a=o.getMarkupGenerator(n);try{var i=a.joinElements([o.getter(e,["item","_serviceMessageTpl"])&&o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedServiceBlock",o.getter(e,["index"])])?[a.createControl("resolver",o.getter(e,["item","_serviceMessageTpl"]),{item:o.getter(e,["item"]),index:o.getter(e,["index"])||0,className:o.getter(e,["item","getClassName"]).apply(o.getter(e,["item"]),["MessageContent>serviceMessage"])+" contacts-ThemeMessage-row-content  contacts-Modify__message-text",id:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["MessageGUID",o.getter(e,["index"])])},{},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,d,r,o.config,l,u)]:a.createText("")],p,u);u.def&&(i=a.chain(i,u,t),u=void 0)}catch(t){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",t,e)}return i||""}.bind({includedTemplates:y})),void(y.attachedDocument=function(e,t){var r=this&&this.includedTemplates?this.includedTemplates:{},a=o.getMarkupGenerator(n);try{var i=a.joinElements([o.getter(e,["item","_documentAttachTpl"])&&o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["Документ"])&&!o.getter(e,["item","isSubDiscussion"]).apply(o.getter(e,["item"]),[])?[a.createControl("resolver",o.getter(e,["item","_documentAttachTpl"]),{className:"contacts-ThemeMessage-row-content                  "+(o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedMessageFromMeMargin",o.getter(e,["index"])])?"contacts-ThemeMessage__from-me-margin__reverse":""),documentGUID:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["Документ"]),documentId:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументПк"]),documentName:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["DocumentName"]),documentIcon:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументИконка"]),phaseName:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументФаза"]),phaseIcon:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументФазаИконка"])},{},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,d,r,o.config,l,u),a.createTag("div",{class:"inline-clear"},[],{},u,this)]:a.createText("")],p,u);u.def&&(i=a.chain(i,u,t),u=void 0)}catch(t){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",t,e)}return i||""}.bind({includedTemplates:y})),void(y.chatName=function(e,t){this&&this.includedTemplates&&this.includedTemplates;var r=o.getMarkupGenerator(n);try{var a=r.joinElements([o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedChatName"])?[r.createTag("div",{class:"contacts-ThemeMessage-row-content contacts-ThemeMessage__sub-chat-name      "+o.wrapUndef(o.utils.escape(o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedMessageFromMeMargin",o.getter(e,["index"])])?" contacts-ThemeMessage__from-me-margin__reverse":""))+"      "+o.wrapUndef(o.utils.escape(o.getter(e,["item","isSubDiscussion"]).apply(o.getter(e,["item"]),[])?" message-discussion-name":""))},[o.getter(e,["item","isSubDiscussion"]).apply(o.getter(e,["item"]),[])?r.createText(""):[r.createTag("span",{class:"icon-16 icon-Chat icon-primary"},[],{},u,this)],r.createText(" "+o.wrapUndef(o.utils.escape(o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ChatName"])))+" ")],{},u,this)]:r.createText("")],p,u);u.def&&(a=r.chain(a,u,t),u=void 0)}catch(t){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",t,e)}return a||""}.bind({includedTemplates:y})),o.getter(a,["item","isContactMsg"]).apply(o.getter(a,["item"]),[])?[function(e,t){o.prepareAttrsForFocus(t,e,"0");var r=this&&this.includedTemplates?this.includedTemplates:{},a=o.getMarkupGenerator(n);try{var i=a.joinElements([o.getter(e,["item","_documentAttachTpl"])&&o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["Документ"])&&!o.getter(e,["item","isSubDiscussion"]).apply(o.getter(e,["item"]),[])?[a.createControl("resolver",o.getter(e,["item","_documentAttachTpl"]),{className:"contacts-ThemeMessage-row-content                  "+(o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedMessageFromMeMargin",o.getter(e,["index"])])?"contacts-ThemeMessage__from-me-margin__reverse":""),documentGUID:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["Документ"]),documentId:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументПк"]),documentName:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["DocumentName"]),documentIcon:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументИконка"]),phaseName:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументФаза"]),phaseIcon:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументФазаИконка"])},{},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,d,r,o.config,l,u),a.createTag("div",{class:"inline-clear"},[],{},u,this)]:a.createText("")],p,u);u.def&&(i=a.chain(i,u,t),u=void 0)}catch(t){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",t,e)}return i||""}(o.calculateScope({item:o.getter(a,["item"]),index:o.getter(a,["index"])},o.plainMerge),{}),function(e,t){o.prepareAttrsForFocus(t,e,"0");this&&this.includedTemplates&&this.includedTemplates;var r=o.getMarkupGenerator(n);try{var a=r.joinElements([o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedChatName"])?[r.createTag("div",{class:"contacts-ThemeMessage-row-content contacts-ThemeMessage__sub-chat-name      "+o.wrapUndef(o.utils.escape(o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedMessageFromMeMargin",o.getter(e,["index"])])?" contacts-ThemeMessage__from-me-margin__reverse":""))+"      "+o.wrapUndef(o.utils.escape(o.getter(e,["item","isSubDiscussion"]).apply(o.getter(e,["item"]),[])?" message-discussion-name":""))},[o.getter(e,["item","isSubDiscussion"]).apply(o.getter(e,["item"]),[])?r.createText(""):[r.createTag("span",{class:"icon-16 icon-Chat icon-primary"},[],{},u,this)],r.createText(" "+o.wrapUndef(o.utils.escape(o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ChatName"])))+" ")],{},u,this)]:r.createText("")],p,u);u.def&&(a=r.chain(a,u,t),u=void 0)}catch(t){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",t,e)}return a||""}(o.calculateScope({item:o.getter(a,["item"]),index:o.getter(a,["index"])},o.plainMerge),{})]:M.createText(""),o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["NeedTitle",o.getter(a,["index"])])?[M.createControl("resolver",o.getter(a,["item","_messageTitleTpl"]),{item:o.getter(a,["item"]),ladder:o.getter(a,["ladder"]),index:o.getter(a,["index"])},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,d,y,o.config,l,u)]:M.createText(""),o.getter(a,["item","isDialogs"]).apply(o.getter(a,["item"]),[])||o.getter(a,["item","isChat"]).apply(o.getter(a,["item"]),[])?[function(e,t){o.prepareAttrsForFocus(t,e,"0");var r=this&&this.includedTemplates?this.includedTemplates:{},a=o.getMarkupGenerator(n);try{var i=a.joinElements([o.getter(e,["item","_documentAttachTpl"])&&o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["Документ"])&&!o.getter(e,["item","isSubDiscussion"]).apply(o.getter(e,["item"]),[])?[a.createControl("resolver",o.getter(e,["item","_documentAttachTpl"]),{className:"contacts-ThemeMessage-row-content                  "+(o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedMessageFromMeMargin",o.getter(e,["index"])])?"contacts-ThemeMessage__from-me-margin__reverse":""),documentGUID:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["Документ"]),documentId:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументПк"]),documentName:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["DocumentName"]),documentIcon:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументИконка"]),phaseName:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументФаза"]),phaseIcon:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ДокументФазаИконка"])},{},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,d,r,o.config,l,u),a.createTag("div",{class:"inline-clear"},[],{},u,this)]:a.createText("")],p,u);u.def&&(i=a.chain(i,u,t),u=void 0)}catch(t){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",t,e)}return i||""}(o.calculateScope({item:o.getter(a,["item"]),index:o.getter(a,["index"])},o.plainMerge),{})]:M.createText(""),o.getter(a,["item","isDialogs"]).apply(o.getter(a,["item"]),[])&&o.getter(a,["item","isSubDiscussion"]).apply(o.getter(a,["item"]),[])&&o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["ДокументРодительНазвание"])?[M.createTag("div",{class:"ws-inline-flexbox ws-flex-nowrap contacts-ThemeMessage__row-flex-content contacts-ThemeMessage__discussion-group-name         "+o.wrapUndef(o.utils.escape(o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["NeedMessageFromMeMargin",o.getter(a,["index"])])?"contacts-ThemeMessage__from-me-margin__reverse":""))},[o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["GroupPhotoLink"])?[M.createTag("img",{class:"contacts-ThemeMessage__sub-chat-img",src:""+o.wrapUndef(o.utils.escape(o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["GroupPhotoLink"])))},[],{},u,this)]:M.createText(""),M.createTag("div",{class:"contacts-ThemeMessage__sub-chat-name"},[M.createText(""+o.wrapUndef(o.Sanitize.apply(void 0,[o.getDecorators().sanitize.apply(void 0,[o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["ДокументРодительНазвание"])])])))],{},u,this)],{},u,this)]:M.createText(""),o.getter(a,["item","isDialogs"]).apply(o.getter(a,["item"]),[])?[function(e,t){o.prepareAttrsForFocus(t,e,"0");this&&this.includedTemplates&&this.includedTemplates;var r=o.getMarkupGenerator(n);try{var a=r.joinElements([o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedChatName"])?[r.createTag("div",{class:"contacts-ThemeMessage-row-content contacts-ThemeMessage__sub-chat-name      "+o.wrapUndef(o.utils.escape(o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedMessageFromMeMargin",o.getter(e,["index"])])?" contacts-ThemeMessage__from-me-margin__reverse":""))+"      "+o.wrapUndef(o.utils.escape(o.getter(e,["item","isSubDiscussion"]).apply(o.getter(e,["item"]),[])?" message-discussion-name":""))},[o.getter(e,["item","isSubDiscussion"]).apply(o.getter(e,["item"]),[])?r.createText(""):[r.createTag("span",{class:"icon-16 icon-Chat icon-primary"},[],{},u,this)],r.createText(" "+o.wrapUndef(o.utils.escape(o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["ChatName"])))+" ")],{},u,this)]:r.createText("")],p,u);u.def&&(a=r.chain(a,u,t),u=void 0)}catch(t){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",t,e)}return a||""}(o.calculateScope({item:o.getter(a,["item"]),index:o.getter(a,["index"])},o.plainMerge),{})]:M.createText(""),o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["IsServiceMessageFirst"])?[function(e,t){o.prepareAttrsForFocus(t,e,"0");var r=this&&this.includedTemplates?this.includedTemplates:{},a=o.getMarkupGenerator(n);try{var i=a.joinElements([o.getter(e,["item","_serviceMessageTpl"])&&o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedServiceBlock",o.getter(e,["index"])])?[a.createControl("resolver",o.getter(e,["item","_serviceMessageTpl"]),{item:o.getter(e,["item"]),index:o.getter(e,["index"])||0,className:o.getter(e,["item","getClassName"]).apply(o.getter(e,["item"]),["MessageContent>serviceMessage"])+" contacts-ThemeMessage-row-content  contacts-Modify__message-text",id:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["MessageGUID",o.getter(e,["index"])])},{},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,d,r,o.config,l,u)]:a.createText("")],p,u);u.def&&(i=a.chain(i,u,t),u=void 0)}catch(t){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",t,e)}return i||""}(o.calculateScope({item:o.getter(a,["item"]),index:o.getter(a,["index"])},o.plainMerge),{}),M.createTag("div",{class:"inline-clear"},[],{},u,this)]:M.createText(""),o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["NeedMessageMeLabel",o.getter(a,["index"])])?[M.createTag("div",{class:o.wrapUndef(o.utils.escape(o.getter(a,["item","getClassName"]).apply(o.getter(a,["item"]),["MessageContent>meLabelBlock"])))+" message-me-label contacts-ThemeMessage__from-me-margin__reverse contacts-Modify__message-me-label"},[M.createText(""+o.wrapUndef(o.utils.escape(o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["MessageLabel",o.getter(a,["index"])]))))],{},u,this)]:M.createText(""),M.createControl("resolver",o.getter(a,["item","_messageTextTpl"]),{text:o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["Text",o.getter(a,["index"])]),needLimiter:o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["TextHeightLimit"]),needCollapse:o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["TextHeightLimit"])&&o.getter(a,["item","isDiscussion"]).apply(o.getter(a,["item"]),[]),needDateFloat:o.getter(a,["item","isPairs"]).apply(o.getter(a,["item"]),[])||!o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["NeedTitle",o.getter(a,["index"])]),dateFloatClassName:o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["NeedEye",o.getter(a,["index"])])||o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["IsEditingMessage"])?" date-with-eye":"",className:o.getter(a,["item","getClassName"]).apply(o.getter(a,["item"]),["MessageContent>textBlock"])+" contacts-ThemeMessage-row-content controls-DragNDropMixin__notDraggable"},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,d,y,o.config,l,u),o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["IsServiceMessageFirst"])?M.createText(""):[function(e,t){o.prepareAttrsForFocus(t,e,"0");var r=this&&this.includedTemplates?this.includedTemplates:{},a=o.getMarkupGenerator(n);try{var i=a.joinElements([o.getter(e,["item","_serviceMessageTpl"])&&o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["NeedServiceBlock",o.getter(e,["index"])])?[a.createControl("resolver",o.getter(e,["item","_serviceMessageTpl"]),{item:o.getter(e,["item"]),index:o.getter(e,["index"])||0,className:o.getter(e,["item","getClassName"]).apply(o.getter(e,["item"]),["MessageContent>serviceMessage"])+" contacts-ThemeMessage-row-content  contacts-Modify__message-text",id:o.getter(e,["item","get"]).apply(o.getter(e,["item"]),["MessageGUID",o.getter(e,["index"])])},{},{data:e,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,d,r,o.config,l,u)]:a.createText("")],p,u);u.def&&(i=a.chain(i,u,t),u=void 0)}catch(t){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",t,e)}return i||""}(o.calculateScope({item:o.getter(a,["item"]),index:o.getter(a,["index"])},o.plainMerge),{})],o.getter(a,["item","_fileAttachTpl"])&&o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["NeedMessageFileBlock",o.getter(a,["index"])])?[M.createControl("resolver",o.getter(a,["item","_fileAttachTpl"]),{item:o.getter(a,["item"]),index:o.getter(a,["index"]),className:"contacts-ThemeMessage-row-content",dateFloat:!o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["NeedTitle",o.getter(a,["index"])])&&!o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["Text",o.getter(a,["index"])])&&o.getter(o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["Я"]),[o.getter(a,["index"])])},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:h},s,d,y,o.config,l,u)]:M.createText(""),o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["NeedUnreadCount"])?[M.createTag("div",{class:"message-unread-link"},[M.createTag("span",{class:"asLink"},[M.createText(""+o.wrapUndef(o.utils.escape(o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["UnreadCountString"]))))],{},u,this),o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["ОтправителиНепрочитанныхСообщений"])?[M.createTag("span",{class:"sender-unread",title:""+o.wrapUndef(o.utils.escape(o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["ОтправителиНепрочитанныхСообщений"])))},[M.createText(" (от "+o.wrapUndef(o.utils.escape(o.getter(a,["item","get"]).apply(o.getter(a,["item"]),["ОтправителиНепрочитанныхСообщений"])))+") ")],{},u,this)]:M.createText("")],{},u,this)]:M.createText("")],p,u);u.def&&(T=M.chain(T,u,i),u=void 0)}catch(e){o.templateError("resources/Contacts.Mini/Models/templates/MessageContentBlock.tmpl",e,a)}return T||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageContentBlock"}},a});
//# sourceMappingURL=MessageContentBlock.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/DateAndIconsBlock",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},a=function e(a,r,s,l,g){function p(){}var n=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};g&&g.isSetts&&(d=g.fullContext||{});var m="string"==typeof s?s:"",o=void 0===i?void 0:i,u={id:[],def:void 0},y=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),f=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(l);try{var T=v.joinElements([v.createTag("div",{class:"message-time-date "+c.wrapUndef(c.utils.escape(c.getter(a,["className"])))},[v.createTag("div",{class:"date-gradient"},[],{},u,this),c.getter(a,["actionsTemplate"])?[v.createTag("div",{class:"contacts-ThemeMessage__itemActions"},[v.createControl("resolver",c.getter(a,["actionsTemplate"]),c.uniteScope(c.utils.escape(c.uniteScope(a,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:y},s,o,f,c.config,d,u)],{},u,this)]:v.createText(""),c.getter(a,["item","isDiscussion"]).apply(c.getter(a,["item"]),[])&&!c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["IsServiceTypeChat"])&&c.getter(a,["item","_emojiTpl"])?[v.createControl("resolver",c.getter(a,["item","_emojiTpl"]),{item:c.getter(a,["item"])},{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:y},s,o,f,c.config,d,u)]:v.createText(""),c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["IsEditingMessage"])?[v.createTag("div",{class:"icon-16 icon-Handwrite2 icon-disabled"+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["IsBeginEdit"])?" isBeginEdit":""))+"         "+c.wrapUndef(c.utils.escape(c.getter(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["СообщениеИзменено"]),[0])?"isWasEditing":"")),title:""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["IsEditingMessage"])))},[],{},u,this)]:v.createText(""),c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["NeedEye",c.getter(a,["index"])])?[v.createTag("div",{class:"icon-16 icon-Show "+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["NeedEye",c.getter(a,["index"])]))),title:""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["EyeTitle",c.getter(a,["index"])])))},[],{},u,this)]:v.createText(""),(c.getter(a,["item","isTheme"]).apply(c.getter(a,["item"]),[])||c.getter(a,["item","isChat"]).apply(c.getter(a,["item"]),[]))&&c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["MessageLink"])?[v.createTag("a",{class:"visible-date contacts-ThemeMessage__miniDate",title:""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["DateTitle",c.getter(a,["index"])]))),href:""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["MessageLink"]))),"data-clickable":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["DateClickable",c.getter(a,["index"])]))),"data-messageguid":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["MessageGUID",c.getter(a,["index"])]))),"data-themeguid":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["Тема"])))},[v.createText(""+c.wrapUndef(c.utils.escape(c.getter(a,["date"]))))],{},u,this)]:[v.createTag("div",{class:"visible-date contacts-ThemeMessage__miniDate",title:""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["DateTitle",c.getter(a,["index"])]))),"data-clickable":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["DateClickable",c.getter(a,["index"])]))),"data-messageguid":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["MessageGUID",c.getter(a,["index"])]))),"data-themeguid":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["Тема"])))},[v.createText(""+c.wrapUndef(c.utils.escape(c.getter(a,["date"]))))],{},u,this)],c.getter(a,["item","isDialogs"]).apply(c.getter(a,["item"]),[])?[v.createTag("div",{class:"visible-date contacts-ThemeMessage__fullDate",title:""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["DateTitle",c.getter(a,["index"])]))),"data-clickable":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["DateClickable",c.getter(a,["index"])]))),"data-messageguid":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["MessageGUID",c.getter(a,["index"])]))),"data-themeguid":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["Тема"])))},[v.createText(""+c.wrapUndef(c.utils.escape(c.getter(a,["item","get"]).apply(c.getter(a,["item"]),["DateFull"]))))],{},u,this)]:v.createText("")],r,u,this)],m,u);u.def&&(T=v.chain(T,u,r),u=void 0)}catch(e){c.templateError("resources/Contacts.Mini/Models/templates/DateAndIconsBlock.tmpl",e,a)}return T||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/DateAndIconsBlock"}},a});
//# sourceMappingURL=DateAndIconsBlock.tmpl.map
define("js!SBIS3.Contacts.QuoteHelpers",[],function(){return{clearTextByHighLight:function(t){return this.getTextForQuote(t.replace(/<span.*?class="controls-HtmlDecorators-highlight">([^<]*)<\/span>/gi,"$1"))},getTextForQuote:function(t){if(!this.isNotEmptyQuoteByText(t)){var e=$(t).find("blockquote:first");return e.length?e.html().trim():0}return t},isAllowSendMessageByAttach:function(t){return true},isTextWithQuote:function(t){var e=/\s?<div class=["']contacts-Blockquote controls-RichEditor__noneditable["']>/gim;return-1!=t.search(e)},isNotEmptyQuoteByText:function(t){var e=/<div.*?class="contacts-Blockquote controls-RichEditor__noneditable">[\s\S]*<\/div>/i;return!!t.replace(/^&re[_]*([\-\d]*)_/i,"").replace(e,"").replace(/<br(.*?)>/g,"").replace(/<\/?p(.*?)>/g,"").trim().length},checkQuoteByTimeZone:function(t){var e=/<p class=["']citationOptions["'].*?<\/p>/gi,r=t.match(e);if(r)for(var i=0;i<r.length;i++){var o=r[i],n=o.match(/data-msg-date="([\s\S]*?)"/i),c=n&&n[1]?Date.fromSQL(n[1]):null,a=c?o.match(/<p class="citationOptions".*>([\s\S]*?)<\/p>/i):null,s=a&&a[1]?a[1].split(",")[0]+", "+c.strftime("%e %b %R").toLowerCase().trim():null;if(s&&s!=a[1]){var l=o.replace(a[1],s);t=t.replace(o,l)}}return t}}});
//# sourceMappingURL=Helpers.module.js.map
define("js!SBIS3.Contacts.Models.MiniBaseModel",["Core/detection","Core/helpers/string-helpers","js!WS.Data/Entity/Model","js!SBIS3.Contacts.CoreMiniFunctions","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonPhoto","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonEmployment","css!SBIS3.Contacts.Models.MiniBaseModel/styles/PersonPhoto","css!SBIS3.Contacts.Models.MiniBaseModel/styles/PersonEmployment"],function(e,t,s,o,i,n){return s.extend({_moduleName:"SBIS3.Contacts.Models.MiniBaseModel",$protected:{_isMobile:e.isMobilePlatform||e.isMobileAndroid||e.isMobileIOS||e.isMacOSMobile||e.isMobileSafari,_isPhysicFace:o.isInMySbis(),_isBilling:o.isBilling(),_options:{fieldName:{personGUID:"Персона",employmentName:"КонтактМесто",employmentId:"КонтактМестоИд",departmentMark:"КонтактКоллега"},properties:{EmploymentName:{get:function(){return this.get(this._options.fieldName.employmentName)}},IsDepartment:{get:function(){return this.has(this._options.fieldName.departmentMark)?this.get(this._options.fieldName.departmentMark):o.isCurrentClient(this.get("Клиент"))}},DateClickable:{get:function(){return false}}}},_personPhoto:i,_personEmployment:n,_escapeHtml:t.escapeHtml},getClassName:function(e){return""}})});
//# sourceMappingURL=Base.module.js.map
define("tmpl!SBIS3.Contacts.FileViewerMini/FileViewer",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},a=function e(a,r,n,s,l){function c(){}var o=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var f={};l&&l.isSetts&&(f=l.fullContext||{});var p="string"==typeof n?n:"",u=void 0===i?void 0:i,v={id:[],def:void 0},g=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),w=this&&this.includedTemplates?this.includedTemplates:{},h=d.getMarkupGenerator(s);try{var m=h.joinElements([h.createTag("div",{class:"contacts-FileViewerMini "+d.wrapUndef(d.utils.escape(d.getter(a,["className"]))),"on:click":[{name:"event",args:[],value:"_onClickHandler",fn:function(){var e=arguments[0],t=d.getter(this,["_onClickHandler"]).apply(this,arguments);e.nativeEvent?e.nativeEvent.result=t:g._forceUpdate()}.bind(g)}],"data-component":"SBIS3.Contacts.FileViewerMini"},[h.createTag("span",{class:"contacts-FileViewerMini__icon "+d.wrapUndef(d.utils.escape(d.getter(a,["iconClass"])))},[],{},v,this),function(){for(var e=void 0,t=0;t<d.iterators.length&&!e;t++)d.iterators[t].is(d.utils.escape(d.getter(a,["filesForRender"])))&&(e=d.iterators[t].iterator);var i=[];return function(){var t=d.createScope(a);if(a=t,e){var r=n,l=0;e(d.utils.escape(d.getter(a,["filesForRender"])),function(e,t){d.presetScope(e,a,t,{value:"file"}),n&&void 0!==s&&s&&(n=r+"-for_"+l,l++);var c=[h.createTag("div",{class:"contacts-FileViewerMini__file "+d.wrapUndef(d.utils.escape(d.getter(a,["itemClass"]))),"data-index":""+d.wrapUndef(d.utils.escape(d.getter(a,["file","index"]))),"data-fileid":""+d.wrapUndef(d.utils.escape(d.getter(a,["file","id"]))),"data-isfolder":""+d.wrapUndef(d.utils.escape(d.getter(a,["file","isFolder"]))),title:d.wrapUndef(d.utils.escape(d.getter(a,["file","title"])))+" ("+d.wrapUndef(d.utils.escape(d.getter(a,["file","size"])))+")"},[h.createTag("span",{class:"contacts-FileViewerMini__fileName"},[h.createText(""+d.wrapUndef(d.utils.escape(d.getter(a,["file","name"]))))],{},v,this),d.getter(a,["file","extension"])?[h.createTag("span",{class:"contacts-FileViewerMini__fileExtension"},[h.createText(""+d.wrapUndef(d.utils.escape(d.getter(a,["file","extension"]))))],{},v,this)]:h.createText(""),d.getter(a,["file","size"])&&d.getter(a,["showFileSize"])?[h.createTag("span",{class:"contacts-FileViewerMini__fileSize"},[h.createText(""+d.wrapUndef(d.utils.escape(d.getter(a,["file","size"]))))],{},v,this)]:h.createText(""),d.getter(a,["file","canBeDeleted"])?[h.createTag("span",{class:"contacts-FileViewerMini__fileRemoveIcon icon-16 icon-Close icon-disabled"},[],{},v,this)]:h.createText("")],{},v,this)];void 0===c[0]&&void 0!==s&&s||(i=i.concat(c))}.bind(a))}else i=""}.call(a),i}()],r,v,this)],p,v);v.def&&(m=h.chain(m,v,r),v=void 0)}catch(e){d.templateError("resources/Contacts.Mini/FileViewer.tmpl",e,a)}return m||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.FileViewerMini/FileViewer"}},a});
//# sourceMappingURL=FileViewer.tmpl.map
define("Core/utf8-base64",["Core/constants"],function(){return{encode:function e(n){if("undefined"!=typeof window)return window.btoa(unescape(encodeURIComponent(n)));else return unescape(encodeURIComponent(new Buffer(n).toString("base64")))},decode:function e(n){if("undefined"!=typeof window)return decodeURIComponent(escape(window.atob(n)));else return unescape(decodeURIComponent(new Buffer(n,"base64").toString("utf-8")))}}});
//# sourceMappingURL=utf8-base64.js.map
define("Core/Control",["Core/core-extend","Core/helpers/generate-helpers","Core/EventBus","Core/vdom/Synchronizer/Synchronizer","WS.Data/Entity/InstantiableMixin","Core/Abstract.compatible","Core/IoC","Core/constants","Core/helpers/Hcontrol/doAutofocus","Core/vdom/Synchronizer/resources/TabIndex","Core/vdom/Utils/FocusHelper","View/Runner/expressions/contextResolver","View/Runner/Vdom/utils/optionsResolver","View/Runner/expressions/attr","Core/vdom/Synchronizer/resources/DOMEnvironment"],function(t,e,n,i,o,s,r,a,l,c,u,h,f,p){"use strict";var d,_,b;if("undefined"===typeof window||a.compat)d=global.requirejs.defined("Lib/Control/Control.compatible")&&global.requirejs("Lib/Control/Control.compatible"),_=global.requirejs.defined("Lib/Control/AreaAbstract/AreaAbstract.compatible")&&global.requirejs("Lib/Control/AreaAbstract/AreaAbstract.compatible"),b=global.requirejs.defined("Lib/Control/BaseCompatible/BaseCompatible")&&global.requirejs("Lib/Control/BaseCompatible/BaseCompatible");var m=t.extend([s,d||{},_||{},b||{},o],{_controlName:"Core/Control",_context:null,_contextObj:null,VDOMReady:false,_logicParent:null,_mounted:false,_decOptions:null,_$tooltip:"",_getDecOptions:function(){return this._decOptions},hasCompatible:function(){if(this.fixBaseCompatible)return false;return!!b},_parseDecOptions:function(t){if(this._decOptions={},!p.checkAttr(t)){if(t["class"]||t["className"])this._decOptions["class"]=(t["class"]?t["class"]+" ":"")+(t["className"]?t["className"]:"");if(t["style"])this._decOptions["style"]=t["style"];if(t["data-component"])this._decOptions["data-component"]=t["data-component"];if(t["__$config"])this._decOptions["config"]=t["__$config"]}},isBuildVDom:function(){return this.hasCompatible()?b.isBuildVDom.call(this):true},mountToDom:function(t,e){if(!this.VDOMReady)this.VDOMReady=true,this._container=t,i.mountControlToDOM(this,e,this._container);if(e)this.saveOptions(e)},saveOptions:function(t,e){if(this._options=t,e)this._container=e.element;return this.hasCompatible()?b.saveOptions.call(this,t,e):true},_getInternalOption:function(t){var e;if(void 0!==this._internalOptions[t])e=this._internalOptions[t];else if(this.hasCompatible())e=b._getInternalOption.call(this,t);return e},_setInternalOption:function(t,e){if(!this._internalOptions)this._internalOptions={},r.resolve("ILogger").error("Component with "+(this._options?"name "+this._options.name+" config "+this._options.__$config:"maybe id "+this._$id),"Control.constructor wasn't called");if(this._internalOptions[t]=e,this.hasCompatible())b._setInternalOption.call(this,t,e)},_setInternalOptions:function(t){for(var e in t)if(t.hasOwnProperty(e))this._setInternalOption(e,t[e]);if(this.hasCompatible())b._setInternalOptions.call(this,t)},isCompatibleLayout:function(t){if(!this.$constructor)return false;var e=t&&t.parent&&t.parent.isCompatibleLayout&&t.parent.isCompatibleLayout(t.parent._options);return void 0===e?!!this.$constructor:e},saveFullContext:null,constructor:function(t){if(!t)t={};var i=null;if(this.saveFullContext=function t(e){i=e},this._getMarkup=function t(e,n,o){var s;if(this.hasCompatible())s=b._getMarkup.call(this,e,n,o);else{var r=this._getDecOptions();r=o||(p.checkAttr(r)?{}:r),s=this._template(this,r,e,true,{isSetts:true,fullContext:i})[0]}var a=s.properties&&s.properties.attributes||s.controlAttributes;if(u.prepareAttrsForFocus(a,{"ws-tab-cycling":this._hasOption("ws-tab-cycling")&&this._getOption("ws-tab-cycling"),"ws-no-focus":this._hasOption("ws-no-focus")&&this._getOption("ws-no-focus"),"ws-autofocus":this._hasOption("ws-autofocus")&&this._getOption("ws-autofocus"),tabindex:this._baseTabIndex}),o)if(a=p.joinAttrs(a,o),s.properties&&s.properties.attributes)s.properties.attributes=a;else if(s.controlAttributes)s.controlAttributes=a;return s},this.render=function(){if(this.hasCompatible())return b.render.apply(this,arguments);return this._template(this,this._getDecOptions(),this._context,false,{isSetts:true,fullContext:i})},this._logicParent=t._logicParent,this._options={},this.context={get:function(t){if(this._contextObj&&this._contextObj.hasOwnProperty(t))return this._contextObj[t];else throw new Error("You trying to get unrequired field "+t)}.bind(this),set:function(){throw new Error("Can't set data to context. Context is readonly!")},has:function(){return true}},this._internalOptions={},this._children={},this._subscriptions=this._subscriptions||[],this._subDestroyControls=this._subDestroyControls||[],t.fixBaseCompatible)this.fixBaseCompatible=true;if(!t.__$config)t.__$config=e.randomId("cfg-");if(!this.hasCompatible()){if(this._parseDecOptions(t),this._handlers={},"undefined"!==typeof window)this._$eventBusId=e.randomId(),n.channel(this._$eventBusId,{waitForPermit:true})}else this._parseDecOptions(t),this.deprecatedContr(t);if(!this.isCompatibleLayout()&&false!==this.iWantVDOM)this._savedOptions=this._options,this._options={}},destroy:function(t){if(this._beforeUnmount(),!t&&this.hasCompatible())b.destroy.call(this)},getDataId:function(){return e.randomId("dataid")},isEnabled:function(){if(void 0===this._options.enabled){var t=this._getInternalOption("parentEnabled");if(void 0===t)t=true;return t}return this._options.enabled},isVisible:function(){if(this._options&&void 0===this._options.visible){var t=this._getInternalOption("parent"),e=this._getInternalOption("parentVisible");if(t&&t.$constructor&&t.isVisible)e=t.isVisible();if(void 0===e)e=true;return e}return this._options?this._options.visible:true},hasFocus:function(){return!!this._active},isFocused:function(){return(this._container[0]?this._container[0]:this._container)===document.activeElement},blur:function(){var t=this._container[0]?this._container[0]:this._container,e=document.activeElement,n;if(!u.closest(document.activeElement,t))return;if(-1===document.body.tabIndex)n=document.body.tabIndex,document.body.tabIndex=1;if(document.body.focus(),this.hasFocus())t.controlNodes[0].environment._handleBlurEvent({target:e,relatedTarget:document.body});if(void 0!==n)document.body.tabIndex=n;if(this.hasCompatible()){var i=$(e).wsControl();if(i&&i.isActive()&&!i.iWantVDOM)i.setActive(false)}},focus:function(){function t(){return!(a.browser.isMobilePlatform&&false===o._getOption("focusOnActivatedOnMobiles"))}function e(t){while(t){if(t.environment)return t.environment;t=t._logicParent}throw new Error("environment не был найден среди предков")}function n(e){var n=false,i=document.activeElement;if(e.wsControl&&e.wsControl.setActive)if(e.wsControl.canAcceptFocus())e.wsControl.setActive(true),n=e.wsControl.isActive();else n=false;else{if(t())e.focus(),n=e===document.activeElement;else n=false;if(e=this._container[0]?this._container[0]:this._container,n&&!this.hasFocus()){var o=e.controlNodes[0].environment;o._handleBlurEvent({target:i,relatedTarget:e}),o._handleFocusEvent({target:e,relatedTarget:i})}}return n}for(var i=false,o=this,s=this._container[0]?this._container[0]:this._container,r=l.findAutofocusForVDOM(s),u,h,f=0;f<r.length;f++)if(u=r[f],!h)if(u&&u.controlNodes&&u.controlNodes.length)h=i=u.controlNodes[0].control.focus();if(!h){var p=e(this).getElementProps,d=c.findFirstInContext(s,false,p);if(d)i=n.call(this,d);else i=n.call(this,s)}return i},_beforeMount:function(t,e,n){},_afterMount:function(t,e){},_beforeUpdate:function(t,e){},_shouldUpdate:function(t,e){return true},_afterUpdate:function(t,e){},_beforeUnmount:function(){},_forceUpdate:function(){this._notify("onPropertyChange")},_notify:function(t){function e(t){if("function"===typeof Event)var e=new Event(t);else(e=document.createEvent("Event")).initEvent(t,true,true);return e}if("undefined"===typeof window)return;var n=[],i,o,s=t.toLowerCase(),r=[];r.push(s),r=r.concat([].slice.call(arguments,1));for(var a=1;a<arguments.length;a++)n.push(arguments[a]);var l=e(s);if(l.args=n,this._container&&this._container[0]&&this._container[0].dispatchEvent)l._createdByNotify=true,this._container[0].dispatchEvent(l);else if(this._container&&this._container.dispatchEvent)l._createdByNotify=true,this._container.dispatchEvent(l);if(this.hasCompatible())this._getChannel()._eventsAllowed=true,b._notify.apply(this,r);if(o=l.result,void 0!==o)return o;else return i}});return m.createControl=function(t,e,n){if(f.resolveOptions(t,e)){var i=new t(e);return i._container=n,i.saveFullContext(h.wrapContext(i,{})),i.mountToDom(i._container,e),i}},m});
//# sourceMappingURL=Control.js.map
define("js!SBIS3.Contacts.FileViewerMini",["Core/Control","tmpl!SBIS3.Contacts.FileViewerMini/FileViewer","Core/detection","Core/utf8-base64","js!SBIS3.Contacts.CoreMiniFunctions","js!WS.Data/Collection/RecordSet","css!SBIS3.Contacts.FileViewerMini/FileViewer","i18n!SBIS3.Contacts.FileViewerMini"],function(e,t,i,s,n,a){"use strict";var l=e.extend({_moduleName:"SBIS3.Contacts.FileViewerMini",_template:t,iWantVDOM:true,constructor:function(e){l.superclass.constructor.call(this,this._prepareOptions(e)),this._publish("onFileClick","onRemoveFileClick")},init:function(){l.superclass.init.call(this)},getFiles:function(e){if(e&&this.files&&!this._isRecordSet)return new a({rawData:this.files,idProperty:"attachId"});return this.files},_prepareOptions:function(e){return this._isRecordSet=!!e.files&&"function"===typeof e.files.getCount,e.className=e.className||"",e.iconClass=e.iconClass||"icon-16 icon-Attach icon-disabled",e.className=e.className||"",e.iconClass=e.iconClass||"icon-16 icon-Attach icon-disabled",e.itemClass=e.itemClass||"",e.themeGUID=e.themeGUID||"",e.messageGUID=e.messageGUID||"",e.canDelete="boolean"===typeof e.canDelete?e.canDelete:false,e.clickable="boolean"===typeof e.clickable?e.clickable:true,e.showFileSize="boolean"===typeof e.showFileSize?e.showFileSize:true,e.filesForRender=this._getFilesForRender(e),this.className=e.className,this.iconClass=e.iconClass,this.itemClass=e.itemClass,this.clickable=e.clickable,this.files=e.files,this.filesForRender=e.filesForRender,this.themeGUID=e.themeGUID,this.messageGUID=e.messageGUID,this.canDelete=e.canDelete,this.showFileSize=e.showFileSize,this.fileNameMaxCharacters=e.fileNameMaxCharacters,e},_onClickHandler:function(e){if(this.clickable){var t=e.target,i=t.classList.contains("contacts-FileViewerMini__file")?t.dataset:t.parentElement.classList.contains("contacts-FileViewerMini__file")?t.parentElement.dataset:null,s=t.classList.contains("contacts-FileViewerMini__fileRemoveIcon"),n=i?i.index:null,a=i?i.fileid:null,l=n&&a?this._getFileAt(parseInt(n),a):null;if(l){if(s)this._notify("onRemoveFileClick",l);else if(false!==(l?this._onFileClickNotify(l):false))this._openFileHandler(l);e.stopPropagation()}}},_openFileHandler:function(e){var t=this,n=(document&&document.location?document.location.protocol+"//"+document.location.host:"https://consultant.sbis.ru")+"/service/?id=3&method=Consultation.DownloadFile&protocol=4&params="+s.encode(JSON.stringify({file_id:e.get("attachId"),chat:t.themeGUID})),a;if("url"==e.get("fileName").slice(-3))$.ajax({url:n,dataType:"text",async:false,success:function(e){var t=e.match(/^\s*URL=(.*)/m),i=t&&t[1];if(i)window.open(i)}});else if(!i.isMobileSafari)a=$('<iframe style="display:none;" ></iframe>'),$("body").append(a),a.on("load",this._iframeLoadHandler.bind(this,a[0])),a.attr("src",n);else window.open(n)},_iframeLoadHandler:function(e){var t=e.contentDocument||e.contentWindow.document,i=t&&t.getElementsByTagName("pre").length?t.getElementsByTagName("pre")[0].innerHTML:null,s;if(i){try{var a=JSON.parse(i);s=a.error.message||a.error.details}catch(e){s=rk("При загрузке файла произошла ошибка.")}n.alert(s)}},_isFolder:function(e){return!!e&&(this._isRecordSet?e.get("folder$"):e["folder$"]||!!e.isFolder)},_isLink:function(e){var t=this._isRecordSet?e.get("fileName"):e.fileName,i=this._isFolder(e);return"url"==this._getFileExtension(t,i).toLowerCase()},_getFilesForRender:function(e){var t=[],i=e.files;if(i)for(var s=this._isRecordSet,n=s?i.getCount():i.length,a=e.fileNameMaxCharacters,l=!!e.canDelete,o=0;o<n;o++){var r=s?i.at(o):i[o],c=s?r.get("attachId"):r.attachId,f=s?r.get("fileName"):r.fileName,h=s?r.get("title"):r.title,d=s?r.get("size"):r.size,u=s?r.get("canBeDeleted"):r.canBeDeleted,m=s?r.get("fileNameMaxCharacters"):r.fileNameMaxCharacters,F=this._isFolder(r),g=this._getFileSizeForRender(d),p=this._getFileExtension(f,F),_=this._getFileNameForRender(f,p,m||a);t.push({id:c,index:o,name:_,title:h,isFolder:F,extension:p,canBeDeleted:"boolean"===typeof u?u:l,size:g})}return t},_getFileExtension:function(e,t){if(!t){var i=e.split(".");if(i.length>1)return i[i.length-1]}return""},_getFileNameForRender:function(e,t,i){if(t=t||"",i=parseInt(i||this.fileNameMaxCharacters),t&&t.length)e=e.substr(0,e.length-(t.length+1));return i&&e.length>i?[e.substr(0,i),".."].join(""):e},_getFileSizeForRender:function(e){if("string"===typeof e)return e;else if(!e)return 0===e?["0",rk("байт","contacts")].join(" "):"-";var t=1024,i=[rk("байт","contacts"),rk("КБ","contacts"),rk("МБ","contacts"),rk("ГБ","contacts"),rk("ТБ","contacts")],s=parseInt(Math.floor(Math.log(e)/Math.log(t)),10),n=e/Math.pow(t,s);if(i[s]===rk("байт","contacts")||i[s]===rk("КБ","contacts"))return n.toFixed(0)+" "+i[s];else if(i[s]===rk("МБ","contacts"))return(n.toFixed(n<100?1:0)+" "+i[s]).replace(/\.0+ /," ");else if(i[s]===rk("ГБ","contacts")||i[s]===rk("ТБ","contacts"))return(n.toFixed(n<100?2:0)+" "+i[s]).replace(/\.0+ /," ")},_getFileAt:function(e,t){if(this.files){var i=this._isRecordSet,s=i?this.files.getCount():this.files.length,n=e>=0&&e<s?i?this.files.at(e):this.files[e]:null,a=n?i?n.get("attachId"):n.attachId:null;if(t&&a)if(a===t)return n;else if(i)return this.files.setIdProperty("attachId"),this.files.getRecordById(t);else for(var l=0;l<s;l++){var o=this.files[l];if(o.attachId===t)return o}else return n}return null},_onFileClickNotify:function(e){return this._notify("onFileClick",e)}});return l});
//# sourceMappingURL=FileViewer.module.js.map
define("js!SBIS3.CONTROLS.Utils.RichTextAreaUtil",["SBIS3.CONTROLS/Utils/RichTextAreaUtil/RichTextAreaUtil"],function(i){return i});
//# sourceMappingURL=Utils_RichTextAreaUtil.module.js.map
define("js!SBIS3.Contacts.Models.MiniMessageModel",["Core/IoC","Core/Context","Core/helpers/string-helpers","Core/detection","js!SBIS3.Contacts.Models.MiniBaseModel","js!SBIS3.Contacts.QuoteHelpers","js!SBIS3.CONTROLS.Utils.RichTextAreaUtil","js!SBIS3.Contacts.CoreMiniFunctions","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageItem","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageTitleBlock","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageContentBlock","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageTextBlock","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/DateAndIconsBlock","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MiniServiceMessageBlock","css!SBIS3.Contacts.Models.MiniMessageModel/styles/Message","is!browser?js!SBIS3.Contacts.CoreMiniFunctions/string.format","js!SBIS3.Contacts.ServiceMessageBase","js!SBIS3.Contacts.FileViewerMini","i18n!SBIS3.Contacts.Models.MiniMessageModel"],function(e,t,i,s,n,r,o,a,g,u,c,h,l,f){return n.extend({_moduleName:"SBIS3.Contacts.Models.MiniMessageModel",$protected:{_dateGroup:null,_dateFormatted:{},_type:{},_subType:{},_messageRowTpl:g,_messageContentTpl:c,_messageTextTpl:h,_dateAndIconsTpl:l,_messageTitleTpl:u,_serviceMessageTpl:f,_options:{fieldName:{personGUID:"КонтактПерсона",personTitle:"КонтактTitle"},properties:{MessageLink:{get:function(){var e=[];switch(this.get("Тип")){case"chat":e.push("/open_chat.html?guid=");break;case"dialog":e.push("/open_dialog.html?guid=");break;default:return false}return e.push(this.get("Тема")),e.push("&message="),e.push(this.get("Сообщение")),e.join("")}},GroupId:{get:function(){return this.get("ИдРазделителя")}},DateCheck:{get:function(){var e=this.get("ДатаДляОтображения");return e&&e[0]}},DateGroup:{get:function(){return this._dateGroup},set:function(e){this._dateGroup=e}},DateForSorting:{get:function(){var e=this.get("ТипСписка");if(-1===["theme","chat"].indexOf(e)){var t="pairs"===e,i=this.get("ДатаВремя");return i?i[t&&this.get("СообщениеПоследнее")&&this.get("СообщениеПоследнее")!==this.get("Сообщение")?1:0]:null}else return this.get("Курсор")}},DateFull:{get:function(){return this._dateFormatted.full}},DateMini:{get:function(){return this._dateFormatted.mini}},DateTitle:{get:function(){if(!this.get("ДатаВремя"))return;var e=new Date(this.get("ДатаВремя")[0]),t=this.get("ПрочитаноПолучателем")[0]?new Date(this.get("ПрочитаноПолучателем")[0]):null,i=[];if(e)i.push([rk("Отправлено","read_date")," ",e.strftime("%e %b %Y %R").toLowerCase()].join(""));if(t)i.push([rk("прочитано","read_date")," ",t.strftime("%e %b %Y %R").toLowerCase()].join(""));return i.length?i.join(", "):""}},EmploymentName:{get:function(){var e=this.get(this._options.fieldName.employmentName);return e&&e[0]},set:function(e){var t=this.get(this._options.fieldName.employmentName);t[0]=e,this.set(this._options.fieldName.employmentName,t)}},EyeTitle:{get:function(){return"icon-disabled"===this.get("NeedEye")?rk("Сообщение не прочитано получателем"):rk("Сообщение не прочитано")}},FileForPreview:{get:function(){return this.get("ФайлыДляПревью")}},HasMessageContent:{get:function(){var e=this.get("FileForPreview");return this.get("Text",0)||this.get("NeedServiceBlock",0)||e&&e.getCount()}},IsBeginEdit:{get:function(){if(this.isChat()&&this.get("НачатаПравка")){var e=this.get("НачатаПравка")[0]?(new Date-new Date(this.get("НачатаПравка")[0]))/1e3:null;return e&&e<31}else return false}},IsDepartment:{get:function(){var e=this.get(this._options.fieldName.departmentMark);return e&&e[0]}},IsEditingMessage:{get:function(){var e;if(this.get("СообщениеИзменено")&&(this.isChat()&&!this.get("IsServiceTypeChat")||this.isTheme()))e=this.get("IsBeginEdit")?rk("В данный момент сообщение редактируется"):this.get("СообщениеИзменено")[0];return e}},IsFromMeToMe:{get:function(){var e=this.get("Я"),i=this.get("КонтактПерсона"),s=this.get("ServiceObject"),n=t.global.getValue("mypersonid");return e&&e[0]?s&&1===s.receivers.length&&s.receivers[0]===n:i&&i[0]===n}},IsHiddenRow:{get:function(){return this.get("IsHidden")},set:function(e){this.set("IsHidden",e)}},IsOldDate:{get:function(){var e=this.get("ДатаДляОтображения");return e&&e[0]&&e[0].length>=8}},IsTetATet:{get:function(){return this.isSingleMessage()&&this.get("ТетАТет")}},MessageGUID:{get:function(){return this.get("Сообщение")}},MessageLabel:{get:function(){var e="",t=this.get("КонтактФИ"),i=this.get("Я");if(i&&i[0]&&!this.get("NeedTitle")&&t&&null!==t[0])e=t[0];return e}},NeedMessageFileBlock:{get:function(){var e=this.get("FileForPreview"),t=["invite_send","invite_accept","invite_reject","invite_close"],i=this.get("NeedServiceBlock");return e&&e.getCount()&&e.at(0).get("attachId")&&(!i||t.indexOf(i)>=0)}},NeedMessageFromMeMargin:{get:function(){return this.get("NeedPersonName",0)}},NeedOutputBubble:{get:function(){var e=this.getListType();return!(e.dialogs||e.discussion&&!e.pairs||this.get("IsServiceTypeChat"))}},NeedPersonName:{get:function(){return true}},NeedReceivers:{get:function(){var e=this.get("КоличествоПолучателей");return e&&e[0]>0&&this.get("Получатели")[0]}},NeedTitle:{get:function(){return!this.get("IsTetATet")}},NeedUnreadCount:{get:function(){return false}},PersonName:{get:function(){var e=this.get("КонтактФИ");return e&&e[0]},set:function(e){if(!this.get("Я")||!this.get("Я")[0]){var t=this.get("КонтактФИ");t[0]=e,this.set("КонтактФИ",t)}}},PersonNameClickable:{get:function(){var e=this.get("Я");return!(e&&e[0])&&(this.isTheme()||this.isChat()&&this.isSubChat())}},PersonTitle:{get:function(){var e="";if(!this.get("PersonNameClickable")){var t=this.get(this._options.fieldName.personTitle);e=t&&t[0]||""}return e}},PhotoLink:{get:function(){var e=this.get("КонтактФотоСсылки")?this.get("КонтактФотоСсылки")[0]:null;if(e&&-1===e.indexOf("previewer"))e="/previewer/r/40/40"+e;return e}},SrcSetPhotoLink:{get:function(){var e=this.get("КонтактФотоСсылки")?this.get("КонтактФотоСсылки")[0]:null;if(e&&-1===e.indexOf("previewer"))e="/previewer/r/80/80"+e;return e}},PhotoSize:{get:function(){return 24}},ReceiversCount:{get:function(){var e=this.get("КоличествоПолучателей");return e&&e[0]}},ReceiversCountString:{get:function(){var e=this.get("ReceiversCount");return e>2?i.format({count:e},a.plural(e,rk("для $count$s$ получателя"),rk("для $count$s$ получателей"),rk("для $count$s$ получателей")))+" -":rk("для")}},ReceiversOtherCount:{get:function(){var e=this.get("ЕщёN");return e&&e[0]}},Receivers:{get:function(){var e=this.get("ПолучателиФИО");return e&&e[0]}},ReceiversString:{get:function(){var e=this.get("Receivers");return e&&e.length?e.join(", "):""}},ReceiversTitle:{get:function(){var e=this.get("Receivers");return e&&e.length?e.concat([]).reverse().join(", "):""}},RowSelector:{get:function(){var e="";switch(this.get("ТипСписка")){case"dialogs":e="contacts-ThemeView-row js-controls-ListView__item controls-ListView__item";break;case"chat":e="contacts-ChatHistory-row js-controls-ListView__item controls-ListView__item";break;case"pairs":e="contacts-PairsView-row";break;case"theme":e="contacts-DialogHistory-row js-controls-ListView__item controls-ListView__item";break;case"msgcontact":e="contacts-ContactHistory-row js-controls-ListView__item controls-ListView__item";break;case"themecontact":e="contacts-ContactView-row"}return e+this.getRowSelector(0)}},ServiceObject:{get:function(){var t=null;try{var i=this.get("СлужебныйОбъект");t=i&&JSON.parse(i[0])}catch(t){e.resolve("ILogger").error("Ошибка при парсе поля СлужебныйОбъект\n",t)}return t},set:function(e){var t=this.get("СлужебныйОбъект")||[];t[0]=JSON.stringify(e),this.set("СлужебныйОбъект",t)}},ServiceType:{get:function(){var e=this.get("СлужебныйТип");return e&&e[0]}},Text:{get:function(){var e=this.getMessageText(0);return e?r.checkQuoteByTimeZone(e):null},set:function(e){this.get("Текст")[0]=e}},TextHeightLimit:{get:function(){var e=this.getListType();return e.dialogs||e.pairs||e.discussion}},VisibleDate:{get:function(){return this.get("ДатаДляОтображения")},set:function(e){var t=this.get("ДатаВремя"),i=this.get("ДатаДляОтображения");if(i[0].length>5!==e)this.set("ДатаДляОтображения",[e?t[0].strftime("%e %b %H:%M").toLowerCase():t[0].strftime("%H:%M"),i[1]])}}}}},init:function(){var e=this.get("ДатаВремя");if(e&&e[0]){var t=new Date(e[0]),i=this.get("Раздел");this.set("DateGroup",t.setHours(0,0,0,0)+(i||"")),this._dateFormatted={mini:e[0].strftime("%H:%M").toLowerCase(),full:e[0].strftime("%e %b %H:%M").toLowerCase()}}this.setListType()},setListType:function(){var e=this.get("ТипСписка"),t=this.get("Тип");this._subType={subChat:"chat"===t,subDiscussion:"chat/2"===t},this._type={pairs:"pairs"===e,dialogs:"dialogs"===e,theme:"theme"===e,chat:"chat"===e,discussion:"chat"===e&&this._subType.subDiscussion,msgcontact:"msgcontact"===e,singleMessage:"msgcontact"===e||"theme"===e||"chat"===e,invite:"invite"===e,folder:this.get("Раздел@")}},getListType:function(){return this._type},getSubListType:function(){return this._subType},isSingleMessage:function(){return this._type.singleMessage},isTheme:function(){return this._type.theme},isChat:function(){return this._type.chat},isDiscussion:function(){return this._type.discussion},isDialogs:function(){return this._type.dialogs},isPairs:function(){return this._type.pairs},isInvite:function(){return this._type.invite},isContactMsg:function(){return this._type.msgcontact},isMobilePlatform:function(){return s.isMobilePlatform},isFolder:function(){return this._type.folder},isSubChat:function(){return this._subType.subChat},isSubDiscussion:function(){return this._subType.subDiscussion},getRowSelector:function(t){if(!this.get("Я"))return"";var i=this.getListType(),s=this.get("IsHiddenRow"),n=this.get("IsServiceTypeChat"),r="",o=(!this.get("Я")[t]||this.get("Я")[t]&&this.get("Входящее")[t])&&!this.get("ПрочитаноВладельцем")[t]&&!(i.chat&&"chat/2"===this.get("Тип"));if(s&&(i.dialogs||i.chat&&!this.get("IsGroupTitle")))r+=" ws-hidden";else r+=" ws-visible";if(o)r+=" unread-message";if(this.get("NeedOutputBubble"))if(this.get("Я")[t])r+=" output-message contacts-Modify__message-output";else r+=" input-message contacts-Modify__message-input";if(i.singleMessage&&this.get("ТетАТет"))r+=" tet-a-tet";if(n)r+=" chat-service";if(i.chat&&this.get("Документ")&&-1!==[10,11,20].indexOf(this.get("ДокументИдТипа")))r+=" contacts-ChatHistory__documentDiscussion";if(this.get("PhotoLink",t))r+=" has-photo";if(!this.get("Text",t))r+=" without-text";if(this.get("NeedMessageFromMeMargin",t))r+=" message-from-me-margin";if(this._isMobile)r+=" is-mobile";if((i.chat||i.theme)&&!i.discussion)if(n&&this.get("GroupId")>=0)r+=" snd_group__center";else try{switch(JSON.parse(this.get("СлужебныйОбъект")[0]).snd_group){case"begin":r+=" snd_group__begin";break;case"center":r+=" snd_group__center";break;case"end":r+=" snd_group__end"}}catch(t){e.resolve("ILogger").error("Ошибка при парсе поля СлужебныйОбъект\n",t)}if(this.get("TextHeightLimit"))r+=" text-height-limit";return r},getMessageDate:function(e,t){return this.get(e?"DateFull":"DateMini",t)},getMessageText:function(e){var t=this.get("Текст");return i.wrapURLs(o.unDecorateLinks(t[e]||""))},compareForSort:function(e){var t,i,s=this.get("DateForSorting"),n=e.get("DateForSorting"),r="dialogs"===this.get("ТипСписка")&&"dialogs"===e.get("ТипСписка");if(this.isFolder()){if(t=this.get("ПорНомер"),i=e.get("ПорНомер"),null===t||null===i)return 1}else if(s&&s.hasOwnProperty("value")&&n&&n.hasOwnProperty("value"))if(typeof n.value===typeof s.value){var o=s.value===e.get("DateForSorting").value;t=o?new Date(s.timestamp):s.value,i=o?new Date(n.timestamp):n.value}else t="string"===typeof s.timestamp?Date.fromSQL(s.timestamp):new Date(s.timestamp),i="string"===typeof n.timestamp?Date.fromSQL(n.timestamp):new Date(n.timestamp);else t=new Date(s),i=new Date(n);return r?i>t?1:-1:t>i?1:-1}})});
//# sourceMappingURL=Message.module.js.map
define("tmpl!SBIS3.Contacts.ServiceMessage/templates/SignedMessage",["Core/tmpl/js/tclosure","js!SBIS3.DOCVIEW.List","js!SBIS3.CONTROLS.Link"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.DOCVIEW.List"]=e[1],r["js!SBIS3.CONTROLS.Link"]=e[2];var i=function e(i,a,s,n,g){function o(){}var c=0,l=void 0!==t&&t?t:arguments[arguments.length-1];void 0===l&&(eval("var thelpers = null;"),l=global.requirejs("View/Runner/tclosure"));var p={};g&&g.isSetts&&(p=g.fullContext||{});var d="string"==typeof s?s:"",u=void 0===r?void 0:r,v={id:[],def:void 0},m=l.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},y=l.getMarkupGenerator(n);try{var S=y.joinElements([l.getter(i,["filesByGroup"])?[function(){for(var e=void 0,t=0;t<l.iterators.length&&!e;t++)l.iterators[t].is(l.utils.escape(l.getter(i,["filesByGroup"])))&&(e=l.iterators[t].iterator);var r=[];return function(){var t=l.createScope(i);if(i=t,e){var a=s,g=0;e(l.utils.escape(l.getter(i,["filesByGroup"])),function(e,t){l.presetScope(e,i,t,{key:"groupId",value:"group"}),s&&void 0!==n&&n&&(s=a+"-for_"+g,g++);var o=[y.createTag("div",{class:"signed-group"},[y.createControl("wsControl","ws:SBIS3.DOCVIEW.List",{mainOptions:{userParams:{themeGUID:l.getter(i,["themeGUID"])},commands:{upload:!0,edit:!0,editInApp:!0,print:!l.getter(i,["isMobile"]),rename:!0,sendMessage:!1,addPage:!1,deleteDoc:!1,deletePage:!1,deletePermanentlyDoc:!1,rights:!0,restore:!1,move:!1,fullScreen:!1,saveToPdf:!1,copyToBuffer:!0,signDocument:!1},ctxLinkList:"ФайлыDocViewModel",useOnlyCtx:!0,objectName:"FileSD",serviceUrl:"/disk/api/v1/",serviceBLName:"СБИСДиск.Приватный"},listOptions:{visibilityMode:{defaultMode:"bigPreview",folderAsPreview:!0},goToFolder:!1,previewWidth:"68",previewHeight:"68",itemsDragNDrop:!1,multiselect:!1,hasHierarchy:!1,hideBreadCrumbs:!0,calcMargin:!1,serializedItems:l.getter(i,["group","filesRawData"]),itemsSortMethod:null},name:l.getter(["FilePreview",l.getter(i,["groupId"])],["join"]).apply(["FilePreview",l.getter(i,["groupId"])],["_"]),hotFixForOpenParent:!0,redrawOnEdit:!1,esc:!1},{class:"contacts-ServiceMessage-signed__group-docview",name:l.getter(["FilePreview",l.getter(i,["groupId"])],["join"]).apply(["FilePreview",l.getter(i,["groupId"])],["_"]),sbisname:l.getter(["FilePreview",l.getter(i,["groupId"])],["join"]).apply(["FilePreview",l.getter(i,["groupId"])],["_"])},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m,internal:{__dirtyCheckingVars_0:l.getter(i,["themeGUID"]),__dirtyCheckingVars_4:!l.getter(i,["isMobile"]),__dirtyCheckingVars_26:l.getter(i,["group","filesRawData"])}},s,u,f,l.config,p),y.createTag("div",{class:"aggregate-signs",style:"max-width: calc(100% - "+l.wrapUndef(l.utils.escape(76*l.getter(i,["group","filesCount"])))+"px)"},[l.getter(i,["group","signatures"])&&l.getter(i,["group","signatures","length"])?[function(){for(var e=void 0,t=0;t<l.iterators.length&&!e;t++)l.iterators[t].is(l.utils.escape(l.getter(i,["group","signatures"])))&&(e=l.iterators[t].iterator);var r=[];return function(){var t=l.createScope(i);if(i=t,e){var a=s,g=0;e(l.utils.escape(l.getter(i,["group","signatures"])),function(e,t){l.presetScope(e,i,t,{key:"key",value:"sign"}),s&&void 0!==n&&n&&(s=a+"-for_"+g,g++);var o=[3==l.getter(i,["key"])&&l.getter(i,["group","signatures","length"])>4?[y.createControl("wsControl","ws:SBIS3.CONTROLS.Link",{name:l.getter(["SignsAggregate",l.getter(i,["groupId"])],["join"]).apply(["SignsAggregate",l.getter(i,["groupId"])],["_"]),caption:global.rk.apply(i,["еще"])+" "+(l.getter(i,["group","signatures","length"])-3),signsGroupId:l.getter(i,["groupId"])},{class:"sign-block other-signs",name:l.getter(["SignsAggregate",l.getter(i,["groupId"])],["join"]).apply(["SignsAggregate",l.getter(i,["groupId"])],["_"]),sbisname:l.getter(["SignsAggregate",l.getter(i,["groupId"])],["join"]).apply(["SignsAggregate",l.getter(i,["groupId"])],["_"])},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},s,u,f,l.config,p)]:l.getter(i,["key"])<4?[y.createTag("div",{class:"sign-block "+l.wrapUndef(l.utils.escape(l.getter(i,["sign","fromMe"])&&" blue-sign"))},[l.getter(i,["sign","needIcon"])?[y.createTag("div",{class:"icon-16 icon-Signature"+l.wrapUndef(l.utils.escape(l.getter(i,["sign","fromMe"])?" icon-primary":" icon-hover")),"data-groupid":""+l.wrapUndef(l.utils.escape(l.getter(i,["groupId"])))},[],{},v,this)]:y.createText(""),y.createTag("div",{class:"sign-title"},[y.createText(" "+l.wrapUndef(l.utils.escape(l.getter(i,["sign","name"])))),l.getter(i,["sign","nameFor"])&&l.getter(i,["sign","nameFor"])!=l.getter(i,["sign","name"])?[y.createText(" (за "+l.wrapUndef(l.utils.escape(l.getter(i,["sign","nameFor"])))+")")]:y.createText(""),l.getter(i,["sign","company"])&&l.getter(i,["sign","company","name"])?[y.createText(", "+l.wrapUndef(l.utils.escape(l.getter(i,["sign","company","name"]))))]:y.createText("")],{},v,this)],{},v,this)]:y.createText("")];void 0===o[0]&&void 0!==n&&n||(r=r.concat(o))}.bind(i))}else r=""}.call(i),r}()]:[y.createTag("div",{class:"sign-block grey-sign"},[y.createTag("div",{class:"icon-16 icon-Signature icon-disabled"},[],{},v,this),y.createTag("div",{class:"sign-title"},[y.createText(""+global.rk("Документ никем не подписан"))],{},v,this)],{},v,this)]],{},v,this)],{},v,this)];void 0===o[0]&&void 0!==n&&n||(r=r.concat(o))}.bind(i))}else r=""}.call(i),r}()]:y.createText("")],d,v);v.def&&(S=y.chain(S,v,a),v=void 0)}catch(e){l.templateError("resources/Contacts.Base/templates/SignedMessage.tmpl",e,i)}return S||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.ServiceMessage/templates/SignedMessage"}},i});
//# sourceMappingURL=SignedMessage.tmpl.map
define("js!SBIS3.Contacts.SignFilesAbstract",["Core/core-merge","Core/EventBus","js!SBIS3.Contacts.Mixins.Services.Consumer"],function(e,n,i){"use strict";return e(e({},{$protected:{_options:{name:"SignFilesAbstract"}},after:{init:function(){this._publish(["onSignFiles","onCancelSignFiles"])}},before:{getInformationForSubscribe:function(){return null}},_cancelSignFiles:function(e){if(this.getParent().getName().indexOf("DialogHistoryBP")>-1)return n.channel("ChannelSignActions").notify("onCancelSignFiles",e);else return this.consume("signFiles",{messageParams:e,files:[]})[0].result},_signFiles:function(e){if(this.getParent().getName().indexOf("DialogHistoryBP")>-1)return n.channel("ChannelSignActions").notify("onSignFiles",e);else return this.consume("signFiles",{messageParams:e,files:e.files_for_sign})[0].result}},{clone:true}),i)});
//# sourceMappingURL=SignFilesAbstract.module.js.map
define("js!SBIS3.Engine.ClipboardNative",["Core/Deferred","css!SBIS3.Engine.ClipboardNative"],function(e){"use strict";var t=function(){return this||(0,eval)("this")}(),n=t.document,a={"text/plain":"Text","text/uri-list":"URL"};if(!t||!n)return function(){this.setData=function(t,n){return e.fail("Copy command was unsuccessful")},this.getData=function(t){return e.fail("Paste command was unsuccessful")}};var r=function(n,r){var i=false;if(t.clipboardData)try{i=t.clipboardData.setData(a[n],r)}catch(t){return e.fail(t)}return e.success(i)},i=n.createElement("div");if(i.classList.add("engine-ClipboardNative-copy"),n.body)n.body.appendChild(i);else n.addEventListener("DOMContentLoaded",function(e){n.body.appendChild(i)});var c,s;n.addEventListener("copy",function(e){if(e.target!==i||!s||!c)return;e.clipboardData.setData(s,c),c=null,s=null});var o=function(a,r){var o=new e;c=r,s=a;try{var u=n.createRange();i.innerText=r,t.getSelection().removeAllRanges(),u.selectNodeContents(i),t.getSelection().addRange(u);var l=n.execCommand("copy");if(t.getSelection().removeAllRanges(),i.innerText="",!l)throw new Error("Copy command was unsuccessful");o.callback(true)}catch(e){o.errback(e)}return o};return function(){this.setData=function(e,t){return r(e,t).addBoth(function(n){if(!n||n instanceof Error)return o(e,t);return n})},this.getData=function(t){return e.fail("Paste command was unsuccessful")}}});
//# sourceMappingURL=ClipboardNative.module.js.map
define("js!SBIS3.Engine.Clipboard",["Core/Deferred","Core/moduleStubs","Core/core-simpleExtend","Core/core-merge","Core/EventBus","Lib/TabMessage/TabMessage","js!SBIS3.Engine.ClipboardNative"],function(t,n,e,i,r,o,a){"use strict";var s="SBIS3.CONTROLS/Utils/InformationPopupManager",u=["js!SBIS3.Engine.ClipboardNative","js!SBIS3.Engine.PluginClipboard","js!SBIS3.Engine.ClipboardDialog"],f="engine.clipboard";function c(e){var i=this;this._implements={},this.register=function(t,n){return this._implements[t]=new n(e),this._implements[t]},this.get=function(e){if(i._implements[e])return t.success(i._implements[e]);return n.require(e).addCallback(function(t){return i.register(e,t[0])})}}function l(n,e,i,r){var o;o=u.length;for(var a=t.fail("Empty implementation list"),s=0;s<o;s++){var f=u[s];a.addBoth(p(n,f,e,i,r))}return a}function p(t,n,e,i,r){return function(o){if(o instanceof Error||"function"===typeof r&&!r(o))return t.get(n).addCallback(function(t){return t[e].apply(t,i)});return o}}function d(){var t=r.channel(f);return t.setEventQueueSize(1),t}var h=new o;h.subscribe("onSetData",function(t,n){d().notify("onSetData",n.format,n.data)});var m={showNotification:true,successCopyTitle:rk("Скопировано в буфер обмена"),errorCopyTitle:rk("Не удалось скопированвать в буфер обмена")};return e.extend({constructor:function(t){this._options=i(i({},m),"object"===typeof t?t:{}),this._implCont=new c(this._options),this._implCont.register(u[0],a)},getText:function(){var t="text/plain";return this.getData(t).addCallback(function(t){return t||"number"===typeof t?t:""})},setText:function(n){if("number"===typeof n)n+="";if(!n)return t.fail("Invalid arguments");var e="text/plain";return this.setData(e,n)},setData:function(n,e){var i=this;if(!e)return t.fail("Invalid arguments");var r=l(this._implCont,"setData",[n,e],function(t){return!!t});return r.addBoth(function(t){if(true===t)i._showNotification(i._options.successCopyTitle),d().notify("onSetData",n,e),h.notify("onSetData",{format:n,data:e});if(t instanceof Error)i._showNotification(i._options.errorCopyTitle,"error");return t}),r},getData:function(t){return l(this._implCont,"getData",[t])},getChannel:function(){return d()},_showNotification:function(t,e){if(!this._options.showNotification)return;n.require(s).addCallback(function(n){n[0].showNotification({status:e||"success",caption:t})})}})});
//# sourceMappingURL=Clipboard.module.js.map
define("js!SBIS3.Contacts.PreloadContactsData",["Core/core-clone","js!WS.Data/Source/SbisService","Core/helpers/String/escapeHtml","Core/UserInfo","Core/Context","Core/IoC","Core/EventBus","Core/Deferred"],function(t,r,a,e,n,s,o,i){"use strict";var l=["dialogs2","people","contactsTiles","files"],u="Contacts.UserParamsChannel",f="onNeedParams",c={_startedMyInfoLoadings:null,startCounters:{dialogs:null,chats:null,contacts:null},shortcutsMap:{tab:"ПерваяВкладка",dialogstab:"ДиалогиФильтры",peopletab:"ПоЛюдямФильтры",contactsfilters:"КонтактыФильтрыДляПлитки",files:"ФайлыФильтры"},userParams:{"ДиалогиФильтры":"","ПоЛюдямФильтры":"","КонтактыФильтрыДляПлитки":"","ФайлыФильтры":"","ПерваяВкладка":""},listDataSettings:{dialogstab:{messages:{source:{endpoint:"Персона",binding:{query:"СписокСообщенийДляListView"}},filters:{"ВидДерева":"Только листья","Раздел":null,"РазмерФото":null,"Реестр":0,"ТипСписка":"dialogs"},initFilters:{"Реестр":"registryType"},limit:20,hasMore:true,cursorNavigation:true}}},_val2Str:function(t){if(null===t||void 0===t)return"";var r=typeof t;return"object"==r?JSON.stringify(t):"string"!=r?t.toString():t},storeParam:function(t,r){if(!this.userParams.hasOwnProperty(t))return false;return this.userParams[t]=this._val2Str(r),true},saveParam:function(t,a){if(!this.userParams.hasOwnProperty(t))return null;var e={"Путь":"ОбменСообщениями."+t,"ЗначениеПараметра":this._val2Str(a)};return new r({endpoint:"ПользовательскиеПараметры"}).call("ВставитьЗначение",e)},readParam:function(t){if(!this.userParams.hasOwnProperty(t))return null;var a=this,e={"Путь":"ОбменСообщениями."+t},n=new r({endpoint:"ПользовательскиеПараметры"}).call("ПолучитьЗначение",e);return n.addCallback(function(r){var e=r.getScalar();a.userParams[t]="null"==e?"":e}),n},readAllParams:function(){var t=new i,a=[],e=this,n=function(){return o&&o.hasChannel(u)&&o.channel(u).notify(f)};if(true===n())return t=new i,t.callback(true),t;for(var s in this.userParams)if(this.userParams.hasOwnProperty(s))a.push("ОбменСообщениями."+s);return new r({endpoint:"Персона"}).call("ПолучитьПараметрыВкладок",{"НазванияПараметров":a}).addCallbacks(function(r){if(r)for(var a=r.getAll(),s=0,o=a.getCount();s<o;s++){var i=a.at(s),l=i.get("Название"),u=i.get("Значение");if(-1!=l.indexOf("."))l=l.split(".")[1];if("null"==u)u="";e.userParams[l]=u}n(),t.callback(true)},function(r){n(),t.callback(false)}),t},fillTabsOptions:function(t,r){var a,e=new i;for(a in this.shortcutsMap)if(this.shortcutsMap.hasOwnProperty(a))if("tab"===a){if(!t.isInformer||t.useMicrosession)t["initial_tab"]=this.userParams[this.shortcutsMap[a]];if(-1===l.indexOf(t["initial_tab"]))t["initial_tab"]="dialogs2"}else{if(!t.hasOwnProperty("tabs_filters"))t["tabs_filters"]={};t["tabs_filters"][a]=this.userParams[this.shortcutsMap[a]]}for(a in this.startCounters)if(this.startCounters.hasOwnProperty(a)){if(!t.hasOwnProperty("tabs_counters"))t["tabs_counters"]={};t["tabs_counters"][a]=this.startCounters[a]}if("dialogs2"===t["initial_tab"]&&r&&"object"===typeof r&&r.hasOwnProperty("exist_folder_dialog"))t["tabAdditionalOptions"]={dialogstab:{emptyFolderList:!r.exist_folder_dialog,unreadCount:r.startCounters&&r.startCounters.dialogs}};return e.callback(t),e},subscribeToStoreParamsEvent:function(t,r){if(o&&o.hasChannel(u))return o.channel(u).subscribe(f,t,r),true;return false},unsubscribeFromStoreParamsEvent:function(t,r){if(o&&o.hasChannel(u))o.channel(u).unsubscribe(f,t,r)},getUserParamsFromRecord:function(t){var r=a(t.get("Имя")),n=a(t.get("Фамилия")),s=a(t.get("Отчество"));return{"КлиентНазвание":e.get("ИмяКлиента"),"ФИО":[n,r,s].join(" "),"Фамилия":n,"Имя":r,"Отчество":s,"Отдел":a(t.get("Отдел")),"Должность":a(t.get("Должность"))}},readAllCounters:function(t){var a=new i,e=this;if(e._errorCount=e._errorCount||0,e._lastError=e._lastError||new Date,e._errorCount<3||new Date-e._lastError>12e4)new r({endpoint:"ИнформерПерсона"}).call("Счетчики",{"Прочие":t}).addCallbacks(function(r){e._lastError=null,e._errorCount=null;var n=r.getScalar();if(n){e.startCounters["dialogs"]=n["unread_dialogs"],e.startCounters["dialogsunviewed"]=n["unviewed_dialogs"],e.startCounters["chats"]=n["unread_chats"],e.startCounters["contacts"]=n["invitations"]["me"]["unread"]+n["invitations"]["my"]["unread"],e.startCounters["invites"]={incomeCounter:n["invitations"]["me"]["unread"],incomeTotalCounter:n["invitations"]["me"]["unprocessed"],outcomeCounter:n["invitations"]["my"]["unread"],outcomeTotalCounter:n["invitations"]["my"]["unprocessed"]};var s=n["last_dialog_view_time"];if(s)e.startCounters["last_dialog_view_time"]="string"===typeof s?Date.fromSQL(s):new Date(s);if(t)for(var o=0;o<t.length;o++)e.startCounters[t[o]]=n[t[o]];a.callback(e.startCounters)}},function(t){e._lastError=new Date,e._errorCount+=1,a.errback(t)});else a.errback();return a},loadAllInfo:function(e){if(!e||"function"!=typeof e.callback)return;var n=this;new r({endpoint:"Персона"}).call("ИнформацияВкладокКонтактов",{}).addCallbacks(function(r){if(r=r.getRawData(),r.hasOwnProperty("startCounters"))n.startCounters=t(r.startCounters);if(r.hasOwnProperty("userParams"))for(var s in n.userParams)if(n.userParams.hasOwnProperty(s)){var o="ОбменСообщениями."+s;if(r.userParams.hasOwnProperty(o))n.userParams[s]=r.userParams[o]}if(r.hasOwnProperty("myfaceinfo")){var i=r["myfaceinfo"];for(var s in i)if(i.hasOwnProperty(s)&&"string"==typeof i[s])i[s]=a(i[s]);if(!i.hasOwnProperty("ФИО"))i["ФИО"]=[i["Фамилия"],i["Имя"],i["Отчество"]].join(" ")}e.callback(r)},function(t){e.errback(t)})},loadMyInfo:function(t,e){var o=this;if(!o._startedMyInfoLoadings)o._startedMyInfoLoadings={params:[],defcalled:null},o._startedMyInfoLoadings.defcalled=new r({endpoint:"Персона"}).call("МояПодробнаяИнформация",{}).addCallbacks(function(t){t=t.getRow();var r=o._startedMyInfoLoadings,e={mypersonid:"Персона",myclientid:"Клиент",myuserid:"Лицо",myfaceid:"Лицо"},s={};o._startedMyInfoLoadings=null;for(var i in e)if(e.hasOwnProperty(i))s[i]=a(t.get(e[i]));if(s["myfaceinfo"]=o.getUserParamsFromRecord(t),r.saveIntoGlobalContext){var l=n.global;for(var u in s)if(s.hasOwnProperty(u))l.setValue(u,s[u])}for(var i=0,f=r.params.length;i<f;i++){var c=r.params[i];if(c&&"function"===typeof c.callback)c.callback(s)}return t},function(t){var r=o._startedMyInfoLoadings.params;o._startedMyInfoLoadings=null,s.resolve("ILogger").error(t.message,t.detail);for(var a=0,e=r.length;a<e;a++){var n=r[a];if(n&&"function"===typeof n.errback)n.errback(t)}return t});if(o._startedMyInfoLoadings){if(o._startedMyInfoLoadings.params.push(t),e)o._startedMyInfoLoadings.saveIntoGlobalContext=true;return o._startedMyInfoLoadings.defcalled}return i.fail("Что-то пошло не так и метод БЛ Персона.МояПодробнаяИнформация не смог отработать")}};if(o)if(!o.hasChannel(u))o.channel(u).publish(f);return c});
//# sourceMappingURL=PreloadContactsData.module.js.map
define("js!SBIS3.Contacts.MessagesExchangeEvents",["Core/core-clone","Core/Context","Core/IoC","Core/EventBus","Core/Deferred","Core/Abstract","Core/UserInfo","js!WS.Data/Source/SbisService","js!SBIS3.Contacts.PreloadContactsData","js!SBIS3.Contacts.DialogsViewerHelper","Core/helpers/Object/isEmpty"],function(e,t,n,i,a,o,s,r,l,h,c){var d=1e3*60*10,f=o.extend({transportSet:false,functionMode:"nodialogs",channel:null,events:["onNewMessage","onChangeMessage","onDeleteTheme","onMoveTheme","onMoveContact","onMoveContactGroup","onChangeContactGroup","onChangeFolder","onChangeChat","onDeleteChat","onAddDeleteToChat","onNewFileVersion","onSendReady","onFilesProcessed","onNewInviteFavoriteContacts","onNewFavoriteContacts","onRejectFavoriteContacts","onChangeThemes","onDeleteContacts","onCreateContacts","onMoveContacts","onLockChat","onThemeTransform","onFilesSign","onSignFileInfoReady","Chats.onFavorite","ondialogsettingschange","onMessageSetSubTheme","onRestoreTheme","onViewDialogs","onChangeContacts","onDeleteContactsMass","taglistchange","tagupdate"],lc_events:null,__channels:[],last_messages:[],_hash:{},_indexDiffTicker:0,_reloadProgress:0,lastDateTimeNotify:new Date,_DebugMode:"undefined"!=typeof document&&document.URL&&-1!=document.URL.indexOf("/debug"),_tickerHandler:null,init:function(){if(f.superclass.init.call(this),this.channel=this._getChannel(),!this.transportSet)this.startTransport("ServerChannel")},_doRightParam:function(t,n){var i=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&-1==t.indexOf(n))delete e[n]},a=e(n);switch(t){case"onChangeMessage":if(a.hasOwnProperty("changes_date"))delete a["changes_date"];if(a.hasOwnProperty("changes_for"))for(var o=0;o<a["changes_for"].length;o++)if("edit"==a.state)a["changes_for"][o]["text"]=a.hasOwnProperty("localInfo")&&a.localInfo.hasOwnProperty("text")?a.localInfo.text:"",i(a["changes_for"][o],["theme","msg","text"]);else i(a["changes_for"][o],["theme","msg"]);break;case"onChangeThemes":if(i(a,["changed_themes","user","state"]),a.hasOwnProperty("changed_themes"))for(var o=0;o<a["changed_themes"].length;o++)i(a["changed_themes"][o],["id","msg"]);break;case"onNewMessage":i(a,["theme","msg"]);break;case"onChangeFolder":i(a,["action","folder","name","from_folder"]);break;case"onDeleteTheme":i(a,["erased_themes"]);break;case"onRestoreTheme":i(a,["themes"]);break;case"onMoveTheme":i(a,["moved_themes","to_folder"]);break;case"onNeedCheckRefresh":if(a.hasOwnProperty("checkdatetime"))delete a["checkdatetime"];break;case"onMoveContactGroup":i(a,["action","group"]);break;case"onAddDeleteToChat":i(a,["action","chat"])}if(a.hasOwnProperty("localInfo"))delete a.localInfo;if(a.hasOwnProperty("is_local"))delete a.is_local;return a},_isCheckNotify:function(e,t){var n=this,i="is_local"in t&&t["is_local"],a=n._doRightParam(e,t),o=[e,n._makeHash(a).toString()].join("_");if(n._hash.hasOwnProperty(o)&&n._hash[o]!=i)return delete n._hash[o],false;else return n._hash[o]=i,true},_handlerCommon:function(e){var n=this;if(e&&e.box&&"contacts.ondialogsettingschange"===e.event){if(e.box.startDate)e.box.startDate=new Date(e.box.startDate);if(e.box.endDate)e.box.endDate=new Date(e.box.endDate);t.global.setValue("dialogSettings",e.box)}if("object"===typeof e&&e.id&&e.event)for(var i=0;i<n.events.length;i++)(function(t){var i=n.events[t];if(e.event==="Contacts."+i)if(n._isCheckNotify(i,e.box))if("onNewFileVersion"==i){if(!n._lastNewFVbox)n._lastNewFVbox={};var a=e.box,o=[a.isRename?"rename":"edit",a.attachId,a.themeID].join(" ");if(n._lastNewFVbox.hasOwnProperty(o))n._lastNewFVbox[o]=a;else n._lastNewFVbox[o]=a,setTimeout(function(){var e=n._lastNewFVbox[this.key];delete n._lastNewFVbox[this.key],n.channel.notify("onNewFileVersion",e)}.bind({key:o}),200)}else n.channel.notify(i,e.box)})(i)},setFunctionMode:function(e){if(e!=this.functionMode){if("full"!==e&&"nodialogs"!==e)return void n.resolve("ILogger").error("setFunctionMode","invalid mode in parameter");this._modeSubscribtions(false),this.functionMode=e,this._modeSubscribtions(true)}},subscribeChatServerChannel:function(e,t){var n=this;require(["Lib/ServerEvent/Bus"],function(i){var a,o="contacts.chats:"+e;if(-1===n.__channels.indexOf(o))n.__channels.push(o),a=i.serverChannel(o,{isChanneled:true}),n.subscribeTo(a,"onMessage",n._pre_handlerServerChannel.bind(n));if(void 0!==t)t()})},_subscribeServerChannel:function(){var e=this;if(e.myIsAuthorized())require(["Lib/ServerEvent/Bus"],function(t){for(var n=e.events,i,a=0;a<n.length;a++){var o=n[a];i=t.serverChannel("contacts."+o.toLowerCase()),e.subscribeTo(i,"onMessage",e._pre_handlerServerChannel.bind(e))}e._modeSubscribtions(true)})},_modeSubscribtions:function(e){if(!this.transportSet)return;if(e){if(!this._DebugMode&&!this.myIsAnnonim()&&"full"==this.functionMode)if(!this._tickerHandler)this._tickerHandler=true,this.subscribeTo(i.globalChannel(),"onwakeup",function(e,t){this.lastDateTimeNotify=new Date(t),this._needReloadRegistry()}.bind(this))}else if(this._tickerHandler)this._tickerHandler=null,this.unsubscribeFrom(i.globalChannel(),"onwakeup")},_pre_handlerServerChannel:function(e,t){if(t instanceof Array)for(var n=0;n<t.length;n++)this._handlerServerChannel(e,t[n]);else this._handlerServerChannel(e,t)},_handlerServerChannel:function(e,t){try{var i="string"==typeof t?JSON.parse(t):"object"==typeof t?t:null;if(!i||!i.id)return;if(i.box="string"==typeof i.data?JSON.parse(i.data):i.data,this.last_messages.length>100)this.last_messages.splice(0,50);if(this.last_messages.length>0&&-1!==$.inArray(i.id,this.last_messages))return;else this.last_messages.push(i.id);this._handlerCommon(i)}catch(e){var a=n.resolve("ILogger");a.error("Ошибка в обработчике уведомлений по алгоритму ServerChannel\n",e),a.info("Объект уведомления",t)}switch(i.event){case"Contacts.onLockChat":case"Contacts.onAddDeleteToChat":this.onNewMessageFromServiceChat(i.box,i.event);break;case"Contacts.onChangeThemes":if(i.box.user==s.get("ИдентификаторСервисаПрофилей"))this._checkForCounterChangesEventNeed(i.box.changed_themes,"id",i.box);break;case"Contacts.onChangeMessage":if("deleted"==i.box.state)this._checkForCounterChangesEventNeed(i.box.changes_for,"theme",i.box);break;case"Contacts.onDeleteTheme":this._checkForCounterChangesEventNeed(null,null,i.box)}},_checkForCounterChangesEventNeed:function(e,t,n){var i={private_dialogs:false,chats:{dif:0,unread_view:false,changes:[]},dialogs:{dif:0,unread_view:false,changes:[]},dialogsunviewed:{dif:0,unread_view:false,changes:[]},invites:{unread_view:false,changes:[],dif_me:{unread:0,unprocessed:0},dif_my:{unread:0,unprocessed:0}},reload:false},a=function(e){var t;if(e<0)t="remove";else if(e>0)t="new";else t="update";return t};if(e&&e.length){var o=e.length;if(i.reload=o>20,!i.reload)for(var s=0;s<o;s++){var r=e[s],l=r.reestr&&-1!==r.reestr.indexOf(2)||n.reestr&&-1!==n.reestr.indexOf(2),c=r.invite&&r.invite.reestr&&2!==r.invite.type||n.invite&&n.invite.reestr&&2!==n.invite.type,d=(r.chat||r.is_chat)&&!r.chat_is_public;if(void 0!==r.chat_dif&&d)i.chats.unread_view=true,i.chats.dif+=r.chat_dif,i.chats.changes[r[t]]=a(r.chat_dif);if(void 0!==r.dialog_dif&&l)i.dialogs.unread_view=true,i.dialogs.dif+=r.dialog_dif,i.dialogs.changes[r[t]]=a(r.dialog_dif);if(void 0!==r.dialog_dif&&r.dialog_dt){var f=h.getLastDialogsViewDate(true);if(("string"===typeof r.dialog_dt?Date.fromSQL(r.dialog_dt):new Date(r.dialog_dt))>f)if(0===r.dialog_dif)i.reload=true;else i.dialogsunviewed.dif+=r.dialog_dif;i.dialogsunviewed.unread_view=true,i.dialogsunviewed.changes[r[t]]=a(r.dialog_dif)}if(c)i.invites.unread_view=true,i.reload=true;if(l)i.dialogs.unread_view=true;if(r.is_private)i.private_dialogs=true}}else if(n.invite&&n.invite.length&&n.erased_themes&&n.erased_themes.length)i.invites.unread_view=true;this.notify("onCountersChange",i)},onNewMessageFromServiceChat:function(e,t){if(e["msg_action"]){var n=null,i=void 0;if("Contacts.onLockChat"===t)n=0===e["status"]?"chat_unlock":"chat_lock",i=0!==e["status"];if("Contacts.onAddDeleteToChat"===t){var a={add:"new-chater",remove:"stop-chater",rule_admin_add:"chat-new-admin",rule_admin_remove:"chat-remove-admin"};if(i=-1===e["contacts"].indexOf(s.get("ИдентификаторСервисаПрофилей")),e["action"]in a)n=a[e["action"]];else n="unknown"}this.doAndNotify("onNewMessage",{theme:e["chat"],sender:{},msg:e["msg_action"],is_chat:true,intraTheme:i,type:n,is_refresh_counter:true,update_local_counter:i})}},_handlerServerChannelPersonPhoto:function(e,t){this.channel.notify("onPhotoChanged",t)},_handlerTickerChannel:function(e){var t=this,i=(new Date).getTime(),a=t._lastTicker?i-t._lastTicker:0,o=0;if(t._lastTicker=i,!t._arrayDiffTicker)t._arrayDiffTicker=[];for(var s=0;s<t._arrayDiffTicker.length;s++)o+=t._arrayDiffTicker[s];if(t._arrayDiffTicker.length>4){if(t._indexDiffTicker>4)t._indexDiffTicker=0;t._arrayDiffTicker[t._indexDiffTicker]=a,t._indexDiffTicker++}else t._arrayDiffTicker.push(a);if(t._reloadProgress%2==1){if(!t._lastReloadFlagged||i-t._lastReloadFlagged>6e4)t._lastReloadFlagged=i,t._reloadProgress++,t._needReloadRegistry();if(t._reloadProgress>20)t.lastDateTimeNotify=null,t._reloadProgress=0,n.resolve("ILogger").log("Проверка новых сообщений после остановки","выполнено более 10 попыток подключиться к серверу и вызвать метод - безуспешно, больше попыток не будет")}else if(0==t._reloadProgress&&a>o&&o>0&&a>2500)t._sleepDetected=true;if(t._sleepDetected&&(!t._lastReloadFlagged||i-t._lastReloadFlagged>6e4))if((void 0===document.visibilityState||"visible"===document.visibilityState)&&!document.hidden)n.resolve("ILogger").log("Обнаружена потребность проверки необходимости обновления реестра, ибо разности такие: ",a+" и "+o),t._reloadProgress=1,t._sleepDetected=false},_needReloadRegistry:function(e){var t=this,i=new r({endpoint:"ИнформерПерсона"}),a={"ДатаВремя":null,"Тема":e&&e.theme?e.theme:null,"Сообщение":e&&e.theme&&e.msg?e.msg:null},o=t.lastDateTimeNotify,s=new Date;if(!o)(o=s).setDate(o.getDate()-1);if(a["ДатаВремя"]=o,"function"==typeof a["ДатаВремя"].setSQLSerializationMode)a["ДатаВремя"].setSQLSerializationMode(true);return i.call("НеобходимостьОбновленияРеестров",a).addCallbacks(function(n){t.lastDateTimeNotify=s,t._reloadProgress=0;var i=n.getRow(),a={checkdatetime:o,moreInfo:{incoming:i.get("Входящие"),outgoing:i.get("Исходящие"),chats:i.get("Чаты"),invites:i.get("Приглашения")}};if(e){var r=e.theme,l=a.moreInfo,h;if(l.incoming.length&&e.is_dialog)if(h=Array.indexOf(l.incoming,r),-1!=h)l.incoming.splice(h,1);if(l.outgoing.length&&e.is_dialog)if(h=Array.indexOf(l.outgoing,r),-1!=h)l.outgoing.splice(h,1);if(l.chats.length&&e.is_chat)if(h=Array.indexOf(l.chats,r),-1!=h)l.chats.splice(h,1);if(l.invites.length&&e.invite&&!c(e.invite))if(h=Array.indexOf(l.invites,r),-1!=h)l.invites.splice(h,1)}if(a.moreInfo.incoming.length||a.moreInfo.outgoing.length||a.moreInfo.chats.length||a.moreInfo.invites.length){var d="onNeedCheckRefresh";if(!t._DebugMode&&t._isCheckNotify(d,a))t.channel.notify(d,a)}},function(i){if(t._reloadProgress=t._reloadProgress||0,t._reloadProgress<10)t._reloadProgress++,setTimeout(function(){t._needReloadRegistry(e)},2e3*t._reloadProgress);else t._reloadProgress=0;n.resolve("ILogger").error(i)})},startTransport:function(e){var n,i=this;switch(e){case"ServerChannel":n=this._subscribeServerChannel,this.transportSet=true;break;default:return}if("undefined"!==typeof window&&i.myIsAuthorized())if(!t.global.getValue("mypersonid")&&!i.myIsAnnonim()){var o=new a;l.loadMyInfo(o,true),o.addCallback(n.bind(this))}else n.call(this)},stopTransport:function(e){var t=this;if(!t.transportSet)return;var n=i.channel("ticker");switch(e){case"ServerChannel":this._modeSubscribtions(false),require(["Lib/ServerEvent/Bus"],function(e){for(var n=t.events,i,a=0;a<n.length;a++){var o=n[a];(i=e.serverChannel("contacts."+o.toLowerCase())).unbind("onMessage")}for(a=0;a<t.__channels.length;a++)(i=e.serverChannel(t.__channels[a])).unbind("onMessage")})}t.transportSet=false},$constructor:function(){this._publish(this.events),this._publish(["onPhotoChanged","onNeedCheckRefresh"])},notify:function(e,t){this.channel.notify(e,t)},doAndNotify:function(t,n){var i=this,a=e(n);if(a["is_local"]=true,this._isCheckNotify(t,a))i.notify(t,a)},getOldEventName:function(e){var t=e.toLowerCase(),n;if(!this.lc_events){this.lc_events={};for(var i=0,a=this.events.length;i<a;i++)this.lc_events[this.events[i].toLowerCase()]=this.events[i]}return n=this.lc_events[t],n?n:e},_makeHash:function(e){var t,n=0;function i(e){var t=0,n=e.length,i;if(0===n)return t;for(var a=0;a<n;++a)t=(t<<5)-t+(i=e.charCodeAt(a)),t&=t;return t}function a(e,t,n){if(!n){if(t>0)t--;if("object"==typeof e&&null!==e){var o=[],s=1,r=void 0!==e.length&&(0===e.length||e.length>0);o.push(r?e.length+"[":"{");for(var l in e){if(r&&++s>10)break;if(e.hasOwnProperty(l)){var h=l.toString();if(!r)o.push(h);var c=e[l];if(c&&"object"==typeof c)if(t>0)o=o.concat(a(c,t));else o.push(c.toString());else if(void 0!==c&&null!==c&&""!==c)o=o.concat(a(c,0,true));else o.push("empty value"),o.push(i(h).toString())}}return o.push(r?"]"+e.length:"}"),o}}if(void 0===e||null===e||""===e)return[""];else return[e.toString()]}if(!e)return 0;for(var o=0,s=(t=a(e,10)).length;o<s;o++)n+=i(t[o]);return n},myIsAnnonim:function(){return"__сбис__аноним"===s.get("КлассПользователя")},myIsAuthorized:function(){return!!s.get("КлассПользователя")}});return new f});
//# sourceMappingURL=MessagesExchangeEvents.module.js.map
define("js!SBIS3.Contacts.CommonFunctions.SignHelpers",["Core/Deferred","js!SBIS3.Contacts.MessagesExchangeEvents"],function(i,e){var n={getSignOptionsForDocView:function(){var s=new i,t=function(i){return!(i&&2==i.get("encrypted"))};return require(["js!SBIS3.Contacts.DOCVIEW.cmdSignFile"],function(i){s.callback({commands:[{name:"signGroup",icon:"sprite:icon-16 icon-Signature icon-primary",tooltip:rk("Подписать"),caption:rk("Подписать"),isMainAction:false,inInline:false,inList:true,weightlist:114,typeCmd:"r",cmdClass:i,isAvailable:t,items:[{id:"just_sign",title:rk("Подписать")},{id:"for_first_sign",title:rk("Запросить подпись")},{id:"for_sign",title:rk("Подписать и запросить подпись")}]},{name:"cmdAddSignInline",icon:"sprite:icon-24 icon-Signature icon-primary",tooltip:rk("Подписать"),caption:rk("Подписать"),isMainAction:false,weight:305,weightlist:34,weightmas:24,inInline:true,inList:false,typeCmd:"r",cmdClass:i.extend({$protected:{_options:{id:"cmdAddSignInline",askUser:true}}})}],handler:function(i,s,t){var a=this.getTreeView(),r=a?a.getItems():null,o="cmdAddSignInline"===s;if(t&&t.hasOwnProperty("finishParams")&&("cmdSignFile"===s||o)){var l=this.getParent();if("function"===typeof l.consume){var f=t.finishParams.serviceType,g=t.finishParams.files_for_sign;if("just_sign"===f||o&&t.records){t.finishParams.files=[],g=[],t.finishParams.files_for_sign=void 0;for(var c=0;c<t.records.length;c++){var d=t.records[c],m=d.get("msgFileId");t.finishParams.files.push(),g.push({"Файл":m,"ИдФайла":d.get("attachId"),"ДискИдВерсии":d.get("redactionId")})}}var u=l.consume("signFiles",{messageParams:t.finishParams,files:g})[0];if(u&&u.executed)u.result.addCallback(function(){var i=t.finishParams,s=[];if("just_sign"===i.serviceType){for(var a=0;a<i.files.length;a++){var o=r.getIndexByValue("msgFileId",i.files[a]),l=null;if(-1!==o)l=r.at(o),n.fillMySignData(l);if(t.finishParams.msg)s.push({theme:t.finishParams.themeGUID,msg:t.finishParams.msg,msgFileId:i.files[a],redactionId:l?l.get("redactionId"):void 0})}if(s.length)e.doAndNotify("onFilesSign",s)}})}else{var h=this.getParentByClass("SBIS3.Contacts.DialogHistoryBP");if(h)h._notify("onSignFile",t.finishParams)}}}})}),s},fillMySignData:function(i){if(i&&i.get){var e=i.get("signs");if(3!==e)i.set("signs",1===e?3:2)}}};return n});
//# sourceMappingURL=Sign.module.js.map
define("js!SBIS3.Contacts.CommonFunctions.SearchHelpers",["Core/Context","Core/IoC","Core/constants","Lib/Control/Control"],function(e,t,n,r){var o="Contacts.StopSearchViews",i=function(e,n,r){for(var o=[n.getContainer().find("input"),e.getContainer()],i=s,a=r?"unbind":"bind",c=0,l=o.length;c<l;c++)o[c][a].call(o[c],"keydown",i);t.resolve("ILogger").log("_keyEventBindUnbind",(r?"un":"")+"binded  keydown in SBIS3.Contacts.CommonFunctions.SearchHelpers._keyUpBindUnbind")},s=function(i){if(i.which===n.key.esc){var a=e.global.getValue(o),c=$(i.target),l,f,u=function(e){e.unbind("keydown",s),t.resolve("ILogger").log("unbinded keydown in SBIS3.Contacts.CommonFunctions.SearchHelpers._keyUpHandler")};if(c.attr("data-component"))f=c.attr("id");else{var p=c.parents('[data-component="SBIS3.CONTROLS.SearchForm"]');if(!p.length)p=c.parents('[data-component="Contacts/Search/PersonForm"]');if(p.length)l=p.attr("id")}if(l)f=a[l];else if(f)l=a[f];if(!f||!l)return void u(c);try{var g=r.ControlStorage.get(f);if(!g.isDestroyed()){i.stopImmediatePropagation();var d=g.getUserData("Contacts.StopSearchFunction");if("function"===typeof d)d(g);else if("function"===typeof g.setInfiniteScroll)g.setInfiniteScroll(false,true);else t.resolve("ILogger").error("Не удалось остановить поиск - нет функции нужной у представления данных с id="+f);return false}}catch(e){u(c)}}},a={prepareSearchForESC:function(e,n,r){var o=function(e,t){var n=function(){var e=this.v;a.searchStopByESC(null,"function"===typeof e?e():e,this.s,this.unreg)};e.subscribe("onSearch",n.bind({v:t,s:e,unreg:false})),e.subscribe("onReset",n.bind({v:t,s:e,unreg:true})),e.subscribe("onDestroy",n.bind({v:t,s:e,unreg:true})),t.subscribe("onDestroy",n.bind({v:t,s:e,unreg:true}))};if(("string"===typeof e||"object"===typeof e)&&"string"===typeof n&&"string"===typeof r){var i="object"===typeof e?e:this.getParentByName(e);o(i.getChildControlByName(n),i.getChildControlByName(r))}else if("object"===typeof n&&("object"===typeof r||"function"===typeof r))o(n,r);else t.resolve("ILogger").error("prepareSearchForESC","Неверные значения параметров searchName и viewName")},searchStopByESC:function(n,r,s,a){if("object"!==typeof r)t.resolve("ILogger").error("searchStopByESC","Неверное значение параметра view");var c=e.global.getValue(o),l=r.getId(),f=s.getId();if(a){if(!c)return;if(c.hasOwnProperty(l)&&c[l]||c.hasOwnProperty(f)&&c[f])i(r,s,true),delete c[l],delete c[f],e.global.setValue(o,c)}else{if(!c)c={};if(!c.hasOwnProperty(l)||!c[l]||!c.hasOwnProperty(f)||!c[f]){if(c[l]=f,c[f]=l,"function"===typeof n)r.setUserData("Contacts.StopSearchFunction",n);i(r,s),e.global.setValue(o,c)}}},buildSearchParamsString:function(e){var t=[];if(e){if(e.currentFolderOnly)t.push("currentFolderOnly");if(e.all)t.push("all");else{if(e.sender)t.push("sender");if(e.receiver)t.push("receiver")}if(e.context)t.push("context");if(e.all_messages)t.push("all_messages");if(e.or)t.push("or");if(e.exact)t.push("exact")}return t.join(" ")}};return a});
//# sourceMappingURL=Search.module.js.map
define("js!SBIS3.CONTROLS.Utils.LinkWrap",["SBIS3.CONTROLS/Utils/LinkWrapUtils"],function(i){return i});
//# sourceMappingURL=Utils_LinkWrap.module.js.map
define("js!SBIS3.Contacts.CommonFunctions.Global",["Core/helpers/string-helpers","Core/helpers/fast-control-helpers","Core/helpers/additional-helpers","Core/detection","Core/Indicator","Core/Context","Core/IoC","Core/Deferred","Core/UserInfo","Lib/Control/Control","js!WS.Data/Source/SbisService","js!SBIS3.CONTROLS.Utils.LinkWrap","js!SBIS3.Contacts.CoreMiniFunctions","js!SBIS3.Contacts.CommonFunctions.SearchHelpers","js!SBIS3.Contacts.CommonFunctions.SignHelpers","js!SBIS3.Engine.Clipboard","js!WS.Data/Entity/Record","js!WS.Data/Collection/RecordSet"],function(e,t,n,r,i,s,a,o,l,c,u,f,g,d,p,h,m,v){"use strict";var C=function(e){Object.keys(e).forEach(function(t){b[t]=e[t]})},b={question:function(e,t){return g.question(e,t)},alert:function(e,t){return g.alert(e,t)},loadMyInfoInGlobalContext:function(e){var t=new o;require(["js!SBIS3.Contacts.PreloadContactsData"],function(n){return t=n.loadMyInfo(e,true).addErrback(function(e){if(!g.msgNotWork(e))a.resolve("ILogger").error(e.message,e.detail)}),t})},isContentVisibleForUser:function(e,t,n){return g.isContentVisibleForUser(e,t,n)},callIfContentBecomeVisibleForUser:function(e,t,n){return g.callIfContentBecomeVisibleForUser(e,t,n)},openDocById:function(e,t,n){require(["js!SBIS3.Contacts.OpenerHelper"],function(r){r.openDocById(e,t,n)})},openDocByModel:function(e,t){require(["js!SBIS3.Contacts.OpenerHelper"],function(n){n.openDocByModel(e,t)})},openDocWithMsg:function(e,t,n,r,i,s,a,o){return g.openDocWithMsg(e,t,n,r,i,s,a,null,null,o)},onDataLoadError:function(e,t){return g.onDataLoadError(e,t)},copyTextToClipBoard:function(e){var t=new h,n=new u({endpoint:{contract:"SBISBuffer",address:-1===window.wsConfig.appRoot.search("sbisbuffer")&&"/sbisbuffer/service/sbis-rpc-service300.dll"}}),r=new v({adapter:"adapter.sbis"}),i=new m({adapter:"adapter.sbis",format:[{name:"url",type:"string"}]});t.setText(e),i.set("url",e),r.add(i),n.call("AddObjects",{IsPersistent:true,Content:r})},isCurrentClient:function(e){return g.isCurrentClient(e)},isCurrentPerson:function(e){return g.isCurrentPerson(e)},isInMySbis:function(){return g.isInMySbis()},getCachedPhotoUrl:function(e,t){return g.getCachedPhotoUrl(e,t)},getObjectLength:function(e){if(Object.keys)return Object.keys(e).length;else{var t=0;for(var n in e)if(e.hasOwnProperty(n))t++;return t}},getPeriodLimit:g.getPeriodLimit,getFormattedSizeString:function(e){var t=["Кб","Мб","Гб","Тб","Пб"],n=0,r;if(isFinite(e)){e/=1024;while(e/1e3|0&&n<b.getObjectLength(t)-1)e/=1024,n++;if(0==e.toFixed(1))if(0==e.toFixed(2))r=e.toFixed(3);else r=e.toFixed(2);else r=e.toFixed(1)}else r=0;return[r,rk(t[n],"fileSize")].join(" ")},isBilling:g.isBilling,hasViewFastAnswer:function(e,t,n){return g.hasViewFastAnswer(e,t,n)},hideFastAnswerView:function(e){if(e.hasChildControlByName("FastAnswer"))e.getChildControlByName("FastAnswer").hide()},getStringWithCrc32Pref:function(e){return g.getStringWithCrc32Pref(e)},utf16toUtf8:function(e){return g.utf16toUtf8(e)},getCrc32ForString:function(e){return g.getCrc32ForString(e)},utf8Encode:function(e){return g.utf8Encode(e)},getServiceMessage:function(e,t,n){return g.getServiceMessage(e,t,n)},sendMessage:function(t,n){var r;function a(n){var s=[],a=n.length,o;for(o=0;o<a;o++)s.push(n[o].Персона);require(["js!SBIS3.Contacts.MessagesExchangeEvents"],function(n){n.subscribe("onSendReady",c);var a=new u({endpoint:"Персона"}),o={"Получатели":s,"Текст":d,"Диалог":t.themeGUID?t.themeGUID:null,"Документ":t.docGUID?t.docGUID:null,"Сообщение":t.messageGUID?t.messageGUID:null,"Файлы":t.files?t.files:[]},l=new m({adapter:"adapter.sbis"});if(t.hasOwnProperty("folderId")&&t.folderId&&"null"!=t.folderId)l.addField({name:"Папка",type:"string"}),l.set("Папка",t.folderId);if(t.hasOwnProperty("serviceType")&&t.serviceType&&"null"!=t.serviceType)l.addField({name:"ТипСообщения",type:"string"}),l.set("ТипСообщения",t.serviceType);if(t.hasOwnProperty("massMessage")&&void 0!=t.massMessage)l.addField({name:"МассовоеСообщение",type:"boolean"}),l.set("МассовоеСообщение",t.massMessage);if(t.hasOwnProperty("joinPrevMessage")&&void 0!=t.joinPrevMessage)l.addField({name:"СлитьСПредыдущим",type:"boolean"}),l.set("СлитьСПредыдущим",t.joinPrevMessage);if(t.hasOwnProperty("allReceiversTheme")&&void 0!=t.allReceiversTheme)l.addField({name:"ВсемУчастникамТемы",type:"boolean"}),l.set("ВсемУчастникамТемы",t.allReceiversTheme);if(t.hasOwnProperty("isFastAnswer")&&t.isFastAnswer){if(l.addField({name:"БыстрыйОтвет",type:"boolean"}),l.set("БыстрыйОтвет",t.isFastAnswer),t.hasOwnProperty("docType")&&void 0!=t.docType)l.addField({name:"ТипДокумента",type:"integer"}),l.set("ТипДокумента",t.docType);if(t.hasOwnProperty("docGUID")&&void 0!=t.docGUID)l.addField({name:"Документ",type:"uuid"}),l.set("Документ",t.docGUID)}o["Опции"]=l,b._needShowIndicator=true,setTimeout(function(){var t=s.length;if(b._needShowIndicator&&t){var n="{0} {1} {2}".format(rk("Отправка сообщения","send_message"),t,1==t?rk("получателю","send_message"):e.wordCaseByNumber(t,rk("получателям","send_message"),rk("получателю","send_message_many"),rk("получателям","send_message")));i.setMessage(n)}},3e3),a.call("СОтправить",o).addCallbacks(function(e){var t=e.getRow(),s=t&&t.has("Статус")&&"sending"==t.get("Статус")?true:false;if(t&&t.has("Статус")&&"message_length_over_limit"==t.get("Статус")?true:false)i.hide(),b._needShowIndicator=false,g.defaultErrorForSend(rk("Длина введенного текста больше максимально допустимой длины."),true,true),f.errback(),n.unsubscribe("onSendReady",c);else if(!t||!s)i.hide(),b._needShowIndicator=false,n.unsubscribe("onSendReady",c),f.callback(t);else b._sendResultDef={result:t,theme:t.get("Диалог"),msg:t.get("Сообщение")},r=setTimeout(function(){i.hide(),b._needShowIndicator=false,b._sendResultDef=null,n.unsubscribe("onSendReady",c),f.callback(t)},3e4);return t},function(e){if(i.hide(),b._needShowIndicator=false,!g.msgNotWork(e))g.sendMessageErrorOut(e);return f.errback(e),n.unsubscribe("onSendReady",c),e})})}function c(e,t){var n=t?t.theme:null,s=t?t.msg:null,a=b._sendResultDef?b._sendResultDef.theme:null,o=b._sendResultDef?b._sendResultDef.msg:null,l=b._sendResultDef?b._sendResultDef.result:null;if(r&&s==o&&n==a)clearTimeout(r),i.hide(),b._needShowIndicator=false,b._sendResultDef=null,require(["js!SBIS3.Contacts.MessagesExchangeEvents"],function(e){e.unsubscribe("onSendReady",c)}),f.callback(l)}var f=new o,d=void 0!==t.msgText&&null!==t.msgText?t.msgText:null;if(t.filesArr=t.filesArr||[],-1!==["not_sign","for_second_sign","sign","dialog_invite"].indexOf(t.serviceType)?false:!(t.files&&t.files.length)&&!d)f.errback("Плохие параметры");else{for(var p=[],h=0;h<t.persons.length;h++)p.push({"Персона":t.persons[h]});a(p)}return f.addCallback(function(e){if(e)require(["js!SBIS3.Contacts.MessagesExchangeEvents"],function(r){var i="union_with_last_message"==e.get("Статус"),a=s.global.getValue("myfaceinfo"),o=e.get("local_event_data"),c=i?{changes_for:[{is_chat:!!n,text:e.get("Текст"),theme:e.get("Диалог"),msg:e.get("Сообщение")}],localInfo:{"Текст":e.get("Текст")},state:"edited",user:l.get("ИдентификаторСервисаПрофилей")}:{text:e.get("Текст"),theme:e.get("Диалог"),msg:e.get("Сообщение"),outgoing:-1==$.inArray(l.get("ИдентификаторСервисаПрофилей"),t.persons)?true:void 0,sender:{person:l.get("ИдентификаторСервисаПрофилей"),partsOfName:[a["Фамилия"],a["Имя"],a["Отчество"]],activity:{online:true},department:a["Отдел"],post:a["Должность"],companyName:a["КлиентНазвание"]},receivers:t.persons,folders_ido:[t.folderId],is_files:e.get("Файлы")&&e.get("Файлы").length?true:void 0,is_chat:!!n,is_dialog:!n||0!=t.persons.length,type_chat:o["type_chat"],chat_is_public:o["chat_is_public"],chat_root_reestr:o["chat_root_reestr"],chat_dif:o["chat_dif"],dialog_dif:o["dialog_dif"],invite:o["invite"],reestr:o["reestr"],is_private:o["is_private"]};r.doAndNotify(i?"onChangeMessage":"onNewMessage",c)});return e}),f},getPhotoUrl:function(e,t){return g.getPhotoUrl(e,t)},getPersonPhotoHTML:function(e,t,n,r,i){return g.getPersonPhotoHTML(e,t,n,r,i)},getGroupPhotoUrl:function(e,t,n){return g.getGroupPhotoUrl(e,t,n)},getActivityIcon:function(t,n){n=n||"";var r=b.getActivityIconClasses(t);return e.format({activityClasses:n,imgClasses:r[0],title:r[1]},'<div class="$activityClasses$s$ $imgClasses$s$" title="$title$s$"></div>')},getActivityIconClasses:function(e){var t="",n="";switch(e){case 1:t="icon-16 icon-PhoneGetAutomatically icon-hover",n=rk("На рабочем месте, активен");break;case 2:t="icon-16 icon-PhoneGetAutomatically icon-disabled",n=rk("На рабочем месте, не активен");break;case 3:t="icon-16 icon-PhoneGetManually icon-hover",n=rk("Не на рабочем месте, активен");break;default:t="icon-16 icon-PhoneGetManually icon-disabled",n=rk("Не на рабочем месте, не активен")}return[t,n]},getFIOString:function(t){var n=[],r,i;for(var s in t)if(t.hasOwnProperty(s))if(r=t[s],r&&"null"!=r&&r.length)n.push(r);if("function"!==typeof String.prototype.trim)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};return i=n&&n.length?e.escapeHtml(n.join(" ")):"["+rk("Неизвестный пользователь")+"]",i.trim(i)},getTextForTape:function(t,n,r){r=r||false;var i="";if(t.length){var s=t,a=0,o="",l=0,c={},u=/\s?<div class=["']contacts-Blockquote controls-RichEditor__noneditable["']>/gim,f=s.search(u);if(-1!=f)if(0==f)return'<span class="icon-16 icon-Quote"></span> Цитата';else t=s.substring(0,f);s=t=t.replace(/<span.*?class="LinkDecorator__wrap"><img.*alt=["'](.*)['"] .*\/><\/span>/gi," $1 ");do{var g=/<img[^>]+?src=["'](.*?)["'][^>]*>/gim,d=s.match(g)?s.match(g).length:0,p=g.exec(s),h="";if(p&&p.length)if(p[0].indexOf("ws-fre__smile")+1)l+=p.index,o="s"+(a<10?"0"+a:a),t=t.substring(0,l+7*a)+"$"+o+"$s$"+t.substring(l+7*a+p[0].length),c[o]=p[0].replace(/<img [\s\S]*? smile([\s\S]+?)['" ][\s\S]*?>/gim,'<div class="message-smile icon-16 icon-Emoicon$1 icon-primary"></div>'),a+=1,s=s.substring(p.index+p[0].length);else{if(p[1]&&""!=p[1])h=": "+e.escapeHtml(p[1]);if(i='<div class="icon-16 icon-Picture icon-primary" style="padding-right: 4px" title="Картинка'+h+'"></div>',d>1)i+="(+ ещё "+(d-1)+") ";break}else break}while(d>1);var m=t.split("<"),v="",C=m.length>1?t.substring(m[0].length):t,b=/<iframe.+src.+>.*<\/iframe>/i;if(b.test(t)){var S=/src="([^"]+)"/.exec(t.substring(m[0].length));if(0!=S.length)v="кадр из "+S[0].replace(/("|\/\/|src=)/g,"").split("/")[0];else v="кадр из внешнего источника";v=v.trim()}if(v)C=C.replace(b," "+v+" ");if(!n)t=e.escapeHtml(C.replace(/<br(.*?)>/g," ").replace(/<\/p(.*?)>/g," ").replace(/<\/?[^>]+>/g,"").trim());else t=Object.isEmpty(c)?C:e.escapeHtml(C.replace(/<br(.*?)>/g," ").replace(/<\/p(.*?)>/g," ").replace(/<\/?[^>]+>/g,"").trim());if(r&&a>0){if(t.replace(/\$s\d+\$s\$/g,"").trim().length>0)for(var y in c)if(c.hasOwnProperty(y))c[y]="";var I=(t=(t=e.format(c,t)).trim()).indexOf("\n");if(I>0)t=t.substr(0,I)}else t=e.format(c,t);if(r)t=(t=t.replace(/(<[^>]*)style="[^"]*"/g,"$1")).replace(/(<(?!span.*icon|div.*icon)[^>]*)class="[^"]*"/g,"$1")}var w=$("<div>"+i+t.replace(/\&nbsp;/g," ")+"</div>").html(),k=w.length,_;if(_=w.replace(/\ud83d[\ude00-\ude4f]|<\/p(.*?)>|<br(.*?)>|<\/?[^>]+>/g,"").trim(),k!=_.length)if(_.length)return"<p>"+e.escapeHtml(_)+"</p>";else return'<div class="message-smile">'+w.replace(/<\/p(.*?)>|<br(.*?)>|<\/?[^>]+>/g,"").trim()+"</div>";return i+t},getFIOFromRec:function(e){return g.getFIOFromRec(e)},isEmpty:function(e){if("object"!==n.type(e))return true;if(b.getObjectLength(e))return false;return true},stringToFormatDateTime:function(e,t){if("string"==typeof e){var n=/^(\d{4})-(1[012]|0[1-9])-([012][0-9]|3[01])\s([01][0-9]|2[0-4])\:([0-5][0-9]|60)\:([0-5][0-9]|60)$/gi.exec(e.split(".")[0]),r,i,s,a,o,l;if(7==n.length)return r=n[1],i=parseInt(n[2])-1,s=n[3],a=parseInt(n[4])-3,o=parseInt(n[5])+-1*t,l=n[6],new Date(r,i,s,a,o,l)}else if(e)return e;else return new Date},checkIsDemo:function(){var e=new o,t=s.global.getValue("MessageIsDemo");if(void 0===t)new u({endpoint:"Сообщение"}).call("МожноПрикрепитьФайл",{}).addBoth(function(n){t=n&&!n.errType&&"function"==typeof n.getScalar&&true===n.getScalar(),s.global.setValue("MessageIsDemo",t),e.callback(t)});else e.callback(t);return e},getCorrespondenceFilterValue:function(e){return e="ОбменСообщениями."+b.checkCrc32AndGetSafeString(e),new u({endpoint:"ПользовательскиеПараметры"}).call("ПолучитьЗначение",{"Путь":e}).addCallback(function(t){var n=t.getScalar();return s.global.setValue(e,n),n})},checkCrc32AndGetSafeString:function(t,n){var r=false,i,s,a,o,l,c;if(/^&re_/gi.test(t))if(i=t.split("_"),i.length>=2)a=parseInt(i[1],10),c=i[0].length+i[1].length+2,s=t.substring(c),r=a===(o=b.getCrc32ForString(s));if(r)l=n?b.setTrueBackgroundToTextBlock(s):s;else{var u="&re";if(t&&"string"===typeof t&&t.substr(0,3)===u){var f,g,d;if(d=t.indexOf("_"),d>=0)if(f=t.substring(0,d),g=t.substring(d+1),g){var p=10,h=u,m;if(g.length<p)p=g.length;for(var v=0;v<p;v++)h+=(m=g[v]).charCodeAt();if(h===f)l=n?b.setTrueBackgroundToTextBlock(g):g}}if(!l)l=e.escapeHtml(t)}return b.wrapFilesAndUrl(l)},setTrueBackgroundToTextBlock:function(e){var t=e.indexOf("background");while(-1!==t){var n=e.substring(0,t);if(n.lastIndexOf("<")<n.lastIndexOf(">")){t=e.indexOf("background",t+9);continue}var r=e.indexOf('"',t),i=e.lastIndexOf('"',t),s=[e.substring(0,i),"",e.substring(r+1)],a=e.substring(i,r+1),o=a.toLowerCase(),l=o.search(/[", ]co[^;]*/),c=l+1?o.substring(l,o.indexOf(";")):null;if(l+1&&(c.indexOf("#fff")+1||c.indexOf("white")+1)){if(a=a.replace(/[", ]co[^;]*/," color: #000"),'"'!==a[0])a='"'+a;s[1]=a,e=s.join("")}t=e.indexOf("background",r)}return e.replace(/&quot;|&#35;/gi,'"')},wrapFilesAndUrl:function(e){return e=e.replace(/&quot;|&#35;/gi,'"'),f.wrapURLs(f.wrapFiles(e),true)},setCorrespondenceFilterValue:function(e,t){if("string"!==typeof t)t=t.toString();return e="ОбменСообщениями."+b.checkCrc32AndGetSafeString(e),s.global.setValue(e,t),new u({endpoint:"ПользовательскиеПараметры"}).call("ВставитьЗначение",{"Путь":e,"ЗначениеПараметра":t}).addCallback(function(e){return e.getScalar()})},askQuestion:function(e,n,r){var i="Yes"===(r=r||"Cancel"),s="No"===r,a="Cancel"===r;return t.question(null,{message:e,detail:n,buttons:[{name:"Yes",tabindex:i?1:2,isDefault:i,defaultButton:i,caption:rk("Да"),handlers:{onActivated:function(){this.getParent().close(true)}}},{name:"No",tabindex:s?1:a?3:2,isDefault:s,defaultButton:s,caption:rk("Нет"),handlers:{onActivated:function(){this.getParent().close(false)}}},{name:"Cancel",tabindex:a?1:3,isDefault:a,defaultButton:a,caption:rk("Отмена"),width:"",handlers:{onActivated:function(){this.getParent().close("cancel")}}}]})},getTextWithoutTags:function(t){var n=t,r=0,i="",s=0,a="",o={};do{var l=/<img[^>]+?src=["'](.*?)["'][^>]*>/gim,c=n.match(l)?n.match(l).length:0,u=l.exec(n),f="";if(u&&u.length)if(u[0].indexOf("ws-fre__smile")+1)s+=u.index,i="s"+(r<10?"0"+r:r),t=t.substring(0,s+7*r)+"$"+i+"$s$"+t.substring(s+7*r+u[0].length),o[i]=u[0].replace(/<img [\s\S]*? smile([\s\S]+?)['" ][\s\S]*?>/gim,'<div class="message-smile icon-16 icon-Emoicon$1 icon-primary"></div>'),r+=1,n=n.substring(u.index+u[0].length);else{if(u[1]&&""!=u[1])f=": "+e.escapeHtml(u[1]);if(a='<span style="color: #999999; margin-right: 6px;">'+rk("Изображение"),c>1)a+=" (+ "+rk("ещё")+" "+(c-1)+") ";a+="</span>";break}else break}while(c>1);var g=t.split("<"),d="",p=t.substring(g[0].length),h=/<iframe.+src.+>.*<\/iframe>/i;if(h.test(t)){var m=/"([^"]+)"/.exec(t.substring(g[0].length));if(0!=m.length)d=rk("кадр из")+" "+m[0].replace(/("|\/\/)/g,"").split("/")[0];else d=rk("кадр из внешнего источника");d=d.trim()}if(d)h=/<iframe.+src.+>.*<\/iframe>/gi,p=p.replace(h," "+d+" ");return t=e.escapeHtml(p.replace(/<br(.*?)>/g," ").replace(/<\/?[^>]+>/g,"").trim()),t=e.format(o,t),a+t},getFIOFromRecBP:function(t){var n=[],r,i;if(t.get("Фамилия"))n.push(t.get("Фамилия"));if(t.get("Имя"))n.push(t.get("Имя"));if(!n.length)if(t.get("ФИО"))n.push(t.get("ФИО"));else if(t.get("Название"))n.push(t.get("Название"));else if(t.get("НазваниеПолное"))i=(r=t.get("НазваниеПолное")).split(" "),n.push(i[0]),n.push(i[1]);var s=e.escapeHtml(n.join(" "));return s=s&&s.length?s:"["+rk("Неизвестный пользователь")+"]",s},popupInformerShow:function(e,t,n,r,i,s){g.showPopupNotification({caption:e,text:t,footer:"",type:n})},setEmptyHTMLForRegistry:function(e,t,n){var r=e.getFilter();if(r["Поиск"]||r["ПоискПерсоны"])e.setEmptyHTML(n||"");else e.setEmptyHTML(t||"")},plural:function(e,t,n,r,i){return g.plural(e,t,n,r,i)},getMoreStr:function(e,t){return g.getMoreStr(e,t)},checkCorrespondenceAvailabilityWithoutAccess:function(e){return g.checkCorrespondenceAvailabilityWithoutAccess(e)},resetInformerFromCorresp:function(){if(window.resetMsgInformer)window.resetMsgInformer();else window.resetMsgInformerLater=true},showPopupNotification:function(e){return g.showPopupNotification(e)},defaultErrorForSend:function(e,t,n){return g.defaultErrorForSend(e,t,n)},sendMessageErrorOut:function(e){return g.sendMessageErrorOut(e)},getActivityStatus:function(e,t){if(e)if(t)return 1;else return 3;else if(t)return 2;else return 4},placesAddCards:function(e,t,n){var i=r.isMobilePlatform||r.isMobileAndroid||r.isMobileIOS||r.isMacOSMobile||r.isMobileSafari,s,o,l,c,u={};if(e.length&&(!i||i&&n)&&!b.isInMySbis())require(["js!SBIS3.Contragents.FunctionsCommon"],function(t){if(!t)return void a.resolve("ILogger").error("require(['js!SBIS3.Contragents.FunctionsCommon'])","получен undefined вместо загруженного класса. Визитки контрагентов не могут показываться");for(s=0;s<e.length;s++)if(o=$(e[s]),o.removeClass("initial-place"),l=parseInt(o.attr("placeId")),l)if(i)o.click(function(e){e.preventDefault();var n=$(this);t.showContragentMiniCard(n,n.attr("placeId"),false,{offset:{x:20},errBack:function(e){b.alert(rk("Невозможно открыть визитку контрагента"),{})}}),e.stopPropagation()});else t.showContragentMiniCardOnHover(o,l,false,{offset:{x:20},errBack:function(e){b.alert(rk("Невозможно открыть визитку контрагента"))}})});else if(i)for(s=0;s<e.length;s++)(o=$(e[s])).removeClass("initial-place").removeClass("place-company").addClass("place-company-touch");if(t.length&&(!i||i&&n))require(["js!SBIS3.Staff.DepartmentMiniCard"],function(e){for(s=0;s<t.length;s++)if(o=$(t[s]),o.removeClass("initial-place"),o.attr("data-minicard-reloadOpener",false),c=o.attr("minicardid"),l=parseInt(o.attr("placeId")),void 0===c&&l){if(c=u[l],!c)c=e.initCard(l,{showByHover:i?false:true,showByClick:i?true:false}),u[l]=c;o.attr("MiniCardId",c)}});else if(i)for(s=0;s<t.length;s++)(o=$(t[s])).removeClass("initial-place").removeClass("place-department").addClass("place-department-touch")},openContragentCardFromContact:function(e,t){require(["js!SBIS3.Contragents.FunctionsCommon"],function(n){if(t&&"string"===typeof t)t=c.ControlStorage.getByName(t);n.showContragentMiniCard(t,e,false,{offset:{x:20},errBack:function(e){b.alert(rk("Невозможно открыть визитку контрагента"))}})})},getLastDialogsViewDate:function(e,t){return g.getLastDialogsViewDate(e,t)},updateLastDialogsViewDate:function(e,t){return g.updateLastDialogsViewDate(e,t)},_prepareDocViewerToEditInMessage:function(e,t,n){if(e&&t)e.subscribeTo(e,"onFinishCommand",function(e,r,i){var s=i.finishParams,a=i.records[0].get("attachId"),o=function(){require(["js!SBIS3.Contacts.Storage.OpenedThemes","js!SBIS3.CONTROLS.Utils.InformationPopupManager"],function(e,r){var i=e.getThemes(t);if(i&&i.length)return;r.showConfirmDialog({message:rk("Документ был изменен. Перейти в диалог для отправки новой редакции?")},function(){require(["js!SBIS3.Contacts.MessagePanel"],function(e){e.open({themeGUID:t},true)})},function(){new u({endpoint:"Персона"}).call("СИнформацияПоДиалогу2",{"Тема":t,"Сообщение":n}).addCallback(function(e){var n=e&&e.getRow();if(n){var r=n.get("ОтредактированныеФайлы");if(!r)return;for(var i=r.getCount();i--;){var s=r.at(i);if(s.get("attachId")===a){new u({endpoint:"Сообщение"}).call("УдалитьФайлы",{"Тема":t,"Файлы":[s.get("msgFileId")]});break}}}})})})};if("imageEdit"===r&&s&&s.saving&&s.saving.addCallback)s.saving.addCallback(function(){o()});else if("saveChanges"===r||"editInApp"===r)o()})},checkNeedInviteContact:function(e){return g.checkNeedInviteContact(e)},checkElementByClass:g.checkElementByClass,errorMessageService:g.errorMessageService,checkOnScreen:g.checkOnScreen,loadDialogsSettings:g.loadDialogsSettings,appendClientFieldsToRS:g.appendClientFieldsToRS,getLastDialogsViewFictiveDate:g.getLastDialogsViewFictiveDate,setLastDialogsViewFictiveDate:g.setLastDialogsViewFictiveDate};return C(d),C(p),b});
//# sourceMappingURL=Functions.module.js.map
define("html!SBIS3.Contacts.ServiceMessage/ServiceMessage",function(){var e=function(e){var o=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(o){for(;e.test(o);)o=o.replace(e,"&#123;&#123;$1&#125;&#125;");return o}}(),n=function(e){return e.join?e.join(""):e.toString()},t=function(e){return void 0===e?"":e&&"object"==typeof e?n(e):""+e},s="undefined"!=typeof process,i=("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),r=function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,a="",c=e._superType(),p="sign"==e.type,l="not_sign"==e.type,d=e.serviceObject(),g=e.persons==e.myPerson,m=d&&d.receivers&&d.receivers.indexOf(e.myPerson)>-1,v=(e.signs.length,e.filesByGroup),f="for_first_sign"===e.type||"for_second_sign"===e.type||"for_sign"===e.type;if(a+=' <div class="contacts-ServiceMessage service-message',e.showBorder&&e.showSignElements&&"sign"==c&&!l&&!d.hideBorders&&(a+=" with-border"),"sign"==c&&(a+=" signed-message"),v&&!e.need_answer_sign&&(a+=" has-file-preview"),a+='"> ',("invite"==c||l)&&(a+=" "+o(t(e.messageText()))+" "),a+=" ","sign"!=c||l||(a+=" ",e.showBorder&&!p&&(d.hideBorders||e.need_answer_sign||!f)||!e.showSignElements&&f||(a+=' <p class="',a+=p?"signTitle":"askSign",a+=' to-left">'+o(t(e.messageText())),a+=p?' <span class="tooltip-target">('+o(t(rk("sign_msg@@"+o(t("количество")))))+" - "+o(t(e.count))+")</span>":":",a+="</p> "),a+=" ",e.filesByGroup&&(a+=" "+o(t(e.signedTpl({filesByGroup:v,message:e.msgKey,themeGUID:e.themeGUID,isMobile:e.isMobile})))+" "),a+=" ",f&&e.need_answer_sign&&e.showSignElements&&(a+=' <component data-component="SBIS3.Contacts.ServiceMessageBase" name="ServiceSignButtons" class="buttons"> <option name="type">'+o(t(e.type))+'</option> <option name="serviceObject" type="ref">'+o(t(function(e,o){var n=i.randomId();return e[n]=o,n}(r,e._buttonObject)))+'</option> </component> <p class="',a+=p?"signTitle":"askSign",a+='">'+o(t(e.messageText())),a+=p?' <span class="tooltip-target">('+o(t(rk("sign_msg@@"+o(t("количество")))))+" - "+o(t(e.count))+")</span>":":",a+="</p> "),a+=" "),a+=" ","sign"!=c&&"invite"!=c&&"set_read_right"!=e.type&&"new-chat"!=e.type&&"chat-new-admin"!=e.type&&"new-chater"!=e.type&&"stop-chater"!=e.type&&"chat-remove-admin"!=e.type&&"chat_unlock"!=e.type){if(a+=' <div style="',e.showBorder&&d.borderColor&&(a+="border-bottom: 1px solid "+o(t(d.borderColor))+";border-top: 1px solid "+o(t(d.borderColor))+";padding-bottom: 12px;padding-top: 6px;"),a+='"> ',e.showBorder&&d.buttons){a+=' <div class="buttons"> ';var S=d.buttons;if(S)for(var u=-1,y=S.length-1;u<y;)_=S[u+=1],a+=" ",(!g&&e.isIncome&&m||_.showForAll)&&(a+=' <component data-component="SBIS3.CONTROLS.Button" name="'+o(t(_.name))+'"> <option name="caption">'+o(t(_.caption))+'</option> <option name="primary">'+o(t(_.active))+"</option> <options name='handlers'> <option name='onActivated' type='function'>js!SBIS3.Contacts.ServiceMessage:prototype._onButtonActivate</option> </options> </component> "),a+=" ";a+=" </div> "}if(a+=" ",d&&d.serviceIcon&&(a+='<div class="service-message-icon '+o(t(d.serviceIcon))+'"></div>'),a+=" ",d&&d.serviceMessage&&(a+=' <div style="color: '+o(t(d.serviceMessageColor))+";",d.serviceMessageFontSize&&(a+=" font-size: "+o(t(d.serviceMessageFontSize))+"px;"),(d.links||d.serviceIcon)&&(a+=" display: inline;"),a+='">'+o(t(d.serviceMessage))+"</div> "),a+=" ",d&&d.footer&&(a+=" "+o(t(e.messageTextTpl({text:d.footer,needLimiter:e.needFooterLimiter,needCollapse:!1,needDateFloat:!1,className:"contacts-ServiceMessage__footer contacts-ThemeMessage-row-content"})))+" "),a+=" ",d&&d.links){a+=" ";var h=d.links;if(h)for(var _,u=-1,b=h.length-1;u<b;)_=h[u+=1],a+=" ",(!g&&e.isIncome&&m||_.showForAll)&&(a+=' <component data-component="SBIS3.CONTROLS.Link" name="'+o(t(_.name))+'" style="display: inline-block; ',_.color&&(a+=" color: "+o(t(_.color))+";"),a+=";",d.serviceMessageFontSize&&(a+=" font-size: "+o(t(d.serviceMessageFontSize))+"px;"),a+='"> <option name="caption">'+o(t(_.caption))+'</option> <option name="className">'+o(t("contacts-serviceMessage__"+e.type))+"</option> ",_.icon&&(a+='<option name="icon">'+o(t(_.icon))+"</option>"),a+=" <options name='handlers'> <option name='onActivated' type='function'>js!SBIS3.Contacts.ServiceMessage:prototype._onLinkActivate</option> </options> </component> "),a+=" ";a+=" "}a+=" </div> "}return a+=" </div>",(a=o(a))+(s&&-1!==a.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.ServiceMessage/ServiceMessage"}},e});
//# sourceMappingURL=ServiceMessage.xhtml.map
define("js!SBIS3.Contacts.ServiceMessage",["Core/core-extend","Core/IoC","Core/UserInfo","Core/detection","js!SBIS3.CONTROLS.CompoundControl","html!SBIS3.Contacts.ServiceMessage/ServiceMessage","tmpl!SBIS3.Contacts.ServiceMessage/templates/SignedMessage","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageTextBlock","js!SBIS3.Contacts.CommonFunctions.Global","js!WS.Data/Collection/RecordSet","js!WS.Data/Adapter/Sbis","js!SBIS3.Contacts.SignFilesAbstract","js!WS.Data/Entity/Record","js!SBIS3.DOCVIEW.List","css!SBIS3.Contacts.ServiceMessage/ServiceMessage","i18n!SBIS3.Contacts.ServiceMessage","js!SBIS3.CONTROLS.Button","js!SBIS3.CONTROLS.Link","js!SBIS3.Contacts.ServiceMessageBase"],function(e,t,i,n,s,o,a,r,c,l,g,u,d){var f=s.extend({_dotTplFn:o,$protected:{_options:{signedTpl:a,messageTextTpl:r,count:0,type:"",serviceDataJSON:null,showSignElements:true,need_answer_sign:false,files:function(){return null},filesByGroup:null,signs:[],afterCreateDocumentViewer:function(){},keyId:null,msgKey:"",themeGUID:"",persons:"",isTheme:false,showBorder:false,aggregateSigns:[],needFooterLimiter:false,myPerson:"",_superType:function(){var e="";switch(this.type){case"for_sign":case"not_sign":case"sign":case"for_first_sign":case"for_second_sign":e="sign";break;case"employee_invitation":case"new_invitation":case"declined_invitaion":case"accepted_employee_invitation":case"accepted_invitation":case"declined_invitee_invitation":case"accepted_new_invitation":e="invite"}return e},department:function(){var e=JSON.parse(this.serviceDataJSON);return e&&e.orgName?e.orgName:""},serviceObject:function(){return JSON.parse(this.serviceDataJSON)},messageText:function(){return c.getServiceMessage(this.type,this.department(),JSON.parse(this.serviceDataJSON))},_callHandler:function(e,t,i,n,s){var o=e.split(":"),a=null,r=this;if(o.length>1){var c=o[0],l=o[1];if(t)a=i.getParent().getDataSet().getRecordById(t);if(c&&l)require([c],function(e){e[l].bind(r)(n,s,a)})}},_buttonObject:{}},_fileRecordSet:null,_isBilling:c.isBilling()},_modifyOptions:function(e){return e.myPerson=i.get("ИдентификаторСервисаПрофилей"),e.isMobile=n.isMobilePlatform,e._buttonObject={buttons:[{showForAll:true,name:"SignCancelButton",className:"cancelButton",caption:rk("Отклонить"),handler:"js!SBIS3.Contacts.ServiceMessage:prototype._handlerActivatedButtonCancel"},{showForAll:true,name:"SignAcceptButton",className:"signButton",caption:rk("Подписать"),active:true,handler:"js!SBIS3.Contacts.ServiceMessage:prototype._handlerActivatedButtonSign"}]},e},init:function(){f.superclass.init.call(this),this.subscribeTo(this,"onAfterShow",this._handlerOnAfterShow),this.subscribeTo(this,"onClick",function(e,t){if(c.checkElementByClass(t.target,["dv-preview_center"]))t.stopPropagation()});var e=this._options.filesByGroup;if(e)for(var t in e){if(!e.hasOwnProperty(t))continue;var i=["FilePreview",t].join("_"),n=["SignsAggregate",t].join("_");if(this.hasChildControlByName(i))this.subscribeTo(this.getChildControlByName(i),"onAfterShow",this._readyDocumentViewer);if(this.hasChildControlByName(n))this.subscribeTo(this.getChildControlByName(n),"onActivated",this._signsAggregateClickHandler)}},setEnabled:function(e){var t=this,i=t._options.serviceObject();if(i&&i.links&&i.links.length)f.superclass.setEnabled.call(t,true);else f.superclass.setEnabled.call(t,e)},_handlerOnAfterShow:function(){var e=this,t=e._options.serviceObject();if(t&&t.links&&t.links.length&&!e.isEnabled())e.setEnabled(true);if(t&&t.handlers&&t.handlers.onShow)e._options._callHandler(t.handlers.onShow,e._options.keyId,e,arguments[0],t);if(this._options.filesByGroup)$(".aggregate-signs .icon-Signature",this.getContainer()).bind("click",this._signatureClickHandler.bind(this))},_serviceObjectActivate:function(e){var t=this,i=t.getParent(),n=i._options.serviceObject(),s;if(n[e]){s=false;for(var o=0;o<n[e].length;o++)if(n[e][o].name==t._options.name){s=n[e][o];break}if(s&&s.handler)i._options._callHandler.bind(i)(s.handler,i._options.keyId,i,arguments[0],n)}},_onButtonActivate:function(){this.getParent()._serviceObjectActivate.bind(this)("buttons")},_onLinkActivate:function(){this.getParent()._serviceObjectActivate.bind(this)("links")},_onOption0Activate:function(e,t,i){var n=i.get("Сообщение"),s=this.getChildControlByName("ServiceMessage_"+n);if(s)s._onOptionActivate.bind(this)(e,t,i,0)},_onOption1Activate:function(e,t,i){var n=i.get("Сообщение"),s=this.getChildControlByName("ServiceMessage_"+n);if(s)s._onOptionActivate.bind(this)(e,t,i,1)},_onOption2Activate:function(e,t,i){var n=i.get("Сообщение"),s=this.getChildControlByName("ServiceMessage_"+n);if(s)s._onOptionActivate.bind(this)(e,t,i,2)},_onOptionActivate:function(e,t,i,n){var s=this,o=JSON.parse(i.get("СлужебныйОбъект")[0]);if(o["options"]&&o["options"].length>=n+1){var a=o["options"][n].handler.split(":");if(a.length>1){var r=a[0],c=a[1];if(r&&c)require([r],function(n){n[c].bind(s)(e,t,i,o)})}}},setEnabledButtons:function(e){var t=this,i=t._getCancelButton(),n=t._getSignButton();if(i)i.setEnabled(e);if(n)n.setEnabled(e)},_afterCreateDocumentViewer:function(){},_getCancelButton:function(){return this.hasChildControlByName("NotSubscribeInDialog")&&this.getChildControlByName("NotSubscribeInDialog")},_getFiles:function(){var e=this._options.files.getRawData();return new l({rawData:e,idProperty:"attachId",adapter:new g})},_getMsgKey:function(){return this._options.msgKey},_getSignButton:function(){return this.hasChildControlByName("SubscribeInDialog")&&this.getChildControlByName("SubscribeInDialog")},_getThemeGUID:function(){return this._options.themeGUID},_getMessageRecord:function(){var e=this.getParent(),t=e?e.getItems():null;return t&&this._options.keyId&&"function"==typeof t.getRecordById?t.getRecordById(this._options.keyId):null},_handlerActivatedButtonCancel:function(e){var t=this,i=t.getParent(),n={persons:[i._options.persons],themeGUID:i._getThemeGUID(),messageGUID:i._getMsgKey(),files:[],opener:t,serviceType:"not_sign"},s;i.setEnabledButtons(false),(s=i._cancelSignFiles(n)).addCallbacks(function(e){if(e){var t=i._getMessageRecord();if(t)t.set("ЕстьОтказОтПодписи",[true,null]);i._hideButtons()}else i.setEnabledButtons(true)},function(){i.setEnabledButtons(true)})},_handlerActivatedButtonSign:function(e){var i=this,n=i.getParent(),s=[],o=n._getFiles(),a={persons:[n._options.persons],themeGUID:n._getThemeGUID(),messageGUID:n._getMsgKey(),files_for_sign:[],opener:i,serviceType:"for_first_sign"==n._options.type?"for_second_sign":"sign"},r;o.each(function(e){s.push({"Файл":e.get("msgFileId"),"ДискИдВерсии":e.get("redactionId")})}),t.resolve("ILogger").log("Файлы для подписи ",JSON.stringify(s)),a["files_for_sign"]=s,n.setEnabledButtons(false),(r=n._signFiles(a)).addCallbacks(function(e){if(e){var t=n._getMessageRecord();if(t)t.set("ЕстьОтветНаЗапросПодписи",[true,null]);n._hideButtons()}else n.setEnabledButtons(true)},function(){n.setEnabledButtons(true)})},_hideButtons:function(){var e=this,t=e._getCancelButton(),i=e._getSignButton();if(t)t.setVisible(false);if(i)i.setVisible(false)},_readyDocumentViewer:function(){var e=this,t=e.getParent(),i=t._getThemeGUID(),n=t._getMsgKey();if(!n)return;if(e.setCommandCfg)e.setCommandCfg("rename",{inList:false});if(!c.isBilling()&&t._options.isTheme)if(e.setUserCommands)c.getSignOptionsForDocView().addCallback(function(t){if(!e.isDestroyed())e.setUserCommands(t.commands),e.subscribeTo(e,"onFinishCommand",t.handler)});c._prepareDocViewerToEditInMessage(e,i,n)},_signatureClickHandler:function(e){var t=e.target.getAttribute("data-groupid");if(t)e.stopPropagation(),this._openSignatureCertificates(t)},_signsAggregateClickHandler:function(){var e=this,t=e.getParentByClass(f),i=e._options.signsGroupId;t._openSignatureCertificates(i)},_openSignatureCertificates:function(e){var t=this._options.filesByGroup;if(!t)return;var i=t[e].redactionId;if(i){var n=new d({rawData:{redactionId:i}});require(["js!SBIS3.DOCVIEW.Funcs"],function(e){e.showCertificates({filter:n,opener:this,objectName:"FileSD",serviceUrl:"/disk/api/v1/"})}.bind(this))}}});return e.mixin(f,u)});
//# sourceMappingURL=ServiceMessage.module.js.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/ServiceMessageBlock",["Core/tmpl/js/tclosure","js!SBIS3.Contacts.ServiceMessage"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.Contacts.ServiceMessage"]=e[1];var i=function e(i,g,a,l,n){function s(){}var m=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var o={};n&&n.isSetts&&(o=n.fullContext||{});var d="string"==typeof a?a:"",c=void 0===r?void 0:r,y={id:[],def:void 0},u=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),v=this&&this.includedTemplates?this.includedTemplates:{},S=p.getMarkupGenerator(l);try{var x=S.joinElements([S.createControl("wsControl","ws:SBIS3.Contacts.ServiceMessage",{name:"ServiceMessage_"+p.getter(i,["id"]),hotFixForOpenParent:!0,activableByClick:!1,type:p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["СлужебныйТип"]),[p.getter(i,["index"])]),isIncome:p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["Входящее"]),[p.getter(i,["index"])]),serviceDataJSON:p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["СлужебныйОбъект"]),[p.getter(i,["index"])]),need_answer_sign:!p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["ЕстьОтветНаЗапросПодписи"]),[p.getter(i,["index"])])&&!p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["ЕстьОтказОтПодписи"]),[p.getter(i,["index"])])&&p.getter(i,["item","isTheme"]).apply(p.getter(i,["item"]),[])&&!p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["Я"]),[p.getter(i,["index"])])&&p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["Входящее"]),[p.getter(i,["index"])]),showBorder:p.getter(i,["item","isTheme"]).apply(p.getter(i,["item"]),[])&&"sign"!==!p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["СлужебныйТип"]),[p.getter(i,["index"])]),showSignElements:!(null!=p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["СкрытьКнопкиПодписания"])&&p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["СкрытьКнопкиПодписания"]),[p.getter(i,["index"])])),text:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["Текст"])?p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["Текст"]),[p.getter(i,["index"])]):"",keyId:p.getter(i,["item","getId"]).apply(p.getter(i,["item"]),[]),files:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["FileForPreview",p.getter(i,["index"])]),filesByGroup:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["FileGroupForSign",p.getter(i,["index"])]),msgKey:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["MessageGUID",p.getter(i,["index"])]),themeGUID:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["Тема"]),persons:p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["КонтактПерсона"]),[p.getter(i,["index"])])?p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["КонтактПерсона"]),[p.getter(i,["index"])]):"",count:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["FileForPreview",p.getter(i,["index"])])?p.getter(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["FileForPreview",p.getter(i,["index"])]),["getCount"]).apply(p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["FileForPreview",p.getter(i,["index"])]),[]):"",isTheme:p.getter(i,["item","isTheme"]).apply(p.getter(i,["item"]),[]),needFooterLimiter:p.getter(i,["item","get"]).apply(p.getter(i,["item"]),["TextHeightLimit"])},p.plainMerge(g,{class:p.utils.escape(p.getter(i,["className"])),name:"ServiceMessage_"+p.getter(i,["id"]),sbisname:"ServiceMessage_"+p.getter(i,["id"])}),{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:u},a,c,v,p.config,o)],d,y);y.def&&(x=S.chain(x,y,g),y=void 0)}catch(e){p.templateError("resources/Contacts.Mini/Models/templates/ServiceMessageBlock.tmpl",e,i)}return x||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/ServiceMessageBlock"}},i});
//# sourceMappingURL=ServiceMessageBlock.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/FolderItem",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],a={},r=function e(r,s,o,n,i){function l(){}var d=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var p={};i&&i.isSetts&&(p=i.fullContext||{});var u="string"==typeof o?o:"",g=void 0===a?void 0:a,f={id:[],def:void 0},m=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),v=this&&this.includedTemplates?this.includedTemplates:{},h=c.getMarkupGenerator(n);try{var T=h.joinElements([h.createTag("div",{class:"contacts-ThemeMessage__folder","data-folderguid":""+c.wrapUndef(c.utils.escape(c.getter(r,["folderGUID"]))),"data-folderid":""+c.wrapUndef(c.utils.escape(c.getter(r,["rootID"])))},[h.createTag("div",{class:"contacts-ThemeMessage__folderName"},[h.createText(""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["folderName"])])])))],{},f,this),h.createTag("div",{class:"contacts-ThemeMessage__folderCounts"},[h.createTag("div",{class:"name-gradient"},[],{},f,this),c.getter(r,["unreadCount"])?[h.createTag("span",{class:"contacts-ThemeMessage__folderCount contacts-ThemeMessage__folder_unread               "+c.wrapUndef(c.utils.escape(c.getter(r,["count"])?"need-separator":""))},[h.createText(" "+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["unreadCount"])])]))+" ")],{},f,this)]:h.createText(""),c.getter(r,["count"])?[h.createTag("span",{class:"contacts-ThemeMessage__folderCount"},[h.createText(""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(r,["count"])])])))],{},f,this)]:h.createText("")],{},f,this)],s,f,this)],u,f);f.def&&(T=h.chain(T,f,s),f=void 0)}catch(e){c.templateError("resources/Contacts.Mini/Models/templates/FolderItem.tmpl",e,r)}return T||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/FolderItem"}},r});
//# sourceMappingURL=FolderItem.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/FileAttachBlock",["Core/tmpl/js/tclosure","js!SBIS3.DOCVIEW.List"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={};i["js!SBIS3.DOCVIEW.List"]=e[1];var r=function e(r,g,s,a,m){function l(){}var n=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var o={};m&&m.isSetts&&(o=m.fullContext||{});var c="string"==typeof s?s:"",d=void 0===i?void 0:i,y={id:[],def:void 0},u=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),_=this&&this.includedTemplates?this.includedTemplates:{},D=p.getMarkupGenerator(a);try{var v=D.joinElements([D.createTag("div",{class:"contacts-ThemeMessage-row-content message-attachment attach-file"},[p.getter(r,["dateFloat"])?[D.createTag("span",{class:"date-float"},[],{},y,this)]:D.createText(""),D.createTag("div",{class:"file-thumbnail-container"},[D.createControl("wsControl","ws:SBIS3.DOCVIEW.List",{mainOptions:{userParams:{themeGUID:p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["Тема"]),msg:p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["MessageGUID",p.getter(r,["index"])]),isFromMeToMe:p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["IsFromMeToMe",p.getter(r,["index"])])},commands:{upload:!0,edit:!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),editInApp:!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),imageEdit:!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),print:!p.getter(r,["item","_isMobile"]),rename:!0,sendMessage:!1,addPage:!1,deleteDoc:!1,deletePage:!1,deletePermanentlyDoc:!1,rights:!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),redactions:!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),restore:!1,move:!1,fullScreen:!1,saveToPdf:!1,copyToBuffer:!0,signDocument:p.getter(r,["item","isPairs"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isDialogs"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isContactMsg"]).apply(p.getter(r,["item"]),[]),encrypt:!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[])},serviceBLName:"СБИСДиск.Приватный",ctxLinkList:"ФайлыDocViewModel",useOnlyCtx:!0,objectName:"FileSD",serviceUrl:"/disk/api/v1/"},listOptions:{visibilityMode:{defaultMode:"bigPreview",folderAsPreview:!0},goToFolder:!1,activableByClick:!0,previewWidth:68,previewHeight:68,multiselect:!1,hasHierarchy:!1,hideBreadCrumbs:!0,itemsDragNDrop:!1,calcMargin:!1,serializedItems:p.getter(p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["FileForPreview",p.getter(r,["index"])]),["getRawData"]).apply(p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["FileForPreview",p.getter(r,["index"])]),[]),itemsSortMethod:null,maxTileRows:p.getter(r,["item","isPairs"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isDialogs"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isContactMsg"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isInvite"]).apply(p.getter(r,["item"]),[])?1:void 0},handlers:{onReady:p.getter(r,["item","_readyDocumentViewer"])},name:p.getter(["FilePreview",p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["MessageGUID",p.getter(r,["index"])]),p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["КоличествоНепрочитанных"])],["join"]).apply(["FilePreview",p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["MessageGUID",p.getter(r,["index"])]),p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["КоличествоНепрочитанных"])],["_"]),hotFixForOpenParent:!0,contactsRecordKey:p.getter(r,["item","getId"]).apply(p.getter(r,["item"]),[]),contactsRecordField:p.getter(r,["field"]),redrawOnEdit:!1,esc:!1},{name:p.getter(["FilePreview",p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["MessageGUID",p.getter(r,["index"])]),p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["КоличествоНепрочитанных"])],["join"]).apply(["FilePreview",p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["MessageGUID",p.getter(r,["index"])]),p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["КоличествоНепрочитанных"])],["_"]),sbisname:p.getter(["FilePreview",p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["MessageGUID",p.getter(r,["index"])]),p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["КоличествоНепрочитанных"])],["join"]).apply(["FilePreview",p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["MessageGUID",p.getter(r,["index"])]),p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["КоличествоНепрочитанных"])],["_"])},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:u,internal:{__dirtyCheckingVars_0:p.getter(r,["item"])&&p.getter(r,["item","get"])&&p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["Тема"]),__dirtyCheckingVars_1:p.getter(r,["index"])&&p.getter(r,["item","get"])&&p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["MessageGUID",p.getter(r,["index"])]),__dirtyCheckingVars_2:p.getter(r,["index"])&&p.getter(r,["item","get"])&&p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["IsFromMeToMe",p.getter(r,["index"])]),__dirtyCheckingVars_4:p.getter(r,["item"])&&p.getter(r,["item","isDiscussion"])&&!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),__dirtyCheckingVars_5:p.getter(r,["item"])&&p.getter(r,["item","isDiscussion"])&&!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),__dirtyCheckingVars_6:p.getter(r,["item"])&&p.getter(r,["item","isDiscussion"])&&!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),__dirtyCheckingVars_7:!p.getter(r,["item","_isMobile"]),__dirtyCheckingVars_14:p.getter(r,["item"])&&p.getter(r,["item","isDiscussion"])&&!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),__dirtyCheckingVars_15:p.getter(r,["item"])&&p.getter(r,["item","isDiscussion"])&&!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),__dirtyCheckingVars_21:p.getter(r,["item"])&&p.getter(r,["item","isContactMsg"])&&p.getter(r,["item","isDialogs"])&&p.getter(r,["item","isPairs"])&&(p.getter(r,["item","isPairs"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isDialogs"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isContactMsg"]).apply(p.getter(r,["item"]),[])),__dirtyCheckingVars_22:p.getter(r,["item"])&&p.getter(r,["item","isDiscussion"])&&!p.getter(r,["item","isDiscussion"]).apply(p.getter(r,["item"]),[]),__dirtyCheckingVars_34:p.getter(r,["index"])&&p.getter(r,["item","get"])&&p.getter(r,["index"])&&p.getter(r,["item","get"])&&p.getter(p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["FileForPreview",p.getter(r,["index"])]),["getRawData"]).apply(p.getter(r,["item","get"]).apply(p.getter(r,["item"]),["FileForPreview",p.getter(r,["index"])]),[]),__dirtyCheckingVars_36:p.getter(r,["item"])&&p.getter(r,["item","isInvite"])&&p.getter(r,["item","isContactMsg"])&&p.getter(r,["item","isDialogs"])&&p.getter(r,["item","isPairs"])&&(p.getter(r,["item","isPairs"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isDialogs"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isContactMsg"]).apply(p.getter(r,["item"]),[])||p.getter(r,["item","isInvite"]).apply(p.getter(r,["item"]),[])?1:void 0),__dirtyCheckingVars_37:p.getter(r,["item","_readyDocumentViewer"])}},s,d,_,p.config,o)],{},y,this)],g,y,this)],c,y);y.def&&(v=D.chain(v,y,g),y=void 0)}catch(e){p.templateError("resources/Contacts.Mini/Models/templates/FileAttachBlock.tmpl",e,r)}return v||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/FileAttachBlock"}},r});
//# sourceMappingURL=FileAttachBlock.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/DocumentBlock",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],a={},n=function e(n,c,s,r,i){function o(){}var d=0,l=void 0!==t&&t?t:arguments[arguments.length-1];void 0===l&&(eval("var thelpers = null;"),l=global.requirejs("View/Runner/tclosure"));var u={};i&&i.isSetts&&(u=i.fullContext||{});var m="string"==typeof s?s:"",p=void 0===a?void 0:a,g={id:[],def:void 0},f=l.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),v=this&&this.includedTemplates?this.includedTemplates:{},h=l.getMarkupGenerator(r);try{var w=h.joinElements([h.createTag("div",{class:"message-attachment attach-document "+l.wrapUndef(l.utils.escape(l.getter(n,["className"])))+"            ws-flexbox ws-align-content-stretch ws-flex-nowrap ws-justify-content-start","data-documentguid":""+l.wrapUndef(l.utils.escape(l.getter(n,["documentGUID"])))},[h.createTag("div",{class:"icon-16 "+l.wrapUndef(l.utils.escape(l.getter(n,["documentIcon"])||"icon-Document"))+" icon-disabled document-icon"},[],{},g,this),l.getter(n,["documentName"])?[h.createTag("div",{class:"document-name",title:""+l.wrapUndef(l.utils.escape(l.getter(n,["documentName"])))},[h.createText(""+l.wrapUndef(l.Sanitize.apply(void 0,[l.getDecorators().sanitize.apply(void 0,[l.getter(n,["documentName"])])])))],{},g,this)]:h.createText(""),h.createTag("div",{class:"document-phase ws-hidden","data-bind":"visible: 'DocumentManager/"+l.wrapUndef(l.utils.escape(l.getter(n,["documentId"])))+"/visible'"},[h.createText(" "+global.rk("(")+" "),h.createTag("i",{"data-bind":"attr: {class: 'DocumentManager/"+l.wrapUndef(l.utils.escape(l.getter(n,["documentId"])))+"/icon'}"},[],{},g,this),h.createTag("span",{"data-bind":"html: 'DocumentManager/"+l.wrapUndef(l.utils.escape(l.getter(n,["documentId"])))+"/phase'"},[],{},g,this),h.createText(" "+global.rk(")")+" ")],{},g,this)],c,g,this)],m,g);g.def&&(w=h.chain(w,g,c),g=void 0)}catch(e){l.templateError("resources/Contacts.Mini/Models/templates/DocumentBlock.tmpl",e,n)}return w||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/DocumentBlock"}},n});
//# sourceMappingURL=DocumentBlock.tmpl.map
define("js!SBIS3.Contacts.CachingPersons",["Core/core-instance","Core/Deferred","Core/Context","Core/IoC","js!WS.Data/Source/SbisService","js!WS.Data/Entity/Record"],function(e,n,o,t,r,a){var s=36e5,c=["Персона","Клиент","Лицо","Фамилия","Имя","Отчество","КлиентНазвание","Отдел","Должность","КлиентИНН","КлиентИдентификаторСПП","ФотоМини","ОргПодтверждена","Раздел"];return{_personsCache:{persons:{},anonymous:{}},_checkPersonRecord:function(n){if(e.instanceOfModule(n,"WS.Data/Entity/Model")){for(var o=0;o<c.length;o++)if(!n.has(c[o]))return false;return true}else return false},_updateCacheRecord:function(e,n,o){var t=e.get("Персона"),r=this._personsCache["anonymous"][t];if(r)e.set({"Имя":r["name"],"КлиентНазвание":r["clientName"]});o[t]={record:e,updateDate:n}},_addPersonsToCacheFromRS:function(e){if(e.getCount()){var n=true,o=e.getFormat(),t;for(t=0;t<c.length;t++)if(-1===o.getFieldIndex(c[t])){n=false;break}if(n){var r=new Date,a=this,s=a._personsCache["persons"];e.each(function(e){a._updateCacheRecord(e,r,s)})}}},addPersonsToCache:function(n){if(e.instanceOfModule(n,"WS.Data/Collection/RecordSet"))this._addPersonsToCacheFromRS(n);else if(n.length){var o=new Date,t=this,r=t._personsCache["persons"],a,s;for(a=0;a<n.length;a++)if(s=n[a],t._checkPersonRecord(s))t._updateCacheRecord(s,o,r)}},getPersonsFromCache:function(e){var o=this,t=new Date,c=[],i,u,f,h=function(){for(c=[],i=[],u=0;u<e.length;u++)if(f=o._personsCache["persons"][e[u]],f&&t-f.updateDate<s)c.push(f.record);else i.push(e[u]);return i};if(i=h(),i.length){var l=new r({endpoint:"Персона"}),d=new n;return l.call("ПодробнаяИнформация",{"Персоны":i,"ДляДокумента":null,"ПроверитьЧерныйСписок":false}).addCallbacks(function(e){var n=e.getAll(),t=o._personsCache.anonymous;if(n.getCount()<i.length){var r=new a({format:n.getFormat(),adapter:"adapter.sbis"});if(!Object.isEmpty(t))for(var s in t)if(t.hasOwnProperty(s)&&i.indexOf(s)>=0)r.set("Персона",s),n.add(r);if(n.getCount()<i.length){var u=[];i.forEach(function(e){if(-1===n.getIndexByValue("Персона",e))u.push(e)}),u.forEach(function(e){var o=r.clone();o.set("Персона",e),n.add(o)})}}o.addPersonsToCache(n),h(),d.callback(c)},function(e){d.errback(e)}),d}else return n.success(c)},loadAnonymousUserData:function(e){if(e===o.global.getValue("mypersonid"))return;var n=this;return new r({endpoint:"ServiceContractConsultation"}).call("GetAnonymousInfo",{uuid:e}).addCallbacks(function(o){var t=o.getRow();n._personsCache["anonymous"][e]={name:t.get("name"),clientName:t.get("client_name")}},function(e){t.resolve("ILogger").error(e)})},getAnonymousData:function(){return this._personsCache["anonymous"]},isAnonymousUser:function(e){return!!this._personsCache.anonymous[e]},getPersonDataByCache:function(e){return this._personsCache.persons[e]},removePersonDataByCache:function(e){if(this._personsCache.persons.hasOwnProperty(e))delete this._personsCache.persons[e]}}});
//# sourceMappingURL=CachingPersons.module.js.map
define("js!Tags/Helper",["Core/helpers/Hcontrol/showFloatArea"],function(e){"use strict";return{showCreateDialog:function(t){var o={side:"right",direction:"bottom",template:"js!Tags/Dialog",parent:t&&t.parent||this,opener:t&&t.opener||this,autoHide:true,autoHeight:true,isStack:false,autoCloseOnHide:true,showOnControlsReady:true,componentOptions:t&&t.componentOptions||{},handlers:t&&t.handlers||{},target:t&&t.target,animation:t&&t.animation||"off"};e(o)}}});
//# sourceMappingURL=Helper.js.map
define("js!SBIS3.Contacts.ActionSets.Tags",["Core/Deferred","js!WS.Data/Source/SbisService","js!Tags/Helper","js!SBIS3.Contacts.CommonFunctions.Global"],function(e,t,n,i){var o=function(e,t,n){var i=this.getLinkedContext().getValue("TagManager/"+n.get("Тема")+"/items"),o=[],a=e.find(".contacts-MessageItem__tagAreaTarget").last();if(i)i.each(function(e){o.push({Tag:e.getId()})});s.openTagDialog.call(this,a.length?a:e,n.get("Тема"),o)},a=function(){},s={eventName:{LIST_CHANGE:"Contacts.taglistchange",LIST_TAG_UPDATE:"Contacts.tagupdate",LIST_THEME_CHANGE:"Contacts.tagthemeupdate"},getItemAction:function(e,t,n){return{name:"tagMessage",isMainAction:e,caption:rk("Теги"),tooltip:rk("Добавить теги"),cssClass:"string"===typeof n?n:"",icon:"sprite:icon-24 icon-Tag icon-primary action-hover",onActivated:void 0===t?o:o.bind(t)}},getMassOperation:function(e){return{name:"markTagOperation",componentType:"js!SBIS3.CONTROLS.Link",options:{tooltip:rk("Добавить теги"),caption:rk("Теги"),icon:"sprite:icon-24 icon-Tag icon-primary action-hover",handlers:{onActivated:void 0===e?a:a.bind(e)}},type:{selection:true}}},checkItemAction:function(){return true},checkMassOperation:function(){return true},openTagDialog:function(t,i,o){var a=new e;return n.showCreateDialog({target:t,opener:this,componentOptions:{showColor:true,existingTags:o,tagType:3},handlers:{onBeforeShow:function(){var e=this.getChildControlByName("TagList");this.subscribeTo(this.getChildControlByName("TagEditor"),"onCreateTag",function(){s.notifyEvent(s.eventName.LIST_TAG_UPDATE,{tagListId:e.getId()})}),this.subscribeTo(e,"onItemsReady",function(){var e=this.getItems();this.subscribeTo(e,"onCollectionChange",function(e,t){if("rs"===t)s.notifyEvent(s.eventName.LIST_CHANGE,{})}.bind(this))}),this.subscribeTo(e,"onEndEdit",function(e,t,n){if(n)s.notifyEvent(s.eventName.LIST_TAG_UPDATE,{tagListId:this.getId()})}),this.subscribeTo(e,"onRemoveTag",function(){s.notifyEvent(s.eventName.LIST_TAG_UPDATE,{tagListId:this.getId()})})},onBeforeClose:function(e,t){if(t){var n=[],o=!(i instanceof Array);t.each(function(e){n.push(e.getId())});var c=s[o?"executeLink":"executeMassLink"].call(this,i,n);if(c)return void c.addCallback(function(){a.callback()})}a.callback()}.bind(this)}}),a},executeMassLink:function(e,n){if(e&&n)return new t({endpoint:"Tag"}).call("LinkObjectMass",{Tags:n,Objects:e,Type:3}).addCallbacks(function(){s.notifyEvent(s.eventName.LIST_CHANGE,{theme:e})},function(e){i.errorMessageService(e)});return null},executeLink:function(e,n){if(e&&n)return new t({endpoint:"Tag"}).call("RelinkObject",{Tags:n,Object:e,Type:3}).addCallbacks(function(){s.notifyEvent(s.eventName.LIST_CHANGE,{theme:[e]})},function(e){i.errorMessageService(e)});return null},executeUnlink:function(e,n){if(e&&n&&n.length)return new t({endpoint:"Tag"}).call("UnlinkTags",{Tags:n,Objects:[e],Type:3}).addCallbacks(function(){s.notifyEvent(s.eventName.LIST_CHANGE,{theme:[e]})},function(e){i.errorMessageService(e)});return null},notifyEvent:function(e,n){new t({endpoint:"Уведомления"}).call("УведомитьТекущегоПользователя",{"Канал":e,"Объект":n})}};return s});
//# sourceMappingURL=Tags.module.js.map
define("html!SBIS3.Contacts.Models.ThemeMessageModel/templates/SeparatorTemplate",function(){var e=function(e){var r=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(r){for(;e.test(r);)r=r.replace(e,"&#123;&#123;$1&#125;&#125;");return r}}(),t=function(e){return e.join?e.join(""):e.toString()},o=function(e){return void 0===e?"":e&&"object"==typeof e?t(e):""+e},a="undefined"!=typeof process,n=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,""),s=e.item.get("GroupId"),l=e.item.get("IsHiddenRow");return n+=" ",null!=s&&(n+=' <div class="contacts-ChatHistory-separator controls-GroupBy__separator controls-GroupBy__separator__left',l&&(n+=" collapsed"),n+='" data-separator="'+r(o(s))+'"> <span class="controls-GroupBy__separatorText separator-title controls-GroupBy__separatorCollapse ',l&&(n+=" controls-GroupBy__separatorCollapse__collapsed"),n+='">'+r(o(e.item.get("SeparatorName")))+"</span> </div> "),(n=r(n))+(a&&-1!==n.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.Models.ThemeMessageModel/templates/SeparatorTemplate"}},e});
//# sourceMappingURL=SeparatorTemplate.xhtml.map
define("js!SBIS3.Contacts.Models.ExtendedMessageMixin",["Core/helpers/string-helpers","Core/Context","Core/UserInfo","Transport/prepareGetRPCInvocationURL","js!SBIS3.Contacts.CommonFunctions.Global","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/FileAttachBlock","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/DocumentBlock","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/ServiceMessageBlock","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/FolderItem","html!SBIS3.Contacts.Models.ThemeMessageModel/templates/SeparatorTemplate","js!SBIS3.Activity.ActivityHelper","js!SBIS3.Contacts.CachingPersons","js!SBIS3.Contacts.CachingActivity","js!SBIS3.Contacts.ActionSets.Tags","css!SBIS3.Contacts.Models.MiniBaseModel/styles/FolderItem","js!SBIS3.DOCVIEW.List","js!SBIS3.Contacts.ServiceMessage","i18n!SBIS3.Contacts.Models.ExtendedMessageMixin"],function(e,t,s,i,n,o,a,r,g,c,l,d,h,u){return{$protected:{_fileAttachTpl:o,_documentAttachTpl:a,_serviceMessageTpl:r,_folderTpl:g,_activityMarker:l.activityMarker,_groupSeparatorTpl:c,_isBilling:n.isBilling(),_options:{properties:{ActivityData:{get:function(){var e=this.get(this._options.fieldName.personGUID);return e?this._activityMarker(h.getRenderData(e[0]),{className:"contacts-PersonPhoto-activity",useBorder:true}):void 0}},ChatName:{get:function(){var e;switch(this.get("ДокументИдТипа")){case 10:e=rk("Обсуждение");break;case 11:e=rk("Вопрос-Ответ");break;case 20:e=rk("Предложение");break;default:e=""}return e?[e,this.get("УчастникиТемы")].join(": "):this.get("УчастникиТемы")}},DocumentName:{get:function(){return this.get("ДокументНазвание")&&"Произошла ошибка при вызове метода Документ.НазваниеПоДокументам"!==this.get("ДокументНазвание")?this.get("ДокументНазвание"):rk("Документ недоступен")}},EmploymentId:{get:function(){var e=this.get(this._options.fieldName.employmentId);return!this.get("IsDepartment")&&e&&e[0]}},IsServiceMessageFirst:{get:function(){var e=this.get("ServiceType");return this.isTheme()&&"invite_send"===e}},FileGroupForSign:{get:function(){return this.get("ФайлыПодписаниеПоГруппам")}},GroupPhotoLink:{get:function(){var e=this.get("ДокументРодитель");return e?i("СервисПрофилей","Фото",{"Персона":e,"Тип":"default"},t.global,"/previewer/r/40/40/service/"):""}},UnreadCountString:{get:function(){if(!this.get("Я"))return;var t="",s=this.get("ПрочитаноВладельцем")[0],i=this.get("Я")[0],o=s||i&&!this.get("Входящее")[0]?this.get("КоличествоНепрочитанных"):this.get("КоличествоНепрочитанных")-1;if(o&&o>0&&(o>1||1==o&&(!s||i)))if(o>99)t=rk("Еще 99+ непрочитанных сообщений","unread_count");else t=e.format({count:o},n.plural(o,rk("Еще $count$s$ непрочитанное сообщение","unread_count"),rk("Еще $count$s$ непрочитанных сообщения","unread_count"),rk("Еще $count$s$ непрочитанных сообщений","unread_count")));return t}},ContactCardAttributes:{get:function(){var e=this.get("КонтактПерсона");return e&&!d.isAnonymousUser(e[0])?{oid:e[0],template:"js!SBIS3.PersonalOffice.MiniCard",mode:this._isMobile?"click":"hoverClick",trackTarget:false}:void 0}},MyPerson:{get:function(){return s.get("ИдентификаторСервисаПрофилей")}},NeedFastAnswer:{get:function(){return this.get("ДляИнтерфейса")&&"БыстрыйОтвет"===this.get("ДляИнтерфейса")}},NeedOpenedDialog:{get:function(){return this.get("ДляИнтерфейса")&&"ОткрытыйДиалог"===this.get("ДляИнтерфейса")}},NeedHideRow:{get:function(){return this.get("ДляИнтерфейса")&&"СкрытьЗапись"===this.get("ДляИнтерфейса")}}}}},getMessageText:function(e){var t=this.get("Текст");return t&&t[e]||""},_handlerShowModalVideoMessage:function(e,t){var s=$(t.target),i;s=s.parents(".fileRefsVideo"),i=s.attr("videoid"),require(["vm!VideoContainer"],function(e){e.playModal("/vmsg/get?id="+i)})},_readyDocumentViewer:function(){var e=this,t=e._options.contactsRecordKey,s=e.getParent(),i=s.getItems().getRecordById(t);if(!i)return;if(e.setCommandCfg)e.setCommandCfg("rename",{inList:false});var o=i.get("ТипСписка");if(!n.isBilling()&&"theme"===o&&"private"!==i.get("Тип"))if(e.setUserCommands)n.getSignOptionsForDocView().addCallback(function(t){if(!e.isDestroyed())e.setUserCommands(t.commands),e.subscribeTo(e,"onFinishCommand",t.handler)});if("dialogs"===o||"pairs"===o)n._prepareDocViewerToEditInMessage(e,i.get("Тема"),i.get("Сообщение"));this.subscribeTo(this.getTreeView(),"onClick",function(e,t){var s=$(t.target);if(!(s.hasClass("dv-bigpreview-item")||s.parents(".dv-bigpreview-item").length)){var i=s.parents(".controls-ListView__item"),n=i.wsControl();i.click(),n.activate(n)}}),this.subscribeTo(this.getTreeView(),"onChangeHoveredItem",function(){var e=this.getItemsActions();this.subscribeTo(e,"onShowMenu",function(){s.getContainer().addClass("attachment-menu-activated")}),this.subscribeTo(e,"onHideMenu",function(){s.getContainer().removeClass("attachment-menu-activated")})})},_tagItemActivate:function(e,t){var s=this.getLinkedContext();if(!s.getValue("Dialogs/tags/clickDisabled")&&t)s.setValue("DialogsFilters/tags",["string"===typeof t?t:t.id])},_tagItemRemove:function(e,t){var s=this.getItems(),i=s&&!s.getCount(),n=this.getLinkedContext(),o=this._options.themeUUID,a=["TagManager",o,"visible"].join("/");if(n&&i)n.setValue(a,false);u.executeUnlink(o,[t])},_tagInfoboxShow:function(){var e=this._$displayContainer.closest(".contacts-ThemeMessage-row");if(e&&1===e.length)e.toggleClass("contacts-ThemeMessage__tagTooltip-active",true)},_tagInfoboxHide:function(){var e=this._$displayContainer.closest(".contacts-ThemeMessage-row");if(e&&1===e.length)e.toggleClass("contacts-ThemeMessage__tagTooltip-active",false)},_onBeforeShowFastAnswer:function(){var e=this.getParent(),t=e.getItems(),s="pairs"===t.getListType(),i=t.getRecordById(this._options.item),n=e.getCurrentRoot?e.getCurrentRoot():null,o=i.get("Раздел");if(this._options.folderId=o?o:n,this._options.messageRecord=i,!s){var a=this.getContainer().parents(".controls-ListView__item"),r=t.getIndex(t.getRecordById(this._options.item/2));if(a.addClass("contacts-ThemeMessage-row__fast-answer"),e.getSelectedIndex()!==r)e.setSelectedIndex(r)}},_onAfterHideFastAnswer:function(e,t,s,i,n){if(this.saveText(i),!n)if("dialogs"===s.messageRecord.get("ТипСписка")){var o=this.getParent().getItems(),a=o.getIndex(s.messageRecord),r=this.getParent(),g=r.getUserData("БыстрыйОтветЗапись");if(o.removeAt(a),r.getContainer().find('[data-id = "'+g.id+'"]').removeClass("contacts-ThemeMessage-row__fast-answer-open"),g.t===s.themeGUID&&(g.m===s.messageGUID||a===g.id))r.setUserData("БыстрыйОтветЗапись",null);return}if("pairs"===s.messageRecord.get("ТипСписка"))s.messageRecord.set("ДляИнтерфейса")},_onResizeFastAnswer:function(){this.resizeOccured(this.getContainer().parents(".contacts-MessageView-fast-answer").height())},_onChangeSendPriorityFastAnswer:function(e,t){var s=this.getParentByClass(SBIS3.Contacts.WorkSpaceTabs);if(s.hasChildControlByName("buttonSendMessage"))s.getChildControlByName("buttonSendMessage").setEnabled(!t),s.getChildControlByName("buttonSendMessage").setDefaultButton(!t)},_onActivateDialogFastAnswer:function(){this.getParent().sendCommand("activateItem",this._options.messageRecord.getId()/2),this.hide(true)}}});
//# sourceMappingURL=Message.module.js.map
define("js!SBIS3.Contacts.Models.ExtendedBaseMixin",["js!SBIS3.Activity.ActivityHelper","js!SBIS3.Contacts.CachingPersons","js!SBIS3.Contacts.CachingActivity"],function(t,i,e){return{$protected:{_options:{employmentCardMode:"click",properties:{ActivityData:{get:function(){var t=this.get(this._options.fieldName.personGUID);return t?this._activityMarker(e.getRenderData(t),{className:"contacts-PersonPhoto-activity",useBorder:true}):void 0}},ContactCardAttributes:{get:function(){var t=this.get(this._options.fieldName.personGUID);return t&&!i.isAnonymousUser(t)?{oid:t,template:"js!SBIS3.PersonalOffice.MiniCard",mode:this._isMobile?"click":"hoverClick"}:void 0}},EmploymentCardAttributes:{get:function(){if(this._isPhysicFace||this._isBilling||this._isMobile)return;var t=this.get("IsDepartment"),i=this.get("EmploymentId");return i?{oid:t?i:"-"+i,template:t?"js!SBIS3.Staff.DepartmentMiniCard":"js!SBIS3.Contragents.ContragentMiniCard",mode:this._options.employmentCardMode}:void 0}}}},_activityMarker:t.activityMarker}}});
//# sourceMappingURL=Base.module.js.map
define("js!SBIS3.Contacts.Models.ThemeMessageModel",["Core/core-extend","js!SBIS3.Contacts.Models.MiniMessageModel","js!SBIS3.Contacts.Models.ExtendedBaseMixin","js!SBIS3.Contacts.Models.ExtendedMessageMixin"],function(e,t,s,o){var n=t.extend({_moduleName:"SBIS3.Contacts.Models.ThemeMessageModel",$protected:{_options:{properties:{NeedServiceBlock:{get:function(){return this.get("СлужебныйТип")&&this.get("СлужебныйТип")[0]}},SeparatorName:{get:function(){var e="";switch(this.get("ИдРазделителя")){case 0:e=rk("Сегодня");break;case 1:e=rk("Вчера");break;case 2:e=rk("За неделю","contacts");break;case 3:e=rk("Больше недели")}return e}}}}}});return e.mixin(n,[s,o])});
//# sourceMappingURL=ThemeMessage.module.js.map
define("js!SBIS3.Contacts.Models.SingleMessageModel",["js!SBIS3.Contacts.Models.ThemeMessageModel"],function(t){var e=t.extend({_moduleName:"SBIS3.Contacts.Models.SingleMessageModel",$protected:{_options:{properties:{ChatName:{get:function(){return this.get("УчастникиТемы")}},NeedChatName:{get:function(){var t=this.get("Тип");return("chat"===t||"chat/2"===t)&&this.get("УчастникиТемы")}},IsDocRedaction:{get:function(){var t=this.get("СлужебныйТип");return t&&t.length&&"document-redaction"===t[0]}},NeedEye:{get:function(){if(!this.get("КонтактПерсона"))return;if(this.get("Я")[0]&&!this.get("ПрочитаноПолучателем")[0])return"icon-disabled";if(1==this.get("КоличествоПолучателей")[0]||this.get("ТетАТет"))if(this.isContactMsg()&&this.get("Входящее")[0]&&!this.get("ПрочитаноВладельцем")[0])return"icon-hover";return false}},NeedPersonName:{get:function(){var t=this.get("ТипСписка");return t?!(("theme"===t||"msgcontact"===t)&&this.get("ТетАТет"))||"theme"===t&&this.get("PhotoLink"):void 0}},NeedMessageMeLabel:{get:function(){return this.get("ТипСписка")?this.get("КоличествоПолучателей")[0]>1&&this.get("Я")[0]:void 0}},PhotoSize:{get:function(){return 24}},DateClickable:{get:function(){var t=this.get("Тип"),e=this.get("КоличествоПолучателей");return"dialog"===t&&e&&e[0]>(this.isContactMsg()?0:1)}}}}},getRowSelector:function(){var t=this.getColumnSelector();if(this.get("IsDocRedaction"))t+=" chat-service";return e.superclass.getRowSelector.call(this,0)+t},getColumnSelector:function(){return""}});return e});
//# sourceMappingURL=SingleMessage.module.js.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/FileAttach",["Core/tmpl/js/tclosure","js!SBIS3.Contacts.FileViewerMini"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={};i["js!SBIS3.Contacts.FileViewerMini"]=e[1];var r=function e(r,l,n,a,o){function s(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};o&&o.isSetts&&(p=o.fullContext||{});var m="string"==typeof n?n:"",u=void 0===i?void 0:i,f={id:[],def:void 0},v=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),g=this&&this.includedTemplates?this.includedTemplates:{},h=d.getMarkupGenerator(a);try{var M=h.joinElements([h.createControl("wsControl","ws:SBIS3.Contacts.FileViewerMini",{className:d.getter(r,["item","getClassName"]).apply(d.getter(r,["item"]),["FileAttach>fileViewer"])+" contacts-ThemeMessage-row__FileViewer",files:d.getter(r,["item","get"]).apply(d.getter(r,["item"]),["ФайлыДляПревью"]),themeGUID:d.getter(r,["item","get"]).apply(d.getter(r,["item"]),["Тема"])},d.plainMerge(l,{}),{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},n,u,g,d.config,p)],m,f);f.def&&(M=h.chain(M,f,l),f=void 0)}catch(e){d.templateError("resources/Contacts.Mini/Models/templates/FileAttach.tmpl",e,r)}return M||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/FileAttach"}},r});
//# sourceMappingURL=FileAttach.tmpl.map
define("js!SBIS3.Contacts.Models.MiniChatModel",["Core/helpers/string-helpers","js!SBIS3.Contacts.Models.MiniMessageModel","js!SBIS3.Contacts.CoreMiniFunctions","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/FileAttach","js!SBIS3.Contacts.FileViewerMini"],function(t,e,i,s){var r=e.extend({_moduleName:"SBIS3.Contacts.Models.MiniChatModel",$protected:{_serviceType:["new-chat","chat-new-admin","new-chater","stop-chater","chat-remove-admin","chat_unlock","chat_lock"],_fileAttachTpl:s,_options:{properties:{NeedEye:{get:function(){if(!this.get("КонтактПерсона"))return;if(this.get("КоличествоПолучателей")[0]<2){var t=0===this.get("КоличествоПолучателей")[0]?!(this.get("ПрочитанноУчастниками")[0]||this.get("ПрочитаноПолучателем")[0]):!this.get("ПрочитаноПолучателем")[0];if(this.get("Я")[0]&&t)return"icon-disabled"}return false}},NeedPersonName:{get:function(){return this.get("ТипСписка")?true:void 0}},NeedMessageMeLabel:{get:function(){if(!this.get("ТипСписка"))return;return!(this.get("IsServiceTypeChat")||!this.get("Я")[0])&&!this.get("NeedTitle")}},NeedServiceBlock:{get:function(){var t=this.get("СлужебныйТип")&&this.get("СлужебныйТип")[0],e=this.get("ServiceObject");return t&&(!this.get("IsServiceTypeChat")||"chat_lock"===t&&e&&e.type)}},NeedTitle:{get:function(){return this.get("Я")?(this.get("Я")[0]&&this.get("КоличествоПолучателей")[0]>0||this.get("Входящее")[0])&&!this.get("IsTetATet")&&this.get("КонтактФИ")[0]:void 0}},GroupId:{get:function(){var t=this.get("ДляИнтерфейса")||"",e=this.get("ИдРазделителя");return t&&e>=0?e+"_"+t:e},set:function(t){if("stop-chater"===(this.get("СлужебныйТип")&&this.get("СлужебныйТип")[0]))if(this.getOwner()&&this.getOwner().at(0).get("Сообщение")===this.get("Сообщение")){var e=this.get("СлужебныйОбъект");try{if(((e&&JSON.parse(e[0])).receivers||[]).indexOf(i.getUserId())>-1)return}catch(t){}}if(!this.get("IsServiceTypeChat"))return;var s={};if("string"===typeof t){var r=t.split("_");if(t="null"===r[0]?null:parseInt(r[0]),r[1])s["ДляИнтерфейса"]=r[1]}if(this.get("ИдРазделителя")===t&&this.get("ДляИнтерфейса")===s["ДляИнтерфейса"])return;if(s["ИдРазделителя"]=t,!s["ДляИнтерфейса"])s["ДляИнтерфейса"]="";this.set(s)}},SeparatorName:{get:function(){var e=this.get("КоличествоЭлементов")+1;return t.format({count:e},i.plural(e,rk("$count$s$ служебное сообщение","unread_count"),rk("$count$s$ служебных сообщения","unread_count"),rk("$count$s$ служебных сообщений","unread_count")))},set:function(t){if(!this.get("IsServiceTypeChat"))return;this.set("КоличествоЭлементов",t-1)}},IsHiddenRow:{get:function(){return this.get("IsHidden")},set:function(t){if(!this.get("IsServiceTypeChat")||null===this.get("GroupId"))return;this.set("IsHidden",t)}},IsGroupTitle:{get:function(){return this.get("IsServiceTypeChat")&&this.get("КоличествоЭлементов")&&this.get("КоличествоЭлементов")>=1}},IsServiceTypeChat:{get:function(){var t=this._serviceType,e=this.get("СлужебныйТип")&&this.get("СлужебныйТип")[0];return e?t.indexOf(e)>=0:false}}}}},getRowSelector:function(){var t=this.getColumnSelector();return r.superclass.getRowSelector.call(this,0)+t},getColumnSelector:function(){return""}});return r});
//# sourceMappingURL=Chat.module.js.map
define("js!SBIS3.Contacts.Models.ChatModel",["Core/core-extend","js!SBIS3.Contacts.Models.MiniChatModel","js!SBIS3.Contacts.Models.ExtendedBaseMixin","js!SBIS3.Contacts.Models.ExtendedMessageMixin","i18n!SBIS3.Contacts.Models.ChatModel"],function(e,t,o,n){var s=t.extend({_moduleName:"SBIS3.Contacts.Models.ChatModel",$protected:{_fileAttachTplMini:false}});return e.mixin(s,[o,n])});
//# sourceMappingURL=Chat.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.ScrollToMessage",["Core/core-instance","Core/IoC","Core/EventBus"],function(t,e,i){"use strict";return{$protected:{_options:{messagesRegistry:void 0},_notScrolledToUuid_notactive:null,_notScrolledToUuid_notactive_toBottom:null,_tickerSubscribed:false,_registryComponent:null},$constructor:function(){},before:{isViewVisible:function(){return"function"==typeof this.isVisibleWithParents?this.isVisibleWithParents():true}},scrollToMessage:function(i,o,s){var r={result:true,executed:true},n={result:null,executed:false};if("string"!==typeof i||!i.length)return e.resolve("ILogger").log("Interface.ScrollToMessage ","uuid in params required"),n;if(!this._registryComponent){var l=this._options.messagesRegistry;if(t.instanceOfModule(this,"SBIS3.CONTROLS/ListView"))this._registryComponent=this;else if(l&&"string"==typeof l&&this.hasChildControlByName(l)){var c=this.getChildControlByName(l);if(t.instanceOfModule(c,"SBIS3.CONTROLS/ListView"))this._registryComponent=c}if(!this._registryComponent)return e.resolve("ILogger").log("Interface.ScrollToMessage ","a registry component is not detected"),n}if(s||this.isViewVisible())this._notScrolledToUuid_notactive=null,this._notScrolledToUuid_notactive_toBottom=null,this._scrollerToItem(i,o);else{if(!this._notScrolledToUuid_notactive)this._tickerOnOffHandler(true);this._notScrolledToUuid_notactive=i,this._notScrolledToUuid_notactive_toBottom=o}return r},_tickVisibilityCheckHandler:function(){if(!this.isDestroyed()&&this._notScrolledToUuid_notactive){if(this.isViewVisible()){var t=this._notScrolledToUuid_notactive,e=this._notScrolledToUuid_notactive_toBottom;this._notScrolledToUuid_notactive=null,this._notScrolledToUuid_notactive_toBottom=null,this._tickerOnOffHandler(false),this._scrollerToItem(t,e)}}else this._tickerOnOffHandler(false)},_tickerOnOffHandler:function(t){var e=!!t;if(e!=this._tickerSubscribed){var o=i.channel("ticker");if(o)this._tickerSubscribed=e,o[e?"subscribe":"unsubscribe"]("onTickSlow",this._tickVisibilityCheckHandler,this)}},_scrollerToItem:function(t,i){if(this._registryComponent.scrollToItem&&!this._registryComponent.isDestroyed()){var o=this._registryComponent.getItems();if(!o)return false;var s=o.getMyMessageIndex(t),r=s&&void 0!==s.index?o.at(s.index):null;if(this._options.isChat&&r&&r.get("IsHiddenRow")){var n=r.get("GroupId");if(n>-1&&this._separatorTitle&&this._separatorTitle.hasOwnProperty(n)&&this._separatorTitle[n])r=o.getRecordById(this._separatorTitle[n])}if(!r)return e.resolve("ILogger").log("Interface.ScrollToMessage ","the message is not found in the set"),false;return this._registryComponent.scrollToItem(r,i),true}else return false}}});
//# sourceMappingURL=ScrollToMessage.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.MessagePositionCursorView",["Core/Deferred","Core/IoC","js!WS.Data/Source/SbisService","Core/detection"],function(e,s,t,i){"use strict";return{$protected:{_options:{foundMsgOrderNumber:null},_removedScrollContainer__content:false},setPositionCursor:function(e){if(this._pageHelpers=e?true:null,this.getListNavigation())this.getListNavigation().setPosition(e)},_doReload:function(e,s){var t=this,i=function(){t.reload().addCallbacks(function(s){e.callback(s)},function(s){e.errback(s)})};if(t._options.pageSize){var o=s&&s.beginMessage?s.beginMessage:null;t._options.messageID=o,t._getPositionCursorMessage(o).addCallback(function(){i()})}else i()},_getPositionCursorMessage:function(i){var o=this,n=new e;if(i){var r=o._getDialogId();new t({endpoint:"PublicMsgApi"}).call("КурсорСообщенияВТеме",{"Тема":r,"Сообщение":i,"Смещение":"both"==o._options.infiniteScroll?10:0,"ПолеСортировки":"ДатаВремя"}).addCallbacks(function(e){if(r==o._getDialogId())o.setPositionCursor(e.getScalar()),n.callback()},function(e){o.setPositionCursor(null),s.resolve("ILogger").error(e),n.callback()})}else o.setPositionCursor(null),n.callback();return n},_reloadIsExistMessage:function(){var e=this;if(e._options.isExistMessages)if(e._options.pageSize)e._getPositionCursorMessage(e._options.messageID).addCallback(function(){e.reload()});else e.reload()},_reloadOnOffset:function(e,s){if(this._isSearching(s))this.setPositionCursor(null);if(this._scrollToMessageIdOrStart(),this._options.messageID=null,this._cursorOnMergeSearch=null,this._options.navigation&&this._options.navigation.config.direction)this.getListNavigation().setDirection(this._options.navigation.config.direction);return e.superclass.reload.apply(this,[s])},_scrollToMessageIdOrStart:function(){var e=this._options.messageID;this.subscribeOnceTo(this,"onDrawItems",function(){var s=false;if(!e){s=true;var t=this.getItems(),o=t?t.at(t.getFreshestIndex()):null;e=o?o.getId():null}if(e)if(i.firefox&&!this._removedScrollContainer__content)this._removedScrollContainer__content=true,this.getParent().getContainer().find(".controls-ScrollContainer__content").removeClass("controls-ScrollContainer__content-overflowHidden"),this.scrollToMessage(e,s);else if(i.isIE){var n=this;setTimeout(function(){n.scrollToMessage(e,s)},10)}else this.scrollToMessage(e,s)})},_setCursorOnSearch:function(e){if(this._isSearching()){var s=e.getMetaData(),t=s?s.results:null,i=t?t.get("Курсор"):null;if(i)this.setPositionCursor(i),this._cursorOnMergeSearch=i}}}});
//# sourceMappingURL=MessagePositionCursorView.module.js.map
define("js!SBIS3.Contacts.Controllers.ListOfMessagesEventHandlers",["Core/IoC","i18n!SBIS3.Contacts.Controllers.ListOfMessagesEventHandlers"],function(e){"use strict";var t={_moduleName:"SBIS3.Contacts.Controllers.ListOfMessagesEventHandlers",onChangeMessage:{validator:function(e){var t=this.getList();if(!t||!e||!e.changes_for||!e.changes_for.length||!e.state)return false;if(!s(e.state,["read","unread","deleted","edited","processing","unprocessed"]))return false;if(t.isAny("Тема",e.changes_for,"theme")||t.isAny("Папка",e.changes_for,"folders"))return true;return t.isSingleThemeMessageList()&&t.isAny("Сообщение",e.changes_for,"msg")},processor:function(e){var t=this.getList();if("object"!=typeof e)throw"Неправильный параметр объекта события в onChangeMessage";if("function"!==typeof t.isChat)throw"Неправильный объект list в onChangeMessage";if("unread"==e.state&&!t.isMyPerson(e.user))return null;for(var s=e.changes_for.length,r=t.isChat(),n=t.isSingleThemeMessageList(),l=t.isPairs(),o="dialogs"===this.getListType(),a=this.isWithFolders(),f=this.isThemesList(),g=[],d={},h=false,u={folders_added4update:{},folders_update_localy:{}},m=[],c=0;c<s;c++){var v=e.changes_for[c],p=!!(a&&v.folders&&v.folders.length&&v.folders_ido&&v.folders_ido.length),_,y=e.changes_date?e.changes_date:new Date;if(_=f?t.getMyThemeIndex(v.theme):t.getMySingleMessageIndex(v.msg),null===_&&!p){if(t.isMyPerson(e.user)&&"unread"==e.state&&!n)g.push({append:true,theme:v.theme});continue}if(!h&&"deleted"!=e.state&&o)this.saveFastAnswerStateIfVisible(),h=true;switch(e.state){case"deleted":if(n||!f)t.removeAt(_);else{var I=t.at(_),M=null,L={};if(I)M=I.get("Раздел");else if(e.changes_for&&e.changes_for.length&&e.changes_for[0].folders_ido&&e.changes_for[0].folders_ido.length)M=e.changes_for[0].folders_ido[0];if(a)i.call(u,false,e.state,null,t,M),L["root"]=M;if(L["theme"]=v.theme,!f)L["msg"]=v.msg;g.push(L)}break;case"edited":if(e.is_local&&e.localInfo)if(e.localInfo["Файлы"]){if(null!==_)if(!f||null!==t.getMySingleMessageIndex(v.msg)){var x=t.at(_),F={theme:v.theme,msg:v.msg};if(this.isWithFolders())if(x.get("Папка"))if(V=x.get("Раздел"),V.length)F["root"]="string"===typeof V?V:V[0];g.push(F)}}else{var T=e.localInfo["СообщениеИзменено"]?[rk("Отредактировано"),e.localInfo["СообщениеИзменено"].strftime("%e %b %Y %H:%M")].join(" "):false;if(T||e.localInfo["Текст"])if(!l){if(v.msg===t.at(_).get("Сообщение"))t.setModelField("Текст",e.localInfo["Текст"],_,false),T&&t.setModelField("СообщениеИзменено",T,_,false)}else if((V=t.at(_)).get("Сообщение")===v.msg||V.get("СообщениеПоследнее")===v.msg)t.setModelFieldPair("Текст",e.localInfo["Текст"],_,true,v.msg),T&&t.setModelFieldPair("СообщениеИзменено",T,_,true,v.msg)}else{var w=t.getMyMessageIndex(v.msg);if(null!==w){var S=t.at(w.index),C=S.get("FileForPreview"),O={theme:v.theme,msg:v.msg};if(C=C&&C.getCount()>0,S.get("Текст")[w.second?1:0]!==v.text||C)if(this.isWithFolders()){if(S.get("Папка"))if((V=S.get("Раздел")).length)O["root"]="string"==typeof V?V:V[0];g.push(O)}else{var P="string"===typeof e.changes_date?Date.fromSQL(e.changes_date):e.changes_date;if(!P)P=new Date;if(T=[rk("Отредактировано"),P.strftime("%e %b %Y %H:%M")].join(" "),T&&!C){if(!l){if(v.msg===t.at(_).get("Сообщение"))if(t.setModelField("Текст",v.text,_,false),false!==v.is_edit)t.setModelField("СообщениеИзменено",T,_,false)}else if(V=t.at(_),V.get("Сообщение")===v.msg||V.get("СообщениеПоследнее")===v.msg)if(t.setModelFieldPair("Текст",v.text,_,true,v.msg),false!==v.is_edit)t.setModelFieldPair("СообщениеИзменено",T,_,true,v.msg)}else g.push(O)}}}case"unprocessed":if(l)t.setModelFieldPair("НачатаПравка",null,_,true,v.msg);else if(t.at(_).get("Сообщение")==v.msg)t.setModelField("НачатаПравка",null,_,false);break;case"processing":if(l)t.setModelFieldPair("НачатаПравка",y,_,true,v.msg);else{var V=t.at(_);if(V.get("Сообщение")==v.msg&&!V.get("НачатаПравка")[0])t.setModelField("НачатаПравка",y,_,false)}}}var A=o&&2==this.getRegistryType();for(var B in d)if(d.hasOwnProperty(B))g.push({theme:B,ignore_reg:A});for(var b in u.folders_update_localy)if(u.folders_update_localy.hasOwnProperty(b)){var k=parseInt(b),D=t.at(k),R=u.folders_update_localy[b],W=R.unread-R.read,N=D.get("КоличествоНепрочитанных")+W,j=D.get("КоличествоЭлементов")-R.deleted;if(W&&N>=0)D.set("КоличествоНепрочитанных",N);if(R.deleted&&j>=0)D.set("КоличествоЭлементов",j)}for(var E in u.folders_added4update)if(u.folders_added4update.hasOwnProperty(E)&&u.folders_added4update[E])m.push({folder:E,only_folders:true});if(m.length>1)g.push({only_folders:true});else g=g.concat(m);return g.length?g:null}},onRestoreTheme:{validator:function(e){var t=this.getList();if(!t||!e||!e.themes||!e.themes.length)return false;return!t.isSingleThemeMessageList()},processor:function(e){for(var t=[],s=this.getList(),r=this.isArchive(),i=0;i<e.themes.length;i++){var n=e.themes[i];if("object"===typeof n)n=n.id;if(r){var l=s.getIndicesByValue("Тема",n);if(l&&l.length)l.forEach(function(e){s.at(e).set("СообщениеУдалено",null)});continue}t.push({theme:n,append:true,needReplace:true})}return t.length?t:null}},onChangeThemes:{validator:function(e){var t=this.getList();if(!t||!e||!e.changed_themes||!e.changed_themes.length||!e.state)return false;if(!s(e.state,["read","unread","document_rename","files_encrypted"]))return false;return t.isAny("Тема",e.changed_themes,"id")||this.isWithFolders()&&t.isAny("Папка",e.folders)},processor:function(t){var s=this.getList(),r=s.isMyPerson(t.user),i=s.isMyPerson(t.other_user),n=r||i,l=!r||t.other_user&&!i;if("object"!=typeof t)throw"Неправильный параметр объекта события в onChangeThemes";if("function"!==typeof s.isChat)throw"Неправильный объект list в onChangeThemes";if("unread"==t.state&&!n)return null;var o=t.changed_themes.length,a,f=this.getListType(),g=s.isChat(),d=s.isSingleThemeMessageList(),h=s.isPairs(),u="dialogs"===f,m="invite"===f,c=this.isWithFolders(),v=this.isDialogs(),p=this.isUnreads(),_=[],y={},I=false,M=t["datetime"]?"string"===typeof t["datetime"]?Date.fromSQL(t["datetime"]):t["datetime"]:new Date,L="read"===t.state,x=-1!==["read","unread"].indexOf(t.state),F=function(e,t){var s=e.getFreshestIndex();return-1!=s&&t.get("Сообщение")!=e.at(s).get("Сообщение")};if(c&&t.folders&&t.folders.length&&-1!=s.getIndexByValue("Раздел@",true)){for(var T=[],w={},S=s.getMyFolders(),C=0,O=S.length;C<O;C++){var P=s.at(S[C]),V=P.get("Папка");if(-1!=t.folders.indexOf(V)){T.push(V);var A=P.get("Раздел");if(void 0===w[A])w[A]=[V];else w[A].push(V)}}if(1==T.length)_.push({folder:T[0],only_folders:true});else if(T.length>1)for(var B in w)if(w.hasOwnProperty(B)){var b=w[B];_.push(b.length>1?{only_folders:true,root:B}:{folder:b[0],only_folders:true})}}if(g&&L){for(a=0;a<o;a++){var k=t.changed_themes[a];if(null!=s.getMyThemeIndex(k.id))if(k.msg){var D=s.getMySingleMessageIndex(k.msg);if(null!==D)M=s.at(D).get("ДатаВремя")[0]}}for(o=s.getCount(),a=0;a<o;a++){var R=s.at(a);if(R.get("ДатаВремя")[0]<=M){var W={},N=R.get("Входящее"),j=false;if(n)if(x&&N[0]&&R.get("ПрочитаноВладельцем")[0]!==L)W={"ПрочитаноВладельцем":L,"ПрочитаноПолучателем":L?M:null},j=true;if(l&&L&&!N[0]){var E=R.get("СлужебныйОбъект"),H;try{H=E&&JSON.parse(E[0])}catch(t){e.resolve("ILogger").error(t)}if(1!==R.get("КоличествоПолучателей")[0]||H&&H.hasOwnProperty("receivers")&&H.receivers==t.user)if(null==R.get("ПрочитаноПолучателем")[0])W["ПрочитаноПолучателем"]=M,j=true}s.setModelFields(0,W,R)}}}else{var U={},Q={},z=false,Y=[],J=function(e){var t=s.getIndexByValue("Сообщение",e),r=false;if(-1==t&&!d)t=s.getIndexByValue("СообщениеПоследнее",e);if(-1!=t&&!U[t])Y.push(t),U[t]=true,r=true;return Q[e]=true,r};for(a=0;a<o;a++){var k=t.changed_themes[a],q=Y.length;if(d||k.msg||k.only_msgs&&k.only_msgs.length){if(!d&&-1===s.getIndexByValue("Тема",k.id))continue;var G=false;if(k.msg)G=J(k.msg)||G;if(k.only_msgs)for(var C=0,O=k.only_msgs.length;C<O;C++)G=J(k.only_msgs[C])||G;if(!G&&u&&v&&-1!==s.getIndexByValue("Тема",k.id))y[k.id]=true;else z=true}else Y=s.getIndicesByValue("Тема",k.id);if(q==Y.length){if(n&&"unread"==t.state&&p)_.push({append:true,theme:k.id});continue}}if(Y.length&&!I&&u)this.saveFastAnswerStateIfVisible(),I=true;Y.forEach(function(e){var t=s.at(e),r=t.get("ДатаВремя"),i=t.get("Входящее");if(z||null!=r[0]&&r[0]<=M||h&&(z||null!=r[1]&&r[1]<=M)){var l=t.get("ПрочитаноПолучателем"),o=t.get("ПрочитаноВладельцем"),a=false,f={};if(n)if(!h){if(x&&o[0]!=L){if(f={"ПрочитаноВладельцем":L,"ПрочитаноПолучателем":L?M:null},u||m){var d=t.get("КоличествоНепрочитанных"),c=d;if(d>0)if(L){var v=t.get("СообщениеПоследнее");c=Q[v]?0:d-1}else c=d+1;if(c!=d)if(f["КоличествоНепрочитанных"]=c,d>1&&L&&!(k.id in y))y[k.id]=true}s.setModelFields(0,f,t)}else if((u||m)&&!(y&&y[k.id]))y[k.id]=true}else{for(var p=[o[0],o[1]],_=[l[0],l[1]],I=0;I<2;I++)if(i[I]&&l[I]!==L&&(z||r[I]<=M)&&(L||!i[1]||1===I))p[I]=L,_[I]=L?M:null,a=true;if(x&&a)f={"ПрочитаноВладельцем":p,"ПрочитаноПолучателем":_},t.set(f)}else if(x&&L){var T=h&&t.get("СообщениеПоследнее")?1:0;if(null===l[T])if(f["ПрочитаноПолучателем"]=M,!g)f["МожноУдалить"]=false;if(!g&&t.get("МожноРедактировать")&&F(s,t))f["МожноРедактировать"]=false;s.setModelFields(T,f,t)}}},this)}for(var K in y)if(y.hasOwnProperty(K))_.push({theme:K,ignore_reg:p});if(("document_rename"===t.state||"files_encrypted"===t.state)&&0===_.length)for(a=0;a<o;a++){var X=t.changed_themes[a];if("object"===typeof X)X=X.id;_.push({theme:X})}var Z=_.length,$=this.getView().getPageSize();if(Z>2&&Z>$/2)return[{reload:true}];return Z?_:null}},onNewMessage:{validator:function(e){var t=this.getList();if(e.is_chat&&e.theme&&!t&&this.getFilter()["Тема"]==e.theme)return true;if(!t||!(e&&e.theme&&e.msg&&e.sender)||"refresh_counters"==e.theme)return false;var s=t.getListType();if("invite"===s){if(e.is_local&&null!==t.getMyThemeIndex(e.theme))return true;if(!e.invite)return false;var r=this.getFilter()||{},i=r["Реестр"];if(e.invite.reestr!=i)return false}if(t.isSingleThemeMessageList()&&null===t.getMyThemeIndex(e.theme)){var n=this.getFilter();if(!n.hasOwnProperty("Тема")||n["Тема"]!=e.theme)return false}if("dialogs"===s){if(!e.reestr||!e.reestr.length)return false;if(r=this.getFilter()||{},i=r["Реестр"],-1===[0,4].indexOf(i)&&-1===e.reestr.indexOf(i)){if(3===i)t.removeAt(t.getMyThemeIndex(e.theme));return false}}if("pairs"===s||"msgcontact"===s){if(!e.reestr||!e.reestr.length)return false;var l=(r=this.getFilter()||{})["Контакт"];if(l)if(e.sender&&e.sender.person&&e.sender.person!==l&&e.receivers&&-1===e.receivers.indexOf(l))return false}return true},timeouting:function(e){var t=this.getList();if(t&&t.isChat()&&!e.outgoing&&!e.is_local)return Math.floor(401*Math.random())+100;return 0},processor:function(e){var t=this.getList(),r=t.isChat(),i=t.isSingleThemeMessageList(),n={};if(!e.is_dialog&&e.hasOwnProperty("is_chat")&&r!==e.is_chat||r&&!e.is_chat)return null;if(!i&&(e.hasOwnProperty("intraTheme")&&e.intraTheme||e.chat_is_public&&e.is_dialog&&!e.dialog_dif))return null;if(["for_sign","not_sign","sign","for_first_sign","for_second_sign"].indexOf(e.type)>=0&&i)return[{reload:true}];var l=[];if(i&&e.is_local&&(e.outgoing||e.sender&&e.sender.person&&e.receivers&&e.receivers.length&&s(e.sender.person,e.receivers))&&this.isLocalNewMessageBLCallBlocked())return null;if(r)if(e.outgoing)if(null==t.getMySingleMessageIndex(e.msg))l.push({append:true,theme:e.theme,msg:e.msg}),n[e.theme]=1;else return null;else l.push({delayedListUpdateAfterLast:true});else if(this.isWithFolders()&&(e.folders_ido&&e.folders_ido.length||e.folders&&e.folders.length))for(var o=e.folders_ido||e.folders,a=o.length;a--;)if(this.isViewInRoot()&&null==o[a]||!this.isViewInRoot()&&0===this.isViewInFolder(o[a])){if(!n[e.theme])l.push({append:null===t.getMyThemeIndex(e.theme),theme:e.theme,msg:e.msg}),n[e.theme]=1}else{var f=o[a];if(e.folders_ido){var g=t.getRecordById(o[a]);f=g?g.get("Папка"):null}if(f)l.push({folder:f,only_folders:true})}if(!n[e.theme]&&!r){var d=null===(i||"msgcontact"===this.getListType()||this.isArchive()?t.getMySingleMessageIndex(e.msg):t.getMyThemeIndex(e.theme));if(e.folders_ido&&e.folders_ido.length&&this.isWithFolders()){var h=e.folders_ido[0];if(t.getIndexByValue("Раздел",h)||this.getView().getOpenedPath()[h])l.push({root:h,append:d,theme:e.theme,msg:e.msg}),n[e.theme]=1}else{if(l.push({append:d,theme:e.theme,msg:e.msg}),e.old_msg&&"msgcontact"===t.getListType())l.push({append:d,theme:e.theme,msg:e.old_msg});n[e.theme]=1}}for(var a=0,u=l.length;i&&a<u;a++){var m=l[a];if(m.theme||m.delayedListUpdateAfterLast){var c=!(e.hasOwnProperty("datetime")&&e.datetime),v=e.datetime;if(c){var p;if(e.is_chat&&"new-chater"===e.type)p=t.getFreshestIndex(false,true);if(p>=0)v=t.getRowDatetime(p);else v=new Date;if(m.delayedListUpdateAfterLast)v.setMinutes(v.getMinutes()-1);else v.setHours(v.getHours()-5)}else(v="string"==typeof v?Date.fromSQL(v):v).setSeconds(v.getSeconds()-1);m["datefrom"]=v}}var _=e.sender?e.sender.person:null;if(!r&&t.isSingleThemeMessageList()&&!e.intraTheme)for(var a=0,u=t.getCount();a<u;a++)if(t.isOutgoingMessage(a)){var y=t.at(a),I=y.get("ПрочитаноПолучателем"),M=I.length&&null!=I[0],L=(y.get("ServiceObject")||{}).receivers||[];if(!M&&-1!==L.indexOf(_))M=true,y.set("ПрочитаноПолучателем",e.datetime);if(M){if(y.get("МожноРедактировать"))y.set("МожноРедактировать",false);if(y.get("МожноУдалить"))y.set("МожноУдалить",false)}}return l}},onDeleteTheme:{validator:function(e){var t=this.getList();if(!t||!(e&&e.erased_themes&&e.erased_themes.length)||t.isChat())return false;if(t.isAny("Тема",e.erased_themes))return true;return this.isWithFolders()},processor:function(e){var t=this.getList(),s=t.isSingleThemeMessageList(),i=t.isAnySingleMessage(),n,l,o=false,a=e.erased_messages?e.erased_messages.length:0;for(n=0,l=e.erased_themes.length;n<l&&t.getCount()>0;n++)if(e.is_archive)if(i&&n<a){var f=e.erased_messages[n],g=t.getMySingleMessageIndex(f);if(null!=g)t.removeAt(g),o=true}else break;else if(!s){var d=e.erased_themes[n],h=t.getMyThemeIndex(d);while(null!==h&&t.getCount()>0)t.removeAt(h),o=true,h=t.getMyThemeIndex(d)}if(this.isWithFolders())if(0!=t.getMyFolders().length){var u=this.getView().getCurrentRoot(),m=e.theme_folders?e.theme_folders:e.folders;if(m&&m.length){var c=[],v={};for(n=0,l=m.length;n<l;n++)c=c.concat(r(t,m[n],u,v));if(0!=c.length)return c}}return null}},onNewFileVersion:{validator:function(e){var t=this.getList();if(!t||!(e&&e.attachId&&e.fileID&&e.themeID&&e.isRename))return false;return null!==t.getMyThemeIndex(e.themeID)},processor:function(e){var t=this.getList();if(null!==t.getMyThemeIndex(e.themeID))for(var s=e.attachId,r=e.fileName,i=t.getIndicesByValue("Тема",e.themeID),n=0,l=i.length;n<l;n++)for(var o=t.at(i[n]),a=["ФайлыДляПревью","ФайлыДляПревью2","ПодписанныеФайлыДляОбъекта","ПодписанныеФайлыДляОбъекта2"],f=0,g=a.length;f<g;f++){var d=a[f],h=o.get(d),u=h?h.getCount():0,m=false;if(u>0)for(var c=0;c<u;c++){var v=h.at(c);if(v&&v.get("attachId")==s){v.set("fileName",r),v.set("title",r),m=true;break}}if(m)o.set(d,h)}return null}},onNeedCheckRefresh:{validator:function(e){var t=this.getList(),s;if(!t||!e||!e.checkdatetime||!e.moreInfo)return false;if(s=e.moreInfo,!(s.incoming||s.outgoing||s.chats))return false;if(t.isChat())return s.chats&&s.chats.length&&t.isAny("Тема",s.chats);else if(s.incoming&&s.incoming.length||s.outgoing&&s.outgoing.length){if(t.isSingleThemeMessageList()){if(s.incoming&&s.incoming.length&&t.isAny("Тема",s.incoming)||s.outgoing&&s.outgoing.length&&t.isAny("Тема",s.outgoing))return true;var r=this.getFilter(),i=r.hasOwnProperty("Тема")?r["Тема"]:null;return!!(i&&(s.incoming&&s.incoming.length&&-1!=Array.indexOf(s.incoming,i)||s.outgoing&&s.outgoing.length&&-1!=Array.indexOf(s.outgoing,i)))}return true}return false},processor:function(e){var t=this.getList(),s=[];if(t.isSingleThemeMessageList())if(t.isChat())s.push({delayedListUpdateAfterLast:true,datefrom:e.checkdatetime});else s.push({append:true,datefrom:e.checkdatetime});else{var r=function(e){this.push({append:true,theme:e})},i=e.moreInfo;if(i.incoming&&i.incoming.length)i.incoming.forEach(r,s);if(i.outgoing&&i.outgoing.length)i.outgoing.forEach(r,s);if(this.isWithFolders())s.push({append:true,only_folders:true})}return s}},onChangeFolder:{validator:function(e){var t=this.getList();if(!t||!(e&&e.action&&s(e.action,["add","delete","edit","position","move"])&&e.folder))return false;if(this.isWithFolders()){if("add"==e.action)return true;var r=t.getMyFolderIndex(e.folder);return null!==r&&t.isFolderRow(r)}return false},processor:function(e){var t=this.getView(),s=this.getList(),i=[],n,l=t.getCurrentRoot();if(!this.isWithFolders()||!e.folder)return null;if(n=s.getMyFolderIndex(e.folder),"add"==e.action)return null!==n?null:[{append:true,folder:e.folder,only_folder:true}];if(null===n)return null;switch(e.action){case"delete":if(t.removeItemsSelection([s.at(n).getId()]),!l||e.hasOwnProperty("from_hierarhy")&&e.from_hierarhy.length&&e.from_hierarhy[0].ido==l)i.push({reload:true});break;case"edit":if(e.is_local&&e.localInfo&&e.localInfo.name)s.setModelField("Название",e.localInfo.name,n);else i.push({folder:e.folder,only_folder:true});break;case"position":var o=s.at(n).getId(),a=t.getOpenedPath()[o];if(a)t.collapseNode(o);if(e.is_local&&e.localInfo&&e.localInfo.direction){if(s.shiftMyFolder(n,e.localInfo.direction),a)t.expandNode(o)}else i.push({only_folders:true,expand:o});break;case"move":if(e.to_from_folder&&(l==e.to_from_folder.ido||0===this.isViewInFolder(e.to_from_folder.ido)))i.push({append:true,folder:e.folder,only_folder:true});var f={},g=e.to_from_folder?r(s,e.to_from_folder.uuid,l,f):[],d=e.from_folder?r(s,e.from_folder.uuid,l,f):[];i=i.concat(g,d)}return i}},onMoveTheme:{validator:function(e){if(this.getList()&&e&&e.moved_themes&&e.moved_themes.length&&void 0!==e.from_folder&&void 0!==e.to_folder)return"dialogs"===this.getListType();return false},processor:function(e){var t=[],s=this.getList(),r=this.getView(),i=r.getPageSize(),n=r.getFilter()["Раздел"]||null,l=e.moved_themes.length;if(!n)return t;if(l>2&&l>i/2)return[{reload:true}];for(var o=0,a=l;o<a;o++){var f=e.moved_themes[o],g=s.getMyThemeIndex(f),d=s.at(g),h=d?d.get("Папка"):null;if(null!==g&&h===e.from_folder)s.removeAt(g);if(n===e.to_folder||e.folders&&e.folders[e.to_folder]&&n===parseInt(e.folders[e.to_folder].ido))t.push({append:true,theme:f})}return t}},onThemeTransform:{validator:function(e){var t=this.getList();return t&&!t.isSingleThemeMessageList()&&e.theme&&e.type&&e.user},processor:function(e){if(null!==this.getList().getMyThemeIndex(e.theme))return[{theme:e.theme}];return null}},onFilesSign:{validator:function(e){var t=this.getList(),s=false;if(t)for(var r=0;r<e.length;r++){var i=e[r].msg?t.getMyMessageIndex(e[r].msg):null;if(i&&-1!=i.index){s=true;break}}return s},processor:function(e){for(var t=this.getList(),s=[],r={},i=t.isSingleThemeMessageList(),n=0;n<e.length;n++){var l=e[n].theme,o=e[n].msg,a=t.getMyMessageIndex(o),f=a?a.index:-1;if(f>-1?t.at(f):null)if(i){if(!r[o])s.push({theme:l,msg:o}),r[o]=true}else if(!r[l])s.push({theme:l}),r[l]=true}return s.length?s:null}},onSignFileInfoReady:{validator:function(e){var t=this.getList();if(e.length&&t)for(var s=0,r=e.length;s<r;s++)if(null!==t.getMyThemeIndex(e[s].theme))return true;return false},processor:function(e){var t=[],s={},r=this.getList(),i=[],n={},l,o,a,f=r.isPairs(),g=r.isSingleThemeMessageList();for(o=0,a=e.length;r&&o<a;o++)if(l=e[o].theme,e[o].files&&e[o].files.length){var d=r.getIndicesByValue("Тема",l);if(null!==d&&d.length>0)if(i=i.concat(d),l in n)n[l].push(e[o].files);else n[l]=e[o].files}for(o=0,a=i.length;o<a;o++){var h=r.at(i[o]),u,m,c=function(e,t){if(e&&e.getCount()>0&&t)for(var s=0,r=t.length;s<r;s++)if(-1!=e.getIndexByValue("redactionId",t[s]["r"]))return true;return false};if(!h)continue;if(l=h.get("Тема"),m=n[l],!m)continue;if(!c(h.get("ФайлыДляПревью"),m)&&!(f&&c(h.get("ФайлыДляПревью2"),m)))continue;if(f||"dialogs"===this.getListType()){if(!s[l])t.push({theme:l})}else if(u=h.get("Сообщение"),!s[u])t.push({theme:l,msg:u})}return t.length?g?[{reload:true}]:t:null}},onMessageSetSubTheme:{validator:function(e){var t=this.getList();if(e.messages.length&&t){var s=t.getRecordById(e.messages[0]);return s&&s.get("Тема")==e.theme}return false},processor:function(e){return[{theme:e.theme,msg:e.messages[0]}]}}},s=function(e,t){return Array.indexOf(t,e)>=0},r=function(e,t,s,i){if(!t)return[];if(!i)i={};var n=e.getMyFolderIndex(t),l=e.at(n);if(!l)return[];var o=l.get("Раздел"),a=[];if(l&&!i[t])a.push({root:s,folder:t,only_folders:true}),i[t]=true;if(o){if(l=e.getRecordById(o),!l)return[];a=a.concat(r(e,l.get("Папка"),s,i))}return a},i=function(e,t,s,r,i){var n,l=function(e){var s=this.folders_update_localy[e];if(!s)s={read:0,unread:0,deleted:0},this.folders_update_localy[n]=s;s[t]++};if(e){if(s&&s.folders_ido){for(var o=0;o<s.folders_ido.length;o++)if(n=r.getIndexByValue("ИдО",s.folders_ido[o]),n>=0)l.call(this,n)}else while(i)if(n=r.getIndexByValue("ИдО",i),i=null,n>=0)if(l.call(this,n),g=r.at(n).get("Раздел"))i=g}else if(s)for(var o=s.folders.length;o--;){var a=s.folders[o];if(!this.folders_added4update[a])this.folders_added4update[a]=true}else if(i)while(i)if(n=r.getIndexByValue("ИдО",i),i=null,n>=0){var f=r.at(n),a=f.get("Папка");if(!this.folders_added4update[a])this.folders_added4update[a]=true;var g=f.get("Раздел");if(g)i=g}},n=function(e,t){if(e){var s=e.getIndexByValue("msgFileId",t),r=e.at(s);if(r){var i=r.get("signs");if(3!==i)r.set("signs",1===i?3:2)}}};return t});
//# sourceMappingURL=Handlers.module.js.map
define("js!SBIS3.Contacts.Collections.ListOfMessages",["Core/helpers/string-helpers","Core/IoC","Core/Deferred","Core/ParallelDeferred","js!WS.Data/Collection/RecordSet","js!SBIS3.Contacts.MessagesExchangeEvents","js!WS.Data/Source/SbisService","Core/EventBus","js!SBIS3.Contacts.CoreMiniFunctions"],function(e,t,n,r,i,s,a,o,l){"use strict";var f=i.extend({_moduleName:"SBIS3.Contacts.Collections.ListOfMessages",$protected:{_options:{listType:""},_listType:""},$constructor:function(e){if(e=e||{},"listType"in e)this.setListType(e.listType)},eventsObserving:function(e){if(this.isEventRaising()!=e)return this.setEventRaising(e,true),true;return false},getCurrentPath:function(){var e=this.getMetaData().path,t=void 0;if(e){var n=e.getCount();if(n>0)return e.at(n-1)}return null},getCurrentPathFolderUUID:function(){var e=this.getCurrentPath();return e?e.get("Папка"):null},getFirstUnread:function(){var e=this.getCount(),t=0,n=1;if(0!=e){if(this.isNewestDown())t=e-1,e=n=-1;for(var r=this.isPairs();t!==e;t+=n){var i=this.at(t),s=i.get("Входящее");if(s&&(s[0]||r&&s[1])){var a=i.get("ПрочитаноВладельцем");if(!a[0]||r&&!a[1])return t}}}return null},getIndicesByKeys:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=this.getIndicesByValue(this.getIdProperty(),e[n]);if(null!=i&&i.length>0)t=t.concat(i)}return t.length?t:null},getMyThemeIndex:function(e){var t=this.getIndexByValue("Тема",e);return t>=0?t:null},getMyMessageIndex:function(e){var t=[null,null],n=-1;if("string"!==typeof e&&"function"==typeof e.get)t[0]=e.get("Сообщение"),t[1]=e.get("СообщениеПоследнее");else t[0]=e;for(var r=0;r<2&&-1===n;r++){var i=t[r],s=false;if(null!==i)if(n=this.getIndexByValue("Сообщение",i),-1===n&&this.isPairs())s=true,n=this.getIndexByValue("СообщениеПоследнее",i)}return-1===n?null:{index:n,second:s}},getMySingleMessageIndex:function(e){var t=this.getIndexByValue("Сообщение",e);return t>=0?t:null},getMyFolders:function(){var e=this.getIndicesByValue("Раздел@",true);return null==e||0==e.length?[]:e},getMyFoldersByRoot:function(e){var t=this.getMyFolders(),n=this.getIndicesByValue("Раздел",e||null);return t=t.filter(function(e){return n.indexOf(e)>=0}),null==t||0==t.length?[]:t},getMyFolderIndex:function(e){if(void 0!=e){var t;if("number"!=typeof e&&e.indexOf("-"))t=this.getIndicesByValue("Папка",e);else if(parseInt(e)>0)t=this.getIndicesByValue("ИдО",e);if(t&&t.length)for(var n=0,r=t.length;n<r;n++)if(this.isFolderRow(t[n]))return t[n]}return null},getRowDatetime:function(e,t){var n=e,r=typeof e,i;if("number"==r)n=this.at(e),i=false===t||true===t?t:this.isPairs();else if("object"==r)i=false===t||true===t?t:"pairs"==this.getListType(n);else return null;if(!n)return null;var s=n.get("ДатаВремя");if(!s)return null;return s[i&&n.get("СообщениеПоследнее")&&n.get("СообщениеПоследнее")!=n.get("Сообщение")?1:0]},getRowFolder:function(e){var t=e,n=typeof e;if("number"==n)t=this.at(e);else if("object"!=n)return null;return t?t.get("Папка"):null},getListType:function(e){if(void 0===e){if(this._listType)return this._listType;if(this.getCount()>0)e=this.at(0)}if(void 0!==e&&e.has("ТипСписка"))return e.get("ТипСписка");return null},getRowType:function(e){var t="number"==typeof e?this.getCount()>e?this.at(e):null:e,n=t?t.get("Тип"):null;return null==n?"":n},getRowChatSubType:function(e){var t=this.getRowType(e).split("/");if(t.length>1&&"chat"==t[0])return t[1];return null},getFreshestIndex:function(e,t){for(var n,r=-1,i=0,s=this.getCount();i<s;i++){var a=this.at(i);if(t&&!a.get("IsServiceTypeChat"))continue;var o=this.getRowDatetime(a);if(void 0===n||o>n)r=i,n=o}return r},isChat:function(e){return"chat"==this.getListType(e)},isDateMatch:function(e,t){return e.getYear()==t.getYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()},isFolderRow:function(e){var t=e,n=typeof e;if("number"==n)t=this.at(e);else if("object"!=n)return null;if(!t)return null;return!!t.get("Раздел@")},isRowHasChatMsg:function(e){return-1!=this.getRowType(e).indexOf("chat")},isRowHasPrivateMsg:function(e){return-1!=this.getRowType(e).indexOf("private")},isSingleThemeMessageList:function(e){return h(this.getListType(e),["chat","theme","themecontact"])},isNewestDown:function(e){var t=this.getListType(e);return"dialogs"!==t&&"pairs"!==t&&"msgcontact"!==t},isPairs:function(e){return"pairs"==this.getListType(e)},isAnySingleMessage:function(e){return h(this.getListType(e),["dialogs","msgcontact"])},isAny:function(e,t,n){if(!e||0==e.length||!t||0==t.length)return false;var r=function(e,t,n){for(var r=0,i=t.length;r<i;r++){var s=t[r];if("object"!==typeof s&&-1!==this.getIndexByValue(e,s))return true;if(void 0!==n&&null!=s)s=s[n];if(-1!==this.getIndexByValue(e,s))return true}return false},i;if("string"==typeof e)i=[e];else i=e;for(var s=0;s<i.length;s++)if(r.call(this,i[s],t,n))return true;return false},isIncomingMessage:function(e,t){return this._getOneOfTwo(e,"Входящее",t)},isOutgoingMessage:function(e,t){return this._getOneOfTwo(e,"Я",t)},isMeToMeMessage:function(e,t){return this.isIncomingMessage(e,t)&&this.isOutgoingMessage(e,t)},isMyPerson:function(e){if(e)if("string"===typeof e)return e==g();else if(e.length)return-1!==e.indexOf(g());return false},setModelField:function(e,t,n,r){var i=this.at(n);if(i&&i.has(e)){var s=i.get(e),a;if(s instanceof Array)(a=[s[0],s[1]])[r?1:0]=t;else a=t;i.set(e,a)}else this._logError("set","Попытка установить несуществующее поле '"+t+"'")},setModelFields:function(e,t,n){var r="number"==typeof n?this.at(n):n,i={},s=false;for(var a in t)if(t.hasOwnProperty(a)){var o=t[a],l=r.get(a);if(l instanceof Array){var f=[l[0],l[1]];if(0!==e&&1!==e)throw"Wrong value of fldValueIndex parameter in setModelFields";f[e]=o,i[a]=f,s=true}else i[a]=o,s=true}if(s)r.set(i)},setModelFieldPair:function(e,t,n,r,i){var s=this.at(n);if(s&&s.has(e)){var a=s.get(e),o;if(a instanceof Array){if(o=[a[0],a[1]],void 0===i)o[r?1:0]=t;else if(r)if(s.get("СообщениеПоследнее")==i)o[1]=t;else if(s.get("Сообщение")==i)o[0]=t;else return;else o[0]=t;s.set(e,o)}else this._logError("set","Попытка установить  поле не массив '"+t+"'")}else this._logError("set","Попытка установить несуществующее поле '"+t+"'")},setListType:function(e,t){if("string"==typeof e||!h(e,["dialogs","chat","pairs","theme","msgcontact","themecontact"]))this._listType=e;else throw new Error("Invalid argument listType")},shiftMyFolder:function(e,t,n){var r=typeof t,i;if("number"!=typeof e||"string"==r&&!h(t,["up","down"])||"string"!=r&&"number"!=r||!!n&&"object"!=typeof n)this._logError("shiftMyFolder","Неправильные параметры");else if("string"==r){switch(t){case"up":if(e>0)i=e-1;break;case"down":if(e<this.getCount()-1)i=e+1}if(void 0!==i){var s=n?n:this.at(e);this.removeAt(e),this.add(s,i)}}else{var s=n?n:this.at(e);this.removeAt(e),i=t,this.add(s,this.getCount()>i?i:void 0)}},signalToRefreshTheCountersEverywhere:function(){s.notify("onNewMessage",{theme:"refresh_counters",is_chat:this.isChat()})},doBeginMessageEditing:function(e){return this.isSingleThemeMessageList()?this._callProcessMessageEdit(e,"processing"):null},doCancelMessageEditing:function(e){return this.isSingleThemeMessageList()?this._callProcessMessageEdit(e,"unprocessed"):null},doSaveEditedText:function(e,t,n){return this.isSingleThemeMessageList()?this._callProcessMessageEdit(e,"edited",t,n):null},doDeleteSentMessage:function(e){return this.isSingleThemeMessageList()?this._callProcessMessageEdit(e,"deleted"):null},doReadMyMessagesInTheme:function(e){var t=this.getIndicesByKeys(e);return null!==t?this._callReadUnreadMessages(t,"read"):null},doReadTheme:function(e){return this._readTheme(e)},doUnreadMyMessagesInTheme:function(e){var t=this.getIndicesByKeys(e);return null!==t?this._callReadUnreadMessages(t,"unread"):null},doEraseTheme:function(t,r,i,s,a){var o=this,f=o.getIndicesByKeys(t),u=t&&t.length>1,h,c={erased_themes:[],erased_messages:[],theme_folders:[],reestr:[0,4]},d=g(),p=o.isPairs(),v=o.isSingleThemeMessageList(),y=u?"СМассовоеУдалитьИзАрхива":p||a?"АТУдалитьНавсегда":"СУдалитьИзАрхива",_=function(e){return o._call(e,h).addCallback(function(){o._generateChannelMessage("АТУдалить",c)})};if(null===f||0==f.length)return null;if(r)if(u)h={"Темы":[],"Сообщения":[]};else if(p||a)h={"Тема":""};else h={"Тема":"","Сообщение":""};else h={"Темы":[]};for(var m=0,M=f.length;m<M;m++){if(o.isFolderRow(f[m]))continue;var C=o.at(f[m]),b=C.get("Тема"),w=C.get("Папка"),I=C.get(!v&&p&&C.get("СообщениеПоследнее")?"СообщениеПоследнее":"Сообщение");if(r)if(u)h["Темы"].push(b),h["Сообщения"].push(I);else if(p||a)h["Тема"]=b;else h["Тема"]=b,h["Сообщение"]=I;else{if(p)h["Темы"].push(b);else h["Темы"].push(b+","+I);var T=C.get("Раздел");if(!w&&T){var k=this.getMyFolderIndex(parseInt(T));if(null!==k)w=this.at(k).get("Папка"),C.set("Папка",w)}if(w)c.theme_folders.push(w)}var O=false;if(C.get("Я")[0]||p&&C.get("Я")[1]){if(-1===c.reestr.indexOf(3))c.reestr.push(3);O=-1!==C.get("КонтактПерсона").indexOf(d)}else O=true;if(O&&-1===c.reestr.indexOf(1))c.reestr.push(1);if(!C.get("ПрочитаноВладельцем")[0]||p&&!C.get("ПрочитаноВладельцем")[1])if(-1===c.reestr.indexOf(2))c.reestr.push(2);if(-1===c.erased_themes.indexOf(b))c.erased_themes.push(b);if(-1===c.erased_messages.indexOf(I))c.erased_messages.push(I);if(v)break}if(0==c.erased_themes.length)return null;if(0==c.theme_folders.length)delete c.theme_folders;if(r){var R=c.erased_themes.length,F=new n,P=function(){if("function"==typeof s)s();_(y).addCallbacks(function(){F.callback(arguments)},function(e){F.errback(e)})};if(c.is_archive=true,i)P();else{var S=p||a?rk("Удалить безвозвратно все сообщения в этом диалоге?"):[rk("Удалить навсегда"),R>1?R:"",R>1?e.wordCaseByNumber(R,"сообщений","сообщение","сообщения"):rk("это сообщение")].join(" ")+"?";l.question(S).addCallback(function(e){if(true===e)P();else F.errback()})}return F}else return _("АТУдалить")},doEraseFolder:function(e){return this._callFolderMethod(e,"delete","АТУдалитьПапку",{"Идентификатор":null})},doEraseItem:function(t,i,s,a,o){for(var f=this,u,h=[],g=[],c=[],d=[],p=new r,v=new n,y=function(e){if(!e)return null;var t={action:"delete",name:e.get("Название"),folder:e.get("Папка"),localInfo:{dialogscount:e.get("КоличествоЭлементов")}};if(e.get("Раздел"))t["from_hierarhy"]=[{ido:e.get("Раздел")}];return t},_=[],m=0,M=t.length;m<M;m++)if(u=f.getRecordById(t[m]),u)if(u.get("Раздел@"))d.push(t[m]),h.push(u.get("Папка")),g.push(u),_.push(y(u));else c.push(t[m]);if(c.length)p.push(f.doEraseTheme(c,i,a,null,o).addCallback(function(){return c}));if(h.length){var C=new n,b=new n,w;if(!a)if(1===h.length){var I=g[0].get("Название");if(w=e.format({name:I.length>40?I.substring(0,40)+"...":I},rk('Удалить папку "$name$s$"?')),g[0].get("КоличествоЭлементов")>0)if(!s)w+=" "+rk("Содержимое удаляемой папки будет перенесено в корень.");else w+=" "+rk("Содержимое будет перенесено в текущую папку.")}else if(w=rk("Удалить выбранные папки?"),!s)w+=" "+rk("Содержимое удаляемых папок будет перенесено в корень.");else w+=" "+rk("Содержимое будет перенесено в текущую папку.");if(w)l.question(w).addCallback(function(e){if(true===e)C.callback();else b.errback()});else C.callback();p.push(b),C.addCallback(function(){f._call("ATDeleteItem",{theme:[],message:[],folder:h,completely:false}).addCallback(function(){b.callback(d);for(var e=_.length;e--;)f._generateChannelMessage("АТУдалитьПапку",_[e])})})}if(p.getStepsCount())p.done().getResult().addCallbacks(function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n))t=t.concat(e[n]);return v.callback(t),e},function(){v.errback()});else v.errback();return v},doRenameFolder:function(e,t){return this._callFolderMethod(e,"edit","АТПереименоватьПапку",{"Идентификатор":null,"Название":t})},doMoveFolderUp:function(e){return this._callFolderMethod(e,"position","АТПереместитьПапку",{"Идентификатор":null,"НаправлениеДвижения":"up"})},doMoveFolderDown:function(e){return this._callFolderMethod(e,"position","АТПереместитьПапку",{"Идентификатор":null,"НаправлениеДвижения":"down"})},doAppendFolder:function(e){if(!e)return null;var t=this.getCurrentPathFolderUUID();return this._callFolderMethod(null,"add","АТДобавитьПапку",{"Название":e,"Папка":t?t:void 0})},_call:function(e,t){var n="Персона",r=e.indexOf(".");if(-1!=r)n=e.substr(0,r),e=e.substr(r+1);return new a({endpoint:n}).call(e,t).addErrback(this._methodCallError).addCallback(function(t){if("АТУдалить"===e){var n=t.getRow();if(n&&n.get("ДолгаяОперация"))o.channel("LongOperations").notify("onOperationStarted")}return t})},_methodCallError:function(e){l.errorMessageService(e)},_callFolderMethod:function(e,t,n,r){var i={action:t,folder:void 0,localInfo:{}},s=this,a=0;if(!t||"string"!=typeof t||!n||"string"!=typeof n||!r||"object"!=typeof r||null!=e&&!h(typeof e,["number","string"]))return null;if(e){var o=this.getRecordById(parseInt(e)),l,f;if(!o||!this.isFolderRow(o))return null;if(i.folder=o.get("Папка"),"edit"==t)i.name=r["Название"];else i.name=o.get("Название");a=o.get("КоличествоЭлементов")}else if("add"===t)if(i.name=r["Название"],r["Папка"])i.parent=r["Папка"];if(r.hasOwnProperty("Идентификатор")&&!r["Идентификатор"]&&i.folder)r["Идентификатор"]=i.folder;if(r.hasOwnProperty("НаправлениеДвижения")&&r["НаправлениеДвижения"])i.localInfo["direction"]=r["НаправлениеДвижения"];if(r.hasOwnProperty("Название")&&r["Название"])i.localInfo["name"]=r["Название"];if("delete"==i.action)if(i.localInfo["dialogscount"]=a,o.get("Раздел"))i["from_hierarhy"]=[{ido:o.get("Раздел")}];return this._call(n,r).addCallback(function(e){if(!e)return;if("add"==i.action)if(!i.folder)i.folder=e.getScalar();return s._generateChannelMessage(n,i),i})},_callProcessMessageEdit:function(e,t,r,i){var s=this.getRecordById(e);if(!h(t,["edited","deleted","processing","unprocessed"])||!s)return null;var a=s.get("Тема"),o=s.get("Сообщение"),f="СОбработатьРедактирование",u=this.isChat()?true:void 0,g=this.getRowChatSubType(s),c=this.isRowHasPrivateMsg(s),d={theme:a,msg:o,action:t,is_chat:u,changes_date:new Date,type_of_chat:g,private:c},p=this,v=new n,y={"Сообщение":o,"Тема":a,"Действие":t,"НовыйТекст":"string"==typeof r&&"edited"===t?l.getStringWithCrc32Pref(r):null};if("chat/2"!==this.getRowType(s)&&"edited"===t&&i)f="СОбработатьРедактированиеСФайлами",y["Файлы"]=i;return this._call(f,y).addCallbacks(function(e){if(e){var n=e.getRow(),r=n.get("Ошибка");if(n.has("Ошибка")&&r)return void v.errback(Error(r,r));if("edited"===t){if(d["localInfo"]={},n.get("ТекстИзменен"))d["localInfo"]["СообщениеИзменено"]=new Date,d["localInfo"]["Текст"]=n.get("ТекстСообщения");d["localInfo"]["Файлы"]=!!i}var s=n.get("УдаленныеСообщения");if("deleted"==t&&s){d["changes"]=[];for(var o=s.length;o--;)d["changes"].push({theme:a,msg:s[o],is_chat:u,type_chat:g,is_private:c})}p._generateChannelMessage(f,d)}v.callback(e)},function(e){v.errback(e)}),v},_callReadUnreadMessages:function(e,t){var n=[],r=[],i=this.isPairs(),s={folders_ido:[],folders:[],themes_info:{},action:t,changes_date:new Date},a=this.isChat(),o=this,l=this.getCurrentPathFolderUUID(),f=this.getCurrentPath(),u="unread"===t,h=u?1:-1,g=!this.isSingleThemeMessageList(),c="msgcontact"===this.getListType();if(null==e||0==e.length)return null;if(g||c)s["reestr"]=[0,1,3,4];for(var d=0,p=e.length;d<p;d++){var v=this.at(e[d]),y=v.get("Входящее"),_,m,M,C,b,w=v.get("ПрочитаноВладельцем"),I=function(e,t,n){if(!s.themes_info.hasOwnProperty(e)||s.themes_info[e].msgdate<=n)return{freshest:t,msgdate:n};return null};if(0==y.length)continue;var T=v.get("Папка"),k=parseInt(v.get("Раздел"));if(T)s.folders.push(T),s.folders_ido.push(k);else s.folders.push(null),s.folders_ido.push(null);if(_=v.get("Тема"),m=v.get("Сообщение"),b=v.get("СообщениеПоследнее"),M=null,i&&b)if(b!==m&&y[1])M=I(_,b,this.getRowDatetime(v)),n.push(_),r.push(b);if(y[0]&&(!i||!u||!b)){if(C=v.get("ДатаВремя"),C&&C.length)M=I(_,m,v.get("ДатаВремя")[0]);n.push(_),r.push(m)}if(M){var O=v.get("КоличествоНепрочитанных");if(M.is_chat=a||this.isRowHasChatMsg(v),M.type_of_chat=this.getRowChatSubType(v),!v.get("ПрочитаноВладельцем")[0]&&h<0||h>0&&v.get("ПрочитаноВладельцем")[0]&&s["reestr"]&&-1===s["reestr"].indexOf(2))s["reestr"].push(2);if(M["private"]=!M.is_chat&&this.isRowHasPrivateMsg(v),"invite_to_my_circle"===v.get("Тип"))M["invite"]={type:1};if(s.themes_info[_]){var R=s.themes_info[_].only_msgs;if(R)R.push(s.themes_info[_].freshest);else R=[s.themes_info[_].freshest];M.only_msgs=R,s.themes_info[_]=M}else s.themes_info[_]=M}}if(0==n.length||0==r.length)return null;return this._call("СОбработать",{"Сообщения":r,"Темы":n,"Действие":t,"Группа":null}).addCallback(function(e){if("ok"!==e.getScalar())return;o._generateChannelMessage("СОбработать",s)})},_readTheme:function(e){var t=[],n=[],r={folders_ido:[],folders:[],themes_info:{},action:"read",changes_date:new Date};return e.forEach(function(e){var i=this.getRecordById(e),s=i.get("Тема"),a=i.get("СообщениеПоследнее")||i.get("Сообщение");r.themes_info[s]={freshest:a,msgdate:i.get("ДатаВремя")},t.push(s),n.push(a)}.bind(this)),this._call("СПометитьПрочитанными",{"Сообщения":n,"Темы":t}).addCallback(function(){this._generateChannelMessage("СПометитьПрочитанными",r)}.bind(this))},_generateChannelMessage:function(e,t){var n=p[e];if(!e)return void this._logError("_generateChannelMessage","Wrong parameter method: "+e);if(!t||"object"!=typeof t)return void this._logError("_generateChannelMessage","Wrong parameter dataObj: "+t);if("string"==typeof n)s.doAndNotify(n,t);else if("object"==typeof n&&"function"==typeof n.dataObjectMaker&&n.event)s.doAndNotify(n.event,n.dataObjectMaker(t));else this._logError("_generateChannelMessage","Event object is not found for "+e)},_logError:function(e,n){t.resolve("ILogger").error(e,n)},_getOneOfTwo:function(e,t,n){var r=this.at(e);if(!r)return;var i=r.get(t);if(!i)return;if((false===n||true===n)&&this.isPairs()){if(!n)return i[0];if(i.length>1)return i[1];else return}return i[0]}}),u=function(e,t){for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n]},h=function(e,t){return Array.indexOf(t,e)>=0},g=function(){return l.getUserId()},c=function(e){return"object"==typeof e&&"function"==typeof e.addBoth},d="find wrong result object",p={"СОбработатьРедактирование":{event:"onChangeMessage",dataObjectMaker:function(e){var t={changes_date:e.changes_date,state:e.action,user:g(),localInfo:e.localInfo};return t["changes_for"]=e.changes?e.changes:[{theme:e.theme,msg:e.msg,is_chat:e.is_chat,text:e.localInfo?e.localInfo["Текст"]:void 0,type_chat:e.type_of_chat,is_private:e.private}],t}},"СОбработать":{event:"onChangeThemes",dataObjectMaker:function(e){var t=void 0,n={datetime:e.changes_date,changed_themes:[],state:e.action,user:g(),folders:e.folders&&e.folders.length?e.folders.slice():[],reestr:e.reestr};for(var r in e.themes_info)if(e.themes_info.hasOwnProperty(r)){var i=e.themes_info[r],s={id:r,msg:i.freshest,chat:i.is_chat,type_chat:i.type_of_chat,is_private:i.private,invite:i.invite};if(i.invite&&!t)t=i.invite;if(i.only_msgs)s["only_msgs"]=i.only_msgs.slice();["chat_dif","dialog_dif"].forEach(function(e){if(i.hasOwnProperty(e))s[e]=i[e]}),n.changed_themes.push(s)}return n.invite=t,n}},"АТУдалить":"onDeleteTheme","АТУдалитьПапку":"onChangeFolder","АТПереименоватьПапку":"onChangeFolder","АТПереместитьПапку":"onChangeFolder","АТДобавитьПапку":"onChangeFolder"};return p["СОбработатьРедактированиеСФайлами"]=p["СОбработатьРедактирование"],p["СПометитьПрочитанными"]=p["СОбработать"],f});
//# sourceMappingURL=MessageList.module.js.map
define("js!SBIS3.Contacts.Controllers.ListOfMessagesController",["Core/core-instance","Core/Context","Core/IoC","Core/EventBus","Core/Deferred","Core/helpers/Function/debounce","Core/Abstract","js!SBIS3.Contacts.MessagesExchangeEvents","js!SBIS3.Contacts.Controllers.ListOfMessagesEventHandlers","js!SBIS3.Contacts.Collections.ListOfMessages","js!WS.Data/Source/SbisService","js!WS.Data/Query/Query","js!WS.Data/Collection/IBind","js!SBIS3.Contacts.CoreMiniFunctions","js!WS.Data/Format/DateTimeField","js!WS.Data/Chain","js!WS.Data/Collection/RecordSet","Core/helpers/generate-helpers","Core/core-merge","is!browser?js!SBIS3.Contacts.CoreMiniFunctions/string.format","i18n!SBIS3.Contacts.Controllers.ListOfMessagesController"],function(e,t,i,s,r,n,a,o,l,f,g,h,d,u,c,p,m,v,y){"use strict";var _=[],w={};for(var C in l)if(l.hasOwnProperty(C)&&0===C.indexOf("on")){var I=String(C).toLowerCase();_.push(I),w[I]=l[C]}l=y(l,w);var b=a.extend({_moduleName:"SBIS3.Contacts.Controllers.ListOfMessagesController",$protected:{_options:{listType:"",view:null,noProcessLocalNewMessagesContext:void 0,noSubscribe:false,nameMethodBL:"СписокСообщенийДляListView"},_view:null,_list:null,_listType:"",_source:null,_stopNextEventProc:{},_seqRefreshParams:[],_waitingEditFilters:[],_newMessageDateTimeForRequest:null,_slower:0,_metaInfoLastMessageDate:{},_bindedEventHandlers:{onLoad:null,onMerge:null,onSync:null,onItemChange:null,onDraw:null,onEndEdit:null,onBeforeCall:null},_changedItems:{remove:[],add:[]},_movedItems:{},_pageLoadItemsIdArray:[],_clientFields:[{name:"ТекстДляРедактирования",type:"string"},{name:"ТекстДляОтвета",type:"string"},{name:"IsHidden",type:"boolean"},{name:"hideFadeMask",type:"object"},{name:"ФайлыПодписаниеПоГруппам",type:"object"},{name:"ФайлыПодписаниеПоГруппам2",type:"object"},{name:"UnviewedDialogUpdDate",type:"string"}],_personActivity:null,personActivityConstructor:null,_notActiveSignRequest:{}},$constructor:function(e){if(this._bindFunctions(),this._publish("onDoRegistryRefresh","onBeforeMergeByFilter"),"listType"in e&&e.listType)this.setListType(e.listType);if("view"in e&&e.view)if("function"==typeof e.view.getDataSource&&e.view.getDataSource())this.setLinkedView(e.view);else throw new Error("property view with configurated DataSource must be specified");if(this._stopNextEventProc={},this._seqRefreshParams=[],!this._options.noSubscribe)_.forEach(function(e,t,i){this.subscribeTo(o,e,this._handleEvent.bind(this))},this),this.subscribeTo(s.channel("ticker"),"onTickSlow",this._handleTick.bind(this));this.once("onDestroy",function(){if(this._personActivity)this._personActivity.destroy(),this._personActivity=null;this._view=null,this._list=null,this._notActiveSignRequest=null})},_bindFunctions:function(){this._bindedEventHandlers.onLoad=this._afterDataLoad.bind(this),this._bindedEventHandlers.onMerge=this._afterDataMergeCorrections.bind(this),this._bindedEventHandlers.onSync=this._onCollectionChangeHandler.bind(this),this._bindedEventHandlers.onItemChange=this._onCollectionItemChangeHandler.bind(this),this._bindedEventHandlers.onDraw=n(this._onDrawItemsHandler.bind(this),250),this._bindedEventHandlers.onEndEdit=n(this._onEditEnd.bind(this),50),this._bindedEventHandlers.onBeforeCall=this._beforeBLcall.bind(this)},setPersonActivityConstructor:function(e){this._personActivityConstructor=e},addThemeAfterFolder:function(e,t,i){var s=this.getList(),r=s.isNewestDown(),n,a,o=null,l=-1,f=s.getRowDatetime(e);if(f)if(r){for(n=s.getCount()-1;n>=0;n--)if(s.getRowDatetime(n)<f){if(n==s.getCount()-1)s.add(e);else s.add(e,n+1);break}if(n<0)s.add(e,0)}else{var g=s.getRowFolder(e);for(n=0,a=s.getCount();n<a;n++)if(o=s.getRowFolder(n),s.isFolderRow(n)){if(o==g)l=n}else if(s.getRowDatetime(n)<=f){s.add(e,n);break}if(n==a)if(-1!==l)s.add(e,l+1);else if(parseInt(e.get("Раздел"))===t)s.add(e)}},getControllerSource:function(){return this._source},getList:function(){return this._view?this._view.getItems():null},getRegistryType:function(){var e=this.getFilter()["Реестр"];return e>=0&&e<=4?e:null},getFilter:function(){var e=this._view.getFilter();return"object"!=typeof e?{}:e},getListType:function(){return this._listType},getMetaInfoLastMessageDate:function(e){var t=e;if(void 0===t){var i=this.getList().getCurrentPath();t=null==i?null:i.get("ИдО")}return this._metaInfoLastMessageDate[t]},getNearbyRecord:function(e,t){var i=this.getView(),s=this.getList(),r=i&&i[t?"getNextItemById":"getPrevItemById"](e.getId());return r&&s&&s.getRecordById(r.attr("data-id"))},getView:function(){return this._view},interfaceRowUninsert:function(e,t,i,s){var r=this.getList();if(r&&r.getCount()){var n=r.getRecordById(t),a=r.getRecordById(e),o=false;if(a)r.remove(a);if(n){var l="string"==typeof i,f=l?i:"";if(n.set("ДляИнтерфейса",f),l&&!s||!i)this.getView().redrawItem(n);o=true}return o}return false},interfaceRowInsert:function(e,t,i,s,r){var n=this.getList(),a,o,l,f,g="ДляИнтерфейса",h="СкрытьЗапись",d,u=void 0===r?true:!!r;if(null==n||-1==(l=n.getFreshestIndex())||null==(a=n.getRecordById(i))||null==(o=n.getIndexByValue("Сообщение",a.get("Сообщение")))||void 0===t)return null;if("string"==typeof s)h=s;else if(void 0!==s)u=!!s;if(d=n.getIdProperty(),f=new(n.getModel())({adapter:"adapter.sbis",rawData:a.getRawData(),idProperty:d}),f.set(d,e),f.set(g,t),a.set(g,h),u)this.getView().redrawItem(a);return n.add(f,o),n.at(o)},isArchive:function(){return"dialogs"==this.getListType()&&4==this.getRegistryType()},isDialogs:function(){return false},isThemesList:function(){var e=this.getListType();return"dialogs"==e&&4!=this.getRegistryType()||"pairs"==e||"invite"===e},isLoadableUp:function(){return M(this.getListType(),["msgcontact","pairs","chat","theme"])},isLocalNewMessageBLCallBlocked:function(){if(this._options.noProcessLocalNewMessagesContext)return true===this.getLinkedContext().getValue(this._options.noProcessLocalNewMessagesContext);return false},isUnreads:function(){return"dialogs"==this.getListType()&&2==this.getRegistryType()},isWithFolders:function(){return"dialogs"===this.getListType()&&this.isDialogs()&&e.instanceOfMixin(this.getView(),"SBIS3.CONTROLS.TreeViewMixin")},isViewInFolder:function(e){var t=this.getView(),i=t.getItems().getMetaData().path;if(i&&t.getCurrentRoot()){var s="Папка";if(parseInt(e)>0&&("number"==typeof e||"string"==typeof e&&-1==e.indexOf("-")))s="ИдО";for(var r=0,n=i.getCount();r<n;r++)if(i.at(r).get(s)==e)return n-r-1}return null},isViewInRoot:function(){return null==this.getView().getCurrentRoot()},mergeByFilter:function(e,t){if(e&&t&&e.length>=t.length&&t.length>0){var i=this.getList(),s=void 0;if(!i)return;var r=i.isSingleThemeMessageList(),n=i.isPairs(),a=i.isChat(),o=i.isAnySingleMessage(),l=this.isWithFolders(),g=this.isArchive(),h="msgcontact"==this.getListType(),d,u,c=r&&this.getFilter()["Тема"],p=false,m="Обработка записей результата",v=this,y=function(e,t){if(p)i.eventsObserving(true),p=false;i.replace(e,t)},_=function(e){return v._appendClientsFields(e),v._fillSignatureFileInfo(e),new(i.getModel())({adapter:"adapter.sbis",rawData:e.getRawData(),idProperty:i.getIdProperty(),format:i.getFormat()})};try{this._notify("onBeforeMergeByFilter",{selectors:e,results:t});for(var w=0,C=e.length,I=t.length;w<C&&w<I;w++){var b=e[w],S=t[w],M;if(!S)continue;if("string"==typeof S)this._logError("mergeByFilter","ошибка:"+S);else if("object"==typeof S){var F;if(S.hasOwnProperty("error")&&S.error){var L;if(S.error.hasOwnProperty("details"))L=S.error.details;if(!L&&S.error.hasOwnProperty("message"))L=S.error.message;if(!L)L=JSON.stringify(S.error);i._logError("mergeByFilter","ошибка:"+L);continue}else if(S.hasOwnProperty("result")&&S.result)F=S.result;else if(S.hasOwnProperty("skip_result")&&S.skip_result)continue;else F=S;if(F&&"function"==typeof F.getAll){var E=F.getAll(),R=E.getCount();if(!p&&!b.strictReplace)p=true,i.eventsObserving(false);else if(b.strictReplace&&p&&!b.append)p=false,i.eventsObserving(true);if(0===R){if(b.theme||b.msg||b.folder){if(r&&b.msg)if(M=i.getMySingleMessageIndex(b.msg),null!==M){i.removeAt(M);continue}if(!r&&b.theme){if(h&&b.msg)M=i.getMySingleMessageIndex(b.msg);else M=i.getMyThemeIndex(b.theme);if(null!==M){i.removeAt(M);continue}}if(b.folder&&l&&!b.theme)if(M=i.getMyThemeIndex(b.theme),null!==M){i.removeAt(M);continue}}continue}else this._appendClientsFields(E);if(r&&R>1&&b.append&&b.datefrom&&i.isNewestDown()){var D=[],T=new f({adapter:E.getAdapter(),format:E.getFormat(),model:E.getModel(),idProperty:E.getIdProperty(),listType:this.getListType()}),O=i.getFreshestIndex(),P=O>=0?i.getRowDatetime(O):null,A;for(d=R-1;d>=0;d--){if(u=_(E.at(d)),c&&u.get("Тема")!==c){this._logMsg("mergeByFilter","Из полученных по дате "+R+" записей обнаружена другая тема, записи отброшены"),T.clear(),D=[],R=0;break}if(A=i.getRecordById(u.getId()),A){if(A.get("IsServiceTypeChat")&&(A.get("IsGroupTitle")||A.get("Text")!==u.get("Text")))T.add(u);continue}if(null==P||P<=b.datefrom){if(a)this._checkRowForServiceMessageEssentials(u);D.push(u)}else{if(null==i.getMySingleMessageIndex(u.get("Сообщение")))if(i.getRowDatetime(u)>P){D.push(u);continue}T.add(u)}}if(0!==D.length)i.append(D);else if(R>0)if(this._logMsg("mergeByFilter","Из полученных по дате "+R+" записей ни одной не добавлено в конец, а должно было."),this._logMsg("Фильтр:",JSON.stringify(b)),0==document.location.pathname.indexOf("/debug"))E.each(function(e){this._logMsg("Сообщение:",e.get("Сообщение")),this._logMsg("Текст:",e.get("Текст")[0]),this._logMsg("ДатаВремя:",e.get("ДатаВремя")[0])},this);if(R=T.getCount(),0===R)continue;E=T}for(d=0;d<R;d++){if(u=_(E.at(d)),(b.folder||true===b.only_folders)&&l){if(i.isFolderRow(u))M=i.getMyFolderIndex(u.get("ИдО"));else if(null!==i.getMyFolderIndex(b.folder))if(b.hasOwnProperty("theme")&&b.theme)M=i.getMyThemeIndex(b.theme)}else if(r&&b.hasOwnProperty("msg")&&b.msg)M=i.getMySingleMessageIndex(b.msg);if(a)this._checkRowForServiceMessageEssentials(u);if(!r&&b.hasOwnProperty("theme")&&b.theme){if(M=-1,o)if(b.hasOwnProperty("msg")&&b.msg){var B=i.getMySingleMessageIndex(b.msg);if(null!==B)M=B;else if(g&&!b.append)b.append=true}if(!g&&!h&&-1===M)M=i.getMyThemeIndex(b.theme)}if(-1!=M&&null!=M){var q=true;if(o){if(0!=M&&l)q=i.isFolderRow(u)}else if(n)q=false;var k=i.at(M);if(i.isFolderRow(u)&&q){k.set({"КоличествоНепрочитанных":u.get("КоличествоНепрочитанных"),"КоличествоЭлементов":u.get("КоличествоЭлементов"),"Название":u.get("Название"),"ПорНомер":u.get("ПорНомер")});continue}if(u.set({"ДляИнтерфейса":k.get("ДляИнтерфейса"),"ДокументФаза":k.get("ДокументФаза"),hideFadeMask:k.get("hideFadeMask"),"ДокументФазаИконка":k.get("ДокументФазаИконка")}),a)this._saveChatServiceOptions(u,k);if(q){y(u,M);continue}else i.removeAt(M),M=-1,b.append=true,b.skipDiagnostics=true}if(b.append){var x=i.getRecordById(u.getId()),H=null;if(x||(H=i.getMyMessageIndex(u))){if(r){var N=x.get("КоличествоПолучателей"),V=u.get("КоличествоПолучателей");if(N.length&&V.length&&N[0]!=V[0]){if(null==H)H=i.getMyMessageIndex(u);if(null!==H)this._saveChatServiceOptions(u,i.at(H.index)),y(u,H.index)}}continue}if(!b.skipDiagnostics&&b.theme&&b.msg&&(u.get("Тема")!=b.theme||u.get("Сообщение")!=b.msg&&(!u.get("СообщениеПоследнее")||u.get("СообщениеПоследнее")!=b.msg))){this._logError("mergeByFilter","Диагностика: запрошено было конкретное сообщение "+b.msg+" по теме "+b.theme+", а из БЛ пришло "+u.get("Сообщение")+" по "+u.get("Тема"));continue}var j;if(i.isFolderRow(u)){if(this.isWithFolders()){var U=i.getMyFolders();if(U.length>0)j=Math.max.apply(Math,U)+1,i.add(u,j);else i.add(u,0)}}else{if(void 0===s)s=i.getCurrentPathFolderUUID();if(!r||u.get("Тема")==c)this.addThemeAfterFolder(u,s,["dialogs","invite"].indexOf(this.getListType())>=0&&(this.getFilter()["Поиск"]||this.getFilter()["ПоискПерсоны"]))}}}}else this._logError("mergeByFilter "+m,JSON.stringify(F))}else this._logError("mergeByFilter "+m,JSON.stringify(S))}}catch(e){this._logError("mergeByFilter exception",e.toString())}if(i&&p)i.eventsObserving(true)}},refreshEachSequentially:function(e,t,i,s){if(e instanceof Array&&e.length){var n=new r,a=false,o=e.slice(),l,f,g=[];if(0===this._seqRefreshParams.length)a=true;for(var f=e.length;--f>=0;)if((y=e[f])&&y.hasOwnProperty("delayedListUpdateAfterLast")){if(!y.delayedListUpdateAfterLast||!y.hasOwnProperty("datefrom")||!y.datefrom)return this._logError("refreshEachSequentially","неправильный фильтр c delayedListUpdateAfterLast"+JSON.stringify(y)),null;if(!this._newMessageDateTimeForRequest||this._newMessageDateTimeForRequest>y.datefrom){if(!l)l=this.getList();var h=l.getFreshestIndex(true);if(h>=0){var d=l.at(h);this._withSeparatorHandled=d.get("IsGroupTitle")&&d.get("IsHiddenRow"),this._newMessageDateTimeForRequest=l.getRowDatetime(d)}else this._newMessageDateTimeForRequest=y.datefrom}o.splice(f,1)}if(o.length){for(var u=this._seqRefreshParams.length;--u>=0;)for(var c=this._seqRefreshParams[u].filters,p=c.length;--p>=0;){var m=c[p],v=false;for(f=o.length;--f>=0;){var y=o[f];v=false;for(var _ in y)if(m.hasOwnProperty(_)||y.hasOwnProperty(_)){var w=m[_],C=y[_];if("boolean"===typeof w||"boolean"===typeof C)v=true===w&&true!=C||true!=w&&true===C;else if(w&&C&&"function"==typeof w.getTime&&"function"==typeof C.getTime)v=w.getTime()!=C.getTime();else v=w!=C;if(v)break}if(!v)g.push(f)}}for(u=g.length;u--;)o.splice(g[u],1);if(o.length){if(this._seqRefreshParams.push({filters:o,doneCall:n,results:[],needReload:i,needRedraw:s}),a)this._performBLQuery(0);return n}}}return null},refreshEachSequentiallyNewMessageToEnd:function(e){var t=this.refreshEachSequentially([{delayedListUpdateAfterLast:true,append:true,datefrom:e}],"onNewMessage");if(t)t.addCallback(this._refreshEachSequentiallyCallback.bind(this))},refreshEachSequentiallyByPeriod:function(e,t,i){var s=1,r=30,n,a=function(i){var s=this.refreshEachSequentially([{append:true,datefrom:e,dateto:t,with_separator:false,by_page:r,offset_page:i}],"onNewMessage");if(s)s.addCallback(this._refreshEachSequentiallyCallback.bind(this));return s}.bind(this),o=function(e){if(!isNaN(n)&&n/r<s&&e.result&&e.result[0]&&e.result[0].result&&e.result[0].result.getProperty("n")){var t=a(n+=r);if(t)t.addCallback(o)}};if(i&&i>0)s=Math.ceil(i/r);if(s>1)n=0;var l=a(n);if(l)l.addCallback(o);return l},saveFastAnswerStateIfVisible:function(){var e=this.getView();if(u.hasViewFastAnswer(e)){var t=e.getChildControlByName("FastAnswer");if(t.isVisible())t.saveText()}},setListType:function(e,t){if("string"==typeof e||!M(e,["dialogs","chat","pairs","theme","msgcontact","themecontact","invite"])){if(true!==t)this.stopRefreshingSequentially();this._listType=e,this._setListTypeInFilter()}else throw new Error("Invalid argument listType")},setLinkedView:function(e){if(!e||"function"!=typeof e.getDataSource||!e.getDataSource())throw new Error("Invalid argument linkedView");var t=this._view,i=this._bindedEventHandlers;if(t){this._waitingEditFilters=[],this.stopRefreshingSequentially(),this.unsubscribeFrom(t,"onDataLoadError",u.onDataLoadError),this.unsubscribeFrom(t,"onDataLoad",i.onLoad),this.unsubscribeFrom(t,"onDataMerge",i.onMerge),this.unsubscribeFrom(t,"onChangeHoveredItem",this._onChangeHoveredItemHandler),this.unsubscribeFrom(t,"onDrawItems",i.onDraw);var s=t.getItems();if(this.unsubscribeFrom(t,"onAfterEndEdit",i.onEndEdit),s)this.unsubscribeFrom(s,"onBeforeProviderCall",i.onBeforeCall),this.unsubscribeFrom(s,"onCollectionChange"),this.unsubscribeFrom(s,"onCollectionItemChange")}this.subscribeTo(e,"onDataLoadError",u.onDataLoadError),this.subscribeTo(e,"onDataLoad",i.onLoad),this.subscribeTo(e,"onDataMerge",i.onMerge),this.subscribeTo(e,"onChangeHoveredItem",this._onChangeHoveredItemHandler),this.subscribeTo(e,"onDrawItems",i.onDraw),this.subscribeTo(e,"onAfterEndEdit",i.onEndEdit);var r=this.getListType(),n="pairs"==r,a="dialogs"==r,o="invite"===r;if("chat"==r||n||o||"theme"==r&&(1==e._options.showPhoto||2==e._options.showPhoto))if(this._personActivityConstructor)this._personActivity=new this._personActivityConstructor({view:e,personGUIDGetter:function(){var e,t=this.get("Тема");if(!this.get("КонтактПерсона"))return null;if(n)if(t&&t.indexOf("_expanded")>-1)e=[null,null];else e=[this.get("PhotoLink")&&this.get("КонтактПерсона")[0],this.get("PhotoLink1")&&this.get("КонтактПерсона")[1]];else e=a||o||this.get("PhotoLink")?this.get("КонтактПерсона")[0]:null;return e},isDual:n});this._view=e;var l=e.getDataSource();if(this._source=new g({endpoint:l.getEndpoint(),idProperty:l.getIdProperty(),model:l.getModel(),binding:{query:l.getBinding().query}}),"chat"!=r&&"theme"!=r)this.subscribeTo(l,"onBeforeProviderCall",i.onBeforeCall);this._setListTypeInFilter()},setMetaInfoLastMessageDate:function(e){var t=e?e.getMetaData():null,i=t?t.results:null,s=i&&i.has("ДатаПоследнего")?i.get("ДатаПоследнего"):null,r=t.path?t.path.getCount():0,n=r?t.path.at(r-1).get("ИдО"):null;this._metaInfoLastMessageDate[n]=s},signalToRefreshTheCountersEverywhere:function(){var e=this.getList();if(e)e.signalToRefreshTheCountersEverywhere();else this._logError("signalToRefreshTheCountersEverywhere","список не определен, возможно в контроллер не задано представление данных")},stopRefreshingSequentially:function(){for(var e=0,t=this._seqRefreshParams.length;e<t;e++)try{var i=this._seqRefreshParams[e].doneCall;if(!i.isReady())i.errback("stopRefreshingSequentially")}catch(e){}this._seqRefreshParams=[]},reloadListRow:function(e){var t={strictReplace:true},i=this.getList();if(!i||0==i.getCount())return false;if(null!=e&&"object"!=typeof e||"function"==typeof e.get)e=i.getRecordById(e);if(!e)return false;if("object"==typeof e&&"function"==typeof e.get){if(e.get("Раздел@"))t["folder"]=e.get("Папка");else{if(!i.isPairs(e))t["msg"]=e.get("Сообщение");t["theme"]=e.get("Тема")}var s=this.refreshEachSequentially([t],"reloadListRow");if(s)return s.addCallback(this._refreshEachSequentiallyCallback.bind(this)),true}return false},_saveChatServiceOptions:function(e,t){if(e&&t)e.set({IsHiddenRow:t.get("IsHiddenRow"),GroupId:t.get("GroupId"),SeparatorName:t.get("SeparatorName")})},fillDefaultFormat:function(e){for(var t=this._getClientFields(),i={"СлужебныйОбъект":["{}",null]},s=0;s<t.length;s++)if(-1==e.getFieldIndex(t[s].name))e.add(t[s]);for(var r=0;r<e.getCount();r++){var n=e.at(r),a=n.getName(),o=n.getType(),l=n.getDefaultValue();if("array"==o)if(i.hasOwnProperty(a)&&l!=i[a])n.setDefaultValue(i[a]);else if(null==l)n.setDefaultValue([null,null])}return e},_getClientFields:function(){return this._clientFields.slice()},_appendClientsFields:function(e){if(e=u.appendClientFieldsToRS(this._getClientFields(),e),this._personActivity)this._personActivity.appendClientsFields(e)},_fillSignatureFileInfo:function(e,t){if(this._fillSignatureFile(e,t),e.isPairs&&e.isPairs()||!e.isPairs&&e.at&&(new f).isPairs(e.at(0)))this._fillSignatureFile(e,t,true)},_convertSigns:function(e){var t=[],i=function(e){if(e&&e.length>0)return e[0]+".";else return""},s=true,r=false;return new p(e).toArray().forEach(function(e){var n=e.get("Данные"),a=e.get("Персона"),o=u.isCurrentPerson(a);if(o!==r)r=o,s=true;if(n)t.push({person:a,company:{name:n["Организация"],inn:n["ИНН"]},name:e.get("Фамилия")+" "+i(e.get("Имя"))+" "+i(e.get("Отчество")),nameFor:n["Фамилия"]+" "+i(n["Имя"])+" "+i(n["Отчество"]),fromMe:o,needIcon:s});else t.push({person:a,company:{name:e.get("КлиентНазвание"),inn:null},name:e.get("Фамилия")+" "+i(e.get("Имя"))+" "+i(e.get("Отчество")),nameFor:e.get("Фамилия")+" "+i(e.get("Имя"))+" "+i(e.get("Отчество")),fromMe:o,needIcon:s});s=false}),t},_fillSignatureFile:function(t,i,s){var r=s?"2":"",n=s?1:0,a=this,o=null,l=["for_sign","not_sign","sign","for_first_sign","for_second_sign"];if(!a._notActiveSignRequest)a._notActiveSignRequest={};if(t.isSingleThemeMessageList)o=t.isSingleThemeMessageList();var f=function(e,i){if(!e||!(e.get("СлужебныйТип")&&e.get("СлужебныйТип")[n]))return;var s=e.get("ФайлыДляПревью"+r),f=e.get("СлужебныйТип")[n],g=e.get("СлужебныйОбъект");if(s&&g){var h=JSON.parse(g[n]),d=s.at(0)&&s.at(0).get("msgFileId"),u=e.get("ОтветНаСообщение"),c=!(e.get("Входящее")[0]||e.get("Я")[0]),p=s.getCount();if(!c&&("not_sign"===f||"sign"===f))if(d)a._notActiveSignRequest[d]=true;else a._notActiveSignRequest[u]=true;if(c||a._notActiveSignRequest[d])h.hideBorders=true;else if(a._notActiveSignRequest[e.get("Сообщение")])h.hideBorders=true,a._notActiveSignRequest[d]=true;if(!c&&"for_second_sign"===f)a._notActiveSignRequest[d]=true;if(o&&"object"===typeof e.get("СлужебныйТип")&&"sign"===e.get("СлужебныйТип")[n]&&t.at&&t.at(i+1)&&l.indexOf(t.at(i+1).get("СлужебныйТип")[n])>=0)e.set("ФайлыПодписаниеПоГруппам",null),h.serviceMessage="Документы подписаны(количество - "+p+")";else{var y=new m({adapter:s.getAdapter()}),_={},w=null;if(s.each(function(e){if(y.getCount()<3&&(null==w||w==e.get("ИдРазделителя")))y.add(e),w=e.get("ИдРазделителя");else{var t=y.at(0),i=t.get("Подписи");_[v.createGUID()]={filesRawData:y.getRawData(),redactionId:t.get("redactionId"),filesCount:y.getCount(),signatures:i?a._convertSigns(i):null},y.clear(),y.add(e),w=e.get("ИдРазделителя")}}),y.getCount()>0){var C=y.at(0),I=C.get("Подписи");_[v.createGUID()]={filesRawData:y.getRawData(),redactionId:C.get("redactionId"),filesCount:y.getCount(),signatures:I?a._convertSigns(I):null}}if(!Object.isEmpty(_))e.set("ФайлыПодписаниеПоГруппам"+r,_)}g[n]=JSON.stringify(h),e.set("СлужебныйОбъект",g)}};if(e.instanceOfModule(t,"WS.Data/Entity/Record"))f(t);else if(e.instanceOfModule(t,"WS.Data/Collection/RecordSet"))t.each(f);else if("function"==typeof t.forEach)t.forEach(f)},_prepareAndCallMethod4Collected:function(t,i,s,r,n,a){var o=null,l={getForItems:[],itemsIndices:{}},f=function(e,t,i){i.forEach(function(i){if(!e.has(i.name))t.addField(i)})},h=function(e,t){var i=s(e);if(this.addFlds&&this.addFlds.length)f(e,e,this.addFlds);if(void 0!==i){var r=this.collector.itemsIndices[i];if(!r)this.collector.getForItems.push(i),this.collector.itemsIndices[i]=[t];else r.push(t)}};if(!t||"function"!=typeof s||"function"!=typeof a||!r||"string"==typeof r&&2!=(o=r.split(".")).length||"object"==typeof r&&!("string"==typeof r.contract&&2==(o=r.contract.split(".")).length)||"function"!=typeof n)return this._logError("_prepareAndCallMethod4Collected","неверные параметры"),false;try{if("function"==typeof t["each"]){if(0==t.getCount())return false;if(i&&i.length)f(t.at(0),t,i);t.each(h.bind({collector:l}))}else t.forEach(h.bind({collector:l,addFlds:i}))}catch(e){this._logError("_prepareAndCallMethod4Collected",e.stack)}if(l.getForItems.length){var d="string"==typeof r?o[0]:{},u=n(l.getForItems),c,m=e.instanceOfModule(t,"WS.Data/Entity/RecordSet")?new p(t):null;if("object"==typeof r&&r.address)d["address"]=r.address,d["contract"]=o[0];(c=new g({endpoint:d})).call(o[1],u).addCallback(function(e){var t=e.getAll(),i=this.controller.getView(),s=this.controller.getList();if(0!=t.getCount()&&s&&0!=s.getCount()){s.eventsObserving(false);try{a.call(this.controller,t,this.ids,this.items)}catch(e){this.controller._logError("_prepareAndCallMethod4Collected",e.stack)}s.eventsObserving(true)}}.bind({controller:this,ids:l.itemsIndices,items:m?m.toArray():t}))}return false},_collectDocInfo:function(e){var t=function(e){if(!e.get("Раздел@")){var t=e.get("ДокументПк"),i=e.get("ДокументИдТипа");if(t&&(0===i||"0"===i||1==i||4==i)&&!e.get("ДокументФаза")&&!e.get("ДокументФазаИконка")&&s.indexOf(e.getId())<0)return t}return},i=function(e){for(var t=new Array(e.length),i=0,s=t.length;i<s;i++)t[i]=null;return{"Документы":e,"События":t}},s=this._pageLoadItemsIdArray;this._prepareAndCallMethod4Collected(e,null,t,"Документ.ИнформацияОСостоянииДокументов",i,this._processCollectedDocPhases)},_processCollectedDocPhases:function(t,i,s){if(s&&s.isDestroyed&&s.isDestroyed())return;if(e.instanceOfModule(s,"WS.Data/Collection/RecordSet")){var r=new p(s);s=r.toArray()}var n={items:[]},a=this.getList(),o=s.length;if(!a||!a.getCount())return n.items;return t.each(function(e){var t=e.get("@Документ"),r=i[t],n,l,f,g="",h=[];if(r&&r.length)if(n=e.get("ИнформацияОСостоянии"),n)if(l=n.get("СостояниеДокумента"),f=l.get("ПоследнийЗначимыйПереход"),n.get("ТекущаяФаза")||f){var d=n.get("ТекущаяФаза")?n.get("ТекущаяФаза").get("Название"):"";if(f){var u=f.get("Статус"),c="no-icon";if(2===u)c="icon-Unsuccess icon-error";else if(1===u)c="icon-Successful icon-done";else{var p=l.get("СостояниеКраткое");if(Array.indexOf([19,20,22],p)>-1)c="icon-Close icon-disabled";else if(7==p)c="icon-Successful icon-done";else if(9==p)c="icon-Unsuccess icon-error";else if(10==p)c="icon-Refresh icon-disabled"}h.push(c)}else if(l.get("Приостановлен"))h.push("icon-Pause icon-disabled");else h.push("icon-Refresh icon-disabled");g=h.join(" ");for(var m=r.length;m--;){var v=r[m];if(v<o){var y=s[v],_=a&&a.getRecordById(y.getId());if(y=_?_:y,y.get("ДокументФаза")!==d)y.set({"ДокументФаза":d,"ДокументФазаИконка":g})}}}}),n.items},_performBLQuery:function(e){function t(e){var t=this.so,i=this.cnt,s=this.err?{error:e}:{result:e};t.results.push(s),i._performBLQuery(t.results.length)}var i={},s=false,r=false,n=this.getView();while(this._seqRefreshParams.length>0){var a=this._seqRefreshParams[0],o,l=false;if(a.needReload)s=true;if(a.needRedraw)r=true;if(L(a.doneCall)){if(a.filters instanceof Array&&0==a.filters.length)this._logError("_performBLQuery","В параметрах запроса на обновление не указан массив фильтров"),l=true;if(e>=a.filters.length)a.doneCall.callback({filter:a.filters,result:a.results}),l=true}else this._logError("_performBLQuery","В параметрах запроса на обновление не указан cDeferred"),l=true;if(l){this._seqRefreshParams.splice(0,1),e=0;continue}if(S(this.getFilter(),i),o=a.filters[e],o.hasOwnProperty("theme")&&o.theme)if(i.hasOwnProperty("Тема")&&i["Тема"]!=o.theme){this._logMsg("_performBLQuery","В списке с постоянным фильтром темы='"+i["Тема"]+"' попытка обновиться по фильтру темы='"+o.theme+"' не будет выполнена, и это правильно !"),a.results.push({skip_result:true}),e++;continue}else i["Тема"]=o.theme;if(i.hasOwnProperty("БлокиГруппСвернуты")&&"Б"==i["БлокиГруппСвернуты"])i["БлокиГруппСвернуты"]="";var f=this.getListType();if(!i.hasOwnProperty("ТипСписка")||f!=i["ТипСписка"])if(""!=f&&""==i["ТипСписка"])i["ТипСписка"]=f;else if(""==f&&""==i["ТипСписка"])this._logError("_performBLQuery","Обращение к списокному методу без установки типа списка");if(o.hasOwnProperty("msg")&&o.msg)i["Сообщение"]=o.msg;if(o.hasOwnProperty("root"))i["Раздел"]=o.root;if(o.hasOwnProperty("ignore_reg")&&o.ignore_reg&&i.hasOwnProperty("Реестр"))i["Реестр"]=0;if(o.hasOwnProperty("folder")&&o.folder)i["Папка"]=o.folder;if(o.only_folders)i["ВидДерева"]="Только узлы";if(o.hasOwnProperty("datefrom")&&o.datefrom)i["ДатНач"]=o.datefrom;if(o.hasOwnProperty("dateto")&&o.dateto)i["ДатКнц"]=o.dateto;if(o.hasOwnProperty("with_separator"))i["ГруппироватьСлужебные"]=!!o.with_separator;else i["ГруппироватьСлужебные"]=false;if(i.hasOwnProperty("СмещениеОтДаты"))delete i["СмещениеОтДаты"];if("Только узлы"===i["ВидДерева"])i["Разворот"]="С разворотом";var g=new h,d=o.by_page,u=o.offset_page;if(g.where(i),d&&u>=0)if(g.limit(d),u)g.offset(u);if(o.hasOwnProperty("record_limit")&&o.record_limit>0)g.limit(o.record_limit);if(void 0===g.getLimit())g.limit(30);if(this._source.query(g).addCallbacks(t.bind({cnt:this,so:this._seqRefreshParams[0],err:false}),t.bind({cnt:this,so:this._seqRefreshParams[0],err:true})),n)if(s)n.reload();else if(r)n.redraw();return}if(n)if(s)n.reload();else if(r)n.redraw()},_checkProcessedAbove:function(e,t){if(t.is_chat&&!this.getList())return this._view.reload(),true;var i=this._notify("onDoRegistryRefresh",e,t);if(true===i||L(i))return true;return false},_putInWaitingOfEditEnd:function(e){this._waitingEditFilters=this._waitingEditFilters.concat(e)},_refreshEachSequentiallyCallback:function(e){if(e&&e.filter&&e.result&&e.filter.length>=e.result.length&&e.result.length>0){var t=e.filter;if(this.mergeByFilter(t,e.result),t.hasOwnProperty("expand")&&t.expand)this.getView().expandNode(t.expand)}else this._logError("_refreshEachSequentiallyCallback","результат от refreshEachSequentially невозможно обработать:"),this._logError("resObj",JSON.stringify(e));return e},_handleEvent:function(e,t,i){var s=l[e.name],r=e.name.toLowerCase();if(this.isDestroyed()||!s||!s.validator.call(this,t))return;if(!i&&s.timeouting){var n=s.timeouting.call(this,t);if(n)return void setTimeout(this._handleEvent.bind(this,e,t,true),n)}if(!this._checkProcessedAbove(o.getOldEventName(r),t)){var a=false,f=this.getList(),g=this.getView(),h,d=this.getListType(),u="read"==t.state&&M(r,["onchangemessage","onchangethemes"])&&M(d,["theme","chat"]),c=function(e){var t=e.getContainer().parent();if(this.withScrolling=t,this.scrollt=null,t.length&&t.hasClass("withScrolling")||t.hasClass("ws-scrolling-content"))this.scrollt=t.scrollTop();this.finish=function(){if(null!==this.scrollt&&this.scrollt!=this.withScrolling.scrollTop())this.withScrolling.scrollTop(this.scrollt)}},p=function(e){var t={allowRedraw:true,raising:false},i=g.isFastAnswerOpened instanceof Function?g.isFastAnswerOpened():false;if(e&&(u||g.isEdit()&&!i&&"onnewmessage"===r)){if(e!==f.isEventRaising())t.allowRedraw=!(g.isEdit()&&!i),t.raising=f.setEventRaising(e,t.allowRedraw);return t}else return t.raising=f.eventsObserving(e),t};h=p(false);try{var m=s.processor.call(this,t)}catch(e){this._logError("_handleEvent",e)}if(h.raising)var v=p(true);else this._logMsg("_handleEvent","event raising was already disabled");if(m&&m.length){for(var y=0,_=m.length;y<_;y++)if(m[y].reload){a=true;break}if(!a){var w=g&&g.getDataSource();if(w=w&&w.getEndpoint(),w=w&&"ПриглашениеКомпании"===w.contract,w)a=true}if(!a&&"onnewmessage"===r&&f.isSingleThemeMessageList()&&g.isEdit()&&!(g.isFastAnswerOpened&&g.isFastAnswerOpened())){var C=[],I=[];if(m.forEach(function(e){if(e.append||e.delayedListUpdateAfterLast)C.push(e);else I.push(e)}),C.length&&m.length!=I.length)this._putInWaitingOfEditEnd(C),m=I}}if(!a&&m&&m.length){var b=[];if(m.forEach(function(e){if(!e.hasOwnProperty("redrawIndex"))b.push(e)}),b&&b.length){var S=this.refreshEachSequentially(b,e.name);if(S)S.addCallback(this._refreshEachSequentiallyCallback.bind(this))}}if(a){if(this.isWithFolders()){var F=g.getFilter();if(F["БлокиГруппСвернуты"])delete F["БлокиГруппСвернуты"],g.setFilter(F,true)}g.reload().addCallback(function(){if("function"==typeof g.runUnreadMessages)g.runUnreadMessages()})}}},_handleTick:function(){if(this._slower++<1)return;else this._slower=0;var e=this.getList();if(this._newMessageDateTimeForRequest&&e&&e.isChat()){var t=this._newMessageDateTimeForRequest;if(!this._withSeparatorHandled)t.setSeconds(t.getSeconds()-5);this._newMessageDateTimeForRequest=null;var i=this.refreshEachSequentially([{datefrom:t,append:true,appendHiddenIfServiceLast:true,with_separator:this._withSeparatorHandled}],"onNewMessage");if(this._withSeparatorHandled=false,i)i.addCallback(this._refreshEachSequentiallyCallback.bind(this))}},_setListTypeInFilter:function(){if(this._listType&&this._view&&"function"==typeof this._view.getFilter&&"function"==typeof this._view.setFilter){var e=this._view.getFilter();if(void 0===e)throw"Опция filter должна быть связана с объектом в контексте и объект установлен в контекст в конструкторе компонента родителя представления, например так: this.getLinkedContext().setValue('filter', {});";if(e["ТипСписка"]=this.getListType(),this._view.setFilter(e,true),this._needSorting())this._view.setItemsSortMethod(function(e,t){return e.collectionItem.compareForSort(t.collectionItem)})}},_needSorting:function(){return!this._options.noSubscribe},_logError:function(e,t){this._log("error",e,t)},_logMsg:function(e,t){this._log("log",e,t)},_log:function(e,t,s){if(!this.logger)this.logger=i.resolve("ILogger");this.logger[e](t,s)},_checkRowForServiceMessageEssentials:function(e){if(e.get("IsServiceTypeChat"))e.set("IsHiddenRow",!e.get("ПрочитаноПолучателем")[0])},_onEditEnd:function(e){var t=this.getView();if(t&&t._alreadyCancelEdit)return false;var i=this,s=this._waitingEditFilters,r=this.getList(),n=false,a=false,o=function(){if(n)i.getView().reload();else if(a)setTimeout(function(){var e=i&&i.getView();if(e&&!e.isLoading())e.redraw()},300)};if(this._waitingEditFilters=[],r)if(r.eventsObserving(true),s&&s.length>100||r.getCount()>100)n=true;else a=true;if(s.length&&r&&r.isSingleThemeMessageList()){var l=[],f=null;if(s.forEach(function(e){if(e)if(null===f){if(e.append&&e.theme&&null!=r.getMyThemeIndex(e.theme))l.push(e);else if(e.delayedListUpdateAfterLast&&e.datefrom)f=e.datefrom,l=[e]}else if(e.delayedListUpdateAfterLast&&e.datefrom&&e.datefrom<f)l=[e]}),l.length){var g=this.refreshEachSequentially(l,"onEditEnd",n,a);if(g)g.addCallback(this._refreshEachSequentiallyCallback.bind(this));else o()}else o()}else o()},_onChangeHoveredItemHandler:function(e,t){var i=this.getItems();if(!i)return;var s=i.getListType(),r,n=this.getContainer().find(".contacts-ThemeMessage-row.hovered-date"),a=this._options._ladderInstance;if(n.length){if(n.hasClass("contacts-PairsView-row"))var o=n.parent().attr("data-id");else o=n.attr("data-id");if(r=i.getRecordById(o),r)n.find(".message-time-date .visible-date.contacts-ThemeMessage__miniDate").each(function(e,t){$(t).html(a&&!r.get("IsOldDate",e)?a.get(r,e?"DateCheck1":"DateCheck")?r.get("DateFull",e):r.get("DateMini",e):r.get("DateCheck",e))}),n.removeClass("hovered-date")}if(r=i.getRecordById(t.key),r&&t.container){var l=t.container.is(".contacts-ThemeMessage-row")?t.container:t.container.find(".contacts-ThemeMessage-row"),f=new Date;if("pairs"===s)l=l.filter(".row-processed");else if("theme"===s)l=l.filter(":not(.row-processed)");if(l.length&&!r.isDiscussion())l.find(".message-time-date .visible-date").each(function(e,t){var i=$(t),s=r.get("ДатаВремя")[e];if(s){if(f.getMonth()+12*f.getYear()-(s.getMonth()+12*s.getYear())>3&&f.getYear()!==s.getYear())i.html(s.strftime("%e %b %Y").toLowerCase());else i.html(s.strftime("%e %b %H:%M").toLowerCase());if(!i.attr("title"))i.attr("title",s.strftime("%e %b %Y %H:%M"))}}),l.addClass("hovered-date");var g=l.find(".isBeginEdit");if(g.length&&!r.get("IsBeginEdit")){var h=r.get("СообщениеИзменено")[0];if(h)g.attr("title",h),g.removeClass("isBeginEdit");else g.remove()}}},_afterDataLoad:function(e,t){if(e)this._appendClientsFields(t),this._fillSignatureFileInfo(t),t.setListType(this.getListType());if(this._pageLoadItemsIdArray=[],this._notActiveSignRequest={},this.setMetaInfoLastMessageDate(t),!t.isSingleThemeMessageList()&&!u.isInMySbis())t.each(function(e){this._pageLoadItemsIdArray.push(e.getId())}.bind(this));if(this._view)this.unsubscribeFrom(void 0,"onCollectionChange"),this.unsubscribeFrom(void 0,"onCollectionItemChange");return this.subscribeTo(t,"onCollectionChange",this._bindedEventHandlers.onSync),this.subscribeTo(t,"onCollectionItemChange",this._bindedEventHandlers.onItemChange),t},_afterDataMergeCorrections:function(e,t){this._appendClientsFields(t),this.setMetaInfoLastMessageDate(t);var i=this.getList(),s=t.at(0),r=i.at(i.getCount()-1),n=t.at(1);if(this._fillSignatureFileInfo(t,r),!i.isSingleThemeMessageList()&&!u.isInMySbis())t.each(function(e){this._pageLoadItemsIdArray.push(e.getId())}.bind(this));return t},_onDrawItemsHandler:function(){if(this.isDestroyed())return;var e=new Date,t=this.getView(),i=t.getContainer(),s=t.getFilter()["ТипСписка"],r="msgcontact"===s,n="pairs"===s,a="invite"===s;if("dialogs"===s||a||n||r){var o=i.find(".contacts-ThemeMessage-row");o.closest("tr").filter(":last").addClass("last-file-padding"),o.addClass("row-processed")}this._logMsg("drawItems in msg-controller time",new Date-e)},_beforeBLcall:function(e,t,i){if(t!==this._options.nameMethodBL)return;var s=this.getView().getItems(),r,n=i["Фильтр"];if((i["Навигация"]?i["Навигация"].get("Страница"):0)>0&&s&&n)if(r=this.getMetaInfoLastMessageDate(n.get("Раздел")),r){if(!n.has("СмещениеОтДаты"))n.addField(new c({name:"СмещениеОтДаты"}));return void n.set("СмещениеОтДаты",r)}if(n&&n.has("СмещениеОтДаты")){n.removeField("СмещениеОтДаты");var a=n.get("Раздел");if(void 0===a)a=null;this._metaInfoLastMessageDate[a]=null}},_onCollectionChangeHandler:function(e,t,i,s,r,n){var a=this.getListType(),o=this.getList(),l=t==d.ACTION_REMOVE,f=t==d.ACTION_ADD||d.ACTION_REPLACE&&"dialogs"==a,g=l?r:i,h=g[0];if(!o)return;if(h&&"БыстрыйОтвет"!=h.get("ДляИнтерфейса")&&(f||l)){var c=h.get("Тема");if(c&&-1==c.indexOf("_expanded"))if(this._changedItems[l?"remove":"add"]=g.slice(),f)this._fillSignatureFileInfo(i)}if(i&&i.length&&(t===d.ACTION_REPLACE||t===d.ACTION_ADD))if(!("pairs"==a)&&!o.isSingleThemeMessageList()&&!u.isInMySbis())if(this._pageLoadItemsIdArray.length)this._pageLoadItemsIdArray=[]},_onCollectionItemChangeHandler:function(e,t,i,s){if("dialogs"==this.getListType()&&s.hasOwnProperty("Раздел"))this._movedItems[t.getId()]=t}}),S=function(e,t){if(void 0===t)t={};for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];return t},M=function(e,t){return Array.indexOf(t,e)>=0},F=function(){return t.global.getValue("mypersonid")},L=function(e){return"object"==typeof e&&"function"==typeof e.addBoth};return b});
//# sourceMappingURL=Controller.module.js.map
define("js!SBIS3.Contacts.BeforeProcessingEvent",["js!WS.Data/Entity/Record","js!WS.Data/Collection/RecordSet","js!SBIS3.Contacts.CachingPersons","js!SBIS3.Contacts.CoreMiniFunctions","Core/UserInfo","Core/Context","Transport/prepareGetRPCInvocationURL"],function(e,t,n,s,r,l,i){var a=["new-chat","new-chater","stop-chater","chat-new-admin","chat-remove-admin","chat_unlock","chat_lock"];function o(e,t,n){return!(!e||!n||!t||e.get("Сообщение")!==t["old_msg"]||-1===["chat","theme"].indexOf(n["ТипСписка"])||-1===[null,void 0,""].indexOf(n["Поиск"])||!t["is_chat"]||1===n["ДатаПоВозрастанию"]||void 0!==n["РейтингПоВозрастанию"]||void 0!==n["ИерархияПоВозрастанию"]||t["theme"]!==n["Тема"]||t["type"]||t["is_cut_text"]||t["files_total_count"]!==(t["files"]?t["files"]["d"].length:0))}function u(e){if(!e||0===e.length)return null;for(var t=[],n=0;n<Math.min(e.length,2);n++)if(e[n])t.push(e[n]);return t.join(" ")}function c(e){var t="dialog";if(e["invite"])t="invite";else if(e["is_chat"]){if(t="chat",null!==e["type_chat"])t+="/"+e["type_chat"]}else if(e["is_private"])t="private";return t}function f(){return l.global.getValue("mypersonid")||r.get("ИдентификаторСервисаПрофилей")}function d(){return"__сбис__аноним"===r.get("КлассПользователя")}var h={},v=l.global.getValue("myfaceinfo");return{onNewMessage:function(l,p,m,g){if(!o(l,p,m))return null;var _=new e({adapter:"adapter.sbis",format:l.getFormat()}),y="object"===typeof p["datetime"]?p["datetime"]:Date.fromSQL(p["datetime"]),C=f(),j=C===p["sender"]["person"],S=r.get("ИдентификаторКлиента")===p["sender"]["client"],w;if(n.isAnonymousUser(p["sender"]["person"]))w=n.getAnonymousData()[p["sender"]["person"]]["name"];else w=u(p["sender"]["partsOfName"]);if(!w)return null;h[p["sender"]["person"]]=w;var x=[],D=[];if(-1!==p["receivers"].indexOf(C))p["receivers"].sort(function(e,t){return t===C?1:e===C?-1:0});for(var I=0;I<Math.min(p["receivers"].length,10);I++){var O=p["receivers"][I];if(null!==p["receivers_names"][I])h[O]=h[O]||u(p["receivers_names"][I]),x.push(h[O]);else if(h[O])x.push(h[O]);else if(j&&v&&O===p["sender"]["person"])x.push(u([v["Фамилия"],v["Имя"],v["Отчество"]]));else if(n.isAnonymousUser(O))x.push(n.getAnonymousData()[O]["name"]);else{var b=n.getPersonDataByCache(O);if(b)x.push(u([b.get("Фамилия"),b.get("Имя"),b.get("Отчество")]));else D.push(O)}}if(x.length<Math.min(p["receivers"].length,2))return null;_.set("ИдО",l.get("ИдО")+1),_.set("ТипСписка",l.get("ТипСписка")),_.set("Тема",p["theme"]),_.set("Сообщение",p["msg"]),_.set("СообщениеУдалено",false),_.set("КоличествоЭлементов",0);var N=(j||g)&&1!==p["type_chat"];_.set("МожноРедактировать",N),_.set("МожноУдалить",N),_.set("ДатаВремя",y),_.set("ДатаДляОтображения",[y.strftime("%e %b").toLowerCase().trim(),null]);var U=false;if(p["is_chat"])U=j;else U=p["intraTheme"]||p["outgoing"];_.set("ПрочитаноВладельцем",[U,null]),_.set("НачатаПравка",[null,null]),_.set("КонтактКлиент",[p["sender"]["client"],null]),_.set("КонтактФИ",[j?rk("Я:"):w,null]),_.set("КонтактTitle",[w,null]),_.set("КонтактПерсона",[p["sender"]["person"],null]),_.set("КонтактКоллега",[S,null]),_.set("КонтактМесто",[S?p["sender"]["department"]:p["sender"]["companyName"],null]),_.set("КонтактМестоИд",[S?p["sender"]["departmentId"]:p["sender"]["companyId"],null]),_.set("КонтактМестоПодтверждено",[true,null]),_.set("Я",[j,null]),_.set("Входящее",[!j&&(p["is_chat"]||!p["intraTheme"]),null]),_.set("ПолучателиФИО",[x,null]),_.set("КоличествоПолучателей",[p["receivers_count"],null]);var k=j&&p["receivers"]?-1!==p["receivers"].indexOf(C):null;_.set("ПрочитаноПолучателем",[k?y:null,null]),_.set("СлужебныйТип",[p["type"],null]);var B={};B["receivers"]=p["receivers"];var M=[p["sender"]["person"]].concat(-1===a.indexOf(p["type"])?p["receivers"]:[]);if(M.sort(),B["snd_hash"]=s.getCrc32ForString(s.utf16toUtf8(M.join(""))),_.set("СлужебныйОбъект",[JSON.stringify(B),null]),_.set("Текст",[p["text"],null]),p["files"])_.set("ФайлыДляПревью",new t({rawData:p["files"],adapter:"adapter.sbis"}));_.set("ЕстьОтказОтПодписи",[null,null]),_.set("ЕстьОтветНаЗапросПодписи",[null,null]),_.set("СообщениеИзменено",[null,null]),_.set("Тип",c(p)),_.set("Курсор",{field:"ДатаВремя",value:p["datetime"],timestamp:p["datetime"]}),_.set("ПрочитанноУчастниками",[false,null]),_.set("ОтветНаСообщение",p["reply"]);var P=null;if(!j)if(!d())if(S)P=s.getCachedPhotoUrl(p["sender"]["photo_id"],40);else P=i("СервисПрофилей","Фото",{"Персона":p["sender"]["person"],"Тип":"default"},"/previewer/r/40/40/service/");else P=i("Персона","ФотоПерсоныПоФотоИд",{"ФотоМини":p["sender"]["photo_id"],"МинСторона":40,"Клиент":p["sender"]["client"]},"/previewer/service/");_.set("КонтактФотоСсылки",[P,null]);var T=x.slice(0,2),A=x.slice(3);return _.set("ЕщёNTitle",[A.length>0?[rk("ещё для")," ",A.join(", ")].join(""):null,null]),_.set("ЕщёN",[p["receivers_count"]-T.length,null]),_.set("Получатели",[T.length>0?[rk("для")," ",T.join(", ")].join(""):null,null]),_}}});
//# sourceMappingURL=BeforeProcessingEvent.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.MiniThemeMessagesBase",["Core/core-merge","Core/IoC","Core/Deferred","Core/detection","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/MessageItem","js!SBIS3.Contacts.Models.MiniChatModel","js!WS.Data/Source/SbisService","js!SBIS3.Contacts.Collections.ListOfMessages","js!SBIS3.Contacts.Controllers.ListOfMessagesController","js!SBIS3.Contacts.MessagesExchangeEvents","js!SBIS3.Contacts.CoreMiniFunctions","js!SBIS3.Contacts.Mixins.Interface.ScrollToMessage","js!SBIS3.Contacts.Mixins.Services.Consumer","js!WS.Data/Chain","Core/core-clone","js!SBIS3.Contacts.BeforeProcessingEvent","js!SBIS3.Contacts.Mixins.Interface.MessagePositionCursorView","css!SBIS3.Contacts.Mixins.Interface.MiniThemeMessagesBase/ThemeMessages"],function(e,t,s,i,n,o,r,a,l,g,c,d,h,f,u,_,p){"use strict";return e(e(e(e({},d,{clone:true}),h,{clone:true}),p,{clone:true}),{$protected:{_options:{dialogID:null,contactID:null,isUploading:true,showPhoto:1,isChat:false,messageID:null,blockRefreshByControllerContext:void 0,foundOffset:void 0,foundPageSize:void 0,isExistMessages:true,fileListUpdate:false,idProperty:"Сообщение",itemsDragNDrop:false,contextMenu:false,itemsActions:[],className:"contacts-miniThemeMessagesBase contacts-Modify__chat-view",infiniteScroll:"both",controlEmojiAvailability:false,isExpanded:false,navigation:{type:"cursor",config:{field:"Курсор",direction:"both",position:null}},virtualScrolling:false,readMessages:{endpoint:"PublicMsgApi",callMethod:"СПометитьДиалогПрочитанным"}},_filter:{},_newMessages:{},_isScrollOnBottom:false,_lastRec:null,_isReceivedNewMessage:false,_needScrollToItem:null,_lockMessageId:null,_isMerging:false,_dialogController:null,_reading:{isReading:false,needMore:false},_isStartingScrollToNeedMessage:false,_cursorOnMergeSearch:null,_isResetSearching:false,_changedMessages:[]},$constructor:function(){this._publish(["onClickMember","onNewMessage","onChanged","onDeleteAllMessages","onInitPaging","onBeforeReload"])},before:{init:function(){var e=this,t=e._options,s=e.getContainer(),o=e._getListType();if(t.itemTpl=n,e._filter={"Тема":t.dialogID,"ДатаДляОтображения":e._options.infiniteScroll,"Контакт":t.contactID,"ТипСписка":o,"РазмерФото":null,"РежимФотоСсылка":t.showPhoto,"СкрытьСлужебные":e._isHideServicesMessage(),"ГруппироватьСлужебные":e._options.isChat},e._setFilterForSorting(e._filter),s.append('<div class="base__listController"></div>'),e._dialogController=new l({name:"dialogHistoryController",element:s.find(".base__listController"),parent:e,listType:o,noProcessLocalNewMessagesContext:this._options.blockRefreshByControllerContext,nameMethodBL:this._options.messagesListService.binding.query}),e.subscribeTo(e,"onInit",function(){this.configureDataSource(this._options.messagesListService.endpoint,this._options.messagesListService.binding.query),e._setPersonActivity(),e._dialogController.setLinkedView(this),this.subscribeTo(e._dialogController,"onDoRegistryRefresh",e._handlerOnDoRegistryRefresh.bind(this));var s=e._dialogController.getControllerSource();if(s)e.subscribeTo(s,"onBeforeProviderCall",e._setAdditionalFields.bind(e));if(t.dialogID)this.once("onAfterShow",function(){var t=this.getLinkedContext().getValue("ВыделитьТекст");if(t)e._filter["ВыделитьТекст"]=t;this.setFilter(e._filter,true),this._reloadIsExistMessage()})}),e.subscribeTo(e,"onDrawItems",e._handlerOnDrawItems),e.subscribeTo(e,"onFocusIn",e._handlerOnFocusIn),e.subscribeTo(e,"onItemsReady",e._handlerOnItemsReady),e.subscribeTo(e,"onItemClick",e._handlerOnItemClick),e.subscribeTo(e,"onDataMerge",e._handlerOnDataMerge),e.subscribeTo(e,"onDataLoadError",c.onDataLoadError),e.subscribeTo(e,"onChangeHoveredItem",e._handlerOnHoveredItem),e.subscribeTo(e,"onDataLoad",e._handlerOnDataLoad),e.subscribeTo(e,"onDestroy",e._handlerOnDestroyMessagesBase),e.subscribeTo(g,"onChangeThemes",e._onChangeThemes.bind(e)),i.isMobileIOS)e.subscribeOnceTo(e,"onDrawItems",function(){setTimeout(function(){s.height("10px"),s.height(),s.height("")},200)})}},clear:function(){var e=this.getItems();if(e&&e.clear)e.clear(),this._notifyOnSizeChanged()},createListOfMessages:function(e){var s=this,i=e.getIdProperty();if("Сообщение"!==i)i="Сообщение",t.resolve("ILogger").log("IdProperty в переданном наборе данных должно быть = 'Сообщение'","заменено на правильное");return new a({model:s.getModelByView(),meta:e.getMetaData(),adapter:e.getAdapter(),idProperty:i,rawData:e.getRawData()})},getDialogController:function(){return this._dialogController},getCurrentDialogID:function(){return this._getDialogId()},configureDataSource:function(e,t){var s=this,i;if(e&&t)i=new r({endpoint:e,binding:{query:t},model:s.getModelByView(),listModule:a,idProperty:"Сообщение"}),s.setDataSource(i,true),s.subscribeTo(i,"onBeforeProviderCall",s._setAdditionalFields.bind(s))},getModelByView:function(){return o},isRowAllowScrolling:function(e){return true},isSearching:function(){return this._isSearching()},reloadDialog:function(e,t,i,n,o){var r=new s,a=this._filter,l=n&&n.searchPerson?n.searchPerson:null;if(!o&&a["Тема"]==e&&a["Контакт"]==t&&a["Поиск"]==i&&a["ПоискПерсоны"]==l)r.callback();else{var g=this._notify("onBeforeReload");if(false===g)r.callback();if(g&&"function"==typeof g.addCallbacks)return g.addCallbacks(function(e){if(!this.view.isDestroyed())this.view._doReloadDialog.apply(this.view,this.params);else this.view.params[4].callback()}.bind({view:this,params:[e,t,i,n,r]}),function(e){this.errback(e)}.bind(r)),r;this._doReloadDialog(e,t,i,n,r)}return r},resetSearchFlag:function(){this.setPositionCursor(null),this._isResetSearching=true},runUnreadMessages:function(e){e=e||1e3;var t=this;if(!t._alreadyDef){t._alreadyDef=new s;var i=function(e){t.runUnreadMessagesToCall.bind(t,e)().addCallback(function(e){if(t._alreadyDef)t._alreadyDef.callback(e),t._alreadyDef=null})};c.callIfContentBecomeVisibleForUser.bind(t)(t._options.contactID?"contacts":true===t._options.isChat?"chats":void 0,t,i.bind(t,e))}return t._alreadyDef},runUnreadMessagesToCall:function(e){var t=this,i=new s;if(e)setTimeout(function(){t._runUnreadMessages().addCallbacks(i.callback.bind(i),i.errback.bind(i))},e);else i=t._runUnreadMessages();return i},_setAdditionalFields:function(e,t,s){if(this._options.controlEmojiAvailability)if(t==this._options.messagesListService.binding.query)s["ДопПоля"].push("like"),e.setResult(s);if(this._cursorOnMergeSearch){var i=s["Навигация"],n=i?i.get("Position"):null,o=n&&n.has("Курсор")?n.get("Курсор"):null;if(i&&i.has("Order")){var r=i.get("Order");if("after"==r||"both"==r)i.set("Order","before")}if(o&&o.value!==this._cursorOnMergeSearch.value)n.set("Курсор",this._cursorOnMergeSearch)}},_checkSndGroup:function(e){var s=this;try{var i=s._isMerging?e[0]:s._lastRec,n=s._isMerging?i&&s.getItems().getRecordById(s.getNextItemById(i.getId()).attr("data-id")):e[0],o=i&&"chat/2"!=i.get("Тип")&&i.get("СлужебныйОбъект")?JSON.parse(i.get("СлужебныйОбъект")[0]):null,r=n&&"chat/2"!=n.get("Тип")&&n.get("СлужебныйОбъект")?JSON.parse(n.get("СлужебныйОбъект")[0]):null;if(o&&r&&o.snd_hash==r.snd_hash){if("end"==o.snd_group)if(o.snd_group="center","begin"==r.snd_group)r.snd_group="center";else r.snd_group="end";else if(o.snd_group="begin","begin"==r.snd_group)r.snd_group="center";else r.snd_group="end";if(i.get("Сообщение")!=s._editingItem)i.set("СлужебныйОбъект",[JSON.stringify(o),null]);else s._serviceObjectEditing[s._editingItem]=[JSON.stringify(o),null];n.set("СлужебныйОбъект",[JSON.stringify(r),null])}if(!s._isMerging)s._lastRec=n}catch(e){t.resolve("ILogger").error("Ошибка при парсе поля СлужебныйОбъект\n",e)}s._isMerging=false},_doReloadDialog:function(t,s,i,n,o){var r=this,a=r._filter;if(a["Тема"]=t,a["Контакт"]=s?s:null,a["Поиск"]=i?i:null,a["ПоискПерсоны"]=n&&n.searchPerson?n.searchPerson:null,a["ВыделитьТекст"]=n&&n.searchHigh?n.searchHigh:null,a["ПараметрыПоиска"]=n&&n.searchParams?n.searchParams:null,n.hasOwnProperty("addFilter"))e(a,n.addFilter,{clone:true});r.setFilter(a,true),r._filter=a,r._options.dialogID=t,r._options.contactID=s,r._lockMessageId=null,r._options.foundOffset=void 0,r._options.foundPageSize=void 0,r._doReload(o,n)},_getDialogId:function(){return this._options.dialogID},_getListType:function(){return"theme"},_getSortingForPosition:function(){return this._filter["ДатаПоВозрастанию"]},_handlerOnDataLoad:function(e,t){if("function"==typeof this._setCursorOnSearch)this._setCursorOnSearch(t)},_handlerOnDestroyMessagesBase:function(){var e=this;e._lastRec=null,e._needScrollToItem=null,e._dialogController&&e._dialogController.destroy(),e._dialogController=null},_onChangeThemes:function(e,t){if(t&&"files_encrypted"===t.state&&t.changed_themes&&t.attachId)for(var s=this._getDialogId(),i=0;i<t.changed_themes.length;i++)if(t.changed_themes[i].id===s){this.getItems().each(function(e){var s=e.get("FileForPreview");if(s)s.each(function(e){if(e.get("attachId")===t.attachId)e.set("encrypted",t.is_encrypted?2:1)})});break}},_handlerOnDataMerge:function(e,t){if(this._isMerging=true,"function"==typeof this._setCursorOnSearch)this._setCursorOnSearch(t)},_handlerOnDoRegistryRefresh:function(e,t,s){var i=this;if("onChangeMessage"==t&&s.state)switch(s.state){case"edited":i._prepareOnNotifyOnChanged(s,false,e);break;case"deleted":i._prepareOnNotifyOnChanged(s,true,e)}else if("onNewMessage"==t){if("both"==i._options.infiniteScroll){var n=i.getListNavigation();if(n)if(n.hasNextPage("down"))if(e.setResult(true),!i._isSearching()&&s.outgoing)n.setPosition(null),i.reload()}if(i._preReadNewMessage(e,s),i._newMessages[s.msg]=s.is_local,i._isScrollOnBottom=i.isScrollOnBottom(true),i._isReceivedNewMessage=true,!i._lastRec)i._lastRec=i.getLastItemByProjection()?i.getLastItemByProjection():i.getItems().at(0);var o=_.onNewMessage(i._lastRec,s,i.getFilter(),i._options&&i._options.isAdmin);if(null!==o){var r=i.getItems();r.add(o,r.getCount()),e.setResult(true)}}},_handlerOnDrawItems:function(){this._ownScrollToNeedMessage()},_handlerOnHoveredItem:function(e,t){var s=t&&t.record;if(s){var i=this,n=s.get("Я"),o=null===n[1]?n[0]:n[1],r=i.getContainer(),a=t.container,l=i._options.isExpanded&&s.get("ЛичнаяПереписка")?"dialog-history-optionsHoveredOrange":"dialog-history-optionsHoveredGrey";if(!o&&!a.is(".contacts-Discussion-row"))r.removeClass("dialog-history-optionsHoveredBlue").addClass(l);else r.removeClass(l).addClass("dialog-history-optionsHoveredBlue");r.toggleClass("low-line-action",a.hasClass("snd_group__center")||a.hasClass("snd_group__begin"))}},_handlerOnItemClick:function(e,t,s,n){var o=this,r=i.isMobilePlatform||i.isMobileAndroid||i.isMobileIOS||i.isMacOSMobile||i.isMobileSafari,a=function(){var e=s.get("КонтактПерсона")[0],t=s.get("КонтактФИ")[0];o._notify("onClickMember",e,t)};if(!r&&$(n).hasClass("contacts-person-photo"))a();else if(r&&$(n).hasClass("message-person-name"))a()},_getFileRecords:function(e){var t=[],s;if(e)for(var i=0;i<e.length;i++)if(s=e[i],s.get("ФайлыДляПревью")){var n=new f(s.get("ФайлыДляПревью"));t=t.concat(n.toArray())}return t},getFilesList:function(e){var t=null;if(e=e||this.getItems()){var s=e.getCount();if(s>0){t=e.at(0).get("ФайлыДляПревью").clone();for(var i=1;i<s;++i){var n=new f(e.at(i).get("ФайлыДляПревью")).toArray();t.append(n)}}}return t},_handlerOnItemsReady:function(e){var t=this,s=t.getContainer(),i=t.getItems();if(i)t.subscribeTo(i,"onCollectionChange",function(e,n,o,r,a,l){var g=t._isSearching();switch(n){case"a":t._checkSndGroup(o);var c=t._isReceivedNewMessage?i.getFreshestIndex():-1,d=-1!==c?i.at(c):null,h=t._isScrollOnBottom||d&&d.get("Я")[0],u=d?s.find('[data-id="'+d.getId()+'"]'):$();if(!t._needScrollToItem&&d&&h&&u.length){if(t.isRowAllowScrolling(t._needScrollToItem))t._needScrollToItem=d,t._ownScrollToNeedMessage();t._isReceivedNewMessage=false}for(var _=0;_<o.length;_++){var p=o[_].getId();if(t._newMessages.hasOwnProperty(p))t._notify("onNewMessage",p,t._newMessages[p]),delete t._newMessages[p]}if(t._options.fileListUpdate){var m=t._getFileRecords(o);if(m.length)t.consume("fileListUpdate",{mode:"add",files:m,search:g})}break;case"rm":if(t._options.fileListUpdate){var I=t._getFileRecords(a);if(I.length){var v=new f(t.getItems()).toArray();t.consume("fileListUpdate",{mode:"delete",files:I,search:g,count:t._getFileRecords(v)})}}t._notifyOnChangedEvent(o,true);break;case"rp":if(t._options.fileListUpdate)t.consume("fileListUpdate",{mode:"replace",files:t._getFileRecords(o),search:g});t._notifyOnChangedEvent(o,false);break;case"rs":if(t._options.fileListUpdate){if(o&&o.length&&void 0===o[0])o=new f(t.getItems()).toArray();if(g)t.consume("fileListUpdate",{mode:"replace",files:t._getFileRecords(o),search:g,sources:[t]});else if(t._isResetSearching)if(t._isResetSearching=false,o&&o.length&&o[0].get("Тема")==t.getCurrentDialogID())t.consume("fileListUpdate",{mode:"replace"})}}})},_handlerOnFocusIn:function(){var e=this,t=e.getItems(),s=[];if(t)t.each(function(e){if(e.get("ПрочитаноВладельцем")&&!e.get("ПрочитаноВладельцем")[0])s.push(e.getId())});if(s.length)e.runUnreadMessages()},_isHideServicesMessage:function(){return false},_isSearching:function(e){var t=this;return(e=e||t.getFilter()).hasOwnProperty("Поиск")&&e["Поиск"]||e.hasOwnProperty("ПоискПерсоны")&&e["ПоискПерсоны"]},_prepareOnNotifyOnChanged:function(e,t,s){if(e.changes_for)for(var i=0;i<e.changes_for.length;i++){var n=e.changes_for[i];if(this._getDialogId()==n.theme)if(e.is_local&&!t){var o=this.getItems().getFreshestIndex(),r=o>-1?this.getItems().at(o):null;if(r&&n.msg==r.get("Сообщение"))this._needScrollToItem=r,this._notify("onChanged",n.msg,false,this._getDialogId())}else if(-1==this._changedMessages.indexOf(n.msg))this._isScrollOnBottom=this.isScrollOnBottom(true),this._changedMessages.push(n.msg)}if(t){var a=this.getItems();if(1==a.getCount()&&-1!=this._changedMessages.indexOf(a.at(0).getId()))this._notify("onDeleteAllMessages"),s.setResult(false)}},_notifyOnChangedEvent:function(e,t){for(var s=0;s<e.length;s++){var i=e[s].getId(),n=this._changedMessages.indexOf(i);if(-1!=n)if(this._notify("onChanged",i,t,this._getDialogId()),this._changedMessages.splice(n,1),!t&&this._isScrollOnBottom){var o=this.getItems(),r=o.getFreshestIndex(),a=r>-1?o.at(r):null;if(a&&i==a.get("Сообщение"))this._needScrollToItem=a}}this._ownScrollToNeedMessage()},_notifyOnChangeThemes:function(e){var t=e.get("messageList");if(t&&t.length){var s=this.getItems(),i=this._getDialogId(),n=s&&s.getCount()?s.at(0):null,o=n?s.isRowHasPrivateMsg(n):false,r=n?s.getRowChatSubType(n):null,a=u(t);a.splice(0,1);var l={changed_themes:[{id:i,msg:t[0],only_msgs:a,chat:this._options.isChat,type_chat:r,is_private:o}],state:"read",reestr:e.get("reestrList"),folders:e.get("folderList"),invite:e.get("invite"),chat_root_reestr:e.get("chat_root_reestr"),user:c.getUserId()};g.doAndNotify("onChangeThemes",l)}},_ownScrollToNeedMessage:function(){if(!this._isStartingScrollToNeedMessage){this._isStartingScrollToNeedMessage=true;var e=function(){if(this._needScrollToItem&&c.isContentVisibleForUser("chats",this)&&!this._needScrollToItem.get("IsHiddenRow")&&!!this.getItems().getRecordById(this._needScrollToItem.getId()))this.scrollToMessage(this._needScrollToItem.getId(),this._needScrollToItem.get("Я")[0]),this._needScrollToItem=null;this._isStartingScrollToNeedMessage=false};c.callIfContentBecomeVisibleForUser.bind(this)(this._options.contactID?"contacts":true===this._options.isChat?"chats":void 0,this,e.bind(this))}},_preReadNewMessage:function(e,t){},_runUnreadMessages:function(){var e=this,i=e.getItems(),n=[],o=new r({endpoint:this._options.readMessages.endpoint}),a=this._options.readMessages.callMethod,l=e._getDialogId(),g={"Тема":l,"Сообщение":null},c=i&&i.getCount()?i.at(0):null,d=c?i.isRowHasPrivateMsg(c):false,h=c?i.getRowChatSubType(c):null;if(i)i.each(function(e){if(e.get("ПрочитаноВладельцем")&&!e.get("ПрочитаноВладельцем")[0])n.push(e.getId())});if(e._reading.isReading&&!e._reading.needMore)e._reading.needMore=true;if(!l||!n.length||e._reading.isReading)return s.success();return e._reading.isReading=true,o.call(a,g).addCallbacks(function(t){e._reading.isReading=false;var s=t.getRow(),i=s.get("messageList");if(i&&i.length){if(e._notifyOnChangeThemes(s),e._reading.needMore)e._reading.needMore=false,e._runUnreadMessages();return t}},function(e){return t.resolve("ILogger").error("Ошибка при выполнении операции прочтения",["Подробности:",e]),e})},_setFilterForSorting:function(e){var t=this;e["ДатаПоВозрастанию"]="both"==t._options.infiniteScroll||"up"==t._options.infiniteScroll?0:1},_setPersonActivity:function(){}})});
//# sourceMappingURL=ThemeMessages.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.ThemeMessagesBase",["Core/core-merge","js!SBIS3.Contacts.Mixins.Interface.MiniThemeMessagesBase","js!SBIS3.Contacts.Models.SingleMessageModel","js!SBIS3.Contacts.Models.ChatModel","js!SBIS3.Contacts.PersonActivityManager","css!SBIS3.Contacts.Mixins.Interface.MiniThemeMessagesBase/ThemeMessages"],function(e,s,t,n,i){"use strict";return e(e({},s,{clone:true}),{$protected:{_options:{className:"contacts-themeMessagesBase contacts-miniThemeMessagesBase",fileListUpdate:true,consumedServices:["fileListUpdate"]}},getModelByView:function(){if(this._options.isChat)return n;else return t},_setPersonActivity:function(){this._dialogController.setPersonActivityConstructor(i)}})});
//# sourceMappingURL=ThemeMessagesBase.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.DialogMessages",["Core/core-merge","js!SBIS3.Contacts.Mixins.Interface.ThemeMessagesBase"],function(e,s){"use strict";return e(e({},s,{clone:true}),{$protected:{_options:{isChat:false}},_getListType:function(){return"theme"}},{preferSource:false})});
//# sourceMappingURL=DialogMessages.module.js.map
define("js!SBIS3.Contacts.MessageLadder",["js!WS.Data/Display/Ladder"],function(e){"use strict";return e.extend({_isPrimaryIndex:function(e,t){if("DateCheck1"!==t&&(0===e||e===this._offset))return true;var a=false,n=this._collection.at(e-1),s=n&&n.getContents(),c=this._collection.at(e).getContents(),i=s&&s.get&&s.get("DateCheck"),r=s&&s.get&&s.get("DateCheck1"),g=c.get&&c.get("DateCheck"),h=c.get&&c.get("DateCheck1");if("DateCheck"===t)a=r?g!==r:g!==i;else if("DateCheck1"===t)a=g!==h;return a}})});
//# sourceMappingURL=Ladder.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.DateLadder",["js!WS.Data/Display/Ladder","js!SBIS3.Contacts.MessageLadder"],function(e,t){"use strict";return{$protected:{_options:{ladder:["DateCheck","DateCheck1"],isPairsMessage:void 0,_buildTplArgs:function(e){var t=e._buildTplArgsTDG?e._buildTplArgsTDG.call(this,e):e._buildTplArgsLV.call(this,e);return t.ladder=e._ladderInstance,t}}},changeDateLadderInstance:function(s){this._options._ladderInstance=s?new t:new e},around:{_modifyOptions:function(s,i,n){return i=s.call(this,i,n),i._ladderInstance=i.isPairsMessage?new t:new e,i}},before:{init:function(){this.subscribeTo(this,"onItemsReady",function(){var e=this._getItemsProjection();if(e)if(this._options._ladderInstance.setCollection(e),this._options._serverRender&&!this._isAlived)this._isAlived=true,this.redraw()}),this.subscribeTo(this,"onDestroy",function(){if(this._options._ladderInstance)this._options._ladderInstance=null})}},after:{constructor:function(){this._column2primaryId={DateCheck:{},DateCheck1:{}}}}}});
//# sourceMappingURL=DateLadder.module.js.map
define("js!SBIS3.Contacts.ClickController",["Contacts.Base/Utils/Manager/Base"],function(e){var i=e.extend({$protected:{_options:{}},init:function(){i.superclass.init.call(this),this._initListeners()},_initListeners:function(){var e=this.getView();if(e)this.subscribeTo(e,"onItemClick",this._onItemClickHandler.bind(this))},_onItemClickHandler:function(e,i,t,n,s,a){var o=n.classList,r={"visible-date":this._onDateBlockClickHandler,"message-person-name":this._onPersonNameClickHandler};for(var c in r)if(r.hasOwnProperty(c)&&o.contains(c))r[c].apply(this,arguments)},_onDateBlockClickHandler:function(e,i,t,n,s,a){var o=n&&n.dataset,r=o&&"true"===o.clickable,c=o&&o.themeguid,l=o&&o.messageguid;if(s&&s.preventDefault(),r&&c&&l)require(["js!Emoji/Actions/OpenPanel"],function(e){e({endpoint:"Сообщение",queryMethod:"СписокУчастниковДляПанелиАктивности",readMethod:"ИнформацияДляПанелиАктивности",object:l,additionalFilter:{Theme:c},tabs:{ViewUnique:true}})}),e.setResult(false)},_onPersonNameClickHandler:function(e,i,t,n,s,a){var o=this.getView(),r=n&&n.dataset,c=r&&"true"===r.clickable,l=r&&r.personguid;if(c&&l&&o&&"function"===typeof o.consume||false)o.consume("changeReceivers",{receivers:[l]})}});return i});
//# sourceMappingURL=ClickController.module.js.map
define("js!SBIS3.CONTROLS.ListView",["SBIS3.CONTROLS/ListView"],function(i){return i});
//# sourceMappingURL=ListView.module.js.map
define("js!SBIS3.Contacts.Views.DialogView",["Core/core-extend","js!SBIS3.CONTROLS.ListView","js!SBIS3.Contacts.Mixins.Interface.DialogMessages","js!SBIS3.Contacts.Mixins.Interface.MessageActions.Delete","js!SBIS3.Contacts.Mixins.Services.Consumer","js!SBIS3.Contacts.Mixins.Interface.MessageClick.Dialog","js!SBIS3.Contacts.Mixins.Interface.MessageActions.EditMessage","js!SBIS3.Contacts.Mixins.Interface.EmptyViewInfo","js!SBIS3.Contacts.Mixins.Interface.MessageActions.Quote","js!SBIS3.Contacts.Mixins.Interface.DateLadder","js!SBIS3.Contacts.Mixins.Interface.OpenFoundPosition","js!SBIS3.Contacts.ClickController","Core/Deferred","js!SBIS3.Contacts.MessagesExchangeEvents","Core/UserInfo","i18n!SBIS3.Contacts.Views.DialogView"],function(e,t,s,n,i,o,a,c,r,f,l,u,S,g,C){"use strict";var I=t.extend({$protected:{_options:{name:"DialogView",emptyHTMLView:rk("У вас нет сообщений"),emptySearch:rk("Сообщения не найдены"),messagesListService:{endpoint:"Персона",binding:{query:"СписокСообщенийДляListView"}}},_clickController:null},$constructor:function(){},init:function(){I.superclass.init.call(this),this._clickController=new u({view:this}),this.subscribeTo(this,"onDataLoad",function(e,t){var s=null;if(t.each(function(e){if(!e.get("ПрочитаноВладельцем")[0]&&(!s||s.get("ДатаВремя")[0]>e.get("ДатаВремя")[0]))s=e}),s)t.each(function(e){if(e.get("ДатаВремя")[0]>s.get("ДатаВремя")[0]&&e.get("ПрочитаноВладельцем")[0])e.set("ПрочитаноВладельцем",[false,null])})}),this.subscribeTo(g,"onChangeThemes",function(e,t){if(t.user!==C.get("ИдентификаторСервисаПрофилей")||"read"!==t.state)return;for(var s=0;s<t.changed_themes.length;s++)if(t.changed_themes[s].id==this._getDialogId()){this.getItems().each(function(e){if(!e.get("ПрочитаноВладельцем")[0])e.set("ПрочитаноВладельцем",[true,null])});continue}}.bind(this))},reload:function(e){var t=this,s=new S;if(t._addingCursorOnSearch(e),t._options.noLoad)t._options.noLoad=false,s.callback(true);else{if(t._isSearching(e))if("function"==typeof t.setPositionCursor)t.setPositionCursor(null);else t.setOffset(0);return t._reloadOnOffset(I,e)}return s}});return e.mixin(I,[s,n,r,i,o,a,c,f,l])});
//# sourceMappingURL=Dialog.module.js.map
(function(){"use strict";var e=function(){return this||(0,eval)("this")}(),r=false,n=[];(e.define||e.requirejs&&e.requirejs.define||requirejsVars&&requirejsVars.define)("preload",["Core/ParallelDeferred","Core/IoC","Core/moduleStubs","Core/constants","Core/i18n","Core/detection","Core/Deferred"],function(o,t,i,u,s){if("undefined"==typeof window)return{load:function(e,r,n){n(function(){})}};var f=/lang\/([a-z]{2}-[A-Z]{2})/,a=s.getLang();function l(){if(r)return;r=true;var e=n.splice(0,100);if(!e.length)return void(r=false);var t=new o({maxRunningCount:1,stopOnFirstError:false});(e=e.filter(function(e){var r=e.module.match(f);return!r||r&&r[1]==a})).forEach(function(e){t.push(function(){return i.require(e.module)})}),t.done().getResult().addCallback(function(){r=false,l()})}function d(e){if(e.length)n=n.concat(e),l()}function c(r){if(r=r.filter(function(r){return!e.requirejs.defined(r)}),r.length){var n=new XMLHttpRequest,o=window.wsConfig&&window.wsConfig.appRoot||"/",t=u.buildnumber?"&v="+u.buildnumber:"";n.open("GET",encodeURI(o+"depresolver/?modules="+JSON.stringify(r)+"&lightload=1"+t),true),n.onreadystatechange=function(){if(4==n.readyState)if(n.status>=200&&n.status<400)try{d(JSON.parse(n.responseText))}catch(e){g(e)}else{var e=new Error(n.responseText);e.code=n.status,g(e)}},n.send(null)}}function g(e){if(e.message.indexOf("DOCTYPE")>-1)t.resolve("ILogger").error("Preloader","Unknown error with code: "+e.code);else t.resolve("ILogger").error("Preloader",e.message)}function p(e){c(e)}return{load:function(e,r,n){if(e=e.split(";"),!window.preprocessor)n(function(){i.require(e)});else n(function(){p(e)})}}})})();
//# sourceMappingURL=preload.js.map
define("tmpl!SBIS3.EDO2.RulesSelector",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,n,l,c,i){function a(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};i&&i.isSetts&&(d=i.fullContext||{});var p="string"==typeof l?l:"",v=void 0===r?void 0:r,m={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),y=this&&this.includedTemplates?this.includedTemplates:{},S=u.getMarkupGenerator(c);try{var h=S.joinElements([S.createTag("span",{class:"edo-RulesSelector"},[u.getter(o,["content"])?[S.createControl("resolver",u.getter(o,["content"]),{},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},l,v,y,u.config,d,m)]:S.createText("")],n,m,this)],p,m);m.def&&(h=S.chain(h,m,n),m=void 0)}catch(e){u.templateError("resources/Bazovyj_komponent_dokument/components2/RulesSelector/RulesSelector.tmpl",e,o)}return h||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.EDO2.RulesSelector"}},o});
//# sourceMappingURL=RulesSelector.tmpl.map
define("js!SBIS3.EDO2.RulesSelector",["Core/EventBus","Core/Deferred","SBIS3.CONTROLS/CompoundControl","tmpl!SBIS3.EDO2.RulesSelector","css!SBIS3.EDO2.RulesSelector"],function(e,t,o,s){var n=o.extend({$protected:{_options:{docTypes:[],content:"",dataSource:void 0,showDocTypes:true,createDocWithoutRule:false,showFavorites:true,lazyLoading:false},__isCreatedByDocTypes:false},_dotTplFn:s,$constructor:function(){var t=this;t._publish("onItemsReady"),t.once("onReady",function(){var o=this.getChildControls()[0];if(t._onRulesListChangeHandler=function(){t.__isCreatedByDocTypes=true,t._analizeDataSource()}.bind(t),!t._options.lazyLoading)t._analizeDataSource(),e.channel("Reglaments").subscribe("onChangeListOfReglament",t._onRulesListChangeHandler);else if(o)o.once("onActivated",function(s){if(!t._options.dataSource){var n=o._options.allowChangeEnable;o._options.allowChangeEnable=true,o.setEnabled(false),t._analizeDataSource().addCallback(function(e){if(o.setEnabled(true),o._options.allowChangeEnable=n,t._notify("onItemsReady",e),e&&e.getCount()>0)o._clickHandler(s)})}e.channel("Reglaments").subscribe("onChangeListOfReglament",t._onRulesListChangeHandler)})})},destroy:function(){n.superclass.destroy.apply(this,arguments),e.channel("Reglaments").unsubscribe("onChangeListOfReglament",this._onRulesListChangeHandler)},setDocTypes:function(e){return this._options.docTypes=e,this._options.dataSource=null,this.__isCreatedByDocTypes=false,this._analizeDataSource()},setShowDocTypes:function(e){this._options.showDocTypes=e,this.__isCreatedByDocTypes=true,this._analizeDataSource()},setEnabled:function(e){if(n.superclass.setEnabled.call(this,e),this.getChildControls()[0].setEnabled(e),e&&(!this._options.lazyLoading||this._options.dataSource))this._analizeDataSource()},getHistoryId:function(){var e=this._options.docTypes,t="",o,s;for(s=0;s<e.length;s++)t+=(o=e[s]).docSubType?o.docType+o.docSubType:o.docType;return t},_transformDocTypesFolders:function(e){var t=e.getIndicesByValue("Раздел",null),o,s,n;for(n=0;n<t.length;n++)if(o=e.at(t[n]),o.get("Раздел@")&&-1===e.getIndexByValue("Раздел",o.get("Идентификатор")))s=o.get("ТипДокумента"),o.set({"Раздел@":false,"Идентификатор":-1+", "+s.get("Тип")+s.get("ПодТип")});return e},_analizeDataSource:function(){var e=this,o=new t,s=new t;return require(["js!SBIS3.EDO.DocflowRulesHelpers"],function(t){var n=!e._options.docTypes||!e._options.docTypes.length||!e._options.docTypes[0].docType,a;if(e.isEnabled())if(e._options.dataSource&&!this.__isCreatedByDocTypes)o.callback(e._options.dataSource);else if(!n)a={docTypes:e._options.docTypes,showTypes:e._options.showDocTypes,createDocWithoutRule:e._options.createDocWithoutRule,showFavorites:false},e.__isCreatedByDocTypes=true,t.getRulesList(a).addCallback(function(t){if(e._options.showDocTypes&&e._options.createDocWithoutRule&&e._options.docTypes&&e._options.docTypes.length>1)e._options.dataSource=e._transformDocTypesFolders(t);else e._options.dataSource=t;e.__isCreatedByDocTypes=false,o.callback(t)}).addErrback(function(e){o.errback(e)});o.addCallback(function(t){var o=e.getChildControls()[0],n,a;if(o&&o.setItems)if(n=o.isEnabled(),e.isSelectorEnabled(t)){if(o.setEnabled(n&&true),t.setIdProperty("Идентификатор"),a={idProperty:"Идентификатор",displayProperty:"Название",parentProperty:"Раздел",items:t},e._options.showFavorites)a.historyId=e.getHistoryId(),a.pinned=true,a.frequent=true,a.blParams={blEndpoint:{contract:"RegulationNew"},binding:{query:"List",read:"Read"},displayField:"Название"};o.setProperties(a),s.callback(t)}else o.setEnabled(false)}).addErrback(function(e){return require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(t){t.showMessageDialog({status:"error",message:e.message})}),e})}.bind(this)),s},setShowFavorites:function(e){this._options.showFavorites=e,this.__isCreatedByDocTypes=true,this._analizeDataSource()},isSelectorEnabled:function(e){return e&&e.getCount&&e.getCount()>0},getDataSource:function(){return this._options.dataSource},setDataSource:function(e){return this._options.dataSource=e,this.__isCreatedByDocTypes=false,this._analizeDataSource()}});return n});
//# sourceMappingURL=RulesSelector.module.js.map
define("Lib/File/ResourceGetter/IResourceGetterBase",["require","exports"],function(e,t){"use strict";return function(){function e(){this._isDestroyed=false}return e.prototype.destroy=function(){this._isDestroyed=true},e.prototype.isDestroy=function(){return this._isDestroyed},e.prototype.getType=function(){return this.name||""},e}()});
//# sourceMappingURL=IResourceGetterBase.js.map
define("Lib/File/LocalFileLink",["require","exports"],function(t,e){"use strict";return function(){function t(t,e){this.fileLink=t,this.meta=e}return t.prototype.getLink=function(){return this.fileLink},t.prototype.getMeta=function(){return this.meta},t}()});
//# sourceMappingURL=LocalFileLink.js.map
define("tmpl!SBIS3.CONTROLS/Menu/Menu",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Commands/CommandsSeparator"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Commands/CommandsSeparator"]=e[1];var o=function e(o,n,a,i,l){function s(){}var d=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var m="string"==typeof a?a:"",p=void 0===r?void 0:r,v={id:[],def:void 0},S=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},g=c.getMarkupGenerator(i);try{var C=g.joinElements([g.createTag("div",{class:"controls-Menu"},[g.createTag("div",{class:"controls-Menu__itemsContainer"},[],{},v,this),c.getter(o,["additionalProperty"])?[g.createControl("wsControl","ws:SBIS3.CONTROLS/Commands/CommandsSeparator",{name:"toggleAdditionalItems",command:"toggleAdditionalItems"},{name:"toggleAdditionalItems",sbisname:"toggleAdditionalItems"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},a,p,f,c.config,u)]:g.createText(""),c.getter(o,["footerTpl"])?[g.createTag("div",{class:"controls-Menu__footer"},[g.createControl("resolver",c.getter(o,["footerTpl"]),c.uniteScope(c.utils.escape(c.uniteScope(o,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},a,p,f,c.config,u,v)],{},v,this)]:g.createText("")],n,v,this)],m,v);v.def&&(C=g.chain(C,v,n),v=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/Menu/Menu.tmpl",e,o)}return C||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Menu/Menu"}},o});
//# sourceMappingURL=Menu.tmpl.map
define("SBIS3.CONTROLS/Mixins/hierarchyMixin",["Core/core-clone","WS.Data/Relation/Hierarchy","Core/IoC"],function(t,e,o){return{$protected:{_previousRoot:null,_curRoot:null,_hier:[],_options:{root:void 0,parentProperty:null,nodeProperty:null,displayType:"all"}},$constructor:function(){var t=this.getFilter()||{};if(this._publish("onSetRoot","onBeforeSetRoot"),"undefined"!=typeof this._options.root)this._curRoot=this._options.root,t[this._options.parentProperty]=this._options.root;this._previousRoot=this._curRoot,this.setFilter(t,true)},setHierField:function(t){o.resolve("ILogger").log("hierarchyMixin","Метод setHierField устарел, используйте setParentProperty/setNodeProperty"),this.setParentProperty(t)},getHierField:function(){return o.resolve("ILogger").log("hierarchyMixin","Метод getHierField устарел, используйте getParentProperty/getNodeProperty"),this.getParentProperty()},setParentProperty:function(t){this._options.parentProperty=t},getParentProperty:function(){return this._options.parentProperty},setNodeProperty:function(t){this._options.nodeProperty=t},getNodeProperty:function(){return this._options.nodeProperty},hierIterate:function(t,o,r){var i=new e({idProperty:t.getIdProperty(),parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty}),s="undefined"!=typeof this._curRoot?this._curRoot:null,n=[],p=0,h=function(e){if(n.indexOf(e)>-1){var r='Recursive hierarchy structure detected: node with id "'+e+'" has link to itself';if(n.map)r+=" (",n.push(e),r+=n.map(function(t){return""+t}).join(" -> "),r+=")";throw new Error(r)}n.push(e);for(var s=i.getChildren(e,t),a=0;a<s.length;a++){var _=s[a];o.call(this,_,e,p),p++,h(_.getId()),p--}n.pop()};h(s)},_getRecordsForRedraw:function(){return this._getRecordsForRedrawCurFolder()},_getRecordsForRedrawCurFolder:function(){var t=[],e=this;if(!Object.isEmpty(this._options.groupBy)&&this._options.groupBy.field===this._searchParamName)return this._normalizeItems(this._items);var o=this._options.openedPath;return this.hierIterate(this._items,function(r){var i=r.get(e._options.parentProperty);if(i==e._curRoot||o[i])if("folders"==e._options.displayType){if(r.get(e._options.nodeProperty))t.push(r)}else t.push(r)}),t},getParentKey:function(t,e){return e.get(this._options.parentProperty)},setRoot:function(t){this._options.root=t},getCurrentRoot:function(){return this._curRoot},setCurrentRoot:function(t){var e=this.getFilter()||{};if(t)e[this._options.parentProperty]=t;else if(this._options.root)e[this._options.parentProperty]=this._options.root;else delete e[this._options.parentProperty];if(this.setFilter(e,true),this._hier=this._getHierarchy(this._items,t),this._offset=0,this._notify("onBeforeSetRoot",t),this._curRoot=t||this._options.root,this._itemsProjection)this._itemsProjection.setRoot(this._curRoot||null)},after:{_dataLoadedCallback:function(){var e=this._items.getMetaData().path,o=t(this._hier),r;if(e)o=this._getHierarchy(e,this._curRoot);if(this._notify("onSetRoot",this._curRoot,o),this._previousRoot!==this._curRoot){if(this.getItems().getRecordById(this._previousRoot))this.setSelectedKey(this._previousRoot),this._scrollToItem(this._previousRoot);else if(r=this.getItems()&&this.getItems().at(0),r)this.setSelectedKey(r.getId()),this._scrollToItem(r.getId());this._previousRoot=this._curRoot}}},_getHierarchy:function(t,e){var o,r,i=[];if(t)do{if(o=t.getRecordById(e),r=o?o.get(this._options.parentProperty):null,o)i.push({id:e||null,parent:r,title:o.get(this._options.displayProperty),color:this._options.colorField?o.get(this._options.colorField):"",data:o});e=r}while(e);return i},_dropPageSave:function(){var t=this._options.root;this._pageSaver={},this._pageSaver[t]=0},_activateItem:function(t){var e={id:t,item:this._items.getRecordById(t),hierField:this._options.parentProperty,parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty};this._notify("onItemActivate",e)}}});
//# sourceMappingURL=hierarchyMixin.js.map
define("SBIS3.CONTROLS/Mixins/TreeMixinDS",["Core/core-clone","Core/core-merge","Core/constants","Lib/Control/Control","SBIS3.CONTROLS/BreadCrumbs","tmpl!SBIS3.CONTROLS/DataGridView/resources/DataGridViewGroupBy","WS.Data/Display/Tree","WS.Data/Relation/Hierarchy","Core/helpers/Function/forAliveOnly"],function(t,e,o,i,s,r,a,n,l){var h={$protected:{_folderOffsets:{},_folderHasMore:{},_treePagers:{},_treePager:null,_options:{singleExpand:false,expand:false,partialyReload:true,openedPath:{},folderFooterTpl:void 0,allowEnterToFolder:true},_foldersFooters:{},_breadCrumbs:[],_lastParent:void 0,_lastDrawn:void 0,_lastPath:[],_loadedNodes:{}},$constructor:function(){var t=this.getFilter()||{};if(this._publish("onSearchPathClick","onNodeExpand","onNodeCollapse"),this._options.expand)t["Разворот"]="С разворотом",t["ВидДерева"]="С узлами и листьями";this.setFilter(t,true)},_createDefaultProjection:function(t){var e;if("undefined"!=typeof this._curRoot)e=this._curRoot;else if("undefined"!=typeof this._options.root)e=this._options.root;else e=null;this._itemsProjection=new a({collection:t,idProperty:this._options.idProperty||(this._dataSource?this._dataSource.getIdProperty():""),parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty,unique:true,root:e})},_getHierarchyRelation:function(t){return new n({idProperty:t||(this._items?this._items.getIdProperty():""),parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty})},_getRecordsForRedraw:function(){var t=this,e=[];if(this._options.expand)this.hierIterate(this._items,function(o){if("folders"==t._options.displayType){if(o.get(t._options.nodeProperty))e.push(o)}else e.push(o)});else return this._getRecordsForRedrawCurFolder();return e},collapseNode:function(t){if(!this.getOpenedPath()[t])return;this._drawExpandArrow(t,false),this._collapseChilds(t),delete this._options.openedPath[t],this._nodeClosed(t),this._updateItemsToolbar(),this._notify("onNodeCollapse",t)},_collapseChilds:function(t){for(var e=this._options.idProperty||(this._dataSource?this._dataSource.getIdProperty():""),o=this._getHierarchyRelation(e).getChildren(t,this._items),i,s=0;s<o.length;s++)i=o[s].get(e),this._collapseChilds(i),delete this._options.openedPath[i]},toggleNode:function(t){this[this.getOpenedPath()[t]?"collapseNode":"expandNode"](t)},_findExpandByElement:function(t){if(t.hasClass("js-controls-TreeView__expand"))return t;else{var e=t.closest(".js-controls-TreeView__expand");if(t.closest(".js-controls-TreeView__expand").length)return e;else return t}},_createTreeFilter:function(e){var o=t(this.getFilter())||{};if(this._options.expand)o["Разворот"]="С разворотом",o["ВидДерева"]="Узлы и листья";return this.setFilter(t(o),true),o[this._options.parentProperty]=e,o},expandNode:function(t){if(!this._options.openedPath[t]){var e=this;if(this._folderOffsets[t||"null"]=0,this._options.openedPath[t]=true,this._closeAllExpandedNode(t),!this._loadedNodes[t]&&this._options.partialyReload)return this._toggleIndicator(true),this._notify("onBeforeDataLoad",this.getFilter(),this.getSorting(),0,this._limit),this._callQuery(this._createTreeFilter(t),this.getSorting(),0,this._limit).addCallback(function(o){e._folderHasMore[t]=o.getMetaData().more,e._loadedNodes[t]=true,e._notify("onDataMerge",o),e._toggleIndicator(false),e._nodeDataLoaded(t,o),e._notify("onNodeExpand",t)});else{var o=this._getHierarchyRelation().getChildren(t,this._items);this._drawLoadedNode(t,o,this._folderHasMore[t]),this._notify("onNodeExpand",t)}}},_closeAllExpandedNode:function(t){if(this._options.singleExpand)for(var e in this._options.openedPath)if(this._options.openedPath.hasOwnProperty(e))if(t!==e)this.collapseNode(e)},getOpenedPath:function(){return this._options.openedPath},_drawLoadedNode:function(t,e){this._drawExpandArrow(t);for(var o=0;o<e.length;o++){var i=e[o],s=this._getTargetContainer(i);if(s)if("folders"==this._options.displayType){if(i.get(this._options.nodeProperty))this._drawAndAppendItem(i,s)}else this._drawAndAppendItem(i,s)}this._updateItemsToolbar()},_drawExpandArrow:function(t,e){var o=$('.controls-ListView__item[data-id="'+t+'"]',this.getContainer().get(0));$(".js-controls-TreeView__expand",o).first().toggleClass("controls-TreeView__expand__open",e)},_nodeDataLoaded:function(t,e){var o=this;this._needToRedraw=false,this._items.merge(e,{remove:false}),this._needToRedraw=true;var i=[];e.each(function(t){i.push(t)}),o._drawLoadedNode(t,i,o._folderHasMore[t])},around:{_addItem:function(t,e,o){var i=e.getContents().get(this._options.parentProperty);if(this._options.openedPath[i]||i==this._curRoot)t.call(this,e,o)},_isViewElement:function(t,e){return t.call(this,e)&&!e.hasClass("controls-HierarchyDataGridView__path")&&!(e.wsControl()instanceof s)}},_nodeClosed:function(t){},_folderLoad:function(t){var e=this,o=t?this._createTreeFilter(t):this.getFilter();this._notify("onBeforeDataLoad",o,this.getSorting(),(t?this._folderOffsets[t]:this._folderOffsets["null"])+this._limit,this._limit),this._loader=this._callQuery(o,this.getSorting(),(t?this._folderOffsets[t]:this._folderOffsets["null"])+this._limit,this._limit,"down").addCallback(l(function(o){if(e._notify("onDataMerge",o),e._loader=null,t)e._folderOffsets[t]+=e._limit;else e._folderOffsets["null"]+=e._limit;if(e._folderHasMore[t]=o.getMetaData().more,!e._hasNextPageInFolder(o.getMetaData().more,t)){if("undefined"!=typeof t)e._treePagers[t].setHasMore(false);else e._treePager.setHasMore(false);e._hideLoadingIndicator()}if(o.getCount())e._items.merge(o,{remove:false}),e._drawItemsFolderLoad(this._normalizeItems(o),t),e._dataLoadedCallback()},e)).addErrback(function(t){return t})},_drawItemsFolderLoad:function(t){this._drawItems(t)},_createFolderPager:function(t,e,o){var i=this,s=this._hasNextPageInFolder(o,t);if(this._options.pageSize)this._treePagers[t]=new d({pageSize:this._options.pageSize,opener:this,parent:this,hasMore:s,element:e,id:t,handlers:{onClick:function(){i._folderLoad(this._options.id)}}})},_hasNextPageInFolder:function(t,e){if(!e)return"boolean"!==typeof t?t>this._folderOffsets["null"]+this._options.pageSize:!!t;else return"boolean"!==typeof t?t>this._folderOffsets[e]+this._options.pageSize:!!t},_createFolderFooter:function(t){var e=this._options.folderFooterTpl,o=this._getFolderFooterOptions(t),i=$('<div class="controls-TreeView__folderFooterContainer">'+(e?e(o):"")+"</div>");this._destroyFolderFooter([t]),this._createFolderPager(t,$('<div class="controls-TreePager-container">').appendTo(i),o.more),this._foldersFooters[t]=i},_getFolderFooterOptions:function(t){return{keys:t,more:this._folderHasMore[t]}},_destroyFolderFooter:function(t){var e,o=this;t.forEach(function(t){if(o._foldersFooters[t]){e=o._foldersFooters[t].find(".ws-component");for(var i=0;i<e.length;i++)e[i].wsControl.destroy();o._foldersFooters[t].remove(),delete o._foldersFooters[t]}})},before:{reload:function(){this._folderOffsets["null"]=0,this._lastParent=void 0,this._lastDrawn=void 0,this._lastPath=[],this._loadedNodes={}},_keyboardHover:function(t){switch(t.which){case o.key.m:t.ctrlKey&&this.moveRecordsWithDialog()}},_dataLoadedCallback:function(){if(this._options.expand){var t=this._getHierarchyRelation(),e=this._items,o=this._options.openedPath;e.each(function(i){var s=i.getId();if(t.getChildren(i,e).length&&"null"!=s&&s!=this._curRoot)o[s]=true})}},destroy:function(){if(this._treePager)this._treePager.destroy()},_clearItems:function(t){if(this._getItemsContainer().get(0)==$(t).get(0)||!t){this._lastParent=this._curRoot,this._lastDrawn=void 0,this._lastPath=[],this._destroySearchBreadCrumbs();for(var e in this._foldersFooters)if(this._foldersFooters.hasOwnProperty(e))this._destroyFolderFooter([e])}}},after:{_modifyOptions:function(t){var e=t.folderFooterTpl;if(e&&"string"===typeof e&&e.match(/^html!/))t.folderFooterTpl=require(e);return t}},_elemClickHandlerInternal:function(t,e,o){var i=$(o).closest(".controls-ListView__item").data("id");if(this._findExpandByElement($(o)).hasClass("js-controls-TreeView__expand"))this.toggleNode(i);else if(this._options.allowEnterToFolder&&t.get(this._options.nodeProperty))this.setCurrentRoot(i),this.reload();else this._activateItem(e)},getSearchGroupBy:function(t){return{field:t,template:r,method:this._searchMethod.bind(this),render:this._searchRender.bind(this)}},_searchMethod:function(t,e,o){var i,s,r=false,a=-1;if(void 0===this._lastParent)this._lastParent=this._curRoot;if(i=t.getId(),s=t.get(this._options.parentProperty),s=s instanceof Array?s[0]:s,s==this._lastParent){if(true!==t.get(this._options.nodeProperty)){if("leaf"!==this._lastDrawn&&this._lastPath.length)this._drawGroup(t,e);this._lastDrawn="leaf",r=true}else if(this._lastDrawn=void 0,this._lastPath.push(t),this._lastParent=i,o)this._drawGroup(t,e),this._lastPath=[],this._lastParent=this._curRoot}else{a=-1;for(var n=0;n<this._lastPath.length;n++)if(this._lastPath[n].getId()==s){a=n;break}if("leaf"!==this._lastDrawn&&this._lastPath.length)this._drawGroup(t,e);if(this._lastDrawn=void 0,this._lastPath=a>=0?this._lastPath.slice(0,a+1):[],true!==t.get(this._options.nodeProperty)){if(this._lastPath.length)this._drawGroup(t,e);r=true,this._lastDrawn="leaf",this._lastParent=s}else if(this._lastDrawn=void 0,this._lastPath.push(t),this._lastParent=i,o)this._drawGroup(t,e),this._lastPath=[],this._lastParent=this._curRoot}return{drawItem:r,drawGroup:false}},_searchRender:function(t,e){return this._drawBreadCrumbs(this._lastPath,t,e),e},_drawBreadCrumbs:function(t,o,i){if(t.length){var r=this,a,n=this._options.groupBy,l,h=i.find("td");if(h.append(a=$('<div style="width:'+h.width()+'px"></div>')),l={element:a,items:this._createPathItemsDS(t),parent:this.getTopParent(),highlightEnabled:this._options.highlightEnabled,highlightText:this._options.highlightText,colorMarkEnabled:this._options.colorMarkEnabled,colorField:this._options.colorField,className:"controls-BreadCrumbs__smallItems",enable:this._options.allowEnterToFolder},n.hasOwnProperty("breadCrumbsTpl"))l.itemTemplate=n.breadCrumbsTpl;var d=new s(l);d.once("onItemClick",function(t,o){if(t.setResult(false),this.isEnabled()&&false!==r._notify("onSearchPathClick",o)){var i=e(r.getFilter(),{"Разворот":"Без разворота"});if(r._options.groupBy.field)i[r._options.groupBy.field]=void 0;r.setInfiniteScroll(r._options.infiniteScroll,true),r.setGroupBy({}),r.setHighlightText("",false),r.setFilter(i,true),r.setCurrentRoot(o),r.reload()}}),this._breadCrumbs.push(d)}else i.remove()},_createPathItemsDS:function(t){for(var e=[],o,i=0;i<t.length;i++)o=t[i].get(this._options.parentProperty),e.push({id:t[i].getId(),title:t[i].get(this._options.displayProperty),parentId:o instanceof Array?o[0]:o,data:t[i]});return e},_destroySearchBreadCrumbs:function(){for(var t=0;t<this._breadCrumbs.length;t++)this._breadCrumbs[t].destroy();this._breadCrumbs=[]}},d=i.Control.extend({$protected:{_options:{id:null,pageSize:20,hasMore:false}},$constructor:function(){this._container.addClass("controls-TreePager"),this.setHasMore(this._options.hasMore)},setHasMore:function(t){if(this._options.hasMore=t,this._options.hasMore)this._container.html("Еще "+this._options.pageSize);else this._container.empty()}});return h});
//# sourceMappingURL=TreeMixinDS.js.map
define("tmpl!SBIS3.CONTROLS/Menu/MenuItem/MenuItem",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={},r=function e(r,o,s,a,i){function c(){}var l=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var u={};i&&i.isSetts&&(u=i.fullContext||{});var d="string"==typeof s?s:"",m=void 0===n?void 0:n,g={id:[],def:void 0},v=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),f=this&&this.includedTemplates?this.includedTemplates:{},M=p.getMarkupGenerator(a);try{var I=M.joinElements([M.createTag("span",{class:"controls-MenuItem"+p.wrapUndef(p.utils.escape(p.getter(r,["historyItem"])&&p.getter(r,["pinned"])?" controls-Menu-item-user-pinned":""))+p.wrapUndef(p.utils.escape(p.getter(r,["groupSeparator"])?" control-SbisMenu-item__historySeparator":"")),title:""+p.wrapUndef(p.utils.escape(p.getDecorators().escapeTagsFromStr.apply(void 0,[p.getDecorators().orEmpty.apply(void 0,[p.getter(r,["tooltip"])]),""])))},[M.createTag("span",{class:"controls-MenuItem__content"},[p.getter(r,["icon"])?[M.createTag("i",{class:"controls-MenuItem__icon icon-size js-controls-MenuItem__icon "+p.wrapUndef(p.utils.escape(p.getter(r,["_iconClass"]))),unselectable:"on"},[],{},g,this)]:M.createText(""),p.getter(r,["caption"])?[M.createTag("span",{class:"controls-MenuItem__text js-controls-MenuItem__text",unselectable:"on"},[M.createText(""+p.wrapUndef(p.Sanitize.apply(void 0,[p.getDecorators().sanitize.apply(void 0,[p.getter(r,["caption"]),p.getter(r,["_sanitizeOpts"])])])))],{},g,this)]:M.createText("")],{},g,this),void 0!==p.getter(r,["pinned"])?[M.createTag("span",{class:""+p.wrapUndef(p.utils.escape(!p.getter(r,["pinned"])||p.getter(r,["historyItem"])&&p.getter(r,["pinned"])?"controls-Menu-item-pin":""))},[],{},g,this)]:M.createText("")],o,g,this)],d,g);g.def&&(I=M.chain(I,g,o),g=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/Menu/MenuItem/MenuItem.tmpl",e,r)}return I||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Menu/MenuItem/MenuItem"}},r});
//# sourceMappingURL=MenuItem.tmpl.map
define("SBIS3.CONTROLS/Menu/MenuItem",["js!WSControls/Buttons/ButtonBase","tmpl!SBIS3.CONTROLS/Menu/MenuItem/MenuItem","Core/EventBus","Core/Sanitize","css!SBIS3.CONTROLS/Menu/MenuItem/MenuItem"],function(n,t,o,e){"use strict";var i=n.extend({_dotTplFn:t,$protected:{_options:{escapeCaptionHtml:false,_sanitizeOpts:{validNodes:{component:true}}},_iconContainer:void 0},$constructor:function(){this._iconContainer=$(".js-controls-MenuItem__icon",this.getContainer()),this._container.on("mousedown focus",this._blockFocusEvents)},_blockFocusEvents:function(n){var t=o.channel("WindowChangeChannel");if(n.preventDefault(),n.stopPropagation(),"mousedown"===n.type)t.notify("onDocumentClick",n)},setCaption:function(n){i.superclass.setCaption.call(this,n),this._options.caption=e(this._options.caption,{validNodes:{component:true}});var t=$(".js-controls-MenuItem__text",this._container);if(this._options.caption)if(t.length)t.html(this._options.caption)},setIcon:function(){this._iconContainer&&this._iconContainer.removeClass(this._options._iconClass),i.superclass.setIcon.apply(this,arguments)},_drawIcon:function(){this._iconContainer&&this._iconContainer.addClass(this._options._iconClass)}});return i});
//# sourceMappingURL=MenuItem.js.map
define("tmpl!SBIS3.CONTROLS/Commands/CommandsSeparator",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,a,n,s,d){function i(){}var c=0,l=void 0!==t&&t?t:arguments[arguments.length-1];void 0===l&&(eval("var thelpers = null;"),l=global.requirejs("View/Runner/tclosure"));var m={};d&&d.isSetts&&(m=d.fullContext||{});var S="string"==typeof n?n:"",u=void 0===r?void 0:r,p={id:[],def:void 0},C=l.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},v=l.getMarkupGenerator(s);try{var O=v.joinElements([v.createTag("div",{class:"controls-CommandsSeparator "+l.wrapUndef(l.utils.escape(l.getter(o,["checked"])?" controls-Checked__checked":""))},[v.createTag("span",{class:"controls-CommandsSeparator-icon"},[],{},p,this)],a,p,this)],S,p);p.def&&(O=v.chain(O,p,a),p=void 0)}catch(e){l.templateError("resources/SBIS3.CONTROLS/Commands/CommandsSeparator.tmpl",e,o)}return O||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Commands/CommandsSeparator"}},o}),define("SBIS3.CONTROLS/Commands/CommandsSeparator",["js!WSControls/Buttons/ButtonBase","SBIS3.CONTROLS/Mixins/Checkable","tmpl!SBIS3.CONTROLS/Commands/CommandsSeparator","css!SBIS3.CONTROLS/Commands/CommandsSeparator"],function(e,t,r){"use strict";return e.extend([t],{_dotTplFn:r,$protected:{}})});
//# sourceMappingURL=CommandsSeparator.tmpl.map
define("SBIS3.CONTROLS/Commands/CommandsSeparator",["js!WSControls/Buttons/ButtonBase","SBIS3.CONTROLS/Mixins/Checkable","tmpl!SBIS3.CONTROLS/Commands/CommandsSeparator","css!SBIS3.CONTROLS/Commands/CommandsSeparator"],function(t,n,o){"use strict";return t.extend([n],{_dotTplFn:o,$protected:{}})});
//# sourceMappingURL=CommandsSeparator.js.map
define("SBIS3.CONTROLS/Menu",["Core/CommandDispatcher","SBIS3.CONTROLS/Button/ButtonGroup/ButtonGroupBaseDS","tmpl!SBIS3.CONTROLS/Menu/Menu","SBIS3.CONTROLS/Mixins/hierarchyMixin","SBIS3.CONTROLS/Mixins/TreeMixinDS","SBIS3.CONTROLS/FloatArea","WS.Data/Relation/Hierarchy","Core/helpers/markup-helpers","Core/Sanitize","Core/helpers/String/escapeHtml","Core/IoC","Core/core-merge","SBIS3.CONTROLS/Commands/CommandsSeparator","SBIS3.CONTROLS/Menu/MenuItem","css!SBIS3.CONTROLS/Menu/Menu"],function(t,e,n,i,o,s,r,a,u,l,c,h){"use strict";var d=e.extend([i,o],{_dotTplFn:n,$protected:{_subContainers:{},_subMenus:{},_toggleAdditionalButton:null,_needShowToggleButton:false,_options:{showDelay:null,hideDelay:null,displayProperty:"title",expand:true,additionalProperty:null}},_modifyOptions:function(t){if(t.hierField)c.resolve("ILogger").log("Menu","Опция hierField является устаревшей, используйте parentProperty"),t.parentProperty=t.hierField;if(t.parentProperty&&!t.nodeProperty)t.nodeProperty=t.parentProperty+"@";return d.superclass._modifyOptions.apply(this,arguments)},$constructor:function(){this._publish("onMenuItemActivate"),t.declareCommand(this,"toggleAdditionalItems",this._toggleAdditionalItems)},init:function(){d.superclass.init.apply(this,arguments),this._container.on("mousedown focus",this._blockFocusEvents)},_toggleAdditionalItems:function(){this.getContainer().toggleClass("controls-Menu-showAdditionalItems"),this.recalcPosition(true)},_blockFocusEvents:function(t){t.preventDefault(),t.stopPropagation()},_getItemTemplate:function(t){var e=u(t.get(this._options.displayProperty),{validNodes:{component:true}}),n=this._getItemConfig({},t);if(t.get("escapeCaptionHtml"))e=l(e);if(this._options.additionalProperty&&t.get(this._options.additionalProperty))n.className=(n.className?n.className:"")+" controls-MenuItem-additional",this._needShowToggleButton=true;return'<component data-component="SBIS3.CONTROLS/Menu/MenuItem" config="'+a.encodeCfgAttr(n)+'">'+'<option name="caption" type="string">'+e+"</option>"+"</component>"},_getItemConfig:function(t,e){var n=e.get("enabled"),i=e.get("visible"),o={className:e.get("className"),activableByClick:false,command:e.get("command"),commandArgs:e.get("commandArgs"),enabled:void 0===n?true:n,visible:void 0===i?true:i,icon:e.get("icon"),tooltip:e.get("tooltip"),allowChangeEnable:void 0!==e.get("allowChangeEnable")?e.get("allowChangeEnable"):this._options.allowChangeEnable};return h(t||{},o)},_itemActivatedHandler:function(t,e){if(!this.getItemInstance(t).getContainer().hasClass("controls-Menu__hasChild"))for(var n in this._subMenus)if(this._subMenus.hasOwnProperty(n))this._subMenus[n].hide();this._notify("onMenuItemActivate",t,e)},_getTargetContainer:function(t){if(!this._options.parentProperty)return this._getItemsContainer();else{var e=t.get(this._options.parentProperty);if(null===e||void 0===e)return this._getItemsContainer();else{if(!this._subContainers[e])this._subContainers[e]=$('<div class="controls-Menu__submenu" data-parId="'+e+'"></div>').hide(),this._subContainers[e].parentCtrl=this,this._subContainers[e].appendTo(this._container);return this._subContainers[e]}}},_getItemsContainer:function(){return $(".controls-Menu__itemsContainer",this._container)},_drawItems:function(){this.destroySubObjects(),this._checkIcons(),this._needShowToggleButton=false,d.superclass._drawItems.apply(this,arguments),this._checkAdditionalItems()},_checkIcons:function(){var t=this._options.parentProperty,e=this._options.nodeProperty,n=new r({idProperty:this._items.getIdProperty(),parentProperty:t,nodeProperty:e}),i=["icon-16","icon-24","icon-32","icon-small","icon-medium","icon-large","icon-size"],o,s={},a,u,l,c,h;this._items.each(function(e){if(h=e.get("icon"),h)if(l=e.get(t),!s.hasOwnProperty(l))i.forEach(function(t){if(-1!==h.indexOf(t))o=t}),s[l]=[l,o]});for(var d in s)if(s.hasOwnProperty(d))for(a=n.getChildren(s[d][0],this._items),c=0;c<a.length;c++)if(u=a[c],!u.get("icon"))u.set("icon",s[d][1])},_checkAdditionalItems:function(){if(this._options.additionalProperty)this._toggleAdditionalButton=this.getChildControlByName("toggleAdditionalItems"),this._toggleAdditionalButton[this._needShowToggleButton?"show":"hide"]()},_drawItemsCallback:function(){var t=this.getItemsInstances(),e=this;for(var n in this._subContainers)if(this._subContainers.hasOwnProperty(n)){var i=this._subContainers[n].parentCtrl,o=this._subContainers[n].attr("data-parId");i.getItemInstance(o).getContainer().addClass("controls-Menu__hasChild")}var s=this.getItemsInstances();for(n in s)if(s.hasOwnProperty(n))s[n].getContainer().hover(function(t){var n=false,i=$(this).attr("data-id"),o=e._items.getRecordById(i),s=null,r;if(e._options.parentProperty)s=o.get(e._options.parentProperty);if(s)r=e._subMenus[s];else r=e,n=true;var a;if(e._subContainers[i]){if(!e._subMenus[i])e._subMenus[i]=e._createSubMenu(this,r,n,o),e._subMenus[i]._container.on("mousedown focus",e._blockFocusEvents),e._subContainers[i].show(),e._subMenus[i].getContainer().append(e._subContainers[i]);(a=e._subMenus[i]).show()}});d.superclass._drawItemsCallback.apply(this,arguments)},_createSubMenu:function(t,e,n,i){var o=this._getSubMenuConfig(n,i),r;return t=$(t),o.element=$('<div class="controls-Menu__SubMenuPopup '+this.getClassName()+'"></div>'),o.parent=e,o.opener="function"==typeof e.getOpener?e.getOpener():e,o.target=t,o._fixJqueryPositionBug=true,r=new s(o),r},_getSubMenuConfig:function(t,e){var n={corner:"tr",verticalAlign:{side:"top"},horizontalAlign:{side:"left"},allowOverlapTarget:true,handlers:{onShow:function(){this._notify("onNodeExpand",this._options.item.getId())},onClose:function(){this._notify("onNodeCollapse",this._options.item.getId())}},closeByExternalOver:true,targetPart:true,item:e};return n=this._onMenuConfig(n,t,e),n},_onMenuConfig:function(t,e,n){var i;if(e)i="down";if(n.get("direction"))i=n.get("direction");if(i)switch(i){case"down":t.corner="bl";break;case"up":t.corner="tl",t.verticalAlign.side="bottom";break;case"right":t.corner="tl",t.horizontalAlign.side="right"}return t},_setVisibility:function(t){if(d.superclass._setVisibility.apply(this,arguments),t)this._resizeChilds()},destroy:function(){d.superclass.destroy.call(this),this.destroySubObjects()},destroySubObjects:function(){this._subMenus={},this._subContainers={};for(var t in this._subMenus)if(this._subMenus.hasOwnProperty(t))this._subMenus[t].destroy()}});return d});
//# sourceMappingURL=Menu.js.map
define("SBIS3.CONTROLS/Menu/ContextMenu",["SBIS3.CONTROLS/Menu","SBIS3.CONTROLS/Mixins/PopupMixin"],function(n,t){"use strict";var i=n.extend([t],{_modifyOptions:function(){var n=i.superclass._modifyOptions.apply(this,arguments);return n.className+=" controls-Menu__Popup",n},_itemActivatedHandler:function(n,t){if(!this._isItemHasChild(n)){this.hide();for(var i in this._subMenus)if(this._subMenus.hasOwnProperty(i))this._subMenus[i].hide()}this._notify("onMenuItemActivate",n,t)},_onMenuConfig:function(n){return n},_drawItemsCallback:function(){i.superclass._drawItemsCallback.apply(this,arguments),this.recalcPosition(true)},_isItemHasChild:function(n){var t=this.getItemInstance(n);return t&&t.getContainer().hasClass("controls-Menu__hasChild")},_notifyOnSizeChanged:function(){}});return i});
//# sourceMappingURL=ContextMenu.js.map
define("js!SBIS3.FL.Helper",[],function(){var r={_constNameSavedHistory:"fileChooserSavedHistory"},e={"01":rk("Адыгея"),"02":rk("Башкортостан"),"03":rk("Бурятия"),"04":rk("Алтай"),"05":rk("Дагестан"),"06":rk("Ингушетия"),"07":rk("Кабардино-Балкария"),"08":rk("Калмыкия"),"09":rk("Карачаево-Черкессия"),10:rk("Карелия"),11:rk("Коми"),12:rk("Марий Эл"),13:rk("Мордовия"),14:rk("Якутия"),15:rk("Северная Осетия"),16:rk("Татарстан"),17:rk("Тыва"),18:rk("Удмуртия"),19:rk("Хакасия"),20:rk("Чечня"),21:rk("Чувашия"),22:rk("Алтайский край"),23:rk("Краснодарский край"),24:rk("Красноярский край"),25:rk("Приморский край"),26:rk("Ставропольский край"),27:rk("Хабаровский край"),28:rk("Амурская обл"),29:rk("Архангельская обл"),30:rk("Астраханская обл"),31:rk("Белгородская обл"),32:rk("Брянская обл"),33:rk("Владимирская обл"),34:rk("Волгоградская обл"),35:rk("Вологодская обл"),36:rk("Воронежская обл"),37:rk("Ивановская обл"),38:rk("Иркутская обл"),39:rk("Калининградская обл"),40:rk("Калужская обл"),41:rk("Камчатский край"),42:rk("Кемеровская обл"),43:rk("Кировская обл"),44:rk("Костромская обл"),45:rk("Курганская обл"),46:rk("Курская обл"),47:rk("Ленинградская обл"),48:rk("Липецкая обл"),49:rk("Магаданская обл"),50:rk("Московская обл"),51:rk("Мурманская обл"),52:rk("Нижегородская обл"),53:rk("Новгородская обл"),54:rk("Новосибирская обл"),55:rk("Омская обл"),56:rk("Оренбургская обл"),57:rk("Орловская обл"),58:rk("Пензенская обл"),59:rk("Пермский край"),60:rk("Псковская обл"),61:rk("Ростовская обл"),62:rk("Рязанская обл"),63:rk("Самарская обл"),64:rk("Саратовская обл"),65:rk("Сахалинская обл"),66:rk("Свердловская обл"),67:rk("Смоленская обл"),68:rk("Тамбовская обл"),69:rk("Тверская обл"),70:rk("Томская обл"),71:rk("Тульская обл"),72:rk("Тюменская обл"),73:rk("Ульяновская обл"),74:rk("Челябинская обл"),75:rk("Забайкальский край"),76:rk("Ярославская обл"),77:rk("Москва"),78:rk("Санкт-Петербург"),79:rk("Еврейская АО"),83:rk("Ненецкий АО"),86:rk("Ханты-Мансийский АО"),87:rk("Чукотский АО"),89:rk("Ямало-Ненецкий АО"),91:rk("Республика Крым"),92:rk("Севастополь"),99:rk("Байконур")},o={pdf:"icon-TFDocumentPDF icon-error",rtf:"icon-TFDocumentW icon-disabled",doc:"icon-TFDocumentW icon-primary",dotx:"icon-TFDocumentW icon-primary",docx:"icon-TFDocumentW icon-primary",ppt:"icon-TFDocumentP icon-error",pptx:"icon-TFDocumentP icon-error",txt:"icon-TFDocument icon-disabled",log:"icon-TFDocument icon-disabled",xls:"icon-TFDocumentX icon-done",xlsx:"icon-TFDocumentX icon-done",wav:"icon-TFFileAudio icon-primary",mp3:"icon-TFFileAudio icon-primary",mov:"icon-TFFileVideo icon-done",mkv:"icon-TFFileVideo icon-done",wmv:"icon-TFFileVideo icon-done",mp4:"icon-TFFileVideo icon-done",avi:"icon-TFFileVideo icon-done",gif:"icon-TFImage icon-attention",tif:"icon-TFImage icon-attention",tiff:"icon-TFImage icon-attention",jpg:"icon-TFImage icon-attention",jpeg:"icon-TFImage icon-attention",bmp:"icon-TFImage icon-attention",png:"icon-TFImage icon-attention",xml:"icon-TFDocumentXml icon-disabled",rar:"icon-TFZip icon-disabled",tar:"icon-TFZip icon-disabled","7z":"icon-TFZip icon-disabled",zip:"icon-TFZip icon-disabled"},i={folder:"icon-TFFolder icon-attention",unknown:"icon-DocumentUnknownType icon-disabled",xmlCorr:"icon-DocumentXmlEdit icon-disabled"};function n(r){var e=localStorage.getItem(r);return e?JSON.parse(e):[]}function t(r,e){localStorage.setItem(r,JSON.stringify(e))}return{getFolderPathHistory:function(){return n(r._constNameSavedHistory)},setFolderPathHistory:function(e){t(r._constNameSavedHistory,e)},getIcon:function(r){if(o[r])return o[r];else if(i[r])return i[r];return i["unknown"]},getExt:function(r){var e=r.split(".");return e.length<2?"":e[e.length-1].toLowerCase()},getRegionFromKPP:function(r,o){return e[r&&r.slice(0,2)||o&&o.slice(0,2)]||""},getFormatObjFromDraw:function(r,e){if(!r)return false;var o=(r.payerINN?rk("ИНН","formatFiles")+" "+r.payerINN+"    ":"")+(r.payerKPP?rk("КПП","formatFiles")+" "+r.payerKPP+"    ":"")+r.payerRegionName,i=[],n=r.reportName;if(r.reportCorrectionNumber>0&&n)n+=" ("+rk("корр","formatFiles")+". "+r.reportCorrectionNumber+")";return e&&i.push(e),n&&i.push(n),r.payerName&&i.push(r.payerName),o&&i.push(o),{additionalInfo:o,payerName:r.payerName,payerDate:r.reportPeriodDate,documentName:n,contragentInfo:r.contragentInfo,fileName:e||"",title:i.join("&#010;")}},parseFileSize:function(r){var e,o=0;do{o++,r/=1024}while(r/1e3>1);if(1===o&&r>0&&r<1)r=1;if(e=parseInt(10*(r-parseInt(r))),r=parseInt(r),0!==e)r+=","+e;switch(o){case 0:r+=" "+rk("БТ","fileBrowserSize");break;case 1:r+=" "+rk("КБ","fileBrowserSize");break;case 2:r+=" "+rk("МБ","fileBrowserSize");break;case 3:r+=" "+rk("ГБ","fileBrowserSize");break;default:r+=" "+rk("БТ","fileBrowserSize")}return r}}});
//# sourceMappingURL=Helper.module.js.map
define("json!Lib/File/ResourceGetter/resources/MimeTypes", function(){ return {
   "jpe": "image/jpeg",
   "jpg": "image/jpeg",
   "jpeg": "image/jpeg",
   "gif": "image/gif",
   "png": "image/png",
   "bmp": "image/bmp",
   "ico": "image/x-icon",
   "svg": "image/svg+xml",
   "svgz": "image/svg+xml",
   "tif": "image/tiff",
   "tiff": "image/tiff",
   "pct": "image/x-pict",
   "psd": "image/vnd.adobe.photoshop",
   "image": ["jpe","jpg","jpeg","gif","png","bmp","ico","svg","svgz","tif","tiff","pct","psd"],

   "aac": "audio/x-aac",
   "aif": "audio/x-aiff",
   "flac": "audio/x-flac",
   "m4a": "audio/x-m4a",
   "m4b": "audio/x-m4b",
   "mid": "audio/midi",
   "midi": "audio/midi",
   "mp3": "audio/mpeg",
   "mpa": "audio/mpeg",
   "mpc": "audio/x-musepack",
   "oga": "audio/ogg",
   "ogg": "audio/ogg",
   "ra": "audio/vnd.rn-realaudio",
   "ram": "audio/vnd.rn-realaudio",
   "snd": "audio/x-snd",
   "wav": "audio/x-wav",
   "wma": "audio/x-ms-wma",
   "audio": ["aac","aif","flac","m4a","m4b","mid","midi","mp3","mpa","mpc","oga","ogg","ra","ram","snd","wav","wma"],

   "avi": "video/x-msvideo",
   "divx": "video/divx",
   "flv": "video/x-flv",
   "m4v": "video/mp4",
   "mkv": "video/x-matroska",
   "mov": "video/quicktime",
   "mp4": "video/mp4",
   "mpeg": "video/mpeg",
   "mpg": "video/mpeg",
   "ogm": "application/ogg",
   "ogv": "video/ogg",
   "rm": "application/vnd.rn-realmedia",
   "rmvb": "application/vnd.rn-realmedia-vbr",
   "smil": "application/x-smil",
   "webm": "video/webm",
   "wmv": "video/x-ms-wmv",
   "xvid": "video/x-msvideo",
   "video": ["avi","divx","flv","m4v","mkv","mov","mp4","mpeg","mpg","ogm","ogv","rm","rmvb","smil","webm","wmv","xvid"],

   "js": "text/javascript",
   "xml": "text/xml",
   "xsl": "text/xml",
   "xslt": "text/xml",
   "html": "text/html",
   "css": "text/css",
   "txt": "text/plain",
   "py": "text/x-python",
   "json": "application/json",
   "pdf": "application/pdf",
   "xhtml": "application/xhtml+xml",

   "zip": "application/x-zip-compressed",
   "rar": "application/x-rar-compressed",
   "cmd": "application/cmd",
   "bat": "application/x-msdos-program",
   "exe": "application/x-ms-dos-executable",
   "msi": "application/x-msi",
   "bin": "application/x-binary",

   "crt": "application/x-x509-ca-cert",
   "crl": "application/x-pkcs7-crl",
   "pfx": "application/x-pkcs12",
   "p12": "application/x-pkcs12",

   "odc": "application/vnd.oasis.opendocument.chart",
   "odf": "application/vnd.oasis.opendocument.formula",
   "odb": "application/vnd.oasis.opendocument.database",
   "odg": "application/vnd.oasis.opendocument.graphics",
   "odi": "application/vnd.oasis.opendocument.image",
   "odp": "application/vnd.oasis.opendocument.presentation",
   "ods": "application/vnd.oasis.opendocument.spreadsheet",
   "odt": "application/vnd.oasis.opendocument.tex",

   "docx": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
   "dotx": "application/vnd.openxmlformats-officedocument.wordprocessingml.template",
   "potx": "application/vnd.openxmlformats-officedocument.presentationml.template",
   "ppsx": "application/vnd.openxmlformats-officedocument.presentationml.slideshow",
   "pptx": "application/vnd.openxmlformats-officedocument.presentationml.presentation",
   "xlsx": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
   "xltx": "application/vnd.openxmlformats-officedocument.spreadsheetml.template",
   "ppam": "application/vnd.ms-powerpoint.addin.macroEnabled.12",
   "ppa": "application/vnd.ms-powerpoint",
   "potm": "application/vnd.ms-powerpoint.template.macroEnabled.12",
   "ppsm": "application/vnd.ms-powerpoint.slideshow.macroEnabled.12",
   "xlsm": "application/vnd.ms-excel.sheet.macroEnabled.12",
   "pptm": "application/vnd.ms-powerpoint.presentation.macroEnabled.12",
   "dotm": "application/vnd.ms-word.template.macroEnabled.12",
   "docm": "application/vnd.ms-word.document.macroEnabled.12",

   "doc": "application/msword",
   "dot": "application/msword",
   "pot": "application/mspowerpoint,application/vnd.ms-powerpoint",
   "pps": "application/mspowerpoint",
   "ppt": "application/mspowerpoint,application/powerpoint,application/vnd.ms-powerpoint,application/x-mspowerpoint",
   "xls": "application/vnd.ms-excel",
   "xlt": "application/vnd.ms-excel"
};});
(function(){"use strict";var r=function(){return this||(0,eval)("this")}();(r.define||r.requirejs&&r.requirejs.define||requirejsVars&&requirejsVars.define)("json",["text","Core/pathResolver"],function(r,e){return{load:function(n,t,i,o){try{var s=e(n,"json"),u=function(r){var e={};try{e=JSON.parse(r),i(e)}catch(r){i.error(r)}};u.error=function(r){i.error(r)},r.load(s,t,u,o)}catch(r){i.error(r)}}}})})();
//# sourceMappingURL=json.js.map
define("Lib/File/LocalFile",["require","exports"],function(t,e){"use strict";return function(){function t(t,e){this.file=t,this.meta=e}return t.prototype.getData=function(){return this.file},t.prototype.getMeta=function(){return this.meta},t}()});
//# sourceMappingURL=LocalFile.js.map
define("tmpl!Lib/File/ResourceGetter/FSGetter",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={},i=function e(i,r,o,s,c){function u(){}var l=0,a=void 0!==t&&t?t:arguments[arguments.length-1];void 0===a&&(eval("var thelpers = null;"),a=global.requirejs("View/Runner/tclosure"));var f={};c&&c.isSetts&&(f=c.fullContext||{});var p="string"==typeof o?o:"",d=void 0===n?void 0:n,h={id:[],def:void 0},m=a.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),_=this&&this.includedTemplates?this.includedTemplates:{},v=a.getMarkupGenerator(s);try{var y=v.joinElements([v.createTag("div",{class:"ws-browse-file ws-hidden"},[v.createTag("form",{class:"ws-file-browse-form","accept-charset":"utf-8",enctype:"multipart/form-data",method:"POST"},[v.createTag("input",{type:"file",name:"file1"},[],{},h,this)],{},h,this)],r,h,this)],p,h);h.def&&(y=v.chain(y,h,r),h=void 0)}catch(e){a.templateError("resources/WS.Core/lib/File/ResourceGetter/FSGetter.tmpl",e,i)}return y||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!Lib/File/ResourceGetter/FSGetter"}},i}),define("Lib/File/ResourceGetter/FSGetter",["require","exports","tslib","Lib/File/ResourceGetter/IResourceGetterBase","Core/Deferred","tmpl!Lib/File/ResourceGetter/FSGetter","json!Lib/File/ResourceGetter/resources/MimeTypes","Lib/File/LocalFile","Core/core-merge","Core/detection","i18n!Lib/File/ResourceGetter/IResourceGetterBase"],function(e,t,n,i,r,o,s,c,u,l){"use strict";function a(e){return e.map(function(e){return"audio"==e||"video"==e||"image"==e?e+"/*":e in s?s[e]:e}).join(",")}function f(e,t){var n=((e.name.match(/^\S[\S\s]*\.([\S]+)$/)||[])[1]||"").toLowerCase();if(t.indexOf(n)>-1)return!0;var i,r=e.type||"";if(r)for(i in s)if(s.hasOwnProperty(i)&&s[i]===r&&-1!=t.indexOf(i))return!0;return!1}var p=1e3*(l.isMobilePlatform?3:1),d=function(e){var t=function(n){setTimeout(e,p),document.removeEventListener("focusin",t),document.removeEventListener("touchstart",t)};document.addEventListener("focusin",t),document.addEventListener("touchstart",t)};return function(e){function t(t){var n=e.call(this)||this;n.name="FSGetter",n._options={multiSelect:!1,extensions:null,element:null},n._options=u(n._options,"object"==typeof t?t:{});var i;(i=n._options.element)instanceof HTMLElement||(i=document.body);var r=document.createElement("div");return r.innerHTML=o(n._options),i.appendChild(r),n._form=r.querySelector("form"),n._inputBtn=n._form.querySelector("input[type=file]"),n._inputBtn.onchange=function(){n._onChangeInput(n._inputBtn.files)},n._options.multiSelect&&n._inputBtn.setAttribute("multiple","true"),n._setMIMEType(n._inputBtn),n}return n.__extends(t,e),t.prototype.getFiles=function(){var e=this;if(this.isDestroy())return r.fail("Resource getter is destroyed");this._selectDef&&this._selectDef.cancel();var t;return t=this._selectDef=new r,this._form.reset(),d(function(){t.isReady()||e._inputBtn.files.length||(t.cancel(),e._selectDef=null)}),this._inputBtn.click(),t},t.prototype.canExec=function(){return r.success(!this.isDestroy())},t.prototype._setMIMEType=function(e){var t=this;this._extensions=[],this._options.extensions&&this._options.extensions.length&&(e.setAttribute("accept",a(this._options.extensions)),this._options.extensions.forEach(function(e){"audio"==e||"video"==e||"image"==e?t._extensions.concat(s[e]):t._extensions.push(e)}))},t.prototype._onChangeInput=function(e){for(var t=[],n=0;n<e.length;n++){var i=void 0,r=e.item&&e.item(n)||e[n];this._extensions.length&&!f(r,this._extensions)&&(i=new Error(rk("Выбранный файл неверного типа"))),t.push(i||new c(r))}this._selectDef.callback(t),this._selectDef=null},t.prototype.destroy=function(){this._form.remove&&this._form.remove(),this._form=null,this._inputBtn=null,this._selectDef&&!this._selectDef.isReady()&&this._selectDef.cancel(),e.prototype.destroy.call(this)},t}(i)});
//# sourceMappingURL=FSGetter.tmpl.map
define("Lib/File/ResourceGetter/FSGetter",["require","exports","tslib","Lib/File/ResourceGetter/IResourceGetterBase","Core/Deferred","tmpl!Lib/File/ResourceGetter/FSGetter","json!Lib/File/ResourceGetter/resources/MimeTypes","Lib/File/LocalFile","Core/core-merge","Core/detection","i18n!Lib/File/ResourceGetter/IResourceGetterBase"],function(e,t,n,i,o,s,r,u,c,l){"use strict";var f=1e3,a=(l.isMobilePlatform?3:1)*f,p=function(e){var t=function(n){setTimeout(e,a),document.removeEventListener("focusin",t),document.removeEventListener("touchstart",t)};document.addEventListener("focusin",t),document.addEventListener("touchstart",t)};function _(e){return e.map(function(e){if("audio"==e||"video"==e||"image"==e)return e+"/*";if(e in r)return r[e];return e}).join(",")}function h(e,t){var n=((e.name.match(/^\S[\S\s]*\.([\S]+)$/)||[])[1]||"").toLowerCase();if(t.indexOf(n)>-1)return true;var i=e.type||"",o;if(i)for(o in r)if(r.hasOwnProperty(o)&&r[o]===i&&-1!=t.indexOf(o))return true;return false}return function(e){n.__extends(t,e);function t(t){var n=e.call(this)||this;n.name="FSGetter",n._options={multiSelect:false,extensions:null,element:null},n._options=c(n._options,"object"===typeof t?t:{});var i;if(i=n._options.element,!(i instanceof HTMLElement))i=document.body;var o=document.createElement("div");if(o.innerHTML=s(n._options),i.appendChild(o),n._form=o.querySelector("form"),n._inputBtn=n._form.querySelector("input[type=file]"),n._inputBtn.onchange=function(){n._onChangeInput(n._inputBtn.files)},n._options.multiSelect)n._inputBtn.setAttribute("multiple","true");return n._setMIMEType(n._inputBtn),n}return t.prototype.getFiles=function(){var e=this;if(this.isDestroy())return o.fail("Resource getter is destroyed");if(this._selectDef)this._selectDef.cancel();var t;return t=this._selectDef=new o,this._form.reset(),p(function(){if(!t.isReady()&&!e._inputBtn.files.length)t.cancel(),e._selectDef=null}),this._inputBtn.click(),t},t.prototype.canExec=function(){return o.success(!this.isDestroy())},t.prototype._setMIMEType=function(e){var t=this;if(this._extensions=[],this._options.extensions&&this._options.extensions.length)e.setAttribute("accept",_(this._options.extensions)),this._options.extensions.forEach(function(e){if("audio"==e||"video"==e||"image"==e)t._extensions.concat(r[e]);else t._extensions.push(e)})},t.prototype._onChangeInput=function(e){for(var t=[],n=0;n<e.length;n++){var i=void 0,o=e.item&&e.item(n)||e[n];if(this._extensions.length&&!h(o,this._extensions))i=new Error(rk("Выбранный файл неверного типа"));t.push(i||new u(o))}this._selectDef.callback(t),this._selectDef=null},t.prototype.destroy=function(){if(this._form.remove&&this._form.remove(),this._form=null,this._inputBtn=null,this._selectDef&&!this._selectDef.isReady())this._selectDef.cancel();e.prototype.destroy.call(this)},t}(i)});
//# sourceMappingURL=FSGetter.js.map
(function(){"use strict";var e=function(){return this||(0,eval)("this")}();function n(e){if(e){var n=e.charAt(0);if("/"==n||"\\"==n)e=e.substr(1)}return e}(e.define||e.requirejs&&e.requirejs.define||requirejsVars&&requirejsVars.define)("cdn",["Core/constants"],function(e){return{load:function(r,i,t){if("undefined"!==typeof window){var s=r.split("!"),u=s[1]?s[0]+"!":"",f=s[1]||s[0];i([u+(e.cdnRoot||"/cdn/")+n(f)],t,function(e){t.error(e)})}else t("")}}})})();
//# sourceMappingURL=cdn.js.map
define("Transport/nodeType",[],function(){return{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}});
//# sourceMappingURL=nodeType.js.map
define("Deprecated/ClassMapper",[],function(){var e={};return{setClassMapping:function(n,t){if("string"===typeof n)e[n]=t;else if(n&&"object"===typeof n)for(var s in n)if(n.hasOwnProperty(s))e[s]=n[s]},getClassMapping:function(n){return e[n]||n},resetClassMapping:function(n){delete e[n]},restoreDefaultClassMapping:function(){e={}}}});
//# sourceMappingURL=ClassMapper.js.map
define("Deprecated/core-attach",["Core/core-ready","Core/IoC","Core/Deferred","Core/ParallelDeferred","Core/constants","Core/moduleStubs","Core/core-functions","Core/load-contents","Deprecated/ClassMapper","Core/ConsoleLogger"],function(e,n,r,t,o,a,c,s){var i=/\.v[0-9a-z]+/,u={attachInstance:function(e,n){return u.loadControlsDependencies([[e,n]],true).addCallback(function(e){return new e[0](n)})},attachComponent:function(e,t){var c,s=function(){return this||(0,eval)("this")}(),i=new r,u,l,d,f;if(!t)t="",c=o.resourceRoot;else c="/";if("Source"===e)return i.callback(),i;if(("undefined"!==typeof window||"undefined"!==typeof process)&&(e.indexOf("Transport")>-1||e.indexOf("Core")>-1))return i.dependOn(a.require([e])),i;if(u=e.split("/"),f=u[0],u.length>1)n.resolve("ILogger").info("attachComponent","Метод attachComponent загружает путь до первого слеша. Возможно, не все ваши зависимости будут загружены.");if(-1!=f.indexOf("@")){var p=(f=f.split("@")).shift();if(p in o.modules)p=o.modules[p];l=t+c+p+"/"}else l=t+o.wsRoot;return d=l+"lib/"+f+".js",i.dependOn(a.require(["js!"+d])),i},getHandlerInfo:function(e){var n=e.split("/"),r=n.pop(),t=n.pop(),a=".hdl",c=false,s,u,l;if(u=n.pop(),u||""===u)n.push(u);if("render"!=u)u="_handlers";if(t in o.jsCoreModules||t in o.jsModules)n.push(o.jsCoreModules[t]||o.jsModules[t]),s=l=t,c=true;else n.push(t+a),s=n.join("/"),n.pop(),n.push(t+a),l=n.join("/");if(0===s.indexOf("/resources/"))s=s.replace("/resources/",o.resourceRoot);if(0===l.indexOf("/resources/"))l=l.replace("/resources/",o.resourceRoot);if(o.buildnumber&&!i.test(l))l=l.replace(a,".v"+o.buildnumber+a);return{type:u,name:r,package:s,url:l,isModule:c}},getHandlerPackage:function(e){throw new Error('Function "Deprecated/core-attach::getHandlerPackage" delete in 3.17.300.')},getHandler:function(e){throw new Error('Function "Deprecated/core-attach::getHandler" delete in 3.17.300. Use "require".')},attach:function(e){if(e=c.checkPackages(e),"/"!==e.charAt(0))e=o.wsRoot+e;var n=(e=c.urlWithHost(e)).replace(/^.*\.([^\.]+)(\?.*)?$/gi,"$1").toLowerCase(),t=new r;if(t.addErrback(function(e){return e}),"css"==n)global.requirejs(["native-css!"+e],function(){t.callback()},function(e){t.errback(e)});else if("js"==n)global.requirejs(["js!"+e],function(){t.callback()},function(e){t.errback(e)});else t.errback(new Error("attach: Unknown resource type specified: "+e));return t},attachSequentally:function(e){e=(e=e||[])instanceof Array?e:[e];var t=new r,o=/^(js!|css!)/,c=/^\/.+\.(js|css)/;return t.addErrback(function(e){return e}),function r(){if(e.length){var s=e.shift();if(o.test(s))a.require(s).addCallbacks(r,function(e){t.errback(e)});else if(c.test(s))n.resolve("ILogger").info("CoreAttach","Additional files in xml file with full path is deprecated. Use module notation. Instead "+s+", use the module with plugin js! or css!."),a.require(s.indexOf(".css")>-1?"native-css!"+s:s).addCallbacks(r,function(e){t.errback(e)});else u.attach(s).addCallbacks(r,function(e){t.errback(e)})}else t.callback()}(),t},withComponents:function(){var n=arguments;return e.addCallback(function(){for(var e=new t,r=0,s=n.length;r<s;r++){var i=c.extractComponentPath(n[r]).className;(function(t){if(o.jsCoreModules[t])e.push(a.require("js!"+t).createDependent().addCallback(function(){return u.loadControlsDependencies([[t,{}]],false)}));else e.push(u.attachComponent(n[r]))})(o.jsCoreModules[i]?i:"SBIS3.CORE."+i)}return e.done().getResult()})},loadContents:s,loadControlsDependencies:function(e,n){var r={},s=/js!/;function i(e,n){var r,t=["Deprecated","Lib"],i=e.indexOf("/")>0?e.split("/")[0]:false;if(s.test(e)||i&&(t.indexOf(i)>-1||Object.keys(o.modules).some(function(e){return o.modules[e]===i}))||-1===e.indexOf("SBIS3.")&&e.indexOf("/")>-1&&-1==e.indexOf("Control/"))r=function(){return a.require([e]).addCallback(function(n){return[e,n[0]]})};else r=function(){var r=c.extractComponentPath(e),t=r.isModule,o=r.moduleName,s=r.className,i=t?a.require("js!"+o):u.attachComponent(r.component);return i.addCallback(function(r){var a=t?r[0]:null;if(!a&&n)throw new Error("Модуль "+o+" нельзя загрузить через core/core-attach");return[e,a]}),i};return r}function l(e,n){return e.reduce(function(e,t){var o=t[0],a,c;if(!(o in r))r[o]=true,c=i(o,n),e.push(c());return e},new t).done().getResult()}function d(e){var n=global.requirejs.defined("Core/DependencyResolver")?global.requirejs("Core/DependencyResolver"):false;return e.reduce(function(e,r){var t=r[0],o=r[1],a,i,u,l,d;if(!s.test(t))i=(a=c.extractComponentPath(t)).isModule,u=a.moduleName,l=i?u:t,(d=n&&n.resolve(l,o)||[]).forEach(function(n){e.push([n,o])});return e},[])}function f(e,r){var t=Object.keys(r).reduce(function(e,n){var t=r[n];return e[t[0]]=t[1],e},{});return e.map(function(e){var r=e[0],o=t[r];if(n&&"function"!==typeof o)throw new Error("Can't instantiate class '"+r+"'. Class not exists");return o})}function p(e,n){return l(e,n).addCallback(function(n){var r=d(e),t;if(r.length>0)t=p(r,false).addCallback(function(){return n});else t=n;return t})}return p(e,n).addCallback(f.bind(void 0,e))},loadAttachInstanceDependencies:function(e,n){return u.loadControlsDependencies([[e,n]],true).addCallback(function(e){return function(n){return new e[0](n)}})}};return u});
//# sourceMappingURL=core-attach.js.map
define("Transport/Templates/Template",["Core/core-extend","Core/ParallelDeferred","Deprecated/core-attach","Core/constants","Transport/nodeType"],function(e,t,n,o,r){var i;return i=e({},{$protected:{_templateName:"",_dReady:null,_loadedHandlers:{},_configuration:{autoWidth:false,autoHeight:false,isRelativeTemplate:false,minWidth:0}},$constructor:function(e){this._templateName=e.templateName,this._dReady=new t,this._dReady.getResult().addCallback(this._attachResources.bind(this)).addCallback(this._loadDependencies.bind(this))},isPage:function(){throw new Error("Template::isPage - method is not implemented!")},_collectAllControlsToPreload:function(e){throw new Error("Template::_collectAllControlsToPreload - method is not implemented!")},_loadDependencies:function(){var e=this._collectAllControlsToPreload(this.getControls(void 0)).map(function(e){return[e.type,e]},[]);return n.loadControlsDependencies(e,true)},getRenderResult:function(){return this._dReady.getResult()},getStyle:function(){throw new Error("Template::getStyle - method is not implemented!")},getDimensions:function(){throw new Error("Template::getDimensions - method is not implemented!")},getAlignment:function(){throw new Error("Template::getAlignment - method is not implemented!")},getTitle:function(){throw new Error("Template::getTitle - method is not implemented!")},getConfig:function(e){throw new Error("Template::getConfig - method is not implemented!")},getDeclaredHandlers:function(){return this._loadedHandlers},createMarkup:function(e){throw new Error("Template::createMarkup - method is not implemented!")},getControls:function(e,t){throw new Error("Template::getControls - method is not implemented!")},getName:function(){return this._templateName},_getIncludeDescriptorNodes:function(){throw new Error("Template::_getIncludeDescriptorNodes - method is not implemented!")},_attachResources:function(){var e=this._getIncludeDescriptorNodes(),o=new t;if(e.length>0){var r=e[0].getAttribute("spec");if(r){try{r=JSON.parse(r)}catch(e){r=false}if(r){if(r.js)o.push(n.attachSequentally(r.js));if(r.css)o.push(n.attachSequentally(r.css))}}}return o.done().getResult()},_mergeAttrToConfig:function(e,t,n){if("title"!==t&&"width"!==t&&"height"!==t)e[t]="false"===n?false:"true"===n?true:n},needSetZindexByOrder:function(){return false}}),i._importNode=function(e,t,n,l){if(false!==l&&e.importNode)try{return e.importNode(t,n)}catch(e){l=false}switch(t.nodeType){case r.ELEMENT_NODE:var a=e.createElement(t.nodeName),s,d;if(t.attributes&&t.attributes.length>0)for(s=0,d=t.attributes.length;s<d;s++){var c=t.attributes[s].nodeName,m=t.getAttribute(c);if("style"===c.toLowerCase()&&o.browser.isIE)a.style.cssText=m;else a.setAttribute(c,m)}if(n&&t.childNodes&&t.childNodes.length>0)for(s=0,d=t.childNodes.length;s<d;s++){var u=i._importNode(e,t.childNodes[s],n,l);if(u)a.appendChild(u)}return a;case r.TEXT_NODE:case r.CDATA_SECTION_NODE:return e.createTextNode(t.nodeValue);case r.COMMENT_NODE:return null}},i});
//# sourceMappingURL=Template.js.map
define("Transport/Templates/CompoundControlTemplate",["Transport/Templates/Template","Core/core-merge","Core/property-merge","Core/helpers/random-helpers"],function(e,t,n,i){var o;return o=e.extend({$protected:{_options:{template:null},_elementId:null,_docFragment:null,_instance:null},$constructor:function(){this._elementId=i.randomId(),this._loadedHandlers=this._options.template&&this._options.template.handlers||{},this._dReady.done()},_collectAllControlsToPreload:function(e){return e[0]&&[e[0]]||[]},getConfig:function(){var e=this._options.template,i=e.prototype,o={},r=e.dimensions||e.prototype.dimensions||{};if(i&&i._initializer)if(i._initializer.call(o,n),o=o._options||{},void 0===o.isRelativeTemplate)o.isRelativeTemplate=true;return t(o,r),o},getStyle:function(){return""},getDimensions:function(){var e=this.getConfig();return"width height".split(" ").reduce(function(t,n){if(n in e)t[n]=e[n];return t},{})},isPage:function(){return true},getTitle:function(){var e=this.getConfig();return e&&e.title||this._options.template.title||""},createMarkup:function(e,t){var n=document.createElement("div");if(n.setAttribute("id",this._elementId),t)n._componentConfig=t;e.append(n)},getControls:function(e,n){if(e&&this._elementId!=e)return[];var i=n&&n.find("#"+this._elementId).get(0);return[t({id:this._elementId,type:this._templateName},i&&i._componentConfig||{})]},_getIncludeDescriptorNodes:function(){return[]}}),o});
//# sourceMappingURL=CompoundControlTemplate.js.map
define("Lib/Mixins/PendingOperationProducerMixin",["Core/helpers/Array/findIndex"],function(e){var n=[];function i(n,i){var r=e(i,function(e){return e===n});if(-1!==r)i.splice(r,1)}return{$protected:{_producedPendingOperations:[]},_removeOpFromCollections:function(e){i(e,this._producedPendingOperations),i(e,n)},_registerPendingOperation:function(e,i,r){var t={name:e=this._moduleName?this._moduleName+"/"+e:e,finishFunc:i,cleanup:null,control:this,registerTarget:r};if(t.cleanup=this._removeOpFromCollections.bind(this,t),t.registerTarget)t.registerTarget.sendCommand("registerPendingOperation",t),this._producedPendingOperations.push(t),n.push(t);return t},_unregisterPendingOperation:function(e){if(e.cleanup(),e.registerTarget)e.registerTarget.sendCommand("unregisterPendingOperation",e)},getAllPendingOperations:function(){return n},getPendingOperations:function(){return this._producedPendingOperations},before:{destroy:function(){var e=this._producedPendingOperations;while(e.length>0)this._unregisterPendingOperation(e[0])}}}});
//# sourceMappingURL=PendingOperationProducerMixin.js.map
define("Lib/Mixins/PendingOperationParentMixin",["Core/helpers/Function/callBefore","Core/helpers/Function/callNext","Core/helpers/Array/findIndex","Core/core-functions","Lib/Mixins/PendingOperationProducerMixin","Core/CommandDispatcher","Core/Deferred","Core/core-debug","Core/IoC","Core/helpers/generate-helpers"],function(i,n,e,r,t,s,l,d,o){function h(i,n){var r=e(n,function(n){return n===i});n.splice(r,1)}function a(i){return!(i instanceof Error||false===i)}var g=o.resolve("ILogger"),u=r.clone(t),c=t.$protected;return r.merge(u,{$protected:{_childPendingOperations:[],_allChildrenPendingOperation:null,_finishPendingQueue:null,_isFinishingChildOperations:false},$constructor:n.call(function(){var i=this._registerChildPendingOperation.bind(this),n=this._unregisterChildPendingOperation.bind(this),e=s.declareCommand.bind(s);e(this,"registerPendingOperation",i),e(this,"unregisterPendingOperation",n)},c.$constructor),_registerChildPendingOperation:function(i){var n,e;if(this._childPendingOperations.push(i),!this._allChildrenPendingOperation)n=(this._moduleName?this._moduleName+"/":"")+"allChildrenPendingOperation",e=this.finishChildPendingOperations.bind(this),this._allChildrenPendingOperation=this._registerPendingOperation(n,e,this.getParent());return true},_unregisterChildPendingOperation:function(i){var n=this._childPendingOperations,e;if(n.length>0)if(h(i,n),0===n.length)e=this._allChildrenPendingOperation,this._allChildrenPendingOperation=null,d.checkAssertion(!!e),this._unregisterPendingOperation(e);return true},finishChildPendingOperations:function(i){var n=this,e=function(r){var t=n._childPendingOperations,s,d;function o(){if(t.length>0)t.shift().cleanup()}if(a(r)&&t.length>0)if(s=t[0].finishFunc(i),s instanceof l)s.addCallback(function(i){if(a(i))o();return e(i)}).addErrback(function(i){return e(i)});else{if(a(s))o();s=e(s)}else{if(d=n._allChildrenPendingOperation,0===t.length&&d)n._allChildrenPendingOperation=null,n._unregisterPendingOperation(d);n._isFinishingChildOperations=false,s=r}return s};if(!this._isFinishingChildOperations)this._finishPendingQueue=l.success(true),this._isFinishingChildOperations=true,this._finishPendingQueue.addCallback(e);return this._finishPendingQueue},getChildPendingOperations:function(){return this._childPendingOperations},before:{destroy:i.call(function(){var i=this._allChildrenPendingOperation,n;if(this._isFinishingChildOperations)n="У контрола "+this._moduleName+" (name = "+this.getName()+", id = "+this.getId()+") вызывается метод destroy, "+"хотя у него ещё есть незавёршённые операции (свои или от дочерних контролов",g.error("Lib/Mixins/PendingOperationParentMixin",n);if(this._childPendingOperations=[],this._allChildrenPendingOperation)this._allChildrenPendingOperation=null,this._unregisterPendingOperation(i)},c.destroy)}})});
//# sourceMappingURL=PendingOperationParentMixin.js.map
define("Transport/Templates/EmptyTemplate",["Transport/Templates/Template"],function(t){var n;return n=t.extend({$constructor:function(){this._dReady.done()},_collectAllControlsToPreload:function(){return[]},isPage:function(){return true},getConfig:function(){return{}},getStyle:function(){return""},getAlignment:function(){return{horizontalAlignment:"Stretch",verticalAlignment:"Stretch"}},getTitle:function(){return""},createMarkup:function(t){t.get(0).innerHTML=""},getDimensions:function(){return{width:"",height:""}},getControls:function(){return[]},_getIncludeDescriptorNodes:function(){return[]}}),n});
//# sourceMappingURL=EmptyTemplate.js.map
define("Core/Storage",["Core/Deferred"],function(e){return{_storage:{},store:function(r,t){if(!(r in this._storage)){if("function"!=typeof t)throw new Error("Constructor is not specified for newly created async resource");this._storage[r]=new e,t(this._storage[r])}return(new e).dependOn(this._storage[r])},isStored:function(e){return e in this._storage},isReady:function(e){return e in this._storage?this._storage[e].isReady():false}}});
//# sourceMappingURL=Storage.js.map
define("Transport/attachTemplate",["Core/constants","Core/cookie","Core/core-functions","Core/Deferred","Core/IoC","Core/Storage","Transport/nodeType","Transport/Templates/EmptyTemplate"],function(e,t,r,n,a,o,l){var i;function s(e){var t=$("#xmlContent");if(!t.length)t=$('<div id="xmlContent" style="display:none; visibility: hidden;"></div>'),$("body").append(t);if(!t.data(e))t.data(e,true),t.append('<div name="'+e+'">')}function c(i,s){function c(e){if(!s&&e instanceof Array)for(var n=0,l=e.length;n<l;n++)if(o.isStored("resfile://"+e[n])||n==l-1){e=e[n];break}var i="undefined"!==typeof document&&(t.get("s3rh")||t.get("rightshash"))||0;return o.store("resfile://"+e,function(t){t.dependOn(a.resolve("ITransport",{dataType:s?"text":"xml",url:function(){var t=r.urlWithHost(e+(s?".fast.xml":".xml"));if(i)t=t.replace(/(\.fast)?(\.v[0-9a-f]+)?(\.l[\S-]+)?(\.xml)$/,"$1.r"+i+"$2$3$4");return t}()}).execute(null))})}if(e.xmlPackages[i]&&!s)return(new n).dependOn(c(e.xmlPackages[i])).addCallback(function(t){for(var r=t.documentElement,n=r.childNodes.length-1;n>=0;--n){if(r.childNodes[n].nodeType!=l.ELEMENT_NODE)continue;if(r.childNodes[n].getAttribute("id")==i)return r.childNodes[n]}return new Error(i+" is not found in the package "+e.xmlPackages[i])});var d=i.charAt(0),f="";if("/"!==d&&"."!==d)if(i in e.xmlContents){if(i=e.xmlContents[i],d=i.charAt(0),"/"!==d)f=e.resourceRoot}else f=e.wsRoot+"res/xml/";return c(f+i)}function d(t,r){var a,l=false,i="",d=new n;if(r&&"object"==typeof r)l=r.fast||false,i=r.html||"";else l=arguments[1],i=arguments[2];return o.store("res://"+t,function(r){function n(e,t,n){r.callback({transportTemplate:e,templateXML:t,template:t,templateName:n})}var a=["Deprecated","Lib"],o=t.indexOf("/")>0?t.split("/")[0]:false;if(/js!/.test(t)||a.indexOf(o)>-1||Object.keys(e.modules).some(function(t){return e.modules[t]===o})||"."!==t[0]&&-1===t.indexOf("SBIS3.")&&t.indexOf("/")>-1)require([t,"Transport/Templates/CompoundControlTemplate"],function(e,r){n(r,e,t)},function(e){r.errback(e)});else if(l&&i)n("Deprecated/Templates/FastTemplate",i,t);else if(t)c(t,l).addCallbacks(function(e){return n(l?"Deprecated/Templates/FastTemplate":"Deprecated/Templates/XMLTemplate",e,t),s(t),e},function(e){return r.errback(e),e});else n("Transport/Templates/EmptyTemplate","","")}).addCallbacks(function(e){var t=e.transportTemplate;if("string"==typeof t)t=require(t);var r=new t(e);return r.getRenderResult().addCallback(function(){d.callback(r)}).addErrback(function(e){d.errback(new Error("attachTemplate: "+e.message))}),e},function(e){return d.errback(e),e}),d}return i={attachTemplate:d,loadTemplateFile:c}});
//# sourceMappingURL=attachTemplate.js.map
define("Lib/Control/TemplatedAreaAbstract/TemplatedAreaAbstract",["Core/core-merge","Transport/Templates/CompoundControlTemplate","Transport/Templates/Template","Core/helpers/string-helpers","Core/IoC","Core/Deferred","Core/constants","Lib/Control/AreaAbstract/AreaAbstract","Transport/attachTemplate"],function(t,e,i,n,o,s,a,r,l){"use strict";var h=r.extend({$protected:{_needOptionsOverrideData:true,_width:"300px",_height:"100px",_title:void 0,_isPage:false,_currentTemplateInstance:null,_options:{template:"",componentOptions:{},page:false,keepSize:true,block_by_task_1173286428:false},_defaultSize:null,_defaultTpl:null,_constructorOptions:[],_initContextRestriction:""},$constructor:function(t){if(this._constructorOptions=Object.keys(t).reduce(function(t,e){return t[e]=1,t}.bind(this),{}),this._defaultSize={autoHeight:this._options.autoHeight,autoWidth:this._options.autoWidth,verticalAlignment:this._verticalAlignment,horizontalAlignment:this._horizontalAlignment,_width:this._options.autoWidth?"auto":this._container.width(),_height:this._options.autoHeight?"auto":this._container.height()},this._prepareElements(),this._options.template)this._defaultTpl=this._options.template;for(var e=["width","height"],i=0,n=e.length;i<n;i++){var o=e[i];if(this._options[o])this["_"+o]=this._options[o]}if(""===this._width)this._width=this._options.autoWidth?"auto":this._container.width();if(""===this._height)this._height=this._options.autoHeight?"auto":this._container.height();this._initContextRestriction=this._context.getRestriction()},_prepareElements:function(){this._title=$("<span />")},_collectControlsToBuild:function(i,n){var s=h.superclass._collectControlsToBuild.apply(this,arguments);if(i&&i instanceof e&&1==s.length){var a=this._options.componentOptions,r=o.resolve("ILogger");if(a){if(a.hasOwnProperty("id"))r.error("в TemplateAreaAbstract Передан componentOptions.id","В конструкторе или методе "+"setTemplate передана опция componentOptions, в которой есть параметр id. Этот параметр нельзя передавать "+"в componentOptions, потому что тогда он перебьёт опцию id у загружаемого контрола, и тот не найдёт себя в вёрстке"),delete a.id;if(a.hasOwnProperty("type"))r.error("в TemplateAreaAbstract передан componentOptions.type","В конструкторе или методе "+"setTemplate передана опция componentOptions, в которой есть параметр type. Этот параметр нельзя передавать "+"в componentOptions, потому что тогда он перебьёт опцию type у загружаемого контрола и его невозможно будет создать"),delete a.type}s[0]=t(s[0],a||{})}return s},_setTemplateDimensions:function(t){if(this._width=t.width,this._height=this._isPage&&!this._parent?"100%":t.height,(this._options.page||"100%"==t.height)&&!this._options.autoHeight)this._container.addClass("ws-area-height-100-fix")},_setMinMaxSizes:function(){this._container.css({"min-width":this._options.minWidth,"min-height":this._options.minHeight,"max-width":this._options.maxWidth==1/0?"":this._options.maxWidth,"max-height":this._options.maxHeight==1/0?"":this._options.maxHeight})},_restoreTemplateOverridenOptions:function(){for(var t in this._templateOverridenOptions)if(this._templateOverridenOptions.hasOwnProperty(t))this._options[t]=this._templateOverridenOptions[t];this._templateOverridenOptions={}},_updateDocumentTitle:function(){var t=this.getTitle(),e=document.title.lastIndexOf(t);if(t&&-1==e)document.title=t+document.title},_clearDocumentTitle:function(){var t=document.title.lastIndexOf(this.getTitle());if(t>0)document.title=document.title.slice(t,document.title.length)},_getTitle:function(){return this._title.text()},_setTitle:function(t){this._clearDocumentTitle(),this._title.attr("title",t),this._title.text(t),this._updateDocumentTitle()},getTitle:function(){return this._getTitle().trim()},setTitle:function(t){if(t)this._setTitle(t)},_loadTemplate:function(e,o){return this._runInBatchUpdate("_loadTemplate "+e+" - "+this._id,function(){this._isReady=false;var r="string"==typeof(e=e||this._options.template)?e:e.getName?e.getName():e instanceof s?"Deferred":"DOM",h=this,p=this._createChildrenLoadCallback(),_=this._makeLoadErrorHandler(p),c=this._createCheckDestroyedFunc("_loadTemplate",r,_),u=function(e){if(c(true))return;h._currentTemplateInstance=e;function i(t,e,i){if(this._isOptionDefault(i))t[i]=e;return t}function s(t,e,i){return t[i]=this._options[i],t}function a(t,e,i){if(l.indexOf(i)>-1)t[i]=e;return t}var r=e.getDeclaredHandlers(),l=h._templateOptionsFilter(),u=e.getConfig(),d=Object.keys(u).reduce(function(t,e){return a(t,u[e],e)}.bind(this),{});if(void 0!==d.resizeable)d.resizable=d.resizeable,delete d.resizeable;if(!h._context.isGlobal())d.contextRestriction=d.independentContext?"setget":d.contextRestriction||h._initContextRestriction,h._context.setRestriction(d.contextRestriction);var m=Object.keys(d).reduce(function(t,e){return i.call(h,t,d[e],e)},{}),f=e.getStyle();if(h._restoreTemplateOverridenOptions(),h._templateOverridenOptions=Object.keys(m).reduce(function(t,e){return s.call(h,t,m[e],e)},{}),!h._options.name)h._options.name=u.windowName;if(h._options.autoHeight=h._defaultSize.autoHeight,h._options.autoWidth=h._defaultSize.autoWidth,!h._options.block_by_task_1173286428)h._container.width("").height("").css({"min-width":"","min-height":"","max-width":"","max-height":""});h._options=t(h._options,m);var g=e.getDimensions();if(h._options.keepSize){if(u.autoWidth)h._options.autoWidth=true;if(u.autoHeight)h._options.autoHeight=true;if("Stretch"!==h._horizontalAlignment)if(h._options.block_by_task_1173286428)if(!h._options.autoWidth){if(h._container.width()<parseInt(g.width))h._container.css("width",g.width)}else h._container.css("width","auto");else h._container.css({width:h._options.autoWidth?"auto":g.width});else h._options.autoWidth=h._options.autoWidth||h._defaultSize.autoWidth;if("Stretch"!==h._verticalAlignment)h._container.css({height:h._options.autoHeight?"auto":g.height});else h._options.autoHeight=h._options.autoHeight||h._defaultSize.autoHeight}else h._options.autoHeight=h._defaultSize.autoHeight,h._options.autoWidth=h._defaultSize.autoWidth,h._options.maxWidth=1/0,h._options.minWidth=0,h._options.maxHeight=1/0,h._options.minHeight=0;h._initSizeOptions(),h._setMinMaxSizes(),h._isPage=e.isPage();var T,O,b;for(T in r)if(r.hasOwnProperty(T))if("function"===typeof r[T])h.subscribe(T,r[T]);else for(b=r[T].length||0,O=0;O!==b;O++)h.subscribe(T,r[T][O]);var x=(h._container.attr("style")||"").replace(/background-color:.+?;/gi,""),v=e.getTitle()||"",y=f.replace(/background-color:#.+?;/gi,"");if(h._isOptionDefault("title"))h._title.html(n.escapeHtml(v)).attr("style",y),h._options.title=v;if(h._options.page)h.setTitle(v);if(h._container.attr("style",x+";"+f),!h._hasMarkup()){if(h._resizer)h._resizer.remove(),h._resizer=null;e.createMarkup(h._container,o)}h._setTemplateDimensions(e.getDimensions()),h._delayToConstructionFinished("_loadControls",true,function(){h._notify("onBeforeControlsLoad");try{h._loadControls(p,e,void 0,c,_)}catch(t){_(t)}})},d=function(t){return t};p.getResult().addErrback(d),this._container.attr("templatename",r);try{if(c(),this._notify("onBeforeLoad"),c(true))return;if("string"===typeof e||!e){var m=e==h._defaultTpl&&h._hasMarkup()?h.getContainer()[0].outerHTML.trim():void 0;l.attachTemplate(e,{fast:a.fasttemplate,html:m}).addCallback(u).addErrback(_)}else if(e instanceof s)e.addCallback(function(t){return h._options.template=t.getName(),t}).addCallbacks(u,_).addErrback(_);else if(e instanceof i)u(e);else u(new i({templateXML:e}));p.getResult().addCallback(d)}catch(t){_(t)}return p.getResult().createDependent()})},getTemplateName:function(){return this._options.template._templateName},getCurrentTemplateName:function(){var t=this._options.template,e=t instanceof i?t.getName():t;if(-1!==e.indexOf("pre--"))e=e.substr(5);return e},_isOptionDefault:function(t){return!(t in this._constructorOptions)},_templateOptionsFilter:function(){return["isRelativeTemplate","height","minHeight","maxHeight","autoHeight","width","minWidth","maxWidth","autoWidth","title","independentContext","contextRestriction"]},destroy:function(){if(this._currentTemplateInstance=null,this._title)this._title.empty().remove(),this._title=$();h.superclass.destroy.apply(this,arguments)}});return h});
//# sourceMappingURL=TemplatedAreaAbstract.js.map
define("Lib/Control/TemplatedArea/TemplatedArea",["Core/core-instance","Core/helpers/Function/forAliveOnly","Core/ParallelDeferred","Core/Deferred","Lib/Control/TemplatedAreaAbstract/TemplatedAreaAbstract"],function(t,e,i,n,s){"use strict";function a(){return new Error("Область разрушена до окончания предыдущего вызова в очереди setTemplateQueue")}var r=s.extend({$protected:{_width:"",_height:"",_setTemplateQueue:null},$constructor:function(){this._publish("onBeforeClose","onAfterClose","onBeforeChangeActiveArea"),this._setTemplateQueue=(new n).callback(true),this.getContainer().addClass("ws-templatedArea")},_activeOnLoad:function(){if(!this._parent)this._activateFirstCtrl()},_loadDescendents:function(){this._notify("onStateChanged");var t=r.superclass._loadDescendents;return this._setTemplateQueue.addCallback(e(function(){return(this._options.template?this._loadTemplate():t.apply(this,arguments)).addCallback(this._activeOnLoad.bind(this))},this,a))},_templateInnerCallback:function(){r.superclass._templateInnerCallback.apply(this);var t=this.getCurrentTemplateName();if("string"==typeof t)this._notify("onStateChanged",t)},applyState:function(t){if(t!==this.getCurrentTemplateName())this.setTemplate(t)},_setTemplateDimensions:function(t){var e=arguments;if(!this._options.keepSize)e=[{width:"",height:""}];r.superclass._setTemplateDimensions.apply(this,e)},_prepareTemplate:function(t,e){return this._runInBatchUpdate("_prepareTemplate"+" - "+this._id,function(){return this._loadTemplate(t,e).addCallback(function(){this._notify("onBeforeShow"),this._notifyBatchDelayed("onAfterShow")}.bind(this))})},setTemplate:function(t,i){this._notify("onBeforeChangeActiveArea");var n=e(this._setTemplate.bind(this,t,i),this,a);return this._setTemplateQueue.addBoth(n).createDependent()},clearTemplate:function(){return this.setTemplate("")},_cleanupCurrentTemplate:function(){if(this._currentTemplateInstance){var t=this._currentTemplateInstance.getDeclaredHandlers();for(var e in t)if(t.hasOwnProperty(e))for(var i=t[e],n=0,s=i.length;n<s;n++)this.unsubscribe(e,i[n]);this.unbind("onResize"),this._currentTemplateInstance=null}this._removeControls(),this._container.attr("hasMarkup","false").children().not(".r").empty().remove(),this._options.template="",this._options.children=[]},_setTemplate:function(t,e){return this._runInBatchUpdate("_setTemplate"+" - "+this._id,function(){if(this._cleanupCurrentTemplate(),this._dChildReady=new i,t instanceof n)this._options.template="";else this._options.template=t;return this._prepareTemplate(t,e)})},destroy:function(){var e=!t.instanceOfModule(this,"Lib/Control/FloatArea/FloatArea");if(e)this._notify("onBeforeClose");if(r.superclass.destroy.apply(this,arguments),e)this._notify("onAfterClose")},_postUpdateResizer:function(t,e){if(!this._parent&&this._isPage){var i={};if(this._options.autoWidth)i["min-width"]=t;i["min-height"]=e,this._container.css(i)}},_restoreSize:function(){if(this._isPage&&!this.getParent()){var t=this._container.parent(),e=this._margins.left+this._margins.right,i=t.width()-e;this._container.css({width:"Stretch"===this._horizontalAlignment?"100%":this._options.autoWidth?"auto":this._width,height:"Stretch"===this._verticalAlignment?"100%":this._options.autoHeight?"auto":this._height});var n=t.width()-e;if(i!=n)this._container.css({width:n})}else r.superclass._restoreSize.apply(this,arguments)}});return r});
//# sourceMappingURL=TemplatedArea.js.map
define("Deprecated/helpers/Hcontrol/parseMargins",function(){return function(r){var t,e,n;if(r=$(r),e=r.attr("alignmargin"),e)n=e.split(","),t={top:parseInt(n[0],10),right:parseInt(n[1],10),bottom:parseInt(n[2],10),left:parseInt(n[3],10)};else t={};for(var a in t)if(t.hasOwnProperty(a))t[a]=t[a]||parseInt(r.css("margin-"+a),10)||0;return t}});
//# sourceMappingURL=parseMargins.js.map
define("Deprecated/helpers/Hcontrol/getTextWidth",function(){return function(t){var e="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",n=document.createElement("div");document.all?n.style.setAttribute("cssText",e):n.setAttribute("style",e),n.innerHTML=t,document.body.appendChild(n);var o=n.clientWidth;return document.body.removeChild(n),o}});
//# sourceMappingURL=getTextWidth.js.map
define("Deprecated/helpers/Hcontrol/getNonControlSize",function(){return function(e,t){var r=0,n=0,i,a=e&&e.length||0,o,l;if(a>0)for(o=jQuery.expr.filters.hidden,l=t.toLowerCase(),i=0;i<a;i++){var u=e[i],s;if(!o(u)){s=$(u);var f=u.getAttribute("orig"+t);if(null===f||"auto"===f||"Auto"===f)n=s["getNative"+t]();else{n=parseFloat(f);var g=u.getAttribute("alignmargin");if(null!==g)if(g=g.split(","),"Height"===t)n+=parseInt(g[0],10)+parseInt(g[2],10)||0;else n+=parseInt(g[1],10)+parseInt(g[3],10)||0;n+=s["outer"+t]()-s[l]()}r=n>r?n:r}}return r}});
//# sourceMappingURL=getNonControlSize.js.map
define("Deprecated/helpers/Hcontrol/contains",function(){return function(e,n){var r=false,t=e instanceof jQuery?e[0]:e,o=n instanceof jQuery?n[0]:n;while(!r&&o)r=t===(o=o.parentNode);return r}});
//# sourceMappingURL=contains.js.map
define("Deprecated/helpers/dom&controls-helpers",["Core/constants","Core/core-functions","Core/Deferred","Core/compatibility","Core/detection","Core/helpers/generate-helpers","Core/EventBus","Core/core-instance","Core/ControlBatchUpdater","Core/IoC","Deprecated/helpers/Hcontrol/contains","Deprecated/helpers/Hcontrol/parseMargins","Deprecated/helpers/Hcontrol/getNonControlSize","Deprecated/helpers/Hcontrol/getTextWidth"],function(e,t,n,o,r,l,i,s,a,c,d,u,m,f){var p={findControlsInContainer:function(e){var t=[];return $("[data-component]",e).each(function(e,n){var o=n.wsControl;if(o)t.push(o)}),t},clearContainer:function(e){e.get(0).innerHTML=""},detectCommonDataContainer:function(e){return e&&e.s&&e.d&&("record"==e._type||"recordset"==e._type)},getTagName:function(e){return e.localName||e.nodeName&&e.nodeName.toLowerCase()},getScrollOffset:function(){return{left:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}},getNonControlSize:m,insertCss:function(t,r,i){function s(){var e;if("getElementsByClassName"in document)e=document.getElementsByClassName("ws-style-holder-current")[0];else for(var t=document.getElementsByTagName("style"),n=0,o=t.length;n<o;n++)if(d(t[n],"ws-style-holder-current")){e=t[n];break}return e=e||a(),e}function a(){var e=document.createElement("style"),t=document.getElementsByTagName("head")[0];return e.setAttribute("type","text/css"),e.setAttribute("media","all"),e.className="ws-style-holder ws-style-holder-current",t.appendChild(e),e}function d(e,t){for(var n=" "+e.className+" ",o=t.split(" "),r=0,l=o.length;r<l;r++)if(-1==n.indexOf(" "+o[r]+" "))return false;return true}function u(){var t="absolute"===g.css("position"),n=+new Date-h>e.styleLoadTimeout,o=$("#onlineChecker");if(t||n)if(g.remove(),y)if(clearInterval(y),n)o.text(rk("Страница загружается слишком долго. Попробуйте перезагрузить страницу")),o.css("display",""),o.css("zIndex",9999),f.callback();else f.callback();return t}var m="",f=null,p,g,y,h,C;if(r)p=l.randomId("cssReady-"),g=$('<div id="'+p+'" style="display: none;" />').appendTo($("body")),m="#"+p+" { position: absolute; }";if(o.standartStylesheetProperty)(C=a()).appendChild(document.createTextNode(t+m));else{if(t+=m,((C=s()).styleSheet.cssText.match(/\{|,/g)||[]).length+(t.match(/\{|,/g)||[]).length>4e3)C.className="ws-style-holder",C=a();try{C.styleSheet.cssText+=t}catch(e){throw c.resolve("ILogger").error("insertCss","Failed to insert styles to document! IE8/9 Stylesheet limit exceeded (31 per document)?"),e}}if(r)if(h=+new Date,!u())(f=new n).addErrback(function(e){return e}),y=setInterval(u,1);return f},contains:d,getTextSelection:function(){var e;if(window.getSelection)e=window.getSelection().toString();else if(document.getSelection)e=document.getSelection().toString();else if(document.selection)e=document.selection.createRange().text;return e},clearSelection:function(e){if(window.getSelection){var t,n=window.getSelection(),o=n.isCollapsed||false;try{if(t=n.getRangeAt(0).startContainer,p.contains(e,t))n.collapseToStart(),o=true}catch(e){}if(o)return;try{if(n&&n.removeRange)n.removeRange();else if(n&&n.empty)n.empty()}catch(e){}}else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(e){}},ieFixInnerHTML:function(e){var t=/<(?:[A-Z][A-Z0-9]*)\b[^>]*>/gi,n=/\s+\S+=[^'"\s>]+/g;return e.replace(t,function(e){return e.replace(n,function(e){var t=e.split("=");return t[1]='"'+t[1]+'"',t.join("=")})})},getTextWidth:f,parseMargins:u,addXmlLog:function(e){var t=$("#xmlContent");if(!t.length)t=$('<div id="xmlContent" style="display:none; visibility: hidden;"></div>'),$("body").append(t);if(!t.data(e))t.data(e,true),t.append('<div name="'+e+'">')}};return p});
//# sourceMappingURL=dom&controls-helpers.js.map
define("Core/helpers/Hcontrol/setElementCachedSize",function(){return function(e,t){var i=e.data("cachedSize");if(!i||i.width!==t.width||i.height!==t.height)e.data("cachedSize",t),e.css(t)}});
//# sourceMappingURL=setElementCachedSize.js.map
define("Core/helpers/dom&controls-helpers",["Core/constants","Core/core-extend-initializer","Core/deprecated","Deprecated/helpers/dom&controls-helpers","Core/helpers/Hcontrol/replaceContainer","Core/helpers/Hcontrol/getElementCachedDim","Core/helpers/Hcontrol/setElementCachedSize","Core/helpers/Hcontrol/focusControl","Core/helpers/Hcontrol/doAutofocus","Core/helpers/Hcontrol/isElementVisible","Core/helpers/Hcontrol/getChildContainers","Core/helpers/Hcontrol/isScrollable","Core/helpers/Hcontrol/hasScrollbar","Core/helpers/Hcontrol/mergeAttributes","Core/helpers/Hcontrol/trackElement","Core/helpers/Hcontrol/getScrollWidth","Core/Deferred","Core/compatibility","Core/EventBus","Core/IoC"],function(e,t,o,n,r,l,i,c,s,a,d,f,p,g,u,C){var h=o.callNextWrapper,m=function(e,t){return function(){o.showInfoLog("Хелпер Core/helpers/dom&controls-helpers::"+e+" помечен как deprecated и будет удален в 3.18."+(t?" Подключите явно "+t+", чтобы им пользоваться":""))}},T={findControlsInContainer:h(n.findControlsInContainer,m("findControlsInContainer")),clearContainer:h(n.clearContainer,m("clearContainer")),detectCommonDataContainer:h(n.detectCommonDataContainer,m("detectCommonDataContainer")),getTagName:h(n.getTagName,m("getTagName")),getScrollOffset:h(n.getScrollOffset,m("getScrollOffset")),isScrollable:f,hasScrollbar:p,hasVerticalScrollbar:p.vertical,hasHorizontalScrollbar:p.horizontal,getNonControlSize:h(n.getNonControlSize,m("getNonControlSize")),getScrollWidth:C,screenPosToOffset:function(e){var t=document.body,o=document.documentElement,n=window.pageYOffset||o.scrollTop||t.scrollTop,r=window.pageXOffset||o.scrollLeft||t.scrollLeft,l=o.clientTop||t.clientTop||0,i=o.clientLeft||t.clientLeft||0,c=e.top+n-l,s=e.left+r-i;return{top:Math.round(c),left:Math.round(s)}},offsetPosToScreen:function(e){var t=document.body,o=document.documentElement,n=window.pageYOffset||o.scrollTop||t.scrollTop,r=window.pageXOffset||o.scrollLeft||t.scrollLeft,l=o.clientTop||t.clientTop||0,i=o.clientLeft||t.clientLeft||0,c=e.top-n+l,s=e.left-r+i;return{top:Math.round(c),left:Math.round(s)}},getOffsetRect:function(e){return T.screenPosToOffset(e.getBoundingClientRect())},insertCss:h(n.insertCss,m("insertCss")),contains:h(n.contains,m("contains")),getTextSelection:h(n.getTextSelection,m("getTextSelection")),clearSelection:h(n.clearSelection,m("clearSelection")),positionInWindow:function(t,o,n){var r=e.$win.scrollTop(),l=e.$win.scrollLeft(),i=e.$win.width(),c=e.$win.height();if(t.top-=r,t.left-=l,t.left+o>i)t.left=i-o;if(t.left<0)t.left=0;if(void 0!==n&&t.top+n>c)t.top=c-n;if(t.top<0)t.top=0;return t.top+=r,t.left+=l,t},replaceContainer:r,getChildContainers:d,getNestedComponents:function(e){var t=e.get(0),o,n=[];if(t.id)for(var r=0,l=(o=t.querySelectorAll('[data-pid="'+t.id+'"]')).length;r<l;r++)n.push(o[r]);else n=T.getChildContainers(e,"[data-component]");return n},isElementVisible:a,ieFixInnerHTML:h(n.ieFixInnerHTML,m("ieFixInnerHTML")),getDefaultInstanceData:h(t.call,m("getDefaultInstanceData","Core/core-extend-initializer.call")),mergeOptionsToDefaultOptions:h(t.getInstanceOptionsByDefaults,m("mergeOptionsToDefaultOptions","Core/core-extend-initializer.getInstanceOptionsByDefaults")),resolveOptions:h(t.getInstanceOptions,m("resolveOptions","Core/core-extend-initializer.getInstanceOptions")),getTextWidth:h(n.getTextWidth,m("getTextWidth")),mergeAttributes:g,parseMargins:h(n.parseMargins,m("parseMargins")),getDocumentHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},addXmlLog:h(n.addXmlLog,m("addXmlLog")),setElementCachedSize:i,getElementCachedDim:l,isChildControl:function(e,t){while(t&&t!==e)t=t.getParent()||t.getOpener&&t.getOpener();return t===e},updateTrackedElements:function(){throw new Error("Хелпер updateTrackedElements был удалён.")},doAutofocus:s,_findAutofocus:s.findAutofocus,focusControl:c,trackElement:u};return T});
//# sourceMappingURL=dom&controls-helpers.js.map
define("Lib/Control/FloatArea/FloatArea",["Core/core-extend","Core/helpers/Function/once","Core/helpers/Object/find","Core/helpers/Function/forAliveOnly","Core/helpers/Function/memoize","Core/helpers/fast-control-helpers","Core/helpers/Object/isEmpty","Core/WindowManager","Core/EventBus","Core/CommandDispatcher","Core/constants","Lib/Control/TemplatedArea/TemplatedArea","Lib/FloatAreaManager/FloatAreaManager","Deprecated/Controls/ModalOverlay/ModalOverlay","Lib/Mixins/LikeWindowMixin","Transport/Templates/CompoundControlTemplate","Core/markup/ParserUtilities","Core/core-instance","Core/core-clone","Core/helpers/Function/shallowClone","Core/IoC","Core/ControlBatchUpdater","Lib/Mixins/PendingOperationParentMixin","Core/Deferred","Core/helpers/dom&controls-helpers","is!browser?Lib/LayoutManager/LayoutManager","Core/detection","Core/helpers/Array/findIndex","Core/Context","Core/helpers/markup-helpers","css!Lib/Control/FloatArea/FloatArea","is!browser?cdn!jquery-ui/1.12.1.2/jquery-ui-position.js","i18n!Lib/Control/FloatArea/FloatArea"],function(t,i,e,s,o,n,a,r,h,l,d,_,f,c,u,p,g,w,m,v,b,C,S,y,x,T,A){"use strict";var k=f._useAnimation(),z=function(){},W=f._useCss3(),M=d.browser,H=!M.isIE||M.IEVersion>8,B=M.isIE,F="undefined"!==typeof window&&$("body"),I=["Lib/Control/FloatArea/FloatArea","Lib/Control/Window/Window"],P=150,O=20,R=8,V=200,D=1e3,L=300,E=b.resolve("ILogger"),U=E.error.bind(E,"Lib/Control/FloatArea/FloatArea"),l=l,N=C.createBatchUpdateWrapper.bind(C);function Z(){return F.length?F:F="undefined"!==typeof window&&$("body")}function j(t,i,e){function s(i,s){if(e.arrow){var o=s.element.left,n=s.element.top,a=o+s.element.width,r=n+s.element.height,h=s.target.left,l=s.target.top,d=h+s.target.width,_=l+s.target.height,f=20,c=10,u,p,g;if(l-r>=c||n-_>=c){var w=Math.max(o,h),m=Math.min(a,d);if(g=h>o?h-o:0,m-w>=f)u=r<l?"bottom":"top",p=(m-w)/2+g}else if(h-a>=c||o-d>=c){var v=Math.max(n,l),b=Math.min(r,_);if(g=l>n?l-n:0,b-v>=f)u=a<h?"right":"left",p=(b-v)/2+g}if(u){var C="ws-float-area-arrow-"+u,S="left"==u||"right"==u?"top":"left";if(!t._arrowBefore)t._arrowBefore=$('<div class="arrowBefore '+C+'"></div>'),t._arrowBefore.appendTo(t);if(!t._arrowAfter)t._arrowAfter=$('<div class="arrowAfter '+C+'"></div>'),t._arrowAfter.appendTo(t);t._arrowBefore.css(S,p),t._arrowAfter.css(S,p)}}if(i.left=parseInt(i.left,10),i.top=parseInt(i.top,10),!e.isStack&&e.restrictionContainer){var y=$(e.restrictionContainer),x=parseInt($("#container").css("margin-left"),10)||0,T=y.width(),A=y.offset().left-x,k=t.width();if(y.length&&k+i.left>T+A)i.left=T+A-k-1}if(i.left<0)i.left=0;if(i.top<0)i.top=0;t.css(i)}function o(i){var e=t.closest(".ws-body-scrolling-content"),s=$(window).width(),o=$(window).height(),n=x.offsetPosToScreen(i),a;if(e.length>0)s-=x.getScrollWidth();if(n=x.offsetPosToScreen(i),a={left:-n.left,right:n.left+i.width-s,top:-n.top,bottom:n.top+i.height-o,vertical:"",horizontal:""},a.right>0)a.horizontal="right";else if(a.left>0)a.horizontal="left";if(a.bottom>0)a.vertical="bottom";else if(a.top>0)a.vertical="top";return a}function n(t){function e(t,i){return t+(i?(i>0?"+":"")+i:"")}var s={},o={top:"bottom",bottom:"top",left:"right",right:"left",center:"center",middle:"middle"},n=t.verticalAlign,a=t.side,r=t.offset,h=Number(r.x)||0,l=Number(r.y)||0,d,_,f,c,u=t.direction;if("middle"===n)n="center";switch(u){case"top":case"bottom":d=a,_=o[u];break;case"left":case"right":d=o[u],_="top"}var p=e(d,h),g=e(_,l);return f=a,c=n,s.my=p+" "+g,s.at=f+" "+c,s.myH=p,s.myV=g,s.atH=f,s.atV=c,s.of=i,s.collision="none",s.fitByOffset=function(s,o){var n="horizontal"===t.fitWindow||"both"===t.fitWindow||true===t.fitWindow,a="vertical"===t.fitWindow||"both"===t.fitWindow||true===t.fitWindow,r=0,d=0;if(n)if(s.left>0)r=s.left;else if(s.right>0)r=-Math.min(s.right,o.left);if(a)if(s.top>0)d=s.top;else if(s.bottom>0)d=-Math.min(s.bottom,o.top);var _=e(this.myHFlipped,h+r),f=e(this.myVFlipped,l+d);return{my:_+" "+f,at:this.at,of:i,myH:_,myV:f,atH:this.atH,atV:this.atV,collision:"none"}},s.getFlipped=function(n){var a="horizontal"===t.flipWindow||"both"===t.flipWindow||true===t.flipWindow,r="vertical"===t.flipWindow||"both"===t.flipWindow||true===t.flipWindow,u,p,g,w,m,v,b,C,S;if("right"===n.horizontal&&a)u="right";else if("left"===n.horizontal&&a)u="left";else u=d;if("top"===n.vertical&&r)p="top";else if("bottom"===n.vertical&&r)p="bottom";else p=_;g=u===d?1:-1,w=p===_?1:-1;var y=e(u,h*g),x=e(p,l*w);return m=y+" "+x,b=d!==u?o[f]:f,C=_!==p?o[c]:c,v=b+" "+C,S={my:m,at:v,of:i,fitByOffset:s.fitByOffset,myHFlipped:u,myVFlipped:p,myH:y,myV:x,atH:b,atV:C,collision:"none"},S},s}function a(i,n,a,r){var h={};if("my"in i)h.my=i.my;if("at"in i)h.at=i.at;if("of"in i)h.of=i.of;if("collision"in i)h.collision=i.collision;var l=o(r.element),d="horizontal"===e.fitWindow||"both"===e.fitWindow||true===e.fitWindow,_="vertical"===e.fitWindow||"both"===e.fitWindow||true===e.fitWindow,f=i.getFlipped(l);function c(t,e){var a=o(e.element),r=x.offsetPosToScreen(e.element),l;if(a.horizontal||a.vertical)if(l=f.fitByOffset(a,r),d&&_)n.result=l;else if(d)l.my=l.myH+" "+(a.vertical?i.myV:f.myV),l.at=l.atH+" "+(a.vertical?i.atV:f.atV),n.result=l;else if(_)l.my=(a.horizontal?i.myH:f.myH)+" "+l.myV,l.at=(a.horizontal?i.atH:f.atH)+" "+l.atV,n.result=l;else n.result=h;else n.result=f;n.result.using=s}f.using=c,t.position(f)}return function(){var i={},s=n(e);return s.using=a.bind(void 0,s,i),t.position(s),i.result}}function K(t){return function(){if(this._options.isStack)return t.apply(this,arguments)}}function q(t){return function(){if(!this._options.isStack)return t.apply(this,arguments)}}var s=s;function Q(t,i){return function(){var e=i||this,s=arguments;return this.getReadyDeferred().addCallback(function(){if(!e.isDestroyed())return t.apply(e,s)})}}var X=t.mixin(_,[u,S]).extend({$protected:{_options:{target:"",side:"left",width:0,height:0,animation:"slide",autoHide:true,autoCloseOnHide:false,verticalAlign:"top",direction:"",animationLength:P,startWidth:-5,startHeight:-5,offset:{x:0,y:0},fixed:false,trackTarget:true,autoShow:true,catchFocus:true,hoverTarget:void 0,showDelay:void 0,fitWindow:false,flipWindow:true,fullShadow:false,controlsSide:"right",isStack:false,restrictionContainer:false,hideSideBar:true,overlay:false,modal:false,border:true,canMaximize:false,maximized:false,caption:void 0,stickyHeader:false,arrow:false,showOnControlsReady:true,_maximizeButton:void 0,disableCSS3AnimationEvent:false,task1173269044:false},_horizontalAlignment:"Left",_loaded:false,_loadStarted:false,_closeButton:void 0,_overflow:void 0,_containerShadow:void 0,_visibleRoot:void 0,_visibleRootWrapper:void 0,_generatedTitleContainer:void 0,_target:void 0,_hoverTarget:void 0,_state:"",_stateStage:"",_visible:false,_collapsedSides:{},_hoverTimer:void 0,_locksShowed:0,_childWindows:[],_showTimer:void 0,_keysWeHandle:[d.key.tab,d.key.enter,d.key.esc],_zIndex:0,_caption:void 0,_maxWidthSet:void 0,_firstSizeCalcOnShow:false,_autoShow:false,_touchX:0,_touchDistance:0,_addedToStack:false,_result:void 0,_saving:void 0,_beforeAnimationTimer:void 0,_transitionEndHandler:void 0,_showDeferred:void 0,_hideFinishFn:void 0,_windowResizeHandler:void 0,_userTitle:void 0,_useCss3:false,_useAnimation:false,_noStackShadowClassPostfix:"standart",_inApplyBatchUpdateIntermediate:0,_memoizedFuncs:{},_childPanelSizes:{},_animationQueue:void 0,_scrollUnsub:void 0,_prevPositionOptions:void 0,_showOnControlsReady:true,_isShowCanceled:false,_focusState:void 0,_prevHeight:0},$constructor:function(t){if(this._options.isStack)this._isModal=false;else this._isModal=this._isModal||this._options.overlay;this._publish("onClose","onShow","onBeforeClose","onAfterClose","onScroll","onTargetVisibilityChange"),this.subscribeTo(h.channel("navigation"),"onBeforeNavigate",s(this._onBeforeNavigate,this));var i=function(t,i){var e=function(){return i.apply(this,arguments),true};l.declareCommand(this,t,e)}.bind(this);if(i("show",this.show),i("hide",this.hide),i("close",this.close),f._addArea(this),h.globalChannel().notify("onFloatAreaCreating",this),this._overflow[0].wsControl=this,this._zIndex=r.acquireZIndex(this._isModal,false,!!this._options.hoverTarget),this._visibleRootWrapper.css("z-index",this._zIndex),this._isModal)this.subscribeTo(c,"onClick",function(t){if(this.isVisible()&&c.isShownForWindow(this))t.setResult(true),this.sendCommand("hide")}.bind(this));this._animationQueue=y.success(void 0),f._hideUnnecessaryAreas(this)},_modifyOptions:function(t){if(t.canMaximize)t.componentOptions.isPanelMaximized=t.maximized;if(!t.enabled)E.log("Lib/Control/FloatArea/FloatArea","Задана опция enabled = false. Дизаблить можно только дочерний компонент панели, для этого enabled нужно передать в componentOptions."),t.componentOptions.enabled=false,t.enabled=true;return t},_activateParent:function(){return false},_onBeforeNavigate:function(t,i,e){if(!e)this.sendCommand("hide",true)},_getManagerOptions:function(){return{hideSideBar:this._options.hideSideBar}},_initStack:K(function(){if(!this._addedToStack)this._addedToStack=true,f._setAreaInfo(this,this._getManagerOptions())}),_prepareSideOptions:function(){if("left"!==this._options.side&&"right"!==this._options.side&&"center"!==this._options.side)this._options.side="left",U("Incorrect _options.side");if("top"!==this._options.verticalAlign&&"bottom"!==this._options.verticalAlign&&"middle"!==this._options.verticalAlign)this._options.verticalAlign="top",U("Incorrect _options.verticalAlign");if("slide"!==this._options.animation&&"fade"!==this._options.animation&&"off"!==this._options.animation)this._options.animation="slide",U("Incorrect _options.animation");if(this._options.isStack)this._options.side="right",this._options.target=Z(),this._options.fixed=false;else if(this._options.fixed)this._options.target=$(window);else if(!this._options.target)this._options.target=Z()},_checkDirectionLegalValues:function(){if(""!==this._options.direction&&"left"!==this._options.direction&&"right"!==this._options.direction&&"top"!==this._options.direction&&"bottom"!==this._options.direction)this._options.direction="",U("Incorrect direction")},_checkAutoDirection:function(){if(""===this._options.direction)if("left"===this._options.side)this._options.direction="right";else if("right"===this._options.side)this._options.direction="left";else if("top"===this._options.verticalAlign)this._options.direction="bottom";else if("bottom"===this._options.verticalAlign)this._options.direction="top";else if(this._options.direction="left","slide"===this._options.animation)U("Unspecified direction")},_prepareCollapsedSides:function(){var t=this._options.side,i=this._options.direction,e=this._options.verticalAlign,s=this._options.isStack;if(!H)this._collapsedSides={left:true,right:true,top:true,bottom:true};else if(this._options.fullShadow)this._collapsedSides={left:false,right:false,top:false,bottom:false};else if(s)this._collapsedSides={left:false,right:true,top:true,bottom:true};else this._collapsedSides={left:"left"===t&&"left"!==i||"right"===t&&"right"===i,right:"right"===t&&"right"!==i||"left"===t&&"left"===i,top:"top"===e&&"top"!==i||"bottom"===e&&"bottom"===i,bottom:"bottom"===e&&"bottom"!==i||"top"===e&&"top"===i}},_prepareGeneralOptions:function(){if(this._options.width=parseInt(this._options.width,10),isNaN(this._options.width))this._options.width=V;if(this._width=this._options.width,this._options.height=parseInt(this._options.height,10),isNaN(this._options.height))this._options.height=V;if(this._height=this._options.height,this._autoShow=this._options.autoShow,void 0===this._options.showDelay)if(this._hoverTarget)this._options.showDelay=L;else this._options.showDelay=0},_prepareElements:function(){if(X.superclass._prepareElements.apply(this,arguments),this._prepareSideOptions(),this._checkDirectionLegalValues(),this._checkAutoDirection(),this._prepareCollapsedSides(),this._prepareGeneralOptions(),this._prepareArea(),this._prepareHover(),this._prepareKeydown(),this._options.fixed)this._target=$(this._options.target);else this.setTarget(this._options.target)},_getAreaType:function(){var t;if(this._options.isStack)t="STACK";else t="NO_STACK";return t},_handleStackScroll:function(t){var i;if(this.hasEventHandlers("onScroll"))i=$(t.target),this._notify("onScroll",{element:i,clientHeight:i.height(),scrollTop:i.prop("scrollTop"),scrollHeight:i.prop("scrollHeight")})},_onChildPanelResize:function(t,i){if(this._childPanelSizes[i.id]=i.top+i.height+this._visibleRoot.scrollTop()-T.getMainScrollingContainer().offset().top,0===i.height)delete this._childPanelSizes[i.id];this._notifyOnSizeChanged(true)},_prepareArea:function(){this._options.animationLength=parseInt(this._options.animationLength,10)||0,this._useCss3=W&&(void 0===this._options.useCss3||this._options.useCss3),this._useAnimation=k&&"off"!==this._options.animation&&this._options.animationLength>O,this._options.startWidth=parseInt(this._options.startWidth,10)||0,this._options.startHeight=parseInt(this._options.startHeight,10)||0;var t=f._getFloatAreaContentRoot(),i=$(this._options.target),e=!this._options.isStack&&i.closest(t).length>0&&!this._isModal?t:f._getFloatAreaBodyContainerRoot(),o;if(this._options.task1173269044)e=f._getFloatAreaBodyContainerRoot();var n=this._getAreaType(),a={STACK:{_visibleRoot:function(t){var i=f._useTouch()?"ws-float-area-stack-scroll-wrapper-touch":"ws-float-area-stack-scroll-wrapper-notouch";if(t.css("right",-f._bodyScrollWidth()),t.addClass(i),t.bind("scroll",this._handleStackScroll.bind(this)),!this._needPanelHeightRecalc())t.addClass("ws-float-area-no-height-calc");t.bind("mousedown mouseup click",function(i){if(t.is(i.target))i.stopPropagation()}),t.bind("touchmove",function(t){t.originalEvent.isFloatArea=true})},_visibleRootWrapper:function(t){t.prependTo(e)},_containerShadow:function(t){t.removeClass("ws-area"),t.bind("wsFloatAreaResize",this._onChildPanelResize.bind(this))}}}[n];if(this._options.border&&this._options.stickyHeader&&this._options.caption)o=["ws-window-titlebar-wrapper","ws-float-area__close-button-wrapper","ws-sticky-header__block",["ws-window-titlebar ws-hidden","_generatedTitleContainer"]];else o=["ws-window-titlebar ws-hidden","_generatedTitleContainer"];var r={NO_STACK:[e,[this._options.className||"","ws-float-area ws-float-area-panel-overflow","ws-float-area-nostack-panel-overflow","ws-hidden",this._options.fixed?" ws-float-area-nostack-panel-overflow-fixed":"","_overflow","_visibleRoot","_visibleRootWrapper",["ws-float-area-nostack-panel-shadow","ws-float-area-nostack-panel-shadow-"+this._noStackShadowClassPostfix,"_containerShadow",o,[this._container]]]],STACK:[e,[this._options.className||"","ws-float-area-stack-cut-wrapper","_visibleRootWrapper","ws-sticky-header__wrapper","ws-hidden",["ws-sticky-header__header-container","ws-sticky-header__float-area_header-container"],["ws-float-area-stack-scroll-wrapper","_visibleRoot","ws-scrolling-content","ws-sticky-header__scrollable-container",["ws-float-area-panel-external-jeans"],["ws-float-area ws-float-area-panel-overflow","ws-float-area-stack-panel-overflow","_overflow",["ws-float-area-stack-panel-shadow","_containerShadow",o,[this._container]]]]]]};function h(t){var i,e,s,o=t.length;if("string"===typeof t[0])i=$("<div></div>"),e=0;else i=t[0],e=1;while(e<o){if(s=t[e],"string"===typeof s){if(s)if("_"===s.charAt(0))this[s]=i;else i.addClass(s)}else i.append(h.call(this,s));e++}return i}h.call(this,r[n]);for(var l in a)if(a.hasOwnProperty(l))a[l].call(this,this[l]);var d=Object.keys(this._collapsedSides).reduce(function(t,i){if(!this._collapsedSides[i])t.push("ws-float-area-shadow-offset-"+i);return t}.bind(this),[]).join(" ");if(this._options.isStack)this._overflow.addClass(d);else this._containerShadow.addClass(d);if(this._useCss3&&this._useAnimation)this._containerShadow.addClass("ws-float-area-animation-"+this._options.animation),this._setAnimationDurationProperty(this._getAnimationLength()),this._containerShadow.bind("transitionend",s(this._transitionEnd,this))},_getAnimationLength:function(){return this._options.animationLength/1e3+"s"},_setAnimationDurationProperty:function(t){this._containerShadow.css({"-webkit-transition-duration":t,"-moz-transition-duration":t,"transition-duration":t})},_transitionEnd:function(){if(this._transitionEndHandler&&!this._options.disableCSS3AnimationEvent){var t=this._transitionEndHandler;this._transitionEndHandler=null,t.call(this)}},_setMinMaxSizes:function(){this._container.css({"min-width":this._options.minWidth}),this._maxWidthSet=-1,this._updateMinMaxWidthHeight()},_getCssIntProp:function(t,i,e){var s=this._memoizedFuncs,n=i+"-"+t;if(!s[n])s[n]=o(function(){return parseInt(e.css(t),10)||0},n);return s[n]()},_getShadowCssIntProp:function(t){return this._getCssIntProp(t,"shadow",this._containerShadow)},_getOverflowCssIntProp:function(t){return this._getCssIntProp(t,"overflow",this._overflow)},_prepareCloseButton:function(){var t="center"!==this._options.controlsSide?this._options.controlsSide:"right";this._closeButton=$('<div sbisname="floatAreaCloseButton" class="ws-float-close sbisname-window-title-close ws-float-close-'+t+'"></div>'),this._closeButton.click(function(t){if(t.stopPropagation(),A.firefox){var i=this.getActiveChildControl(void 0,true);if(i)i.setActive(false)}f._hideUnnecessaryAreas(this),this.sendCommand("hide")}.bind(this)),this._closeButton.css("margin-"+t,this._getShadowCssIntProp("margin-"+t)),this._addCommandButton(this._closeButton)},_hasMaximizeButton:function(){var t=isFinite(this._options.maxWidth)&&this._options.minWidth>0;return this._options.canMaximize&&t&&this._options.maxWidth!==this._options.minWidth},_addMaximizeButton:function(){var t="center"!==this._options.controlsSide?this._options.controlsSide:"right";this._maximizeButton=$('<div class="ws-float-area-maximize-btn ws-float-extend-'+t+'" title="Свернуть/развернуть"></div>'),this._maximizeButton.mousedown(function(t){t.preventDefault()}),this._maximizeButton.click(function(){this._setMaximizeMode(!this._options.maximized)}.bind(this)),this._changeMaximizePanelMode(true),this._addCommandButton(this._maximizeButton)},_addCommandButton:function(t){var i,e=$(".ws-window-titlebar:first",this.getContainer().parent());if(this._options.isStack&&f._useTouch())t.css({overflow:"auto"});if(i=this._overflow.closest(".ws-float-area-stack-cut-wrapper").find(".ws-float-area__close-button-wrapper:first"),1!==i.length)if(e.length)i=e.next();else if(this._getTemplateComponent())i=this._getTemplateComponent().getContainer();else t.toggleClass("ws-hidden",!this.isVisible()),i=this._overflow;i.append(t)},_destroyCommandButtons:function(){if(this._closeButton)this._closeButton=void 0;if(this._maximizeButton)this._maximizeButton=void 0},_setVisibilityCommandButtons:function(t){if(this._closeButton)this._closeButton.toggleClass("ws-hidden",!t);this._setVisibleMaximizeButton(t)},_setVisibleMaximizeButton:function(t,i){if(t=false===this._showMaximizeButon?this._showMaximizeButon:t,this._maximizeButton)if(this._maximizeButton.toggleClass("ws-hidden",!t),i)this._changeMaximizePanelMode(t)},_changeMaximizePanelMode:function(t){this._visibleRoot.toggleClass("ws-float-area-has-maximized-button",t),this._visibleRootWrapper.toggleClass("ws-float-area-has-maximized-button",t)},_setMaximizeMode:function(t,i){if(!this._maximizeButton)return;var e=t?this._options.maxWidth:this._options.minWidth,s=f._getMaxWidthForAreaNew(this,this._options.minWidth),o=this._getTemplateComponent();if(s==this._options.minWidth)this._showMaximizeButon=false,this._setVisibleMaximizeButton(false,true),e=s;else{if(e>s)e=s;if(this._showMaximizeButon=true,this.isShow())this._setVisibleMaximizeButton(true,true)}if(this._options.maximized=t,this._visibleRoot.toggleClass("ws-float-area-maximized-mode",t),this._visibleRootWrapper.toggleClass("ws-float-area-maximized-mode",t),this._visibleRoot.find(".ws-float-area").css("width",e+this._getBorderLeftWidth()),this.getContainer().css("width",e),this._updateStickyHeaderWidth(),f._changeMaximizeMode(),o)if(o._notifyOnSizeChanged(),o._options.isPanelMaximized=t,!i)o._notify("onChangeMaximizeState",t);this._notify("onChangeMaximizeState",t)},_getBorderLeftWidth:function(){return parseInt($(".ws-float-area-stack-panel-shadow",this._visibleRoot).css("border-left-width"),10)},_getTemplateComponent:function(){return this.getChildControls(void 0,false)[0]},_startHoverTimer:function(t){if(this._stopTimer("_hoverTimer"),this._stopTimer("_showTimer"),this.isOpened())if("delay"===this._stateStage)this._cancelShow();else this._hoverTimer=setTimeout(s(function(){if(!this.isLockShowed()&&!(t&&$(t.relatedTarget).closest(".ws-info-box").length))this.sendCommand("hide")},this),D)},_elementMouseOver:function(){this._stopTimer("_hoverTimer"),this.show()},_hasStoredChildArea:function(t){return this._childWindows.indexOf(t)>-1},_childWindowClose:function(t,i){if(this._hasStoredChildArea(i))this._childWindows.splice(this._childWindows.indexOf(i),1)},_childWindowCreate:function(t,i){if(this.isOpened())if(!!e(I,w.instanceOfModule.bind(void 0,i))||w.instanceOfMixin(i,"SBIS3.CONTROLS.PopupMixin")){var o=this._childWindowClose.bind(this,null,i);if(!this._hasStoredChildArea(i))this._childWindows.push(i);if(i.subscribe("onDestroy",s(o,this)),this._hoverTarget&&i.hasEvent("onAfterClose"))i.subscribe("onAfterClose",s(this._startHoverTimer,this))}},_bindHoverEvents:function(){this._hoverTarget.bind("mouseenter.wsFloatAreaHover",s(this._elementMouseOver,this)).bind("mouseleave.wsFloatAreaHover",s(this._startHoverTimer,this))},_prepareHover:function(){if(this.setHoverTarget(this._options.hoverTarget,false),this._overflow.bind("wsWindowOpen",this._childWindowCreate.bind(this)),this._overflow.bind("wsWindowClose",this._childWindowClose.bind(this)),this._hoverTarget)this._overflow.hover(this._stopTimer.bind(this,"_hoverTimer"),s(this._startHoverTimer,this)).bind("wsSubWindowOpen",s(this.lockShowed,this)).bind("wsSubWindowClose",s(this.unlockShowed,this))},_prepareArrow:q(function(){var t=this._options.arrow;if("left"==t||"right"==t||"top"==t||"bottom"==t){var i="ws-float-area-arrow-"+t;this._visibleRoot.addClass(i)}}),_prepareKeydown:K(function(){var t=this._overflow.closest(".ws-float-area-stack-cut-wrapper").find(".ws-sticky-header__float-area_header-container");this._initKeyboardMonitor(t)}),_loadDescendents:function(){return this._loadTemplate()},_preparePanel:function(){this._loaded=true,this._initStack(),this._maxWidthSet=void 0,this._destroyCommandButtons();var t=this.getContainer().find(".ws-Window__title-border").first();if(0!==t.length)this._userTitle=t.find("[sbisname=windowTitle] span pre").first(),this._userTitle.empty();else this._userTitle=this.getContainer().find(".ws-window-titlebar-custom").first(),this._userTitle.addClass("ws-window-titlebar");if(this._options.border&&0===t.length)if(this._prepareCloseButton(),this._hasMaximizeButton())this._addMaximizeButton();else this._changeMaximizePanelMode(false);this._setTitleContainer(),this._caption=void 0!==this._options.caption?this._options.caption:this._options.title,this.setTitle(this._caption);var i={};if(!this._options.keepSize){if(!this._options.autoWidth)i["width"]=this._options.width+"px",i["overflow-x"]="auto";else i["overflow-x"]="hidden";if(!this._options.autoHeight&&!this._options.isStack)i["height"]=this._options.height+"px",i["overflow-y"]="auto";else i["overflow-y"]="hidden"}if(this._options.isStack)i["height"]="";if(!a(i))this._container.css(i)},_templateInnerCallbackBeforeReady:function(){if(this._showOnControlsReady)this._preparePanel()},_showControls:function(){if(X.superclass._showControls.apply(this,arguments),this._autoShow&&this._showOnControlsReady)this._showInternal(false)},_loadControls:N("FloatArea.loadControls",function(t,i,e,o,n){var a=X.superclass._loadControls,r=i instanceof p,h,l,d,_,f,c,u,w,m;if(this._showOnControlsReady=this._options.showOnControlsReady||!r||!this._autoShow,this._showOnControlsReady){if("afterShow"!==this._focusState)this._focusState="afterLoadControls";m=a.apply(this,arguments)}else{if(h=v(this._collectControlsToBuild(i,e)[0]),l=require(h.type),d=null,this._options.buildMarkupWithContext)c=this._createContext(h,this.getLinkedContext()),f=c.context;else f=null;if(_=g.buildMarkupForClass(l,h,f,d,this._options),_)this._container.html(_);if(c&&c.craftedContext)this.once("onDestroy",function(){f.destroy()});if(this._preparePanel(),this._showInternal(false),u=[].slice.call(arguments),w=this._useAnimation?1.3*this._options.animationLength:0,"show"===this._state)setTimeout(s(function(){a.apply(this,u),this._runBatchDelayedFunc("_loadControls - "+this._id,function(){if("afterShow"===this._focusState)this._setFocus(),this._focusState=null;else this._focusState="afterLoadControls"})},this),w);else this._focusState="afterLoadControls",a.apply(this,u);m=t}return m}),_setFocus:function(){if(this._options.catchFocus)x.doAutofocus(this._container);else this.setActivationIndex(r.getMaxActivisionIndex()+1)},_isTargetVisible:function(){function t(i){return 0===i.parent().length||"none"===i.css("display")||"hidden"===i.css("visibility")?i:t(i.parent())}var i=this._target.get(0)===window;if(!i)i=t(this._target).is(document);return i},_recalcPosition:q(function(t,i,e){function s(t){var i=false;if("fixed"===t.css("position"))return true;return t.parents().each(function(t,e){if("fixed"===$(e).css("position"))return i=true,false}),i}var o=this._options;if((this.isVisible()||i)&&(o.fixed||t||this._isTargetVisible()))if(o.fixed){var n=o.offset||{},a=parseInt(n.x,10)||0,r=parseInt(n.y,10)||0,h={left:"",right:"",top:"",bottom:""},l=this._overflow,_=d.$win,f={left:-1,right:1,top:-1,bottom:1},c=-1*f[o.side],u=-1*f[o.verticalAlign],p=T.getScrollingContainerFixedOffsets(),g,w;if("center"!==o.side)g=this._getShadowCssIntProp("margin-"+o.side),h[o.side]=a*c+g*f[o.side]+(p[o.side]||0);else h["left"]=(_.width()-l.outerWidth())/2+a*("left"===o.side?1:-1);if("center"!==o.verticalAlign)w=this._getShadowCssIntProp("margin-"+o.verticalAlign),h[o.verticalAlign]=r*u+w*f[o.verticalAlign]+(p[o.verticalAlign]||0);else h["top"]=(_.height()-l.outerHeight())/2+r*("top"===o.side?1:-1);this._overflow.css(h)}else{var m=this.getContainer().height();if(this._prevHeight<=m){var v=s(this._target),b;if(this._overflow.toggleClass("ws-float-area-nostack-panel-overflow-fixed",v),!e||!this._prevPositionOptions)b=j(this._overflow,this._target,o,v),this._prevPositionOptions=b();this._overflow.position(this._prevPositionOptions)}this._prevHeight=m}}),_onResizeHandler:function(){X.superclass._onResizeHandler.apply(this,arguments),this._resizeInner()},_resizeInner:function(){if(this._recalcPosition(),this._updateStickyHeaderWidth(),this._sizeUpdated(),this._firstSizeCalcOnShow)this._getScrollContainer().scrollTop(0),this._firstSizeCalcOnShow=false},_updateStickyHeaderWidth:function(){var t=this.getContainer().closest(".ws-float-area-stack-cut-wrapper"),i=t.children(".ws-sticky-header__header-container");if(i&&i.length){var e=t.children(".ws-sticky-header__scrollable-container")[0].getBoundingClientRect().width;i.css("width",e+"px")}},_onSizeChangedBatch:function(){if(X.superclass._onSizeChangedBatch.apply(this,arguments),this._recalcPosition(),this._sizeUpdated(),this._firstSizeCalcOnShow)this._getScrollContainer().scrollTop(0),this._firstSizeCalcOnShow=false},show:function(){return this._prevPositionOptions=null,this._showInternal(true)},reload:function(t,i){return this._loaded=false,this.setTemplate(this.getCurrentTemplateName()).addCallback(function(e){var s=this.getContainer().closest(".ws-float-area"),o=this.getContainer().prop("style");if(this._maxWidthSet===this._getMaxPanelWidth()&&!i){if(o.width!==this._width)if(this._width=Math.min(parseInt(this._width,10),this._getMaxPanelWidth())+"px",this._width)if(this._hasMaximizeButton())this._setMaximizeMode(this._options.maximized,true);else o.width=this._width,s.width(parseInt(o.width))}else this._updateMinMaxWidthHeight(),s.width(parseInt(o.width));if(t)f._hideDependentAreas(this);return e}.bind(this))},_getScrollContainer:function(){return this._visibleRoot},_needRecalkInvisible:function(){return this._inApplyBatchUpdateIntermediate>0},_applyBatchUpdateIntermediate:function(){this._inApplyBatchUpdateIntermediate++;try{C.applyBatchUpdateIntermediate("FloatArea."+"applyBatchUpdateImmediate")}finally{this._inApplyBatchUpdateIntermediate--}},_showInternal:s(function(t){if(this._cancelHide(),!this._loaded)this._autoShow=true;else if(!this.isDestroyed())if(!this.isOpened()&&"show"!==this._state){if(this._state="show",this._stateStage="delay",d.browser.isMobileIOS&&f._stack.length>=R)return n.alert(rk("На вашем устройстве закончились ресурсы для открытия еще одного окна СБИС. Пожалуйста, закройте лишние окна и повторите попытку заново.")),void this._cancelShow();var i=this._createBatchUpdateWrapper("FloatArea._showInternal.doShow "+this.getId(),function(){if(this._stopAnimation(),this._target&&!this._isTargetVisible())this.hide();else{if(this._stateStage="beforeShow",f._beforeShowStarted(this),this._updateVisibleRootRightPadding(),this._updateMinMaxWidthHeight(true,true),this._visibleRootWrapper.css("visibility","hidden"),this._visibleRootWrapper.removeClass("ws-hidden"),!this._options.isStack)this._recalcPosition(void 0,true);if(this._notify("onBeforeShow"),"show"===this._state){if(this._stateStage="show",this._showDeferred=new y,this.moveToTop(),this._notifyFloatAreaZIndexChanged(),this._checkDelayedRecalk(),this._notifyOnSizeChanged(true),this._firstSizeCalcOnShow=true,this._useAnimation)this._toggleAnimationClasses(true),this._applyBatchUpdateIntermediate(),this._recalcPosition(void 0,true),this._getScrollContainer().scrollTop(0),this._doAnimation(this._getAnimationStartValue(),this._getAnimationEndValue(),this._finishShow.bind(this),0),f._addToAnimationQueue(this._showDeferred,this._animationQueue);else setTimeout(this._finishShow.bind(this),0);f._showStarted(this),this._notify("onShow")}else f._beforeClose(this),f._afterClose(this),this._showDeferred=void 0;if(this._caption)this.getContainer().parent().find(".ws-window-titlebar").attr("title",this._caption).css("z-index",2);return this._showDeferred}});if(t)this._showTimer=setTimeout(i,this._options.showDelay);else i()}return true}),_setTitleContainer:s(function(){this._createTitle()}),_createTitle:function(){var t=function(t){this._generatedTitleContainer.toggleClass("ws-hidden",!t),this._container.css("padding-top",t?this._generatedTitleContainer.outerHeight()+"px":"")}.bind(this);if(this._userTitle.length){if(t(false),0===this._title.closest(this._userTitle).length)this._userTitle.prepend(this._title);this._title.addClass("ws-float-area-title").toggleClass("ws-hidden",!this._caption)}else if(this._options.border&&this._caption){if(0===this._title.closest(this._generatedTitleContainer).length)this._generatedTitleContainer.empty().append(this._title);this._title.addClass("ws-float-area-title ws-float-area-title-generated"),t(true)}else t(false)},_setTitle:Q(function(t){this._caption=t,this._title.text(t),this._createTitle(),this._notifyOnSizeChanged(true)}),moveToTop:function(){if(this.isOpened()&&f._getMaxZIndex()!==this.getZIndex())r.releaseZIndex(this._zIndex),this._zIndex=r.acquireZIndex(this._isModal,false,!!this._options.hoverTarget),r.setVisible(this._zIndex),this._visibleRootWrapper.css("z-index",this._zIndex),this._childWindows.forEach(function(t){t.moveToTop()}),c.adjust()},getZIndex:function(){return this._zIndex},hide:s(function(t){return this._result=void 0,t=void 0===t?true:t,this._options.autoCloseOnHide?this.close(this._result,t):this._hide(t,z)}),_shouldHideByFocusMoveTo:function(t){function i(i,e){var s=t;while(s&&!e(s))s=i(s);return s}var e=this,s=!t.isDestroyed();return s=s&&!i(function(t){return t.getOpener&&t.getOpener()||t.getParent()},function(t){return t===e||!!(w.instanceOfMixin(t,"Lib/Mixins/LikeWindowMixin")&&t.getZIndex&&t.getZIndex()>e.getZIndex())}),s=s&&!i(function(t){return t.getParent()},function(t){return t instanceof X&&!!t._options.hoverTarget}),s=s&&(!i(function(t){return t.getParent()},function(t){return w.instanceOfModule(t,"SBIS3.Notes.DynamicNotesView")})||!e._options.isStack),s},_notifyFloatAreaZIndexChanged:function(){if(this._options.isStack){var t=f._getMaxZIndex();h.globalChannel().notify("FloatAreaZIndexChanged",t)}},_hideInner:function(t){function e(i){var e=function(){this._state="",this._visible=false,this._stateStage="",this._notify("onAfterVisibilityChange",false),r.releaseZIndex(this._zIndex),this._zIndex=null,c.adjust(),this._notifyFloatAreaZIndexChanged()}.bind(this);try{this._visibleRootWrapper.addClass("ws-hidden"),f._afterClose(this),r.deactivateWindow(this,e)}finally{if(this._notify("onClose"),this._notify("onAfterClose",this._result),i.callback(),!this.isDestroyed())this._container.addClass("ws-float-area-hide-complete"),t.call(this)}}var s,o=!this.isOpened();if(!o){if(s=this._cancelShow(),this._state="hide",A.isMobileIOS)$(document.activeElement).trigger("blur");this._runInBatchUpdate("FloatArea.hide.animation - "+this._id+" "+this._options.template,function(){var t=new y;t.addErrback(function(t){return t});try{if(this._hideFinishFn=i.call(e.bind(this,t)),f._beforeClose(this),this._setVisibilityCommandButtons(false),this._toggleTrackTarget(false),this._useAnimation&&"show"===s)this._doAnimation(null,this._getAnimationStartValue(),this._hideFinishFn,f._getPanelHideAnimationDelay()),f._addToAnimationQueue(t,this._animationQueue);else this._hideFinishFn()}catch(i){t.errback(i)}return t})}return o},_addHidePending:function(t){if(!this._hasHidePendig){var i=new y;return this._hasHidePendig=true,i.addCallback(function(){this._hasHidePendig=false;var t=this._saving;return this._saving=void 0,this.finishChildPendingOperations(t)}.bind(this)),this.waitAllPendingOperations(i.addCallback(this._hideInner.bind(this,t)))}return true},_hide:function(t,i){function e(){if(!r.length){if(n=this._addHidePending(i),a instanceof y)a.callback();return true}var t=this,o=r[r.length-1],h=s(function(){_.call(this),r.pop(),e.apply(t)}),l=s(function(t,i){if(false===t.getResult())if(_.call(this),a instanceof y)a.errback()}),d=s(function(t,i){if(false===i)_.call(this)});function _(){this.unsubscribe("onDestroy",h),this.unsubscribe("onAfterClose",h),this.unsubscribe("onBeforeClose",l),this.unsubscribe("onConfirmDialogSelect",d)}return o.once("onDestroy",h),o.once("onAfterClose",h),o.once("onBeforeClose",l),o.once("onConfirmDialogSelect",d),o.close(),false}if("hide"===this._state)return false;var o,n;if(t=void 0===t?true:t,this._state="hide",o=this._notify("onBeforeClose",this._result),n=false!==o,n&&"hide"===this._state){this._state="";var a=true,r=[];if(n=this._loaded){if(!this.isLockShowed(t,r)&&"hide"!==this._state)if(n=!(this._state||this._visible),n)i.call(this);else if(!e.apply(this))(a=new y).addErrback(function(t){return t})}else this._autoShow=false;return true===a?n:a}else if("hide"===this._state)return this._state="",false},close:s(function(t,i){i=void 0===i?true:i;var e=this._result,s;if(this._result=t,this._saving=t,s=this._hide(i,this.destroy),true===s)return true;else if(i)this._result=t;else this._result=e;return false}),ok:function(){return this.close(true)},cancel:function(){return this.close(false)},isVisible:function(){return!this._state&&this._visible},isShow:function(){return this.isVisible()},isOpened:function(){return this._visible&&""===this._state||"show"===this._state},_stopAnimation:function(){if(this._state&&this._useAnimation)this._containerShadow.stop(true),this._toggleAnimationClasses(false)},_stopTimer:function(t){if(this[t])clearTimeout(this[t]),this[t]=void 0},_getAnimationStartValue:function(){var t=this._options.direction,i,e,s,o,n,a;if("slide"===this._options.animation){if("left"===t||"right"===t)i="X",e="left"===t?1:-1,s="outerWidth",o="startWidth";else i="Y",e="top"===t?1:-1,s="outerHeight",o="startHeight";a=["transform","translate"+i+"("+(n=this._containerShadow[s](true)-this._options[o])*e+"px)"]}else if("fade"===this._options.animation)a=["opacity","0"];else if("off"!==this._options.animation)throw new Error(rk("Ошибочная опция animation"));return a},_getAnimationEndValue:function(){var t=this._options.direction,i;if("slide"===this._options.animation)i=["transform","translateX("+0+"px)"];else if("fade"===this._options.animation)i=["opacity","1"];else if("off"!==this._options.animation)throw new Error(rk("Ошибочная опция animation"));return i},_toggleAnimationClasses:function(t){"fade"!==this._options.animation&&this._overflow.toggleClass("ws-float-area-animate",t)},_doAnimation:function(t,i,e,s){this._stopAnimation(),this._toggleAnimationClasses(true);var o=function(t){if(this._useCss3)this._containerShadow.css({"transition-property":t?"":"none"})}.bind(this),n=function(){this._setAnimationDurationProperty(""),this._containerShadow.css(i[0],""),setTimeout(function(){this._setAnimationDurationProperty(this._getAnimationLength()),this._toggleAnimationClasses(false)}.bind(this),0),this._containerShadow.css({"will-change":"auto"}),e()}.bind(this);if(t)o(false),this._containerShadow.css(t[0],t[1]),this._visibleRootWrapper.css("visibility","visible");var a=function(){var t;if("fade"===this._options.animation&&"opacity"==i[0]&&1==i[1])this._setVisibilityCommandButtons(true);if(this._useCss3)this._containerShadow.css({"will-change":"transform"}),requestAnimationFrame(function(){o(true),this._transitionEndHandler=n,this._containerShadow.css(i[0],i[1]);var t=this._options.animationLength;if(this._options.disableCSS3AnimationEvent)setTimeout(n,t);f._fixCss3TransitionEndEvent(this._containerShadow.get(0),i[0],i[1],t)}.bind(this));else(t={})[i[0]]=i[1],this._containerShadow.animate(t,this._options.animationLength,n)}.bind(this);this._stopTimer("_beforeAnimationTimer"),this._beforeAnimationTimer=setTimeout(a,Math.max(s,10))},_finishShow:s(function(){this._state="",this._visible=true,this._notify("onAfterVisibilityChange",true);try{if(this._toggleTrackTarget(true),this._setVisibilityCommandButtons(true),this._visibleRootWrapper.css("visibility","visible"),this.moveToTop(),f._finishShow(this),this._options.catchFocus)this._moveFocusToSelf();this._runBatchDelayedFunc("onAfterShow",function(){if("afterLoadControls"===this._focusState)this._setFocus(),this._focusState=null;else this._focusState="afterShow";setTimeout(function(){if(!this.isDestroyed()&&!this._isShowCanceled)this._notify("onAfterShow");this._isShowCanceled=false}.bind(this),400)}),this._updateStickyHeaderWidth()}finally{var t=this._showDeferred;if(this._showDeferred=void 0,t.callback(),this._container.addClass("ws-float-area-show-complete"),this._toggleAnimationClasses(false),A.isMobileSafari)setTimeout(s(function(){this.getContainer().closest(".ws-float-area-stack-panel-overflow").addClass("ws-ipad-scrolling-content-fix")}.bind(this),this),2e3)}}),_stopTimers:function(){this._stopTimer("_showTimer"),this._stopTimer("_beforeAnimationTimer"),this._stopTimer("_hoverTimer")},_cancelShow:function(){if(C.haveBatchUpdate())C.endBatchUpdate("FloatArea._showInternal.doShow "+this.getId());this._container.removeClass("ws-float-area-show-complete"),this._stopTimers();var t=this._stateStage;if("show"===this._state){this._isShowCanceled=true;try{if(this._stopAnimation(),"beforeShow"===t)this._visibleRootWrapper.addClass("ws-hidden");if(this._showDeferred){var i=this._showDeferred;this._showDeferred=void 0,i.callback()}}finally{this._state="",this._stateStage=""}}return t},_cancelHide:function(){if(this._container.removeClass("ws-float-area-hide-complete"),"show"!==this._state)this._stopTimers();if("hide"===this._state)try{if(this._stopAnimation(),this._hideFinishFn){var t=this._hideFinishFn;this._hideFinishFn=function(){},t()}}finally{this._state=""}},canAcceptFocus:function(){return this._visible},_isAcceptKeyEvents:function(){return true},_keyboardHover:function(t){var i,e;if(!t.shiftKey&&t.which===d.key.esc){if(t.stopPropagation(),t.stopImmediatePropagation(),i=f._getTopFloatArea(),e=i&&i.control,e!==this&&!!e._state)e.sendCommand("hide");else this.sendCommand("hide");return false}return X.superclass._keyboardHover.apply(this,arguments)},_childrenLoadCallback:function(){},_toggleTrackTarget:q(function(t){var i=this._target&&this._target.length,e=d.$win,o=function(){if(e.unbind("resize",this._windowResizeHandler),i)x.trackElement(this._target,false)}.bind(this);if(!this._options.trackTarget)return;if(!this._windowResizeHandler)this._windowResizeHandler=function(){this._recalcPosition(void 0,void 0,true)}.bind(this);if(o(),t)if(e.bind("resize",this._windowResizeHandler),!this._options.fixed&&i)x.trackElement(this._target).subscribe("onMove",s(function(t,i,e){this._recalcPosition(i,void 0,!e)},this)).subscribe("onVisible",s(function(t,i){var e=this._notify("onTargetVisibilityChange",i)},this))}),destroy:function(){if(this._cancelShow(),this._cancelHide(),this._toggleTrackTarget(false),r.releaseZIndex(this._zIndex),c.adjust(),f._removeArea(this),X.superclass.destroy.apply(this,arguments),this._visibleRootWrapper.remove(),this._hoverTarget)this._hoverTarget.unbind(".wsFloatAreaHover");if(this._childWindows.map(function(t){return t}).forEach(function(t){if(!t.isDestroyed())t.destroy()}),!this._options.fixed)this.setTarget(null);for(var t in this._memoizedFuncs)if(this._memoizedFuncs.hasOwnProperty(t))this._memoizedFuncs[t].reset(),delete this._memoizedFuncs[t];var i=$();this._target=i,this._options.target=i,this._visibleRoot=i,this._visibleRootWrapper=i,this._overflow=i,this._containerShadow=i,this._generatedTitleContainer=i,this._hoverTarget=i,this._prevPositionOptions=null},isAutoHide:function(){return this._options.autoHide},_updateMinMaxWidthHeight:K(function(t,i){var e,s=this._options.minWidth,o=this._getMaxPanelWidth(),n=this._options.maxWidth!==1/0,a;if(this._maxWidthSet!==o)if(e=this._container.prop("style"),this._maxWidthSet=o,e.maxWidth=o+"px",this._getFixedWidth.reset(),this._hasMaximizeButton())this._setMaximizeMode(this._options.maximized,true);else if(n)e.width=Math.max(s,Math.min(this._options.maxWidth,o))+"px";else if(d.browser.isIE&&s>0&&""===e.width&&Z().hasClass("engine-OnlineBaseInnerMinCoreView"))e.width=s+"px";if(this._needStackPanelHeightRecalc()&&(t||i)){if(e=e||this._container.prop("style"),a=this._getContainerMinHeight()+"px",t)e.minHeight=a;if(i)e.height=a}}),_getMaxPanelWidth:function(){if(this._hasMaximizeButton())return f._getMaxWidthForAreaNew(this,this._options.minWidth);return Math.max(this._options.minWidth,f._getMaxWidthForArea(this,this._options.minWidth))},_needStackPanelHeightRecalc:function(){return this._needPanelHeightRecalc()&&this._options.isStack},_needPanelHeightRecalc:function(){return B&&!this.getContainer().closest(".ws-float-area__block-layout").length},_postUpdateResizer:function(){},isBlockLayout:function(){return-1!==this._options.className.indexOf("ws-float-area__block-layout")},_updateVisibleRootRightPadding:K(function(){var t=f._getPanelRootPaddingRight(this,!this.isBlockLayout());if(t>0)this._visibleRoot.css("padding-right",t),this._visibleRootWrapper.css("right",0);else this._visibleRoot.css("padding-right",0),this._visibleRootWrapper.css("right",t)}),_getContainerMinHeight:function(){var t=this._generatedTitleContainer,i=t.hasClass("ws-hidden")?0:t.outerHeight();return f._getWindowHeight()-i},_sizeUpdated:function(t){var i=this._container.prop("style"),e=Object.keys(this._childPanelSizes).reduce(function(t,i){return Math.max(t,this._childPanelSizes[i])}.bind(this),0),o;if(this._needStackPanelHeightRecalc()){if(o=Math.max(e,this._getContainerMinHeight()),"auto"!==i.height)i.height="auto";if(i.minHeight)i.minHeight="";if(this._container.height()<=o)i.height=o+"px",this._getFixedHeight.reset()}else this._overflow.css("min-height",e+"px");if(this._updateMinMaxWidthHeight(true,false),t)this._updateVisibleRootRightPadding(),this._onResizeHandler();if(this.isVisible())f._updateSideBarVisibility();if(!this._options.isStack)if(M.isMobilePlatform&&f._useTouch()&&window.requestAnimationFrame)window.requestAnimationFrame(function(t){var i={"-webkit-overflow-scrolling":"auto"},e={"-webkit-overflow-scrolling":""};t.css(i),window.requestAnimationFrame(s(t.css.bind(t,e),this))}.bind(this,this._visibleRoot))},_subscribeToWindowResize:function(){},_restoreSize:function(){},_calculatePositionHorisontal:function(){},_calculatePositionVertical:function(){},toggle:function(){if("show"==this._state||this._visible)this.hide();else this.show()},setTarget:q(function(t){if(this._options.fixed)throw new Error(rk("Опция fixed не совместима с заданием target-а - при fixed=true таргетом всегда будет window"));if(this._toggleTrackTarget(false),this._scrollUnsub)this._scrollUnsub();if(t)this._target=$(t),this._scrollUnsub=f.scrollParentFloatArea(this._visibleRoot,this._target);else this._target=$(),this._scrollUnsub=null;if(this.isVisible())this._toggleTrackTarget(true);var i=f._getFloatAreaContentRoot(),e=this._visibleRootWrapper;if(!this._isModal&&this._target.closest(i).length){if(!e.closest(i).length){if(this._options.task1173269044)i=f._getFloatAreaBodyContainerRoot();e.appendTo(i)}}else if(e.closest(i).length)e.appendTo(Z())}),setOffset:function(t){this._options.offset=t,this._recalcPosition(null,true)},getTarget:function(){return this._target},getOffset:function(){return m(this._options.offset)},storeActiveChild:function(t){this.setChildActive(t)},getTemplateName:function(){return this._options.template},lockShowed:function(){++this._locksShowed},unlockShowed:function(){if(0===--this._locksShowed&&this._hoverTimer)this._startHoverTimer()},isLockShowed:function(t,i){i=i||[],t=t||false;var e=[],s,o,n;if(this._locksShowed>0)return true;else{for(s=0,o=this._childWindows.length;s<o;s++){if(n=this._childWindows[s],w.instanceOfModule(n,"Deprecated/Controls/FilterFloatArea/FilterFloatArea")){e.push(s);continue}if(n.isVisible()||n instanceof X&&n.isOpened()){if(!t)return true;i.push(this._childWindows[s])}}if(e.length)for(s=0,o=e.length;s<o;s++)this._childWindows[e[s]].hide();return false}},setHoverTarget:function(t,i){if(this._hoverTarget)this._hoverTarget.unbind(".wsFloatAreaHover");if(this._options.hoverTarget=t,this._hoverTarget=$(this._options.hoverTarget).length?$(this._options.hoverTarget):void 0,this._hoverTarget)this._bindHoverEvents();if(i)this._stopTimer("_hoverTimer")},getHoverTarget:function(){return this._hoverTarget},focusCatch:function(t){if(r.disableLastActiveControl(),t.shiftKey)r.focusToFirstElement();else r.focusToLastElement();return true},setHideSideBar:function(t){this._options.hideSideBar=t},_templateOptionsFilter:function(){return X.superclass._templateOptionsFilter.apply(this,arguments).concat("border","caption")},setHasPopupInside:function(t){if(this._options.isStack&&A.isMobileIOS)f._toggleHasPopupInside(this.getId(),t)}});return X});
//# sourceMappingURL=FloatArea.js.map
define("Lib/Control/Window/Window",["Core/core-extend","Core/core-functions","Core/core-instance","Core/helpers/Function/callNext","Core/helpers/Function/forAliveOnly","Core/WindowManager","Core/CommandDispatcher","Core/constants","Core/helpers/dom&controls-helpers","Lib/Control/TemplatedAreaAbstract/TemplatedAreaAbstract","Deprecated/Controls/ModalOverlay/ModalOverlay","Lib/FloatAreaManager/FloatAreaManager","Lib/Mixins/LikeWindowMixin","Lib/Mixins/PendingOperationParentMixin","Core/Deferred","Core/EventBus","Core/helpers/event-helpers","Core/detection","Core/compatibility","i18n!Lib/Control/Window/Window"],function(i,t,e,s,n,o,a,h,r,d,l,_,u,c,w,f,p,m){"use strict";var v=10,g=150,b=(h.defaultOptions||{})["Lib/Control/Window/Window"]||{};function C(i,t){var e=function(){var t;try{this._updateCount++,t=i.apply(this,arguments)}finally{if(this._updateCount--,0===this._updateCount&&false!==t){this._updateCount++;try{this._adjustWindowPosition(),this._onResizeHandler()}finally{this._updateCount--}}}return t};return t?e.bind(t):e}var x=i.mixin(d,[u,c]).extend({$protected:{_window:void 0,_windowContent:void 0,_updateCount:0,_titleBar:void 0,_resizeBar:void 0,_resizeBtn:void 0,_isShow:false,_isMaximized:false,_isCenteredV:false,_isCenteredH:false,_isAnimated:false,_isAnimating:false,_animatedWindows:false,_leftOpt:void 0,_topOpt:void 0,_maximizeBtn:void 0,_left:void 0,_top:void 0,_dRender:null,_zIndex:0,_startCoords:null,_options:{modal:false,resizable:true,caption:void 0,windowState:true,disableActions:false,deprecated:false,border:true,maximize:void 0,top:void 0,left:void 0,parent:null,title:"",animatedWindows:void 0,closeOnOverlayClick:true,origWidth:0,needSetDocumentTitle:true,origHeight:0,needRecalcPositionOnSizeChange:true,task_1174068748:false},_keysWeHandle:[h.key.esc,h.key.tab,h.key.enter,h.key.left,h.key.right],_haveTitle:false,_haveContentTitleBlock:false,_mouseMoveHandler:null,_mouseUpHandler:null,_absolutePosition:false},$constructor:function(i){if(this._mouseMoveHandler=this._mouseMove.bind(this),this._mouseUpHandler=this._mouseUp.bind(this),this._animatedWindows=void 0===this._options.animatedWindows?b.animatedWindows:this._options.animatedWindows,this._leftOpt=void 0===this._options.left?b.left:this._options.left,this._topOpt=void 0===this._options.top?b.top:this._options.top,this._moveWindowWithRecalc=C(this._moveWindow,this),this._dRender=new w,this._publish("onBeforeClose","onAfterClose","onMove","onAfterMove"),[["close",this.close],["ok",this.ok],["cancel",this.cancel],["maximize",this._maximizeWindow],["rebuildTitleBar",this._rebuildTitleBar]].forEach(function(i){a.declareCommand(this,i[0],i[1])}.bind(this)),void 0!==i.resizeable)this._options.resizable=i.resizeable;var e={left:parseInt(this._options.left,10),top:parseInt(this._options.top,10)};if(h.browser.isMobileSafari&&!this._options.resizable&&this._options.maximize)this._absolutePosition=false,e.right=0;else this._absolutePosition=true;if(this._window=this._createControl().css(e),this.subscribe("onAfterLoad",function(){if(this._options.deprecated)this.close(),t.alert(rk("У Вас недостаточно прав для просмотра."));else if(this._options.visible)this.show()}),h.browser.isIE)this.subscribe("onBatchFinished",function(){this._window.addClass("clear-box-shadow"),this._container.width(),this._window.removeClass("clear-box-shadow")});if(this._adjustWindowPositionSelf=this._mobileInput.bind(this),h.compatibility.touch)f.globalChannel().subscribe("MobileInputFocus",this._adjustWindowPositionSelf),f.globalChannel().subscribe("MobileInputFocusOut",this._adjustWindowPositionSelf);if(this._isModal&&this._options.closeOnOverlayClick)this.subscribeTo(l,"onClick",function(i){if(this.isVisible()&&l.isShownForWindow(this))this._moveFocusToSelf(),i.setResult(true),this.close()}.bind(this));f.globalChannel().notify("onWindowCreated",this)},_mobileInput:function(i){var t="mobileinputfocus"===i.name;setTimeout(function(){if(!t)this._adjustWindowPosition()}.bind(this),350)},_activateParent:function(){return false},_templateInnerCallback:C(function(){return x.superclass._templateInnerCallback.apply(this,arguments)}),_getTemplateComponent:function(){return this.getChildControls(void 0,false)[0]},_templateInnerCallbackBeforeReady:function(){var i=parseInt(this._leftOpt,10),t=parseInt(this._topOpt,10),e;if(this._left=isNaN(i)?0:i,this._top=isNaN(t)?0:t,this._isCenteredV=isNaN(t),this._isCenteredH=isNaN(i),this._isMaximized=!!(void 0!==this._options.maximize?this._options.maximize:this._options.windowState&&"maximized"==this._options.windowState),this.getContainer().toggleClass("ws-window-maximized",this._isMaximized),this._createTitleBar(),this._options.resizable&&!(this._options.autoWidth&&this._options.autoHeight))this._resizeBtn=$("<div></div>").addClass("ws-window-resize").bind("mousedown touchstart",function(i){return this._isResizing=true,this._mouseDown(i)}.bind(this)).appendTo(this._window);if(this._container.append('<div style="clear: both;">'),this._isOptionDefault("height")&&this._options.autoHeight)e="auto";else if(this._haveTitle&&!this._haveContentTitleBlock)if(e=parseInt(this._height,10),!isNaN(e))e+=this._titleBar.height();else e=this._height;else e=this._height;this.setSize({width:this._isOptionDefault("width")&&this._options.autoWidth?"auto":this._width,height:e}),this._dRender.callback()},_setMinMaxSizes:function(){},_postUpdateResizer:function(i,t){},describe:function(){return"Window#"+this.getId()+" template: "+(this._currentTemplateInstance&&this._currentTemplateInstance.getName()||this._options.template)},_loadDescendents:function(){return this._loadTemplate()},_childrenLoadCallback:function(){},_setTemplateDimensions:function(i){if(i.width&&this._isOptionDefault("width"))this._width=i.width;if(i.height&&this._isOptionDefault("height"))this._height=i.height},_isAcceptKeyEvents:function(){return true},_keyboardHover:function(i){if(i.which in this._keysWeHandle){if(i.which==h.key.esc)return this.close(),false;if(i.which==h.key.left||i.which==h.key.right)return this._switchingBetweenButtons(i);if(this.isEnabled())return x.superclass._keyboardHover.apply(this,arguments);else return true}return true},_switchingBetweenButtons:function(i){var t=o.getActiveWindow().getActiveChildControl(),s=this.getChildControls(),n=0,a=[],r,d;if(t&&!e.instanceOfModule(t,"Deprecated/Controls/Button/Button"))return true;for(r=0;r<s.length;r++)if(e.instanceOfModule(s[r],"Deprecated/Controls/Button/Button"))a.push(s[r]);for(r=0;r<a.length;r++)if(a[r].isActive()){n=r;break}if(i.which==h.key.left)d=n-1;if(i.which==h.key.right)d=n+1;if(d=(a.length+d)%a.length,a[d])a[n].setActive(false),a[d].setActive(true);return false},_createControl:function(){var i=this._isModal?"ws-modal":"",t=this._absolutePosition?"ws-absolute":"ws-fixed",e={opacity:0},s;if(this._absolutePosition)e.left=0,e.top=0;return s=$("<div></div>").appendTo(document.body).css(e).addClass(t+" ws-window radius "+i),this._windowContent=$("<div>",{style:"z-index: 0"}).addClass("ws-window-content radius").appendTo(s),this._container.prependTo(this._windowContent),this._container.css("z-index",0),p.wheel(s,function(i){var t=$(i.target,s),e=i.wheelDelta;if(!(t.toArray().concat(t.parentsUntil(s).toArray()).filter(function(i){var t=$(i),s=t.css("overflow-y");return("auto"===s||"scroll"===s)&&(e<0&&i.scrollHeight-t.scrollTop()>i.offsetHeight||e>0&&t.scrollTop()>0)}).length>0))if(i.stopPropagation(),!t.is("object"))i.preventDefault()}),s.get(0).wsControl=this,s},_setupTitleVisibility:function(){this._title.toggleClass("ws-hidden",0===this._title.html().trim().length)},_rebuildTitleBar:function(){this._window.find(".ws-window-titlebar-custom.ws-window-titlebar").remove(),this._createTitleBar()},_createTitleBar:function(){var i=this._window.find(".ws-window-titlebar-custom").eq(0),t=this._container.find(".ws-Window__title-border").eq(0),e,s,n,o,a;if(this._haveContentTitleBlock=t.length>0,this._haveTitle=this._options.border||this._haveContentTitleBlock,this._haveTitle){if(this._haveContentTitleBlock)this._titleBar=t;else if(i.length>0)this._titleBar=i;else this._titleBar=$("<div></div>");if(e=this._haveContentTitleBlock?"radius":"ws-window-titlebar radius",o=function(i){if(!this._targetIsHeaderControl(i))i.preventDefault()}.bind(this),a=function(i){if(!this._targetIsHeaderControl(i))this._maximizeWindow()}.bind(this),this._titleBar.addClass(e).mousedown(o).dblclick(a).prependTo(this._window).append("<div>&nbsp;</div>"),!this._haveContentTitleBlock)this._title.addClass("ws-window-title").prependTo(this._titleBar),this._createTitleButtons(),this._applyDrag(this._titleBar);else if(this._title.detach(),n=this._titleBar.find('div[sbisname="windowTitle"]'),n.length)this._applyDrag(n);if(this._window.addClass("ws-window-draggable"),this._titleBar.removeClass("ws-hidden"),this._initKeyboardMonitor(this._titleBar),this._initKeyboardMonitor(this._window),s=void 0!==this._options.caption?this._options.caption:this._options.title,s)this.setTitle(s);this._setupTitleVisibility()}else if(this._titleBar)this._title.detach(),this._titleBar.remove(),this._titleBar=void 0,this._window.removeClass("ws-window-draggable")},_applyDrag:function(i){i.bind("mousedown touchstart",this._mouseDown.bind(this))},applyDrag:function(i){this._applyDrag(i)},_makeLoadErrorHandler:function(i){var t=x.superclass._makeLoadErrorHandler.call(this,i);return function(i){try{this._createTitleBar()}catch(i){}t.call(this,i)}},_createTitleButtons:function(){var i=this;if(!this._options.disableActions){if(this._options.resizable)this._maximizeBtn=$("<a></a>").addClass("ws-window-titlebar-action maximize").click(function(){i._maximizeWindow()}).prependTo(this._titleBar);$("<a></a>").addClass("ws-float-close ws-float-close-right").click(function(){return i._moveFocusToSelf(),i.close(),false}).prependTo(this._titleBar)}},_updateDocumentTitle:function(){var i=this.getTitle(),t=document.title,e=t?" - "+i:i,s=t.lastIndexOf(e),n=t.lastIndexOf(i);if(this._options.needSetDocumentTitle&&i&&(s!==t.length-e.length||t.length<e.length)&&(n!==t.length-i.length||t.length<i.length))document.title=document.title+e},_clearDocumentTitle:function(){var i=this.getTitle(),t=document.title,e=t?" - "+i:i,s=t.lastIndexOf(e),n=t.lastIndexOf(i),o;if(i&&(s===t.length-e.length||n===t.length-i.length))o=-1!==s?s:n,document.title=t.slice(0,-1!==o?o:t.length)},_setTitle:function(i){x.superclass._setTitle.apply(this,arguments),this._window.find('div[sbisname="windowTitle"] span').text(i),this._setupTitleVisibility()},getZIndex:function(){return this._zIndex},show:function(i){if(!this._isShow){if(m.isIE)this._window.addClass("ws-invisible");this._dRender.addCallback(s.call(this._showRenderCallback.bind(this,i),this._notifyBatchDelayed.bind(this,"onAfterShow")))}},_showRenderCallback:function(i){if(C(function(){if(this._window.css("opacity",""),this._window.removeClass("ws-hidden"),this._notify("onBeforeShow"),this._updateDocumentTitle(),this._isShow=true,this._checkDelayedRecalk(),!i)this.moveToTop(),r.doAutofocus(this._container);else o.setVisible(this._zIndex);if(this._isModal)l.adjust()},this)(),m.isIE)this._window.removeClass("ws-invisible")},_hideWindow:function(){this._window.addClass("ws-hidden"),this._isShow=false,o.popAndShowNext(this)},_restoreLastActiveOnHide:function(){if(m.isMobileIOS)$(document.activeElement).trigger("blur");var i=o.getActiveWindow();if(i)i.onBringToFront()},_notifyMaximizedChange:function(i){_._setWindowMaximized(this,i)},hide:function(){if(!this._isShow)return;if(this._notifyMaximizedChange(false),this._hideWindow(),o.releaseZIndex(this._zIndex),this._clearDocumentTitle(),this._restoreLastActiveOnHide(),this._releaseZIndex(),this._isModal)l.adjust()},isVisible:function(){return this._isShow},close:function(i){var t=this;this._saving=i;function e(i){var e=new w;return e.addCallback(function(){var i=t._saving;return t._saving=void 0,t.finishChildPendingOperations(i)}),t.waitAllPendingOperations(e.addCallback(i))}return this.getReadyDeferred().addCallback(n(function(){var t=this,s=this._notify("onBeforeClose",i),n=function(){t.hide(),t._notify("onAfterClose",i),t.destroy()},o=this.getActiveChildControl(void 0,true);while(o)o&&o.setActive(false),o=o.getParent();if(false!==s)if(this._animatedWindows&&!this._isAnimating)this._isAnimating=true,this._window.animate({top:"-="+this._window.height()+"px"},g,function(){this._isAnimating=false,e(n.bind(t))});else e(n)},this))},_removeContainer:function(){this._window.empty().remove()},_releaseZIndex:function(){if(0!=this._zIndex)o.releaseZIndex(this._zIndex),this._zIndex=0},destroy:function(){if(this._notifyMaximizedChange(false),this._window.get(0).wsControl=null,this._titleBar)this._titleBar.unbind(),this._window.find('div[sbisname="windowTitle"]').unbind(),this._titleBar.empty().remove(),this._titleBar=$();if(this._windowContent)this._windowContent.empty().remove(),this._windowContent=$();if(this._resizeUnsub&&this._resizeUnsub(),this._releaseZIndex(),h.compatibility.touch)f.globalChannel().unsubscribe("MobileInputFocus",this._adjustWindowPositionSelf),f.globalChannel().unsubscribe("MobileInputFocusOut",this._adjustWindowPositionSelf);x.superclass.destroy.apply(this,arguments),this.hide(),this._window=$()},ok:function(){return this.close(true)},cancel:function(){return this.close(false)},shadowsOff:function(){if(this._window.removeClass("radius"),this._windowContent.removeClass("radius"),this._titleBar)this._titleBar.removeClass("radius")},shadowsOn:function(){if(this._window.addClass("radius"),this._windowContent.addClass("radius"),this._titleBar)this._titleBar.addClass("radius")},_getResizerSize:function(i,t,e){return{width:Math.max(0,t+this._windowWidthStart-this._clientXstart-i.left),height:Math.max(0,e+this._windowHeightStart-this._clientYstart-i.top)}},_updateZIndex:function(){var i=o,t=this._zIndex;if(i.releaseZIndex(this._zIndex),this._zIndex=i.acquireZIndex(this._isModal,this._isMaximized),i.setVisible(this._zIndex),t!==this._zIndex)if(m.isIE10)this._window.css("z-index",0),setTimeout(function(){this._window.css("z-index",this._zIndex),this._adjustModalOverlay()}.bind(this),0);else this._window.css("z-index",this._zIndex),this._adjustModalOverlay()},_adjustModalOverlay:function(){if(this._isModal)l.adjust()},_moveWindow:function(i,t){this._isCenteredV=false,this._isCenteredH=false,this._isMaximized=false,this._left=i,this._top=t,this._updateZIndex()},moveWindow:function(i,t){this._moveWindowWithRecalc(i,t)},setSize:C(function(i){var t=parseInt(this._options.minWidth,10)||0,e=parseInt(this._options.minHeight,10)||0,s=parseInt(this._options.maxWidth,10)||1/0,n=parseInt(this._options.maxHeight,10)||1/0;if(this._width=Math.min(s,Math.max(t,parseInt(i.width,10))),isNaN(this._width))this._width="auto";if(this._height=Math.min(n,Math.max(e,parseInt(i.height,10))),isNaN(this._height))this._height="auto"}),moveWindowToCenter:C(function(){this._isCenteredV=true,this._isCenteredH=true,this._isMaximized=false,this._updateZIndex()}),_maximizeWindow:C(function(){var i=this._options.resizable;if(i)if(this._isMaximized=!this._isMaximized,this.getContainer().toggleClass("ws-window-maximized",this._isMaximized),this._updateZIndex(),this._isMaximized){if(this._maximizeBtn)this._maximizeBtn.addClass("fill");if(this._window.removeClass("ws-window-draggable"),this._resizeBtn)this._resizeBtn.hide()}else{if(this._maximizeBtn)this._maximizeBtn.removeClass("fill");if(this._window.addClass("ws-window-draggable"),this._resizeBtn)this._resizeBtn.show()}return i}),moveToTop:function(i){if(this._isShow){var t=o;if(!i&&!t.pushUp(this))return-1;if(this._updateZIndex(),$(".ws-window-titlebar.active").removeClass("active"),this._titleBar)this._titleBar.addClass("active");return this._zIndex}else return-1},isMovableToTop:function(){return true},_targetIsHeaderControl:function(i){var t=".ws-window-titlebar-action, .ws-component:not(html)",e=$(i.target).parents().add(i.target);return e.closest(t).length&&!e.closest('[sbisname="windowTitle"]').length},_mouseDown:function(i){if(this._isMaximized||this._targetIsHeaderControl(i))return true;_._hideUnnecessaryAreas(this),this.moveToTop();var t=this._window.offset(),e=p.getTouchEventCoords(i);if(this._clientXstart=e.x-t.left,this._clientYstart=e.y-t.top,this._windowWidthStart=this._window.width(),this._windowHeightStart=this._window.height(),this._mouseStarted=true,this._startCoords={left:this._left,top:this._top},this._isResizing){var s=this._window.offset();this._resizeBar=$("<div></div>").addClass("ws-window-resizebar").fadeTo(0,.8).appendTo(document.body).css({top:s.top-v,left:s.left-v,width:this._window.width(),height:this._window.height(),"z-index":o.getMaxZIndex()+10})}return h.$doc.bind("mousemove touchmove",this._mouseMoveHandler).bind("mouseup touchend",this._mouseUpHandler),i.preventDefault()},_mouseMove:function(i){if(this._mouseStarted)if(this._isResizing){var t=p.getTouchEventCoords(i);this._resizeBar.css(this._getResizerSize(this._resizeBar.offset(),t.x,t.y))}else{var t=p.getTouchEventClientCoords(i);this._moveWindow(t.x-this._clientXstart,t.y-this._clientYstart),this._adjustWindowPosition()}return i.stopPropagation(),i.preventDefault()},_mouseUp:function(i){if(!h.browser.isIE)this._window.fadeTo(0,1);if(this._window.removeClass("move"),h.$doc.unbind("mousemove touchmove",this._mouseMoveHandler).unbind("mouseup touchend",this._mouseUpHandler),this._mouseStarted=false,this.onBringToFront(),this._isResizing){var t=this._resizeBar.offset();this._resizeBar.remove(),this._isResizing=false;var e=p.getTouchEventCoords(i);this.setSize(this._getResizerSize(t,e.x,e.y))}if(this._startCoords.left!==this._left||this._top!==this._startCoords.top)this._notify("onAfterMove")},canAcceptFocus:function(){return this.isShow()},_restoreSize:function(){},_adjustWindowPosition:function(){if(this.isDestroyed())return;function i(i){var t=["width","height","max-width","max-height","min-width","min-height","margin-left","margin-right","margin-top","margin-bottom"];for(var e in i)if(i.hasOwnProperty(e)){var s=i[e];if(-1!==t.indexOf(e))i[e]="auto"===s||""===s?s:0!==s?s+"px":0}return i}this._notifyMaximizedChange(this._isMaximized);var t=h.browser.isMobileSafari,e=t?window.innerWidth:$(window).width(),s=t?window.innerHeight:$(window).height(),n=this._options.border?100:0,o,a=this._options.minHeight,r={},d=this._left,l=this._top,_=this._haveTitle?this._titleBar.height():0,u=this._haveContentTitleBlock?_:0,c={},w=this._window.offset(),f=Math.max(0,e),p=Math.max(0,s),v=Math.max(p-_,0),b,x,z,y,M;if(this._isAnimating)return true;if("auto"===this._height){if(this._isMaximized)this._container.css("height","auto"),r.height=this._container.height()<v?v:"auto";else if(this._options.task_1174068748)r.height=this._container.height()<v?"auto":v;else r.height="auto";r.minHeight=a?Math.max(0,a-u):""}else if(this._isMaximized)r.height=Math.max(0,p-_);else r.height=this._height-_;if("auto"===this._width){if(this._container.css({width:"auto","min-width":""}),this._isMaximized)this._container.css("width","auto"),r.width=this._container.width()<f?f:"auto";else if(r.width="auto",!this._options.task_1174068748)r.display="table";o=Math.max(this.isVisible()?this.getMinWidth():this._options.minWidth,n),r.minWidth=o||""}else if(this._isMaximized)r.width=f;else r.width=this._width;if(this._windowContent.css(i({"overflow-x":"hidden","overflow-y":"hidden","margin-top":_,"max-width":f,"max-height":v,width:""})),this._container.css(i({width:r.width,height:r.height,display:r.display,"min-height":r.minHeight,"min-width":r.minWidth,position:"relative",overflow:"visible"})),m.isIE12)this._windowContent.css("width",r.width);if(z={},this._windowContent.prop("scrollHeight")>v)z["overflow-y"]="scroll",M=true;if(this._windowContent.css(z),z={},this._windowContent.prop("scrollWidth")>f)z["overflow-x"]="scroll",y=true;if(h.compatibility.touch&&(y||M))z["-webkit-overflow-scrolling"]="touch";if(y&&M||this._isMaximized)z["width"]=f;if(this._windowContent.css(z),b=this._window.outerWidth(true),x=this._window.outerHeight(true),this._isMaximized)c={left:0,top:0};else c={top:this._isCenteredV?(s-x)/2:Math.min(Math.max(0,l),s-x),left:this._isCenteredH?(e-b)/2:Math.min(Math.max(0,d),e-b)};if(this._absolutePosition){var T=$(window).scrollTop(),B=$(window).scrollLeft();c.top+=T>=0?T:0,c.left+=B>=0?B:0}function I(){if(w.left!==c.left||w.top!==c.top)c.left=parseInt(c.left,10),c.top=parseInt(c.top,10),W._window.css(c),W._notify("onMove",c.left,c.top)}var W=this;if(this._animatedWindows&&!this._isAnimated&&!this._isAnimating)c.top=-this._window.height(),I(),this._window.animate({top:"+="+this._window.height()+"px"},g,C(function(){W._isAnimating=false,W._isAnimated=true},W)),this._isAnimating=true;else I()},_onSizeChangedBatch:function(){if(x.superclass._onSizeChangedBatch.apply(this,arguments),!(h.browser.isMobilePlatform&&$(document.activeElement).is('input[type="text"], textarea, *[contentEditable=true]'))&&this._options.needRecalcPositionOnSizeChange)this._adjustWindowPosition();return true},_subscribeToWindowResize:function(){var i=C(function(){},this);h.$win.bind("resize",i),this._resizeUnsub=function(){h.$win.unbind("resize",i)}},_templateOptionsFilter:function(){return x.superclass._templateOptionsFilter.apply(this,arguments).concat("border","resizable","resizeable","caption","maximize","windowState","deprecated")},_resizeInner:function(){if(this.isVisible()&&this._options.needRecalcPositionOnSizeChange)C(function(){},this)()}});return x});
//# sourceMappingURL=Window.js.map
define("html!Deprecated/Controls/ProgressBar/ProgressBar",function(){var r=function(r){var s=function(){var r=/\{\{([\s\S]+?)\}\}/g;return function(s){for(;r.test(s);)s=s.replace(r,"&#123;&#123;$1&#125;&#125;");return s}}(),e=function(r){return r.join?r.join(""):r.toString()},o=function(r){return void 0===r?"":r&&"object"==typeof r?e(r):""+r},t="undefined"!=typeof process,i=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="');return r.cssClass&&(i+=s(o(r.cssClass))),r.visible||(i+=" ws-hidden"),i+='" hasMarkup="true"> <div class="ws-progressbar" style="width:'+s(o(r.width))+"px; ","auto"!==r.width&&("center"===r.align?i+="margin:0 auto;":i+="float:"+s(o(r.align))+";"),i+="\"> <div class='ws-progressbar-left'></div> <div class='ws-progressbar-right'></div> <div class='ws-progressbar-border'> <div class='ws-progressbar-border-left'></div> <div class='ws-progressbar-border-right'></div> ",r.showPercent&&(i+=" <span class='ws-progressbar-progress-value'>"+s(o(rk("0%")))+"</span> "),i+=" <div class='ws-progressbar-indicator' style='width: 0'> <div class='ws-progressbar-indicator-left ws-hidden'></div> <div class='ws-progressbar-indicator-right ws-hidden'></div> </div> </div> </div> </div>",(i=s(i))+(t&&-1!==i.indexOf("{{")?String.fromCharCode(8203,8203):"")};return r.toJSON=function(){return{$serialized$:"func",module:"html!Deprecated/Controls/ProgressBar/ProgressBar"}},r}),define("html!SBIS3.CORE.ProgressBar",["require"],function(r){r("html!Deprecated/Controls/ProgressBar/ProgressBar")}),define("Deprecated/Controls/ProgressBar/ProgressBar",["Lib/Control/Control","html!Deprecated/Controls/ProgressBar/ProgressBar","css!Deprecated/Controls/ProgressBar/ProgressBar"],function(r,s){"use strict";return r.Control.extend({$protected:{_border:null,_progress:null,_progressValue:null,_options:{width:"auto",align:"center",showPercent:!0}},$constructor:function(){this._progress=this._container.find(".ws-progressbar-indicator"),this._border=this._container.find(".ws-progressbar-border"),this._progressValue=this._container.find(".ws-progressbar-progress-value")},setProgress:function(r){return(r=parseInt(r,10))<=100&&r>=0&&(this._progress.find(".ws-progressbar-indicator-left, .ws-progressbar-indicator-right").toggleClass("ws-hidden",0===r),this._progress.width(r+"%"),this._progressValue.text(r+"%"),!0)},_dotTplFn:s})});
//# sourceMappingURL=ProgressBar.xhtml.map
define("Deprecated/Controls/ProgressBar/ProgressBar",["Lib/Control/Control","html!Deprecated/Controls/ProgressBar/ProgressBar","css!Deprecated/Controls/ProgressBar/ProgressBar"],function(r,s){"use strict";return r.Control.extend({$protected:{_border:null,_progress:null,_progressValue:null,_options:{width:"auto",align:"center",showPercent:true}},$constructor:function(){this._progress=this._container.find(".ws-progressbar-indicator"),this._border=this._container.find(".ws-progressbar-border"),this._progressValue=this._container.find(".ws-progressbar-progress-value")},setProgress:function(r){if(r=parseInt(r,10),r<=100&&r>=0)return this._progress.find(".ws-progressbar-indicator-left, .ws-progressbar-indicator-right").toggleClass("ws-hidden",0===r),this._progress.width(r+"%"),this._progressValue.text(r+"%"),true;else return false},_dotTplFn:s})});
//# sourceMappingURL=ProgressBar.js.map
define("Deprecated/helpers/transport-helpers",["Core/detection","Core/core-functions","Core/IoC","Core/moduleStubs","Transport/prepareGetRPCInvocationURL","Core/i18n","Transport/RPCJSON"],function(e,r,t,n,a,o,c){var i={jsonRpcPreparePacket:c.jsonRpcPreparePacket,prepareSorting:function(e){if(!e||void 0===e["sorting"])return null;for(var r={s:[{n:"n",t:"Строка"},{n:"o",t:"Логическое"},{n:"l",t:"Логическое"}],d:[]},t=e["sorting"].length,n=0;n<t;++n)r.d.push([e["sorting"][n][0],e["sorting"][n][1],!e["sorting"][n][1]]);return r},prepareGetRPCInvocationURL:a,fetchFile:function(e,r,n,a){return t.resolve("ITransport",{method:"GET",dataType:"text",url:i.prepareGetRPCInvocationURL(e,r,n,null,a)}).execute()},newRecordSet:function(e,t,a,o,c,i,d,u){var l,s=false,p=null;return c=void 0===c?true:!!c,d=void 0===d?"":d,u=r.merge({otherUrl:i,dbScheme:"",linkedObject:e,queryName:t},!!u&&u.constructor===Object?u:{}),l=n.require("Deprecated/RecordSet").addCallback(function(e){return new e[0]({hierarchyField:d,firstRequest:false,filterParams:a,readerType:o||"ReaderUnifiedSBIS",readerParams:u})}).addCallback(function(e){var r;if(c&&!!t&&!s)p=e,r=e.reload().createDependent().addCallback(function(){return e});else r=e;return r}),l.createDependent().addErrback(function(e){var r;if(e.canceled)if(s=true,p)r=p,p=null,r.abort();return e})}};return i});
//# sourceMappingURL=transport-helpers.js.map
define("Deprecated/RecordTypes",[],function(){var E={};return E.FIELD_TYPE_QUERY="Выборка",E.FIELD_TYPE_RECORD="Запись",E.FIELD_TYPE_INTEGER="Число целое",E.FIELD_TYPE_STRING="Строка",E.FIELD_TYPE_TEXT="Строка",E.FIELD_TYPE_DOUBLE="Число вещественное",E.FIELD_TYPE_MONEY="Деньги",E.FIELD_TYPE_DATE="Дата",E.FIELD_TYPE_DATETIME="Дата и время",E.FIELD_TYPE_TIME="Время",E.FIELD_TYPE_ARRAY="Массив",E.FIELD_TYPE_BOOLEAN="Логическое",E.FIELD_TYPE_HIERARCHY="Иерархия",E.FIELD_TYPE_IDENTITY="Идентификатор",E.FIELD_TYPE_ENUM="Перечисляемое",E.FIELD_TYPE_FLAGS="Флаги",E.FIELD_TYPE_LINK="Связь",E.FIELD_TYPE_BINARY="Двоичное",E.FIELD_TYPE_UUID="UUID",E.FIELD_TYPE_RPCFILE="Файл-rpc",E.FIELD_TYPE_TIME_INTERVAL="Временной интервал",E});
//# sourceMappingURL=RecordTypes.js.map
define("Deprecated/SerializatorSBIS",["Deprecated/Enum","Deprecated/RecordTypes","Core/core-instance","Core/helpers/Object/sortedPairs","Deprecated/helpers/string-helpers"],function(e,s,t,a,r){var l;return l={serialize:function(e,s){var a;if(t.instanceOfModule(e,"Deprecated/RecordSet")||t.instanceOfModule(e,"Deprecated/Record"))a=e.toJSON(s);else throw new TypeError(rk("Попытка сериализации неподдерживаемого типа"));return a},serializeData:function(s,r){var n={d:[],s:[]},i,E;r=this.serializeCols(r),n.s=r;for(var u=0,c=r.length;u<c;u++){if(E=r[u],i="object"==typeof E.t?E.t.n:E.t,"Перечисляемое"==i){if(s[u]instanceof e)n.s[u].t.s=s[u].getValues()}else if("Флаги"==i)if(!t.instanceOfModule(s[u],"Deprecated/Record"))s[u]=null;if(t.instanceOfModule(s[u],"Deprecated/Record")||t.instanceOfModule(s[u],"Deprecated/RecordSet"))if("Флаги"===i){for(var p=[],_={},f=s[u].getColumns(),I=0,o=f.length;I<o;I++)_[s[u].getColumnIdx(f[I])]=f[I];var d=a(_),D=s[u].toObject();_={};for(var T=0,h=d.keys.length;T<h;T++)_[d.keys[T]]=d.values[T],p.push(D[d.values[T]]);n.d.push(p),n.s[u].t.s=_}else n.d.push(this.serialize(s[u]));else if(E.s&&"Иерархия"==E.s)if(!(E.n.substr(E.n.length-1,1)in{"@":true,$:true}))n.d.push(l.serializeHierarchyIdentity(s[u]));else n.d.push(s[u]);else if("Связь"==i)n.d.push(null===s[u]||"null"==s[u]?null:parseInt(s[u],10));else if("Массив"==i)if(s&&(s[u]instanceof Array||null===s[u]))n.d.push(s[u]);else n.d.push([]);else if(s[u]instanceof Date)if("Дата"==i)n.d.push(s[u].toSQL());else if("Дата и время"==i)n.d.push(s[u].toSQL(true));else n.d.push(s[u].toSQL(false));else if(s[u]instanceof e){var L=s[u].getCurrentValue();n.d.push(null===L?null:parseInt(L,10))}else if("Идентификатор"==i)n.d.push(l.serializeHierarchyIdentity(s[u]));else if("Число целое"==i)n.d.push("number"==typeof s[u]?s[u]:isNaN(parseInt(s[u],10))?null:parseInt(s[u],10));else n.d.push(void 0!==s[u]?s[u]:null)}return n},serializeCols:function(e){var t=[];for(var a in e)if(e.hasOwnProperty(a)){var r=e[a],l=r.type;if(r.s&&r.s==s.FIELD_TYPE_HIERARCHY)t.push({n:r.title,t:r.type,s:r.s});else if(l==s.FIELD_TYPE_ENUM||"Флаг"==l)t.push({n:r.title,t:{n:l,s:r.s}});else if(l==s.FIELD_TYPE_ARRAY||l==s.FIELD_TYPE_LINK)t.push({n:r.title,t:{n:l,t:l==s.FIELD_TYPE_LINK?r.table:r.arrayType}});else if(l==s.FIELD_TYPE_FLAGS)t.push({n:r.title,t:{n:l,s:r.s}});else if(l==s.FIELD_TYPE_MONEY&&r.p)t.push({n:r.title,t:{n:l,p:r.p}});else t.push({n:r.title,t:l})}return t},serializeHierarchyIdentity:function(e){var s;if(null===e)s=[null];else if(e instanceof Array){if("string"==typeof e[0]){var t=parseInt(e[0],10);if(!isNaN(t)){var a=e.slice();return a[0]=t,a}else return e}return e}else if("string"==typeof e){var l=r.parseComplexKey(e);if(e=[parseInt(l.objKey,10)],l.objName)e.push(l.objName);s=e}else s=[e];return s},getColumnConfigByType:function(e,t,a){var r={cols:[],data:[]},l;switch(t){case s.FIELD_TYPE_QUERY:case s.FIELD_TYPE_RECORD:case s.FIELD_TYPE_INTEGER:case s.FIELD_TYPE_STRING:case s.FIELD_TYPE_TEXT:case s.FIELD_TYPE_DOUBLE:case s.FIELD_TYPE_MONEY:case s.FIELD_TYPE_DATE:case s.FIELD_TYPE_DATETIME:case s.FIELD_TYPE_TIME:case s.FIELD_TYPE_BOOLEAN:case s.FIELD_TYPE_IDENTITY:case s.FIELD_TYPE_BINARY:case s.FIELD_TYPE_UUID:case s.FIELD_TYPE_RPCFILE:case s.FIELD_TYPE_TIME_INTERVAL:r.cols.push({t:t,n:e});break;case s.FIELD_TYPE_LINK:case s.FIELD_TYPE_ARRAY:if(a)l={n:t,t:a},r.cols.push({t:l,n:e});else return false;break;case s.FIELD_TYPE_ENUM:case s.FIELD_TYPE_FLAGS:if(a)l={n:t,s:a},r.cols.push({t:l,n:e});else return false;break;case s.FIELD_TYPE_HIERARCHY:r.cols.push({s:"Иерархия",t:"Идентификатор",n:e}),r.cols.push({s:"Иерархия",t:"Логическое",n:e+"@"}),r.cols.push({s:"Иерархия",t:"Логическое",n:e+"$"});break;default:return false}switch(t){case s.FIELD_TYPE_QUERY:case s.FIELD_TYPE_RECORD:r.data.push({s:[],d:[]});break;case s.FIELD_TYPE_IDENTITY:r.data.push([null]);break;case s.FIELD_TYPE_ARRAY:case s.FIELD_TYPE_FLAGS:if(a)r.data.push([]);else return false;break;case s.FIELD_TYPE_HIERARCHY:r.data.push([null]),r.data.push(false),r.data.push(false);break;default:r.data.push(null)}return r}},l});
//# sourceMappingURL=SerializatorSBIS.js.map
define("Deprecated/ReaderAbstract",["require","Core/Abstract","Core/IoC"],function(e,r,t){var o;return o=r.extend({$protected:{_parser:null,_options:{parserType:"ParserAbstract",adapterType:"",adapterParams:{}},_nullable:{format:void 0},_adapter:""},$constructor:function(){var e=this._options.adapterType;if(this._publish("onNewRecord","onParseData","onSettingsParsed","onComplete","onWayExists","onResults","onNextPageChange"),""===e)throw new Error("Adapter type is not specified")},getParser:function(){if(!this._parser){var r=e.defined("Deprecated/"+this._options.parserType)?e("Deprecated/"+this._options.parserType):null;if(r)this._parser=new r(this._getParserCfg());else throw new Error("Parser type is not specified")}return this._parser},_getParserCfg:function(){for(var e=this,r={},t=["onNewRecord","onParseData","onSettingsParsed","onComplete","onWayExists","onResults"],o=0,a=t.length;o<a;o++)r[t[o]]=function(r){arguments[0]=r._eventName,e._notify.apply(e,arguments)};return{handlers:r}},getAdapter:function(r,t){if(""===this._adapter){var o=e.defined("Deprecated/"+this._options.adapterType)?e("Deprecated/"+this._options.adapterType):e.defined(this._options.adapterType)?e(this._options.adapterType):null;if(o)this._adapter=new o(this._options.adapterParams);else throw new Error("Adapter type is not specified")}return this._adapter},readRecords:function(e,r){var t=this;return this.getAdapter().list(this._makeArgsForQuery(e)).addCallbacks(function(e){if(e)return t._notify("onNextPageChange",e.n),t._onLoaderDone(e,r),e;else{var o=new Error("Reader error : data is null");return t._notify("onComplete",false,o),o}},function(e){return t._notify("onComplete",false,e),e})},createRecord:function(e,r){var t=this.getParser();return this.getAdapter().create(this._makeArgsForCreate(e,void 0===r?this._options.format:r)).addCallback(t.readRecord.bind(t))},readRecord:function(e,r,t){var o=this.getParser();return this.getAdapter("read",arguments).read(this._makeArgsForRead(e,void 0===r?this._options.format:r,t)).addCallback(o.readRecord.bind(o))},copyRecord:function(e,r){var t=this.getParser();return this.getAdapter("copy",arguments).copy(this._makeArgsForCopy(e,void 0===r?this._options.format:r)).addCallback(t.readRecord.bind(t))},deleteRecord:function(e){return this.getAdapter("destroy",arguments).destroy(this._makeArgsForDestroy(e))},mergeRecords:function(e,r){return this.getAdapter("merge",arguments).merge(this._makeArgsForMergeRecords(e,r))},updateRecord:function(e,r){return this.getAdapter("update",arguments).update(this._makeArgsForUpdate(e,r))},deleteRecordsByFilter:function(e,r){return this.getAdapter("destroyByFilter",arguments).destroyByFilter(this._makeArgsForDestroyByFilter(e,r))},_onLoaderDone:function(e,r){var o=false,a;try{this.getParser().parseData(e,r),o=true}catch(e){a=e.message,t.resolve("ILogger").error("Reader","Parser ("+this._options.parserType+") parseData ends with error: "+a,e)}this._notify("onComplete",o,a,e.e)},parseData:function(e,r){if(this._notify("onParseData",e),this._columnsParser(e),e.p)this._notify("onWayExists",e.p);if(e.r)this._notify("onResults",this.readRecord(e.r));this._dataParser(e)},_columnsParser:function(e){var r=this._columnsParseFnc(e);this._notify("onSettingsParsed",this._transformColumns(r.settings),r.pk)},_columnsParseFnc:function(e){throw new Error("Method AbstractReader::_columnsParseFnc must be implemented")},_dataParser:function(e){throw new Error("Method AbstractReader::_dataParser must be implemented")},_makeArgsForQuery:function(e){return e},_makeArgsForCreate:function(e,r){throw new Error("Method AbstractReader::_makeArgsForCreate must be implemented")},_makeArgsForDestroyByFilter:function(e,r){throw new Error("Method AbstractReader::_makeArgsForDestroyByFilter must be implemented")},_makeArgsForMergeRecords:function(e,r){throw new Error("Method AbstractReader::_makeArgsForMergeRecords must be implemented")},_makeArgsForCopy:function(e,r){throw new Error("Method AbstractReader::_makeArgsForCopy must be implemented")},_makeArgsForDestroy:function(e){throw new Error("Method AbstractReader::_makeArgsForDestroy must be implemented")},_makeArgsForUpdate:function(e,r){throw new Error("Method AbstractReader::_makeArgsForUpdate must be implemented")},_makeArgsForRead:function(e,r,t){throw new Error("Method AbstractReader::_makeArgsForRead must be implemented")},abort:function(){this.getAdapter().abort()}}),o});
//# sourceMappingURL=ReaderAbstract.js.map
define("Deprecated/ReaderSBIS",["Deprecated/ReaderAbstract","Deprecated/RecordTypes","Deprecated/SerializatorSBIS","Deprecated/Enum","Deprecated/helpers/string-helpers","Deprecated/helpers/transport-helpers"],function(e,r,t,n,i,a){var s;return s=e.extend({$protected:{_pkColumnName:"pk",_options:{parserType:"ParserSBIS",linkedObject:"",pkName:"id"}},$constructor:function(){this._publish("onNewData"),this.getParser().subscribe("onDataParsed",this._onDataParsed.bind(this))},_extractPlainKey:function(e){var r=i.parseComplexKey(e).objKey,t=Number(r);return isNaN(t)?e:t},_extractObjectName:function(e){return i.parseComplexKey(e).objName},prepareFilter:function(e){var r={d:[],s:[]};if(e&&e instanceof Object)for(var t=Object.keys(e).sort(),n,i=0;i<t.length;++i){if(n=t[i],"pageNum"==n||"pageCount"==n||"usePages"==n||"sorting"==n)continue;if(e.hasOwnProperty(n)&&void 0!==e[n]){var a=s.serializeParameter(n,e[n]);if(e[n]instanceof Object&&e[n].hasOwnProperty("hierarchy"))r.d=r.d.concat(a.d),r.s=r.s.concat(a.s);else r.d.push(a.d),r.s.push({n:n,t:a.s})}}return r},_prepareSorting:function(e){return a.prepareSorting(e)},_prepareNavigation:function(e){if(!e||void 0===e["pageNum"]||void 0===e["pageCount"]||!e["usePages"])return null;var r=null===e["pageCount"]?0:e["pageCount"];return{s:[{n:"Страница",t:"Число целое"},{n:"РазмерСтраницы",t:"Число целое"},{n:"ЕстьЕще",t:"Логическое"}],d:[e["pageNum"],r,"parts"==e["usePages"]||"auto"==e["usePages"]]}},_makeArgsForQuery:function(e){return{"ДопПоля":[],"Фильтр":this.prepareFilter(e),"Сортировка":this._prepareSorting(e),"Навигация":this._prepareNavigation(e)}},_makeArgsForCreate:function(e,r){if(void 0===r)if(r=this._options.queryName||"null","null"!=r)r=this._options.dbScheme+this._options.linkedObject+"."+r;return{"Фильтр":this.prepareFilter(e),"ИмяМетода":r}},_makeArgsForUpdate:function(e,r){var n={"Запись":t.serialize(e,r)};if(r&&("boolean"==typeof r||r.consistencyCheck))n["Проверка"]=true;return n},_makeArgsForRead:function(e,r,t){if(void 0===r)if(r=this._options.queryNameForRead||this._options.queryName||"null","null"!=r&&"БазовоеРасширение"!=r)r=this._options.dbScheme+this._options.linkedObject+"."+r;var n={"ИдО":this._extractPlainKey(e),"ИмяМетода":r};if(t)n["Связь"]=t;return n},_makeArgsForMergeRecords:function(e,r){return{"ИдО":this._extractPlainKey(e),"ИдОУд":this._preparePlainKeys(r)}},_makeArgsForCopy:function(e,r){return{"ИдО":this._extractPlainKey(e),"ИмяМетода":r}},_makeArgsForDestroy:function(e){return{"ИдО":this._preparePlainKeys(e)}},_makeArgsForDestroyByFilter:function(e,r){if(void 0===r)r=this._options.dbScheme+this._options.linkedObject+"."+this._options.queryName;return{"ИмяМетода":r,"Фильтр":this.prepareFilter(e)}},_preparePlainKeys:function(e){if(e instanceof Array){for(var r=[],t=0,n=e.length;t<n;t++)r.push(this._extractPlainKey(e[t]));return r}else return this._extractPlainKey(e)},deleteRecord:function(e){return s.superclass.deleteRecord.apply(this,arguments).addCallback(function(e){if(true!==e)return new Error("Запись не удалена");else return e})},_onDataParsed:function(e,r){this._notify("onNewData",r)}}),s.serializeParameter=function(e,i){var a,o={d:null,s:null};if(i instanceof Array)a=(a=(i=i.map(function(e){return"null"===e||void 0===e||null===e?null:e})).reduce(function(e,t){if(null!==t){var n=r.FIELD_TYPE_STRING;if(e){if(e!=n)e=r.FIELD_TYPE_STRING}else e=n}return e},false))||r.FIELD_TYPE_STRING,i=i.map(function(e){if(null!==e)if(e instanceof Date)return e.toSQL(Date.SQL_SERIALIZE_MODE_AUTO);else return""+e;return e}),o.s={n:"Массив",t:a},o.d=i;else if(i instanceof Date)o.d=i.toSQL(null),o.s="Строка";else if(i instanceof n)o.d=i.getCurrentValue()+"",o.s="Строка";else if(i instanceof Object&&void 0!==i.hierarchy)o.d=[t.serializeHierarchyIdentity(i.hierarchy[0]),i.hierarchy[1],null],o.s=[{n:e,t:"Идентификатор",s:"Иерархия"},{n:e+"@",t:"Логическое",s:"Иерархия"},{n:e+"$",t:"Логическое",s:"Иерархия"}];else if(i instanceof Object){var u;o.d={d:[],s:[]},o.s="Запись";for(var l in i)if(i.hasOwnProperty(l))u=s.serializeParameter(l,i[l]),o.d.d.push(u.d),o.d.s.push({n:l,t:u.s})}else if("boolean"==typeof i)o.d=i,o.s="Логическое";else o.d=null===i?null:""+i,o.s="Строка";return o},s});
//# sourceMappingURL=ReaderSBIS.js.map
define("Core/helpers/getStackTrace",function(){return function(r){var e=function(){var r={};return Error.captureStackTrace(r,e),r.stack},t=function(r){for(var e=[],n=Array.prototype.slice,c=0;c<r.length;++c){var o=r[c];if(void 0===o)e[c]="undefined";else if(null===o)e[c]="null";else if(o.constructor)if(o.constructor===Array)if(o.length<3)e[c]="["+t(o)+"]";else e[c]="["+t(n.call(o,0,1))+"..."+t(n.call(o,-1))+"]";else if(o.constructor===Object)e[c]="#object";else if(o.constructor===Function)e[c]="#function";else if(o.constructor===String)e[c]='"'+o+'"';else if(o.constructor===Number)e[c]=o}return e.join(",")},n=function(r){var e="{anonymous}",n=/function\s*([\w\-$]+)?\s*\(/i,c=[],o,l,i=40;while(r&&r["arguments"]&&c.length<i)o=n.test(r.toString())?RegExp.$1||e:e,l=Array.prototype.slice.call(r["arguments"]||[]),c[c.length]=o+"("+t(l)+")",r=r.caller;return c.join("\r\n")},c;if(r&&r.stack)c=r.stack;else if(Error&&Error.captureStackTrace)c=e();else if(c=Error().stack)return c;else try{c=n(arguments.callee)}catch(r){c=""}return c}});
//# sourceMappingURL=getStackTrace.js.map
define("Core/helpers/Hcontrol/saveToFile",["Core/constants","Core/cookie","Transport/RPCJSON","Core/Deferred","Transport/prepareGetRPCInvocationURL"],function(e,r,a,n,o){return function(l,t,i,s,d){var f=new n;if(f.addErrback(function(e){return e}),l&&t&&i){if(!i["fileDownloadToken"])i["fileDownloadToken"]=Math.floor(1e16*Math.random());if(d)window.open(o(l,t,i)),f.callback();else{var p=$("body"),c="fileDownloadToken_"+i["fileDownloadToken"],m,u,w=$(".ws-upload-form"),h=$(".ws-upload-iframe");if(!w.length&&!h.length)p.append(w=$('<form enctype="multipart/form-data" target="ws-upload-iframe" '+'action="'+(s?s:e.defaultServiceUrl)+'?raw_file_result" method="POST" class="ws-upload-form ws-hidden">'+'<input type="hidden" name="Запрос"></form>')),p.append(h=$('<iframe class="ws-upload-iframe ws-hidden" name="ws-upload-iframe"></iframe>'));w.find("[name=Запрос]").val(a.jsonRpcPreparePacket(l+"."+t,i,parseInt((""+Math.random()).substr(2),10)).reqBody),w.submit(),m=setInterval(function(){var e=h.contents().find("pre");if(u=r.get(c),parseInt(u,10)===i["fileDownloadToken"])if(clearInterval(m),r.set(c,null),e.length)f.errback(new Error(JSON.parse(e.html()).error.details)),e.remove("pre");else f.callback();else if(e.length){var a=JSON.parse(e.html());if(a.error)clearInterval(m),r.set(c,null),f.errback(new Error(a.error.details)),e.remove("pre")}},1e3)}}else f.errback();return f}});
//# sourceMappingURL=saveToFile.js.map
define("Core/helpers/unrelated-helpers",["Core/constants","Core/core-merge","Core/Deferred","Core/ParallelDeferred","Deprecated/core-attach","Core/Context","Core/pathResolver","Core/core-instance","Core/helpers/fast-control-helpers","Deprecated/ReaderSBIS","Core/helpers/Hcontrol/saveToFile","Core/helpers/getStackTrace"],function(e,r,n,t,o,a,i,c,s,l,u,f){var d={saveToFile:u,prepareFilter:function(e){var r={d:[],s:[]};if(e&&e instanceof Object)for(var n=Object.keys(e).sort(),t,o=0;o<n.length;++o){if(t=n[o],"pageNum"==t||"pageCount"==t||"usePages"==t||"sorting"==t)continue;if(e.hasOwnProperty(t)&&void 0!==e[t]){var a=l.serializeParameter(t,e[t]);if(e[t]instanceof Object&&e[t].hasOwnProperty("hierarchy"))r.d=r.d.concat(a.d),r.s=r.s.concat(a.s);else r.d.push(a.d),r.s.push({n:t,t:a.s})}}return r},resolveComponentPath:i.resolveComponentPath,_showSelector:function(e,i,c,l){var u=new n,f=new n,p=a.createContext(f,null,c),h=false;return u.addErrback(function(e){return e}),o.attachInstance(l,r({linkedContext:p,handlers:{onChange:function(e,r){var o=this;if(r&&r[0]){var a=new t({stopOnFirstError:false});if(r.forEach(function(){var e=i.apply(o,arguments),r=e instanceof n;if(h|=r,r)a.push(e)}),h)s.toggleIndicator(true);this.close(a.done().getResult())}},onAfterClose:function(e,r){if(r&&r instanceof n)u.dependOn(r);else u.callback(r)},onDestroy:function(){f.callback()}}},e)).addErrback(function(e){return u.errback(e),e}),u.addBoth(function(e){if(h)d.toggleIndicator(false);return e}),u},jQueryToString:function(e){for(var r=[],n=0,t=e.length;n<t;n++)r.push(e.get(n).outerHTML);return r.join("")},parseIdentity:function(r){if(r instanceof Array){if(1===r.length&&null===r[0])return null;return r.join(e.IDENTITY_SPLITTER)}else return r},checkMimeSupport:function(e){if(navigator.mimeTypes)return!!navigator.mimeTypes[e];else return true},getImageBlock:function(e){var r=document.createElement("div");if(!(-1!==e.indexOf("sprite:")))$(r).append('<img src="'+e+'" />');else $(r).addClass(e.replace("sprite:",""));return r},getStackTrace:f,instanceOfModule:c.instanceOfModule,instanceOfMixin:c.instanceOfMixin,detectCommonDataContainer:function(e){return e&&e.s&&e.d&&("record"==e._type||"recordset"==e._type)},axo:function(){var e="A"+["ctiv"].concat("bject").join("eXO"),r=function(){return this||(0,eval)("this")}()[e];if(r)return function e(n){return new r(n)}}()};return d});
//# sourceMappingURL=unrelated-helpers.js.map
define("tmpl!Deprecated/Controls/LoadingIndicator/LoadingIndicator",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),i=e[0],t={},s=function e(s,n,o,r,a){function d(){}var c=0,l=void 0!==i&&i?i:arguments[arguments.length-1];void 0===l&&(eval("var thelpers = null;"),l=global.requirejs("View/Runner/tclosure"));var h={};a&&a.isSetts&&(h=a.fullContext||{});var g="string"==typeof o?o:"",_=void 0===t?void 0:t,p={id:[],def:void 0},w=l.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),u=this&&this.includedTemplates?this.includedTemplates:{},y=l.getMarkupGenerator(r);try{var m=y.joinElements([void(u.loadingIndicator=function(e,i){this&&this.includedTemplates&&this.includedTemplates;var t=l.getMarkupGenerator(r);try{var s=t.joinElements([l.getter(e,["progressBar"])?[t.createTag("span",{class:"ws-LoadingIndicator__message ws-LoadingIndicator__message__progress-yes"},[t.createText(""+l.wrapUndef(l.utils.escape(l.getter(e,["message"]))))],{},p,this),t.createTag("div",{class:"ws-progressbar-container"},[],{},p,this)]:[t.createTag("div",{class:"ws-loading"},[t.createTag("span",{class:"ws-LoadingIndicator__loadingContainer"},[t.createTag("span",{class:"ws-LoadingIndicator__message ws-LoadingIndicator__message__progress-no"},[t.createText(""+l.wrapUndef(l.utils.escape(l.getter(e,["message"]))))],{},p,this),t.createTag("div",{class:"ws-loadingimg"},[l.getter(e,["isShowLoadingPicture"])?[t.createTag("div",{},[t.createTag("img",{src:""+l.wrapUndef(l.utils.escape(l.getter(e,["loadingPicture"])))},[],{},p,this)],{},p,this)]:t.createText("")],{},p,this)],{},p,this)],{},p,this)]],g,p);p.def&&(s=t.chain(s,p,i),p=void 0)}catch(i){l.templateError("resources/WS.Deprecated/Controls/LoadingIndicator/LoadingIndicator.tmpl",i,e)}return s||""}.bind({includedTemplates:u})),l.getter(s,["showInWindow"])?[y.createTag("div",{},[function(e,i){l.prepareAttrsForFocus(i,e,"0");this&&this.includedTemplates&&this.includedTemplates;var t=l.getMarkupGenerator(r);try{var s=t.joinElements([l.getter(e,["progressBar"])?[t.createTag("span",{class:"ws-LoadingIndicator__message ws-LoadingIndicator__message__progress-yes"},[t.createText(""+l.wrapUndef(l.utils.escape(l.getter(e,["message"]))))],{},p,this),t.createTag("div",{class:"ws-progressbar-container"},[],{},p,this)]:[t.createTag("div",{class:"ws-loading"},[t.createTag("span",{class:"ws-LoadingIndicator__loadingContainer"},[t.createTag("span",{class:"ws-LoadingIndicator__message ws-LoadingIndicator__message__progress-no"},[t.createText(""+l.wrapUndef(l.utils.escape(l.getter(e,["message"]))))],{},p,this),t.createTag("div",{class:"ws-loadingimg"},[l.getter(e,["isShowLoadingPicture"])?[t.createTag("div",{},[t.createTag("img",{src:""+l.wrapUndef(l.utils.escape(l.getter(e,["loadingPicture"])))},[],{},p,this)],{},p,this)]:t.createText("")],{},p,this)],{},p,this)],{},p,this)]],g,p);p.def&&(s=t.chain(s,p,i),p=void 0)}catch(i){l.templateError("resources/WS.Deprecated/Controls/LoadingIndicator/LoadingIndicator.tmpl",i,e)}return s||""}(l.calculateScope({progressBar:l.getter(s,["progressBar"]),message:l.getter(s,["message"]),isShowLoadingPicture:l.getter(s,["isShowLoadingPicture"]),loadingPicture:l.getter(s,["loadingPicture"])},l.plainMerge),{})],{},p,this)]:[function(e,i){l.prepareAttrsForFocus(i,e,"0");this&&this.includedTemplates&&this.includedTemplates;var t=l.getMarkupGenerator(r);try{var s=t.joinElements([l.getter(e,["progressBar"])?[t.createTag("span",{class:"ws-LoadingIndicator__message ws-LoadingIndicator__message__progress-yes"},[t.createText(""+l.wrapUndef(l.utils.escape(l.getter(e,["message"]))))],{},p,this),t.createTag("div",{class:"ws-progressbar-container"},[],{},p,this)]:[t.createTag("div",{class:"ws-loading"},[t.createTag("span",{class:"ws-LoadingIndicator__loadingContainer"},[t.createTag("span",{class:"ws-LoadingIndicator__message ws-LoadingIndicator__message__progress-no"},[t.createText(""+l.wrapUndef(l.utils.escape(l.getter(e,["message"]))))],{},p,this),t.createTag("div",{class:"ws-loadingimg"},[l.getter(e,["isShowLoadingPicture"])?[t.createTag("div",{},[t.createTag("img",{src:""+l.wrapUndef(l.utils.escape(l.getter(e,["loadingPicture"])))},[],{},p,this)],{},p,this)]:t.createText("")],{},p,this)],{},p,this)],{},p,this)]],g,p);p.def&&(s=t.chain(s,p,i),p=void 0)}catch(i){l.templateError("resources/WS.Deprecated/Controls/LoadingIndicator/LoadingIndicator.tmpl",i,e)}return s||""}(l.calculateScope({progressBar:l.getter(s,["progressBar"]),message:l.getter(s,["message"]),isShowLoadingPicture:l.getter(s,["isShowLoadingPicture"]),loadingPicture:l.getter(s,["loadingPicture"])},l.plainMerge),{})]],g,p);p.def&&(m=y.chain(m,p,n),p=void 0)}catch(e){l.templateError("resources/WS.Deprecated/Controls/LoadingIndicator/LoadingIndicator.tmpl",e,s)}return m||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!Deprecated/Controls/LoadingIndicator/LoadingIndicator"}},s}),define("tmpl!SBIS3.CORE.LoadingIndicator",["require"],function(e){e("tmpl!Deprecated/Controls/LoadingIndicator/LoadingIndicator")}),define("Deprecated/Controls/LoadingIndicator/LoadingIndicator",["Core/WindowManager","Lib/Control/Control","tmpl!Deprecated/Controls/LoadingIndicator/LoadingIndicator","Lib/Control/Window/Window","Deprecated/Controls/ProgressBar/ProgressBar","Deprecated/Controls/ModalOverlay/ModalOverlay","Core/helpers/vital/processImagePath","Core/helpers/string-helpers","Core/constants","Core/helpers/unrelated-helpers","Core/Deferred","css!Deprecated/Controls/LoadingIndicator/LoadingIndicator","i18n!Deprecated/Controls/LoadingIndicator/LoadingIndicator"],function(e,i,t,s,n,o,r,a,d,c,l){"use strict";function h(i){for(var t=!1,s=e.getStack(),n=s.length-1;n>=0;n--){var o=s[n];if(o.window._isIndicator){if(o.window===i)return!t;o.visible()&&(t=!0)}}return!0}function g(e,i){return function(){if(!this[e]){this[e]=!0;try{return i.apply(this,arguments)}finally{this[e]=!1}}}}var _=s.extend({$protected:{_isIndicator:!0,_isIndicatorVisible:!0,_options:{resizable:!1,border:!1,autoHeight:!0,autoWidth:!0},_keysWeHandle:[]},$constructor:function(){this.unsubscribeFrom(o,"onClick"),this._window.addClass("ws-LoadingIndicator__window")},_moveFocusToSelf:function(){},onBringToFront:function(){},activate:function(){},_restoreLastActiveOnHide:function(){},isMovableToTop:function(){for(var i=!0,t=e.getStack(),s=t.length-1;s>=0;s--){var n=t[s];if(n.window._isIndicator){if(n.window===this)return i;i=!n.visible()&&null}}return!0}}),p=function(e){var i=d.$body;this._options.showInWindow?e?(o.getState()||i.addClass("ws-LoadingIndicator-overlay-hidden"),i.addClass("ws-LoadingIndicator-hidden")):i.removeClass("ws-LoadingIndicator-hidden ws-LoadingIndicator-overlay-hidden"):this._loadingIndicator.toggleClass("ws-LoadingIndicator-hidden",e)},w=i.Control.extend({$protected:{_loadingPic:"",_loadingIndicator:"",_loadingContainer:"",_loadingText:"",_picture:"",_myWindow:null,_myProgressBar:null,_progressBarContainer:"",_windowHeight:void 0,_windowWidth:void 0,_isVisible:!1,_delay:null,_options:{message:rk("Загрузка"),loadingPicture:r("ws:/ajax-loader-indicator.v1516270649826335cf4508dd597be4bfc9caa3e08b901.gif"),isShowLoadingPicture:!0,showInWindow:!0,height:57,width:"100%",modal:!0,progressBar:!1,showPercent:!0,delay:!1}},$constructor:function(){this._redraw()},getParent:function(){return this._parent},isVisible:function(){return this._isVisible},_setWindowVisibleProperty:function(e){var i=this.getWindow();i&&(i._isIndicatorVisible=e)},_showDelay:function(){var i=this;this._delay&&!this._delay.isReady()||!this._options.delay||(p.call(this,!0),e._delayedIndicator=this,this._getDelay().addCallback(function(t){return p.call(i,!1),e._delayedIndicator=null,i._overlayZIndex&&o.getState()&&(o._setZIndex(i._overlayZIndex),i._overlayZIndex=null),t}))},_clearDelay:function(){this._delay&&(e._delayedIndicator===this&&p.call(this,!1),this._overlayZIndex=null,this._delay.cancel(),this._delay=null,this._overlayZIndex=null)},_getDelay:function(){return!this._delay||this._delay.isReady()?this._delay=l.fromTimer(2e3):this._delay},setDelay:function(e){this._options.delay=Boolean(e)},show:function(){if(!this._isVisible){if(this._showDelay(),this._options.showInWindow){var i;o.getState()&&this._options.delay&&!e.getCurrentVisibleIndicator()&&(i=o.getZIndex()),this._myWindow._isShow=!1,this._myWindow.show(),this._myWindow.moveWindowToCenter(),i&&(this._overlayZIndex=o.getZIndex(),o._setZIndex(i))}else this._loadingIndicator.show();this._isVisible=!0}},hide:function(){this._isVisible&&(this._clearDelay(),this._options.showInWindow?this._myWindow.hide():this._loadingIndicator.hide(),e.getCurrentVisibleIndicator()===this&&e.setCurrentVisibleIndicator(null),this._isVisible=!1)},setMessage:function(e){this._loadingText&&(this._loadingText.html(a.escapeTagsFromStr(e,["script"])),this._isVisible&&this._myWindow&&this._recalcWindowSize(this._myWindow._window))},_recalcWindowSize:function(e){var i=this,t=function(){i._windowHeight=e.height()||i._windowHeight,i._windowWidth=e.width()||i._windowWidth};/none/.test(e.css("display"))?(e.css({display:"block",visibility:"hidden"}),t(),e.css({display:"none",visibility:"visible"})):(t(),this._myWindow.moveWindowToCenter())},close:function(){this.destroy()},setImg:function(e){$(this._picture).removeClass().empty(),$(this._picture).append(c.getImageBlock(e))},_redraw:function(){if(this._myWindow&&this._myWindow.close(),this._container&&(this._progressBarContainer||this._loadingIndicator)&&this._container.html(""),this._options.showInWindow){this._container=$(t(this._options)),this._renderInd();var e=this;this._showDelay(),this._myWindow=new _({modal:this._options.modal,animatedWindows:!1,handlers:{onDestroy:function(){e._myWindow=null},onReady:function(){this._myIndicator=e,this.getContainer().append('<div class="ws-win-loadingIndicator"></div>'),this.getContainer().find(".ws-win-loadingIndicator").append(e._container),e._windowHeight=this._window.height(),e._windowWidth=this._window.width()}}})}else this._container.append($(t(this._options))),this._renderInd(),this._showDelay()},_renderInd:function(){if(this._loadingText=this._container.find(".ws-LoadingIndicator__message"),this._options.progressBar){this._progressBarContainer=this._container.find(".ws-progressbar-container");var e=this;this._myProgressBar=new n({element:e._progressBarContainer,width:289,showPercent:e._options.showPercent})}else{if("string"==typeof this._options.width){var i=this._options.width;"%"!=i[i.length-1]&&(this._options.width=parseInt(this._options.width,10)+"px")}else this._options.width=this._options.width+"px";this._loadingIndicator=this._container.find(".ws-loading"),this._loadingContainer=this._loadingIndicator.find(".ws-LoadingIndicator__loadingContainer"),this._loadingIndicator.css({"text-align":"center",height:this._options.height,width:this._options.showInWindow?"100%":void 0})}this._notify("onReady")},getWindow:function(){return this._myWindow},setProgress:function(e){return(e=parseInt(e,10))>=0&&e<=100&&null!==this._myProgressBar&&(this._myProgressBar.setProgress(e),!0)},destroy:function(){this._clearDelay(),this.hide(),w.superclass.destroy.apply(this,arguments),this._myWindow&&this._myWindow.destroy(),this._myProgressBar&&this._myProgressBar.destroy()}}),u=w.extend({$protected:{_showing:!1,_hiding:!1,_preventKeyDown:null,_keyboardLocked:!1},$constructor:function(){this._preventKeyDown=function(i){var t=this._options.showInWindow?this._myWindow.getZIndex():0;116!==i.keyCode&&123!==i.keyCode&&t>=e.getMaxZIndex()&&(i.preventDefault?(i.preventDefault(),i.stopPropagation()):i.returnValue=!1)}.bind(this)},_toggleKeyboardLocked:function(e){this._keyboardLocked!==e&&(this._keyboardLocked=e,e?document.addEventListener?document.addEventListener("keydown",this._preventKeyDown,!0):document.attachEvent("onkeydown",this._preventKeyDown):document.removeEventListener?document.removeEventListener("keydown",this._preventKeyDown,!0):document.detachEvent("onkeydown",this._preventKeyDown))},_initComplete:function(){u.superclass._initComplete.apply(this,arguments),this.show()},hide:g("_hiding",function(){this._options.showInWindow?(this._setWindowVisibleProperty(!1),this==e.getCurrentVisibleIndicator()&&u.superclass.hide.apply(this,arguments)):u.superclass.hide.apply(this,arguments),this._toggleKeyboardLocked(!1)}),show:g("_showing",function(){if(this._options.showInWindow)if(this._setWindowVisibleProperty(!0),h(this._myWindow)){e._pendingIndicator=this;var i=e.getCurrentVisibleIndicator();i&&this!==i&&u.superclass.hide.apply(i,arguments),u.superclass.show.apply(this,arguments),e.setCurrentVisibleIndicator(this),e._pendingIndicator=null}else e.pushUp(this._myWindow);else u.superclass.show.apply(this,arguments);this._toggleKeyboardLocked(!0)}),destroy:function(){this._toggleKeyboardLocked(!1),e.popBack(this._myWindow),this._myWindow&&delete this._myWindow._myIndicator,u.superclass.destroy.apply(this,arguments)}});return u});
//# sourceMappingURL=LoadingIndicator.tmpl.map
define("Deprecated/Controls/LoadingIndicator/LoadingIndicator",["Core/WindowManager","Lib/Control/Control","tmpl!Deprecated/Controls/LoadingIndicator/LoadingIndicator","Lib/Control/Window/Window","Deprecated/Controls/ProgressBar/ProgressBar","Deprecated/Controls/ModalOverlay/ModalOverlay","Core/helpers/vital/processImagePath","Core/helpers/string-helpers","Core/constants","Core/helpers/unrelated-helpers","Core/Deferred","css!Deprecated/Controls/LoadingIndicator/LoadingIndicator","i18n!Deprecated/Controls/LoadingIndicator/LoadingIndicator"],function(i,e,t,n,s,o,r,d,a,l,h){"use strict";var c=2e3,_=n.extend({$protected:{_isIndicator:true,_isIndicatorVisible:true,_options:{resizable:false,border:false,autoHeight:true,autoWidth:true},_keysWeHandle:[]},$constructor:function(){this.unsubscribeFrom(o,"onClick"),this._window.addClass("ws-LoadingIndicator__window")},_moveFocusToSelf:function(){},onBringToFront:function(){},activate:function(){},_restoreLastActiveOnHide:function(){},isMovableToTop:function(){for(var e=true,t=i.getStack(),n=t.length-1;n>=0;n--){var s=t[n];if(s.window._isIndicator)if(s.window===this)return e;else if(s.visible())e=false;else e=null}return true}}),w=function(i){var e=a.$body;if(this._options.showInWindow)if(i){if(!o.getState())e.addClass("ws-LoadingIndicator-overlay-hidden");e.addClass("ws-LoadingIndicator-hidden")}else e.removeClass("ws-LoadingIndicator-hidden ws-LoadingIndicator-overlay-hidden");else this._loadingIndicator.toggleClass("ws-LoadingIndicator-hidden",i)},u=e.Control.extend({$protected:{_loadingPic:"",_loadingIndicator:"",_loadingContainer:"",_loadingText:"",_picture:"",_myWindow:null,_myProgressBar:null,_progressBarContainer:"",_windowHeight:void 0,_windowWidth:void 0,_isVisible:false,_delay:null,_options:{message:rk("Загрузка"),loadingPicture:r("ws:/ajax-loader-indicator.v1516270649826335cf4508dd597be4bfc9caa3e08b901.gif"),isShowLoadingPicture:true,showInWindow:true,height:57,width:"100%",modal:true,progressBar:false,showPercent:true,delay:false}},$constructor:function(){this._redraw()},getParent:function(){return this._parent},isVisible:function(){return this._isVisible},_setWindowVisibleProperty:function(i){var e=this.getWindow();if(e)e._isIndicatorVisible=i},_showDelay:function(){var e=this;if((!this._delay||this._delay.isReady())&&this._options.delay)w.call(this,true),i._delayedIndicator=this,this._getDelay().addCallback(function(t){if(w.call(e,false),i._delayedIndicator=null,e._overlayZIndex&&o.getState())o._setZIndex(e._overlayZIndex),e._overlayZIndex=null;return t})},_clearDelay:function(){if(this._delay){if(i._delayedIndicator===this)w.call(this,false);this._overlayZIndex=null,this._delay.cancel(),this._delay=null,this._overlayZIndex=null}},_getDelay:function(){return!this._delay||this._delay.isReady()?this._delay=h.fromTimer(c):this._delay},setDelay:function(i){this._options.delay=Boolean(i)},show:function(){if(!this._isVisible){if(this._showDelay(),this._options.showInWindow){var e;if(o.getState()&&this._options.delay&&!i.getCurrentVisibleIndicator())e=o.getZIndex();if(this._myWindow._isShow=false,this._myWindow.show(),this._myWindow.moveWindowToCenter(),e)this._overlayZIndex=o.getZIndex(),o._setZIndex(e)}else this._loadingIndicator.show();this._isVisible=true}},hide:function(){if(this._isVisible){if(this._clearDelay(),this._options.showInWindow)this._myWindow.hide();else this._loadingIndicator.hide();if(i.getCurrentVisibleIndicator()===this)i.setCurrentVisibleIndicator(null);this._isVisible=false}},setMessage:function(i){if(this._loadingText)if(this._loadingText.html(d.escapeTagsFromStr(i,["script"])),this._isVisible&&this._myWindow)this._recalcWindowSize(this._myWindow._window)},_recalcWindowSize:function(i){var e=this,t=function(){e._windowHeight=i.height()||e._windowHeight,e._windowWidth=i.width()||e._windowWidth};if(/none/.test(i.css("display")))i.css({display:"block",visibility:"hidden"}),t(),i.css({display:"none",visibility:"visible"});else t(),this._myWindow.moveWindowToCenter()},close:function i(){this.destroy()},setImg:function(i){$(this._picture).removeClass().empty(),$(this._picture).append(l.getImageBlock(i))},_redraw:function(){if(this._myWindow)this._myWindow.close();if(this._container&&(this._progressBarContainer||this._loadingIndicator))this._container.html("");if(this._options.showInWindow){this._container=$(t(this._options)),this._renderInd();var i=this;this._showDelay(),this._myWindow=new _({modal:this._options.modal,animatedWindows:false,handlers:{onDestroy:function(){i._myWindow=null},onReady:function(){this._myIndicator=i,this.getContainer().append('<div class="ws-win-loadingIndicator"></div>'),this.getContainer().find(".ws-win-loadingIndicator").append(i._container),i._windowHeight=this._window.height(),i._windowWidth=this._window.width()}}})}else this._container.append($(t(this._options))),this._renderInd(),this._showDelay()},_renderInd:function(){if(this._loadingText=this._container.find(".ws-LoadingIndicator__message"),this._options.progressBar){this._progressBarContainer=this._container.find(".ws-progressbar-container");var i=this;this._myProgressBar=new s({element:i._progressBarContainer,width:289,showPercent:i._options.showPercent})}else{if("string"===typeof this._options.width){var e=this._options.width;if("%"!=e[e.length-1])this._options.width=parseInt(this._options.width,10)+"px"}else this._options.width=this._options.width+"px";this._loadingIndicator=this._container.find(".ws-loading"),this._loadingContainer=this._loadingIndicator.find(".ws-LoadingIndicator__loadingContainer"),this._loadingIndicator.css({"text-align":"center",height:this._options.height,width:this._options.showInWindow?"100%":void 0})}this._notify("onReady")},getWindow:function(){return this._myWindow},setProgress:function(i){if(i=parseInt(i,10),i>=0&&i<=100&&null!==this._myProgressBar)return this._myProgressBar.setProgress(i),true;else return false},destroy:function(){this._clearDelay(),this.hide(),u.superclass.destroy.apply(this,arguments),this._myWindow&&this._myWindow.destroy(),this._myProgressBar&&this._myProgressBar.destroy()}});function f(e){for(var t=false,n=i.getStack(),s=n.length-1;s>=0;s--){var o=n[s];if(o.window._isIndicator)if(o.window===e)return!t;else if(o.visible())t=true}return true}function y(i,e){return function(){if(!this[i]){this[i]=true;try{return e.apply(this,arguments)}finally{this[i]=false}}}}var p=u.extend({$protected:{_showing:false,_hiding:false,_preventKeyDown:null,_keyboardLocked:false},$constructor:function(){this._preventKeyDown=function(e){var t=116,n=123,s=this._options.showInWindow?this._myWindow.getZIndex():0;if(e.keyCode!==t&&e.keyCode!==n&&s>=i.getMaxZIndex())if(e.preventDefault)e.preventDefault(),e.stopPropagation();else e.returnValue=false}.bind(this)},_toggleKeyboardLocked:function(i){if(this._keyboardLocked!==i)if(this._keyboardLocked=i,i)if(document.addEventListener)document.addEventListener("keydown",this._preventKeyDown,true);else document.attachEvent("onkeydown",this._preventKeyDown);else if(document.removeEventListener)document.removeEventListener("keydown",this._preventKeyDown,true);else document.detachEvent("onkeydown",this._preventKeyDown)},_initComplete:function(){p.superclass._initComplete.apply(this,arguments),this.show()},hide:y("_hiding",function(){if(this._options.showInWindow){if(this._setWindowVisibleProperty(false),this==i.getCurrentVisibleIndicator())p.superclass.hide.apply(this,arguments)}else p.superclass.hide.apply(this,arguments);this._toggleKeyboardLocked(false)}),show:y("_showing",function(){if(this._options.showInWindow)if(this._setWindowVisibleProperty(true),f(this._myWindow)){i._pendingIndicator=this;var e=i.getCurrentVisibleIndicator();if(e&&this!==e)p.superclass.hide.apply(e,arguments);p.superclass.show.apply(this,arguments),i.setCurrentVisibleIndicator(this),i._pendingIndicator=null}else i.pushUp(this._myWindow);else p.superclass.show.apply(this,arguments);this._toggleKeyboardLocked(true)}),destroy:function(){if(this._toggleKeyboardLocked(false),i.popBack(this._myWindow),this._myWindow)delete this._myWindow._myIndicator;p.superclass.destroy.apply(this,arguments)}});return p});
//# sourceMappingURL=LoadingIndicator.js.map
define("js!SBIS3.FL.FileChooser",["Core/core-functions","Core/constants","Core/moduleStubs","Deprecated/Controls/LoadingIndicator/LoadingIndicator","Core/EventBus","Core/ParallelDeferred","Core/Deferred","Lib/File/ResourceGetter/FSGetter","browser!js!SBIS3.Plugin/Source/Helper/Helper","Lib/Control/FloatArea/FloatArea","Core/helpers/string-helpers","i18n!SBIS3.FL.FileChooser"],function(e,n,o,i,l,t,r,s,a,u,d){var c,f,h=false,C={choose:function(n){var s=new r,a,d=function(){a&&a.destroy()};if(false===h)h=true;else return s.callback();if(n=C._checkConfig(n),!n.useDefaultWindow&&C.isShowSystemWindow())n.useDefaultWindow=true;if(n.useDefaultWindow)return h=false,C._openDefaultWindow(n),s.callback();return a=new i({delay:true,message:rk("Пожалуйста, подождите.")}),o.requireModule("SBIS3.FL.ManageNotifier").addCallback(function(o){var i=new t;if(!n.disableReportReader)o[0].getDocumentReaderPlugin({mode:"silent"},n.serviceUrl);if(i.push(o[0].getFileChooserPlugin({mode:"always"},d)),null===localStorage.getItem("FileChooserUnsupportedOs"))i.push(o[0].getFileLoaderPlugin({mode:"silent"}).addCallbacks(function(){localStorage.setItem("FileChooserUnsupportedOs","0")},function(n){if("UNSUPPORTED_OS"===n.description)return localStorage.setItem("FileChooserUnsupportedOs","1"),d(),e.alert(rk("В связи с окончанием поддержки операционной системы будет использовано стандартное окно загрузки."),"","error").addCallback(function(){return n});return}));i.done().getResult().addCallbacks(function(){var e=new u({name:"FileChooseWindow",template:"js!SBIS3.FL.FileChooserWindow",opener:n.parent||null,componentOptions:{config:n},isStack:true,minWidth:900,maxWidth:1200,modal:true,autoCloseOnHide:true,className:window.IsSbis2Browser?"fileChooser__removeScroll":"",handlers:{onReady:function(){s.callback()},onBeforeClose:function(e,n){if(!n)l.channel("FileLoadingEvents").notify("onCancel")},onDestroy:function(){h=false,C._unbindEvents(),o[0].closeDocumentReaderPlugin()}}});l.channel("FileLoadingEvents").subscribe("onLoadedPluginError",function(o,i,l){if("FileSystem"===l)e.close();n.useDefaultWindow=true,C._openDefaultWindow(n)})},function(){h=false,n.useDefaultWindow=true,C._openDefaultWindow(n),s.callback()}).addBoth(d)}),s},isShowSystemWindow:function(){var e="1"===localStorage.getItem("FileChooserUnsupportedOs");return(false===a.isOSAvailable()||true===a.isMobilePlatform()||e||false===a.isSbisPluginRunning()&&true===a.isSbisPluginSetupDialogClosed())&&!!window.File},_openDefaultWindow:function(n){!c&&(c=$("<div>").addClass("FileChooser_FileInput").hide()),f&&f.destroy(),$("body").append(c),(f=new s({extensions:n.extensions,multiSelect:false!==n.useMultiSelection,element:c})).getFiles().addCallbacks(function(o){for(var i=[],t=0;t<o.length;t++)if(o[t]instanceof Error)return e.alert(d.format({extensions:n.extensions.join(", ")},rk("Для загрузки разрешены файлы с расширениями: $extensions$s$")),"","error"),void l.channel("FileLoadingEvents").notify("onCancel");else i.push({name:o[t].file.name,size:o[t].file.size,file:o[t].file});l.channel("FileLoadingEvents").notify("onChoose",i)},function(){l.channel("FileLoadingEvents").notify("onCancel")})},_checkConfig:function(e){if(e=e instanceof Object?e:{},e.serviceUrl=e.serviceUrl||n.defaultServiceUrl,C._unbindEvents(),e.handlers instanceof Object)e.handlers.onReadyFilter&&l.channel("FileLoadingEvents").subscribe("onReadyFilter",e.handlers.onReadyFilter),e.handlers.onChoose&&l.channel("FileLoadingEvents").subscribe("onChoose",e.handlers.onChoose),e.handlers.onCancel&&l.channel("FileLoadingEvents").subscribe("onCancel",e.handlers.onCancel);return e},_unbindEvents:function(){l.channel("FileLoadingEvents").unbind("onReadyFilter").unbind("onChoose").unbind("onCancel").unbind("onLoadedPluginError")}};return C});
//# sourceMappingURL=Chooser.module.js.map
define("js!SBIS3.DOCVIEW.FileLoadMixin",["WS.Data/Entity/Record","Core/helpers/Object/find","Core/helpers/String/format","Core/Indicator","Core/IoC","Core/EventBus","Core/detection","js!SBIS3.DOCVIEW.Funcs","Lib/ServerEvent/Bus","Core/Deferred","Core/moduleStubs","WS.Data/Source/SbisService","i18n!SBIS3.DOCVIEW.FileLoadMixin"],function(e,i,t,o,n,s,a,r,l,f,d,c){"use strict";function p(e){require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(i){i.showNotification(e)})}return{$protected:{extensions:["jpg","jpeg","ico","png","pdf","bmp","gif","mp3","mp4"],_onUploadProcessed:function(e){if(e.get("Error"))p({status:"error",caption:e.get("Error")});else this._onLoaded(e)},_attachSbisDiskFile:function(i){var t=this,n,s=i.isLink?"CreateLinkOnFile":"CreateFileCopy";if(i.isLink&&t._options.linkAsUrlFile)n=new c({endpoint:{contract:"FileSD",address:"/disk/api/v1/service/"}}).call("GetPublicAccessRight",{Id:i.id}).addCallback(function e(o){var n=o.getRow();if(i.url=n.get("HRef"),i.url)t.addLink(i.name,i.url);else return new Error(rk("Не удалось создать ссылку для файла")+" "+i.name)});else{if(this._options.mainOptions.isDisk){var a=new e({adapter:"adapter.sbis",format:[{name:"Ids",type:"array",kind:"string"},{name:"ParentId",type:"string"}]});a.set({Ids:[i.id],ParentId:t._options.destinationDir||"temp"}),n=new c({endpoint:{contract:"FileSD",address:"/disk/api/v1/service/"}}).call(s,{Object:a})}else n=new c({endpoint:{contract:this._options.mainOptions.objectName,address:this._options.mainOptions.serviceUrl+"service/"}}).call(s,{Id:i.id,IsFolder:i.isFolder});n.addCallback(function e(n){var s,a;if(n.getRawData()&&"recordset"===n.getRawData()._type)s=n.getAll();else a=n.getScalar();if(t._options.mainOptions.isDisk){var r=s.at(0);if(r.get("ErrorCode"))return new Error(r.get("ErrorMsg"));t._onFinish(r.get("VersionId")||r.get("Id"),i.isFolder,i,{fileId:r.get("Id")||null}),o.hide(),t._checkIfTotalComplete()}else if(s&&s.getCount()>0)t._filesCount--,t._onFinish(s.at(0).get("Id"),i.isFolder,i,{listFiles:s,singleFileFromDisk:1===s.getCount(),useSingleProcessing:!t._options.mainOptions.isDisk,isLastObject:0===t._filesCount});else t._onFinish(a,i.isFolder,i)})}n.addErrback(function(e){p({status:"error",caption:e.message||e.details}),t._notify("onErrorCreateAttachment",e)}),o.setMessage(rk("Идет сохранение")+"...")},_addObjectToSbisBuffer:function(e,t){var o,n,s=this;if("string"===typeof e)n=e,o=i(this._loadedToFileStorageFiles,function(i){return i.fileName===e});else n=e.fileName,o=e;if(o&&o.attachId&&n)r.readAttachmentInfo({objectName:this._options.mainOptions.objectName,serviceUrl:this._options.mainOptions.serviceUrl,id:o.attachId}).addCallback(function e(i){var a=[{attachId:o.attachId,redactionId:"",fileName:n,title:r.getFileName(n),objectName:s._options.mainOptions.objectName,serviceUrl:s._options.mainOptions.serviceUrl,"folder@":t||false,signs:Boolean(o.signs),encrypted:l(o,i),hash:i.get("hash"),size:i.get("size")||0}];function l(e,i){if("number"!==typeof e.encrypted)if(i&&i.get instanceof Function)return Number(i.get("encrypted"));return Number(e.encrypted)}return d.require(["js!SBIS3.BL.SbisBuffer"]).addCallback(function(e){return e[0].AddObjects(a)})})},_fromSbisDisk:function(){var e=this,i=e.getContainer(),t={groupDocsCatalogId:e._options.groupDocsCatalogId,groupPhotoCatalogId:e._options.groupPhotoCatalogId,loadWithoutServerEvents:e._options.loadWithoutServerEvents,destinationFolderId:e._options.destinationDir||"temp",isStack:i.width()>=570,canSelectFolder:e._options.canSelectFolderFromDisk,disableSwitcher:e._options.hideInsertMode,multiselect:void 0===e._options.multiselect?e._options.multiSelect:e._options.multiselect,defaultTypeSwitcher:(e._options.insertMode||"Link").toLowerCase(),opener:e,onlySelect:true};require(["js!SBIS3.EDO.CD.AttachFromSbisDisk"],function(i){i.show(t).addCallbacks(function(i){if(!i||!i.length)return;if(e._options.extensions&&e._options.extensions.length)i=i.filter(function(i){return r._isFileWithExtensions(i.name,e._options.extensions)});if(!i.length)return void r.alert({message:rk("Загрузка объектов данного типа не поддерживается")});e._filesCounter=i.length,e._filesCount=i.length,i.forEach(function(i){var t=e._notify("onStartCreateAttachment",e.filters,{file_name:i.name,file:i,from_params:"disk"});f.callbackWrapper(t,function(t){if(false===t)return;e._attachSbisDiskFile(i)})})},function(e){n.resolve("ILogger").error(e)})})},_needRewriteRenameOrSkip:function(e,i,t){var o=new f;return require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(n){if(e instanceof Array&&1==e.length)e=e[0];n.showConfirmDialog({className:"controls-InformationPopup__file_exists"+(i?" is-FormDoc":""),message:e instanceof Array?rk("Файлы")+' "'+e.join('", "')+'" '+rk("уже существуют"):rk("Файл с именем")+' "'+e+'" '+rk("уже существует"),status:"question",hasCancelButton:!t,positiveButton:{caption:rk("Добавить копию")},negativeButton:{caption:rk("Пропустить")},cancelButton:{caption:rk("Заменить","подмена")}},function e(){o.callback("rename")},function e(){o.callback("skip")},function e(){o.callback("rewrite")})}),o},_doFileUploadUsingManager:function(e,i,o,n){if("rewrite"===n)this._uploadManager.filesToRewrite.push({fileName:o});if(e&&e.file instanceof File)e=e.file;if(e instanceof File){if(!this._options.uploadEmptyFiles&&!e.size){if(p({status:"error",caption:rk("Размер следующего файла нулевой")+": "+o}),this._isDragDrop)this._filesInFolders.splice(this._filesInFolders.indexOf(e),1);return void this._checkIfTotalComplete()}if(this._options.maxFileSizeInMB&&e.size>1024*this._options.maxFileSizeInMB*1024){var s=rk("Размер файла превышает установленное ограничение в $number$s$ МБ"),a={number:this._options.maxFileSizeInMB};return p({status:"error",caption:t(a,s)+": "+o}),void this._checkIfTotalComplete()}this._uploadManager.upload("browser",e.fileCaption||e.name,e.fileSize,{file:e,fileId:i,fileName:o,folder:i?null:this._options.mainOptions.isDisk&&e.folder?e.folder:this._options.destinationDir||"temp",fileFolder:e.folder})}else this._uploadManager.upload("plugin",e.fileCaption||e.name,e.fileSize,{path:e.path,fileId:i,fileName:e.name||o,isFolder:"folder"===e.type,folder:i?null:this._options.destinationDir||"temp"})},_doFilesUploadUsingManager:function(e,i,t,o,n){var s=this;t=t||[],e.forEach(function(e){var a=s.filters.get("fileName")||e.fileCaption||e.name||"unknown";if(t.indexOf(a)>=0)if("skip"===n)s._checkIfTotalComplete();else if("rewrite"===n)s._doFileUploadUsingManager(e,i,a,n);else a=r.uniqueName(a,o),o.push(a),s._doFileUploadUsingManager(e,i,a);else s._doFileUploadUsingManager(e,i,a)})},_checkTooLargeFiles:function(e){var i=this,o=1024*i._options.maxFileSizeInMB*1024,n=[],s=[];if(e=e.filter(function(e){var t,a;if("file"===e.type||e.file&&e.file instanceof File){if(t=o&&(e.size||e.fileSize)>o,a=false,t)n.push(e.name);if(!i._options.uploadEmptyFiles)if(a=!(e.size||e.fileSize),a)s.push(e.name)}return!t&&!a}),n.length){var a=n.length>1?rk("Размер следующих файлов превышает установленное ограничение в $number$s$ МБ"):rk("Размер следующего файла превышает установленное ограничение в $number$s$ МБ"),r={number:i._options.maxFileSizeInMB};p({status:"error",caption:t(r,a)+": "+n.join(", ")}),n=[]}if(s.length)p({status:"error",caption:(s.length>1?rk("Размер следующих файлов нулевой"):rk("Размер следующего файла нулевой"))+": "+s.join(", ")}),s=[];return e},_startLoadFiles:function(e,t,n,s){var a=this,l=true,f=1024*a._options.maxFileSizeInMB*1024;if(a._options.tooLargeFiles.length)a._options.tooLargeFiles.splice(0,a._options.tooLargeFiles.length);if(a._options.emptyFiles.length)a._options.emptyFiles.splice(0,a._options.emptyFiles.length);if(e.forEach(function(e){if("file"===e.type){if(f&&(e.size||e.fileSize)>f)a._options.tooLargeFiles.push(e.path);if(!a._options.uploadEmptyFiles&&!(e.size||e.fileSize))a._options.emptyFiles.push(e.path)}}),a._isDragDrop=t,t||a._options.mainOptions.isDisk||a._options.mainOptions.serviceUrl.length>1){o.setMessage(rk("Ожидайте")+"..."),l=false;var d=a._notify("onStartCreateAttachment",a.filters,{file_name:"",file:e[0],from_params:"disk"});r.wrapperDef(d).addCallback(function(r){if(false===r)return void o.hide();var l=a.filters.get("attachId"),f=[],d=[],c;a._filesCounter=e.length;var p=true;if(e.forEach(function(e){var t=a.filters.get("fileName")||e.fileCaption||e.name||"unknown";if(c=i(n,function(e){if(t===e.fileName&&!e.isFormDoc)p=false;return t===e.fileName}),c)d.push(t),f.push(c.fileTitle||t)}),d.length)a._needRewriteRenameOrSkip(f,p,t).addCallback(function(i){a._doFilesUploadUsingManager(e,l,d,s,i)});else a._doFilesUploadUsingManager(e,l)})}return l},_checkFileDuplicateNames:function(e,t){var o=[],n=[];return e.forEach(function(e){var s=r.getFileName(e.name||e),a=i(t,function(e){return s===e.fileName});if(a)e.duplicated=true,n.push(s),o.push(a.fileTitle||s)}),{titles:o,names:n}},_onSendHandler:function(e){this._notify("onSaveFiles",e)},_onBeforeSendHandler:function(e,i,t){var o=this,n=new f;if(e.fileArr=o._checkTooLargeFiles(e.fileArr),a.isMobileIOS)e.fileArr.forEach(function(e){if("image"===r.parseFileName(e.name).name)e.name=r.generateScreenShotName(e.name,t)});if(i&&i.length){var s=true,l=o._checkFileDuplicateNames(e.fileArr,i),d=l.titles;if(l.names.length)o._needRewriteRenameOrSkip(d,s,false).addCallback(function(i){if("skip"===i)e.fileArr=e.fileArr.filter(function(e){return!e.duplicated});else if("rename"===i)e.fileArr.forEach(function(e){e.name=r.uniqueName(e.name,t),t.push(e.name)});else if("rewrite"===i)e.record.addField({name:"ПерезаписатьСделатьВерсией",type:"boolean"}),e.record.set("ПерезаписатьСделатьВерсией",true);n.callback(e)});else n.callback(e)}else n.callback(e);return n},_defineHandlers:function(e,i){var t=this;return{onChoose:function(o,n){t._startLoadFiles(n,false,e,i)},onBeforeSend:function(o,n){f.callbackWrapper(t._notify("onStartCreateAttachment",t.filters,n.fileArr),function(s){if(false===s)return;if(!t._options.useStorageMode)o.setResult(t._onBeforeSendHandler(n,e,i))})},onSend:function(o,n){if(t._options.useStorageMode)o.setResult(t._onSendHandler(n,e,i))},onStartLoad:function(e,i){t._options.mainOptions._sessionId=i}}},_openFileChooser:function(e,i,t){var o=this,n={useMultiSelection:o._options.multiSelect,folderPath:e,extensions:o._options.extensions.length?o._options.extensions:void 0,useDefaultWindow:o._options.useDefaultWindow,loadWithoutServerEvents:o._options.loadWithoutServerEvents,canUploadFolder:"ServiceContractClaim"===o._options.mainOptions.objectName?false:true,parent:o};if(this._easyLoadingMode)n.handlers=o._defineHandlers(i,t),o._newFileChooser.choose(n);else n.canUploadFolder=false,new o._newFileLoader({record:o._prepareLoadParams(),mode:o._options.useStorageMode?"storage":"without_operation",serviceUrl:o._options.mainOptions.serviceUrl+"service/",resultWindowOnLoad:false,handlers:o._defineHandlers(i,t)}).choose(n)},_maxFileLoad:function(e,i){var o=this,n=o._options.linkedList,a=r.getFileObjectsInCurrentFolder(n),l=a&&a.length?r.getFilesArray(a):null;if(o._loadedToFileStorageFiles=[],o._newFileLoader||o._newFileChooser){var f=s.channel("FileLoadingEvents");if(!i)this.subscribeTo(f,"onLoaded",function(e,i){if(e.setResult(false),i.errorFiles&&i.errorFiles.length&&o._options.tooLargeFiles.length)i.errorFiles.forEach(function(e){if(o._options.tooLargeFiles.some(function(i){return r.getFileName(i)===e.fileName}))e.errorText=t({number:o._options.maxFileSizeInMB},rk("Размер файла превышает установленное ограничение в $number$s$ МБ"))});o._onLoaded(i)}),this.subscribeTo(f,"onLoadedToFileStorage",function(e,i,t,n){o._loadedToFileStorageFiles.push({attachId:i,redactionId:t,fileName:n})}),o._openFileChooser(e,a,l);else o._startLoadFiles(i,true,a,l)}else if(!i)o._fileLoad()},_prepareLoadParams:function(i){var t=this._options.loadParams;if(t){if("Deprecated/Record"==t._moduleName)t=new e({rawData:t.toJSON(),adapter:"adapter.sbis"});var o=i||this.filters.get("folder");if(o){if(!t.has("Раздел"))t.addField({name:"Раздел",type:"string"});t.set("Раздел",o.toString())}else if(t.has("Раздел"))t.removeField("Раздел")}return t},_fileLoad:function(){var e=this,i={element:$("<div>").appendTo(document.body),handlers:{onLoaded:function(i,t){e._onLoaded(t.result)},onLoadStarted:function(i){var t=r.getFileExtension(this.getFileName());if(!t||!r._isFileExtensionIn(t,e.extensions))r.alert({message:rk("Выбранный файл нельзя прикрепить в качестве страницы")}),i.setResult(false),this.destroy()}},name:e.getParent().getId()+"_sc",enable:true,useJava:false,allowChangeEnable:false,parent:e.getParent(),serviceUrl:e._options.mainOptions.serviceUrl+"service/",method:e._options.mainOptions.objectName+".ЗагрузитьФайл"};require(["Lib/Control/FileBrowse/FileBrowse"],function(e){new e(i).selectFile()})},_options:{loadParams:null,extensions:[],tooLargeFiles:[],emptyFiles:[],multiSelect:true}},$constructor:function(){this._publish("onBeforeSendFile","saveOriginalFileInfo","onSaveFiles");var e=this;this.subscribeTo(l.serverChannel("fileloader.uploaded"),"onMessage",function(i,t){var o=t.get("ID");if(o===e._options.mainOptions._sessionId)new c({endpoint:{address:"/fileloader-facade/service/",contract:"Uploading"}}).call("GetResult",{ID:o}).addCallback(function(i){if("sbisbuffer"!==e._activeItem)e._onUploadProcessed(i.getRow())})})},getLoadParams:function(){return this._options.loadParams},setLoadParams:function(e){this._options.loadParams=e},getDestinationDir:function(){return this._options.destinationDir},setDestinationDir:function(e){this._options.destinationDir=e},getGroupDocsCatalogId:function(){return this._options.groupDocsCatalogId},setGroupDocsCatalogId:function(e){this._options.groupDocsCatalogId=e,this._notifyOnPropertyChanged("groupDocsCatalogId")},getGroupPhotoCatalogId:function(){return this._options.groupPhotoCatalogId},setGroupPhotoCatalogId:function(e){this._options.groupPhotoCatalogId=e,this._notifyOnPropertyChanged("groupPhotoCatalogId")}}});
//# sourceMappingURL=FileLoadMixin.module.js.map
define("js!SBIS3.DOCVIEW.VideoMixin",["Core/IoC","Core/Deferred","js!SBIS3.DOCVIEW.FileLoadMixin"],function(e,i){"use strict";return{$protected:{_attachVideoMessageComponent:function(){var t=this,n=e.resolve("ILogger"),r=new i;try{require(["/vmsg/vm.js"],function(){require(["vm!MediaContainer"],function(e){new e({name:"video-control",width:640,height:480,recording:true,handlers:{onAttach:function(e,i){if("video"==i.type)t._attachVideoMessage(i);else if("audio"==i.type)t._attachVideoMessage(i)}}}),r.callback()},function(e){n.error("Ошибка загрузки модуля vm!MediaContainer\n",e),r.errback()})},function(e){n.error("Ошибка загрузки модуля /vmsg/vm.js\n",e),r.errback()})}catch(e){n.error("Ошибка при загрузке vm.js\n",e),r.errback()}return r},_attachVideoMessage:function(e){var i={fileName:"audio"==e.type?"Аудиосообщение.mp3":"Видеосообщение.mp4",id:e.fileid,isLink:false,isVideo:true};this._attachSbisDiskFile(i)},_video:function(){this._attachVideoMessageComponent()}}}});
//# sourceMappingURL=VideoMixin.module.js.map
define("Deprecated/helpers/additional-helpers",["Core/helpers/Function/callNext","Core/EventBus","Core/Deferred","Core/constants","Deprecated/ReaderSBIS"],function(e,n,t,r,s){var i={axo:function(){var e="A"+["ctiv"].concat("bject").join("eXO"),n=function(){return this||(0,eval)("this")}()[e];if(n)return function e(t){return new n(t)}}(),prepareFilter:s.prototype.prepareFilter,parseIdentity:function(e){if(e instanceof Array){if(1===e.length)return e[0];return e.join(r.IDENTITY_SPLITTER)}else return e},collection:function(t){t._eventBusChannel=n.channel({strictMode:true}),t._eventBusChannel.publish("onChange","onRemoveItem","onInsertItem","onMove","onChangeOrder");var r=function(){this._eventBusChannel.notify("onChange")},s=function(){r.apply(this),this._eventBusChannel.notify("onChangeOrder")},a=function(){return i.collection(arguments[arguments.length-1])},l=function(e,n){r.apply(this,[]),this._eventBusChannel.notify("onInsertItem",e,n)},o=function(e,n){r.apply(this,[]),this._eventBusChannel.notify("onRemoveItem",e,n)},h=function(e,n){return this._eventBusChannel[e].apply(this._eventBusChannel,n),this},p=function(){return Array.prototype.slice.apply(arguments,[0,arguments.length-1])},u=function(e,n){for(var t=[],r=0;r<n;r++)t.push(e+r);return t};return t.subscribe=function(e,n){return this._eventBusChannel.subscribe(e,n,this),this},t.once=function(){return h.apply(this,["once",arguments])},t.unsubscribe=function(){return h.apply(this,["unsubscribe",arguments])},t.unbind=function(){return h.apply(this,["unbind",arguments])},t.slice=e.call(Array.prototype.slice,a.bind(t)),t.concat=e.call(Array.prototype.concat,a.bind(t)),t.pop=e.call(Array.prototype.pop,function(e){if(this._eventBusChannel.hasEventHandlers("onRemoveItem"))o.apply(this,[[e],[this.length]]);else if(this._eventBusChannel.hasEventHandlers("onChange"))r.apply(this,[])}),t.push=e.call(Array.prototype.push,function(){if(this._eventBusChannel.hasEventHandlers("onInsertItem")){var e=p.apply(this,arguments),n=e.length,t=u(this.length-n,n);l.apply(this,[e,t])}else if(this._eventBusChannel.hasEventHandlers("onChange"))r.apply(this,[])}),t.reverse=e.call(Array.prototype.reverse,s.bind(t)),t.shift=e.call(Array.prototype.shift,function(){if(this._eventBusChannel.hasEventHandlers("onRemoveItem"))o.apply(this,[Array.prototype.slice.apply(arguments,[]),[0]]);else if(this._eventBusChannel.hasEventHandlers("onChange"))r.apply(this,[])}),t.unshift=e.call(Array.prototype.unshift,function(){if(this._eventBusChannel.hasEventHandlers("onInsertItem")){var e=p.apply(this,arguments).reverse(),n=u(0,e.length);l.apply(this,[e,n])}else if(this._eventBusChannel.hasEventHandlers("onChange"))r.apply(this,[])}),t.sort=e.call(Array.prototype.sort,s.bind(t)),t.splice=e.call(Array.prototype.splice,function(e,n){var t=arguments.length,s=true;if(this._eventBusChannel.hasEventHandlers("onRemoveItem")&&n>0){var i=arguments[t-1];s=false,o.apply(this,[i,u(e,i.length)])}if(this._eventBusChannel.hasEventHandlers("onInsertItem")&&t>3){var h=Array.prototype.slice.apply(arguments,[2,t-1]);s=false,l.apply(this,[h,u(e,h.length)])}if(s)r.apply(this,[]);return a.apply(this,arguments)}),t.move=function(e,n){var r=this[e];return Array.prototype.splice.apply(this,[e,1]),Array.prototype.splice.apply(this,[n,0,r]),this._eventBusChannel.notify("onMove",e,n),s.bind(t).apply(this),this},t}};return i});
//# sourceMappingURL=additional-helpers.js.map
define("Deprecated/ReaderUnifiedSBIS",["require","Core/Deferred","Core/core-functions","Core/constants","Deprecated/ReaderSBIS"],function(e,t,r,o,a){var i;return i=a.extend({$protected:{_options:{parserType:"ParserSBIS",linkedObject:"",dbScheme:"",adapterType:"TransportAdapterRPCJSON",queryName:"Список",readMethodName:"Прочитать",createMethodName:"Создать",updateMethodName:"Записать",destroyMethodName:"Удалить",copyMethodName:"Копировать",mergeMethodName:"Объединить",otherUrl:false,queryNameForRead:null}},$constructor:function(){this._options.adapterParams=r.merge({serviceUrl:this._options.otherUrl?this._options.otherUrl:o.defaultServiceUrl,createMethodName:this._options.dbScheme+this._options.linkedObject+"."+this._options.createMethodName,listMethodName:this._options.dbScheme+this._options.linkedObject+"."+this._options.queryName,updateMethodName:this._options.dbScheme+this._options.linkedObject+"."+this._options.updateMethodName,destroyMethodName:this._options.dbScheme+this._options.linkedObject+"."+this._options.destroyMethodName,mergeMethodName:this._options.dbScheme+this._options.linkedObject+"."+this._options.mergeMethodName,copyMethodName:this._options.dbScheme+this._options.linkedObject+"."+this._options.copyMethodName,readMethodName:this._options.dbScheme+this._options.linkedObject+"."+this._options.readMethodName},this._options.adapterParams||{})},getAdapter:function(o,a){function s(e,t){if(Array.isArray(e))return Object.keys(e.reduce(function(e,r){return e[t(r)]=1,e},{}));else return[t(e)]}var d,n,h={read:".Прочитать",copy:".Копировать",destroy:".Удалить",update:".Записать",merge:".Объединить"};switch(o){case"copy":case"read":d=this._extractObjectName(a[0]);break;case"destroy":d=this._extractObjectName(Array.isArray(a[0])?a[0][0]:a[0]);break;case"update":d=this._extractObjectName(a[0].getKey());break;case"merge":var p=this._extractObjectName(a[0]),c=s(a[1],this._extractObjectName);if(1==c.length&&p==c[0])d=p;else return{merge:function(){return t.fail(rk("Невозможно объединить записи различных типов")+" ("+p+" "+rk("и")+" "+c+")")}}}if(d){if(n=r.merge({},this._options.adapterParams),this._options.linkedObject!=d)for(var m in h)if(h.hasOwnProperty(m))n[m+"MethodName"]=d+h[m];n["objectName"]=d;var _=e.defined("Deprecated/"+this._options.adapterType)?e("Deprecated/"+this._options.adapterType):null;if(_)return new _(n);else throw new Error("Adapter type is not specified")}return i.superclass.getAdapter.apply(this,arguments)}}),i});
//# sourceMappingURL=ReaderUnifiedSBIS.js.map
define("Deprecated/StraightArgsUnifiedReader",["Deprecated/ReaderUnifiedSBIS","Deprecated/SerializatorSBIS","Core/core-instance"],function(e,r,a){var n;return n=e.extend({_makeArgsForQuery:function(e){for(var n in e)if(e.hasOwnProperty(n)){var t=e[n];if(a.instanceOfModule(t,"Deprecated/Record")||a.instanceOfModule(t,"Deprecated/RecordSet"))e[n]=r.serialize(t);else if(t instanceof Date)e[n]=t.toSQL(null)}return e}}),n});
//# sourceMappingURL=StraightArgsUnifiedReader.js.map
define("Deprecated/StraightArgsReader",["Deprecated/ReaderSBIS","Deprecated/SerializatorSBIS","Core/core-instance"],function(e,r,a){var t;return t=e.extend({_makeArgsForRead:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(a.instanceOfModule(n,"Deprecated/Record")||a.instanceOfModule(n,"Deprecated/RecordSet"))e[t]=r.serialize(n);else if(n instanceof Date)e[t]=n.toSQL(null)}return e}}),t});
//# sourceMappingURL=StraightArgsReader.js.map
define("Deprecated/ReaderGETJSON",["Deprecated/ReaderAbstract"],function(r){var e;return e=r.extend({_columnsParseFnc:function(r){var e=[],n=JSON.parse(r);for(var a in n[0])e.push({n:a,t:"Строка"});return{settings:e,pk:0}},_dataParser:function(r){var e,n=JSON.parse(r);for(var a in n){e=[];for(var t in n[a])e.push(n[a][t]);this._notify("onNewRecord",e)}},_makeArgsForQuery:function(r){return r}}),e});
//# sourceMappingURL=ReaderGETJSON.js.map
define("Deprecated/Reader",["Deprecated/ReaderAbstract","Deprecated/ReaderSBIS","Deprecated/ReaderUnifiedSBIS","Deprecated/StraightArgsUnifiedReader","Deprecated/StraightArgsReader","Deprecated/ReaderGETJSON"],function(){});
//# sourceMappingURL=Reader.js.map
define("Deprecated/ParserAbstract",["require","Core/Abstract","Deprecated/RecordTypes","Core/constants"],function(t,e,n,s){var r,o={RECORD:"returnRecord",RECORD_SET:"returnRecordSet"};return r=e.extend({$protected:{_cols:null,_rows:[]},$constructor:function(){this._publish("onParseData","onWayExists","onResults","onSettingsParsed","onNewRecord")},parse:function(e,n){var s=this,r=t("Deprecated/Record"),i;if(null===e)return null;this._rows=[];var a=this._columnsParseFnc(e);switch(this._cols=a.settings,n){case o.RECORD:i=new r({row:e.d,colDef:this._cols,pkValue:e.d[a.pk||0]});break;case o.RECORD_SET:for(var c=t("Deprecated/RecordSetStatic"),l=[],u=0,_=e.d.length;u<_;u++)l=e.d[u],this._rows.push(new r({row:l,colDef:s._cols,pkValue:l[a.pk||0]}));i=new c({defaultColumns:this._cols,records:this._rows})}return i},parseData:function(t,e){if(this._notify("onParseData",t),this._columnsParser(t),t.p)this._notify("onWayExists",t.p);if(t.r)this._notify("onResults",this.readRecord(t.r));this._dataParser(t)},_columnsParser:function(t){var e=this._columnsParseFnc(t);this._notify("onSettingsParsed",this._transformColumns(e.settings),e.pk)},_columnsParseFnc:function(t){throw new Error("Method AbstractReader::_columnsParseFnc must be implemented")},_dataParser:function(t){throw new Error("Method AbstractReader::_dataParser must be implemented")},_transformColumns:function(t){for(var e={},s=t.length,r,o=0;o<s;o++)if(t[o].s&&t[o].s==n.FIELD_TYPE_HIERARCHY)e[t[o].n]={type:t[o].t,title:t[o].n,s:t[o].s,index:o};else if("object"==typeof t[o].t){if(r=t[o].t,r.n==n.FIELD_TYPE_LINK)e[t[o].n]={type:r.n,title:t[o].n,table:r.t,index:o};else if(r.n==n.FIELD_TYPE_ARRAY)e[t[o].n]={type:r.n,title:t[o].n,arrayType:r.t,index:o};else if(r.n==n.FIELD_TYPE_ENUM||r.n==n.FIELD_TYPE_FLAGS)e[t[o].n]={type:r.n,title:t[o].n,s:r.s,index:o};else if(r.n==n.FIELD_TYPE_MONEY)e[t[o].n]={type:r.n,title:t[o].n,p:r.p,index:o}}else e[t[o].n]={type:t[o].t,title:t[o].n,index:o};return e},getParsedColumns:function(t){return t=this._columnsParseFnc({s:t,d:[]}),this._transformColumns(t.settings)},readRecord:function(t){if(null===t)return null;for(var e=this._columnsParseFnc(t),n=e.settings,s=e.pk,r=n.length,o=[],i=this._dataParser(t),a=0;a<r;a++)if(n[a].s&&"Иерархия"==n[a].s)if("Логическое"==n[a].t)o[a]={t:n[a].t,n:n[a].n,s:n[a].s};else o[a]={t:n[a].t,n:n[a].n,b:n[a].b,f:n[a].f,s:n[a].s};else if("Связь"==n[a].t||"Массив"==n[a].t)o[a]={t:n[a].t,n:n[a].n,s:n[a].s};else o[a]={t:n[a].t,n:n[a].n};var c={columns:this._transformColumns(o),row:i,pk:s};if(t.objectName)c.objectName=t.objectName;return c}}),s.returnType=o,r});
//# sourceMappingURL=ParserAbstract.js.map
define("Deprecated/ParserSBIS",["require","Deprecated/Enum","Deprecated/ParserAbstract","Core/helpers/Object/sortedPairs","Deprecated/helpers/additional-helpers"],function(e,s,t,r,a){var n;return n=t.extend({$constructor:function(){this._publish("onDataParsed","onNewData")},_columnsParseFnc:function(e){var s,t=0;if(Object.prototype.hasOwnProperty.call(e,"s")){for(var r=0;r<e.s.length;r++){if(!e.s.hasOwnProperty(r))continue;if("k"in e&&e.k==e.s[r].n)s=t;t++}if(void 0===s&&"-1"==e.k)s=-1;return{settings:e.s,pk:s||0}}},_dataParser:function(t){var n=false,i=t.d[0];if(t.s&&0===t.s.length)return[];if("object"==typeof t.s[0].t){if("Массив"==t.s[0].t.n||"Флаги"==t.s[0].t.n)i=i&&i[0]||null}else if("Идентификатор"==t.s[0].t)i=i&&null===i[0]?[null]:i&&i[0]||null;if(void 0!==i&&!(i instanceof Array))n=true,t.d=[t.d];for(var l=0,o=t.d.length;l<o;l++){for(var u=[],f=0,d=t.d[l].length;f<d;f++){var c=t.s[f].s&&"Иерархия"===t.s[f].s?t.s[f]:t.s[f].t,p=t.d[l][f],h=e("Deprecated/Record");if("object"===typeof c&&null!==c){var v=c.n;if(c.s&&"Иерархия"===c.s)v="Иерархия";else for(var y in c)if(y in{"Флаги":0,"Запись":0,"Связь":0,"Перечисляемое":0,"Массив":0})v=y;var P=c.s||c[v];if("Флаги"==v){for(var m={},_=r(P),D=[],w=0,b=_.keys.length;w<b;w++)m[_.values[w]]={type:"Логическое",title:_.values[w],index:_.keys[w]},D[_.keys[w]]=null===p?null:p[w];u.push(new h({row:D,colDef:m,parentRecordSet:null,pkValue:null}))}else if("Связь"===v||"Массив"===v)u.push(p);else if("Перечисляемое"===v)u.push(new s({availableValues:P,currentValue:p}));else if("Иерархия"==v)u.push(!(c.n.substr(c.n.length-1,1)in{"@":true,$:true})?a.parseIdentity(p):p);else if("Запись"===v){var k={d:p,s:P};u.push(new h({row:this._dataParser(k),colDef:this._transformColumns(P)}))}}else if("Идентификатор"===c)u.push(a.parseIdentity(p));else if("Запись"===c)if(null!==p){var S=this._columnsParseFnc(p);u.push(new h({row:this._dataParser(p),colDef:this._transformColumns(S.settings)}))}else u.push(null);else if(c in{"Дата":0,"Время":0,"Дата и время":0,timestamp:0,date:0}&&null!==p){var g=Date.fromSQL(p),j=void 0;switch(c){case"Дата и время":j=true;break;case"Время":j=false}g.setSQLSerializationMode(j),u.push(g)}else if("Выборка"==c)if(null!==p){var R=e("Deprecated/RecordSet");u.push(new R({readerType:"ReaderSBIS",readerParams:{adapterType:"TransportAdapterStatic",adapterParams:{data:{d:p.d,s:p.s}}}}))}else u.push(null);else u.push(p)}if(n)return t.d=t.d[0],u;else this._notify("onNewRecord",u)}},parseData:function(e,s){if(this._notify("onParseData",e),this._notify("onSettingsParsed",e.s,this._columnsParseFnc(e).pk),e.p)this._notify("onWayExists",e.p);if(e.r)this._notify("onResults",this.readRecord(e.r));this._notify("onDataParsed",e.d)},getParsedData:function(e){return this._dataParser(e)},readRecord:function(e){if(!e||"object"!==typeof e)return null;var s={columns:e.s,row:e.d,pk:this._columnsParseFnc(e).pk};if(e.objectName)s.objectName=e.objectName;return s}}),n});
//# sourceMappingURL=ParserSBIS.js.map
define("Deprecated/Parser",["Deprecated/ParserAbstract","Deprecated/ParserSBIS"],function(e,r){});
//# sourceMappingURL=Parser.js.map
define("Deprecated/TransportAdapterAbstract",["Core/core-extend"],function(r){var t;return t=r.extend({},{list:function(r){throw new Error("TransportAdapterAbstract::list must be implemented")},create:function(r){throw new Error("TransportAdapterAbstract::create must be implemented")},update:function(r){throw new Error("TransportAdapterAbstract::update must be implemented")},merge:function(r){throw new Error("TransportAdapterAbstract::merge must be implemented")},copy:function(r){throw new Error("TransportAdapterAbstract::copy must be implemented")},destroy:function(r){throw new Error("TransportAdapterAbstract::destroy must be implemented")},read:function(r){throw new Error("TransportAdapterAbstract::read must be implemented")},abort:function(){throw new Error("TransportAdapterAbstract::abort must be implemented")}}),t});
//# sourceMappingURL=TransportAdapterAbstract.js.map
define("Deprecated/TransportAdapterStatic",["Core/Deferred","Deprecated/TransportAdapterAbstract"],function(t,e){var a;return a=e.extend({$protected:{_options:{data:{}},_pkColumnIndex:0,_pkIndex:null,_pkColumnName:void 0,_columns:[],_data:[],_columnsName:"s",_dataName:"d",_countName:"n",_columnTypeName:"t",_columnTitleName:"n",_pkName:"ИдО",_isStandartReader:true},$constructor:function(){if("string"===typeof this._options.data)this._options.data=JSON.parse(this._options.data);var t=this._options.data;if(this._isStandartReader=!(t.cols&&t.data),!this._isStandartReader)this._columnsName="cols",this._dataName="data",this._columnTypeName="type",this._columnTitleName="name",this._pkName="pk";if(this._columns=t[this._columnsName],this._data=t[this._dataName],this._pkColumnIndex=t.k=t.k||0,this._pkColumnIndex>=0&&this._columns&&void 0!==this._columns[this._pkColumnIndex])this._pkColumnName=this._columns[this._pkColumnIndex][this._columnTitleName]},getRPCClient:function(){return null},_refreshPkIndex:function(){var t;this._pkIndex={};for(var e=0,a=this._data.length;e<a;e++)t=this._data[e],this._pkIndex[t[this._pkColumnIndex]]=e},list:function(e){var a=this._isStandartReader&&e["Навигация"]||(e&&e.usePages?e:false),i={},n=this._data.length,s=0,o=n;if(i[this._countName]=n,a){var r,d,_;if(this._isStandartReader)for(var h=0,l=a[this._columnsName].length;h<l;h++)switch(a[this._columnsName][h].n){case"Страница":r=a[this._dataName][h];break;case"РазмерСтраницы":d=a[this._dataName][h];break;case"ЕстьЕще":_=a[this._dataName][h]}else r=a.pageNum,d=a.pageCount,_="full"==a.usePages;if(-1==r)r=parseInt(n/d,10);if(s=r*d,o=Math.min(s+d,n),_)i[this._countName]=!!this._data[o]}if(i[this._dataName]=this._data.slice(s,o),i[this._columnsName]=this._columns,void 0!==this._options.data.r)i.r=this._options.data.r;if(void 0!==this._options.data.n)i.n=this._options.data.n;if(void 0!==this._options.data.p)i.p=this._options.data.p;return(new t).callback(i)},update:function(e){if(this._pkColumnIndex<0)return t.fail(new Error(rk("Запрещено редактирование записей в списке без ключа")));this._buildPkIndexIfNeeded();for(var a=e["Запись"][this._dataName],i=a[this._pkColumnIndex],n=void 0===this._pkIndex[i]?[]:this._data[this._pkIndex[i]],s=0,o=this._columns.length;s<o;s++)n[s]=a[s];if(void 0===this._pkIndex[n[this._pkColumnIndex]])this._data.push(n),this._pkIndex[n[this._pkColumnIndex]]=this._data.length-1;return(new t).callback(n[this._pkColumnIndex])},destroy:function(e){if(this._pkColumnIndex<0)return t.fail(new Error(rk("Запрещено удаление записей в списке без ключа")));this._buildPkIndexIfNeeded();var a=e[this._pkName];if(void 0!==this._pkIndex[a])this._data.splice(this._pkIndex[a],1);return this._refreshPkIndex(),(new t).callback(true)},read:function(e){this._buildPkIndexIfNeeded();var a=e[this._pkName],i=this._data[this._pkIndex[a]];return(new t).callback(this._getRecordByConfig(i))},copy:function(e){if(this._pkColumnIndex<0)return t.fail(new Error(rk("Запрещено копирование записей в списке без ключа")));var a=new t,i=this;return this.read(e).addCallback(function(t){return t[i._dataName][i._pkColumnName]=null,a.callback(t),t}),a},create:function(e){if(this._pkColumnIndex<0)return t.fail(new Error(rk("Запрещено создание записей в списке без ключа")));return(new t).callback(this._getRecordByConfig(e&&e["Фильтр"]))},_getRecordByConfig:function(t){var e={},a={},i,n,s,o;if("[object Object]"==Object.prototype.toString.call(t))s=t[this._columnsName],o=t[this._dataName];e[this._dataName]=[],e[this._columnsName]=this._columns;for(var r=0,d=this._columns.length;r<d;r++){if(a=this._columns[r],i=a[this._columnTitleName],n=null,"[object Object]"==Object.prototype.toString.call(t)){for(var _=0,h=s.length;_<h;_++)if(s[_][this._columnTitleName]==i&&void 0!==o[_])n=o[_]}else if("[object Array]"==Object.prototype.toString.call(t))if(void 0!==t[r])n=t[r];e[this._dataName].push(n)}return e},_buildPkIndexIfNeeded:function(){if(!this._pkIndex)this._refreshPkIndex()},abort:function(){}}),a});
//# sourceMappingURL=TransportAdapterStatic.js.map
define("Deprecated/TransportAdapterRPCAbstract",["Core/IoC","Deprecated/TransportAdapterAbstract","Transport/HTTPError"],function(t,e,r){var o;return o=e.extend({$protected:{_errorHandler:function(e){if("error"==e.errType)t.resolve("ILogger").error("RPC",e instanceof r?e+"":e.message,e);return e},_options:{objectName:void 0,serviceUrl:"",createMethodName:"",listMethodName:"",updateMethodName:"",destroyMethodName:"",mergeMethodName:"",copyMethodName:"",readMethodName:""},_rpcClient:null},$constructor:function(){},getRPCClient:function(){if(null===this._rpcClient)this._rpcClient=this._createRpcClient();return this._rpcClient},setRPCClient:function(t){if(t.callMethod)this._rpcClient=t},_invoke:function(t,e){var r=this;return this.getRPCClient().callMethod(t,e).addCallbacks(function(t){if(r._options.objectName)t.objectName=r._options.objectName;return t},this._errorHandler)},_createRpcClient:function(){throw new Error("Abstract method TransportAdapterRPCAbstract::_createRpcClient must be implemented in child class")},list:function(t){return this._invoke(this._options.listMethodName,t)},update:function(t){return this._invoke(this._options.updateMethodName,t)},merge:function(t){return this._invoke(this._options.mergeMethodName,t)},destroy:function(t){return this._invoke(this._options.destroyMethodName,t)},destroyByFilter:function(t){return this._invoke(this._options.destroyMethodName,t)},create:function(t){return this._invoke(this._options.createMethodName,t)},read:function(t){return this._invoke(this._options.readMethodName,t)},copy:function(t){return this._invoke(this._options.copyMethodName,t)},abort:function(){if(this._rpcClient)this._rpcClient.abort()},getConfig:function(){return this._options}}),o});
//# sourceMappingURL=TransportAdapterRPCAbstract.js.map
define("Deprecated/TransportAdapterRPCJSON",["Deprecated/TransportAdapterRPCAbstract","Transport/RPCJSON"],function(e,r){var t;return t=e.extend({_createRpcClient:function(){return new r({serviceUrl:this._options.serviceUrl})}}),t});
//# sourceMappingURL=TransportAdapterRPCJSON.js.map
define("Deprecated/TransportAdapterGETJSON",["Deprecated/TransportAdapterAbstract","Core/IoC"],function(r,t){var e;return e=r.extend({$protected:{_options:{url:""},_xhrTransport:null},list:function(r){this._xhrTransport=t.resolve("ITransport",{url:this._options.url});var e=[];for(var n in r)e.push(encodeURI(n)+"="+encodeURI(r[n]));return this._xhrTransport.execute(e.join("&"))},getRPCClient:function(){return{}},abort:function(){if(this._xhrTransport)this._xhrTransport.abort()}}),e});
//# sourceMappingURL=TransportAdapterGETJSON.js.map
define("Deprecated/Adapter",["Deprecated/TransportAdapterAbstract","Deprecated/TransportAdapterStatic","Deprecated/TransportAdapterRPCAbstract","Deprecated/TransportAdapterRPCJSON","Deprecated/TransportAdapterGETJSON"],function(){});
//# sourceMappingURL=Adapter.js.map
define("Core/helpers/vital/objectsDiff",[],function(){return function e(t,r){var n="created",f="updated",i="deleted",u="unchanged",o="moved";function c(e,t){if(e===t)return u;if(e!==t&&"undefined"!==typeof e&&"undefined"!==typeof t)return f;if("undefined"==typeof e)return n;if("undefined"==typeof t)return i;return f}function a(e){return"[object Function]"==={}.toString.apply(e)}function p(e){return"[object Array]"==={}.toString.apply(e)}function y(e){return"[object Object]"==={}.toString.apply(e)}function d(e){return!y(e)&&!p(e)}function s(e,t,r,n){for(var f=e.length;f>t;f--)e[f]=JSON.parse(JSON.stringify(e[f-1]));e[t]={},e[t][r]=n}function v(e,t){for(var r in e)if(Object.keys(e[r])[0]==t)return r;return false}function l(e,t){for(var r in e){var f=Object.keys(e[r])[0],u=t[r]&&Object.keys(t[r])[0],c=v(t,f);if(f!=u&&false===c)s(t,r,f,e[r][f]),t[r].type=i}for(var r in t){var f=Object.keys(t[r])[0],u=e[r]&&Object.keys(e[r])[0],c=v(e,f);if(f!=u&&false===c)s(e,r,f,t[r][u]),t[r].type=n;if(f!=u&&false!==c)t[r].type=o,t[r].fromRowNum=c}return b(O(e,t,0))}function O(e,t,r){if(a(e)||a(t))throw"Invalid argument. Function given, object expected.";if(d(e)||d(t))return{type:c(e,t)};var n=false,i={};for(var u in t){if(a(t[u])||t[u]&&void 0!==t[u].type)continue;if(i=O(e[u],t[u],r+1),i.type===f)if(n=true,1==r)t.type=f}if(n&&r>1)return{type:f};if(0==r)return t;return i}function b(e){var t=[];if(e.type==u)return t;for(var r in e){if(!e[r].type)continue;var n={};if(n.op=e[r].type,e[r].fromRowNum)n.fromRowNum=e[r].fromRowNum;n.rowNum=r,n.id=Object.keys(e[r])[0],t.push(n)}return t}return l(JSON.parse(JSON.stringify(t)),JSON.parse(JSON.stringify(r)))}});
//# sourceMappingURL=objectsDiff.js.map
define("Deprecated/helpers/collection-helpers",["Core/helpers/vital/objectsDiff","Core/helpers/Object/isPlainObject","Core/helpers/Array/isPlainArray"],function(e,n,r){var i={forEach:function(e,n,r){if(null===e||void 0===e||0===e.length)return;var i,t,l;if(e instanceof Array){if(e.forEach)e.forEach(n,r);else for(t=e.length,i=0;i<t;i++)if(i in e)n.call(r,e[i],i,e)}else if("length"in e&&e.length-1 in e){for(t=parseInt(e.length,10),i=0;i<t;i++)if(i in e)n.call(r,e[i],i,e)}else for(l in e)if(e.hasOwnProperty(l))n.call(r,e[l],l,e)},map:function(e,n,r){var t=[];if(null===e||void 0===e)return t;if(i.forEach(e,function(e,i,l){t[t.length]=n.call(r,e,i,l)},r),"length"in e&&e.length-1 in e)t.length=e.length;return t},filter:function(e,n,r){var t=[];if(null===e||void 0===e)return t;return i.forEach(e,function(e,i,l){if(n){if(n.call(r,e,i,l))t[t.length]=e}else if(!!e)t[t.length]=e},r),t},filterObj:function(e,n,r){var t={};if(null===e||void 0===e)return t;return i.forEach(e,function(e,i,l){if(n){if(n.call(r,e,i,l))t[i]=e}else if(e)t[i]=e},r),t},reduce:function(e,n,r,t){var l=arguments.length>2,f=r;if(null===e||void 0===e)e=[];if(i.forEach(e,function(e,r,i){if(!l)f=e,l=true;else f=n.call(t,f,e,r,i)}),!l)throw new TypeError("Reduce of empty array with no initial value");return f},isEqualValues:function(e,n){if(e instanceof Array&&n instanceof Array&&e.length===n.length){for(var r=0,i=e.length;r<i;r++)if(e[r]!==n[r])return false;return true}return e===n},objectsDiff:e,countOfProperties:function(e){var n=0;if("object"!=typeof e||null==e)return 0;for(var r in e)n++;return n},pick:function(e,n){return i.reduce(n,function(n,r){if(r in e)n[r]=e[r];return n},{})},isPlainObject:n,isPlainArray:r};return i});
//# sourceMappingURL=collection-helpers.js.map
define("Core/helpers/collection-helpers",["Core/deprecated","Core/helpers/Array/uniq","Core/helpers/Object/isEqual","Core/helpers/Object/find","Core/helpers/Object/findKey","Core/helpers/Array/findIndex","Core/helpers/Array/flatten","Deprecated/helpers/collection-helpers"],function(e,r,i,l,t,a,o,s){var c=e.callNextWrapper,n=function(r,i){return function(){e.showInfoLog("Хелпер Core/helpers/collection-helpers::"+r+" помечен как deprecated и будет удален в 3.18."+(i?" Подключите явно "+i+", чтобы им пользоваться":""))}};return{forEach:c(s.forEach,n("forEach")),map:c(s.map,n("map")),uniqueArray:c(r,n("uniqueArray","Core/helpers/Array/uniq")),filter:c(s.filter,n("filter")),filterObj:c(s.filterObj,n("filterObj")),find:c(l,n("find","Core/helpers/Object/find")),findIdx:c(function(e,r,i,l){if(void 0===l)l=-1;if(Array.isArray(e)){var o=a.call(this,e,r,i);return-1===o?l:o}return t.call(this,e,r,i,l)},n("findIdx","Core/helpers/Object/findKey или Core/helpers/Array/findIndex")),flatten:o,reduce:c(s.reduce,n("reduce")),isEqualObject:c(i,n("isEqualObject","Core/helpers/Object/isEqual")),objectsDiff:c(s.objectsDiff,n("objectsDiff")),countOfProperties:c(s.countOfProperties,n("countOfProperties")),pick:c(s.pick,n("pick")),isEqualValues:c(s.isEqualValues,n("isEqualValues","Array.prototype.some или Core/helpers/Object/isEqual")),isPlainObject:s.isPlainObject,isPlainArray:s.isPlainArray}});
//# sourceMappingURL=collection-helpers.js.map
define("Core/helpers/Object/getPropertyType",["Core/helpers/getType"],function(e){return function r(t,n){var o=t&&"object"===typeof t&&n in t?t[n]:void 0;return e(o)}});
//# sourceMappingURL=getPropertyType.js.map
define("Deprecated/Record",["Core/constants","Core/core-functions","Core/Context","Core/Deferred","Deprecated/Enum","Core/TimeInterval","Core/EventBus","Deprecated/RecordTypes","Deprecated/SerializatorSBIS","Core/core-instance","Core/helpers/Object/getPropertyType","Core/helpers/Object/sortedPairs","Core/helpers/Array/clone","Core/helpers/collection-helpers","Deprecated/helpers/additional-helpers","Core/helpers/string-helpers","Deprecated/helpers/string-helpers","Deprecated/Adapter","Deprecated/Parser","Deprecated/Reader"],function(e,t,r,n,i,s,o,l,a,u,h,c,f,d,p,_,g){var y;function m(e,t,r){if(t.n in e.changed)e.s.push(t),e.d.push(this._row[r]);return e}function C(e,t){if(e===t)return true;if(e instanceof Array&&t instanceof Array)if(e.length===t.length){for(var r=0;r<e.length;++r)if(e[r]!==t[r])return false;return true}if(e instanceof i||t instanceof i){if(e instanceof i&&t instanceof i)return e.equals(t);return(e instanceof i?e.getCurrentValue():e)===(t instanceof i?t.getCurrentValue():t)}if(e&&e.equals&&"function"==typeof e.equals)return e.equals(t);return false}return y=function(){function y(e){if(this._objectName="",this._primaryColumnName="",this._row=[],this._colDef=[],this._parentRecordSet=null,this._pkValue=void 0,this._columnIndex={},this._changedFields=[],this._forGetValues=[],this._settedValues=[],this._columnNames=null,this._hasSetted=false,this._eventBusChannel=false,this._originalRow=false,e){if(1==Object.keys(e).length&&e.primaryColumnName)return void(this._primaryColumnName=e.primaryColumnName);if(this._prepareData(e.row),this._colDef=e.colDef,this._parentRecordSet=e.parentRecordSet,this._pkValue=e.pkValue,this._parentId=e.parentId,this._objectName=e.objectName,!e.colDef||"[object Object]"==Object.prototype.toString.call(e.colDef)){var t=a.serializeData(this._row,this._colDef);this._colDef=t.s,this._row=[];var r="",n=this._colDef.length,i=0;while(i<n)r=this._colDef[i].n,this._addColumnIdx(r,i),this._row.push(t.d[i]),i++}else{var s=this._colDef.length,o=0;while(o<s)this._addColumnIdx(this._colDef[o].n,o),o++}}}y.prototype._moduleName="Deprecated/Record",y.prototype._addColumnIdx=function(e,t){this._columnIndex[e]=t},y.prototype._onlyChangedFields=function(e,t,r){if(t.n in e.changed)e.s.push(t),e.d.push(this._row[r]);return e},y.prototype._addHierarchyColumnsToChanged=function(e){d.reduce(this._colDef,function(e,t){if(t.s==l.FIELD_TYPE_HIERARCHY)e[t.n]=1;return e},e)},y.prototype._addKeyColumnToChanged=function(e){var t;if(t=this._parentRecordSet&&this._parentRecordSet._pkColumnIndex||0,t<0)t=0;e[this._colDef[t].n]=1},y.prototype.toJSON=function(e){var t,r;if(this._originalRow=f(this._row),e&&(e.diffOnly||e.fields)&&this.getKey()){if(r=this.getChangedColumns(),e.fields)for(var n in r)if(r.hasOwnProperty(n))if(-1==e.fields.indexOf(n))delete r[n];if(this._addKeyColumnToChanged(r),this._addHierarchyColumnsToChanged(r),e.fields)this.prepareToSerialize(r);else this.prepareToSerialize();return t=d.reduce(this._colDef,m,{changed:r,s:[],d:[],_mustRevive:true,_type:"record",_key:this.getKey()},this),delete t.changed,this._row=this._originalRow,t}else return{s:this._colDef,d:this._prepareRawData(),_key:this.getKey(),_mustRevive:true,_type:"record"}},y.prototype.isBranch=function(){var e=this._parentRecordSet.getHierarchyField();if(e)return this.get(e+"@")},y.prototype.hasChildren=function(){var e=this._parentRecordSet.getHierarchyField();if(e)return this.get(e+"$")},y.prototype.getParentKey=function(){var e=this._parentRecordSet.getHierarchyField();if(e)return this.get(e)},y.prototype._prepareData=function(e){this._row=e},y.prototype._createOriginalRow=function(e){for(var r=[],n=0,i=e.length;n<i;n++){var s=e[n];if("function"===h(s,"valueOf"))s=s.valueOf();r[n]=s instanceof Array?t.clone(s):s}return r},y.prototype.cloneRecord=function(e){var t={row:this._prepareRawData(),colDef:this._colDef,pkValue:this._getKeyValue(),objectName:this._objectName,parentRecordSet:null};if(e||void 0===e)t.parentRecordSet=this._parentRecordSet;else t.colDef=t.colDef.slice();return new y(t)},y.prototype.addColumn=function(e,t,r,n){var i=false;if(u.instanceOfModule(this._parentRecordSet,"Deprecated/RecordSet")&&this._parentRecordSet.contains(this.getKey()))if(n)n.cols.forEach(function(e,t){var r=e.n;if(this._addColumnIdx(r,this._row.length),void 0===this._colDef[this._columnIndex[r]])this._colDef.push(e);this._row.push(n.data[t])},this),i=true;else throw new Error("Record:addColumn - "+rk("Нельзя изменять набор колонок в записи выборки"));else if(!this.hasColumn(e)){var s=a.getColumnConfigByType(e,t,r);if(false!==s)s.cols.forEach(function(e,t){this._addColumnIdx(e.n,this._row.length),this._colDef.push(e),this._row.push(s.data[t])},this),i=true}if(i)this._columnNames=null;return i},y.prototype.removeColumn=function(e,t){if(u.instanceOfModule(this._parentRecordSet,"Deprecated/RecordSet")&&true!==t&&this._parentRecordSet.contains(this.getKey()))throw new Error("Record:removeColumn - "+rk("Нельзя изменять набор колонок в записи выборки"));else if(this.hasColumn(e)){var r=this.getColumnIdx(e);for(var n in this._columnIndex)if(this._columnIndex.hasOwnProperty(n)&&this._columnIndex[n]>r)this._columnIndex[n]--;if(delete this._columnIndex[e],this._changedFields.splice(r,1),this._forGetValues.splice(r,1),this._settedValues.splice(r,1),true!==t)this._row.splice(r,1),this._colDef.splice(r,1),this._columnNames=null;return true}else return false},y.prototype.getDataRow=function(){return this.prepareToSerialize(),this._row},y.prototype.toObject=function(e){var t,r={},n=this._colDef.length,i=0;while(i<n){if(t=this._colDef[i],r[t.n]=this.get(t.n),true===e&&r[t.n]&&r[t.n].toObject)r[t.n]=r[t.n].toObject();i++}return r},y.prototype.getColumns=function(){var e=0,t;if(!this._columnNames){this._columnNames=[],t=this._colDef.length;while(e<t)this._columnNames.push(this._colDef[e].n),e++}return this._columnNames},y.prototype.toArray=function(){var e,t=[],r=this._colDef.length,n=0;while(n<r)e=this._colDef[n],t.push(this.get(e.n)),n++;return t},y.prototype.getColumnIdx=function(e){if(e in this._columnIndex)return this._columnIndex[e];else throw new TypeError("Column "+e+" is not defined")},y.prototype.getColumnType=function(e){return this._getColumnTypeByIndex(this.getColumnIdx(e))},y.prototype.getColumnDefinition=function(e){var t=this.getColumnIdx(e),r={},n;if(r["title"]=this._colDef[t].n,r["index"]=t,n=this._colDef[t].t,"object"==typeof n)switch(r["type"]=n.n,n.n){case"Флаги":case"Перечисляемое":r["s"]=n.s;break;case"Связь":r["table"]=n.t;break;case"Массив":r["arrayType"]=n.t}else if(r["type"]=n,"Иерархия"==this._colDef[t].s)r["s"]="Иерархия";return r},y.prototype.hasColumn=function(e){return e in this._columnIndex},y.prototype.getRecordSet=function(){return this._parentRecordSet},y.prototype.setRecordSet=function(e,t){if(e!=this._parentRecordSet&&t)this._colDef=this._colDef.slice();if(!this._parentRecordSet||t)this._parentRecordSet=e},y.prototype._getKeyValue=function(){if(!this._primaryColumnName)return this._pkValue;return this._row[this.getColumnIdx(this._primaryColumnName)]},y.prototype.getKey=function(){var t=this._getKeyValue();if("number"==typeof t||"string"==typeof t&&-1==t.indexOf(e.IDENTITY_SPLITTER))if(this._objectName)return t+e.IDENTITY_SPLITTER+this._objectName;return t},y.prototype.getComplexKey=function(){return g.parseComplexKey(this.getKey())},y.prototype._importValueForGet=function(e,t,r){switch(t){case l.FIELD_TYPE_DATE:case l.FIELD_TYPE_DATETIME:case l.FIELD_TYPE_TIME:var n=Date.fromSQL(e),o;switch(t){case"Дата и время":o=true;break;case"Время":o=false}return n.setSQLSerializationMode(o),n;case l.FIELD_TYPE_IDENTITY:return p.parseIdentity(e);case l.FIELD_TYPE_ENUM:return new i({availableValues:r.s,currentValue:e});case l.FIELD_TYPE_FLAGS:for(var a={},h=c(r.s),f=[],d=0,_=h.keys.length;d<_;d++)a[d]={type:"Логическое",title:h.values[d],index:h.keys[d]},f[d]=e[d];return new y({row:f,colDef:a,parentRecordSet:null,pkValue:null});case l.FIELD_TYPE_RECORD:if(null===e)return null;else if(e instanceof y)return e;else return new y({row:e.d,colDef:e.s,parentRecordSet:null,pkValue:null});case l.FIELD_TYPE_QUERY:if(null===e)return null;else if(u.instanceOfModule(e,"Deprecated/RecordSet"))return e;else return new(function(){return this||(0,eval)("this")}().requirejs("Deprecated/RecordSet"))({readerParams:{adapterType:"TransportAdapterStatic",adapterParams:{data:{d:e.d||[],s:e.s||[],r:e.r,n:e.n,p:e.p}}}});case l.FIELD_TYPE_MONEY:return void 0===e?null:e;case l.FIELD_TYPE_TIME_INTERVAL:return new s(e);default:return void 0===e?null:e}},y.prototype._importValueForSet=function(e,t,r){switch(t){case l.FIELD_TYPE_DATE:case l.FIELD_TYPE_DATETIME:case l.FIELD_TYPE_TIME:var n;switch(t){case"Дата и время":n=true;break;case"Время":n=false}return e instanceof Date?e.toSQL(n):null;case l.FIELD_TYPE_INTEGER:return"number"==typeof e?e:isNaN(parseInt(e,10))?null:parseInt(e,10);case l.FIELD_TYPE_IDENTITY:return a.serializeHierarchyIdentity(e);case l.FIELD_TYPE_ENUM:if(e instanceof i){var o=e.getCurrentValue();return null===o?null:parseInt(o,10)}else return e;case l.FIELD_TYPE_FLAGS:if(e instanceof y){for(var h={},f=e.getColumns(),d=[],p=0,g=f.length;p<g;p++)h[e.getColumnIdx(f[p])]=f[p];for(var m=c(h),C=e.toObject(),D=0,v=m.keys.length;D<v;D++)d.push(C[m.values[D]]);return d}else if(e instanceof Array)return e;else return null;case l.FIELD_TYPE_RECORD:case l.FIELD_TYPE_QUERY:if(null===e)return null;else if(e instanceof y||u.instanceOfModule(e,"Deprecated/RecordSet"))return e.toJSON();else return a.serialize(e);case l.FIELD_TYPE_STRING:return null===e?null:e+"";case l.FIELD_TYPE_LINK:return null===e?null:parseInt(e,10);case l.FIELD_TYPE_MONEY:if(r.p>3)return _.prepareMoneyByPrecision(e,r.p);else{var I=parseFloat(e);return e&&!isNaN(I)?I:e}case l.FIELD_TYPE_TIME_INTERVAL:if(null===e)return null;else if(e instanceof s)return e.toString();else return s.toString(e);default:return e}},y.prototype.getOriginal=function(e){var t=this._columnIndex[e],r,n,i;if(void 0===t)throw new TypeError("Column "+e+" is not defined");else{if(r=this._colDef[t].t,n="object"==typeof r?r.n:r,i=this._row[t],null!==i||n in{"Перечисляемое":0,"Запись":0,"Выборка":0})i=this._importValueForGet(i,n,r);return i}},y.prototype.get=function(e){var t=this._columnIndex[e],r,n,i;if(void 0===t)throw new TypeError("Column "+e+" is not defined");else{if(this._hasSetted&&void 0!==this._settedValues[t])i=this._settedValues[t];else if(void 0!==this._forGetValues[t])n="object"==typeof(r=this._colDef[t].t)?r.n:r,i=this._forGetValues[t];if(void 0===i){if(r=this._colDef[t].t,n="object"==typeof r?r.n:r,i=this._row[t],null!==i||n in{"Перечисляемое":0,"Запись":0,"Выборка":0})i=this._importValueForGet(i,n,r);this._forGetValues[t]=i}return i}},y.prototype._setField=function(e,t){var r=this._columnIndex[e],n=false;if(void 0===r)throw new TypeError("Column "+e+" is not defined");else if(void 0===t)throw new TypeError("Value for column "+e+" is not valid");else if(t&&"object"===typeof t&&"WS.Data/"===String(t._moduleName).substr(0,8))throw new TypeError("Value type for column "+e+" is not supported");else{var o=this._colDef[r].t,u="object"==typeof o?o.n:o,h,c;if(void 0===this._settedValues[r]){if(h=this._importValueForSet(t,u,o),c=this._row[r],u==l.FIELD_TYPE_ENUM){var f=this._forGetValues[r];if(f instanceof i)c=null===(f=f.getCurrentValue())?null:parseInt(f,10)}}else h=t,c=this._settedValues[r];if("Дата и время"==o||"Дата"==o||"Время"==o){if("string"==typeof h)h=Date.fromSQL(h);if("string"==typeof c)c=Date.fromSQL(c)}if(!C(h,c))n=true;if(n){switch(this._hasSetted=true,u){case l.FIELD_TYPE_TIME_INTERVAL:this._settedValues[r]=null!==t?new s(t):null;break;case l.FIELD_TYPE_MONEY:if(o.p>3)this._settedValues[r]=_.prepareMoneyByPrecision(t,o.p);else{var d=parseFloat(t);this._settedValues[r]=t&&!isNaN(d)?d:t}break;default:this._settedValues[r]=t}if(this._forGetValues[r]=void 0,this.getColumnType(this._colDef[r].n)==l.FIELD_TYPE_IDENTITY&&!(t instanceof Array))t=a.serializeHierarchyIdentity(t);this._changedFields[r]=!C(t,this._row[r])}}return n},y.prototype._setInnerField=function(e,t,r){try{var n=this.getColumnIdx(e),i=this._colDef[n].t,s="object"==typeof i?i.n:i;return t=this._importValueForSet(t,s,i),r[n]=t,true}catch(e){}return false},y.prototype._getColumnTypeByIndex=function(e){var t=this._colDef[e].t;if("string"==typeof t)return t;else return t&&t.n},y.prototype._prepareRawData=function(e){var t=this._forGetValues.length,r=0,n=this,s=f(this._row),o=function(e,t){return e=parseInt(e,10),t=parseInt(t,10),e<t?-1:1},a,h;while(r<t){if(this._forGetValues.hasOwnProperty(r))if(a=this._forGetValues[r],h=this._getColumnTypeByIndex(r),h==l.FIELD_TYPE_FLAGS&&a instanceof y)s[r]=[],Object.keys(this._colDef[r].t.s).sort(o).forEach(function(e,t){s[r][t]=a.get(n._colDef[r].t.s[e])});else if(a instanceof y||u.instanceOfModule(a,"Deprecated/RecordSet"))s[r]=a.toJSON();else if(a instanceof i){var c=a.getCurrentValue();s[r]=null===c?null:parseInt(c,10)}r++}for(r=0,t=this._colDef.length;r<t;++r)if(h=this._colDef[r].t,h===l.FIELD_TYPE_IDENTITY&&!(s[r]instanceof Array))s[r]=[s[r]];var t=this._settedValues.length,r=0;while(r<t){if(void 0!==this._settedValues[r])if(!e||void 0!==e[this._colDef[r].n])this._setInnerField(this._colDef[r].n,this._settedValues[r],s);r++}return s},y.prototype.prepareToSerialize=function(e){this._row=this._prepareRawData(e)},y.prototype._prepareChangedFields=function(){if(!this._eventBusChannel)return null;return Object.keys(this.getChangedColumns())},y.prototype._notifyFieldsChanged=function(e){if(!this._eventBusChannel)return;if(!e||!e.length)return;this._eventBusChannel.notify("onFieldChange",e)},y.prototype.subscribe=function(e,t,r){if(!this._eventBusChannel)this._eventBusChannel=o.channel(),this._eventBusChannel.publish("onFieldChange");if(void 0===r)r=this;return this._eventBusChannel.subscribe(e,t,r),this},y.prototype.unsubscribe=function(e,t,r){if(this._eventBusChannel)this._eventBusChannel.unsubscribe(e,t,r);return this},y.prototype.set=function(e,t){var r=this,n=[],i=function(e,t){if(r._setField(e,t))n.push(e)};if("object"!=typeof e)i(e,t);else for(var s in e)if(e.hasOwnProperty(s))i(s,e[s]);this._notifyFieldsChanged(n)},y.prototype.getKeyField=function(){var e;if(this._parentRecordSet)e=this._parentRecordSet.getPkColumnIndex();else e=0;return this._colDef[e].n},y.prototype.setKey=function(e,t){var r=void 0===t?this.getKeyField():this._colDef[t].n;if(r)this._setField(r,e);if(this._pkValue=e,this._parentRecordSet)this._parentRecordSet.addPkIndex(e);if(!this._objectName)this._objectName=g.parseComplexKey(e).objName},y.prototype.destroy=function(){var e=this;return this._parentRecordSet.deleteRecord([this._getKeyValue()]).addCallback(function(t){return e.commit(),t})},y.prototype.update=function(e){var t=this;if(e&&e.diffOnly&&this.getKey()&&!this.isChanged())return(new n).callback(this.getKey());return this._parentRecordSet.updateRecord(this,e).addCallback(function(r){if(e&&e.fields)t.commit.apply(t,e.fields);else t.commit();return r})},y.prototype.commit=function(){var e=arguments.length>0?false:true,t=arguments.length>0?arguments.length:this._forGetValues.length,r=0,n,i,s;if(e)this._changedFields=[];var o=function(t,r){if(void 0!==t){if("function"===h(t,"commit"))t.commit();if(n=this._colDef[r],i="string"==typeof n.t?n.t:n.t.n,!e)delete this._changedFields[r];this._row[r]=this._importValueForSet(t,i,n.t)}};while(r<t){if(e)o.apply(this,[this._forGetValues[r],r]);else s=this.getColumnIdx(arguments[r]),o.apply(this,[this._forGetValues[s],s]);r++}t=arguments.length>0?arguments.length:this._settedValues.length,r=0;while(r<t){if(e)o.apply(this,[this._settedValues[r],r]);else s=this.getColumnIdx(arguments[r]),o.apply(this,[this._settedValues[s],s]);r++}if(e)this._originalRow=void 0},y.prototype._rewriteLinkId=function(t){if(this._objectName)if(-1==(""+t).indexOf(e.IDENTITY_SPLITTER))t=t+e.IDENTITY_SPLITTER+this._objectName;return t},y.prototype.updateLink=function(e,t){var r=this;return this.readLink(this._rewriteLinkId(e),t).addCallback(function(e){return e.each(function(e,t){try{r.set(e,t)}catch(e){}}),e})},y.prototype.readLink=function(e,t){return this._parentRecordSet.readRecord(this._rewriteLinkId(e),void 0,t)},y.prototype.rollback=function(){var e=this._prepareChangedFields();if(0===arguments.length){if(this._changedFields=[],this._settedValues=[],this._forGetValues=[],this._originalRow)this._row=this._originalRow,this._originalRow=void 0}else{var t=Array.prototype.slice.call(arguments),r,n,i;for(n=0;n<t.length;n++)r=this.getColumnIdx(t[n]),delete this._changedFields[r],delete this._settedValues[r],delete this._forGetValues[r];e=d.filter(e,function(e){return-1!==t.indexOf(e)})}this._notifyFieldsChanged(e)},y.prototype._reduceChanged=function(e,t,r){if(!!t)e[this._colDef[r].n]=1;return e},y.prototype._reduceComplex=function(e,t,r){if(t&&"function"==typeof t.isChanged&&t.isChanged())e[this._colDef[r].n]=1;return e},y.prototype.getChangedColumns=function(){var e={};return d.reduce(this._changedFields,this._reduceChanged,e,this),d.reduce(this._settedValues,this._reduceComplex,e,this),d.reduce(this._forGetValues,this._reduceComplex,e,this),e},y.prototype.isChanged=function(e){var t=function(e){if(e&&"function"==typeof e.isChanged&&e.isChanged())return true;return false};if(void 0===e){for(var r=0,n=this._changedFields.length;r<n;r++)if(this._changedFields[r])return true;var i=function(e){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return true;return false};if(i(this._settedValues))return true;if(i(this._forGetValues))return true;return false}else{var s=this.getColumnIdx(e);if(true===this._changedFields[s])return true;if(t(this._settedValues[s]))return true;if(t(this._forGetValues[s]))return true;else return false}},y.prototype.setChanged=function(e){var t;if(void 0===e){for(var r in this._columnIndex)if(this._columnIndex.hasOwnProperty(r))t=this.getColumnIdx(r),this._changedFields[t]=true}else t=this.getColumnIdx(e),this._changedFields[t]=true},y.prototype.each=function(e){for(var t=this._colDef.length,r,n=0;n<t;n++)if(n in this._colDef)if(r=this._colDef[n].n,false===e.apply(this,[r,this.get(r)]))return},y.prototype.equals=function(e){if(e instanceof y){if(this.getColumns().length!==e.getColumns().length)return false;var t=true;return this.each(function(r,n){if(!e.hasColumn(r))return t=false;if(n&&n.equals){if(!n.equals(e.get(r)))return t=false}else if(n!==e.get(r))return t=false}),t}else return false};for(var D in l)if(l.hasOwnProperty(D))y[D]=l[D];var v=function(e,t){this.record=e,this.fieldName=t},I={name:"RecordFieldType",is:function(e){return e instanceof y},get:function(e,t){var n=r.NonExistentValue,i,s,o,l;if(0!==t.length)if(i=t[0],e.hasColumn(i))o=e.get(i),s=(l=r.getValueType(o)).get(o,t.slice(1));else s=n;else s=e;return s},setWillChange:function(e,t,n){var i,s,o,l;if(0!==t.length){if(o=t[0],i=e.hasColumn(o),i)s=e.get(o),i=(l=r.getValueType(s)).setWillChange(s,t.slice(1),n)}else i=!I.is(n)||!e.equals(n);return i},set:function(e,t,n){var i,s,o,l;if(0!==t.length){if(o=t[0],e.hasColumn(o))if(1===t.length)e.set(o,n);else s=e.get(o),(l=r.getValueType(s)).set(s,t.slice(1),n);i=e}else i=n;return i},remove:function(e,t){var n,s,o,a,u,h,c,f=e;if(c=0!==t.length,c)if(n=t[0],c=f.hasColumn(n),c)if(s=f.get(n),c=1===t.length,c){if(s instanceof i){if(c=null!==s.getCurrentValue(),c)s.set(null),f.set(n,null)}else if(f.getColumnType(n)===l.FIELD_TYPE_FLAGS){for(a=[],h=u=Array.isArray(s)?s.length:s.getColumns().length;h>0;--h)a.push(null);f.set(n,a)}else if(c=null!==s,c)f.set(n,null)}else c=(o=r.getValueType(s)).remove(s,t.slice(1)).changed;return{value:f,changed:c}},toJSON:function(e,t){return t?e.toObject():e},subscribe:function(e,t){return e.subscribe("onFieldChange",t),function(){e.unsubscribe("onFieldChange",t)}}},E={name:"RecordFieldProxyType",is:function(e){return e instanceof v},get:function(e,t){var r=[e.fieldName].concat(t);return I.get(e.record,r)},setWillChange:function(e,t,r){var n=[e.fieldName].concat(t);return I.setWillChange(e.record,n,r)},set:function(e,t,r){var n=[e.fieldName].concat(t);return I.set(e.record,n,r),e},isProxy:true,clear:function(e){return{changed:I.remove(e.record,[e.fieldName]).changed,value:e}},remove:function(e,t){var r=[e.fieldName].concat(t);return{value:e,changed:I.remove(e.record,r).changed}},toJSON:function(e,t){var n=E.get(e,[]);return r.getValueType(n).toJSON(n,t)},subscribe:function(e,t){function r(r,n){if(-1!==n.indexOf(e.fieldName))t()}return e.record.subscribe("onFieldChange",r),function(){e.record.unsubscribe("onFieldChange",r)}}};return r.registerFieldType(E),r.registerFieldType(I),r.RecordFieldProxy=v,y}(),y});
//# sourceMappingURL=Record.js.map
define("Deprecated/OrderedHashMap",[],function(){"use strict";function e(){this._keys=[],this._values=[],this._reading=false,this._helperHash={}}return e.prototype.put=function(e,t){if(this._checkConcurent(),e+="",!this.contains(e))return this._keys.push(e),this._values.push(t),this._helperHash[e]=null,true;return false},e.prototype.insert=function(e,t,s){if(this._checkConcurent(),e+="",!this.contains(e)){var r;if(void 0!==s){if(s+="",!this.contains(s))return false;r=this._keys.indexOf(s)+1}else r=0;return this._keys.splice(r,0,e),this._values.splice(r,0,t),this._helperHash[e]=null,true}return false},e.prototype.get=function(e){var t=this._getKeyIndex(e);return-1==t?void 0:this._values[t]},e.prototype.remove=function(e){this._checkConcurent();var t=this._getKeyIndex(e);if(-1!==t)return this._keys.splice(t,1),this._values.splice(t,1),this._helperHash[e]=void 0,true;return false},e.prototype.removeAll=function(e){if(e instanceof Array){for(var t=true,s=0,r=e.length;s<r;s++)t&=this.remove(e[s]);return!!t}return false},e.prototype.each=function(e){this._reading=true;try{for(var t=0,s=this._keys.length;t<s;t++)if(false===e.apply(this,[this._keys[t],this._values[t]]))break}finally{this._reading=false}},e.prototype.clear=function(){this._checkConcurent(),this._keys=[],this._values=[],this._helperHash={}},e.prototype.destroy=function(){this._keys=null,this._values=null,this._helperHash=null},e.prototype.contains=function(e){return void 0!==this._helperHash[e]},e.prototype._checkConcurent=function(){if(this._reading)throw new ReferenceError(rk("Конкурентная модификация объекта. Попытка изменения при переборе"))},e.prototype._getKeyIndex=function(e){return this._keys.indexOf(e+"")},e});
//# sourceMappingURL=OrderedHashMap.js.map
define("Deprecated/RecordSet",["require","Core/Abstract","Core/Context","Core/Deferred","Core/ParallelDeferred","Core/core-functions","Core/IoC","Core/TimeInterval","Deprecated/OrderedHashMap","Deprecated/RecordTypes","Deprecated/SerializatorSBIS","Core/helpers/vital/objectsDiff","Core/helpers/Object/isEmpty","Core/helpers/Object/sortedPairs","Core/helpers/Array/clone","Core/helpers/collection-helpers","Core/helpers/getType","Deprecated/helpers/additional-helpers","Deprecated/Record"],function(e,t,i,r,n,s,a,o,h,d,l,u,c,_,f,p,g,m){var v;v=t.extend({_moduleName:"Deprecated/RecordSet",$protected:{_data:[],_columns:[],_way:null,_results:null,_requestBegin:0,_timeElapsed:0,_dataIterator:-1,_pkIndex:{},_pkColumnIndex:0,_columnsParsed:false,_lastError:false,_options:{context:"",filterParams:{},requiredParams:[],readerType:"ReaderUnifiedSBIS",readerParams:{},firstRequest:true,usePages:"",pageNum:0,rowsPerPage:2,sorting:null,waitForPrevQuery:false,hierarchyField:""},_parsedColumns:void 0,_columnIndex:{},_childRecordsMap:[],_reader:null,_hasNextPage:0,_pageNum:0,_usePages:"",_sorting:null,_loaded:true,_queryStack:[],_initialFilter:{},_currentFilter:{},_loadingId:void 0,_level:{},_newData:void 0,_loadExpanded:false,_tree:null,_shadowed:false,_treeMap:null,_loadingInfo:null,_isEmptyTable:false,_isChanged:false,_maxKey:0,_snapShotColumns:[],_snapShot:[]},$constructor:function(){if(this._pageNum=this._options.pageNum,this._usePages=this._options.usePages,this._options.rowsPerPage=parseInt(this._options.rowsPerPage,10),this._sorting=this._options.sorting,this._initialFilter=this._prepareFilter(this._options.filterParams),this._publish("onBeforeLoad","onAfterLoad","onRecordUpdated","onRecordDeleted","onAbort","onPageChange","onShadowLoad"),this._options.filterParams=this._options.filterParams||{},this._clearTreeMap(),""!==this._options.readerType&&this._options.firstRequest)this._beginLoad();if(!(this._options.context instanceof i))this._options.context=i.global},clone:function(){var e=JSON.parse(JSON.stringify(this.toJSON()));return new v({readerType:"ReaderSBIS",readerParams:{adapterType:"TransportAdapterStatic",adapterParams:{data:e}}})},getPkColumnType:function(){if(this._columns[this._pkColumnIndex])return this._columns[this._pkColumnIndex].t;return""},getPkColumnName:function(){var e=this._columns[this._pkColumnIndex];if(e)return e.n;return""},getLinkedObjectName:function(){return this._options.readerParams.linkedObject},toJSON:function(){return{s:this.getColumnsForSerialize(),d:this.getDataForSerialize(),_type:"recordset",_mustRevive:true}},_onNewData:function(e,t){if(t instanceof Array&&t.length>0&&this._columns.length>0){var i=t[0]instanceof Array?t[0].length:void 0;if(i!==this._columns.length)throw new Error("Columns count of the income data ("+i+") is not equal to the columns count of the existing scheme ("+this._columns.length+")")}this._childRecordsMap=[],this._newData=t},_getSnapShot:function(t){if(!this._snapShotColumns.length)return false;var i=this,r=[];return t.forEach(function(t){var n=t.get(t.getKeyField()),s={};s[n]={},i._snapShotColumns.forEach(function(i){if(t.hasColumn(i)){var r=t.get(i);if(r instanceof e("Deprecated/Record")||r instanceof v)r=JSON.stringify(r.toJSON());s[n][i]=r}}),r.push(s)}),r},getSnapColumns:function(e){var t=this;this._snapShotColumns=[];for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];r.title&&t._snapShotColumns.push(r.title)}},_compareSnapColumns:function(e){if(e=p.map(e,function(e){return e.title}),this._snapShotColumns.length!==e.length)return false;for(var t=0,i=e.length;t<i;t++)if(e.indexOf(this._snapShotColumns[t])<0)return false;return true},storeSnapShot:function(e){e&&this.getSnapColumns(e),this._snapShot=this._getSnapShot(this.getRecords())},checkSnapShot:function(e){var t=[];if(!this._compareSnapColumns(this.getColumns()))return false;return t=this._getSnapShot(e||this.getRecords()),t?!!u&&!!this._snapShot.length&&u(this._snapShot,t):false},filter:function(e){this._newData=[],this.each(function(t){if(e(t))this._newData.push(t.getDataRow())}),this._clearTreeMap(),this._onComplete({},true,false,false,false)},_clearTreeMap:function(){this._treeMap=new h,this._tree=new h},getContext:function(){return this._options.context},setContext:function(e){this._options.context=e},reload:function(){var e=this._createLoadingInfo();return this._beginLoad(void 0,void 0,e),e.deferred},setSource:function(e,t,i,r){return this._options.readerType=e,this._options.readerParams=t,this._options.filterParams=i,this._reader=null,this._processLoad(void 0,false===r,true)},getSource:function(){return{readerType:this._options.readerType,readerParams:this._options.readerParams,filterParams:this._options.filterParams}},_createLoadingInfo:function(e){return{options:e,deferred:new r({cancelCallback:this.abort.bind(this,false)})}},setQuery:function(e,t,i,r){var n=this._prepareFilter(e),a=s.merge({},this._options.filterParams);if(this._options.filterParams=s.merge({},n),a)for(var o in n)if(n.hasOwnProperty(o))if(null!==a[o]&&"object"===typeof a[o]&&"fieldName"in a[o])this._options.filterParams[o]=a[o];if(r)this._currentFilter=n;return this._processLoad(n,r,t,i)},_processLoad:function(e,t,i,n){var s;if(t)return(new r).callback();else return s=this._createLoadingInfo(n),this._beginLoad(e,i,s),s.deferred},resetFilter:function(e,t){if(this._options.filterParams=e||{},this._options.requiredParams.length>0)for(var i=0;i<this._options.requiredParams.length;i++)if(this._options.requiredParams.hasOwnProperty(i))this._options.filterParams[this._options.requiredParams[i]]=this._initialFilter[this._options.requiredParams[i]];return this._currentFilter=s.merge({},this._options.filterParams),this._processLoad(void 0,t,true)},getQuery:function(){return this._currentFilter},getUpdatedQuery:function(e){var t=s.merge({},this._options.filterParams);for(var i in e){if(!e.hasOwnProperty(i))continue;if("function"===typeof e[i]||e[i]instanceof Object&&void 0!==e[i]["fieldName"])t[i]=e[i];else delete t[i]}return this._prepareFilter(t)},_prepareFilter:function(e,t,i){var r={},n=e||{},s={},a=this._options.requiredParams.length,o,h,d;for(h=0;h<a;h++)if(d=this._options.requiredParams[h],r[d]=true,!(d in n)&&!t)n[d]=this._initialFilter[d];for(var l in n)if(o=void 0,n.hasOwnProperty(l)){if(null!==n[l]&&"object"===typeof n[l]&&"fieldName"in n[l]){if(void 0!==this._options.context.getValue&&!i)o=this._options.context.getValue(n[l].fieldName)}else if("function"===typeof n[l]){if(!i)o=n[l].apply(this,[this._options.context,l])}else o=n[l];if(void 0!==o)s[l]=o;else if(true===r[l]&&!t)s[l]=this._initialFilter[l]}if(!t){if(this._usePages)if(s["pageNum"]=this._pageNum,s["pageCount"]=this._options.rowsPerPage,-1===this._pageNum)s["usePages"]="full";else s["usePages"]=this._usePages;else delete s["pageNum"],delete s["pageCount"],delete s["usePages"];if(this._sorting)s["sorting"]=this._sorting}return s},prepareFilter:function(e,t){return this._prepareFilter(e,t)},_beginLoad:function(e,t,i,r){var n=this;if(!this._loaded)if(this._options.waitForPrevQuery||true===r)return void this._queryStack.push([this._prepareFilter(this._options.filterParams),i]);else this.getReader().abort();var s=this._prepareFilter(e?e:this._options.filterParams);if(this._shadowed=s["shadowed"],!this._shadowed)this._notify("onBeforeLoad",s,i&&i.options);if(this._loaded=false,this._newData=[],this._options.hierarchyField){if(this._loadingId=s[this._options.hierarchyField],!(this._loadingId instanceof Array))this._loadingId=[this._loadingId]}else this._loadingId=[null];if(this._loadExpanded="С разворотом"===s["Разворот"],t)this._pkIndex={},this._level={},this._data=[],this._tree.clear(),this._treeMap.clear();this._loadingInfo=i,this._currentFilter=s,this.getReader().readRecords(s,this._columnsParsed).addBoth(function(){n._loaded=true;var e=n._queryStack.shift();if(e)n._beginLoad(e[0],void 0,e[1])})},_updateNextPage:function(e,t){if(-1===this._pageNum)this._pageNum=Math.ceil(t/this._options.rowsPerPage)-1,this._hasNextPage=false;else this._hasNextPage=t},setPage:function(e,t,i){return this._pageNum=e,this._notify("onPageChange",e),this._processLoad(void 0,t,!i)},setPageSize:function(e,t){return this._options.rowsPerPage=e,this._pageNum=0,this._notify("onPageChange",0),this._processLoad(void 0,t,false)},getPageSize:function(){return this._options.rowsPerPage},setUsePages:function(e){this._pageNum=0,this._usePages=e},hasNextPage:function(e){if(!e)return this._hasNextPage;if("full"===this._usePages)return this._hasNextPage>(this._pageNum+1)*this._options.rowsPerPage;else return!!this._hasNextPage},usePaging:function(){return!!this._usePages},getPageNumber:function(){return this._pageNum},getRecords:function(){var e=[],t=this._data.length,i=0;while(i<t)e.push(this.at(i)),i++;return e},setSorting:function(e,t,i,r){return this._sorting=e||null,this._processLoad(t,r,!i)},getReader:function(){if(!this._reader){this._options.readerParams.handlers=this._getReaderHandlers();var t=e.defined("Deprecated/"+this._options.readerType)?e("Deprecated/"+this._options.readerType):null;if(t)this._reader=new t(this._options.readerParams);else throw new Error("Reader type is not specified")}return this._reader},_getReaderHandlers:function(){return{onNewRecord:this._onNewRecord.bind(this),onParseData:this._onParseData.bind(this),onWayExists:this._onWayExists.bind(this),onResults:this._onResults.bind(this),onSettingsParsed:this._onSettingsParsed.bind(this),onComplete:this._onComplete.bind(this),onNewData:this._onNewData.bind(this),onNextPageChange:this._updateNextPage.bind(this)}},getWay:function(){return this._way},getResults:function(){return this._results},_onNewRecord:function(e,t){this._newData.push(t)},_onParseData:function(e,t){this._way=null,this._results=null},_onWayExists:function(e,t){if(t.d){var i={readerType:"ReaderSBIS",readerParams:{pkColumnName:t.s[t.k||0].n,adapterType:"TransportAdapterStatic",adapterParams:{data:{s:t.s,d:t.d}}}};this._way=new v(i)}},isEmptyTable:function(){return this._isEmptyTable},_onResults:function(t,i){var r=e("Deprecated/Record");this._results=new r({colDef:i.columns,row:i.row,pkValue:null,parentRecordSet:null})},_onSettingsParsed:function(e,t,i){var r=t.length,n=0;this._columnIndex={};while(n<r)this._columnIndex[t[n].n]=n,n++;if(this._columnsParsed=r>0,this._columnsParsed&&this._data.length>0&&this._columns.length!==r)a.resolve("ILogger").log("RecordSet::_onSettingsParsed()","Columns count of the income scheme ("+r+") is not equal to the columns count of the existing scheme ("+this._columns.length+"). This will cause potential errors.");this._pkColumnIndex=i,this._columns=t},isInit:function(){return this._columnsParsed},_buildHierarchyData:function(e){var t=new h,i=[],r,n,s={},o,d=this,l={},u={},c,_=false,f={},p,g=function(e){var t=e[d.getColumnIdx(d._options.hierarchyField)];return t=m.parseIdentity(t),t},v=function(e,t){if("null"==e)e=null;if("null"==t)t=null;return e==t},y=function(e){e.each(function(e,i){if(!l[e])if(i.childs)t.put(e,[]),i.childs.each(function(i,r){if(v(g(r.record),e))t.get(e).push(r.record),s[i]=true});if(!l[e]||!d._loadExpanded)y(i.childs)})},I=function(e){for(r=0,n=e.length;r<n;++r)o=g(e[r]),t.put(o,[]),t.get(o).push(e[r]),s[e[r][d._pkColumnIndex]]=true},R=function(e,r){e.each(function(e,n){if(!s[e])return;if(n.record)if(d._shadowed)i.push(n.record);else d._pkIndex[e]=d._data.length,d._data.push(n.record);if(d._level[e]=r,!n.childs)n.childs=new h;if(!d._shadowed)d._treeMap.put(e,n.childs);if(t.contains(e)){if(!d._shadowed){if(f[e])_=true;f[e]=true;for(var a=t.get(e),o=0,l=a.length;o<l;++o){var u=a[o],c=m.parseIdentity(u[d._pkColumnIndex]),p;if(n.childs.put(c,{record:u,childs:p=new h}))d._treeMap.put(c,p);else d._treeMap.put(c,n.childs.get(c).childs)}f[e]=false}if(!_)R(n.childs,r+1)}return true})};if(this._loadingId)for(r=0,n=this._loadingId.length;r<n;++r)l[this._loadingId[r]]=true;for(y(this._tree),I(e),r=0,n=this._childRecordsMap.length;r<n;++r)if(c=this._childRecordsMap[r],c)u[c.getKey()]=c;for(this._level={},this._data=[],this._pkIndex={},this._clearTreeMap(),t.each(function(e){if(!s[e])s[e]=true,this._tree.put(e,{record:void 0,childs:new h})}.bind(this)),R(this._tree,-1),this._childRecordsMap=[],r=0,n=this._data.length;r<n;++r){if(p=this._data[r][this._pkColumnIndex],u[p])this._childRecordsMap[r]=u[p];if(this._maxKey<p)this._maxKey=p}if(_)a.resolve("ILogger").error("RecordSet","Recursive hierarchy data");return i},_onComplete:function(e,t,i,r,n,s){if(t)this._parsedColumns=void 0;var a,o=[].concat(this._newData);if(""!==this._options.hierarchyField&&!s)a=this._buildHierarchyData(this._newData);else if(this._shadowed)a=this._newData;else{this._childRecordsMap=[],this._pkIndex={},this._level={},this._data=[];for(var h=0,d=this._newData.length;h<d;++h){var l=m.parseIdentity(this._newData[h][this._pkColumnIndex]);if(this._level[l]=0,this._pkIndex[l]=this._data.length,this._data.push(this._newData[h]),l>this._maxKey)this._maxKey=l}}if(this._newData=[],!t)this._lastError=i;else this._isEmptyTable=!!(false===r);if(this.rewind(),this._shadowed)this._notify("onShadowLoad",this,t,i,a),this._shadowed=false;else{if(!n)this._notify("onAfterLoad",this,t,i,this._loadingInfo&&this._loadingInfo.options);if(this._loadingInfo&&!this._loadingInfo.deferred.isReady())if(t)this._loadingInfo.deferred.callback(o.length);else this._loadingInfo.deferred.errback(i)}},_produceRecord:function(t){if(null===t||void 0===t)return null;return new(e("Deprecated/Record"))({row:t.row,colDef:t.columns,parentRecordSet:this,pkValue:m.parseIdentity(t.row[t.pk]),objectName:t.objectName})},createRecord:function(e,t){return this.getReader().createRecord(this._prepareFilter(e),t).addCallback(this._produceRecord.bind(this))},readRecord:function(e,t,i){if(void 0===e)return a.resolve("ILogger").log("RecordSet","It is not recommended to use readRecord with id === undefined, use createRecord."),this.createRecord(t);else return this.getReader().readRecord(e,t,i).addCallback(this._produceRecord.bind(this))},copyRecord:function(e,t){try{return this.getReader().copyRecord(e,t).addCallback(this._produceRecord.bind(this))}catch(e){return r.fail(e)}},mergeRecords:function(e,t){var i=this;try{return this.getReader().mergeRecords(e,t).addCallback(function(){i.clearRecord(t)})}catch(e){return r.fail(e)}},clear:function(){this._data=[],this._newData=[],this._pkIndex=[],this._level={},this._tree.clear(),this._treeMap.clear(),this._childRecordsMap=[],this._pageNum=0,this._notify("onPageChange",0)},clearRecord:function(t){if(void 0!==this._pkIndex[t]){if(this._options.hierarchyField){var i=this.at(this._pkIndex[t]),r,n;if(i instanceof e("Deprecated/Record"))if(r=i.get(this._options.hierarchyField),n=this._treeMap.get(r),n)n.remove(t)}this._data.splice(this._pkIndex[t],1),this._childRecordsMap.splice(this._pkIndex[t],1),this._removeKeyFromIndex(t),delete this._level[t]}},clearNode:function(e){if(void 0===this._pkIndex[e])return[];var t,i,r,n;for(i=this._pkIndex[e]+1,r=this._data.length,n=this._level[e];i<r;++i){if(!this._data[i])continue;if(t=this._data[i][this._pkColumnIndex],this._level[t]>n)this._data[i]=null,this._tree.remove(t),this._treeMap.remove(t),delete this._pkIndex[t],delete this._level[t];else break}this._data=p.filter(this._data,function(e){return null!==e});var s={},a;for(i=0,r=this._childRecordsMap.length;i<r;++i)if(a=this._childRecordsMap[i],a)s[a.getKey()]=a;for(this._childRecordsMap=[],i=0,r=this._data.length;i<r;++i)if(t=this._data[i][this._pkColumnIndex],s[t])this._childRecordsMap[i]=s[t];if(this._tree.contains(e)){var o=this._tree.get(e).childs;o&&o.clear()}if(this._treeMap.contains(e))this._treeMap.get(e).clear();this._refreshPkIndex()},_refreshPkIndex:function(){var e;this._pkIndex={};for(var t=0,i=this._data.length;t<i;t++)if(e=this._data[t][this._pkColumnIndex],void 0!==e)this._pkIndex[e]=t},getRecordIndexByPrimaryKey:function(e){return this._pkIndex[e]},rewind:function(){this._dataIterator=-1},isChanged:function(){if(true===this._isChanged)return true;else{var e=false;return this.each(function(t){if(t.isChanged())return e=true,false}),e}},commit:function(){this._isChanged=false;for(var e=0,t=this._childRecordsMap.length;e<t;e++)if(void 0!==this._childRecordsMap[e]&&this._childRecordsMap[e].isChanged())this._childRecordsMap[e].commit()},next:function(){var e=this._data.length;while(++this._dataIterator<e){var t=this.at(this._dataIterator);if(t)return t}return false},at:function(t){if(void 0===this._childRecordsMap[t]){var i=this._data[t];if(i){var r=e("Deprecated/Record");this._childRecordsMap[t]=new r({row:i,colDef:this._columns,parentRecordSet:this,pkValue:this._pkColumnIndex>=0?m.parseIdentity(i[this._pkColumnIndex]):null})}else if(t<0||t>=this._data.length)return;else throw new Error("No record at index "+t)}return this._childRecordsMap[t]},each:function(e){this.rewind();var t,i=0;while(false!==(t=this.next()))if(false===e.apply(this,[t,i++]))return},getElapsedTime:function(){return 0},getBeginTime:function(){return new Date},getColumns:function(){if(c(this._parsedColumns||{})){var e=this.getReader().getParser();this._parsedColumns=e.getParsedColumns(this._columns)}return this._parsedColumns},hasColumn:function(e){return e in this.getColumns()},setColumns:function(e){if("[object Object]"==Object.prototype.toString.call(e))this._columns=l.serializeCols(e);else this._columns=e;var t=this._columns.length,i=0;this._columnIndex={};while(i<t)this._columnIndex[this._columns[i].n]=i,i++;this._parsedColumns={}},updateRecord:function(e,t){var i=e.getKey(),r=this;return this.getReader().updateRecord(e,t).addCallback(function(t){if(null!==t&&null===i)e.setKey(t,r._pkColumnIndex);return r._isChanged=true,r._notify("onRecordUpdated",e),t})},deleteRecord:function(e){var t=this;try{var i=t.contains(e)?t.getRecordByPrimaryKey(e):false,n=function(e){t.clearRecord(e),t._isChanged=true},s=function(){if("array"===g(e))e.forEach(function(e){n(e)});else n(e);t._notify("onRecordDeleted",e,i)};if("array"===g(e)&&e.indexOf(null)>-1)if(e=e.filter(function(e){return null!==e}),!e.length)e=null;if(null!==e)return this.getReader().deleteRecord(e).addCallback(s);else return s(),(new r).callback()}catch(e){return r.fail(e)}},deleteRecords:function(e){for(var t=new n,i=0,r=e.length;i<r;++i)t.push(this.deleteRecord(e[i]));return t.done().getResult()},deleteRecordsByFilter:function(e,t){var i=this;return this.getReader().deleteRecordsByFilter(e,t).addCallback(function(){i.clear(),i._isChanged=true,i._notify("onRecordDeleted",null,[])})},_removeKeyFromIndex:function(e){var t=this._pkIndex[e];delete this._pkIndex[e];for(var i in this._pkIndex)if(this._pkIndex.hasOwnProperty(i)&&this._pkIndex[i]>t)this._pkIndex[i]--},getRecordCount:function(){for(var e=0,t=this._data.length-1;t>=0;--t)if(this._data[t])++e;return e},getLastError:function(){return this._lastError},getRecordByPrimaryKey:function(e){if(e in this._pkIndex)return this.at(this._pkIndex[e]);throw new Error("Record with primary key "+e+" is not found")},addPkIndex:function(e){this._pkIndex[e]=this._data.length-1},getPkColumnIndex:function(){return this._pkColumnIndex},getColumnIdx:function(e){if(e in this._columnIndex)return this._columnIndex[e];else throw new TypeError("Column "+e+" is not defined")},getDataForSerialize:function(){for(var e=f(this._data),t=0,i=this._childRecordsMap.length;t<i;t++)if(void 0!==this._childRecordsMap[t])e[t]=this._childRecordsMap[t].toJSON().d;return e},getColumnsForSerialize:function(){return this._columns},abort:function(e){if(this.getReader().abort(),e)this._queryStack.length=0,this._loaded=true,this._loadingInfo=void 0;this._notify("onAbort")},contains:function(e){return void 0!==this._pkIndex[e]},loadNode:function(e,t,i,r,n,s,a,o){if(this._options.hierarchyField)if(!a)this._options.filterParams[this._options.hierarchyField]=e;var h=this._prepareFilter(this._options.filterParams);if(this._pageNum=i?i:0,this._notify("onPageChange",this._pageNum),this._options.hierarchyField)h["Разворот"]=r?"С разворотом":"Без разворота";h["shadowed"]=n;var d=this._createLoadingInfo(s);return this._beginLoad(h,t,d,o),d.deferred},setCurrentNode:function(e){var t=this._options.hierarchyField;if(t)this._options.filterParams[t]=e},getLoadingId:function(){if(this._loadingId instanceof Array&&1===this._loadingId.length)return this._loadingId[0];return this._loadingId},getRecordLevel:function(e){return this._level[e]},getHierarchyField:function(){return this._options.hierarchyField},setHierarchyField:function(e){if(this._options.hierarchyField!==e)if(this._options.hierarchyField=e,e)this._buildHierarchyData(this._data)},_importRecord:function(e){var t=false,i=e.getColumns(),r=this.getColumns(),n=[],s=i.indexOf("ctid"),a,o,h,d;for(var l in r)if(r.hasOwnProperty(l))n[r[l].index]=l;if(-1!==s)i.splice(s,1);if(d=i.length,n.length===d){for(var u=0;u<d;u++)if(o=i[u],h=r[o],a=e.getColumnDefinition(o),!h||h.type!==a.type||h.index!==a.index){t=true;break}}else t=true;e.setRecordSet(this,true);var c=e.getKey();if(!c&&0!==c)e.setKey(++this._maxKey,this._pkColumnIndex);if(true===t)throw new TypeError("RecordSet:appendRecord - "+rk("передана запись формата, отличного от формата набора данных. Возможны проблемы в работе с этим набором записей"))},appendRecord:function(t,i,r){var n=this._columns,s={},o,h=[],d=n.length,l,u=this._data.length,c=e("Deprecated/Record");if(t instanceof c)l=t,this._importRecord(l),h=l.getDataRow(),this._childRecordsMap[u]=l;else{a.resolve("ILogger").log("RecordSet:appendRecord","Deprecated call of method with arguments type Object. Use Deprecated/Record"),h=[];for(var _=0;_<d;_++)if(s=n[_],o="string"==typeof s.t?s.t:s.t.n,s.n in t)h.push(this._importValueForSet(t[s.n],o));else h.push(null);l=new c({colDef:n,row:h,pkValue:m.parseIdentity(h[this._pkColumnIndex]),parentRecordSet:this})}if(this._pkIndex[l.getKey()]=u,null!==l.getKey()&&""!==this._options.hierarchyField){var p=l.get(this._options.hierarchyField),g=this._level[p];this._level[l.getKey()]=g?g+1:1,this._newData=f(this._data),this._newData.push(h),this._onComplete({},true,void 0,void 0,i,r)}else if(this._data.push(h),!i)this._notify("onAfterLoad",this,true);return l},appendRecords:function(e,t,i){for(var r=0,n=e.length;r<n;r++)this.appendRecord(e[r],t||r<n-1,!!i);if(!i&&this._options.hierarchyField)this._buildHierarchyData(this._data)},buildHierarchy:function(){if(this._options.hierarchyField)this._buildHierarchyData(this._data)},insertAfter:function(t,i,r){var n=this.contains(t)?this._pkIndex[t]+1:0,s=i.getKey(),a=[];if(i instanceof e("Deprecated/Record"))a=i.getDataRow();else throw new Error(rk("Не передана запись для вставки в набор данных!"));this._data.splice(n,0,a);for(var o=this._childRecordsMap.length;o>=n;o--)if(void 0!==this._childRecordsMap[o])this._childRecordsMap[o+1]=this._childRecordsMap[o];this._childRecordsMap[n]=i;for(var d in this._pkIndex)if(this._pkIndex.hasOwnProperty(d)&&this._pkIndex[d]>=n)++this._pkIndex[d];if(this._pkIndex[s]=n,i.setRecordSet(this,true),this._options.hierarchyField){var l=this._options.hierarchyField,u=i.get(l),c;if(this._treeMap.contains(u))c=this._treeMap.get(u);else c=new h,this._treeMap.put(u,c);var _=t,f;while(this.contains(_)&&(f=this.getRecordByPrimaryKey(_))&&f.get(l)!=u)_=f.get(l);if(!this.contains(_))_=void 0;c.insert(s,{record:a,childs:new h},_)}if(!r)this._notify("onAfterLoad",this,true);return i},_importValueForSet:function(t,i){var r=e("Deprecated/Record");switch(i){case d.FIELD_TYPE_DATE:case d.FIELD_TYPE_DATETIME:case d.FIELD_TYPE_TIME:var n;switch(i){case"Дата и время":n=true;break;case"Время":n=false}return t instanceof Date?t.toSQL(n):null;case d.FIELD_TYPE_INTEGER:return"number"==typeof t?t:isNaN(parseInt(t,10))?null:parseInt(t,10);case d.FIELD_TYPE_IDENTITY:return l.serializeHierarchyIdentity(t);case d.FIELD_TYPE_ENUM:var s=t.getCurrentValue();return null===s?null:parseInt(s,10);case d.FIELD_TYPE_FLAGS:if(t instanceof r){for(var a={},h=t.getColumns(),u=[],c=0,f=h.length;c<f;c++)a[t.getColumnIdx(h[c])]=h[c];for(var p=_(a),g=t.toObject(),m=0,y=p.keys.length;m<y;m++)u.push(g[p.values[m]]);return u}else if(t instanceof Array)return t;else return null;case d.FIELD_TYPE_RECORD:case d.FIELD_TYPE_QUERY:if(null===t)return null;else if(t instanceof r||t instanceof v)return t.toJSON();else return l.serialize(t);case d.FIELD_TYPE_STRING:return null===t?null:t+"";case d.FIELD_TYPE_LINK:return null===t?null:parseInt(t,10);case d.FIELD_TYPE_TIME_INTERVAL:if(t instanceof o)return t.toString();else return o.toString(t);default:return t}},updatePages:function(){for(var e=0,t=0,i=this._data.length;t<i;++t)if(this._data[t])++e;var n;if(0===e&&this._pageNum>0)n=this.setPage(this._pageNum-1,true,true);else n=(new r).callback();return n},moveRecord:function(e,t,i){var r=this._treeMap.get(e),n=[],s=[[],[]],a=0,o;if(r){var d,l=function(e,t){n.push([e,r.get(e)]),n.push([t,r.get(t)])};r.each(function(e,r){if(i){if(0===a&&e==t&&void 0!==d)s[0].pop(),l(e,d),++a;else s[a].push([e,r]);d=e}else if(e==t)d=e;else if(0===a&&void 0!==d)l(e,d),++a;else s[a].push([e,r])}),this._treeMap.put(e,new h);for(var u=0;u<2;++u){for(var c=0,_=s[u].length;c<_;++c)(o=this._treeMap.get(e)).put.apply(o,s[u][c]);if(0===u)for(var f=0;f<2;++f)(o=this._treeMap.get(e)).put.apply(o,n[f])}}},checkHierColumn:function(e){if(void 0!==this._loadingId){var t=this._columnIndex[e];if(void 0===t)return false;return this._columns[t].s&&"Иерархия"===this._columns[t].s}return true},updateInitialParameter:function(e,t){this._options.filterParams[e]=this._initialFilter[e]=t},isLoaded:function(){return this._loaded},recordChilds:function(e){var t=[],i=this._treeMap.get(e);if(i)i.each(function(e){t.push(e)});return t},addColumn:function(e,t,i){if(!(e in this._columnIndex)){var r,n,s=l.getColumnConfigByType(e,t,i);if(false!==s){var a,o;for(s.cols.forEach(function(e){this._columnIndex[e.n]=this._columns.length,this._columns.push(e)},this),r=0,n=this._data.length;r<n;r++)if(void 0!==this._childRecordsMap[r])this._childRecordsMap[r].addColumn(e,t,i,s);else for(a=0,o=s.cols.length;a<o;a++)if(void 0!==this._data[r])this._data[r].push(s.data[a]);return this._parsedColumns={},true}}return false},removeColumn:function(e){if(e in this._columnIndex){var t=this.getColumnIdx(e),i,r;for(var n in this._columnIndex)if(this._columnIndex.hasOwnProperty(n)&&this._columnIndex[n]>t)this._columnIndex[n]--;for(delete this._columnIndex[e],i=0,r=this._data.length;i<r;i++)if(void 0!==this._data[i])this._data[i].splice(t,1);for(this._columns.splice(t,1),i=0,r=this._childRecordsMap.length;i<r;i++)if(void 0!==this._childRecordsMap[i])this._childRecordsMap[i].removeColumn(e,true);return this._parsedColumns={},true}else return false},getLoadedRoots:function(){var e=[];return this._tree.each(function(t){e.push(t)}),e}});function y(e){var t=parseInt(e,10);if(isNaN(t))t=-1;return t}var I={name:"RecordSetFieldType",is:function(e){return e instanceof v},get:function(e,t){var r=i.NonExistentValue,n=e,s=n.getRecordCount(),a,o,h,d,l;if(0!==t.length)if(d=t[0],a=y(d),a>=0&&a<s)h=n.at(a),o=(l=i.getValueType(h)).get(h,t.slice(1));else o=r;else o=e;return o},setWillChange:function(e,t,r){var n=e,s=n.getRecordCount(),a,o,h,d,l;if(0!==t.length){if(d=t[0],o=y(d),a=t.length>1&&o>=0&&o<s,a)h=n.at(o),a=(l=i.getValueType(h)).setWillChange(h,t.slice(1))}else a=e!==r;return a},set:function(e,t,r){var n=e,s=n.getRecordCount(),a,o,h,d,l,u;if(0!==t.length){if(l=t[0],h=y(l),o=h>=0&&h<s,o)if(1!==t.length)d=n.at(h),(u=i.getValueType(d)).set(d,t.slice(1),r);a=e}else a=r;return a},remove:function(e,t){var r,n=e,s=n.getRecordCount(),a,o,h,d;if(r=0!==t.length,r)if(h=t[0],a=y(h),r=t.length>1&&a>=0&&a<s,r)o=n.at(a),r=(d=i.getValueType(o)).remove(o,t.slice(1)).changed;return{value:e,changed:r}},toJSON:function(e,t){return t?e.toJSON():e},subscribe:function(e,t){function i(i){e.subscribe(i,t)}function r(i){e.unsubscribe(i,t)}return i("onRecordUpdated"),i("onRecordDeleted"),i("onPageChange"),i("onAfterLoad"),i("onShadowLoad"),function(){r("onRecordUpdated"),r("onRecordDeleted"),r("onPageChange"),r("onAfterLoad"),r("onShadowLoad")}}};return i.registerFieldType(I),v});
//# sourceMappingURL=RecordSet.js.map
define("Deprecated/RecordSetStatic",["require","Core/core-functions","Core/Deferred","Core/IoC","Deprecated/RecordSet","Deprecated/RecordTypes","Core/helpers/collection-helpers","Core/helpers/getType"],function(e,t,i,n,a,s,r,h){var d;return d=a.extend({$protected:{_options:{defaultColumns:{},records:[],filter:void 0,resultType:"foldersAndLeaves",bigCalcSum:void 0},_hiddenData:[],_expand:false,_parentNode:null,_pocketAppending:false,_typeDetailesName:{"Флаги":"s","Перечисляемое":"s","Связь":"table","Массив":"arrayType"}},$constructor:function(){this._initOptions(),this._initRecords(),this._startLoad()},addColumn:function(e,t,i){var n={cols:[{n:e,t:t}],data:[null]};if(this._columns[e]={title:e,type:t,index:Object.keys(this._columns).length},!!i&&this._typeDetailesName[t])this._columns[e][this._typeDetailesName[t]]=i,n[this._typeDetailesName[t]]=i;for(var a=0,s=this._hiddenData.length;a<s;a++)this._hiddenData[a].addColumn(e,t,i,n)},removeColumn:function(e){delete this._columns[e];for(var t=0,i=this._hiddenData.length;t<i;t++)this._hiddenData[t].removeColumn(e)},filter:function(e){var t=[];this.each(function(i){if(e(i))t.push(i.getDataRow())}),this.setRecords(t)},_initOptions:function(){this._columns=this._options.defaultColumns,this._hiddenData=this._options.records},_initRecords:function(){for(var e=0;e<this._hiddenData.length;++e)if(this._hiddenData[e]){this._hiddenData[e].setRecordSet(this);var t=this._hiddenData[e].getKey();this._pkIndex[t]=e,this._level[t]=0}},_startLoad:function(){if(this._options.firstRequest)this._beginLoad()},isInit:function(){return true},commit:function(){this._isChanged=false;for(var e=0,t=this._hiddenData.length;e<t;e++)if(void 0!==this._hiddenData[e]&&this._hiddenData[e].isChanged())this._hiddenData[e].commit()},_beginLoad:function(e,t,i){var n=this,a=[],s=[],r=this._options.filter,h=function(e){if(null===e)e="null";for(var t=0,i=n._hiddenData.length;t<i;++t)if(n._hiddenData[t]){var s=n._hiddenData[t].get(n._options.hierarchyField);if(null===s)s="null";if(s==e&&(!r||r(n._hiddenData[t],n._options.filterParams))){var d=n._hiddenData[t].getKey();if(n._level[d]=n._level[e]+1,a.push(n._hiddenData[t]),n._expand)h(n._hiddenData[t].getKey())}}};if(t)this._data=[];if(this._options.hierarchyField){var d=this._parentNode;if(d instanceof Array)this._expanded=false;else d=[d];for(u=0;u<d.length;++u)if(a=[],this._level[d[u]]=null===d[u]?-1:0,h(d[u]),s=s.concat(a),null===d[u])Array.prototype.splice.apply(this._data,[0,this._data.length].concat(a));else{var o=false;for(_=0;_<this._data.length;++_)if(this._data[_]&&this._data[_].getKey()==d[u]){for(var l=_+1;l<this._data.length;++l)if(this._data[l]&&this._data[l].get(this._options.hierarchyField)==d[u])this._data.splice(l--,1);this._data.splice.apply(this._data,[_+1,0].concat(a)),o=true;break}if(!o)this._data=this._data.concat(a)}a=this._data}else for(var _=0,c=this._hiddenData.length;_<c;++_)if(this._hiddenData[_]&&(!r||r(this._hiddenData[_],this._options.filterParams)))a.push(this._hiddenData[_]);if(this._usePages){if("parts"===this._usePages&&-1===this._pageNum)this._pageNum=Math.ceil(a.length/this._options.rowsPerPage)-1;this._data=[],this._hasNextPage="full"===this._usePages?a.length:a.length>(this._pageNum+1)*this._options.rowsPerPage;for(var u=this._pageNum*this._options.rowsPerPage,f=Math.min(a.length,u+this._options.rowsPerPage);u<f;++u)this._data.push(a[u])}else this._data=a;if(this._notify("onAfterLoad",this,true,void 0,i&&i.options),i&&i.deferred&&!i.deferred.isReady())i.deferred.callback(s||this._data)},setFilter:function(e){this._options.filter=e},setQuery:function(e){return this._expand="С разворотом"===e["Разворот"],d.superclass.setQuery.apply(this,arguments)},getColumns:function(){return t.merge({},this._options.defaultColumns)},_rebuild:function(){this._pkIndex={},this._level={};for(var e=0,t=this._hiddenData.length;e<t;++e)if(e in this._hiddenData){var i=this._hiddenData[e].getKey();this._level[i]=0,this._pkIndex[i]=e}},setRecords:function(e){this._hiddenData=e,this._rebuild(),this._beginLoad()},addRecords:function(e){if(this._hiddenData=this._hiddenData.concat(e),false===this._pocketAppending)this._rebuild(),this._beginLoad()},getRecordByPrimaryKey:function(e){if(e in this._pkIndex)return this._hiddenData[this._pkIndex[e]];throw new Error("Record with primary key "+e+" is not found")},createRecord:function(t){t=t||{};for(var n=new i,a=this._columns,s=0,r=0,h=this._hiddenData.length;r<h;++r){if(!this._hiddenData[r])continue;var d=this._hiddenData[r].getKey();if(s<d)s=d}var o=[],l=this._options.hierarchyField;for(var _ in a)if(a.hasOwnProperty(_))o[a[_].index]=null;if(o[this._pkColumnIndex]="null",l){var c=t[l].hierarchy;if(c){if("null"===c[0])c[0]=null;o[a[l].index]=c[0],o[a[l+"@"].index]=c[1],o[a[l+"$"].index]=false}}var u=e("Deprecated/Record");return n.callback(new u({row:o,colDef:this._options.defaultColumns,parentRecordSet:this,pkValue:"null"})),n},readRecord:function(e){if(void 0===e||void 0===this._pkIndex[e]||!this._hiddenData[this._pkIndex[e]])return this.createRecord();var t=new i;return t.callback(this._hiddenData[this._pkIndex[e]]),t},updateRecord:function(e){var t=e.getKey(),n=new i;if("null"===t){var a=0;Object.keys(this._pkIndex).forEach(function(e){var t=parseInt(e,10)||0;if(a<t)a=t}),e.setKey(t=a+1,this._pkColumnIndex)}if(void 0!==this._pkIndex[t])this._hiddenData[this._pkIndex[t]]=e;else this._hiddenData.push(e),this._pkIndex[t]=this._hiddenData.length-1;if(this._options.hierarchyField){var s=e.get(this._options.hierarchyField);this._level[t]=void 0!==s&&this._level[s]?this._level[s]+1:0}else this._level[t]=0;return this._notify("onRecordUpdated",e),n.callback(t),n},addPkIndex:function(){},_deleteRecord:function(e){var t=this._pkIndex[e],i,n,a,s,r,h;if(void 0!==t&&null!==t){for(s=this._hiddenData[t],n=0,a=(r=Object.keys(this._pkIndex)).length;n<a;n++)if(h=r[n],this._pkIndex[h]>t)this._pkIndex[h]--;for(this._hiddenData.splice(t,1),delete this._level[e],delete this._pkIndex[e],n=0;n<this._data.length;++n)if(i=this.at(n),i&&i.getKey()==e){this._data.splice(n,1);break}return this._isChanged=true,this._notify("onRecordDeleted",e+"",s),true}return false},clearNode:function(e){if(void 0===this._pkIndex[e])return[];for(var t=this.recordChilds(e),i=0;i<t.length;i++)this._deleteRecord(t[i]);var n=this._hiddenData;this._hiddenData=[];for(var a=0,s=n.length;a<s;++a)if(n[a])this._hiddenData.push(n[a]);return this._refreshPkIndex(),t},deleteRecord:function(e){var t=new i;t.addErrback(function(e){return e});try{this._deleteRecord(e),t.callback(e)}catch(e){t.errback(e)}return t},deleteRecords:function(e){for(var t=0,i=e.length;t<i;++t)this._deleteRecord(e[t])},loadNode:function(e,t,i,n,a,s){this._parentNode=e,this._pageNum=i?i:0,this._notify("onPageChange",this._pageNum),this._expand=n;var r=this._createLoadingInfo(s);return this._beginLoad(void 0,t,r),r.deferred},hasNextPage:function(){var e=this,t=function(){for(var t=0,i=e._options.filter,n=0,a=e._hiddenData.length;n<a;++n)if(e._hiddenData[n]&&(!i||i(e._hiddenData[n],e._options.filterParams)))++t;return t};if("parts"===this._usePages)return t()>(this._pageNum+1)*this._options.rowsPerPage;return t()},getRecordCount:function(){return this._data.length},_recordFromData:function(t,i){var n=this._columns,a=[];for(var s in n)if(n.hasOwnProperty(s)){var r;if(s in t)r=t[s];else if(n[s].index===this._pkColumnIndex)r=this._hiddenData.length+i;else r=null;a[n[s].index]=r}return this._pkIndex[a[this._pkColumnIndex]]=this._hiddenData.length+i,new(e("Deprecated/Record"))({colDef:n,row:a,pkValue:a[this._pkColumnIndex],parentRecordSet:this})},_importRecord:function(e){if(d.superclass._importRecord.apply(this,arguments),void 0===e.getKey())e.setKey(this._hiddenData.length,this._pkColumnIndex)},beginBatchAppend:function(){this._pocketAppending=true},endBatchAppend:function(){if(true===this._pocketAppending)this._pocketAppending=false,this._rebuild(),this._beginLoad();else n.resolve("ILogger").log("RecordSet:endBatchAppend","Trying to complete batch processing, which is not started. Use beginBatchAppend before appendRecord.")},appendRecord:function(t){var i=t instanceof Array,n=e("Deprecated/Record");if(true===i)this.beginBatchAppend();else t=[t];if(t=r.map(t,function(e){if(!(e instanceof n))e=this._recordFromData(e,0);else this._importRecord(e);return e},this),this.addRecords(t),true===i)return this.endBatchAppend(),t;else return t[0]},at:function(e){return this._data[e]},appendData:function(e){for(var t=[],i=0,n=e.length;i<n;++i)t.push(this._recordFromData(e[i],i));return this.addRecords(t),t},insertAfter:function(e,t){var i=this._pkIndex[e];if(void 0!==i&&null!==i)this._hiddenData.splice(i+1,0,t);else this._hiddenData.unshift(t);return this._rebuild(),this._beginLoad(),t},clear:function(){this._hiddenData=[],this._rebuild()},getRecords:function(e){if(e)return this._hiddenData;return this._data},recordChilds:function(e){for(var t=[],i=0,n=this._hiddenData.length;i<n;++i)if(this._hiddenData[i]&&this._hiddenData[i].get(this._options.hierarchyField)==e)t.push(this._hiddenData[i].getKey());return t},abort:function(){this._notify("onAbort")},_buildHierarchyData:function(){},clearRecord:function(e){this._deleteRecord(e)},toJSON:function(){var e={s:[],d:[]};return this.each(function(t,i){if(0===i){var n=t.toJSON();e.s=n.s,e.d.push(n.d)}else e.d.push(t.getDataRow())}),e},_calcResults:function(e){var t=0,i=0,n=this,a=function(e){var t=n.getHierarchyField(),i=false;if(t)i=e.get(t+"$");if(i&&"folders"==n._options.resultType||!i&&"leaves"==n._options.resultType)return true;return false},r=this.getBigCalcSum();return this.each(function(n){if(n.hasColumn(e.title)&&("foldersAndLeaves"==this._options.resultType||a(n)))if(e.type==s.FIELD_TYPE_MONEY&&e.p)i=r(i,n.get(e.title),e.p);else t+=n.get(e.title)}),t||i},setBigCalcSum:function(e){if("function"==h(e))this._options.bigCalcSum=e;else n.resolve("ILogger").error("RecordSet:setBigNumSum","Argument must be a function")},getBigCalcSum:function(){var e=function(e,t){return parseFloat(e)+parseFloat(t)};return this._options.bigCalcSum?this._options.bigCalcSum:e},getResults:function(){var t=this.getColumns(),i=[],n=e("Deprecated/Record");for(var a in t)if(t.hasOwnProperty(a)){var r=t[a],h=r.type;if(h===s.FIELD_TYPE_MONEY||h===s.FIELD_TYPE_INTEGER||h===s.FIELD_TYPE_DOUBLE)i[r.index]=this._calcResults(r)}return new n({row:i,colDef:t})},setResultType:function(e){this._options.resultType=e}}),d});
//# sourceMappingURL=RecordSetStatic.js.map
define("Core/helpers/transport-helpers",["Core/deprecated","Transport/prepareGetRPCInvocationURL","Deprecated/helpers/transport-helpers"],function(e,r,t){var p=e.callNextWrapper,n=function(r,t){return function(){e.showInfoLog("Хелпер Core/helpers/transport-helpers::"+r+" помечен как deprecated и будет удален в 3.18."+(t?" Подключите явно "+t+", чтобы им пользоваться.":""))}};return{jsonRpcPreparePacket:p(t.jsonRpcPreparePacket,function(){e.showInfoLog("Хелпер $ws.helpers.jsonRpcPreparePacket помечен как deprecated и будет удален в 3.18. Подключите явно Transport/RPCJSON и используйте соответствующий метод")}),prepareSorting:p(t.prepareSorting,n("prepareSorting")),prepareGetRPCInvocationURL:p(r,n("prepareGetRPCInvocationURL","Transport/prepareGetRPCInvocationURL")),fetchFile:p(t.fetchFile,n("fetchFile")),newRecordSet:p(t.newRecordSet,n("newRecordSet"))}});
//# sourceMappingURL=transport-helpers.js.map
define("Deprecated/BLObject",["Core/core-extend","Core/Deferred","Core/IoC","Transport/RPCJSON","Deprecated/SerializatorSBIS","Deprecated/RecordSet","Core/core-instance","Core/helpers/transport-helpers"],function(e,r,t,a,i,n,o,s){var c;(c=function(e){if(!(this instanceof c)||Object.getPrototypeOf(this)===c.prototype)return t.resolve("IBLObject",e)}).RETURN_TYPE_ASIS="asis",c.RETURN_TYPE_RECORD="record",c.RETURN_TYPE_RECORDSET="recordset";var d=e.extend(c,{$protected:{_name:"",_serviceUrl:""},$constructor:function(e){if(e&&"object"==typeof e){if("name"in e)this._name=e.name;if("serviceUrl"in e)this._serviceUrl=e.serviceUrl}else if("string"==typeof e)this._name=e;if(!this._name)throw new Error("Name of the object must be specified then creating BLObject instance")},getName:function(){return this._name},call:function(e,r,t,d,p,f){if(!e||"string"!=typeof e)throw new TypeError("Method name must be specified");if(!r||"object"!==typeof r)throw new TypeError("Wrong arguments specified. Must be an object");switch(t){case c.RETURN_TYPE_RECORD:var h,u=p?-1!==p.indexOf(".")?p:this._name+"."+p:this._name+".Записать",m=f?-1!==f.indexOf(".")?f:this._name+"."+f:this._name+".Удалить";return h=new n({firstRequest:false,readerType:"StraightArgsReader",readerParams:{dbScheme:"",adapterType:"TransportAdapterRPCJSON",adapterParams:{serviceUrl:this._serviceUrl,readMethodName:this._name+"."+e,updateMethodName:u,destroyMethodName:m}}}),h.readRecord(r);case c.RETURN_TYPE_RECORDSET:return s.newRecordSet(this._name,e,r,"StraightArgsUnifiedReader",true,this._serviceUrl,d);case c.RETURN_TYPE_ASIS:var g={};for(var l in r)if(r.hasOwnProperty(l)){var R=r[l];if(o.instanceOfModule(R,"Deprecated/Record")||o.instanceOfModule(R,"Deprecated/RecordSet"))g[l]=i.serialize(R);else g[l]=R}return new a({serviceUrl:this._serviceUrl}).callMethod(this._name+"."+e,g);default:throw new TypeError("Wrong return type specified")}},query:function(e,t,a,i){if(!e||"string"!=typeof e)throw new TypeError("Method name must be specified");if(a)if("object"!=typeof a)throw new TypeError("Paging parameter must be an object");else if(a.type){if(a.page=+a.page,a.pageSize=+a.pageSize,isNaN(a.page))throw new TypeError("Page must be a number (paging.page)");if(isNaN(a.pageSize))throw new TypeError("Page size must be a number (paging.pageSize)")}if(i&&!(i instanceof Array))throw new TypeError("Sorting parameter must be an array");return s.newRecordSet(this._name,e,t,void 0,!(i||a),this._serviceUrl,void 0).addCallback(function(e){if(i||a){var t=new r;if(t.addErrback(function(e){return e}),i)e.setSorting(i,void 0,void 0,true);if(a&&a.type)e.setUsePages(a.type),e.setPageSize(a.pageSize,true),e.setPage(a.page,true);return e.once("onAfterLoad",function(e,r,a,i){if(a)t.callback(r);else t.errback(i)}),e.reload(),t}else return e})}});return t.bind("IBLObject",d),c});
//# sourceMappingURL=BLObject.js.map
define("js!SBIS3.BL.FileSD",["Deprecated/BLObject","Deprecated/Record","Deprecated/RecordSetStatic","Core/helpers/collection-helpers"],function(e,t,n,r){"use strict";var s;function i(e){return e instanceof Array?e:[e]}function R(){if(!s)s=new e({name:"FileSD",serviceUrl:"/disk/api/v1/service/"});for(var t=[],n=0,r=arguments.length;n<r;n++)t[n]=arguments[n];return s.call.apply(s,t)}function a(t){return R("ListAccessRights",{Id:t},e.RETURN_TYPE_RECORDSET)}function E(n,r,s,i,a){var E=new t;return E.addColumn("Id",t.FIELD_TYPE_STRING),E.addColumn("Name",t.FIELD_TYPE_STRING),E.addColumn("CountOurStaff",t.FIELD_TYPE_INTEGER),E.addColumn("CountOthers",t.FIELD_TYPE_INTEGER),E.addColumn("CountEmails",t.FIELD_TYPE_INTEGER),E.set("Id",n),E.set("Name",r||null),E.set("CountOurStaff",s),E.set("CountOthers",i),E.set("CountEmails",a),R("ListAccessRightsByGroups",{Object:E},e.RETURN_TYPE_RECORD)}function d(t){return R("ListPublicAccessRights",{Id:t},e.RETURN_TYPE_RECORDSET)}function o(t){return R("GetPublicAccessRight",{Id:t},e.RETURN_TYPE_RECORD)}function c(){var e=new t;return e.addColumn("Email",t.FIELD_TYPE_STRING),e.addColumn("Person",t.FIELD_TYPE_UUID),e}function u(e){var t=new n;return t.addRecords(r.map(e.persons,function(e){var t=c();return t.set("Person",e),t})),t.addRecords(r.map(e.emails,function(e){var t=c();return t.set("Email",e),t})),t}function T(t){var n=u(t);return R("ResetAccessRightWithMessage",{FileIds:i(t.objectId),Rights:t.rights,ExpireDate:t.expireDate?t.expireDate.toSQL(true):null,Message:t.message,Comment:t.comment,Subject:n},e.RETURN_TYPE_RECORDSET)}function _(t){var n=u(t);return R("ResetAccessRightWithMessageAndCheck",{FileIds:i(t.objectId),Rights:t.rights,ExpireDate:t.expireDate?t.expireDate.toSQL(true):null,Message:t.message,Comment:t.comment,Subject:n,CheckDecreaseRights:true},e.RETURN_TYPE_RECORDSET)}function I(t){var n=u(t);return R("UpdateAccessRightWithMessage",{FileIds:i(t.objectId),Rights:t.rights,ExpireDate:t.expireDate?t.expireDate.toSQL(true):null,Message:t.message,Comment:t.comment,Subject:n},e.RETURN_TYPE_RECORDSET)}function D(t){var n=u(t);return R("UpdateAccessRightWithMessageAndCheck",{FileIds:i(t.objectId),Rights:t.rights,ExpireDate:t.expireDate?t.expireDate.toSQL(true):null,Message:t.message,Comment:t.comment,Subject:n,CheckDecreaseRights:true},e.RETURN_TYPE_RECORDSET)}function l(){var e=new t;return e.addColumn("Client",t.FIELD_TYPE_INTEGER),e.addColumn("Subdivision",t.FIELD_TYPE_INTEGER),e.addColumn("SubdivisionId",t.FIELD_TYPE_UUID),e.addColumn("Person",t.FIELD_TYPE_UUID),e.addColumn("Group",t.FIELD_TYPE_UUID),e.addColumn("Email",t.FIELD_TYPE_STRING),e.addColumn("Comment",t.FIELD_TYPE_STRING),e}function C(e){var t=new n;if(t.addRecords(r.map(e.persons,function(e){var t=l();return t.set("Person",e),t})),t.addRecords(r.map(e.emails,function(e){var t=l();return t.set("Email",e.email),t.set("Comment",e.comment),t})),t.addRecords(r.map(e.subdivisions,function(e){var t=l();if(e["Лицо"])t.set("Subdivision",e["Лицо"]);if(e["Идентификатор"])t.set("SubdivisionId",e["Идентификатор"]);if(e["ИдентификаторГруппы"])t.set("Group",e["ИдентификаторГруппы"]);return t})),t.addRecords(r.map(e.clients,function(e){var t=l();return t.set("Client",e),t})),e.groups)t.addRecords(r.map(e.groups,function(e){var t=l();return t.set("Group",e),t}));return t}function P(t){var n=C(t);return R("ResetAccessRight",{FileIds:i(t.objectId),Rights:t.rights,ExpireDate:t.expireDate?t.expireDate.toSQL(true):null,Subject:n},e.RETURN_TYPE_RECORDSET)}function m(t){var n=C(t);return R("ResetAccessRightAndCheck",{FileIds:i(t.objectId),Rights:t.rights,ExpireDate:t.expireDate?t.expireDate.toSQL(true):null,Subject:n,CheckDecreaseRights:true},e.RETURN_TYPE_RECORDSET)}function S(t){var n=C(t);return R("UpdateAccessRight",{FileIds:i(t.objectId),Rights:t.rights,ExpireDate:t.expireDate?t.expireDate.toSQL(true):null,Subject:n},e.RETURN_TYPE_RECORDSET)}function N(t){var n=C(t);return R("UpdateAccessRightAndCheck",{FileIds:i(t.objectId),Rights:t.rights,ExpireDate:t.expireDate?t.expireDate.toSQL(true):null,Subject:n,CheckDecreaseRights:true},e.RETURN_TYPE_RECORDSET)}function F(t,n){return R("ResetPublicAccessRight",{FileId:t,Rights:n,ExpireDate:null},e.RETURN_TYPE_RECORD)}function h(s){var i=new n;return i.addRecords(r.map(s,function(e){var n=new t,r=l();return r.set("Client",e.subject.client),r.set("Subdivision",e.subject.subdivision),r.set("Person",e.subject.person),r.set("Email",e.subject.email),r.set("Group",e.subject.group),n.addColumn("FileId",t.FIELD_TYPE_STRING),n.set("FileId",e.fileId),n.addColumn("CheckDecreaseRights",t.FIELD_TYPE_BOOLEAN),n.set("CheckDecreaseRights",e.checkDecreaseRights),n.addColumn("Subject",t.FIELD_TYPE_RECORD),n.set("Subject",r),n})),R("DeleteAccessRightExt",{AccessRight:i},e.RETURN_TYPE_RECORDSET)}function Y(t){return R("AccessData",{FileId:t},e.RETURN_TYPE_RECORD)}function f(t){return R("AccessRightData",{FileIds:i(t)},e.RETURN_TYPE_RECORDSET)}function g(t,n){return R("SetForbidInheritance",{Id:t,Forbid:n},e.RETURN_TYPE_ASIS)}function L(t){return R("DeleteExt",{Ids:i(t)},e.RETURN_TYPE_RECORDSET)}function A(t){return R("DeletePermanentlyExt",{Ids:i(t)},e.RETURN_TYPE_RECORDSET)}function p(t){return R("RecoverExt",{Ids:i(t)},e.RETURN_TYPE_RECORDSET)}function O(t,n){return R("RecoverInNewParentExt",{Ids:i(t),NewParent:n},e.RETURN_TYPE_RECORDSET)}function U(t,n){return R("MoveExt",{Ids:i(t),Parent:n},e.RETURN_TYPE_RECORDSET)}function v(n,r){var s=new t;return s.addColumn("Ids",t.FIELD_TYPE_ARRAY,t.FIELD_TYPE_TEXT),s.addColumn("ParentId",t.FIELD_TYPE_STRING),s.set("Ids",i(n)),s.set("ParentId",r),R("CopyExt",{Object:s},e.RETURN_TYPE_RECORD)}function b(t,n){return R("TakeAwayHardLink",{Id:i(t),ParentId:n},e.RETURN_TYPE_RECORDSET)}function G(s){var i=new n;return i.addRecords(r.map(s,function(e){var n=new t;return n.addColumn("Id",t.FIELD_TYPE_STRING),n.set("Id",e.Id),n.addColumn("SourceId",t.FIELD_TYPE_STRING),n.set("SourceId",e.SourceId),n})),R("UndoTakeAwayHardLink",{Id:i},e.RETURN_TYPE_RECORDSET)}function j(t,n){return R("CreateLink",{Id:i(t),ParentId:n},e.RETURN_TYPE_RECORDSET)}function x(t,n,r){return R("GetBrowserStickerData",{RootName:t,Id:n,FileCount:r},e.RETURN_TYPE_RECORD)}function k(t){return R("GetQuota",{RootName:t},e.RETURN_TYPE_RECORD)}function w(n,r){var s=new t;return s.addColumn("ParentId",t.FIELD_TYPE_STRING),s.addColumn("Name",t.FIELD_TYPE_STRING),s.set("ParentId",n),s.set("Name",r),R("CreateFolder",{Object:s},e.RETURN_TYPE_RECORD)}function B(t,n){return R("GenerateFolderName",{Id:t,BaseName:n},e.RETURN_TYPE_ASIS)}function y(t,n){return R("GenerateFileName",{Id:t,BaseName:n},e.RETURN_TYPE_ASIS)}function M(n,r){var s=new t;return s.addColumn("Id",t.FIELD_TYPE_STRING),s.addColumn("Name",t.FIELD_TYPE_STRING),s.addColumn("Owner",t.FIELD_TYPE_UUID),s.addColumn("Account",t.FIELD_TYPE_INTEGER),s.addColumn("Link",t.FIELD_TYPE_STRING),s.addColumn("Size",t.FIELD_TYPE_INTEGER),s.addColumn("MD5",t.FIELD_TYPE_STRING),s.set("Id",n),s.set("Name",r),R("Update",{FileSD:s},e.RETURN_TYPE_ASIS)}function Q(n){var r=new t;return r.addColumn("ReadLinkedObjects",t.FIELD_TYPE_BOOLEAN),r.set("ReadLinkedObjects",false),r.addColumn("ReadVersions",t.FIELD_TYPE_INTEGER),r.set("ReadVersions",0),r.addColumn("ReadServiceFiles",t.FIELD_TYPE_BOOLEAN),r.set("ReadServiceFiles",true),R("Read",{Id:n,ExtraParams:r},e.RETURN_TYPE_RECORD)}function W(n){var r=new t;return r.addColumn("ReadLinkedObjects",t.FIELD_TYPE_BOOLEAN),r.set("ReadLinkedObjects",false),r.addColumn("ReadVersions",t.FIELD_TYPE_INTEGER),r.set("ReadVersions",0),r.addColumn("ReadServiceFiles",t.FIELD_TYPE_BOOLEAN),r.set("ReadServiceFiles",true),R("ReadByObject",{Id:n,ExtraParams:r},e.RETURN_TYPE_RECORD)}function H(t){return R("ReadAttachmentInfo",{"ИдО":t},e.RETURN_TYPE_RECORD)}function V(t){return R("ReadFolderInfo",{"ИдО":t},e.RETURN_TYPE_RECORD)}function X(t,n){return R("FilePosInList",{FileId:t,Filter:n},e.RETURN_TYPE_ASIS)}function z(n){var r=new t;return r.addColumn("Ids",t.FIELD_TYPE_ARRAY,t.FIELD_TYPE_TEXT),r.set("Ids",i(n.Id)),r.addColumn("DestinationRoot",t.FIELD_TYPE_STRING),r.set("DestinationRoot",n.DestinationRoot),r.addColumn("Move",t.FIELD_TYPE_BOOLEAN),r.set("Move",n.Move),r.addColumn("IdBefore",t.FIELD_TYPE_STRING),r.set("IdBefore",n.IdBefore),r.addColumn("IdAfter",t.FIELD_TYPE_STRING),r.set("IdAfter",n.IdAfter),R("SetFavoritesPosition",{Object:r},e.RETURN_TYPE_RECORD)}function q(t){return R("NotifyRecentFileById",{Id:t},e.RETURN_TYPE_RECORD)}function J(t){return R("AddInFavorites",{Id:t},e.RETURN_TYPE_RECORD)}function K(t){return R("RemoveFromFavorites",{Id:t},e.RETURN_TYPE_RECORD)}function Z(t){return R("HashForDigitalSignature",{Ids:t},e.RETURN_TYPE_RECORDSET)}return{ListAccessRights:a,ListAccessRightsByGroups:E,ResetAccessRight:P,ResetAccessRightAndCheck:m,UpdateAccessRight:S,UpdateAccessRightAndCheck:N,ResetAccessRightWithMessage:T,ResetAccessRightWithMessageAndCheck:_,UpdateAccessRightWithMessage:I,UpdateAccessRightWithMessageAndCheck:D,ResetPublicAccessRight:F,DeleteAccessRightExt:h,AccessData:Y,AccessRightData:f,SetForbidInheritance:g,ListPublicAccessRights:d,GetPublicAccessRight:o,TakeAwayHardLink:b,UndoTakeAwayHardLink:G,CreateLink:j,Copy:v,Move:U,Delete:L,DeletePermanently:A,Recover:p,RecoverInNewPlace:O,Update:M,Read:Q,ReadByObject:W,ReadAttachmentInfo:H,ReadFolderInfo:V,FilePosInList:X,SetFavouritesPosition:z,CreateFolder:w,GenerateFolderName:B,GenerateFileName:y,GetBrowserStickerData:x,GetQuota:k,NotifyRecentFileById:q,AddInFavorites:J,RemoveFromFavorites:K,HashForDigitalSignature:Z}});
//# sourceMappingURL=FileSD.module.js.map
define("js!SBIS3.DOCVIEW.LoadHelpers",["Core/helpers/String/escapeHtml","Core/EventBus","Core/Deferred","optional!js!SBIS3.Plugin/Source/LocalService","js!SBIS3.DOCVIEW.Funcs","WS.Data/Source/SbisService","optional!js!SBIS3.EDO.CD.UploadManager","i18n!SBIS3.DOCVIEW.LoadHelpers"],function(e,i,t,n,o,s,a){"use strict";var r={_fileChooserPlugin:null,_fileLoaderPlugin:null,_getPlugin:function(e,i,o){var s=r[o],a=new t;if(s&&s.getState()===s.readyState.OPEN)return t.success(s);else{if(n){var l=new n({endpoint:{address:e+"-"+i,contract:e},options:{mode:"silent"}});l.isReady().addCallbacks(function(){r[o]=l,a.callback(l)},function(e){r[o]=null,a.errback(e)})}else a.errback();return a}},getFileSystemPlugin:function(){return this._getPlugin("FileSystem","1.0.1.16","_fileSystemPlugin")},uploadFile:function(e,t,n){var o=this;this.getFileSystemPlugin().addCallbacks(function e(s){i.channel("FileLoadingEvents").subscribe("onBeforeStartLoad",function(e,i){if(e.setResult(false),a)i.forEach(function(e){o.uploader.upload(a.UPLOAD_METHOD_PLUGIN,e.fileCaption,e.fileSize,{path:e.path,folder:t,isFolder:"folder"===e.type})})}),(n=n||{}).canUploadFolder=true,require(["js!SBIS3.FL.FileChooser"],function(e){e.selectFiles(true,n)})},function i(t){e.selectFile({which:true})})},getDiskRestServiceURL:function(){return"/disk/api/v1/"},showErrorNotification:function(e,i){r._showNotification(e,i,"error",15e3)},showSuccessNotification:function(e,i){r._showNotification(e,i,"success",1e4)},_showNotification:function(i,t,n,o){require(["js!SBIS3.EDO.CD.Notification"],function(s){var a=new s.Message;a.addDynamicText(e(t)),s.show(i,a,{cancellable:false,style:n,timeout:o})})},getUploadManager:function(){if(!r.uploader||r.uploader.isDestroyed())this._initUploadManager();return r.uploader},_initUploadManager:function(){r.uploader=a?new a({remoteUrl:r.getDiskRestServiceURL()}):null},getUniqueUploadManager:function(){return a?new a({remoteUrl:r.getDiskRestServiceURL()}):null},attachLinkFromSbisDisk:function(e){var i,n,a=this,r,l={doNotCopyToBuffer:true,doNotNotifyFinish:true,originalFile:{objectName:"FileSD",serviceUrl:"/disk/api/v1/"}};if(this._options.mainOptions.fixId)i=a._options.mainOptions.fixId;else if(this._options.mainOptions.ctxLinkId)i=a.getLinkedContext().getValue(a._options.mainOptions.ctxLinkId);else if(this._options.mainOptions.filter)i=this._options.mainOptions.filter.catalogId;else if(this._options.destinationDir)i=this._options.destinationDir;return n=e.split("/disk/")[1],o.readByObject(n).addCallback(function(e){if(r=0===e.get("Type"),a._options.mainOptions.isDisk)require(["js!SBIS3.BL.FileSD"],function(t){t.CreateLink([e.get("Id")],i).addCallback(function(e){if(e.at(0).get("Success")){var i=e.at(0).get("Id");a._currentAttachSession.add(i),c(i,r,e.at(0).get("VersionId"))}else a._showError({message:e.at(0).get("ErrorMsg")}),a._checkIfTotalComplete()})});else{l.isFromLink=true;var n=new s({endpoint:{contract:a._options.mainOptions.objectName,address:a._options.mainOptions.serviceUrl+"service/"}}),o=e.get("Id");a._currentAttachSession.add(o),n.call("CreateLinkOnFile",{Id:o,IsFolder:r}).addCallback(function(e){var i=e.getRow().get("Id"),t=i.split(";")[1];c(i,r,t,e)})}function c(e,i,n,s){var r;l.originalFile.attachId=e,l.originalFile.redactionId=n,r=a._onFinish(e,i,s,l),t.callbackWrapper(r,function(){a._currentAttachSession.success(o||e)})}})},ROOT_FOLDER_MY:"mydocs",ROOT_FOLDER_COMMON:"commondocs",ROOT_FOLDER_LOADS:"loads",ROOT_FOLDER_SHARED:"sharedmedocs",ROOT_FOLDER_MY_TRASH:"mytrash",ROOT_FOLDER_COMMON_TRASH:"commontrash",ROOT_FOLDER_MY_RECENT:"myrecent",ROOT_FOLDER_COMMON_RECENT:"commonrecent",ROOT_FOLDER_RECENT:"recent"};return r._initUploadManager(),r});
//# sourceMappingURL=LoadHelpers.module.js.map
define("js!SBIS3.DOCVIEW.UploadMixin",["Core/helpers/Object/find","Core/helpers/Array/findIndex","Core/helpers/String/format","WS.Data/Entity/Model","optional!js!SBIS3.BL.FileSD","js!SBIS3.DOCVIEW.LoadHelpers","Core/Indicator","Core/Deferred","WS.Data/Source/SbisService","WS.Data/Entity/Record","WS.Data/Collection/RecordSet","js!SBIS3.DOCVIEW.Funcs","i18n!SBIS3.DOCVIEW.UploadMixin"],function(e,i,t,s,n,r,a,o,l,f,d,c){"use strict";function p(e){return"http://"+window.location.host+e+"service/"}function u(e,i){var t=[{name:"Service",type:"string"},{name:"Object",type:"string"},{name:"Id",type:"string"},{name:"RedactionId",type:"string",defaultValue:null}],s=new f({adapter:"adapter.sbis",format:t}),n=new f({adapter:"adapter.sbis",format:t});return s.set("Service",p(e.serviceUrl)),s.set("Object",e.objectName),s.set("Id",e.attachId),s.set("RedactionId",e.redactionId),n.set("Service",p(i.serviceUrl)),n.set("Object",i.objectName),n.set("Id",String(i.attachId)),new l({endpoint:{contract:"DocView",address:"/docview/service/"}}).call("CopyAttachmentCache",{OldFileInfo:s,NewFileInfo:n})}function h(e,i){if(i)for(var t in i)if(!e.has(t)&&i.hasOwnProperty(t)&&null!=i[t])e.addField({name:t,type:"string"},void 0,i[t].toString())}var _={$protected:{filters:null,loadDef:null,_filesArray:[],_getParamsForProcessAttachment:function(e){var i=this._options.mainOptions,t=new f({adapter:"adapter.sbis"}),s,n;if(s=this.filters.get("catalogId")||i.fixId||i.ctxLinkId&&this.getLinkedContext().getValue(i.ctxLinkId)||this._options.destinationDir||"",t.addField({name:"catalogId",type:"string"}),t.set("catalogId",s.toString()),n=this._options.parentFolderId||this.filters.get("folder")||this._options.linkedList&&this._options.linkedList.getCurrentRoot()||this._options.linkedList&&this._options.linkedList.getFilter().folder||null,n)t.addField({name:"folder",type:"string"}),t.set("folder",n.toString());return t.addField({name:"listFiles",type:"recordset"}),t.set("listFiles",e),t},_createListFiles:function(e){var i=new d({adapter:"adapter.sbis"});e.forEach(function(e){i.add(t(e.id,null,null,e.isLink))});function t(e,i,t,s){var n=new f({adapter:"adapter.sbis"});return n.addField({name:"Id",type:"string"}),n.addField({name:"FolderId",type:"string"}),n.addField({name:"InFolder",type:"string"}),n.addField({name:"IsLink",type:"boolean"}),n.set("Id",e),n.set("FolderId",i),n.set("InFolder",t),n.set("IsLink",s),n}return i},_prepareFilterToRec:function(e,i,t){var s=new f({adapter:"adapter.sbis"}),n=this._options.mainOptions;function r(e,i,t){if("string"===i&&null!=t)t=String(t);s.addField({name:e,type:i},void 0,t)}if(i=i||{},r("catalogId","string",this.filters.get("catalogId")||n.fixId||n.ctxLinkId&&this.getLinkedContext().getValue(n.ctxLinkId)||this._options.destinationDir||""),e)r("isFolder","boolean",true);if(i.needRewrite||i.needRewriteFile)r("rewrite","boolean",true);if((e||!!i.singleFileFromDisk)&&i.listFiles)r("listFiles","recordset",i.listFiles);if(i.isFromLink)r("listFiles","recordset",t.getRawData());var a=this.nowUploading&&this._dropFolderId||i.parentFolderId||this.filters.get("folder");if(!a&&this._options.linkedList){var o=this._options.linkedList;if(o)a=o.getCurrentRoot()||(o.getFilter()||{}).folder}if(a)r("folder","string",a);if(void 0!==this.filters.get("attachId"))r("attachId","string",this.filters.get("attachId"));else if(!!i.attachId)r("attachId","string",i.attachId);var l=i.folderName||this.filters.get("title");if(l)r("title","string",l);return h(s,n.filter),s},_addUploadInfo:function(t){if(this._filesInFolders&&this._filesInFolders.length){var s=i(this._filesInFolders,function(e){return e.name==t.name&&e.folder==t.data.fileFolder});if(s>=0)this._filesInFolders[s].uid=t.id}if(this._uploadManager.filesToRewrite.length){var n=e(this._uploadManager.filesToRewrite,function(e){return e.fileName===t.name});if(n)n.id=t.id}},_getFileNameById:function(i){var t;if(this._uploadManager.filesToRewrite.length){var s=e(this._uploadManager.filesToRewrite,function(e){return e.id===i});if(s)t=s.fileName}return t},checkFileSD:function(){return!!n},_checkIfTotalComplete:function(e){var i=this;function t(){if(a.hide(),!e)if(i._attachObjects&&i._attachObjects.length)i._notify("onFinishCreateAttachments",i._attachObjects),i._attachObjects=[];else i._notify("onFinishCreateAttachments")}if(this._filesCounter--,!this._filesCounter||this._filesCounter<=0)if(this._isDragDrop)if(!this._filesInFolders.length)t(),this._isDragDrop=false;else a.setMessage(rk("Ожидайте")+"...");else t();else a.setMessage(rk("Ожидайте")+"...");this._uploadManager.filesToRewrite.splice(0,this._uploadManager.filesToRewrite.length)},_onLoaded:function(e){var i=this;if(e.result){i.filters.set("uploadedId",e.result);var t=i._notify("onStartCreateAttachment",i.filters,e.result);o.callbackWrapper(t,function(t){if(false===t)return;if(i._filesArray.push(t),1===i._filesCounter){var s=i._filesArray.length>1?i._filesArray:t;i._notify("onLoaded",s)}if(e.result&&e.fileName)i._onFinish(e.result,false,{fileName:e.fileName});else i._onFinish(e.result)})}else{var s="";if(e.error&&e.error.message)s+=e.error.message;else if(e.get){var n=e.get("FailedFiles");if(n.getCount())n.forEach(function(e){s+="<br/>"+e.get("UserMsg")})}if(s)c.alert({message:s,opener:i.getParent()});if(e.get){var r=e.get("LoadedFiles");if(r.getCount())r.forEach(function(e){i._attachObjects.push({id:e.get("Info").get("@ВнешнийДокумент").toString(),sbisDiskId:e.get("Info").get("ИдентификаторДиск")}),i._notify("onFinishCreateAttachment",e.get("Info").get("@ВнешнийДокумент")||e.get("attachId"))}),i._checkIfTotalComplete()}}},onChangeInputFile:function(e,i,s,n){if(e)e.setResult(false);if(!n)n={};var l=this._notify("onStartCreateAttachment",this.filters,{file_name:i,file:s,from_params:n}),f=n&&!!n.bufferLink||false,d=this;o.callbackWrapper(l,function(){if(false===l)return;var e=d.filters.get("parent_folder"),o=d.getDestinationFolder(),p=d.filters.get("parentId"),u=d.filters.get("attachId"),h=p===r.ROOT_FOLDER_MY||p===r.ROOT_FOLDER_COMMON;if((s instanceof File||!s.isFolder)&&!f){var _="";if(!d._options.uploadEmptyFiles&&!s.size)_=rk("Размер файла нулевой");if(d._options.maxFileSizeInMB&&s.size>1024*d._options.maxFileSizeInMB*1024){var g=rk("Размер файла превышает установленное ограничение в $number$s$ МБ"),m={number:d._options.maxFileSizeInMB};_=t(m,g)}if(_)return c.alert({message:_,opener:d}),void a.hide()}if(d.filters.get("fileName"))s.name=d.filters.get("fileName");if(n.buffer)d._uploadManager.upload("plugin",s.name,s.size,{path:s.path,fileName:s.name,fileId:u,folder:o});else if(n.scanner)d._uploadManager.upload("plugin",s.name,s.size,{path:s.path,fileName:s.name,folder:d._options.mainOptions.isDisk?u?null:o:"temp",fileId:u});else if(n.bufferLink)d._uploadManager.upload("browser",i,s.size,{file:s,fileName:i,folder:o});else if(s instanceof File)d._uploadManager.upload("browser",s.name,s.size,{file:s,fileName:s.name,folder:o});else d._uploadManager.upload("browser",s.name,s.size,{file:s,path:s.path,fileName:s.name,folder:o,isFolder:s.isFolder,rootId:s.rootId})})}},after:{getDestinationFolder:function(){return this.filters.get("folder")||this._options.destinationDir||"temp"},_onFinish:function(e,i,t,s){s=s||{};var r=this,a=new o,f=new l({endpoint:{contract:r._options.mainOptions.objectName,address:r._options.mainOptions.serviceUrl+"service/"}}),d;if(e.result&&e.result.indexOf(";null")>-1)e.result=e.result.split(";null")[0],i=true,c(),e=null;else c();function c(){if(!s.useSingleProcessing)var l=r._prepareFilterToRec(i,s,t);if(e&&e.result)e=e.result;if(r._options.mainOptions.isDisk&&r._options.publicAccess)d=n.ResetPublicAccessRight(e.split(";")[0],1);else d=o.success();var c=null;if(!s.singleFileFromDisk)if(r._options.mainOptions.isDisk&&i)c=e;else c=i?null:s.fileId?s.fileId+";"+e:e;if(s.isFromLink&&t)c=null;if(d.addCallback(function(){if(s.useSingleProcessing){var i,t;if(s.listFiles)if(r._listFiles)r._listFiles.append(s.listFiles);else r._listFiles=s.listFiles;else{if(!r._fileObjectsList)r._fileObjectsList=[];r._fileObjectsList.push({id:e,isLink:s.originalFile.isLink})}if(s.isLastObject){if(r._fileObjectsList)i=r._createListFiles(r._fileObjectsList);else i=r._listFiles;return t=r._getParamsForProcessAttachment(i),r._fileObjectsList=null,r._listFiles=null,f.call("ProcessAttachment",{fileId:null,filters:t})}}else return f.call("ProcessAttachment",{fileId:c,filters:l})}),!r._options.mainOptions.isDisk&&s&&s.originalFile&&!i)d.addCallback(function(e){if(e&&"string"!==typeof e)e=e.getScalar();if(!e)return c.split(";")[0];return u(s.originalFile,{serviceUrl:r._options.mainOptions.serviceUrl,objectName:r._options.mainOptions.objectName,attachId:e}).addBoth(function(){return e})});d.addCallback(function(n){var o={};if(n&&"string"!==typeof n)if(n=n.getScalar(),n&&"record"==n._type)n=c.split(";")[0];if(!i&&t&&(!s||!s.doNotCopyToBuffer)&&!r._options.doNotCopyToBuffer)r._addObjectToSbisBuffer({attachId:n,redactionId:"",fileName:t?t.fileName||t.name:null,fileSize:t?t.fileSize:0},i);if(o.id=n,"string"===typeof e)if(e.indexOf(";")>-1)o.sbisDiskId=e.split(";")[0],o.sbisDiskRedactionId=e.split(";")[1];else o.id=e;if(r._attachObjects)r._attachObjects.push(o);if(r._notify("onFinishCreateAttachment",n,{fileId:e}),s.linksInfo)r._notify("onFinishCreateLink",s.linksInfo.type,s.linksInfo.record);r._checkIfTotalComplete(s.doNotNotifyFinish),a.callback(n)}).addErrback(function(e){r._checkIfTotalComplete(),r._notify("onErrorCreateAttachment",e),a.errback(e)})}return a}},$constructor:function(){this._publish("onStartCreateAttachment","onFinishCreateAttachment","onErrorCreateAttachment","onFinishCreateAttachments","onFinishCreateLink"),this.filters=new s;var e=this;if(this._uploadManager=r.getUniqueUploadManager(),!this._uploadManager)return;this._uploadManager.filesToRewrite=[],this.subscribeTo(this._uploadManager,"Complete",function(t,s,r){var a=r.id;if(e._options.finishAttachment=true,e._isDragDrop&&false!==e._options.mainOptions.useVersionId||true===e._options.mainOptions.useVersionId)a=a+";"+r.versionId;if(e._filesArray.push({id:r.id,url:e._options.mainOptions.serviceUrl+r.versionId}),1===e._filesCounter){var o=e._filesArray.length>1?e._filesArray:e._filesArray[0];e._notify("onLoaded",o)}var l=e._getFileNameById(s),f=e._options.linkedList,d=f?f.getTreeView().getItems():null,c=f?f.getCurrentRoot():null,p;if(d&&l)d.each(function(e){if(e.get("folder")==c&&e.get("fileName")==l)p=e.get("attachId")});var u=null;if(e._filesInFolders&&e._filesInFolders.length){var h=i(e._filesInFolders,function(e){return e.uid==s});if(h>=0)if(u=e._filesInFolders[h].folder,e._filesInFolders.splice(h,1),e.nowUploading&&e._options.mainOptions.isDisk)e._options.finishAttachment=false}if(e._options.finishAttachment)e._onFinish({result:a},void 0,void 0,{needRewriteFile:!!l,attachId:p,originalResult:r,parentFolderId:u});else e._checkIfTotalComplete();if(e._onFinish!==_.after._onFinish)e._checkIfTotalComplete();if(r.versionId&&r.versionId.indexOf("_")>-1)n.NotifyRecentFileById(r.id)}),this.subscribeTo(this._uploadManager,"Start",function(i,t){e._addUploadInfo(t)}),this.subscribeTo(this._uploadManager,"Error",function(i,t,s){if(e._checkIfTotalComplete(),s.details&&s.details.indexOf("response 503")>0)s.message=rk("Сервис на техническом обслуживании."),s.details=rk("Мы знаем об этом и уже исправляем. Попробуйте заглянуть сюда через 15 минут.");c.alert({message:s.message||s.details})}),this.subscribeTo(this,"onDestroy",function(){if(e._uploadManager)e._uploadManager.destroy()})}};return _});
//# sourceMappingURL=UploadMixin.module.js.map
define("js!SBIS3.DOCVIEW.ScanMixin",["js!SBIS3.DOCVIEW.Funcs","Core/moduleStubs","Core/ParallelDeferred"],function(e,n,r){"use strict";return{$protected:{_getExistingFiles:function(){var n=e.getFileObjectsInCurrentFolder(this._options.linkedList);return e.getFilesArray(n)},_showError:function(n){e.alert({message:n.message})},_scan:function(){var t=this;n.require(["browser!js!SBIS3.Plugin/components/Extensions/Integration/FileGetter/ScannerGetter","browser!js!SBIS3.Plugin/components/Extensions/FileSystem"]).addCallback(function(n){if(!n)return;var a=new(0,n[0])({saveScansOption:0}),i=new r;a.getFiles().addCallback(function(r){var o=r.map(function(e){return e.getLink()});if(o.length){var s=new(0,n[1]);o.forEach(function(e){i.push(function(){return s.getFileInfo({path:e})})})}i.done().getResult().addCallback(function(n){for(var r in n){if(!n.hasOwnProperty(r))continue;var i=JSON.parse(n[r]);i.lastModifiedDate=Date.fromSQL(i.lastModifiedDate),i.name=e.generateScanName(i.name,t._getExistingFiles()),t.onChangeInputFile(null,i.name,i,{scanner:true})}if(a.destroy(),s)s.destroy()}).addErrback(function(e){a.destroy(),s.destroy(),t._showError(e)})}).addErrback(function(e){a.destroy(),t._showError(e)})}).addErrback(t._showError)}}}});
//# sourceMappingURL=ScanMixin.module.js.map
define("js!SBIS3.DOCVIEW.SBISBufferMixin.Logger",function(){"use strict";var e="undefined"!==typeof localStorage&&"1"===localStorage.getItem("sbis-buffer-debug");if("undefined"!==typeof window)window.sbisBufferDebug=function n(i){if(e=i,"undefined"!==typeof localStorage)localStorage.setItem("sbis-buffer-debug",+i)};function n(n){return function(){var i="undefined"!==typeof window&&window["console"];if(e&&i&&"function"===typeof i[n])i[n].apply(i,arguments)}}var i=n("log"),o=n("time"),t=n("timeEnd");return{log:i,time:o,timeEnd:t,timeLog:function(e){i.apply(null,arguments),o(e)},timeEndLog:function(e){t(e),i.apply(null,arguments)}}});
//# sourceMappingURL=Logger.module.js.map
define("js!SBIS3.DOCVIEW.SBISBufferMixin.DiskUploader",["Core/Abstract","Core/EventBus","js!SBIS3.DOCVIEW.Funcs"],function(t,i,o){"use strict";var s=t.extend({$protected:{_options:{maxParallelUploads:2,fileLoaderPluginGetter:null,accountId:""},_uploadQueue:null,_activeUploadsCount:0,_pluginUploads:{}},$constructor:function(){this._publish("onSuccess","onError");var t=i.channel("SbisPluginEvent");this.subscribeTo(t,"uploadToSbisDiskCompleteEvent",this._onUploadToSbisDiskCompleted.bind(this)),this.subscribeTo(t,"uploadToSbisDiskFatalErrorEvent",this._onUploadToSbisDiskFatalError.bind(this))},destroy:function(){this._uploadQueue=null,s.superclass.destroy.call(this)},setAccountId:function(t){this._options.accountId=t},attachClipboardFiles:function(t,i){var o=this;this._uploadQueue=t.map(function(t){return{method:t.get("folder@")?"uploadFolderToSbisDisk":"uploadToSbisDisk",params:{fileName:t.get("path"),newFileName:t.get("fileName"),targetURL:"https://"+window.location.host+"/disk/api/v1/temp/",AccountID:o._options.accountId},attachId:t.get("attachId"),isFolder:Boolean(t.get("folder@")),filters:i}}),this._startDiskUploads()},_startDiskUploads:function(){while(this._uploadQueue&&this._uploadQueue.length&&this._activeUploadsCount<this._options.maxParallelUploads)this._tryUploadNext()},_tryUploadNext:function(){if(!this._uploadQueue||!this._uploadQueue.length)return;var t=this,i=this._uploadQueue.pop(),o=function o(s){t._pluginUploads[s]={id:i.attachId,name:i.params.newFileName,isFolder:i.isFolder,filters:i.filters}},s=function(o){t._notify("onError",o,i.attachId,i.params.newFileName),t._onDiskUploadFinished()};this._activeUploadsCount+=1,this._options.fileLoaderPluginGetter().addCallbacks(function(t){return t.call(i.method,{requestParams:JSON.stringify(i.params)}).addCallback(o).addErrback(s),t},s)},_onUploadToSbisDiskCompleted:function(t,i){var s=this._pluginUploads[i.UploadGuid];if(s){var a=o.getFileName(i.UploadId,"/"),e=o.getFileName(i.UploadName);this._pluginUploads[i.UploadGuid]=null,this._notify("onSuccess",s,{id:a,name:e}),this._onDiskUploadFinished()}},_onUploadToSbisDiskFatalError:function(t,i){var o=this._pluginUploads[i.UploadGuid];if(o){var s=i.Response&&i.Response.status||i.StatusCode;this._pluginUploads[i.UploadGuid]=null,this._notify("onError",i.Message,o.id,o.name,502===s||503===s),this._onDiskUploadFinished()}},_onDiskUploadFinished:function(){this._activeUploadsCount-=1,this._tryUploadNext()}});return s});
//# sourceMappingURL=DiskUploader.module.js.map
define("js!SBIS3.DOCVIEW.SBISBufferMixin.Data",["Core/constants","WS.Data/Collection/RecordSet","WS.Data/Collection/Factory/RecordSet","js!SBIS3.DOCVIEW.Funcs","WS.Data/Chain"],function(t,e,n,i,r){"use strict";function a(e){if(!(e instanceof Date)||isNaN(+e))return"";var n=((new Date).setHours(0,0,0,0)-new Date(e).setHours(0,0,0,0))/864e5;if(0===n)return rk("Сегодня");else if(1===n)return rk("Вчера");else if(n>=2&&n<=4||n>=22&&n<=24)return n+" "+rk("дня назад");else if(21===n||31===n)return n+" "+rk("день назад");else if(n>0&&n<31)return n+" "+rk("дней назад");else return e.getDate()+" "+t.Date.monthsSmall[e.getMonth()]}function s(){return[{name:"id",type:"string"},{name:"attachId",type:"string"},{name:"absoluteServiceUrl",type:"string"},{name:"redactionId",type:"string"},{name:"hash",type:"string"},{name:"signs",type:"boolean"},{name:"canEdit",type:"boolean"},{name:"objectName",type:"string"},{name:"serviceUrl",type:"string"},{name:"endpoint",type:"string"},{name:"title",type:"string"},{name:"crypt",type:"boolean"},{name:"encrypted",type:"integer"},{name:"path",type:"string"},{name:"folder",type:"string"},{name:"folder@",type:"boolean"},{name:"folder$",type:"boolean"},{name:"fileName",type:"string"},{name:"size",type:"integer"},{name:"isLink",type:"boolean"},{name:"isFileLink",type:"boolean"},{name:"isExternal",type:"boolean"},{name:"html",type:"string"},{name:"doNotRequestPreview",type:"boolean"},{name:"previewUrl",type:"string"},{name:"previewUrlSmall",type:"string"},{name:"transactionId",type:"string"},{name:"transactionDay",type:"string"},{name:"ext",type:"string"}]}function o(t){var n;if(Array.isArray(t))n=t;else if(t instanceof e)n=r(t).map(function(t){return r(t).toObject()}).value();else n=[];return new e({rawData:n,format:s()})}function l(t,e,s){var l=a(e);this.id=t,this.date=e,this.files=r(o(s)).filter(function(t){return"string"===typeof t.get("fileName")||"string"===typeof t.get("title")||"string"===typeof t.get("url")}).map(function(e){var n=null,r=e.get("fileName")||e.get("title");if(3===e.get("type")&&null===e.get("objectName")){if(n="url",r=e.get("url").match(/(?:https:|http:)\/\/(.+)/),r instanceof Array&&r[1])r=r[1]+".url",e.set("fileName",r);else r=rk("Ссылка")+".url",e.set("fileName",r);e.set("title",e.get("url"))}return e.set({id:t+";"+e.get("attachId")+";"+e.get("redactionId"),title:r instanceof Array?(r[1]||"")+".url":r,path:3===e.get("type")?e.get("url"):e.get("path")||"",hash:e.get("hash")||"",fileHash:e.get("fileHash")||"",redactionId:null,previewUrl:e.get("previewUrl"),absoluteServiceUrl:e.get("endpoint"),objectName:3===e.get("type")?"URL":e.get("objectName"),ext:n||i.getFileExtension(r),transactionId:t,transactionDay:l}),e}).value(n),this.files.setIdProperty("attachId")}function c(t){this._transactions=t||[],this._files=this._extractFiles(this._transactions)}return c.prototype.isEmpty=function t(){return!this._transactions.length},c.prototype.getTransactionFiles=function t(e){for(var n=0;n<this._transactions.length;n++)if(this._transactions[n].id===e)return this._transactions[n].files;return null},c.prototype.getTransactions=function t(){return this._transactions},c.prototype.getFiles=function t(){return this._files},c.prototype._extractFiles=function(t){var n=new e({idProperty:"id",format:s()});return t.forEach(function(t){var e=r(t.files).toArray();n.append(e)}),n},c.prototype.removeTransaction=function t(e){for(var n=[],i=0;i<this._transactions.length;i++)if(this._transactions[i].id===e){this._transactions.splice(i,1),this._files.each(function(t,i){if(t.get("transactionId")===e)n.push(i)},null,this);break}n.forEach(function(t){this._files.removeAt(t)},this)},c.prototype.updateFile=function t(e,n,i){var r=this._files.at(this._files.getIndexByValue("attachId",e));if(r)r.set(n,i);for(var a=0;a<this._transactions.length;a++)if(r=this._transactions[a].files.getRecordById(e),r){r.set(n,i);break}},{Transaction:l,SbisBufferContent:c}});
//# sourceMappingURL=SbisBufferData.module.js.map
define("js!SBIS3.DOCVIEW.HashCounter",["Core/Abstract"],function(s){"use strict";return s.extend({$protected:{_options:{keys:[]},_values:{}},$constructor:function(){this._publish("onFinish"),this.reset(this._options.keys)},_complete:function s(t,i){if(this.has(t))this._values[t]=i,this._tryFinish()},_tryFinish:function s(){if(this.isReady())this._notify("onFinish",!this.hasErrors())},isReady:function s(){return this._keys.every(function(s){return void 0!==this._values[s]},this)},hasErrors:function(){return this._keys.some(function(s){return false===this._values[s]},this)},reset:function s(t){this._keys=Array.isArray(t)?[].concat(t):[],this._values=this._keys.reduce(function(s,t){return s[t]=void 0,s},{})},add:function s(t){if(!this.has(t))this._keys.push(t),this._values[t]=void 0},has:function s(t){return this._values.hasOwnProperty(t)},getCount:function s(){return this._keys.length},success:function s(t){this._complete(t,true)},error:function s(t){this._complete(t,false)},replace:function s(t,i){for(var e=0,n=this._keys.length;e<n;e++)if(this._keys[e]===t){this._keys[e]=i,this._values[i]=this._values[t],delete this._values[t];break}}})});
//# sourceMappingURL=HashCounter.module.js.map
define("js!SBIS3.DOCVIEW.ClipboardDataSource",["Core/core-merge","Core/helpers/String/escapeHtml","Core/helpers/random-helpers","js!SBIS3.DOCVIEW.Funcs","js!SBIS3.DOCVIEW.HashCounter","Core/Deferred","Core/ParallelDeferred","Core/EventBus","js!SBIS3.DOCVIEW.SBISBufferMixin.Data","js!SBIS3.DOCVIEW.SBISBufferMixin.Logger","WS.Data/Chain","Lib/Storage/LocalStorage","Core/UserInfo","i18n!SBIS3.DOCVIEW.SBISBufferMixin"],function(e,t,n,r,i,a,u,l,c,o,s,f,d){"use strict";var p,g=o.log,h=o.time,b=o.timeEnd,k=o.timeLog,m=o.timeEndLog,C=190,S=72,y=200,I=2,v=/^(bmp|gif|ico|jpeg|jpg|png|psd|tif|tiff|xps|xsd)$/i;function F(e){return v.test(r.getFileExtension(r.getFileName(e)))}function E(e){return"file"===e.entryType}function L(e){return"fileLink"===e.entryType}function T(e){return"directory"===e.entryType}function w(e){return"directoryLink"===e.entryType}function D(e){return"unknown"!==e.entryType}function R(e){return"link"===e.entryType}function B(e){return e.path}function x(e){var t=null,n=null,i=null;if(!e||!(e instanceof Array))return a.success(e);if(t=e[0]&&e[0].files,!t||t.getCount()>1)return a.success(e);if(i=t.at(0),"string"!==typeof i.get("path"))return a.success(e);if(n=i.get("path").match(/^\s*?https:\/\/(.*?(?:sbis\.ru|tensor\.ru))\/shared\/disk\/(.+?)(?=\/|$)/),!n||n.length<2)return a.success(e);if(n[1]===window.location.hostname)return r.readByObject(n[2]).addBoth(function(t){if(t instanceof Error)return require(["js!SBIS3.Engine.Clipboard"],function(e){new e({}).setText("")}),[];else if(t&&0===t.get("Type"))i.set("doNotRequestPreview",true),i.set("folder@",true),i.set("isLink",true);return e});else e=[];return a.success(e)}function O(e){var t=[];if(e.length)t.push(new c.Transaction("clipboard",new Date,e));return t}function j(e){return k("getImageAsPNGFile"),e.call("getImageAsPNGFile",{}).addCallback(function(e){if(b("getImageAsPNGFile"),e)return[{path:e,entryType:"file",isScreenShot:true}];return[]}).addErrback(function(e){return m("getImageAsPNGFile",e),[]})}function N(e){try{return JSON.parse(e).size||0}catch(e){return 0}}function _(e){g("parseFoldersSizes",e);var t,n={};try{t=JSON.parse(e)}catch(e){t={}}for(var r in t)if(t.hasOwnProperty(r))n[r]=Math.max(0,t[r].size);return n}function P(e){var t=new a,n;function r(e){if(!t.isReady())t.callback(e);return e}function i(e){if(!t.isReady())t.errback(e)}for(var u=0;u<e.length;u++){if(n=e[u],n.isReady()&&!n.isSuccessful())return a.fail(n.getResult());n.addCallbacks(r,i)}return t}function A(e){return Object.keys(e||{}).map(function(t){return e[t]})}function U(){if(d.get("ИдентификаторПользователя"))return a.success();return a.fail("Not authenticated")}function z(e){var t=/\/shared\/disk\/([^&#?/ ]*)/.exec(e);return t&&t[1]||null}function W(e){return k("FileSD.ReadByObject"),r.readByObject(e).addErrback(function(e){return m("FileSD.ReadByObject","ERROR",e),null})}function q(e){var t=z(e);if(t)return W(t).addCallback(function(t){if(!t)return null;var n=0===t.get("Type");if(n||r._isFileWithExtensions(t.get("Name"),["7z","rar","zip"]))return[{entryType:n?"directoryLink":"fileLink",path:e,params:{objectId:t.get("Id"),title:t.get("Name")}}];return null});return a.success(null)}function V(e){var t=new a;return require(["js!SBIS3.Engine.Utils.LinkDecorateUtil"],function(n){k("LinkDecorateUtil.decorateLink"),n.decorateLink(e).addCallbacks(function e(n){b("LinkDecorateUtil.decorateLink"),t.callback(n)},function e(n){m("LinkDecorateUtil.decorateLink","ERROR",n),t.errback(n)})},function(e){t.errback(e)}),t}function G(e,t){if(!e||!t||!t.path)return false;var n=e.files.getCount();if(t.path.length!==n)return false;for(var r=0;r<n;r++)if(t.path.indexOf(e.files.at(r).get("path"))<0)return false;return true}function M(e){this.path=s(e.files).pluck("path").value(),this.date=e.date}function H(e,t,n){this._getClipboardPlugin=e,this._getFileSystemPlugin=t,this._options=n}H.prototype._getClipboardFileInfo=function e(t){var i=this;return t.reduce(function(e,t){var a=t.path,u=R(t);if(w(t)||L(t))e[a]={attachId:t.params.objectId,path:a,folder:null,"folder@":w(t),folder$:false,fileName:t.params.title,size:0,isLink:false,isFileLink:true,isExternal:false,doNotRequestPreview:false};else e[a]={attachId:n.createGUID(),path:a,folder:null,"folder@":T(t),folder$:false,fileName:t.isScreenShot?r.generateScreenShotName(a,i._options.existingFiles):u?t.params.title+".url":r.getFileName(a),objectName:u?"URL":null,size:null,isLink:false,html:R(t)?t.params.html:null,isExternal:true,doNotRequestPreview:!u};return e},{})},H.prototype.getFilesFromClipboard=function n(c){var o=this,s=p=(new Date).getTime(),f=this._getClipboardFileInfo.bind(this);function d(){return s!==p||c&&c.isDestroyed()}function v(e){return[{entryType:"link",path:e,params:{title:e,link:e,html:'<span class="asLink">'+t(e)+"</span>"}}]}function L(e){return r.getDecoratedLink(e).addCallback(function(e){if(d()||!e.html)return[];var t=$("<div>").html(e.html).find("a").removeAttr("href").removeAttr("target").end();return e.title=t.find(".engine-DecoratedLink__title").text()||e.link,e.html=t.html(),[{entryType:"link",path:e.link,params:e}]})}function z(e){return k("getContentType"),e.call("getContentType",{}).addCallback(function(e){if(m("getContentType"),d())return 0;switch(e=String(e||"")&&e.toLowerCase(),e){case"filelist":return 1;case"image":case"html":return 2;default:if("text"===e.substring(0,4))return 3;return 0}})}function W(e){if(d())return[];function t(){return k("getText"),e.call("getText",{}).addCallback(function(e){if(m("getText"),d())return[];return n(e)})}function n(e){var t=r.parseLink(e);if(!t)return[];return U().addCallback(function(){return o._options.attachDiskLinkByUrl?q(t):null}).addCallback(function(e){if(d())return[];return e||L(t)}).addErrback(function(){if(d())return[];return v(t)})}function i(){return k("getFsEntriesList"),e.call("getFsEntriesList",{}).addCallback(function(e){if(m("getFsEntriesList",e),d())return[];return e.filter(function(e){if((T(e)||w(e))&&!o._options.allowAttachFoldersFromSbisBuffer||E(e)&&o._options.extensions&&o._options.extensions.length&&!r._isFileWithExtensions(e.path,o._options.extensions))return false;return D(e)})}).addErrback(function(e){return m("getFsEntriesList","ERROR",e),[]})}return z(e).addCallback(function(n){switch(n){case 1:return i();case 2:return j(e);case 3:return o._options.hasClipboardLink?t():[];default:return[]}})}function V(t){if(g("getFilesInfo",t.length),0===t.length)return b("ПОЛУЧЕНИЕ ДАННЫХ ИЗ БУФЕРА ОБМЕНА"),a.success([]);if(1===t.length&&R(t[0]))return b("ПОЛУЧЕНИЕ ДАННЫХ ИЗ БУФЕРА ОБМЕНА"),a.success(A(f(t)));var n={},r=false,c=new a,s=t.filter(E),p=t.filter(T),h=s.map(B),v=h.filter(F).slice(0,I),L=new i({keys:v});function w(){g("Все основные картинки готовы"),c.callback(),L.unsubscribe("onFinish",w)}if(v.length)L.subscribe("onFinish",w);else c.callback();function D(e){if(d())return e;function t(t,n){return function(){if(d())return a.success();return k("getThumbnailCutted "+t+" "+n),e.call("getThumbnailCutted",{path:t,dstWidth:n,dstHeight:n,horizontalAlign:"center",verticalAlign:"top"}).addCallbacks(function e(r){if(m("getThumbnailCutted "+t+" "+n),d())return;x(t,r,n)},function e(r){m("getThumbnailCutted "+t+" "+n,r)})}}function n(e){return t(e,C)}if(h.length)setTimeout(function(){var e=[].concat(v.map(function(e){return t(e,S)}),h.map(n));new u({steps:e}).done().getResult()},0);return e}function x(e,t,i){var a=t.replace(/^data:image\/png;base64,/,""),u=S===i;if(r)l.channel("SbisBufferEvents").notify("onThumbnailReady",e,a,u);else if((n[e]||(n[e]={}))[u?"previewUrlSmall":"previewUrl"]=a,L.has(e)&&u)g("Основная картинка готова",e),L.success(e)}function O(e){function i(t){var n=t.path;return k("getFileInfo",n),e.call("getFileInfo",{path:n}).addCallback(N).addErrback(function(e){return g("ERROR getFileInfo",e),0}).addCallback(function e(t){m("getFileInfo",n,t),c(n,t)})}function a(t){var n=(t||[]).map(B);return k("getDirectoriesInfo",n),e.call("getDirectoriesInfo",{paths:n}).addCallback(_).addErrback(function(e){return g("ERROR getDirectoriesInfo",e),{}}).addCallback(function e(t){m("getDirectoriesInfo",t),n.forEach(function(e){c(e,t[e]||0)})})}function c(e,t){if(r)l.channel("SbisBufferEvents").notify("onFileSizeReady",e,t);else(n[e]||(n[e]={})).size=t}if(s.length||p.length)setTimeout(function(){var e=s.map(i);if(p.length)e.push(a(p));new u({steps:e}).done().getResult()},0);return t}function j(t){if(0===Object.keys(t).length)return b("ПОЛУЧЕНИЕ ДАННЫХ ИЗ БУФЕРА ОБМЕНА"),[];return g("Ждём превьюшки..."),P([a.fromTimer(y),c]).addBoth(function i(){return r=true,g("Что уже готово:",n),e(t,n),b("ПОЛУЧЕНИЕ ДАННЫХ ИЗ БУФЕРА ОБМЕНА"),A(t)})}return o._getFileSystemPlugin().addCallback(D).addCallback(O).addCallback(f).addCallback(j)}return h("ПОЛУЧЕНИЕ ДАННЫХ ИЗ БУФЕРА ОБМЕНА"),this._getClipboardPlugin().addCallback(W).addCallback(V).addCallback(O).addCallback(x).addErrback(function(e){return g("ОШИБКА",e),[]})},H.restoreCachedClipboardTransaction=function(e){var t=e&&e[0],n,r;if(!t||"clipboard"!==t.id)return;if(n=new f("sbis-buffer"),r=n.getItem("clipboard-cache"),"undefined"!==typeof localStorage){if(!r)try{r=JSON.parse(localStorage.getItem("sbis-buffer-clipboard-cache/sbis-buffer-clipboard-cache"))}catch(e){r=null}localStorage.removeItem("sbis-buffer-clipboard-cache/sbis-buffer-clipboard-cache")}if(G(t,r))t.date=new Date(r.date),e.sort(function(e,t){return t.date-e.date});else n.setItem("clipboard-cache",new M(t))};function J(e,t){var n=new a;return require(["js!SBIS3.Plugin/Source/LocalService"],function(r){var i=new r({endpoint:{address:e+"-"+t,contract:e},options:{mode:"silent"}});i.isReady().addCallback(function(){n.callback(i)}).addErrback(function(e){n.errback(e)})},function(e){n.errback(e)}),n}function K(){return J("Clipboard","1.0.1.0")}function Q(){return J("FileSystem","1.0.1.0")}return H.updateClipboardCache=function(){new H(K,Q,{hasClipboardLink:true,allowAttachFoldersFromSbisBuffer:true,extensions:[],existingFiles:[]}).getFilesFromClipboard().addCallback(function(e){var t=e&&e[0]||{};if(t.date&&t.date instanceof Date)t.date.setSeconds(t.date.getSeconds()-2);H.restoreCachedClipboardTransaction(e)})},H});
//# sourceMappingURL=ClipboardDataSource.module.js.map
define("js!SBIS3.DOCVIEW.BufferList.ViewModel",["Core/helpers/Object/find","WS.Data/Chain","js!SBIS3.DOCVIEW.Funcs","Core/Deferred","Core/UserInfo"],function(e,t,i,n,r){"use strict";var o=/^(bmp|gif|ico|jpeg|jpg|png|psd|tif|tiff|xps|xsd)$/i,s=72,l=2,f=3;function c(e){return o.test(e.get("ext"))}function a(e){return"url"===e.get("ext")}function u(e){if(!e||!e.get||"disk"!==e.get("endpoint")&&"online"!==e.get("endpoint"))return new n.success(null);var t=null;if("online"===e.get("endpoint"))t=e.get("path");else t=i.getLinkUrl(e,{objectName:e.get("objectName"),serviceUrl:e.get("serviceUrl")});return i.getDecoratedLink(i.parseLink(t)).addBoth(function(e){if(e&&!(e instanceof Error)&&"string"===typeof e.html)return e.html;return null})}function p(e){var n=new t(e).toObject();if(n.previewUrlSmall)return(n.previewUrlSmall?"data:image/png;base64,":"")+n.previewUrlSmall;else if(!n.path){if(n.width=n.height=s,n.sync="__сбис__биллинг"===r.get("ЛогинКлиента"),n.sync)n.absoluteServiceUrl=n.endpoint;return i.createPreviewUrl(n)}}var d=[{rx:/^(log|txt)$/i,icon:"TFDocument"},{rx:/^(doc|docm|docx|dot|dotm|dotx|odt|rtf)$/i,icon:"TFDocumentW"},{rx:/^(odp|pot|potm|potx|pps|ppsm|ppsx|ppt|pptm|pptx)$/i,icon:"TFDocumentP"},{rx:/^(pdf)$/i,icon:"TFDocumentPDF"},{rx:/^(csv|ods|xls|xlsb|xlsm|xlsx)$/i,icon:"TFDocumentX"},{rx:/^(xml)$/i,icon:"TFDocumentXml"},{rx:o,icon:"TFImage"},{rx:/^(mp3|wav)$/i,icon:"TFFileAudio"},{rx:/^(3gp|avi|flv|m4v|mkv|mov|mp4|mpeg|mpg|ogv|vob|webm|wmv)$/i,icon:"TFFileVideo"},{rx:/^(7z|rar|zip)$/i,icon:"TFZip"},{rx:/.*/i,icon:"DocumentUnknownType"},{rx:/^(vsd|vsdx)$/i,icon:"TFDocumentVsdx"}];function m(t){if(t.get("folder@"))return"TFFolder";var i=t.get("ext");return e(d,function(e){return e.rx.test(i)}).icon}function g(e){var i=e&&e.files;function n(e,t){if(e.type=g.TYPE_LIST,!(t instanceof Array))return e.type=g.TYPE_EMPTY,void(e.files=[]);e.files=t.slice(0,f).map(function e(t){return{id:t.getId(),name:t.get("title")||t.get("fileName"),icon:m(t)}}),e.more=t.length-e.files.length}if(!i||!i.getCount())this.type=g.TYPE_EMPTY,this.files=[];else{var r=new t(i).toArray(),o=r.filter(c).slice(0,l).map(function e(t){return{id:t.getId(),src:p(t)}});if(this.date=e.date?new Date(e.date):new Date,this.id=e.id,this.date<(new Date).setMinutes(-24*60))this.type=g.TYPE_SIMPLE,this.files=[];else if(o.length)this.type=g.TYPE_IMAGE,this.files=o,this.more=i.getCount()-this.files.length;else if(1===i.getCount()&&a(i.at(0))){this.type=g.TYPE_LINK;var s=i.at(0),d=s.get("html");if("string"===typeof d)this.html=d;else{var h=this;h._wait=u(s).addCallback(function(e){if(!e||"string"!==typeof e)n(h,r);return h.html=e,h})}}else n(this,r)}}return g.TYPE_SIMPLE="simple",g.TYPE_EMPTY="empty",g.TYPE_IMAGE="image",g.TYPE_LINK="link",g.TYPE_LIST="list",g.isReady=function e(t){if(t.type===g.TYPE_IMAGE){for(var i=0;i<t.files.length;i++)if(null==t.files[i].src)return false}else if(t.type===g.TYPE_LINK)if(t._wait instanceof n)return t._wait.isReady();return true},g.wait=function e(t){if(t.type===g.TYPE_LINK)if(t._wait instanceof n)return t._wait;return n.success(t)},g.interrupt=function e(t){if(t.type===g.TYPE_LINK)if(t._wait instanceof n&&!t._wait.isReady())t._wait.cancel(),t._wait=null},g.getFile=function t(i,n){return i.files&&e(i.files,function(e){return e.id===n})},g});
//# sourceMappingURL=ViewModel.module.js.map
define("js!SBIS3.DOCVIEW.BufferList.Cache",["Core/helpers/setSessionStorageValue","Core/helpers/getSessionStorageValue"],function(e,t){"use strict";function i(e){e=e||{},this.content=e.content||"",this.type=e.type||"",this.isEnabled=e.isEnabled?"1":"",this.viewModel=this.content?e.viewModel:null,this.date=e.date&&"string"===typeof e.date?new Date(e.date):null,this.id=e.id||null}return{_type:function(e){return e||"sbis"},load:function(e){var n=t("sbis-buffer-cache_"+this._type(e)),s;if(!n)s={};else try{s=JSON.parse(n)||{}}catch(e){s={}}return new i(s)},save:function(t,n){if(!n.content&&"mobile"!==t&&"1"!==n.isEnabled){var s=this.load(t).content;if(s)n=new i({id:n.id,content:s,isEnabled:n.isEnabled,viewModel:n.viewModel,type:n.type})}e("sbis-buffer-cache_"+this._type(t),JSON.stringify(n))}}});
//# sourceMappingURL=Cache.module.js.map
define("js!SBIS3.DOCVIEW.BufferListRender",["Core/Abstract","js!SBIS3.DOCVIEW.BufferList.Cache","js!SBIS3.DOCVIEW.BufferList.ViewModel","Core/EventBus","Core/Deferred","optional!Lib/ServerEvent/Bus","js!SBIS3.DOCVIEW.SBISBufferMixin.Logger"],function(e,i,n,t,r,s,f){"use strict";var o=100;function d(e,i){var t="tmpl!SBIS3.DOCVIEW.BufferList/view/"+e+"/",s,f=new r;switch(i){case n.TYPE_IMAGE:s=t+"Image";break;case n.TYPE_LINK:s=t+"Link";break;case n.TYPE_SIMPLE:s=t+"BufferList";break;default:s=t+"List"}return require([s],function(e){f.callback(e)},function(){f.errback()}),f}function l(e,i){return f.log("BufferListRender: рендер модели",i),n.wait(i).addCallback(function(i){return f.log("BufferListRender: модель готова для отрисовки",i),d(e,i.type).addCallback(function(e){return e(i)}).addErrback(function(){f.log("BufferListRender: не удалось получить шаблон")})})}function a(e,i,n){t.channel("SbisBufferEvents").notify("onRenderBufferListImage",e,i,n)}function u(e,i,n){t.channel("SbisBufferEvents").notify("onRenderBufferList",e,i,n)}function c(e,t,r){var s={};if(s.content=t,s.viewModel=r,s.isEnabled=r.type!==n.TYPE_EMPTY?"1":"",s.type=r.type,r.date)s.date=r.date;if(r.id)s.id=r.id;r._wait&&delete r._wait,i.save(e,s)}var y=e.extend({$protected:{_itemContent:null,_viewModels:{},_indicatorDelay:null,_typesTransactions:["sbis","mobile"]},$constructor:function(){var e=this,n=t.channel("SbisBufferEvents");if(this._typesTransactions.map(function(n){e._viewModels[n]=i.load(n)}),this.subscribeTo(n,"onLastTransactionLoaded",this._onLastTransactionLoaded.bind(this)),this.subscribeTo(n,"onPreviewChanged",this._onPreviewChanged.bind(this)),s)this.subscribeTo(s.serverChannel("docview.previewready"),"onMessage",function(i,n){e._onDocumentViewerChannelMessage(n)})},_isOnlyClipboard:function(e){return e instanceof Array&&1===e.length&&e[0]&&"clipboard"===e[0].id},_getTransaction:function(e){return e instanceof Array&&e.length?e[0]:null},_onLastTransactionLoaded:function(e,i,t,r){var s=this._viewModels[i]||new n(null),o=new n(this._getTransaction(t)),d=this._isOnlyClipboard(t),a=true;if(f.log("BufferListRender["+i+"]: пришла новая модель",s,o),r&&o.type===n.TYPE_EMPTY){if(s.type!==o.type)u(i,"",s);return}if(o.type===n.TYPE_SIMPLE){if(f.log("BufferListRender["+i+"]: модель с давним сроком, не показываем в меню",o),o.type!==s.type)c(i,"",o),u(i,"",o);return}if(this._viewModels[i]=o,s.type===n.TYPE_LINK&&!n.isReady(s))n.interrupt(s);if(s.type!==n.TYPE_EMPTY&&o.type===n.TYPE_IMAGE&&s.type===o.type)if(!n.isReady(o)&&s.files&&s.files.length===o.files.length){f.log("BufferListRender["+i+"]: в новой модели столько же картинок, возьмём готовые из старой модели");for(var y=0;y<s.files.length;y++)if(null==o.files[y].src&&null!=s.files[y].src)o.files[y].src=s.files[y].src;if(!n.isReady(o))f.log("BufferListRender["+i+"]: модель не готова"),a=false}else f.log("BufferListRender["+i+"]: модель уже готова");if(a){if(f.log("BufferListRender["+i+"]: перерисуем модель"),d&&o.date&&s.date&&o.date<=s.date){if(f.log("BufferListRender["+i+"]: новая модель это clipboard и не новее старой"),o.id!==s.id)return void f.log("BufferListRender["+i+"]: тогда не перерисовываем");f.log("BufferListRender["+i+"]: но необходимо перерисовать, обе модели из буфера ОС")}l(i,o).addCallback(function(e){c(i,e,o),u(i,e,o)})}else c(i,null,o)},_onDocumentViewerChannelMessage:function e(i){if(i&&(!i.has("IsError")||!i.get("IsError"))&&i.get("Width")===o&&i.get("Height")===o)this._findFileById(i.get("ID")).forEach(function(e){var i=e.file;if(!e.model||e.model.type!==n.TYPE_IMAGE)return;if(i)i.src=i.src.replace(/&id=(\d+)$/,function(e,i){return"&id="+ ++i}),this._renderModel(e.type,e.model),l(e.type,e.model).addCallback(function(n){c(e.type,n,e.model),a(e.type,i.id,i.src)})})},_onPreviewChanged:function(e,i,t){f.log("BufferListRender: пришла готовая картинка",i),this._findFileById(i).forEach(function(e){var r=e.file;if(r){if(r.src===t)return void f.log("BufferListRender: картинка не изменилась");if(n.isReady(e.model))r.src=t,f.log("BufferListRender: Обновляем существующую картинку."),l(e.type,e.model).addCallback(function(n){c(e.type,n,e.model),a(e.type,i,t)});else if(f.log("Ждём, когда будут готовы все превьюшки."),r.src=t,n.isReady(e.model))f.log("BufferListRender: Все превьюшки готовы."),l(e.type,e.model).addCallback(function(i){c(e.type,i,e.model),u(e.type,i,e.model)})}else f.log("BufferListRender: файла нет в модели",e.model)})},_findFileById:function(e){var i=[];for(var t in this._viewModels)if(this._viewModels.hasOwnProperty(t)){var r=n.getFile(this._viewModels[t],e);if(r)i.push({model:this._viewModels[t],file:r,type:t})}return i}}),h,p=0;return{init:function(){if(!h)h=new y;p+=1},ensure:function(){if(!h)h=new y;if(p<1)p=1},destroy:function(){if(p<=1&&h)h.destroy(),h=null;if(p>0)p-=1}}});
//# sourceMappingURL=BufferListRender.module.js.map
define("js!SBIS3.BL.SbisBuffer",["WS.Data/Entity/Record","WS.Data/Collection/RecordSet","WS.Data/Source/SbisService"],function(e,t,n){"use strict";var r;function a(){if(!r)r=new n({endpoint:{address:"/sbisbuffer/service/",contract:"SBISBuffer"}});for(var e=[],t=0,a=arguments.length;t<a;t++)e[t]=arguments[t];return r.call.apply(r,e)}function i(e){return e?e.getAll():null}function o(e){return e?e.getRow():null}function s(e){return e?e.getScalar():null}return{AddObjects:function n(r,i){var o=[{name:"attachId",type:"string"},{name:"redactionId",type:"string"},{name:"documentId",type:"string"},{name:"fileName",type:"string"},{name:"title",type:"string"},{name:"objectName",type:"string"},{name:"serviceUrl",type:"string"},{name:"folder@",type:"boolean"},{name:"signs",type:"boolean"},{name:"crypt",type:"boolean"},{name:"encrypted",type:"integer"},{name:"hash",type:"string"},{name:"type",type:"integer"},{name:"url",type:"string"},{name:"size",type:"integer"}],s=new t({adapter:"adapter.sbis",format:o}),l=r.map(function(t){var n=new e({adapter:"adapter.sbis",format:o});return n.set(t),n.set("crypt",Boolean(n.get("encrypted")>1)),n});return s.append(l),a("AddObjects",{IsPersistent:Boolean(i||void 0===i),Content:s})},GetAllObjectsInfo:function e(t){return a("GetAllObjectsInfo",t||{}).addCallback(i)},DeleteObjects:function e(t){return a("DeleteObjects",{Content:t}).addCallback(s)},IsInstallMobileApp:function e(){return new n({endpoint:{address:"/mobile-service/service/",contract:"Device"}}).call("IsInstalled",{appName:"СБИС"}).addCallback(s)},SendPushToMobile:function e(){return a("SendPushToMobile",{})}}});
//# sourceMappingURL=SbisBuffer.module.js.map
define("js!SBIS3.DOCVIEW.SBISBufferMixin",["WS.Data/Entity/Record","WS.Data/Collection/RecordSet","WS.Data/Source/SbisService","WS.Data/Chain","optional!Lib/ServerEvent/Bus","Core/helpers/String/format","Core/detection","js!SBIS3.DOCVIEW.Funcs","js!SBIS3.BL.SbisBuffer","Core/Deferred","Core/ParallelDeferred","Core/EventBus","Core/CommandDispatcher","Core/Indicator","Core/IoC","Core/core-instance","js!SBIS3.DOCVIEW.SBISBufferMixin.Data","js!SBIS3.DOCVIEW.SBISBufferMixin.DiskUploader","js!SBIS3.DOCVIEW.ClipboardDataSource","js!SBIS3.DOCVIEW.SBISBufferMixin.Logger","js!SBIS3.DOCVIEW.HashCounter","js!SBIS3.DOCVIEW.BufferListRender","preload!SBIS3.CONTROLS/Utils/InformationPopupManager","js!SBIS3.Engine.Clipboard","i18n!SBIS3.DOCVIEW.SBISBufferMixin"],function(e,t,i,n,r,s,a,o,l,f,c,u,d,h,S,_,p,g,b,m,I,v,B,C){"use strict";function E(e){require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(t){t.showMessageDialog({message:e,status:"error"})})}function L(e,t){require(["SBIS3.CONTROLS/Utils/InformationPopupManager","Core/helpers/String/escapeHtml"],function(i,n){var r=t instanceof Error?t.message:String(t||""),s;if(r)s=function(){return'<div class="docview-notification__footer"><div class="docview-notification__footer-text">'+n(r)+"</div></div>"};i.showNotification({caption:e,status:"error",footerTemplate:s})})}function A(e){require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(t){t.showNotification({caption:e,status:"info"})})}function F(e){L(rk("Ошибка при прикреплении файла"),e)}function O(e){L(rk("Ошибка при удалении файла"),e)}function k(e,t,i){return(e||[]).filter(function(e){var n=[];return e.files.each(function(e){var r=false;if(Boolean(e.get("folder@")))r=!t;else if(i&&i.length)r=!o._isFileWithExtensions(e.get("fileName"),i);if(r)n.push(e)}),n.forEach(function(t){e.files.remove(t)}),e.files.getCount()>0})}function y(){(new C).getChannel().subscribe("onSetData",function(e,t,i){var n=null;if("text/plain"===t&&(n=o.parseLink(i)))l.AddObjects([{url:n,type:3}]);e.setResult(null)})}var M=m.log,P=m.time,w=m.timeEnd,D=p.Transaction,T=p.SbisBufferContent,N={MOBILE:1,SBIS:2,CLIPBOARD:4,ALL:7,MOBILE_KEY_NAME:"mobile",SBIS_KEY_NAME:"sbis",CLIPBOARD_KEY_NAME:"clipboard"},R={$protected:{_options:{multiSelect:true,allowAttachFoldersFromSbisBuffer:false,sbisBufferMenuItemId:"sbisbuffer",mobileBufferMenuItemId:"mobilebuffer",maxParallelUploads:2,preloadClipboardContent:true},_isPluginAvailable:null,_sbisPluginService:null,_clipboardPlugin:null,_fileSystemPlugin:null,_fileLoaderPlugin:null,_bufferDataLoading:null,_currentAttachSession:null,_menuControl:null,_missingFileSizes:new I,_waitFileSizes:null,_filesArray:[],_filesCounter:0,_uploader:void 0},$constructor:function(){this._publish("onFinishCreateAttachments");var e=this;this._uploader=new g({maxParallelUploads:this._options.maxParallelUploads,fileLoaderPluginGetter:this._getFileLoaderPlugin.bind(this)}),this.subscribeTo(this._uploader,"onSuccess",this._onUploadToSbisDiskSuccess.bind(this)),this.subscribeTo(this._uploader,"onError",this._onUploadToSbisDiskError.bind(this)),d.declareCommand(this,"openSbisBufferWindow",function(){return e.openBufferWindow(N.SBIS),true}),d.declareCommand(this,"attachWaitMobileBuffer",function(){return l.IsInstallMobileApp().addCallback(function(t){if(t)e.showPopupWaitLoad();else e.showPopupSetupMobile();e._hidePicker()}),true}),d.declareCommand(this,"attachFromSbisBuffer",function(t){return e.attachLastTransaction(N.SBIS),e._hidePicker(),true}),this._currentAttachSession=new I,this.subscribeTo(this._currentAttachSession,"onFinish",function(){if(h.hide(),e._attachObjects&&e._attachObjects.length)e._notify("onFinishCreateAttachments",e._attachObjects),e._attachObjects=[];else e._notify("onFinishCreateAttachments")}),this.subscribeTo(u.channel("SbisBufferEvents"),"onThumbnailReady",this._onThumbnailReady.bind(this)),this.subscribeTo(u.channel("SbisBufferEvents"),"onFileSizeReady",this._onFileSizeReady.bind(this)),B(),this._preloadPlugins(),this.once("onDestroy",function(){e._destroyPlugin("_clipboardPlugin"),e._destroyPlugin("_fileSystemPlugin"),e._destroyPlugin("_fileLoaderPlugin"),e._uploader.destroy(),e._uploader=e._missingFileSizes=e._menuControl=e._sbisPluginService=e._bufferDataLoading=null,d.deleteCommandsForObject(this),v.destroy()})},_preloadPlugins:function(){this._getClipboardPlugin(),this._getFileSystemPlugin()},_updateMissingFileSizes:function(e){var t=e.filter(function(e){return e.get("path")&&null==e.get("size")&&"url"!==e.get("ext")}).map(function(e){return e.get("path")});return this._missingFileSizes.reset(t),this._missingFileSizes},_onUploadToSbisDiskSuccess:function(e,t,i){this._currentAttachSession.replace(t.id,i.id),this._attachFile({id:i.id,name:i.name,isFolder:t.isFolder,isLink:false,filters:t.filters,isExternal:true})},_onUploadToSbisDiskError:function(e,t,i,n,r){this._currentAttachSession.error(i),this._notifyAttachError(t,n,r)},showPopupSetupMobile:function(){var e=this;require(["SBIS3.CONTROLS/InformationPopup","tmpl!SBIS3.DOCVIEW.SbisBufferWindow/view/SetupPopup","SBIS3.CONTROLS/Button","SBIS3.CONTROLS/Link","css!SBIS3.DOCVIEW.SbisBufferWindow/view/PopupWindow"],function(t,i){if(!t||!i)return;var n=new t({element:$("<div></div>"),corner:{tr:true},isModal:true,opener:e,template:i}),r=n.getChildControlByName("SBISBufferMobile_RejectionSetup");e.subscribeTo(r,"onActivated",function(){n.close()}),e.subscribeTo(n,"onClose",function(){n=null}),n.show()})},showPopupWaitLoad:function(){var e=this;require(["SBIS3.CONTROLS/InformationPopup","tmpl!SBIS3.DOCVIEW.SbisBufferWindow/view/WaitLoadPopup","SBIS3.CONTROLS/Button","css!SBIS3.DOCVIEW.SbisBufferWindow/view/PopupWindow"],function(i,n){if(!i||!n)return;function s(i,n){if(m.log("SbisBufferMixin: полученны файлы "),!n||n.get("IsPersistent"))return;var r=new t({adapter:"adapter.sbis"}),s=[];if(r.append([n]),e._produceTransaction(r).forEach(function(e){if(e.files)e.files.each(function(e){s.push(e)})}),e.attachFiles(s,"Copy"),a&&a.close)a.close()}var a=new i({element:$("<div></div>"),corner:{tr:true},isModal:true,opener:e,template:n}),o=a.getChildControlByName("SBISBufferMobile_closeWait");if(l.SendPushToMobile(),r)e.subscribeTo(r.serverChannel("sbisbuffer.objectsadded"),"onMessage",s);e.subscribeTo(o,"onActivated",function(){a.close(),a=null}),e.subscribeTo(a,"onClose",function(){if(r)e.unsubscribeFrom(r.serverChannel("sbisbuffer.objectsadded"),"onMessage",s);a=null}),a.show()})},openBufferWindow:function(e){var t=this,i=Boolean(N.SBIS&e),n=this._getBufferContent(e);this._hidePicker();function s(e,n){var r=N.SBIS_KEY_NAME,s=N.SBIS|N.CLIPBOARD;if(n.get("IsPersistent")&&!i)s=N.MOBILE,r=N.MOBILE_KEY_NAME;t._getBufferContent(s,true).addCallback(function(e){var t=e&&e.fromService&&e.fromService[r];if(t)u.channel("SbisBufferEvents").notify("onUpdateBufferContent",t.getFiles());return e})}function a(e,i){var n={name:"SbisBufferWindow",template:"js!SBIS3.DOCVIEW.SbisBufferWindow",className:"ws-float-area__block-layout",opener:t,enable:true,allowChangeEnable:false,isStack:true,autoHide:true,minWidth:614,autoCloseOnHide:true,modal:true,handlers:{onClose:function(e){if(r)t.unsubscribeFrom(r.serverChannel("sbisbuffer.objectsadded"),"onMessage",s)},onShow:function(e){if(r)t.subscribeTo(r.serverChannel("sbisbuffer.objectsadded"),"onMessage",s)}},componentOptions:{captionWindow:N.SBIS_KEY_NAME===e?"Буфер обмена":"Мобильный буфер обмена",insertMode:"Copy",hideInsertMode:N.SBIS_KEY_NAME===e?t._options.hideInsertMode:true,hasClipboardLink:N.SBIS_KEY_NAME===e?t._options.hasClipboardLink:false,content:i.getFiles(),multiselect:void 0===t._options.multiselect?t._options.multiSelect:t._options.multiselect,handlers:{onSelectFiles:function(e,i,n){t.attachFiles(i,n)},onDeleteFiles:function(e,i){e.setResult(t.deleteFiles(i))}}}};require(["Core/helpers/Hcontrol/showFloatArea"],function(e){e(n)})}function o(e){var t=e.fromService&&e.fromService[N.SBIS_KEY_NAME];if(t)a(N.SBIS_KEY_NAME,t);return e}function f(e){var i=null;if(e.dataMobileBuffer&&e.dataMobileBuffer.fromService)i=e.dataMobileBuffer.fromService[N.MOBILE_KEY_NAME];if(i&&!i.isEmpty())a(N.MOBILE_KEY_NAME,i);else if(e.checkMobileApp)t.showPopupSetupMobile();else t.showPopupWaitLoad();return e}if(e&N.MOBILE)return new c({steps:{checkMobileApp:l.IsInstallMobileApp(),dataMobileBuffer:n}}).done().getResult().addCallback(f);n.addCallback(o)},fillBufferList:function(e){if(v.ensure(),u.channel("SbisBufferEvents").notify("onStartContentLoading"),e)return this._getBufferContent(N.CLIPBOARD);return this._getBufferContent(N.ALL,true)},after:{_createFiltersForAttachFile:function(t){var i=this._options.mainOptions,n=new e({adapter:"adapter.sbis",format:[{name:"catalogId",type:"string"},{name:"rootId",type:"string"},{name:"createLink",type:"boolean"}]});return n.set({catalogId:this._options.destinationDir||i.fixId||i.ctxLinkId&&this.getLinkedContext().getValue(i.ctxLinkId)||"",rootId:i.filter&&i.filter.MainHierarchyName||i.filter&&i.filter.catalogId||"",createLink:Boolean(t)}),n}},_hidePicker:function(){if(this._menuControl)this._menuControl.hidePicker()},_attachFile:function(e){var t=this,n={attachId:e.id.indexOf("_")>0?e.id.split("_")[0]:e.id,filters:e.filters||this._createFiltersForAttachFile(e.isLink),isFolder:e.isFolder,serviceUrlSrc:"/disk/api/v1/",objectNameSrc:"FileSD",serviceUrlDest:this._options.mainOptions.serviceUrl,objectNameDest:this._options.mainOptions.objectName};new i({endpoint:{contract:"SBISBuffer",address:"/sbisbuffer/service/"}}).call("DirectAttachObject",n).addCallback(function i(n){var r=t._parseAttachObjectResult(e,n.getRow());if(r.error)if(r.fileId)A(r.error);else return new Error(r.error);t._handleAttachObjectSuccess(r)}).addErrback(function(i){t._handleAttachObjectListErrors([{data:e,error:i}])})},_attachObjectList:function(e,t){var i=this;if(!e||!e.length)return;this._callAttachObjectList(e,t).addCallback(function t(n){var r=i._groupAttachObjectListResults(e,n);i._handleAttachObjectListErrors(r.error),r.success.forEach(function(e){i._handleAttachObjectSuccess(e)}),r.warning.forEach(function(e){A(e.error)})}).addErrback(function(t){i._handleAttachObjectListErrors(e.map(function(e){return{data:e,error:t}}))})},_notifyStartCreateAttachment:function(e){var t=[],i=new f;e.forEach(function(e){t.push({file:{name:e.get("fileName")||""}})});var n=f.callbackWrapper(this._notify("onStartCreateAttachment",this.filters,t),function(t){if(false==t)return;i.callback(e)});return i},_callAttachObjectList:function(e,t){return new i({endpoint:{contract:"SBISBuffer",address:"/sbisbuffer/service/"}}).call("AttachObjectList",{objectName:this._options.mainOptions.objectName,serviceUrl:this._options.mainOptions.serviceUrl,filters:this._createFiltersForAttachFile(t),attachInfo:this._createAttachInfoRecordSet(e)}).addCallback(function(e){return e.getAll()})},_createAttachInfoRecordSet:function(i){var n=[{name:"attachId",type:"string"},{name:"transactionId",type:"uuid"}],r=new t({adapter:"adapter.sbis",format:n}),s=i.map(function(t){var i=new e({adapter:"adapter.sbis",format:n});return i.set({attachId:t.id,transactionId:t.transactionId}),i});return r.append(s),r},_groupAttachObjectListResults:function(e,t){for(var i=[],n=[],r=[],s,a=0;a<e.length;a++){var o=e[a];if(s=this._parseAttachObjectResult(o,t.getRecordById(o.id)),s.fileId){if(i.push(s),s.error)n.push(s)}else r.push(s)}return{success:i,warning:n,error:r}},_parseAttachObjectResult:function(e,t){var i=t.get("fileId"),n=t.get("ErrorMessage"),r={data:e,fileId:i,error:""};if("string"===typeof n)if(i){if(n)r.error=n,e.isLink=false}else r.error=n||rk("Произошла ошибка при прикреплении файла.");return r},_handleAttachObjectListErrors:function(e){if(!e||!e.length)return;var t=this;e.forEach(function(e){t._currentAttachSession.error(e.data.id),t._notifyAttachError(e.error,e.data.name),t._filesCounter--}),h.hide()},_handleAttachObjectSuccess:function(e){var t=this,i=e.data,n;this._notifyOnLoaded(e),this._filesCount--,n=this._onFinish(e.fileId,i.isFolder,{isExternal:Boolean(i.isExternal)},{useSingleProcessing:!this._options.mainOptions.isDisk,isLastObject:0===this._filesCount,doNotCopyToBuffer:true,doNotNotifyFinish:true,originalFile:{attachId:i.id,name:i.name,redactionId:i.redactionId,hash:i.hash,objectName:i.objectName,serviceUrl:i.serviceUrl,isLink:i.isLink}}),f.callbackWrapper(n,function(){t._currentAttachSession.success(i.id)})},_notifyOnLoaded:function(e){if(this._options.mainOptions.isDisk){var t={url:this._options.mainOptions.serviceUrl+e.fileId,id:e.fileId};if(this._filesArray.push(t),1===this._filesCounter){var i=this._filesArray.length>1?this._filesArray:t;this._notify("onLoaded",i)}}},attachLastTransaction:function(e,t,i){var r=this,s=N.SBIS_KEY_NAME,a=N.SBIS;if(e===N.CLIPBOARD)a=N.CLIPBOARD;else if(e===N.MOBILE)s=N.MOBILE_KEY_NAME,a=N.MOBILE;if(!this._isAttachmentPossible())return;if(this._isTypeBufferContent(a))this._bufferDataLoading.addCallback(function(e){var o=null,l=[],f=e.fromService&&e.fromService[s]&&e.fromService[s].getTransactions();if(f&&f.length)if(o=n(f).where({id:t}).value()[0],o&&o.files)l=n(o.files).toArray();if(i)l=l.filter(function(e){return e.getId()===String(i)});if(r._options.multiSelect&&l.length||1===l.length){var c=l[0];if(c.get("isFileLink")){if(r._attachSbisDiskFile)r._attachSbisDiskFile({id:c.get("attachId"),isFolder:c.get("folder@"),isLink:false})}else if("url"===c.get("ext")&&c.get("html"))r._notifyStartAndAttachFiles(l);else r.attachFiles(l,"Copy")}else r.openBufferWindow(a);return e})},_attachLink:function(e){var t=this._currentAttachSession,i=this.getId(),n=e.get("attachId"),r=e.get("title"),s=e.get("path");t.add(n),o.getLinkInfo(s).addCallback(function(e){var t=e.getRow();if(!!t.get("brief"))r=t.get("brief");else if(t.get("title")!==s)if(!!t.get("title"))r=t.get("title");else r=t.get("name");return u.channel("SbisBufferEvents").notify("onInsertLink",r,s,i)}).addCallback(function(){t.success(n)}).addErrback(function(){t.error(n)})},_setFileInsertMode:function(e,t){var i=this,r="Copy";if(t&&"string"===typeof t)r=t;return n(e).reduce(function(e,t){return e.addCallback(function(e){if("boolean"===typeof t.get("isLink"))return e;if(e)return t.set("isLink","Link"===e),e;return t.set("isLink",false),"Copy"})},f.success(r))},attachFiles:function(e,t){if(!this._isAttachmentPossible())return;var i=this;function n(){if(i._updateMissingFileSizes(e).isReady())return M("Размеры всех файлов уже известны."),f.success();else return h.setMessage(rk("Ожидайте")+"..."),M("Осталось получить размеры "+i._missingFileSizes.getCount()+" объектов"),i._waitFileSizes=new f}function r(t){for(var n=0,r,a=0,o=e.length;a<o;a++){if(r=!e[a].get("isLink")&&e[a].get("size")||0,r>t.quotas.maxFileSize)return h.hide(),void i._notifyAttachError(s({max:t.quotas.maxFileSize/(1024*1024)},rk("Не поддерживается загрузка файлов больше $max$d$ Мб")),e[a].get("fileName"));n+=r}if(t.quotas.availableSpace>=n)i._notifyStartAndAttachFiles(e);else h.hide(),i._notifyAttachError(rk("Недостаточно места для вставки выбранных файлов."))}new c({steps:{modes:this._setFileInsertMode(e,t),quotas:this._getAvailableSpace(),allSizesReady:n()}}).done().getResult().addCallback(r)},_notifyStartAndAttachFiles:function(e){this._notifyStartCreateAttachment(e).addCallback(this._attachFiles.bind(this))},_attachFiles:function(e){var t=[],i=[],n=[],r,s=this;function a(e){s._attachObjectList(i.filter(function(t){return t.isLink===e}),e)}function l(e){if("string"!==typeof e)return false;return 0===e.indexOf(window.location.protocol+"//"+window.location.hostname+"/shared/disk/")}function f(e){if(!e||!e.get)return false;if("string"!==typeof e.get("path"))return false;return"url"===e.get("ext")&&o.parseLink(e.get("path"))}this._filesCounter=e.length,this._filesCount=e.length,h.setMessage(rk("Ожидайте")+"..."),this._currentAttachSession.reset();for(var c=0;c<e.length;c++){var u=(r=e[c]).get("serviceUrl");if(u&&"/"!==u)this._currentAttachSession.add(r.get("attachId")),i.push({id:r.get("attachId"),redactionId:r.get("redactionId"),transactionId:r.get("transactionId"),hash:r.get("hash"),objectName:r.get("objectName"),serviceUrl:r.get("serviceUrl"),name:r.get("fileName")||"",isFolder:r.get("folder@"),isLink:r.get("isLink")||false,isExternal:Boolean(r.get("isExternal"))});else if(f(r))if((l(r.get("fileName"))||l(r.get("path")))&&"Copy"!==this._options.insertMode)n.push(r.get("path")),this._filesCount--;else this._attachLink(r);else this._currentAttachSession.add(r.get("attachId")),t.push(r)}if(i.length)a(true),a(false);if(t.length)this._uploader.attachClipboardFiles(t,this._createFiltersForAttachFile(false));if(n.length)require(["js!SBIS3.DOCVIEW.LoadHelpers"],function(e){n.forEach(function(t){e.attachLinkFromSbisDisk.call(s,t).addErrback(function(e){h.hide(),s._currentAttachSession.error(e.message),s._notifyAttachError(e.message)})})})},_getAvailableSpace:function(){var e=this,t=this._options.mainOptions.objectName;if("FileSD"===t){var n=this._options.mainOptions.fixId||this._options.mainOptions.filter&&this._options.mainOptions.filter.catalogId||this._options.destinationDir;if(n)return new i({endpoint:{contract:t,address:this._options.mainOptions.serviceUrl+"service/"}}).call("GetQuota",{RootName:n}).addCallback(function e(t){var i=t.getRow(),n=i.get("MaxSize"),r=1/0;if(null!=n)r=n-(i.get("CurrentSize")||0);return{maxFileSize:1/0,availableSpace:r}}).addErrback(function(){return{maxFileSize:1/0,availableSpace:1/0}})}return f.success({maxFileSize:1024*Math.min(e._options.maxFileSizeInMB||50,50)*1024,availableSpace:1/0})},_convertDeletedContentToRecordSet:function(i){var n=new t({adapter:"adapter.sbis",format:[{name:"Id_Transaction",type:"uuid"},{name:"Id_Content",type:"string"}]}),r=i.map(function(t){var i=new e({adapter:n.getAdapter(),format:n.getFormat()});return i.set({Id_Transaction:t.get("transactionId"),Id_Content:t.get("attachId")}),i});return n.append(r),n},deleteFiles:function(e){var t=this._convertDeletedContentToRecordSet(e);return this._removeFromService(t).addErrback(O)},_removeFromService:function(e){if(e.getCount())return l.DeleteObjects(e).addCallback(function(e){return""===e});return f.success(true)},_isTypeBufferContent:function(e){return Boolean(e&this._lastServiceType)},_getBufferContent:function(e,t){var i=this,n=null;if(e&this._lastServiceType&&this._bufferDataLoading&&!t){if(this._bufferDataLoading.isSuccessful())return f.success(this._bufferDataLoading.getResult());return this._bufferDataLoading}this._lastServiceType=e||0;function r(e){return i._getFilesFromClipboard().addCallback(function t(r){if(N.CLIPBOARD&e)if(N.CLIPBOARD===i._lastServiceType)n.callback([]);else if(i._lastServiceType!==e&&i._lastServiceType===N.ALL)n.dependOn(i._getFilesFromServices(i._lastServiceType));return r})}function s(e){if(!e||!e.get)return false;return"url"===e.get("ext")&&e.get("path")}function a(e){if(!(e instanceof Array))return e;var t=null,i=null,n=[],r,a,o;for(a=0;a<e.length;a++){if(o=e[a],!i)if(o&&o.id===N.CLIPBOARD_KEY_NAME){if(o.files||1===o.files.getCount())if(i=o.files.at(0),s(i)){r=a;continue}break}if(o.files&&1===o.files.getCount()){if(t=o.files.at(0),s(t)&&n.push(t),!i)continue;while(t=n.shift())if(t.get("path")===i.get("path"))return e.splice(r,1),e}}return e}function o(e){return[N.SBIS_KEY_NAME,N.MOBILE_KEY_NAME].forEach(function(t){if(!e.fromService||!(e.fromService[t]instanceof Array)){if(t!==N.SBIS_KEY_NAME)return e;if(!(e.fromClipboard instanceof Array)||!e.fromClipboard.length)return u.channel("SbisBufferEvents").notify("onLastTransactionLoaded",t,null,true),e}var n=null;if(N.SBIS_KEY_NAME===t)n=k((e.fromClipboard||[]).concat(e.fromService[N.SBIS_KEY_NAME]||[]),i._options.allowAttachFoldersFromSbisBuffer,i._options.extensions),b.restoreCachedClipboardTransaction(n);else n=k(e.fromService[t],i._options.allowAttachFoldersFromSbisBuffer,i._options.extensions);var r=new T(a(n));u.channel("SbisBufferEvents").notify("onLastTransactionLoaded",t,r.getTransactions()),e.fromService[t]=r},this),e}if(!this._bufferDataLoading||this._bufferDataLoading.isReady()){if(N.CLIPBOARD===e)n=new f;else n=this._getFilesFromServices(e);this._bufferDataLoading=new c({steps:{fromClipboard:r(e),fromService:n}}).done().getResult().addCallback(o)}return this._bufferDataLoading},_getSbisPluginService:function(){var e=new f,t=this;if(false===this._isPluginAvailable)setTimeout(function(){e.errback()},0);else if(this._sbisPluginService)setTimeout(function(){e.callback(t._sbisPluginService)},0);else if(a.isMobilePlatform||a.isMacOSDesktop)this._isPluginAvailable=false,setTimeout(function(){e.errback()},0);else require(["js!SBIS3.Plugin/Source/LocalService","js!SBIS3.Plugin/Source/Helper/Helper"],function(i,n){if(t._uploader)t._uploader.setAccountId(n.getAccountId());e.callback(t._sbisPluginService=i)},function(t){e.errback(t)});return e},_getPlugin:function(e,t,i){var n=this[i];if(n instanceof f)return n.createDependent();if(n instanceof Error)return f.fail(n);if(n&&n.getState()!==n.readyState.OPEN)this[i]=n=null;if(n)return f.success(n);else{var r=this,s=new f;return this._getSbisPluginService().addCallback(function(i){M("Получение плагина "+e),P("Получение плагина "+e);var n=new i({endpoint:{address:e+"-"+t,contract:e},options:{mode:"silent"}});return n.isReady().addCallback(function(){return w("Получение плагина "+e),n}).addErrback(function(t){return w("Получение плагина "+e),M("ERROR Получение плагина "+e,t),t})}).addCallback(function(e){r[i]=e,s.callback(e)}).addErrback(function(e){r[i]=null,s.errback(e)}),this[i]=s}},_destroyPlugin:function(e){var t=this[e];function i(t){if(t)M("Destroy plugin",e),t.destroy()}if(t instanceof f)t.addCallback(i);else if(t&&!(t instanceof Error))i(t);this[e]=null},_getClipboardPlugin:function(){return this._getPlugin("Clipboard","1.0.1.0","_clipboardPlugin")},_getFileSystemPlugin:function(){return this._getPlugin("FileSystem","1.0.1.0","_fileSystemPlugin")},_getFileLoaderPlugin:function(){return this._getPlugin("FileLoader","0.0.0.47","_fileLoaderPlugin")},_getFilesFromClipboard:function(){var e=this,t=this._options.extensions||[],i=t.length?t.indexOf("url")>=0:this._options.hasClipboardLink;return new b(function(){return e._getClipboardPlugin()},function(){return e._getFileSystemPlugin()},{hasClipboardLink:i,attachDiskLinkByUrl:this._options.hasSbisDiskLink,allowAttachFoldersFromSbisBuffer:this._options.allowAttachFoldersFromSbisBuffer,extensions:t,existingFiles:this._getExistingFiles()}).getFilesFromClipboard(this)},_getExistingFiles:function(){var e=o.getFileObjectsInCurrentFolder(this._options.linkedList);return o.getFilesArray(e)},_getFilesFromServices:function(e){if(Boolean(N.SBIS&e)&&Boolean(N.MOBILE&e)){var t={};return t[N.SBIS_KEY_NAME]=this._getFilesFromService(N.SBIS),t[N.MOBILE_KEY_NAME]=this._getFilesFromService(N.MOBILE),new c({steps:t}).done().getResult()}return this._getFilesFromService(e).addCallback(function(t){var i={};if(Boolean(N.MOBILE&e))i[N.MOBILE_KEY_NAME]=t;else i[N.SBIS_KEY_NAME]=t;return i})},_getFilesFromService:function(t){if(P("ПОЛУЧЕНИЕ ДАННЫХ ИЗ СЕРВИСА СБИС БУФЕРА"),!o.isAuthenticated())return w("ПОЛУЧЕНИЕ ДАННЫХ ИЗ СЕРВИСА СБИС БУФЕРА"),f.success([]);var i={},n=this,r=new e({adapter:"adapter.sbis",format:[{name:"FromMobile",type:"Boolean"}]});if(Boolean(N.MOBILE&t))r.set("FromMobile",true);else r.set("FromMobile",false);return i={Filters:r},l.GetAllObjectsInfo(i).addCallback(function(e){return w("ПОЛУЧЕНИЕ ДАННЫХ ИЗ СЕРВИСА СБИС БУФЕРА"),n._produceTransaction(e)}).addErrback(function(e){return w("ПОЛУЧЕНИЕ ДАННЫХ ИЗ СЕРВИСА СБИС БУФЕРА"),S.resolve("ILogger").error("Ошибка при вызове метода SBISBuffer.GetAllObjectsInfo",e),[]})},_produceTransaction:function(e){var t=[];if(!e)return t;return e.each(function(e){var i=e.get("Content"),n=e.get("Id_Transaction"),r=e.get("IsPersistent"),s=new Date(e.get("CreationDate"));i.addField({name:"folder",type:"string",defaultValue:""}),i.addField({name:"folder$",type:"boolean",defaultValue:false}),i.addField({name:"isExternal",type:"boolean",defaultValue:false}),i.addField({name:"transactionDay",type:"string",defaultValue:""}),i.addField({name:"transactionId",type:"string",defaultValue:""}),i.addField({name:"ext",type:"string",defaultValue:""}),i.each(function e(t){t.set({folder:null,folder$:false,isExternal:!r})}),t.push(new D(n,s,i))}),t.filter(function(e){if(!e||!e.files.getCount())return false;return true})},_onThumbnailReady:function(e,t,i,r){function s(e){var s=e.fromService&&e.fromService[N.SBIS_KEY_NAME],a=s&&s.getTransactionFiles(N.CLIPBOARD_KEY_NAME),o=a&&n(a).toArray(),l;if(o)for(var f=0;f<o.length;f++)if(l=o[f],l.get("path")===t){if(s.updateFile(l.getId(),r?"previewUrlSmall":"previewUrl",i),r)u.channel("SbisBufferEvents").notify("onPreviewChanged",l.getId(),i?"data:image/png;base64,"+i:i);break}return e}if(this._isTypeBufferContent(N.CLIPBOARD))this._bufferDataLoading.addCallback(s)},_onFileSizeReady:function(e,t,i){var n=this;function r(e){var r=e.fromService&&e.fromService[N.SBIS_KEY_NAME],s=r&&r.getTransactionFiles(N.CLIPBOARD_KEY_NAME),a;if(s)for(var o=0,l=s.getCount();o<l;o++)if(a=s.at(o),a.get("path")===t){if(r.updateFile(a.getId(),"size",i),n._missingFileSizes.has(t))if(n._missingFileSizes.success(t),n._missingFileSizes.isReady()&&n._waitFileSizes&&!n._waitFileSizes.isReady())M("Размеры всех файлов получены."),n._waitFileSizes.callback();break}return e}if(this._isTypeBufferContent(N.CLIPBOARD))this._bufferDataLoading.addCallback(r)},getSbisBufferMenuItem:function(){return{id:"sbisbuffer",title:'<component data-component="SBIS3.DOCVIEW.BufferList"></component>',icon:"sprite:icon-16 icon-Paste icon-primary",className:"docview-attachTo__buffer-menu-item"}},setSbisBufferEventHandlers:function(e){if(!e)return;var t=this;this._menuControl=e,v.init(),this.fillBufferList(this._options.preloadClipboardContent),this.subscribeTo(e,"onPickerOpen",function(){t.fillBufferList()}),this.subscribeTo(e,"onMenuItemActivate",this._onBufferMenuItemActivate.bind(this))},_onBufferMenuItemActivate:function(e,t,i){if(this._activeItem=t,t!==this._options.sbisBufferMenuItemId&&t!==this._options.mobileBufferMenuItemId)return;var n=this._menuControl.getItemsInstances()[t].getChildControls(false,true,function(e){return _.instanceOfModule(e,"SBIS3.DOCVIEW.BufferList")})[0],r=null,s=N.SBIS,r;if(!n)return;if(n.getTypeBuffer instanceof Function){if(n.getTypeBuffer()!==N.SBIS_KEY_NAME)s=N.MOBILE;if(r=n.getSelectedData($(i.target)),r)if(r.transactionId)return void this.attachLastTransaction(s,r.transactionId,r.fileId);this.openBufferWindow(s)}},_notifyAttachError:function(e,t,i){if(!(e instanceof Error))e=new Error(String(e||""));if(t)e.fileName=t;if(i)require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(e){e.showMessageDialog({message:rk("Сервис СБИС.Диск на техническом обслуживании."),details:rk("Мы знаем об этом и уже исправляем. Попробуйте заглянуть сюда через 15 минут."),status:"error"})});else F(e);this._notify("onErrorCreateAttachment",e)},_isAttachmentPossible:function(){if(o.isDemoMode()&&this._options.mainOptions.isDisk)return E(rk("Загрузка файлов недоступна в демо-режиме")),false;if(this._options.linkedList&&this._options.linkedList.isArchive())return E(rk("Добавление файлов в архивы невозможно")),false;return true},attachFromClipboard:function(){var e=this;this._getBufferContent(N.CLIPBOARD,true).addCallback(function(t){return e.attachLastTransaction(N.CLIPBOARD,N.CLIPBOARD_KEY_NAME),t})}};return y(),R});
//# sourceMappingURL=SBISBufferMixin.module.js.map
define("tmpl!SBIS3.DOCVIEW.BufferList/view/sbis/BufferList",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},r=function e(r,a,c,o,s){function n(){}var l=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var f={};s&&s.isSetts&&(f=s.fullContext||{});var u="string"==typeof c?c:"",v=void 0===i?void 0:i,g={id:[],def:void 0},h=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),p=this&&this.includedTemplates?this.includedTemplates:{},b=d.getMarkupGenerator(o);try{var T=b.joinElements([b.createTag("div",{class:"docview-attachTo-buffer"},[b.createTag("div",{class:"docview-attachTo-buffer-sbis__text",title:""+global.rk("Открыть буфер обмена")},[b.createTag("i",{class:"controls-MenuItem__icon icon-size js-controls-MenuItem__icon icon-16 icon-Paste icon-primary",unselectable:"on"},[],{},g,this),b.createText(" "+global.rk("Из буфера обмена")+" ")],{},g,this),b.createTag("div",{class:"docview-attachTo-buffer__content"},[d.getter(r,["contentHtml"])||d.getter(r,["isEnabledModel"])?[b.createText(" "+d.wrapUndef(d.Sanitize.apply(void 0,[d.getDecorators().unescape.apply(void 0,[d.getter(r,["contentHtml"])])]))+" ")]:[b.createTag("div",{class:"docview-attachTo-buffer__empty"},[b.createText(""+global.rk("сейчас там пусто"))],{},g,this),b.createTag("div",{class:"docview-attachTo-buffer__overlay"},[b.createTag("div",{class:"docview-attachTo-buffer__indicator"},[b.createTag("img",{src:"resources/SBIS3.CONTROLS/themes/online/img/ajax-loader-indicator.v1516270649826335cf4508dd597be4bfc9caa3e08b901.gif"},[],{},g,this),b.createText(global.rk("обновление")+"... ")],{},g,this)],{},g,this)]],{},g,this)],a,g,this)],u,g);g.def&&(T=b.chain(T,g,a),g=void 0)}catch(e){d.templateError("resources/Docview/BufferList/view/sbis/BufferList.tmpl",e,r)}return T||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.BufferList/view/sbis/BufferList"}},r});
//# sourceMappingURL=BufferList.tmpl.map
define("tmpl!SBIS3.DOCVIEW.BufferList/view/mobile/BufferList",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Button/IconButton"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={};o["js!SBIS3.CONTROLS/Button/IconButton"]=e[1];var i=function e(i,r,n,a,c){function l(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var f={};c&&c.isSetts&&(f=c.fullContext||{});var d="string"==typeof n?n:"",m=void 0===o?void 0:o,v={id:[],def:void 0},p=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),B=this&&this.includedTemplates?this.includedTemplates:{},h=u.getMarkupGenerator(a);try{var b=h.joinElements([h.createTag("div",{class:"docview-attachTo-buffer"},[h.createTag("div",{class:"docview-attachTo-buffer-mobile__text",title:""+global.rk("Открыть мобильный буфер обмена")},[h.createTag("i",{class:"controls-MenuItem__icon icon-size js-controls-MenuItem__icon icon-16 icon-PhoneCell icon-primary",unselectable:"on"},[],{},v,this),h.createText(" "+global.rk("С мобильного устройства")+" "),h.createControl("wsControl","ws:SBIS3.CONTROLS/Button/IconButton",{className:"docview-attachTo-buffer-mobile",icon:"sprite:icon-24 icon-primary icon-Publish2",tooltip:""+global.rk("Отправить запрос на загрузку файла в приложение СБИС"),command:"attachWaitMobileBuffer",visible:Boolean(!1),name:"windowButton",esc:!1},{name:"windowButton",sbisname:"windowButton"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:p},n,m,B,u.config,f)],{},v,this),h.createTag("div",{class:"docview-attachTo-buffer__content"},[u.getter(i,["contentHtml"])?[h.createText(" "+u.wrapUndef(u.utils.escape(u.getter(i,["contentHtml"])))+" ")]:h.createText("")],{},v,this)],r,v,this)],d,v);v.def&&(b=h.chain(b,v,r),v=void 0)}catch(e){u.templateError("resources/Docview/BufferList/view/mobile/BufferList.tmpl",e,i)}return b||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.DOCVIEW.BufferList/view/mobile/BufferList"}},i});
//# sourceMappingURL=BufferList.tmpl.map
define("js!SBIS3.DOCVIEW.BufferList",["Core/core-instance","Core/EventBus","SBIS3.CONTROLS/CompoundControl","tmpl!SBIS3.DOCVIEW.BufferList/view/sbis/BufferList","tmpl!SBIS3.DOCVIEW.BufferList/view/mobile/BufferList","js!SBIS3.DOCVIEW.BufferList.Cache","js!SBIS3.DOCVIEW.BufferList.ViewModel","js!SBIS3.DOCVIEW.SBISBufferMixin.Logger","css!SBIS3.DOCVIEW.BufferList","css!SBIS3.CORE.RichContentStyles","i18n!SBIS3.DOCVIEW.BufferList"],function(t,e,i,n,o,s,f,r){"use strict";var a=500;function u(t){if(t instanceof Object&&t.typeBuffer)if("mobile"===t.typeBuffer)return o(t);return n(t)}var c=i.extend({_dotTplFn:u,$protected:{_options:{contentHtml:"",typeBuffer:"sbis",isActiveButton:false},_itemContent:null,_indicatorDelay:null},_modifyOptions:function(t){var e=s.load(t.typeBuffer);return t.contentHtml=e.content,t.activableByClick=false,t.isEnabledModel=e.isEnabled,t},$constructor:function(){var t=this,i=e.channel("SbisBufferEvents");this.subscribeTo(i,"onStartContentLoading",this._onStartContentLoading.bind(this)),this.subscribeTo(i,"onRenderBufferList",this._onRenderBufferList.bind(this)),this.subscribeTo(i,"onRenderBufferListImage",function(e,i,n,o){if(t._options.typeBuffer===i)t._updateImage(n,o)})},init:function(){if(c.superclass.init.call(this),this._itemContent=this.getContainer().find(".docview-attachTo-buffer__content"),this.getContainer().closest(".controls-MenuItem__content").children(".controls-MenuItem__icon").hasClass("icon-24"))this.getContainer().addClass("docview-attachTo-buffer_icon24").find(".controls-MenuItem__icon.icon-16").removeClass("icon-16").addClass("icon-24");this._itemContent.on("mouseover.docviewBufferList",function(t){var e=$(this).find(".docview-attachTo-buffer__file").length,i=$(t.target);if(e>1&&(i.hasClass("docview-attachTo-buffer__file")||i.closest(".docview-attachTo-buffer__file").length))$(this).toggleClass("docview-attachTo-buffer__content_hover",false);else $(this).toggleClass("docview-attachTo-buffer__content_hover",!i.hasClass("docview-attachTo-buffer__preview"))}),this._itemContent.on("mouseleave.docviewBufferList",function(){$(this).removeClass("docview-attachTo-buffer__content_hover")}),this._enableSbisBufferItem(Boolean(this._options.isEnabledModel||this._options.isActiveButton))},destroy:function(){if(this._itemContent)this._itemContent.off(".docviewBufferList"),this._itemContent=null;c.superclass.destroy.call(this)},_onStartContentLoading:function(){r.log("BufferList["+this._options.typeBuffer+"]: onStartContentLoading");var t=this,e=s.load(this._options.typeBuffer),i=e.content;if(!i)this._indicatorDelay=setTimeout(function(){t._indicatorDelay=null,t._toggleIndicator(true)},a);else this._redraw(i),this._enableSbisBufferItem(Boolean(e.isEnabled||this._options.isActiveButton))},_onRenderBufferList:function(t,e,i,n){if(!this._itemContent||this._options.typeBuffer!==e)return;r.log("BufferList["+this._options.typeBuffer+"]: onRenderBufferList");var o=n.type===f.TYPE_EMPTY;if(this._enableSbisBufferItem(!o||this._options.isActiveButton),"mobile"===this._options.typeBuffer)this.getChildControlByName("windowButton").toggle(!o);if(this._redraw(i),this._indicatorDelay)clearTimeout(this._indicatorDelay),this._indicatorDelay=null;this._toggleIndicator(false)},getSelectedData:function(t){if(!t||!t.length)return null;var e=s.load(this._options.typeBuffer);if(!e||e.type===f.TYPE_EMPTY)return null;if(t.hasClass("docview-attachTo-buffer__image"))return{transactionId:e.id,fileId:t.data("id")};else if(t.hasClass("docview-attachTo-buffer__file"))return{transactionId:e.id,fileId:t.data("id")};else{var i=t.parentsUntil(".docview-attachTo-buffer").add(t);if(i.hasClass("docview-attachTo-buffer-"+this._options.typeBuffer+"__text"))return{};else if(i.hasClass("docview-attachTo-buffer__content"))return{transactionId:e.id}}},_enableSbisBufferItem:function(e){var i=this.getParent();if(t.instanceOfModule(i,"SBIS3.CONTROLS/Menu/MenuItem"))i.setEnabled(e)},_toggleIndicator:function(t){if(r.log("BufferList["+this._options.typeBuffer+"]: toggleIndicator "+t),this._itemContent)this._itemContent.toggleClass("docview-attachTo-buffer_update",Boolean(t))},_updateImage:function(t,e){if(this._itemContent){var i=this._itemContent.find('[data-id="'+t+'"]');if(i.length)if("IMG"===i[0].tagName){if(i.attr("src")!==e)i.attr("src",e)}else i.replaceWith('<img src="'+e+'" data-id="'+t+'"/>')}},_redraw:function(t){var i=this._itemContent.height(),n;if(this._itemContent.html(t),n=this._itemContent.height(),i!==n)e.channel("SbisBufferEvents").notify("onBufferListRedraw")},getTypeBuffer:function(){return this._options.typeBuffer}});return c});
//# sourceMappingURL=BufferList.module.js.map
define("js!SBIS3.DOCVIEW.AttachButtonsMixin",["Core/core-instance"],function(t){"use strict";return{$protected:{_attachButton:null},setLinkedList:function(t){if(this._options.linkedList===t)return;if(this._options.linkedList)this.unsubscribeFrom(this._options.linkedList);if(this._options.linkedList=t,t){var i=this,n=["scan","scanFromFile","addFromBuffer","attachFromSbisDisk"];this.subscribeTo(t,"onFinishCommand",function(t,o,s){if(n.indexOf(o)>=0)i._notify("onFinishCreateAttachment",s)}),this.subscribeTo(t,"onErrorCommand",function(t,o,s){if(n.indexOf(o)>=0)i._notify("onErrorCreateAttachment",s)}),this.subscribeTo(t,"onDestroy",function(){i._options.linkedList=null}),n.forEach(function(n){t.setCommandOptions(n,{maxFileSizeInMB:i._options.maxFileSizeInMB})})}},getLinkedList:function(){return this._options.linkedList},getLinkedListFilter:function(){if(!this._options.linkedList)return null;var t=this._options.linkedList,i=t.getFilter();return{folder:t.getCurrentRoot()||i.folder,catalogId:i.catalogId?i.catalogId:t._options.mainOptions.fixId?t._options.mainOptions.fixId:this.getLinkedContext().getValue(t._options.mainOptions.ctxLinkId)}},setFilter:function(){var t=this.getLinkedListFilter();if(t){if(this.filters.set("catalogId",t.catalogId),t.folder)this.filters.set("folder",t.folder);else if(this.filters.has("folder"))this.filters.set("folder",void 0)}else this.filters.set("catalogId",this._options.mainOptions.fixId?this._options.mainOptions.fixId:this.getLinkedContext().getValue(this._options.mainOptions.ctxLinkId))},setUserButtons:function(t){this._options.userButtons=t,this.reloadButtons()},addButtons:function(t){this._options.userButtons=this._options.userButtons.concat(t),this.reloadButtons()},removeButtons:function(t,i){for(var n=false,o=0;o<t.length;o++)if(this._removeButton(t[o],i))n=true;if(n)this.reloadButtons()},_removeButton:function(t,i){for(var n=i?this._buttons:this._options.userButtons,o=0;o<n.length;o++)if(n[o].id===t)return n.splice(o,1),true},reloadButtons:function(){this._getAttachButton().setItems(this._buttons.concat(this._options.userButtons))},subscribeToUserButtons:function(t){var i=this._options.userButtons||[];this._getAttachButton().subscribe("onMenuItemActivate",function(n,o){if(i.some(function(t){return t.id===o}))t(o)})},_getAttachButton:function(){if(!this._attachButton){var i=this.getChildControls(),n;if(i.length)if(n=i[0],t.instanceOfMixin(n,"SBIS3.CONTROLS/Mixins/DSMixin"))n._options.idProperty="id",n._options.parentProperty="parent",this._attachButton=n;else throw new Error("SBIS3.DOCVIEW.AttachTo: Опция content содержит некорректный контрол")}return this._attachButton}}});
//# sourceMappingURL=AttachButtonsMixin.module.js.map
define("js!SBIS3.DOCVIEW.AddLinkMixin",["Core/helpers/String/format","WS.Data/Source/SbisService","Core/base64","Core/Indicator","Core/WindowManager","js!SBIS3.DOCVIEW.Funcs"],function(e,t,n,i,o,r){"use strict";var a,s,l="[DEFAULT]\n"+"BASEURL=$link$s$\n"+"TARGET='_blank'\n"+"[InternetShortcut]\n"+"URL=$link$s$\n";function c(t){return e({link:t},l)}function u(e){if(!a)a=new t({endpoint:{contract:e.mainOptions.objectName,address:e.mainOptions.serviceUrl+"service/"}});return a}function d(){if(!s)s=new t({endpoint:{contract:"FileSD",address:"/disk/api/v1/service/"}});return s}function f(e){for(var t=[],n=1,i=arguments.length;n<i;n++)t[n-1]=arguments[n];return e.call.apply(e,t)}function p(e){if(/^(http|https):\/\/[^ "]+/.test(e)){e=(e=e.split(/[\n\t\r\f\s\?]/)[0]).replace(/.*?:\/\//g,"").replace(/\//g,"_");while(e.indexOf("__")>=0)e=e.replace("__","_");e=e.replace("_.",".")}else e=e.replace(/[<>|:*\/"?\\]/g,"");if(".url"!==e.substr(e.length-4))e=(e+=".url").replace("..",".");return e}return{$protected:{_attachLinkFile:function(e,t,o){var a=this,s=a._options.linkedList,l=s?r.getFileObjectsInCurrentFolder(s):null,c=l?r.getFilesArray(l):null,d=r.uniqueName(p(e),c||[]),f={"ИмяФайла":d,"Данные":n.encode(t)};if(i.setMessage(rk("Сохранение ссылки")+"..."),this._options.mainOptions.isDisk)this.onChangeInputFile(null,d,{type:"text/plain",content:t},{bufferLink:true});else u(this._options).call("ЗагрузитьФайл",{"Файл":f}).addCallbacks(function e(t){t=t.getScalar();var n={};a._onFinish(t,false,{fileName:d,attachId:t.split(";")[0],redactionId:t.split(";")[1]},{linksInfo:o||void 0}),i.hide()},function e(t){require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(e){e.showMessageDialog({message:t.message,status:"error"})}),i.hide()})},_person:function(){var t=this;require(["js!SBIS3.Staff.Choice.List","js!SBIS3.Staff.StaffFunction"],function(n,i){n.show().addCallback(function(n){var o={fio:n[0].get("НазваниеПолное")||n[0].get("НазваниеКраткое")},r=e(o,"$fio$s$.url"),a;i.getEmployeeUrlByRecord(n[0]).addCallback(function(e){a=c(e),t._attachLinkFile(r,a,{type:"employee",record:n[0]})})})})},_company:function(){var t=this;require(["js!SBIS3.AddresseeChoice.CommonFunctions"],function(n){var i={contragentChoice:true,multiselect:false,showAlwaysChooseButton:true,choiceHandler:function(n){var i="https://$host$s$/extract/$inn$s$/$kpp$s$/$id$s$/",o={inn:n[0].get("ИНН"),kpp:n[0].get("КПП"),id:n[0].get("ИдентификаторСПП"),host:location.hostname},r=e(o,i),a={name:n[0].get("Название")},s=e(a,"$name$s$.url"),l=c(r);t._attachLinkFile(s,l,{type:"contractor",record:n[0]})}};n.openDialog(o.getActiveWindow(),i)})},_link:function(){var e=this;require(["Lib/Control/Dialog/Dialog"],function(t){new t({template:"js!SBIS3.DOCVIEW.AddLink",caption:rk("Web-ссылка"),opener:o.getActiveWindow(),autoHeight:true,resizeable:false,width:"400px",autoWidth:false,handlers:{onBeforeClose:function(t,n){if(n)if(0===n.url.indexOf(window.location.protocol+"//"+window.location.hostname+"/shared/disk/")&&"Copy"!==e._options.insertMode)require(["js!SBIS3.DOCVIEW.LoadHelpers"],function(t){t.attachLinkFromSbisDisk.call(e,n.url)});else{var i=n.title+".url",o=c(n.url);e._attachLinkFile(i,o)}}}})})},addLink:function(e,t){this._attachLinkFile(e,c(t))}}}});
//# sourceMappingURL=AddLinkMixin.module.js.map
define("SBIS3.CONTROLS/Menu/MenuLink",["js!WSControls/Buttons/MenuButton","SBIS3.CONTROLS/Utils/LinkUtil","css!SBIS3.CONTROLS/Link/Link","css!SBIS3.CONTROLS/Menu/MenuLink/MenuLink"],function(n,s){"use strict";var e=n.extend([],{$protected:{_zIndex:""},_modifyOptions:function(){var n=e.superclass._modifyOptions.apply(this,arguments);return n.pickerClassName+=" controls-MenuLink__Menu",n.cssClassName+=" controls-MenuLink controls-Link",n._textClass=" controls-Link__field",s.preparedClassFromOptions(n),n}});return e});
//# sourceMappingURL=MenuLink.js.map
define("html!SBIS3.DOCVIEW.AttachTo",function(){var o=function(o){var n=function(){var o=/\{\{([\s\S]+?)\}\}/g;return function(n){for(;o.test(n);)n=n.replace(o,"&#123;&#123;$1&#125;&#125;");return n}}(),t=function(o){return o.join?o.join(""):o.toString()},e=function(o){return void 0===o?"":o&&"object"==typeof o?t(o):""+o},i="undefined"!=typeof process,r=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="docview-attachTo_link"> ');return o.content?r+=n(e(o.content)):(r+=' <component name="LoadDocumentBtn" data-component="SBIS3.CONTROLS/Menu/Menu',o.showCaption?r+="Link":r+="Icon",r+='"> <option name="pickerClassName">docview-attachTo '+n(e(o.textModificator))+'</option> <option name="tooltip">'+n(e(o.tooltip))+'</option> <option name="caption">'+n(e(o.caption))+'</option> <option name="allowChangeEnable">true</option> <option name="focusOnActivatedOnMobiles">true</option> <option name="enable">true</option> <option name="icon">'+n(e(o.icon))+'</option> <option name="tabindex">1</option> <option name="idProperty">id</option> <option name="parentProperty">parent</option> </component> '),r+=" </div>",(r=n(r))+(i&&-1!==r.indexOf("{{")?String.fromCharCode(8203,8203):"")};return o.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.DOCVIEW.AttachTo"}},o});
//# sourceMappingURL=AttachTo.xhtml.map
define("js!SBIS3.CONTROLS.IconButton",["SBIS3.CONTROLS/Button/IconButton"],function(n){return n});
//# sourceMappingURL=IconButton.module.js.map
define("tmpl!SBIS3.CONTROLS/FieldLink/textFieldWrapper",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},l=function e(l,o,i,n,a){function p(){}var c=0,s=void 0!==t&&t?t:arguments[arguments.length-1];void 0===s&&(eval("var thelpers = null;"),s=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var u="string"==typeof i?i:"",f=void 0===r?void 0:r,m={id:[],def:void 0},g=s.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,l),v=this&&this.includedTemplates?this.includedTemplates:{},x=s.getMarkupGenerator(n);try{var h=x.joinElements([x.createTag("input",{class:"controls-InputRender__field controls-TextBox__field js-controls-TextBox__field "+s.wrapUndef(s.utils.escape("uppercase"===s.getter(l,["textTransform"])?"controls-TextBox__field-uppercase":""))+" "+s.wrapUndef(s.utils.escape("lowercase"===s.getter(l,["textTransform"])?"controls-TextBox__field-lowercase":"")),type:"text",autocomplete:"off",value:""+s.wrapUndef(s.utils.escape(s.getter(l,["text"]))),maxlength:""+s.wrapUndef(s.utils.escape(s.getter(l,["maxLength"])?s.getter(l,["maxLength"]):"")),required:"true",title:""+s.wrapUndef(s.utils.escape(s.getter(l,["tooltip"])?s.getter(l,["tooltip"]):" "))},[],o,m,this),s.getter(l,["enabled"])&&s.getter(l,["placeholder"])?[x.createControl("resolver",s.getter(l,["compatiblePlaceholderTemplate"]),s.uniteScope(s.utils.escape(s.uniteScope(l,{parent:void 0,element:void 0})(s.plainMerge)),{}),{},{data:l,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},i,f,v,s.config,d,m)]:x.createText("")],u,m);m.def&&(h=x.chain(h,m,o),m=void 0)}catch(e){s.templateError("resources/SBIS3.CONTROLS/FieldLink/textFieldWrapper.tmpl",e,l)}return h||""};return l.includedFunctions={},l.stable=!0,l.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FieldLink/textFieldWrapper"}},l});
//# sourceMappingURL=textFieldWrapper.tmpl.map
define("tmpl!SBIS3.CONTROLS/FieldLink/resources/showSelectorButton",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Menu/MenuIcon"],function(){var e=Array.prototype.slice.call(arguments),o=e[0],t={};t["js!SBIS3.CONTROLS/Menu/MenuIcon"]=e[1];var n=function e(n,r,i,l,c){function s(){}var a=0,u=void 0!==o&&o?o:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};c&&c.isSetts&&(d=c.fullContext||{});var S="string"==typeof i?i:"",p=void 0===t?void 0:t,m={id:[],def:void 0},L=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),v=this&&this.includedTemplates?this.includedTemplates:{},f=u.getMarkupGenerator(l);try{var h=f.joinElements([u.getter(n,["menuSelector"])?[f.createControl("wsControl","ws:SBIS3.CONTROLS/Menu/MenuIcon",{name:"fieldLinkMenu",cssClassName:"controls-FieldLink__showSelector controls-FieldLink__button",pickerClassName:"controls-FieldLink__showSelector__picker",icon:"controls-FieldLink__icon icon-size icon-ListViewNew icon-primary action-hover",tabindex:"0",displayProperty:"caption",idProperty:"caption"},{name:"fieldLinkMenu",sbisname:"fieldLinkMenu"},{data:n,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:L},i,p,v,u.config,d)]:[f.createTag("div",{class:"controls-FieldLink__showSelector controls-FieldLink__showSelector-button controls-FieldLink__button icon-size icon-ListViewNew"},[],{},m,this)]],S,m);m.def&&(h=f.chain(h,m,r),m=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/FieldLink/resources/showSelectorButton.tmpl",e,n)}return h||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FieldLink/resources/showSelectorButton"}},n});
//# sourceMappingURL=showSelectorButton.tmpl.map
define("tmpl!SBIS3.CONTROLS/FieldLink/beforeFieldWrapper",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection"]=e[1];var i=function e(i,l,n,o,s){function d(){}var a=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var c={};s&&s.isSetts&&(c=s.fullContext||{});var m="string"==typeof n?n:"",u=void 0===r?void 0:r,S={id:[],def:void 0},f=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),g=this&&this.includedTemplates?this.includedTemplates:{},v=p.getMarkupGenerator(o);try{var C=v.joinElements([p.getter(i,["_isEmptySelection"]).apply(i,[p.uniteScope(i,{parent:void 0,element:void 0})(p.plainMerge)])?v.createText(""):[v.createTag("div",{class:"controls-FieldLink__beforeFieldWrapper"+p.wrapUndef(p.utils.escape(p.getter(i,["enabled"])?" controls-FieldLink__beforeFieldWrapper-enabled":" controls-FieldLink__beforeFieldWrapper-disabled"))},[v.createControl("wsControl","ws:SBIS3.CONTROLS/FieldLink/resources/ItemsCollection",{cssClassName:"controls-FieldLink__linksContainer",name:"FieldLinkItemsCollection",tabindex:"0",displayProperty:p.getter(i,["displayProperty"]),idProperty:p.getter(i,["idProperty"]),itemTpl:p.getter(i,["itemTpl"]),itemContentTpl:p.getter(i,["itemContentTpl"]),includedTemplates:p.getter(i,["includedTemplates"]),items:p.getter(i,["preRenderItems"]),boldItems:p.getter(i,["boldItems"]),underlinedItems:p.getter(i,["underlinedItems"]),bigItems:p.getter(i,["bigItems"]),itemsSortMethod:p.getter(i,["itemsSortMethod"])},{name:"FieldLinkItemsCollection",sbisname:"FieldLinkItemsCollection"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},n,u,g,p.config,c)],{},S,this)]],m,S);S.def&&(C=v.chain(C,S,l),S=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/FieldLink/beforeFieldWrapper.tmpl",e,i)}return C||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FieldLink/beforeFieldWrapper"}},i});
//# sourceMappingURL=beforeFieldWrapper.tmpl.map
define("tmpl!SBIS3.CONTROLS/FieldLink/afterFieldWrapper",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Action/SelectorAction"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Action/SelectorAction"]=e[1];var i=function e(i,o,n,l,c){function a(){}var s=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};c&&c.isSetts&&(p=c.fullContext||{});var u="string"==typeof n?n:"",S=void 0===r?void 0:r,v={id:[],def:void 0},f=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),m=this&&this.includedTemplates?this.includedTemplates:{},g=d.getMarkupGenerator(l);try{var L=g.joinElements([g.createTag("div",{class:"controls-FieldLink__afterFieldWrapper"+d.wrapUndef(d.utils.escape(d.getter(i,["enabled"])?" ws-hidden":""))},[d.getter(i,["_selectedMultipleItems"])?[g.createTag("div",{class:"controls-FieldLink__dropAllLinks controls-FieldLink__button icon-size icon-CloseNew",title:""+global.rk("Очистить все")},[],{},v,this)]:g.createText(""),d.getter(i,["showSelector"])?[g.createControl("resolver",d.getter(i,["showSelectorButton"]),d.uniteScope(d.utils.escape(d.uniteScope(i,{parent:void 0,element:void 0})(d.plainMerge)),{}),{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},n,S,m,d.config,p,v)]:g.createText(""),d.getter(i,["useSelectorAction"])?[g.createControl("wsControl","ws:SBIS3.CONTROLS/Action/SelectorAction",{name:"FieldLinkSelectorAction",mode:d.getter(i,["selectMode"]),visible:!1},{name:"FieldLinkSelectorAction",sbisname:"FieldLinkSelectorAction"},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},n,S,m,d.config,p)]:g.createText("")],o,v,this)],u,v);v.def&&(L=g.chain(L,v,o),v=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/FieldLink/afterFieldWrapper.tmpl",e,i)}return L||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FieldLink/afterFieldWrapper"}},i});
//# sourceMappingURL=afterFieldWrapper.tmpl.map
define("tmpl!SBIS3.CONTROLS/FieldLink/FieldLink",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,n,i,a,l){function p(){}var c=0,s=void 0!==t&&t?t:arguments[arguments.length-1];void 0===s&&(eval("var thelpers = null;"),s=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var u="string"==typeof i?i:"",f=void 0===r?void 0:r,v={id:[],def:void 0},g=s.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},y=s.getMarkupGenerator(a);try{var S=y.joinElements([y.createTag("div",{class:"controls-InputRender controls-TextBox "+s.wrapUndef(s.utils.escape(s.getter(s.getter(o,["_prepareClassesByConfig"]).apply(o,[s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)]),["container"]))),title:""+s.wrapUndef(s.utils.escape(s.getter(o,["tooltip"])))},[y.createTag("div",{class:"controls-InputRender__wrapper controls-TextBox__wrapper "+s.wrapUndef(s.utils.escape(s.getter(s.getter(o,["_prepareClassesByConfig"]).apply(o,[s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)]),["wrapper"])))},[y.createTag("div",{class:"controls-FieldLink__flexWrapper"},[s.getter(o,["beforeFieldWrapper"])?[y.createControl("resolver",s.getter(o,["beforeFieldWrapper"]),s.uniteScope(s.utils.escape(s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},i,f,m,s.config,d,v)]:y.createText(""),y.createTag("div",{class:"controls-InputRender__fieldWrapper controls-TextBox__fieldWrapper"},[y.createControl("resolver",s.getter(o,["textFieldWrapper"]),s.uniteScope(s.utils.escape(s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)),{}),{class:s.utils.escape(s.getter(s.getter(o,["_prepareClassesByConfig"]).apply(o,[s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)]),["field"]))},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},i,f,m,s.config,d,v)],{},v,this),s.getter(o,["afterFieldWrapper"])?[y.createControl("resolver",s.getter(o,["afterFieldWrapper"]),s.uniteScope(s.utils.escape(s.uniteScope(o,{parent:void 0,element:void 0})(s.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},i,f,m,s.config,d,v)]:y.createText("")],{},v,this)],{},v,this),s.getter(o,["informationIconColor"])?[y.createTag("div",{class:"controls-InputRender__tagStyle controls-TextBox__informationIcon"+s.wrapUndef(s.utils.escape(" controls-InputRender__tagStyle-"+s.getter(o,["informationIconColor"])))+s.wrapUndef(s.utils.escape(" controls-TextBox__informationIcon-"+s.getter(o,["informationIconColor"])))},[],{},v,this)]:y.createText("")],n,v,this)],u,v);v.def&&(S=y.chain(S,v,n),v=void 0)}catch(e){s.templateError("resources/SBIS3.CONTROLS/FieldLink/FieldLink.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FieldLink/FieldLink"}},o});
//# sourceMappingURL=FieldLink.tmpl.map
define("SBIS3.CONTROLS/Utils/ToSourceModel",["WS.Data/Di","Core/core-instance","Core/core-clone","WS.Data/Chain","WS.Data/Utils"],function(e,t,o,i,n){function a(t,o){return"string"===typeof t?e.resolve(t,o):new t(o)}return function e(r,c,f,l){var d,u,s,S,g;if(r){if(c&&t.instanceOfMixin(c,"WS.Data/Source/ISource")){if(d=c.getModel(),u=a(d,{}),t.instanceOfMixin(r,"WS.Data/Entity/ManyToManyMixin"))if(r._getMediator().belongsTo(r,function(e){if(s)n.logger.error("ToSourceModel: у переданного рекордсета несколько родителей.");s=e}),s&&t.instanceOfModule(s,"WS.Data/Entity/Model"))if(l)S=o(s._changedFields);else n.logger.error("ToSourceModel: модель, указанная для источника контрола "+"отличается от модели переданного рекордсета. Возможны изменения в родительской записи.");if(i(r).each(function(e,o){if(u._moduleName!==e._moduleName)if((g=a(d,{adapter:e.getAdapter(),format:e.getFormat()})).merge(e),t.instanceOfMixin(r,"WS.Data/Collection/IList"))r.replace(g,o);else r[o]=g}),S)s._changedFields=S}i(r).each(function(e){if(t.instanceOfModule(e,"WS.Data/Entity/Model")&&e.getIdProperty()!==f&&void 0!==e.get(f))e.setIdProperty(f)})}return r}});
//# sourceMappingURL=ToSourceModel.js.map
define("SBIS3.CONTROLS/Utils/ItemsSelectionUtil",["Core/core-instance","Core/detection"],function(e,t){var i={onSelectedItemsChange:"getSelectedItems"};function n(e){return null===e||void 0===e}function o(e,t,i){return n(e.get(i))||n(e.get(t))}function r(t,i,n,r,s){var c=e.instanceOfModule(t,"WS.Data/Entity/Model"),l;if(c)if(l=!o(t,n,r),l){if(!t.getIdProperty())t.setIdProperty(n)}else if(i&&o(i,r,n)&&s)return false;return l||null===t||!l&&!s&&c}function s(e,t,n){var o=t[0],r=[o].concat(Array.prototype.slice.call(t,1));if(i.hasOwnProperty(o))n[i[o]](true).addCallback(function(t){return e.apply(n,r),t});else return e.apply(n,r)}function c(e,i){i.subscribeTo(e,"onExecuted",function(e,n,o){if(o)if(i.addSelectedItems(o),i._options.historyId&&o.at(0))i._addItemToHistory(o.at(0));if(i.isActive()){if(t.isMobileSafari)window.getSelection().removeAllRanges();i.setActive(true)}}),i.subscribeTo(e,"onExecute",function(e,t){e.setResult(i._notify("onChooserClick",t))})}function l(e,t){(t=t||this).getSelectedItems(false).each(function(i){if(i.get(t.getProperty("idProperty"))==e)t._notify("onItemActivate",{item:i,id:e})})}function a(e,t,i){var n,o;if(e=e instanceof jQuery?e:$(e),n=e.closest(".js-controls-ListView__item",this.getContainer()[0]),n.length)o=this._getItemProjectionByHash(n.data("hash")).getContents().get(this._options.idProperty);if(e.hasClass("js-controls__item-cross"))t(o);else i(o)}return{isEmptyItem:o,checkItemForSelect:r,delayedNotify:s,initSelectorAction:c,onItemClickNotify:l,clickHandler:a}});
//# sourceMappingURL=ItemsSelectionUtil.js.map
define("tmpl!SBIS3.CONTROLS/Suggest/resources/afterFieldWrapper",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},s=function e(s,i,l,o,n){function a(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var p="string"==typeof l?l:"",g=void 0===r?void 0:r,f={id:[],def:void 0},S=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),v=this&&this.includedTemplates?this.includedTemplates:{},m=u.getMarkupGenerator(o);try{var x=m.joinElements([m.createTag("div",{class:"controls-SuggestTextBox__afterFieldWrapper ws-inline-flexbox"},[m.createTag("span",{class:"js-controls-SuggestTextBox__reset controls-SuggestTextBox__reset icon-size icon-Close "+u.wrapUndef(u.utils.escape(u.getter(s,["text"])?"":"ws-hidden"))+" ws-inline-flexbox ws-align-items-center",title:""+global.rk("Очистить поле")},[],{},f,this)],i,f,this)],p,f);f.def&&(x=m.chain(x,f,i),f=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/Suggest/resources/afterFieldWrapper.tmpl",e,s)}return x||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Suggest/resources/afterFieldWrapper"}},s});
//# sourceMappingURL=afterFieldWrapper.tmpl.map
define("SBIS3.CONTROLS/History/HistoryList",["SBIS3.CONTROLS/History/HistoryController","WS.Data/Collection/IList","WS.Data/Collection/IEnumerable","WS.Data/Collection/RecordSet","WS.Data/Entity/Record","Core/Serializer","Core/helpers/generate-helpers","Core/helpers/Object/isEqual"],function(t,e,i,n,r,a,s,o){"use strict";var u=10,f="data",h="id",c=[{name:f,type:"record"},{name:h,type:"string"}];function g(){return new n({format:c,idProperty:h})}function l(t){var e=new r({idProperty:h,format:c}),i={};return i[f]=t,i[h]=s.randomId(),e[t instanceof r?"set":"setRawData"](i),e}function d(t,e){var i=t===e;function n(t,e){var i=false;if(t instanceof Array)t.forEach(function(n,r){i&=d(t[r],e[r])});else for(var n in t)if(t.hasOwnProperty(n))i&=d(t[n],e[n]);return i}if(!i&&t.isEqual&&e.isEqual)i=t.isEqual(e);if(!i&&t.getRawData&&e.getRawData)i=o(t.getRawData(),e.getRawData());if(!i&&isPlainArray(t)&&isPlainArray(e))if(t.length===e.length)if(i=o(t,e),!i)i=n(t,e);if(!i&&isPlainObject(t)&&isPlainObject(e))if(Object.keys(t).length===Object.keys(e).length)if(i=o(t,e),!i)i=n(t,e);return i}return t.extend([e,i],{$protected:{_options:{serialize:function(t,e){var i=new a,n={},r=[],s,o;if(t)s=JSON.stringify(e,i.serialize);else if(e){if(s=JSON.parse(e,i.deserialize),s.each(function(t){if(o=t.get(h),!n.hasOwnProperty(o))n[o]=true,r.push(t)}),r.length)(s=g()).append(r)}else s=g();return s},emptyValue:g(),maxLength:u}},prepend:function(t){if(this._addItemWithMethod("prepend",t))this.saveHistory()},append:function(t){if(this._addItemWithMethod("append",t))this.saveHistory()},assign:function(t){this.clear();for(var e=0,i=t.length;e<i;e++)this._addItemWithMethod("append",t[e]);this.saveHistory()},clear:function(){if(this.getCount())this.getHistory().clear(),this.saveHistory()},remove:function(t){var e=this.getHistory().removeAt(this._getIndex(t));if(e)this.saveHistory();return e},removeAt:function(t){var e;if(t<this.getHistory().getCount())this.getHistory().removeAt(t),this.saveHistory();return e},at:function(t){return this.getHistory().at(t)},getIndex:function(t){return this._getIndex(t)},getCount:function(){return this.getHistory().getCount()},each:function(t,e){this.getHistory().each(t,e)},getEnumerator:function(){return this.getHistory().getEnumerator()},getIndexByValue:function(t,e){return this.getHistory().getIndexByValue(t,e)},getIndicesByValue:function(t,e){return this.getHistory().getIndicesByValue(t,e)},_getIndex:function(t){var e=(t=l(t)).get(f),i=-1;return this.each(function(t,n){if(-1===i&&d(t.get(f),e))i=n}),i},_addItemWithMethod:function(t,e){var i=this.getHistory(),n=this._getIndex(e),r=false;if(e=l(e),-1!==n&&0!==n)i.prepend([e]),i.removeAt(n+1),r=true;if(-1===n){if(i.getCount()>=this._options.maxLength)i.removeAt(this._options.maxLength-1);i[t]([e]),r=true}return r}})});
//# sourceMappingURL=HistoryList.js.map
define("SBIS3.CONTROLS/Mixins/SuggestTextBoxMixin",["Core/constants","SBIS3.CONTROLS/ComponentBinder/SearchController","SBIS3.CONTROLS/History/HistoryList","SBIS3.CONTROLS/ControlHierarchyManager","WS.Data/Collection/RecordSet","WS.Data/Di","WS.Data/Query/Query","Core/core-merge","Core/ParallelDeferred","Core/core-instance","Core/core-clone","Core/IoC","Core/helpers/Function/once","Core/detection","Core/CommandDispatcher"],function(t,e,i,r,o,s,n,a,h,c,l,d,u,y,g){"use strict";var f=12;function _(t){t.stopPropagation(),t.preventDefault()}return{$protected:{_changedByKeyboard:false,_selectedFromList:false,_historyController:null,_historyDeferred:void 0,_options:{searchParam:"",keyboardLayoutRevert:true,keyboardLayoutRevertNew:true,useUserConfigHistory:true,task1174306848:false}},$constructor:function(){var e=this;if(this._publish("onBeforeLoadHistory"),this._options.observableControls.unshift(this),g.declareCommand(this,"changeSearchParam",function(t){if(e.setSearchParamName(t),e._needShowHistory())e._showHistory();else if(e.isPickerVisible())e.getPicker().recalcPosition(true,true);e._updateList()}),this._initializeSearchController=u.call(this._initializeSearchController),this.once("onListReady",function(i,r){e.subscribeTo(r,"onKeyPressed",function(i,r){if(r.which===t.key.enter)e._selectedFromList=true})}),this._options.searchParam)this._initializeSearchController()},_showHistory:function(){if(this._historyDeferred)return;this._getHistoryRecordSet().addCallback(function(t){if(t.getCount())this.getList().setItems(t),this.showPicker();else if(this._options.useUserConfigHistory&&this._historyController.getCount())this.getList().setItems(this._getHistoryRecordSetSync()),this.showPicker()}.bind(this)).addErrback(function(t){if(!t.canceled&&"Cancel"!==t.message){if(!t.processed)d.resolve("ILogger").log(this._moduleName,"Списочный метод не смог вычитать записи по массиву идентификаторов");if(this._historyController.getCount())this.getList().setItems(this._getHistoryRecordSetSync()),this.showPicker()}}.bind(this))},_getHistoryRecordSet:function(){var t=this.getList().getDataSource(),e=this._getQueryForHistory(),i=e.getWhere()[this._getListIdProperty()],r=new h,s=this,n,a;if(n=this._notify("onBeforeLoadHistory",i),this._historyDeferred=this.getList().getDataSource().query(e),r.push(this._historyDeferred),c.instanceOfModule(n,"Core/Deferred"))r.push(n);return r.done().getResult().addCallback(function(e){if(a=new o({adapter:t.getAdapter(),rawData:e[0]?e[0].getRawData():[],idProperty:s.getList().getProperty("idProperty"),model:t.getModel()}),e[1])a.assign(e[1].getAll());return a}).addBoth(function(t){return s._historyDeferred=null,t})},_getQueryForHistory:function(){for(var t=new n,e={},i=[],r=0,o=this._historyController.getCount();r<o;r++)i.push(this._getHistoryRecordId(this._historyController.at(r).get("data")));if(e[this._getListIdProperty()]=i,e=a(e,this.getList().getFilter()||{}),this._options.searchParam)delete e[this._options.searchParam];return t.where(e).limit(12),t},_getHistoryRecord:function(t){var e=this.getList();return s.resolve(e.getDataSource().getModel(),{adapter:e.getDataSource().getAdapter(),idProperty:e.getProperty("idProperty"),rawData:t.getRawData()})},_getHistoryRecordId:function(t){return this._getHistoryRecord(t).get(this._getListIdProperty())},_getListIdProperty:function(){return this.getList().getDataSource().getIdProperty()||this.getList().getProperty("idProperty")},_needShowHistory:function(){var t=this._getListItems();return this._historyController&&!this.getText().length&&this._options.startChar&&(!t||!t.getCount()||!this.isPickerVisible())},_getHistoryRecordSetSync:function(){var t=this.getList().getDataSource(),e=new o({adapter:t.getAdapter(),rawData:[],idProperty:this._list.getProperty("idProperty"),model:t.getModel()});return e.assign(this._prepareHistoryData()),e},_prepareHistoryData:function(){for(var t=this._historyController,e=[],i=0,r=t.getCount();i<r;i++)e.push(this._getHistoryRecord(t.at(i).get("data")));return e},setSearchParamName:function(t){if(this._options.searchParam=t,this._searchController)this._searchController.setSearchParamName(t);else this._initializeSearchController()},_initializeSearchController:function(){this.subscribe("onSearch",function(t,e,i){var r=l(this.getList().getFilter());if(r[this._options.searchParam]=e,this.setListFilter(r,true),!i)this._showLoadingIndicator()}),this.once(this._getOption("autoShow")?"onFocusIn":"onSearch",function(){this._searchController=new e({view:this.getList(),searchForm:this,keyboardLayoutRevert:this._options.keyboardLayoutRevert,searchParamName:this._options.searchParam,doNotRespondOnReset:true,searchFormWithSuggest:true,keyboardLayoutRevertNew:this._options.keyboardLayoutRevertNew}),this._searchController.bindSearch()}),this.subscribe("onReset",this._resetSearch.bind(this))},_getLoadingContainer:function(){return this.getContainer().find(".controls-SuggestTextBox__afterFieldWrapper")},before:{hidePicker:function(){if(this._historyDeferred)this._historyDeferred.cancel()},_setTextByKeyboard:function(){this._changedByKeyboard=true},_observableControlFocusHandler:function(){if(this._options.historyId&&!this._historyController)this._historyController=new i({historyId:this._options.historyId,maxLength:f});if(this._needShowHistory())this._options.autoShow=false,this._showHistory()},_onListItemSelectNotify:function(t){this._addItemToHistory(t)},_addItemToHistory:function(t){if(this._historyController){var e=this.getList().getItems(),i=e?e.getIdProperty():this.getList().getProperty("idProperty"),r=t.get(i),o=-1;if(this._historyController.each(function(t,e){var s=t.get("data").getRawData(),n;if(s.d instanceof Array&&s.s instanceof Array){for(var a=-1,h=0;h<s.s.length;h++)if(s.s[h].n===i){a=h;break}if(a>-1)n=s.d[a]}else n=s[i];if(r===n)o=e}),-1!==o)this._historyController.removeAt(o);this._historyController.prepend(t.getRawData())}}},after:{_keyDownBind:function(e){if((e.which===t.key.enter||e.which===t.key.esc)&&this.isPickerVisible())_(e)},_inputFocusInHandler:function(t){!this._options.task1174306848&&this._observableControlFocusHandler(t)},_inputClickHandler:function(t){if(this.isActive()&&!this._options.task1174306848)this._observableControlFocusHandler(t)},_keyUpBind:function(e){var i=this.isPickerVisible();switch(e.which){case t.key.down:case t.key.up:case t.key.enter:if(i||this._selectedFromList)_(e);if(this._selectedFromList=false,i)this.getList()._keyboardHover(e);break;case t.key.esc:if(i)this.hidePicker(),_(e)}this._changedByKeyboard=false},_onListDataLoad:function(t,e){var i=this;if(this._options.searchParam){var r=function(){if(i._checkPickerState(!i._options.showEmptyList)){if(!i.getList().isLoading())i.showPicker()}else i.hidePicker()},o=this.getList(),s=o.getItems();if(e&&!e.getCount()&&s&&!s.getCount())r();else this.subscribeOnceTo(o,"onDrawItems",r)}},_resetSearch:function(){if(this._needShowHistory()&&!this.getSelectedKeys().length)this._showHistory();if(this._options.searchParam){var t=l(this.getList().getFilter());delete t[this._options.searchParam],this.setListFilter(t,true)}},destroy:function(){if(this._historyController)this._historyController.destroy(),this._historyController=null}},around:{_focusOutHandler:function(t,e,i,o){var s=false,n=this._list;if(n&&o)if(s=r.checkInclusion(n,o.getContainer()),!s)s=n.getChildControls(false,true,function(t){return o===t}).length;if(!s)this.hidePicker(),t.call(this,e,i,o)},_setPickerConfig:function(t){var e=t.apply(this,arguments);return e.tabindex=0,e.targetPart=true,e.closeOnTargetMove=!y.isMobilePlatform,e},setListFilter:function(t,e,i){t.call(this,e,i||!this._changedByKeyboard)}}}});
//# sourceMappingURL=SuggestTextBoxMixin.js.map
define("SBIS3.CONTROLS/Mixins/SuggestMixin",["Core/core-clone","Core/core-merge","Core/Deferred","SBIS3.CONTROLS/Mixins/PickerMixin","Core/core-instance","Core/helpers/Object/find"],function(t,i,e,s,o,n){"use strict";var r={template:"SBIS3.CONTROLS/Suggest/SuggestShowAll",componentOptions:{}},l={allowEmptySelection:false,itemsDragNDrop:false,emptyHTML:"Не найдено",scrollPaging:false,element:function(){return this._getListContainer()},filter:function(){return this.getProperty("listFilter")},parent:function(){return this._picker}};return{$protected:{_options:{delay:500,startChar:3,autoShow:false,usePicker:true,resultBindings:[],observableControls:[],list:{component:"SBIS3.CONTROLS/ListView",options:{}},listFilter:{},showAllConfig:{},showEmptyList:true},_resultBindings:{},_delayTimer:null,_loadingIndicator:void 0,_list:void 0,_listContainer:void 0,_loadDeferred:null,_showAllButton:void 0,_listReversed:false},$constructor:function(){if(!o.instanceOfMixin(this,"SBIS3.CONTROLS/Mixins/PickerMixin"))throw new Error("Mixin SBIS3.CONTROLS/Mixins/PickerMixin is required.");this._publish("onFilterBuild","onListReady","onListItemSelect"),this._showAllButtonHandler=this._showAllButtonHandler.bind(this),this._initBindingRules()},after:{init:function(){this._connectBindings()},destroy:function(){if(this._clearDelayTimer(),this._loadingIndicator=void 0,this._list)this._list.destroy()}},around:{_modifyOptions:function(t,i){var e=t.call(this,i);return e.cssClassName+=" controls-Suggest",e.pickerClassName+=" controls-Suggest__picker",e}},_initBindingRules:function(){var t=function(t){for(var i={},e=0,s=t.length;e<s;e++){var o=t[e];i[o.contextField]=o.itemField}return i};this._resultBindings=t(this._options.resultBindings)},setListFilter:function(t,i){var e=this,s=[],o=this._getListItems();for(var n in t)if(t.hasOwnProperty(n))if(t[n]!==e._options.listFilter[n])s.push(n);if(this._options.listFilter=t,this._notifyOnPropertyChanged("listFilter"),!this._isObservableControlFocused()||i){if(o&&o.getCount())o.clear();if(this._list)this._list.setFilter(this._options.listFilter,true);return}if(!s.length)return;for(var r=0,l=s.length;r<l;r++)if(String(this._options.listFilter[s[r]]||"").length>=this._options.startChar)return void this._startListSearch();this._resetSearch()},_startListSearch:function(){var t=this,i=this.getList();if(this._clearDelayTimer(),i.getDataSource())this._delayTimer=setTimeout(function(){t._showLoadingIndicator(),t._loadDeferred=i.reload(t._options.listFilter).addCallback(function(){if(t._checkPickerState(!t._options.showEmptyList))t.showPicker();else t.hidePicker()})},this._options.delay)},_resetSearch:function(){if(this._loadDeferred)this._loadDeferred.cancel(),this._loadDeferred=null;if(this._list&&this._list._cancelLoading)this._list._cancelLoading();this._hideLoadingIndicator(),this._clearDelayTimer(),this.hidePicker()},_connectBindings:function(){var t=this;this._options.observableControls.forEach(function(i){this.subscribeTo(i,"onFocusIn",t._observableControlFocusHandler.bind(t)),this.subscribeTo(i,"onFocusOut",function(i,e,s){if(t._list&&(t._list===s||~Array.indexOf(t._list.getChildControls(),s)))s.setActive(false,false,false,this),this.setActive(true)})},this)},_observableControlFocusHandler:function(){if(this._options.autoShow&&!this.isPickerVisible())this._startListSearch()},_showLoadingIndicator:function(){if(void 0===this._loadingIndicator){var t=this._getLoadingContainer()||this.getContainer();this._loadingIndicator=$('<div class="controls-Suggest__loadingIndicator">').appendTo(t.addClass("controls-Suggest__loadingContainer"))}this._loadingIndicator.removeClass("ws-hidden")},_hideLoadingIndicator:function(){if(this._loadingIndicator)this._loadingIndicator.addClass("ws-hidden")},_getLoadingContainer:function(){},getList:function(){var i,e,s;if(!this._list)if(o.instanceOfMixin(this._options.list,"SBIS3.CONTROLS/Mixins/DSMixin"))return this._list=this._options.list,this._initList(),this._list;else{i=t(this._options.list.options),e=require(this._options.list.component);for(var n in l)if(l.hasOwnProperty(n))if(!i.hasOwnProperty(n))i[n]="function"===typeof l[n]?l[n].call(this):l[n];if(void 0!==i.dataSource)s=i.dataSource,delete i.dataSource;else if(this._options.dataSource)s=this._options.dataSource;if(this._list=new e(i),s)this._list.setDataSource(s,true);return this._initList(),this._list}else return this._list},setAutoShow:function(t){this._options.autoShow=Boolean(t),this._notifyOnPropertyChanged("autoShow")},getAutoShow:function(){return this._options.autoShow},_initList:function(){var t=this;this.subscribeTo(this._list,"onDataLoad",this._onListDataLoad.bind(this)).subscribeTo(this._list,"onItemsReady",this._onListDataLoad.bind(this)).subscribeTo(this._list,"onDataLoadError",function(){t._hideLoadingIndicator(),t.setAutoShow(false)}).subscribeTo(this._list,"onDrawItems",this._onListDrawItems.bind(this)).subscribeTo(this._list,"onItemActivate",function(i,e){t.setActive(true),t.hidePicker(),t._onListItemSelect(e.id,e.item)}),this._notify("onListReady",this._list)},_getShowAllConfig:function(){if(!Object.isEmpty(this._options.showAllConfig))return this._options.showAllConfig;else return i({componentOptions:{chooserMode:this._options.chooserMode}},r)},_getListContainer:function(){if(void 0===this._listContainer){if(!this._picker)this._initializePicker();this._listContainer=$("<div/>").appendTo(this._picker.getContainer())}return this._listContainer},_onListDataLoad:function(){this._hideLoadingIndicator()},_showAllButtonHandler:function(){var t=this._getShowAllConfig(),i=this.getList(),e;if(e={filter:i.getFilter(),idProperty:i.getProperty("idProperty"),itemTpl:i.getProperty("itemTpl"),dataSource:i.getDataSource()},i.getColumns)e.columns=i.getColumns();if((!i.getItems()||!i.getItems().getCount())&&this._options.searchParam)delete e.filter[this._options.searchParam];if(!t.componentOptions)t.componentOptions={};t.componentOptions.listConfig=e,t.dialogOptions={className:"ws-float-area__block-layout"},this.hidePicker(),this.showSelector(t)},_updateList:function(){var t=this.getList();if(t.hasChildControlByName("showAllButton")){var i=t.getItems(),e=t.getChildControlByName("showAllButton"),s;if(!i||!i.getCount())s=true;else s=t._hasNextPage(i.getMetaData().more);if(s){if(-1===Array.indexOf(e.getEventHandlers("onActivated"),this._showAllButtonHandler))this.subscribeTo(e,"onActivated",this._showAllButtonHandler);e.setTabindex(0),e.show()}else this.unsubscribeFrom(e,"onActivated",this._showAllButtonHandler),e.hide()}return true},_getListItems:function(){return this._list?this._list.getItems():void 0},_onListDrawItems:function(){if(this._picker)this._updateList(),this._picker.getContainer().height("auto"),this._picker.recalcPosition(true,true)},_onListItemSelect:function(t,i){var s=new e,o=this._getListItems();if(null===t||void 0===t)return;if(i)s.callback(i);else if(o)s.callback(o.getRecordById(t));else this.getList().getDataSource().read(t).addCallback(function(t){s.callback(t)});s.addCallback(this._onListItemSelectNotify.bind(this,i))},_onListItemSelectNotify:function(t){var i=this._getBindingContext(),e={};this._notify("onListItemSelect",t,this._resultBindings);for(var s in this._resultBindings)if(this._resultBindings.hasOwnProperty(s))e[s]=t.get(this._resultBindings[s]);i.setValue(e,false,this._list)},_clearDelayTimer:function(){if(this._delayTimer)clearTimeout(this._delayTimer),this._delayTimer=null},_isObservableControlFocused:function(){return n(this._options.observableControls,function(t){return t.isActive()},this,false)},_checkPickerState:function(t){var i=this._getListItems(),e=t?i&&i.getCount():true;return Boolean(this._options.usePicker&&e&&this._isObservableControlFocused())},_setPickerContent:function(){this._picker._notifyOnSizeChanged=function(){}},showPicker:function(){if(this._options.usePicker&&!this.isPickerVisible()&&this.isEnabled())s.showPicker.apply(this,arguments)},_reverseList:function(t){if(this._listReversed===t)return;var i=this._list;if(this._listReversed=t,i&&i.setItemsSortMethod)if(t){if(!i.getProperty("itemsSortMethod"))i.setItemsSortMethod(function(t,i){return i.collectionIndex-t.collectionIndex})}else i.setItemsSortMethod(null)}}});
//# sourceMappingURL=SuggestMixin.js.map
define("SBIS3.CONTROLS/Mixins/ChooserMixin",["Core/Context","Core/core-clone","Core/core-merge","Core/Deferred","WS.Data/Entity/Model","WS.Data/Adapter/Sbis"],function(o,e,t,i,n,r){function s(o){var e;if(o.hasColumn(this._options.idProperty))e=this._options.idProperty;return new n({rawData:o.toJSON(),adapter:new r,idProperty:e?e:o.getKeyField()})}return{$protected:{_options:{oldViews:false,chooserMode:"floatArea"},_chooserConfig:{config:{isStack:true,autoHide:true,autoCloseOnHide:true,overlay:true},type:{old:{dialog:"Deprecated/Controls/DialogSelector/DialogSelector",floatArea:"Deprecated/Controls/DialogSelector/FloatAreaSelector"},newType:{dialog:"SBIS3.CONTROLS/Dialog/DialogSelector",floatArea:"SBIS3.CONTROLS/FloatArea/FloatAreaSelector"}}}},$constructor:function(){this._publish("onChooserClick")},_showChooser:function(n,r,l){var a=this,c=this._getAdditionalChooserConfig(),h,d,f,u;function C(o,e){if(this&&this!==window&&this.close)this.close();a._chooseCallback(e.reduce(function(o,e){if(null!==e)return o.push(s.call(a,e)),o},[]))}if(u=this._notify("onChooserClick",n),h=this._options.oldViews?"old":"newType",false===u)return;else if(u instanceof i)return void u.addCallback(function(o){return a._options.oldViews?C(null,o):a._chooseCallback(o),o});if(d={old:{handlers:{onChange:C}},newType:{closeCallback:a._chooseCallback.bind(a)}},f=t({template:n,componentOptions:r||{},opener:this,parent:"dialog"===this._options.chooserMode?this:null,context:o.createContext(a,null,this.getLinkedContext()),target:this.getContainer()},c||{}),l)f=t(f,l);requirejs([this._chooserConfig.type[h][this._options.chooserMode]],function(o){a._chooserDialog=new o(t(e(a._chooserConfig.config),t(d[h],f))),a._chooserDialog.subscribe("onAfterClose",function(){a._chooserDialog=void 0})})},showSelector:function(o){this._showChooser(o.template,o.componentOptions,o.dialogOptions)},_getAdditionalChooserConfig:function(){return{}},_chooseCallback:function(){},after:{destroy:function(){if(this._chooserDialog)this._chooserDialog.destroy(),this._chooserDialog=void 0}}}});
//# sourceMappingURL=ChooserMixin.js.map
define("SBIS3.CONTROLS/Suggest/SuggestTextBox",["SBIS3.CONTROLS/TextBox","SBIS3.CONTROLS/TextBox/resources/TextBoxUtils","SBIS3.CONTROLS/Mixins/PickerMixin","SBIS3.CONTROLS/Mixins/SuggestMixin","SBIS3.CONTROLS/Mixins/ChooserMixin","SBIS3.CONTROLS/Mixins/SuggestTextBoxMixin","SBIS3.CONTROLS/Mixins/SearchMixin","tmpl!SBIS3.CONTROLS/Suggest/resources/afterFieldWrapper","Core/core-instance","css!SBIS3.CONTROLS/Suggest/SuggestTextBox/SuggestTextBox"],function(s,i,t,e,n,r,o,c,a){"use strict";var S=s.extend([t,e,n,r,o],{$protected:{_options:{afterFieldWrapper:c},_crossContainer:null},$constructor:function(){this._crossContainer=$(".js-controls-SuggestTextBox__reset",this._container),this.subscribe("onTextChange",function(s,i){this._crossContainer.toggleClass("ws-hidden",!i)}),this._crossContainer.click(this.resetSearch.bind(this))},_chooseCallback:function(s){if(s&&a.instanceOfModule(s[0],"WS.Data/Entity/Model")){var i=s[0];this._onListItemSelect(i.getId(),i)}},_modifyOptions:function(){var s=S.superclass._modifyOptions.apply(this,arguments);return s.cssClassName+=" controls-SuggestTextBox",s},_onResizeHandler:function(){if(S.superclass._onResizeHandler.apply(this,arguments),this.isPickerVisible())i.setEqualPickerWidth(this._picker)},showPicker:function(){S.superclass.showPicker.apply(this,arguments),i.setEqualPickerWidth(this._picker)},_onListDrawItems:function(){S.superclass._onListDrawItems.apply(this,arguments),i.setEqualPickerWidth(this._picker)},_updateList:function(){if(S.superclass._updateList.apply(this,arguments),this.isPickerVisible())i.setEqualPickerWidth(this._picker)},destroy:function(){S.superclass.destroy.apply(this,arguments),this._crossContainer.unbind("click"),this._crossContainer=null}});return S});
//# sourceMappingURL=SuggestTextBox.js.map
define("SBIS3.CONTROLS/Mixins/SyncSelectionMixin",["WS.Data/Entity/Model","Core/core-instance","SBIS3.CONTROLS/Utils/ArraySimpleValuesUtil","SBIS3.CONTROLS/Utils/ItemsSelectionUtil"],function(e,t,s,i){var o={selectedItem:true,selectedItems:true,selectedKeys:true,selectedKey:true};return{$constructor:function(){if(this._options.selectedItem instanceof e)this.initializeSelectedItems(),this._options.selectedItems.assign([this._options.selectedItem]),this._options.selectedKeys=this._convertToKeys(this._options.selectedItems);if(this._options.selectedKey)this._options.selectedKeys=[this._options.selectedKey];else if(this._options.selectedKeys.length)this._options.selectedKey=this._options.selectedKeys[0];this.subscribe("onPropertyChanged",function(e,n){var l,c,d;if(o[n])switch(l=this.getProperty(n),n){case"selectedItem":if(t.instanceOfModule(l,"WS.Data/Entity/Model")&&!i.isEmptyItem(l,this._options.displayProperty,this._options.idProperty))this.setSelectedItems([l]);else this.clearSelectedItems();break;case"selectedKey":if(null===l)this.clearSelectedItems();else this.setSelectedKeys([l]);break;case"selectedItems":if(c=l&&l.at(0),d=this.getSelectedKey(),c)this._options.selectedItem=c,this._options.selectedKey=c.get(this._options.idProperty);else this._options.selectedItem=null,this._options.selectedKey=null;if(!s.hasInArray([this._options.selectedKey],d))this._notify("onSelectedItemChange",this._options.selectedKey,this._options.selectedIndex);break;case"selectedKeys":if(d=l.length?l[0]:null,!s.hasInArray([this._options.selectedKey],d))this._options.selectedKey=d,this._notify("onSelectedItemChange",this._options.selectedKey,this._options.selectedIndex)}})},around:{setSelectedItem:function(e,t){if(i.checkItemForSelect(t,this._options.selectedItem,this._options.idProperty,this._options.displayProperty,this._isEmptySelection()))e.call(this,t)}}}});
//# sourceMappingURL=SyncSelectionMixin.js.map
define("SBIS3.CONTROLS/Mixins/ActiveSelectable",["Core/Deferred","WS.Data/Entity/Model","Core/core-instance","SBIS3.CONTROLS/Utils/ToSourceModel","SBIS3.CONTROLS/Utils/SourceUtil","SBIS3.CONTROLS/Utils/ArraySimpleValuesUtil"],function(e,t,i,s,o,l){return{$protected:{_options:{selectedItem:null},_loadItemDeferred:null},before:{_modifyOptions:function(e){if(e.selectedItem instanceof t)return e;if(e.displayField)e.displayProperty=e.displayField;if(e.keyField)e.idProperty=e.keyField;if(e.selectedItem&&!Object.isEmpty(e.selectedItem)&&e.selectedItem[e.idProperty]&&e.selectedItem[e.displayProperty])e.selectedItem=s([new t({idProperty:e.idProperty,rawData:e.selectedItem})],o.prepareSource(e.dataSource),e.idProperty)[0],e.selectedKey=e.selectedItem.get(e.idProperty);return e}},$constructor:function(){if(!i.instanceOfMixin(this,"SBIS3.CONTROLS/Mixins/Selectable"))throw new Error("Selectable mixin is required");this._options.selectedItem=this._options.selectedItem instanceof t?this._options.selectedItem:null},setSelectedItem:function(e){var i=e instanceof t,s=this._options.selectedKey,o;if(!i&&!this._options.selectedItem)return;if(this._options.selectedItem=i?e:null,o=i?e.get(this._options.idProperty):null,void 0===o)throw new Error(this._moduleName+": record key is undefined.");this._options.selectedKey=o,this._notifyOnPropertyChanged("selectedItem"),this._options.selectedKey=s,this.setSelectedKey(o)},initializeSelectedItem:function(){this._options.selectedItem=new t({idProperty:this._options.idProperty})},getSelectedItem:function(t){if(this._syncSelectedItem(),!t)return this._options.selectedItem;else if(this._loadItemDeferred&&!this._loadItemDeferred.isReady())return this._loadItemDeferred;var i=new e,s,o,l=this;if(this._loadItemDeferred=i,s=this._options.selectedItem,o=this._options.selectedKey,null!==o)if(!s){var r=this.getItems()&&this.getItems().getRecordById(o);if(r)i.callback(this._options.selectedItem=r),this._notifyOnPropertyChanged("selectedItem");else this._dataSource.read(o).addCallback(function(e){i.callback(l._options.selectedItem=e),l._notifyOnPropertyChanged("selectedItem")})}else i.callback(s);else i.callback(s);return i},_syncSelectedItem:function(){var e=this._options.selectedItem,t=this._options.selectedKey,i;if(e)i=e.get(this._options.idProperty);if(i&&(null===t||!l.hasInArray([i],t)))this._options.selectedItem=null,this._notifyOnPropertyChanged("selectedItem")}}});
//# sourceMappingURL=ActiveSelectable.js.map
define("SBIS3.CONTROLS/Mixins/ActiveMultiSelectable",["WS.Data/Entity/Model","Core/core-instance"],function(e,t){return{$protected:{_options:{}},$constructor:function(){if(!t.instanceOfMixin(this,"SBIS3.CONTROLS/Mixins/MultiSelectable"))throw new Error("MultiSelectable mixin is required")},setSelectedItems:function(e){var t;if(e)if(e=this._prepareItems(e),e.getCount()&&!this._options.multiselect)t=this._makeList([e.at(0)]);else t=e;else t=null;this._options.selectedItems=t,this._onChangeSelectedItems()},clearSelectedItems:function(){this.setSelectedItems([])},_prepareItems:function(e){var i,s;if(e instanceof Array)if(s=this.getSelectedItems(),t.instanceOfModule(s,"WS.Data/Collection/RecordSet"))i=this._makeList(this._convertRecordsFormat(e,s));else i=this._makeList(e);else if(null===e)i=this._makeList();else if(!t.instanceOfModule(e,"WS.Data/Collection/List"))throw new Error("ActiveMultiSelectable::setSelectedItems called with invalid argument");else i=e;return i},_convertRecordsFormat:function(e,t){for(var i=[],s=0,n=e.length;s<n;s++)i.push(this._createModelByRecordSetFormat(e[s],t));return i},_createModelByRecordSetFormat:function(t,i){var s=i.getFormat(),n;if(s.isEqual(t.getFormat()))return t;if(n=new e({adapter:i.getAdapter(),format:i.getFormat()}),s.each(function(e){var i=e.getName(),s=t.get(i);if(s)n.set(i,s)}),this._options.idProperty)n.set(i.getIdProperty(),t.get(this._options.idProperty));return n},addSelectedItems:function(e){var t=this,i=[];if(e=this._prepareItems(e),!e.getCount())return;if(this._options.multiselect)e.each(function(e){if(!t._isItemSelected(e))i.push(e)});else i.push(e.at(0));if(i.length)this.getSelectedItems(true).addCallback(function(e){if(e){if(e=e.clone(),!t._options.multiselect)e.clear();e.append(i),t._options.selectedItems=e}else t._options.selectedItems=t._makeList(i);return t._onChangeSelectedItems(),e})},_onChangeSelectedItems:function(){var e=this._convertToKeys(this._options.selectedItems),t=this._options.selectedKeys;this._options.selectedKeys=e,this._notifyOnPropertyChanged("selectedItems"),this._options.selectedKeys=t,this.setSelectedKeys(e)}}});
//# sourceMappingURL=ActiveMultiSelectable.js.map
define("tmpl!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/defaultItemTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},a=function e(a,i,l,o,n){function s(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var m="string"==typeof l?l:"",u=void 0===r?void 0:r,g={id:[],def:void 0},v=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),f=this&&this.includedTemplates?this.includedTemplates:{},y=c.getMarkupGenerator(o);try{var T=y.joinElements([y.createTag("div",{class:"controls-FieldLink__item js-controls-ListView__item controls-ListView__item "+c.wrapUndef(c.utils.escape(c.getDecorators().orEmpty.apply(void 0,[c.getter(a,["className"])])))+c.wrapUndef(c.utils.escape(c.getter(c.getter(a,["getItemTemplateData"]).apply(a,[c.uniteScope(a,{parent:void 0,element:void 0})(c.plainMerge)]),["additionalItemClasses"]))),"data-hash":""+c.wrapUndef(c.utils.escape(c.getter(a,["projItem","getHash"]).apply(c.getter(a,["projItem"]),[]))),"data-id":""+c.wrapUndef(c.utils.escape(c.getter(a,["item","getId"]).apply(c.getter(a,["item"]),[])+"")),style:""+c.wrapUndef(c.utils.escape(c.getter(c.getter(a,["getItemTemplateData"]).apply(a,[c.uniteScope(a,{parent:void 0,element:void 0})(c.plainMerge)]),["orderStyle"])))},[y.createTag("span",{class:"controls-FieldLink__item-caption"+c.wrapUndef(c.utils.escape(c.getter(c.getter(a,["getItemTemplateData"]).apply(a,[c.uniteScope(a,{parent:void 0,element:void 0})(c.plainMerge)]),["additionalItemCaptionClasses"]))),title:""+c.wrapUndef(c.utils.escape(c.getter(a,["needTitle"])?c.getter(a,["item",c.getter(a,["displayProperty"])]):""))},[y.createControl("resolver",c.getter(a,["itemContent"]),c.uniteScope(c.utils.escape(c.uniteScope(a,{parent:void 0,element:void 0})(c.plainMerge)),{}),{},{data:a,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},l,u,f,c.config,d,g)],{},g,this),c.getter(c.getter(a,["getItemTemplateData"]).apply(a,[c.uniteScope(a,{parent:void 0,element:void 0})(c.plainMerge)]),["drawCross"])?[y.createTag("span",{class:"controls-FieldLink__item-cross controls-FieldLink__button js-controls__item-cross icon-size icon-CloseNew icon-disabled"},[],{},g,this)]:y.createText(""),c.getter(c.getter(a,["getItemTemplateData"]).apply(a,[c.uniteScope(a,{parent:void 0,element:void 0})(c.plainMerge)]),["drawComma"])?[y.createText(""+global.rk(","))]:y.createText("")],i,g,this)],m,g);g.def&&(T=y.chain(T,g,i),g=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/defaultItemTemplate.tmpl",e,a)}return T||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/defaultItemTemplate"}},a});
//# sourceMappingURL=defaultItemTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/defaultItemContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},l=function e(l,n,i,o,s){function a(){}var u=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var p="string"==typeof i?i:"",m=void 0===r?void 0:r,f={id:[],def:void 0},v=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,l),C=this&&this.includedTemplates?this.includedTemplates:{},S=c.getMarkupGenerator(o);try{var y=S.joinElements([S.createText(""+c.wrapUndef(c.utils.escape(c.getter(l,["item",c.getter(l,["displayProperty"])]))))],p,f);f.def&&(y=S.chain(y,f,n),f=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/defaultItemContentTemplate.tmpl",e,l)}return y||""};return l.includedFunctions={},l.stable=!0,l.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/defaultItemContentTemplate"}},l});
//# sourceMappingURL=defaultItemContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/FieldLinkItemsCollection",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,o,l,n,s){function c(){}var a=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};s&&s.isSetts&&(u=s.fullContext||{});var m="string"==typeof l?l:"",p=void 0===r?void 0:r,v={id:[],def:void 0},f=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),C=this&&this.includedTemplates?this.includedTemplates:{},g=d.getMarkupGenerator(n);try{var S=g.joinElements([g.createTag("div",{class:"controls-FieldLink__itemsCollection"},[d.getter(i,["_serverRender"])?[g.createControl("resolver",d.getter(i,["_itemsTemplate"]),{records:d.getter(i,["_records"]),tplData:d.getter(i,["_itemData"])},{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},l,p,C,d.config,u,v)]:g.createText("")],o,v,this)],m,v);v.def&&(S=g.chain(S,v,o),v=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/FieldLinkItemsCollection.tmpl",e,i)}return S||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/FieldLinkItemsCollection"}},i});
//# sourceMappingURL=FieldLinkItemsCollection.tmpl.map
define("SBIS3.CONTROLS/FieldLink/resources/ItemsCollection",["Lib/Control/CompoundControl/CompoundControl","Core/detection","SBIS3.CONTROLS/Mixins/ItemsControlMixin","SBIS3.CONTROLS/Mixins/PickerMixin","tmpl!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/FieldLinkItemsCollection","tmpl!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/defaultItemTemplate","tmpl!SBIS3.CONTROLS/FieldLink/resources/ItemsCollection/defaultItemContentTemplate","Core/core-instance","Core/detection","Core/helpers/Hcontrol/getScrollWidth","SBIS3.CONTROLS/Utils/ItemsSelectionUtil"],function(e,i,t,n,s,o,r,l,c,a,d){"use strict";function _(e){var t=e._buildTplArgsSt.call(this,e),n="",s="";if(t.itemsCount=e._itemsProjection.getCount(),t.needSort=e._isPickerVisible||i.isIE,t.needTitle=!e.itemContentTpl,n=e._isPickerVisible?" controls-FieldLink__item-inPicker":" controls-FieldLink__item-inField",1===t.itemsCount)n+=" controls-FieldLink__item-single";if(e.underlinedItems)s+=" controls-FieldLink__item-caption__underlined";if(e.boldItems)s+=" controls-FieldLink__item-caption__bold";if(e.bigItems)s+=" controls-FieldLink__item-caption__big";else s+=" controls-FieldLink__item-caption__normal";return t.getItemTemplateData=function(i){var o="",r;if(t.needSort)o="order: "+(r=(i.itemsCount||0)-i.projItem.getOwner().getIndexByInstanceId(i.projItem.getInstanceId()))+"; -ms-flex-order: "+r+";";return{additionalItemCaptionClasses:s,additionalItemClasses:n,orderStyle:o,drawCross:e.enabled,drawComma:i.projItem.getOwner().getIndex(i.projItem)!==i.itemsCount-1&&!e._isPickerVisible}},t}function C(e){var i=this.getPicker().getContainer();i[0].style.maxWidth=e+"px",i[0].style.minWidth=e+"px"}var m=e.extend([t,n],{_dotTplFn:s,$protected:{_options:{_defaultItemContentTemplate:r,_defaultItemTemplate:o,_canServerRender:true,_buildTplArgs:_,_isPickerVisible:false},_parentFieldLink:void 0},$constructor:function(){this._publish("onCrossClick","onItemActivate","onShowPicker","onClosePicker"),this._parentFieldLink=this.getParent()},_onClickHandler:function(e){var i=this;m.superclass._onClickHandler.apply(this,arguments),d.clickHandler.call(i,e.target,function(e){if(i._notify("onCrossClick",e),i.isPickerVisible())i.getPicker().recalcPosition(true,true)},function(e){if(void 0!==e)i._notify("onItemActivate",e)})},_getItemTemplate:function(){return this._options._defaultItemTemplate},_setEnabled:function(){var e=this.getItems();if(this._clearItems(),m.superclass._setEnabled.apply(this,arguments),e&&e.getCount())this.redraw()},_getItemsContainer:function(){return this.isPickerVisible()?this._picker.getContainer():this._container},setItems:function(e){if(e)if(!l.instanceOfModule(e,"WS.Data/Collection/RecordSet"))e=e.clone();else e.setEventRaising(false,false);else e=[];m.superclass.setItems.call(this,e)},_initFocusCatch:function(){},canAcceptFocus:function(){},_drawItemsCallbackSync:function(){if(this.isPickerVisible()&&!this.getItems().getCount())this.hidePicker()},showPicker:function(){var e,i;if(this.isEnabled())this._clearItems();else this.getContainer().addClass("ws-invisible");if(m.superclass.showPicker.apply(this,arguments),this._options._isPickerVisible=true,this.redraw(),e=this._picker.getContainer(),i=this._parentFieldLink.getContainer()[0].offsetWidth,C.call(this,i),(c.isIE10||c.isIE11)&&e[0].offsetHeight<e[0].scrollHeight)i-=a(),this._picker.recalcPosition(true),C.call(this,i);this._picker.recalcPosition(true)},_setPickerContent:function(){this._picker.getContainer().on("click",".controls-FieldLink__item",this._onClickHandler.bind(this)),this._picker._notifyOnSizeChanged=function(){}},_setPickerConfig:function(){var e=this,i=["controls-FieldLink__picker"];return{corner:"bl",target:this._parentFieldLink.getContainer(),opener:this._parentFieldLink,closeByExternalClick:true,closeOnTargetMove:true,targetPart:true,cssClassName:i.join(" "),activableByClick:false,verticalAlign:{side:"top"},horizontalAlign:{side:"left"},handlers:{onClose:function(){if(e._options._isPickerVisible=false,!e.isEnabled())e.getContainer().removeClass("ws-invisible");setTimeout(e.redraw.bind(e),0)}}}},_onAlignmentChangeHandler:function(e){if(m.superclass._onAlignmentChangeHandler.apply(this,arguments),"bottom"===e.verticalAlign.side)this._picker.getContainer().addClass("controls-FieldLink__picker_revert_vertical");else this._picker.getContainer().removeClass("controls-FieldLink__picker_revert_vertical")},destroy:function(){if(this._picker)this._picker.getContainer().off("click");m.superclass.destroy.apply(this,arguments)}});return m});
//# sourceMappingURL=ItemsCollection.js.map
define("tmpl!SBIS3.CONTROLS/FieldLink/Link/FieldLink_Link",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),i=e[0],n={},t=function e(t,r,l,o,a){function d(){}var s=0,c=void 0!==i&&i?i:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};a&&a.isSetts&&(u=a.fullContext||{});var p="string"==typeof l?l:"",L=void 0===n?void 0:n,k={id:[],def:void 0},v=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,t),f=this&&this.includedTemplates?this.includedTemplates:{},S=c.getMarkupGenerator(o);try{var m=S.joinElements([S.createTag("div",{class:"controls-FieldLink__Link "+c.wrapUndef(c.utils.escape(c.getter(t,["enabled"])?"controls-FieldLink__Link_enabled":"controls-FieldLink__Link_disabled"))},[S.createText(""+c.wrapUndef(c.Sanitize.apply(void 0,[c.getDecorators().sanitize.apply(void 0,[c.getter(t,["caption"])])])))],r,k,this)],p,k);k.def&&(m=S.chain(m,k,r),k=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/FieldLink/Link/FieldLink_Link.tmpl",e,t)}return m||""};return t.includedFunctions={},t.stable=!0,t.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/FieldLink/Link/FieldLink_Link"}},t});
//# sourceMappingURL=FieldLink_Link.tmpl.map
define("SBIS3.CONTROLS/FieldLink/Link",["js!WSControls/Buttons/ButtonBase","tmpl!SBIS3.CONTROLS/FieldLink/Link/FieldLink_Link","css!SBIS3.CONTROLS/FieldLink/Link/FieldLink_Link"],function(i,n){"use strict";var t=i.extend({_dotTplFn:n,$constructor:function(){this._options.command="showSelector",this._options.activableByClick=false,this.setTabindex(0)},setCaption:function(){t.superclass.setCaption.apply(this,arguments),this.getContainer().html(this._options.caption)},setEnabled:function(i){t.superclass.setEnabled.apply(this,arguments),this.getContainer().toggleClass("controls-FieldLink__Link_enabled",i).toggleClass("controls-FieldLink__Link_disabled",!i)}});return t});
//# sourceMappingURL=Link.js.map
define("SBIS3.CONTROLS/Action/Utils/OpenDialogUtil",["Core/core-merge"],function(e){"use strict";return{getOptionsFromProto:function(r,o){var t={},i;return(r.prototype||r)._initializer.call(t),i=t._options,e(i,o||{}),i},errorProcess:function(e){e.processed=true,require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(r){r.showMessageDialog({message:e.message,status:"error"})})}}});
//# sourceMappingURL=OpenDialogUtil.js.map
define("SBIS3.CONTROLS/Action/SelectorAction",["SBIS3.CONTROLS/Action","SBIS3.CONTROLS/Action/Mixin/DialogMixin","SBIS3.CONTROLS/Action/Utils/OpenDialogUtil","Core/core-merge","Core/Deferred","Core/Context","Core/Indicator","Core/helpers/Function/forAliveOnly"],function(e,t,o,n,l,r,c,i){"use strict";var s=e.extend([t],{_buildComponentConfig:function(e){var t=n({},s.superclass._buildComponentConfig.call(this,e),{clone:true});function o(e,t){this.sendCommand("close",t)}if(e.hasOwnProperty("multiselect"))t.multiselect=e.multiselect;if(e.selectedItems)t.selectedItems=e.selectedItems.clone();if(e.selectionType)t.selectionType=e.selectionType;if(t.handlers)if(t.handlers.onSelectComplete)t.handlers.onSelectComplete=[t.handlers.onSelectComplete,o];else t.handlers.onSelectComplete=o;else t.handlers={onSelectComplete:o};return t},_createComponent:function(e,t,n){var a=this,u={},d;function m(o){var l=e.context||r.createContext(a,null,r.global);if(o)l.setValue("items",o),e.context=l;s.superclass._createComponent.call(a,e,t,n)}function p(e){o.errorProcess(e)}c.setMessage(rk("Загрузка..."),true),require([e.template],function(n){if(u=o.getOptionsFromProto(n,e),u.dataSource&&n.prototype.getItemsFromSource)d=n.prototype.getItemsFromSource.call(n.prototype,e,t).addCallback(function(e){return e.getAll()}).addErrback(function(e){return p(e),e}).addBoth(function(e){return c.hide(),e});else c.hide(),d=l.success(e.componentOptions.items||[]);d.addCallback(i(function(e){return m(e),e},a))})}});return s});
//# sourceMappingURL=SelectorAction.js.map
define("SBIS3.CONTROLS/FieldLink",["SBIS3.CONTROLS/Utils/ConfigByClasses","Core/CommandDispatcher","Core/constants","Core/IoC","Core/core-instance","Core/helpers/Function/forAliveOnly","Core/helpers/Function/memoize","SBIS3.CONTROLS/Utils/Contains","Core/helpers/string-helpers","SBIS3.CONTROLS/ControlHierarchyManager","SBIS3.CONTROLS/Suggest/SuggestTextBox","SBIS3.CONTROLS/Mixins/ItemsControlMixin","SBIS3.CONTROLS/Mixins/MultiSelectable","SBIS3.CONTROLS/Mixins/ActiveMultiSelectable","SBIS3.CONTROLS/Mixins/Selectable","SBIS3.CONTROLS/Mixins/ActiveSelectable","SBIS3.CONTROLS/Mixins/SyncSelectionMixin","tmpl!SBIS3.CONTROLS/FieldLink/FieldLink","tmpl!SBIS3.CONTROLS/FieldLink/afterFieldWrapper","tmpl!SBIS3.CONTROLS/FieldLink/beforeFieldWrapper","tmpl!SBIS3.CONTROLS/FieldLink/textFieldWrapper","tmpl!SBIS3.CONTROLS/FieldLink/resources/showSelectorButton","SBIS3.CONTROLS/Mixins/ITextValue","SBIS3.CONTROLS/Utils/ToSourceModel","WS.Data/Collection/List","SBIS3.CONTROLS/Utils/ItemsSelectionUtil","Core/helpers/Object/find","SBIS3.CONTROLS/FieldLink/resources/ItemsCollection","SBIS3.CONTROLS/Utils/TemplateUtil","SBIS3.CONTROLS/Button/IconButton","SBIS3.CONTROLS/Action/SelectorAction","SBIS3.CONTROLS/FieldLink/Link","SBIS3.CONTROLS/Menu/MenuIcon","i18n!SBIS3.CONTROLS/FieldLink","css!SBIS3.CONTROLS/FieldLink/FieldLink","css!SBIS3.CONTROLS/Suggest/Suggest"],function(e,t,i,s,o,l,n,r,c,h,a,d,u,_,p,f,S,C,m,g,k,I,y,L,w,b,B){"use strict";function v(t,i){var s=i&&i.class||t.element&&t.element.className||t.className||"";e(t,[{class:"controls-FieldLink__itemsEdited",optionName:"underlinedItems",value:true,defaultValue:false},{class:"controls-FieldLink__itemsBold",optionName:"boldItems",value:true,defaultValue:false},{class:"controls-FieldLink__big-fontSize",optionName:"bigItems",value:true,defaultValue:false},{class:"controls-FieldLink__hideSelector",optionName:"showSelector",value:false,defaultValue:true},{class:"controls-FieldLink__hiddenIfEmpty",optionName:"hideIfEmpty",value:true,defaultValue:false}],s)}function F(e){var t=e.selectedKeys.length;e._selectedMultipleItems=A.selectedMultipleItems(e),e._drawHiddenTextBoxField=!e.multiselect&&t>0&&!e.alwaysShowTextBox}var T={MULTISELECT:"controls-FieldLink__multiselect",SELECTED:"controls-FieldLink__selected",SELECTED_SINGLE:"controls-FieldLink__selected-single",INVISIBLE:"ws-invisible"},A={keysFix:function(e){if(void 0!==e&&!Array.isArray(e))e=[e];return e},selectedMultipleItems:function(e){return e.multiselect&&e.selectedKeys.length>1}},E=a.extend([u,_,p,f,S,d,y],{_dotTplFn:C,$protected:{_lastFieldLinkWidth:null,_showAllButton:null,_options:{_paddingClass:" controls-InputRender_paddingLeft",afterFieldWrapper:m,beforeFieldWrapper:g,textFieldWrapper:k,showSelectorButton:I,list:{component:"SBIS3.CONTROLS/DataGridView",options:{showHead:false,columns:[]}},dictionaries:[],alwaysShowTextBox:false,boldItems:false,bigItems:false,underlinedItems:false,showSelector:true,useSelectorAction:false,selectMode:"floatArea",hideIfEmpty:false,saveParentRecordChanges:false,reverseItemsOnListRevert:true,menuSelector:false}},$constructor:function(){var e=t,i=this;if(this._publish("onItemActivate"),e.declareCommand(this,"clearAllItems",this._dropAllItems),e.declareCommand(this,"showAllItems",this._showAllItems),e.declareCommand(this,"showSelector",this._showSelector),this.subscribe("onListItemSelect",function(e,t){this.addSelectedItems([t.clone()]),this.setText("")}),this.subscribe("onSelectedItemsChange",function(e,t,s){if(i.getText()&&!i._options.alwaysShowTextBox)i.resetSearch();if(s.added.length&&!i._isEmptySelection()){if(this.isActive()&&!this._isInputVisible())this._getElementToFocus().focus();i.getSelectedItems(true).addCallback(function(e){return i.validate(),e})}}),this._options.oldViews)s.resolve("ILogger").log("FieldLink","В 3.8.0 будет удалена опция oldViews, а так же поддержка старых представлений данных на диалогах выбора.")},_updateTextBoxVisibility:function(){var e=!this.getMultiselect()&&this.getSelectedKeys().length>0&&!this._options.alwaysShowTextBox;$(".controls-InputRender__fieldWrapper",this.getContainer()).toggleClass("ws-invisible",e)},init:function(){if(E.superclass.init.apply(this,arguments),this._options.useSelectorAction)b.initSelectorAction(this._getSelectorAction(),this);if(this.getContainer().on("mousedown",this._onMouseDownHandler.bind(this)),this._options.menuSelector){var e=this.getChildControlByName("fieldLinkMenu");e.setItems(this._options.dictionaries),this.subscribeTo(e,"onMenuItemActivate",this._menuItemActivatedHandler)}if(this.subscribeTo(this,"onAfterVisibilityChange",function(e,t){if(t)this._onResizeHandler()}),!this._isEmptySelection()&&(this.getMultiselect()||this.getProperty("alwaysShowTextBox")))this._onResizeHandler()},_initLinkCollectionEvents:function(){var e=this;this.subscribe("onTextChange",this._linkCollection.hidePicker.bind(this._linkCollection)),this.subscribeTo(this._linkCollection,"onDrawItems",this._onDrawItemsCollection.bind(this)).subscribeTo(this._linkCollection,"onCrossClick",this._onCrossClickItemsCollection.bind(this)).subscribeTo(this._linkCollection,"onItemActivate",this._onItemActivateItemsCollection.bind(this)).subscribeTo(this._linkCollection,"onClosePicker",this._onItemActivateItemsCollection.bind(this)).subscribeTo(this._linkCollection,"onShowPicker",this._onItemActivateItemsCollection.bind(this)).subscribeTo(this._linkCollection,"onFocusIn",function(){if(i.browser.isMobilePlatform&&e._isInputVisible())e._fromTouch=true;e.setActive(true)})},_onMouseDownHandler:function(e){var t=$(e.target);if(this._options.multiselect&&t.hasClass("controls-FieldLink__showAllLinks"))this._showAllItems(),this._getElementToFocus().focus(),e.preventDefault()},_onClickHandler:function(e){var t;if(E.superclass._onClickHandler.apply(this,arguments),e.originalEvent.detail<=1||i.browser.isIE){if(t=$(e.target),t.hasClass("controls-FieldLink__showSelector-button"))return void this.sendCommand("showSelector");if(t.hasClass("controls-FieldLink__dropAllLinks"))this.sendCommand("clearAllItems")}},_getSelectorAction:n(function(){return this.getChildControlByName("FieldLinkSelectorAction")},"_getSelectorAction"),_getShowAllConfig:function(){if(Object.isEmpty(this._options.showAllConfig))return this._options.dictionaries[0];return this._options.showAllConfig},_notify:function(e){if("onSearch"===e&&this._options.alwaysShowTextBox&&!this._isEmptySelection())return false;return b.delayedNotify(E.superclass._notify,arguments,this)},_menuItemActivatedHandler:function(e,t){var i=this.getItems().getRecordById(t);this.getParent().showSelector(i.get("template"),i.get("componentOptions"),i.get("selectionType"))},setDictionaries:function(e){if(this._options.dictionaries=e,this._options.menuSelector)this.getChildControlByName("fieldLinkMenu").setItems(e);this._notifyOnPropertyChanged("dictionaries")},setSelectedKey:function(e){this._options.selectedKey=e,this._notifySelectedItem(this._options.selectedKey)},showSelector:function(e,t,i){var s={selectionType:i,multiselect:this.getMultiselect(),opener:this},o;if("object"!==typeof e)o={template:e,componentOptions:t};else o=e;if(this.hidePicker(),this._linkCollection&&this._linkCollection.hidePicker(),this._list&&this._list.getItems()&&this._getOption("autoShow"))this._list.getItems().clear();if(this._options.useSelectorAction)this._getSelectorAction().execute(wsCoreMerge(s,o));else this._showChooser(o.template,o.componentOptions,o.dialogOptions)},_showChooser:function(){if(this._options.useSelectorAction)this.showSelector.apply(this,arguments);else E.superclass._showChooser.apply(this,arguments)},_showSelector:function(e){var t;if(e)t=B(this._options.dictionaries,function(t){return t.name===e});else t=this._options.dictionaries[0];if(t)return this.showSelector(t),true},setActive:function(e,t,s,o){var l=this.isActive();if(E.superclass.setActive.call(this,e,t,s,o),e&&!l&&this._needFocusOnActivated()&&this.isEnabled()&&i.browser.isMobilePlatform)this._getElementToFocus().focus()},setMultiselect:function(e){E.superclass.setMultiselect.apply(this,arguments),this.getContainer().toggleClass(T.MULTISELECT,Boolean(e)),this._updateTextBoxVisibility()},setSelectedKeys:function(e){e=A.keysFix(e),E.superclass.setSelectedKeys.call(this,e)},setKeyField:function(e){s.resolve("ILogger").log("FieldLink","Метод setKeyField устарел, используйте setIdProperty"),this.setIdProperty(e)},setIdProperty:function(e){E.superclass.setIdProperty.call(this,e),this._linkCollection&&this._linkCollection.setIdProperty(e)},setDisplayField:function(e){s.resolve("ILogger").log("FieldLink","Метод setDisplayField устарел, используйте setDisplayProperty"),this.setDisplayProperty(e)},setDisplayProperty:function(e){E.superclass.setDisplayProperty.call(this,e),this._linkCollection&&this._linkCollection.setProperty("displayProperty",e)},setItemTpl:function(e){if(E.superclass.setItemTpl.call(this,e),!this._isEmptySelection()&&!this._linkCollection)this._createLinkCollection();this._linkCollection&&this._linkCollection.setItemTpl(e)},setItemContentTpl:function(e){E.superclass.setItemContentTpl.call(this,e),this._linkCollection&&this._linkCollection.setItemContentTpl(e)},_getAdditionalChooserConfig:function(){var e=this._isEmptySelection()?[]:this.getSelectedKeys();return{currentValue:e,currentSelectedKeys:e,selectorFieldLink:true,multiSelect:this._options.multiselect,selectedRecords:[]}},_modifyOptions:function(e,t,i){e.selectedKeys=A.keysFix(e.selectedKeys);var s=E.superclass._modifyOptions.apply(this,arguments),l=["controls-FieldLink"],n,r;if(n=s.selectedKeys.length,s.multiselect)l.push(T.MULTISELECT);if(n||null!==s.selectedKey)if(l.push(T.SELECTED),1===n||!n)l.push(T.SELECTED_SINGLE);if(s.selectedItem&&o.instanceOfModule(s.selectedItem,"WS.Data/Entity/Model"))r=new w({items:[s.selectedItem]});else if(s.selectedItems)r=s.selectedItems;if(r)s.preRenderItems=r;if(v(s,i),F(s),s.hideIfEmpty&&!s.enabled&&!s._isEmptySelection(s))l.push("ws-hidden");return s.cssClassName+=" "+l.join(" "),s},_toggleShowAllButtonState:function(e){this._showAllButton.toggleClass("controls-FieldLink__showAllLinks-disabled",!e).toggleClass("controls-FieldLink__showAllLinks-enabled",e)},_getInputMinWidth:function(){var e=this.getContainer().find(".controls-TextBox__wrapper"),t=this._getAfterFieldWrapper();return(e[0].offsetWidth-t[0].offsetWidth)/100*33},_onDrawItemsCollection:function(){var e=0,t=[],s=this.isEnabled(),o=this._isInputVisible()||this._options.alwaysShowTextBox,l,n,r,c,h,a,d,u;if(this._linkCollection&&!this._linkCollection.isPickerVisible())if(!this._isEmptySelection())if(n=this._linkCollection.getContainer().find(".controls-FieldLink__item"),h=n.length,u=o||this.getMultiselect()&&!this.isEnabled()&&h>1,u){if(r=(s?this._getAfterFieldWrapper().outerWidth():0)+2*parseInt(this._container.css("border-left-width")),this._options.multiselect||this._options.alwaysShowTextBox)this._toggleShowAllButton(true),d=this._showAllButton?this._showAllButton.outerWidth()+(i.browser.firefox?2:0):0,r+=parseInt(this.isEnabled()?this._getInputMinWidth()+(h>1?d:0):d);l=this._container[0].getBoundingClientRect().width-r;for(var _=h-1;_>=0;_--){if(a=n[_],c=Math.ceil(a.getBoundingClientRect().width),e+c>l){if(this._toggleShowAllButton(h>1),!e)$(a).outerWidth(l),t.push(a);break}t.unshift(a),e+=c}if(t.length<h){if(this.isEnabled())this._linkCollection._getItemsContainer().html(t);this._toggleShowAllButton(true)}else this._toggleShowAllButton(false)}},_onCrossClickItemsCollection:function(e,t){if(this.removeItemsSelection([t]),!this._options.multiselect&&this._options.alwaysShowTextBox)this.setText("");if(this.isActive())this._getElementToFocus().focus()},_onItemActivateItemsCollection:function(e,t){b.onItemClickNotify.call(this,t)},_getShowSelectorContainer:function(){return this._container.find(".controls-FieldLink__showSelector")[0]},_observableControlFocusHandler:function(e){if(!this._isInputVisible()||this._getShowSelectorContainer()===document.activeElement||e&&e.relatedTarget&&h.checkInclusion(this,e.relatedTarget)&&!r(this.getContainer(),e.relatedTarget))return false;E.superclass._observableControlFocusHandler.apply(this,arguments)},_isInputVisible:function(){return!(!this._isEmptySelection()&&!this._options.multiselect)&&this.isEnabled()},_getElementToFocus:function(){return this._isInputVisible()||this._options.alwaysShowTextBox?E.superclass._getElementToFocus.apply(this,arguments):this._container},_chooseCallback:function(e){if(e&&e.length){var t=o.instanceOfModule(e[0],"WS.Data/Entity/Model");if(this.setText(""),t)this.addSelectedItems(e);else this.addItemsSelection(e)}},getTextValue:function(){var e=[],t=this.getSelectedItems(),i=this;if(t)t.each(function(t){e.push(t.get(i._options.displayProperty)||"")});return c.htmlToText(e.join(", "))},_onResizeHandler:function(){if(E.superclass._onResizeHandler.apply(this,arguments),this._linkCollection&&!this._linkCollection.isPickerVisible()&&this._needRedrawOnResize())this._linkCollection.redraw()},_needRedrawOnResize:function(){var e=this._container[0].offsetWidth;if(this._lastFieldLinkWidth!==e)return this._lastFieldLinkWidth=e,true;return false},_showAllItems:function(){if(this.isPickerVisible())this.hidePicker();this._linkCollection&&this._linkCollection.togglePicker()},_dropAllItems:function(){this.removeItemsSelectionAll(),this._inputField.focus(),this._observableControlFocusHandler()},setDataSource:function(e,t){var i=this.getDataSource();if(this.once("onListReady",function(i,s){if(!s.getDataSource())s.setDataSource(e,t)}),E.superclass.setDataSource.apply(this,arguments),!this._isEmptySelection()&&!i)this._loadAndDrawItems()},_loadAndDrawItems:function(e){var t=this._linkCollection.getContainer();t.addClass(T.INVISIBLE),this.getSelectedItems(true,e).addCallback(function(e){if(!this.isVisibleWithParents())this._lastFieldLinkWidth=null;return t.removeClass(T.INVISIBLE),this._linkCollection.setItems(e),e}.bind(this))},_drawSelectedItems:function(e){var t=this._isEmptySelection()?0:e.length,i=t>0;if(!this._options.multiselect&&t)this._destroyCompatPlaceholder();else if(!this._compatPlaceholder)this._createCompatiblePlaceholder();if(!i)this._toggleShowAllButton(false);if(this._updateMultipleButtonsState(),this._options.hideIfEmpty)if(this._isEmptySelection()&&!this.isEnabled())this.getContainer().addClass("ws-hidden");else this.getContainer().removeClass("ws-hidden");if(this.getContainer().toggleClass(T.SELECTED,i).toggleClass(T.SELECTED_SINGLE,1===t),!this._options.alwaysShowTextBox&&!this.getMultiselect()&&i)$(".controls-InputRender__fieldWrapper",this.getContainer()).addClass("ws-invisible"),this.hidePicker();else $(".controls-InputRender__fieldWrapper",this.getContainer()).removeClass("ws-invisible");if(t){if(!this._linkCollection)this._createLinkCollection();this._loadAndDrawItems(t,this._options.pageSize)}else if(this._linkCollection)this._destroyLinkCollection()},_prepareItems:function(){return L(E.superclass._prepareItems.apply(this,arguments),this.getProperty("dataSource"),this.getProperty("idProperty"),this.getProperty("saveParentRecordChanges"))},setListFilter:function(e){if(!this._isInputVisible()&&this._options.alwaysShowTextBox)E.superclass.setListFilter.call(this,e,true);E.superclass.setListFilter.apply(this,arguments)},showPicker:function(){if(this._linkCollection&&this._linkCollection.isPickerVisible()||!this._isInputVisible())return;E.superclass.showPicker.apply(this,arguments),this._scrollListToBottom()},toggleShowSelectorButton:function(e){e?this._createShowSelectorButton():this._destroyShowSelectorButton()},_setEnabled:function(){if(this._lastFieldLinkWidth=null,this._showAllButton)this._toggleShowAllButtonState(this.isEnabled());if(this._getAfterFieldWrapper().toggleClass("ws-hidden",!this.isEnabled()),this._container.find(".controls-FieldLink__beforeFieldWrapper").toggleClass("controls-FieldLink__beforeFieldWrapper-enabled",this.isEnabled()).toggleClass("controls-FieldLink__beforeFieldWrapper-disabled",!this.isEnabled()),this._options.hideIfEmpty)if(this._isEmptySelection()&&!this.isEnabled())this.getContainer().addClass("ws-hidden");else this.getContainer().removeClass("ws-hidden");E.superclass._setEnabled.apply(this,arguments)},_setVisibility:function(){this._lastFieldLinkWidth=null,E.superclass._setVisibility.apply(this,arguments)},_setPickerConfig:function(){return{corner:"bl",closeOnTargetMove:!i.browser.isMobilePlatform,closeByExternalClick:true,targetPart:true,_canScroll:true,verticalAlign:{side:"top"},horizontalAlign:{side:"left"},handlers:{onShow:this._checkListItemRevert.bind(this)}}},_checkListItemRevert:function(){if(!this._options.reverseItemsOnListRevert)return;this._reverseList(this._isSuggestPickerRevertedVertical())},_isSuggestPickerRevertedVertical:function(){return this._picker.getContainer().hasClass("controls-popup-revert-vertical")},_scrollListToBottom:function(){if(this._picker&&this._isSuggestPickerRevertedVertical()){var e=this._picker.getContainer(),t=this.getList(),i;if(e[0].scrollTop=e[0].scrollHeight,o.instanceOfMixin(t,"SBIS3.CONTROLS/Mixins/Selectable"))if(i=t.getItems().getCount()-1,i!==t.getSelectedIndex())t.setSelectedIndex(i)}},_onListDrawItems:function(){E.superclass._onListDrawItems.apply(this,arguments),this._checkListItemRevert(),this._scrollListToBottom()},_keyUpBind:function(e){switch(E.superclass._keyUpBind.apply(this,arguments),e.which){case i.key.esc:if(this.isPickerVisible()||this._linkCollection&&this._linkCollection.isPickerVisible())this.hidePicker(),this._linkCollection.hidePicker(),e.stopPropagation()}},_keyDownBind:function(e){if(E.superclass._keyDownBind.apply(this,arguments),this.isEnabled())switch(e.which){case i.key.del:if(!this.getText())this.removeItemsSelectionAll();break;case i.key.backspace:if(!this.getText()&&!this._isEmptySelection()){var t=this.getSelectedKeys();this.removeItemsSelection([t[t.length-1]])}break;case i.key.tab:this._linkCollection&&this._linkCollection.hidePicker()}},_createShowSelectorButton:function(){if(!$(".controls-FieldLink__showSelector",this.getContainer()).length)$(".controls-FieldLink__afterFieldWrapper",this.getContainer()).append($(I(this._options)))},_destroyShowSelectorButton:function(){if($(".controls-FieldLink__showSelector",this.getContainer()).length)$(".controls-FieldLink__showSelector",this.getContainer()).remove()},_prepareShowAllButton:function(){if(!this._showAllButton)this._showAllButton=$('<div class="controls-FieldLink__showAllLinks">&#133;</div>'),this._container.find(".controls-FieldLink__beforeFieldWrapper").prepend(this._showAllButton);this._toggleShowAllButtonState(this.isEnabled())},_prepareDropAllButton:function(){if(!this._dropAllButton)if(this._dropAllButton=this._container.find(".controls-FieldLink__dropAllLinks"),!this._dropAllButton.length)this._dropAllButton=$('<div class="controls-FieldLink__dropAllLinks controls-FieldLink__button icon-size icon-CloseNew" title="Очистить все"></div>'),this._container.find(".controls-FieldLink__afterFieldWrapper").prepend(this._dropAllButton)},_destroyShowAllButton:function(){if(this._showAllButton)this._showAllButton.remove(),this._showAllButton=null},_destroyDropAllButton:function(){if(this._dropAllButton)this._dropAllButton.remove(),this._dropAllButton=null},_updateMultipleButtonsState:function(){if(A.selectedMultipleItems(this._options))this._prepareDropAllButton();else this._destroyDropAllButton()},_toggleShowAllButton:function(e){if(e)this._prepareShowAllButton();else this._destroyShowAllButton()},redraw:function(){},reload:function(){},_getAfterFieldWrapper:function(){if(!this._afterFieldWrapper)this._afterFieldWrapper=this.getContainer().find(".controls-FieldLink__afterFieldWrapper");return this._afterFieldWrapper},_createLinkCollection:function(){if(!$(".controls-FieldLink__beforeFieldWrapper",this.getContainer()).length)$(".controls-TextBox__fieldWrapper",this.getContainer()).before(g(this._options)),this.reviveComponents(),this._linkCollection=this.getChildControlByName("FieldLinkItemsCollection"),this._initLinkCollectionEvents();else this._linkCollection=this.getChildControlByName("FieldLinkItemsCollection"),this._initLinkCollectionEvents()},_destroyLinkCollection:function(){this._linkCollection.destroy(),this._linkCollection=void 0,$(".controls-FieldLink__beforeFieldWrapper",this.getContainer()).remove()},destroy:function(){if(this._linkCollection)this._destroyLinkCollection();this.getContainer().off("mousedown"),E.superclass.destroy.apply(this,arguments)}});return E});
//# sourceMappingURL=FieldLink.js.map
define("js!SBIS3.CONTROLS.FieldLink",["SBIS3.CONTROLS/FieldLink"],function(i){return i});
//# sourceMappingURL=FieldLink.module.js.map
define("tmpl!SBIS3.Contacts.WhomFieldInternal/Internal",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS.IconButton","js!SBIS3.CONTROLS.Link","js!SBIS3.CONTROLS.FieldLink"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={};n["js!SBIS3.CONTROLS.IconButton"]=e[1],n["js!SBIS3.CONTROLS.Link"]=e[2],n["js!SBIS3.CONTROLS.FieldLink"]=e[3];var o=function e(o,r,i,a,l){function s(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};l&&l.isSetts&&(p=l.fullContext||{});var m="string"==typeof i?i:"",h=void 0===n?void 0:n,u={id:[],def:void 0},S=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),C=this&&this.includedTemplates?this.includedTemplates:{},g=d.getMarkupGenerator(a);try{var y=g.joinElements([g.createTag("div",{class:"contacts-WhomFieldInternal "+d.wrapUndef(d.utils.escape("default"===d.getter(o,["addresseeChoiceOpenerStyle"])?"":"contacts-WhomFieldInternal__hideSelector"))},["iconPeople"===d.getter(o,["addresseeChoiceOpenerStyle"])?[g.createControl("wsControl","ws:SBIS3.CONTROLS.IconButton",{handlers:{onActivated:d.getTypeFunc("js!SBIS3.Contacts.WhomFieldInternal:prototype._onDoOpenFLDictionary",{})},name:"iconAddressee",icon:"sprite:icon-24 icon-Groups icon-primary",className:"contacts-WhomFieldInternal__iconWhom action-hover",tabindex:0,esc:!1},{name:"iconAddressee",sbisname:"iconAddressee"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},i,h,C,d.config,p)]:["link"===d.getter(o,["addresseeChoiceOpenerStyle"])?[g.createControl("wsControl","ws:SBIS3.CONTROLS.Link",{handlers:d.getTypeFunc("js!SBIS3.Contacts.WhomFieldInternal:prototype._onDoOpenFLDictionary",{}),name:"linkAddressee",className:"contacts-WhomFieldInternal__iconWhom mainLink__2 controls-Link__underline",caption:d.getter(o,["title"]),tabindex:0,esc:!1},{name:"linkAddressee",sbisname:"linkAddressee"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S},i,h,C,d.config,p)]:g.createText("")],g.createTag("div",{class:"contacts-WhomFieldInternal__divFieldLink "+d.wrapUndef(d.utils.escape("iconPeople"===d.getter(o,["addresseeChoiceOpenerStyle"])||"link"===d.getter(o,["addresseeChoiceOpenerStyle"])?"withoutAfterFieldWrapper":""))},[g.createControl("wsControl","ws:SBIS3.CONTROLS.FieldLink",{listFilter:{"Документ":d.getter(o,["docGUID"]),"Тема":d.getter(o,["themeGUID"])},list:{options:{footerTpl:d.createDataArray([(new function(){var e=Object.create(o),t=function e(t,n,o,r,i){if(void 0===o)var o=arguments[2];var a=0,l="footerTpl";if(void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure")),i&&i.isSetts)var s=i.fullContext||{};t=d.isolateScope(Object.create(this),t,l);var c="string"==typeof o?o:"",p={id:[],def:void 0},m=this&&this.includedTemplates?this.includedTemplates:{},u=d.getMarkupGenerator(r);try{var C=u.joinElements([u.createTag("div",{class:"contacts-WhomFieldInternal_showAll"},[u.createControl("wsControl","ws:SBIS3.CONTROLS.Link",{name:"showAllButton",caption:global.rk("Другие контакты")},{name:"showAllButton",sbisname:"showAllButton"},{data:t,ctx:this,pName:void 0!==l?l:void 0,viewController:S},o,h,m,d.config,s)],n,p,this)],c,p);p.def&&(C=u.chain(C,p,n),p=void 0)}catch(e){d.templateError("resources/Contacts.Base/WhomField/Internal.tmpl",e,t)}return C||""};this.func=d.makeFunctionSerializable(t,e)}).func]),itemsActions:[{onActivated:d.getTypeFunc("js!SBIS3.Contacts.WhomFieldInternal:prototype._onClickBtnLastThemes",{}),name:"btnLastThemes",icon:"sprite:icon-16 icon-ExpandList icon-primary",isMainAction:!0,tooltip:global.rk("Последние темы"),caption:global.rk("Последние темы")}],handlers:{onChangeHoveredItem:d.getTypeFunc("js!SBIS3.Contacts.WhomFieldInternal:prototype._onChangeHoveredItem",{})},name:"WhomFieldSuggest",pageSize:"12",allowEmptySelection:!1,showSelectedMarker:!0,itemContentTpl:d.getter(o,["itemTemplate"]),idProperty:d.getter(o,["idProperty"])},component:"js!SBIS3.CONTROLS.ListView"},dictionaries:[{caption:"hdbkWhomFieldInternal"}],handlers:{onChooserClick:d.getTypeFunc("js!SBIS3.Contacts.WhomFieldInternal:prototype._onDictionaryOpen",{}),onSelectedItemsChange:d.getTypeFunc("js!SBIS3.Contacts.WhomFieldInternal:prototype._onSelectedItemsChange",{})},tabindex:d.getter(o,["cDetection","isMobilePlatform"])?1:void 0,name:"ContactsFieldLink",className:"contacts-WhomFieldInternal__fieldLink controls-FieldLink__dynamicInputWidth",startCharacter:0,showSelector:"default"===d.getter(o,["addresseeChoiceOpenerStyle"]),placeholder:d.getter(o,["placeholder"]),autoShow:!0,multiselect:d.getter(o,["multiselect"]),itemContentTpl:d.getter(o,["displayLinkTemplate"]),idProperty:d.getter(o,["blObjectSettings","idProperty"]),bindings:[{fieldName:"textWhomFieldInternal",propName:"text",propPath:[],fullPropName:"text",propPathStr:"",oneWay:!0,direction:"fromContext",bindNonExistent:!1}],text:void 0,pickerClassName:"contacts-WhomFieldInternal__suggest",esc:!1},{name:"ContactsFieldLink",sbisname:"ContactsFieldLink"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S,internal:{__dirtyCheckingVars_0:d.getter(o,["docGUID"]),__dirtyCheckingVars_1:d.getter(o,["themeGUID"]),__dirtyCheckingVars_8:d.getter(o,["itemTemplate"]),__dirtyCheckingVars_9:d.getter(o,["idProperty"])}},i,h,C,d.config,p)],{},u,this)],r,u,this)],m,u);u.def&&(y=g.chain(y,u,r),u=void 0)}catch(e){d.templateError("resources/Contacts.Base/WhomField/Internal.tmpl",e,o)}return y||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.WhomFieldInternal/Internal"}},o});
//# sourceMappingURL=Internal.tmpl.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonItem",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,o,n,s){function m(){}var p=0,l=void 0!==t&&t?t:arguments[arguments.length-1];void 0===l&&(eval("var thelpers = null;"),l=global.requirejs("View/Runner/tclosure"));var c={};s&&s.isSetts&&(c=s.fullContext||{});var g="string"==typeof o?o:"",d=void 0===r?void 0:r,y={id:[],def:void 0},u=l.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),v=this&&this.includedTemplates?this.includedTemplates:{},P=l.getMarkupGenerator(n);try{var f=P.joinElements([P.createTag("div",{class:"contacts-PersonItem"},[P.createControl("resolver",l.getter(i,["item","_personPhoto"]),{size:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["PhotoSize"]),className:"contacts-PersonItem__photo",photoURL:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["PhotoLink"]),srcSetPhotoURL:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["SrcSetPhotoLink"]),activity:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["ActivityData",l.getter(i,["index"])]),miniCardAttributes:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["ContactCardAttributes"])},{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:u},o,d,v,l.config,c,y),P.createTag("div",{class:"contacts-PersonItem__description"},[P.createTag("div",{class:"contacts-PersonItem__title"},[P.createTag("div",{class:"contacts-PersonItem__name",title:""+l.wrapUndef(l.utils.escape(l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["PersonName"])))},[P.createText(" "+l.wrapUndef(l.Sanitize.apply(void 0,[l.getDecorators().sanitize.apply(void 0,[l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["PersonName"])])]))+" ")],{},y,this),l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["NeedEmployeeMark"])?[P.createControl("resolver",l.getter(i,["item","_employeeMarkIcon"]),{className:"contacts-PersonItem__employeeMark",markType:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["EmployeeMarkType"]),markTitle:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["EmployeeMarkTitle"])},{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:u},o,d,v,l.config,c,y)]:P.createText(""),l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["EmploymentPosition"])?[P.createTag("div",{class:"contacts-PersonItem__position",title:""+l.wrapUndef(l.utils.escape(l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["EmploymentPosition"])))},[l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["NeedEmployeeMark"])?P.createText(""):[P.createTag("span",{class:"contacts-PersonItem__position-separator"},[P.createText(""+global.rk("/"))],{},y,this)],P.createText(" "+l.wrapUndef(l.Sanitize.apply(void 0,[l.getDecorators().sanitize.apply(void 0,[l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["EmploymentPosition"])])]))+" ")],{},y,this)]:P.createText("")],{},y,this),P.createTag("div",{class:"contacts-PersonItem__content"},[P.createControl("resolver",l.getter(i,["item","_personEmployment"]),{employmentName:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["EmploymentName"]),isDepartment:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["IsDepartment"]),miniCardAttributes:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["EmploymentCardAttributes"]),needUnconfirmedIcon:l.getter(i,["item","get"]).apply(l.getter(i,["item"]),["NeedUnconfirmedIcon"]),className:"contacts-PersonItem__employment"},{},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:u},o,d,v,l.config,c,y)],{},y,this)],{},y,this)],a,y,this)],g,y);y.def&&(f=P.chain(f,y,a),y=void 0)}catch(e){l.templateError("resources/Contacts.Mini/Models/templates/PersonItem.tmpl",e,i)}return f||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonItem"}},i});
//# sourceMappingURL=PersonItem.tmpl.map
define("tmpl!SBIS3.Contacts.Models.ContactsModel/templates/EmployeeMarkIcon",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},a=function e(a,l,o,n,s){function i(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var p={};s&&s.isSetts&&(p=s.fullContext||{});var u="string"==typeof o?o:"",m=void 0===r?void 0:r,f={id:[],def:void 0},v=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),y=this&&this.includedTemplates?this.includedTemplates:{},g=d.getMarkupGenerator(n);try{var h=g.joinElements([g.createTag("span",{class:d.wrapUndef(d.utils.escape(d.getter(a,["className"])))+" icon-16 icon-disabled "+d.wrapUndef(d.utils.escape(d.getter(a,["markType"]))),title:""+d.wrapUndef(d.utils.escape(d.getter(a,["markTitle"])))},[],l,f,this)],u,f);f.def&&(h=g.chain(h,f,l),f=void 0)}catch(e){d.templateError("resources/Contacts.Base/Models/templates/EmployeeMarkIcon.tmpl",e,a)}return h||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.ContactsModel/templates/EmployeeMarkIcon"}},a});
//# sourceMappingURL=EmployeeMarkIcon.tmpl.map
define("js!SBIS3.Contacts.Models.BaseModel",["Core/core-extend","js!SBIS3.Contacts.Models.MiniBaseModel","js!SBIS3.Contacts.Models.ExtendedBaseMixin"],function(e,o,s){var t=o.extend({_moduleName:"SBIS3.Contacts.Models.BaseModel",$protected:{}});return e.mixin(t,[s])});
//# sourceMappingURL=Base.module.js.map
define("js!SBIS3.Contacts.Models.PersonBaseModel",["js!SBIS3.Contacts.Models.BaseModel","Transport/prepareGetRPCInvocationURL","js!SBIS3.Contacts.CoreMiniFunctions","Core/detection","Core/helpers/String/escapeTagsFromStr","css!Contacts.Mini/Models/styles/PersonMiniItem"],function(t,e,o,s,i){return t.extend({_moduleName:"SBIS3.Contacts.Models.PersonBaseModel",$protected:{_options:{properties:{PhotoLink:{get:function(){var t=this.has("Фото")&&this.get("Фото"),s=this.get("PhotoSize");return t?o.getCachedPhotoUrl(t,s):this.get("ФотоМини")?o.getCachedPhotoUrl(this.get("ФотоМини"),s):e("Персона","ФотоПерсоны",{"Персона":this.get("Персона"),"МинСторона":s})}},SrcSetPhotoLink:{get:function(){var t=this.has("Фото")&&this.get("Фото"),s=2*this.get("PhotoSize");return t?o.getCachedPhotoUrl(t,s):this.get("ФотоМини")?o.getCachedPhotoUrl(this.get("ФотоМини"),s):e("Персона","ФотоПерсоны",{"Персона":this.get("Персона"),"МинСторона":s})}},PersonName:{get:function(){return this.get("Фамилия")+" "+this.get("Имя")}},PersonTitle:{get:function(){return this.getTitleFromText(this.get("PersonName"))}},PhotoSize:{get:function(){return 24}}}}},getTitleFromText:function(t){var e="";if(!s.isMobilePlatform&&t)try{e=i(t,"\\w+")}catch(t){}return e}})});
//# sourceMappingURL=Base.module.js.map
define("js!SBIS3.Contacts.Models.PersonModel",["js!SBIS3.Contacts.Models.PersonBaseModel","js!SBIS3.Contacts.CoreMiniFunctions","css!SBIS3.Contacts.Models.MiniBaseModel/styles/PersonItem"],function(e,t){return e.extend({_moduleName:"SBIS3.Contacts.Models.PersonModel",$protected:{_options:{fieldName:{clientId:"Клиент",department:"Отдел",clientName:"КлиентНазвание"},properties:{EmploymentName:{get:function(){return this.get("IsDepartment")?this.get(this._options.fieldName.department)||"":this.get(this._options.fieldName.clientName)||""}},EmploymentPosition:{get:function(){return t.isCurrentClient(this.get(this._options.fieldName.clientId))?this.get("Должность"):""}},IsDepartment:{get:function(){return t.isCurrentClient(this.get(this._options.fieldName.clientId))}},PhotoSize:{get:function(){return 40}}}}}})});
//# sourceMappingURL=Main.module.js.map
define("js!SBIS3.Contacts.Models.SuggestModel",["js!SBIS3.Contacts.Models.PersonModel","js!SBIS3.Contacts.CoreMiniFunctions","tmpl!SBIS3.Contacts.Models.ContactsModel/templates/EmployeeMarkIcon"],function(e,t,i){var o={"ОЖ":2,"ОТ":0,"ДО":0,"У":0,"УД":0,"Г":0,"ОВ":0,"Б":1,"б":1,"Р":1,"ДР":3};return e.extend({_moduleName:"SBIS3.Contacts.Models.SuggestModel",$protected:{_employeeMarkIcon:i,_options:{fieldName:{confirmedOrg:"ОргПодтверждена",mark:"Метка",infoMark:"РасшифровкаМетки"},properties:{NeedUnconfirmedIcon:{get:function(){if(!this.get(this._options.fieldName.personGUID))return false;if(1===this.get(this._options.fieldName.clientID))return false;var e=t.isCurrentClient(this.get(this._options.fieldName.clientID)),i=this.get(this._options.fieldName.confirmedOrg);return!e&&false===i&&this.get(this._options.fieldName.clientName)}},NeedEmployeeMark:{get:function(){return this.get(this._options.fieldName.mark)}},EmployeeMarkType:{get:function(){var e=this.get(this._options.fieldName.mark);return{0:"icon-Vacation",1:"icon-Sick",2:"icon-Nipple",3:"icon-Birthday"}[e in o?o[e]:null]||""}},EmployeeMarkTitle:{get:function(){return this.get(this._options.fieldName.infoMark)}}}}}})});
//# sourceMappingURL=Suggest.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.ChangeReceivers",["Core/core-instance","Core/helpers/collection-helpers","Core/IoC","js!SBIS3.Contacts.Mixins.Services.Executor.Base","js!WS.Data/Collection/List","js!WS.Data/Collection/RecordSet","js!WS.Data/Chain","js!SBIS3.Contacts.CachingPersons"],function(e,t,r,s,i,n,c,o){function a(e){r.resolve("ILogger").log("Services.Executor.ChangeReceivers",e)}return s.mergeMixin(s,{$protected:{},after:{init:function(){if(this._changeReceivers={current:[],existingPersons:void 0,replaceIfDoubt:true,setReplaceIfDoubt:void 0,focusOutTime:0},this.setSelection&&this.addSelection&&this.removeSelectedKeys&&this.getSelectedKeys&&this.getChildFieldLink)this.register(["changeReceivers"]);else a("Component "+this.getName()+" does not support changing of receivers. Required functions: setSelection, addSelection, removeSelectedKeys, getSelectedKeys, getChildFieldLink.");this.subscribe("onFocusOut",function(e){this._changeReceivers.focusOutTime=Date.now()}.bind(this)),this.subscribeTo(this.getChildFieldLink(),"onSelectedItemsChange",function(e){if("boolean"===typeof this._changeReceivers.setReplaceIfDoubt)this._changeReceivers.replaceIfDoubt=this._changeReceivers.setReplaceIfDoubt,this._changeReceivers.setReplaceIfDoubt=void 0;else this._changeReceivers.replaceIfDoubt=false}.bind(this))}},seChangeReceivers:function(e){var t=this,r={result:null,executed:false},s=Date.now(),i=e.hasOwnProperty("receivers"),n=e.hasOwnProperty("add"),c=e.hasOwnProperty("remove"),o=e.hasOwnProperty("addOrReplace");if(!i&&!n&&!c&&!o||i&&!t._seCheckValidReceivers(e.receivers)||n&&!t._seCheckValidReceivers(e.add)||c&&!t._seCheckValidReceivers(e.remove)||o&&!t._seCheckValidReceivers(e.addOrReplace))a("Wrong params for changeReceivers: "+e);else if(r={result:true,executed:true},i)t._changeReceivers.setReplaceIfDoubt=true,r["result"]=t._seSetReceivers(e.receivers);else if(o){var l=s-t._changeReceivers.focusOutTime;if(t._changeReceivers.replaceIfDoubt&&l>200)r["result"]=t._seSetReceivers(e.addOrReplace);else r["result"]=t._seAddReceivers(e.addOrReplace);t._changeReceivers.setReplaceIfDoubt=false}else{if(c)t._seRemoveReceivers(e.remove);if(n)r["result"]=t._seAddReceivers(e.add);t._changeReceivers.setReplaceIfDoubt=false}return r},_seCheckValidReceivers:function(t){if(t instanceof Array)return true;else if(e.instanceOfModule(t,"WS.Data/Collection/List"))if(t.getCount()){var r=t.at(0);if(r.get&&r.get("Персона"))return true}else return true;return false},_seSetReceivers:function(t){var s=this;if(e.instanceOfModule(t,"WS.Data/Collection/RecordSet"))return s._seSetSelection(t),true;if(t=s.removeDuplicates(t),t&&e.instanceOfModule(t,"WS.Data/Collection/List"))return s._seSetSelection(t),true;else if(t instanceof Array)if(!t.length)return s._seSetSelection(new i({items:[]})),true;else if(t.length)return o.getPersonsFromCache(t).addCallbacks(function(e){if(e.length){var t=new n({idProperty:e[0].getIdProperty(),adapter:"adapter.sbis"});t.append(e),s._seSetSelection(t)}return e},function(e){return r.resolve("ILogger").error(e),e});return false},_seSetSelection:function(e){this.setSelection(e)},_seAddReceivers:function(t){var s=this;if(t&&e.instanceOfModule(t,"WS.Data/Collection/List"))return s.addSelection(t),true;else if(t instanceof Array&&t.length)return o.getPersonsFromCache(t).addCallbacks(function(e){var t=s.getSelectedItems(),r=t?new c(t).toArray():[],n=s.removeDuplicateRecords(r.concat(e));if(!t||t.getCount()!==n.length)return s._seSetSelection(new i({items:n}));return{result:false,executed:true}},function(e){return r.resolve("ILogger").error(e),e})},_seRemoveReceivers:function(t){var r=this;if(t)if(e.instanceOfModule(t,"WS.Data/Collection/List")){var s=[],i;t.each(function(e){if(i=e.get("Персона"),i)s.push(i)}),r.removeSelectedKeys(s)}else if(t instanceof Array&&t.length)r.removeSelectedKeys(t)},_seGetNotExistsPersons:function(e){var t=this._changeReceivers.existingPersons,r=["Фамилия","Имя","Клиент","КлиентНазвание","КлиентИдентификаторСПП","КлиентИНН","Должность","Отдел","ОргПодтверждена"],s=[],n=[],c=new i({items:[]});if(t)for(var o=0;o<e.length;o++){var a=e[o],l=t.getIndexByValue("Персона",a);if(-1==l)s.push(a);else{for(var u=t.at(l),f=true,h=0;h<r.length;h++)if(!u.has(r[o])){f=false;break}if(f)n.push(u);else s.push(u.get("Персона"))}}else s=s.concat(e);return c.prepend(n),{rsRightPersons:c,personsNeedMoreInfo:s}},removeDuplicates:function(e){var r={},s=[];return t.forEach(e,function(e,t){if(!r[e])r[e]=true,s.push(e)}),s},removeDuplicateRecords:function(e){var t=[],r={},s=e.length;if(s<=1)return e;for(var i=0;i<s;i++){var n=e[i],c;if(n.get("Раздел@")){t.push(n);continue}if(c=n.get("Персона"),!r[c])r[c]=true,t.push(n)}return t.length==s?e:t}})});
//# sourceMappingURL=ChangeReceivers.module.js.map
define("js!RecipientChoice/RecipientModel/RecipientModel",["WS.Data/Entity/Model","Core/UserInfo","Core/helpers/string-helpers","Core/helpers/transport-helpers"],function(e,t,i,r){"use strict";var n=e.extend({_moduleName:"RecipientChoice/RecipientModel/RecipientModel",_$idProperty:"ObjectUUID",_$properties:{ObjectUUID:{get:function(e){if(!e)return this.get("Персона")||this.get("Group")||this.get("ИдСервисаПрофилей")||this.get("@ПапкаКонтрагентов")||this.get("ГруппаКонтактов")||this.get("@СвязиПользователя")||this.has("ИдентификаторСПП")&&this.get("ИНН")||this.get("@Лицо");return e},set:function(e){this.set("Group",e)}},ObjectName:{get:function(e){var t;if(this.has("Название")&&(this.has("ГруппаКонтактов")||this.has("@ПапкаКонтрагентов")||this.has("@СвязиПользователя")||this.has("@Лицо")))return this.get("Название")||this.get("ObjectBreif")||rk("[Нет названия]");else if(this.has("Name"))return this.get("Name");else if(t=this.get("ObjectBreif"),t)return t;return e},set:function(e){this.set("Name",e)}},ObjectBreif:{get:function(e){var t=this.get("Имя"),r=this.get("Фамилия"),n="$surname$s$ $name$s$";if(t||r)return i.format({surname:r||"",name:t||""},n);return e}},PersonSurname:{get:function(e){return this.has("Фамилия")?this.get("Фамилия"):e}},PersonName:{get:function(e){return this.has("Имя")?this.get("Имя"):e}},PersonMiddlename:{get:function(e){return this.has("Отчество")?this.get("Отчество"):e}},GroupUUID:{get:function(){return this.get("Group")||!!this.get("SubdivisionUUID")}},SubdivisionUUID:{get:function(e){if(this.get("Раздел@"))if(this.has("Идентификатор"))return this.get("Идентификатор");return e}},GroupContacts:{get:function(e){if(this.get("Раздел@"))if(this.has("ГруппаКонтактов"))return this.get("ГруппаКонтактов");return e}},EmployeeSubdiv:{get:function(){return this.get("Персона")||this.get("ИдСервисаПрофилей")?this.get("ПодразделениеНазвание"):"(отсутствует доступ в систему)"}},EmployeeINN:{get:function(){return this.get("ИНН")||""}},EmployeePosition:{get:function(){return this.get("Должность")}},EmployeePhoto:{get:function(e){var t=this.get("PhotoData");if(t)return["/previewer/r/",t.size,"/",t.size,t.url].join("");else if(this.get("SubdivisionUUID"))return"/previewer/r/40/40/resources/Socnet/static_logo/default_company.v1516270649826335cf4508dd597be4bfc9caa3e08b901.png";return e}},SourceTypeCss:{get:function(){var e="socnet-Groups__sourceType-";switch(this.get("SourceType")){case 1:e+="project";break;default:e+="other"}return e}},GroupName:{get:function(){return this.get("Name")}},MiddlePhotoURL:{get:function(){return this._getPhotoUrl(40,40)}},HasProject:{get:function(){return 1===this.get("SourceType")||this.get("Project")}},ProjectTooltip:{get:function(){var e=this.get("GroupName"),t=rk("Перейти к проекту"),r="$toProject$s$ ' $name$s$ '",n=i.format({toProject:t,name:e},r);return this.get("EnableProjectLink")?n:""}},EnableProjectLink:{get:function(){return!this.get("SourceIsDeleted")&&"__сбис__физики"!==t.get("КлассПользователя")}},Photo:{get:function(){if(this.get("Персона"))return["/previewer/r/",40,"/",40].join("")+r.prepareGetRPCInvocationURL("СервисПрофилей","Фото",{"Персона":this.get("Персона"),"Тип":"mini"});else return["/previewer/r/",40,"/",40].join("")+r.prepareGetRPCInvocationURL("ЧастноеЛицо","ПолучитьФото_mini",{"ИдО":this.get("@Лицо")})}},TelephoneNumber:{get:function(){return this.get("Телефон")}},Department:{get:function(){return this.get("Отдел")}}},_getPhotoUrl:function(e,t){return"/previewer/r/"+e+"/"+t+this.get("PhotoURL")}});return n.toJSON=function(){return{$serialized$:"func",module:"js!RecipientChoice/RecipientModel/RecipientModel"}},n});
//# sourceMappingURL=RecipientModel.js.map
define("js!SBIS3.Contacts.AddresseeChoiceOpener",["Core/helpers/fast-control-helpers","Core/helpers/collection-helpers","Core/core-instance","Core/constants","Core/UserInfo","Core/Indicator","Core/ParallelDeferred","Core/Deferred","optional!js!RecipientChoice/RecipientModel/RecipientModel","js!SBIS3.Contacts.CommonFunctions.Global","js!WS.Data/Source/SbisService","js!WS.Data/Query/Query","js!WS.Data/Chain"],function(e,t,n,o,a,s,i,r,l,c,d,f,u){return{openDialog:function(t,n){var a=this,i=new r,l=n.visibleTabs,d=void 0===n.showWarningTooManySelected?true:n.showWarningTooManySelected,f;if(c.isInMySbis())l.companies=false,l.employees=false;else if(!!o.modules["Биллинг"])l.companies=false,l.employees=false,l.findContacts=false;if(!(l.findContacts^l.myContacts)||l.companies||l.employees||l.groups)require(["js!RecipientChoice/RecipientChoiceHelpers/RecipientChoiceHelpers"],function(e){e.openDialog(t,n).addCallback(function(e){a._onContragentsChoose(e,i,!!n.allowEmptyDepartment,d)})});else if(l.findContacts)s.setMessage(""),f=e.showFloatArea({template:"js!SBIS3.Contacts.SearchNewContact",name:"findContactArea",opener:t,showOnControlsReady:true,isStack:true,componentOptions:{name:"findContactControl",method:function(e,t){if(t)a._onContragentsChoose([t],i,void 0,d),i.addCallback(function(e){return a._closeOpenedPanel(f),e})}},handlers:{onBeforeShow:function(){s.hide()},onAfterClose:function(){this.destroy()}}});else if(l.myContacts)s.setMessage(""),f=e.showFloatArea({template:"js!SBIS3.Contacts.MyContactsTiles",name:"myContactsArea",opener:t,showOnControlsReady:true,isStack:true,componentOptions:{name:"myContactsControl",largeTiles:true,showHeader:true,useOperationsPanel:false,queryMethodName:"МоиКонтактыСписок",useSelectorWrapper:false,extraTopHeight:40,itemsDragNDrop:false,allowContactsActions:false,multiselect:n.multiselect,searchPlaceholder:rk("Поиск по контактам..."),searchForm:234},handlers:{onReady:function(){var e=this.getChildControlByName("myContactsControl");e.subscribeTo(e,"onItemSelect",function(e,t){if(t){var n=this.getLinkedContext().getValue("MyContactsFilter");a._addMyContactsFilter(t.getOwner()||t,n),t.set("MyContactsFilter",n||{}),e.setResult(false),a._onContragentsChoose([t],i,void 0,d),i.addCallback(function(e){return a._closeOpenedPanel(f),e})}}),e.subscribeTo(e,"onItemsSelect",function(e,t){if(t&&t.getCount()){var n=this.getLinkedContext().getValue("MyContactsFilter"),o=t.at(0);a._addMyContactsFilter(o.getOwner()||o,n),o.set("MyContactsFilter",n||{}),a._onContragentsChoose(new u(t).toArray(),i,void 0,d),i.addCallback(function(e){return a._closeOpenedPanel(f),e})}})},onBeforeShow:function(){s.hide()},onAfterClose:function(){this.destroy()}}});return i},_addMyContactsFilter:function(e){if(-1===e.getFormat().getFieldIndex("MyContactsFilter"))e.addField({name:"MyContactsFilter",type:"object"})},_closeOpenedPanel:function(e){if(n.instanceOfModule(e,"Core/Deferred"))e.addCallback(function(e){if(e&&e.close)e.close()})},_onContragentsChoose:function(e,n,o,a){s.setMessage("");var r=[],u=[],C=[],h=new i;if(e.forEach(function(e){if(e.get("SubdivisionUUID")){if(o||e.get("КолЧел")>0)r.push(e)}else if(e.get("ГруппаКонтактов"))u.push(e);else if(!e.has("Персона"))e.addField({name:"Персона",type:"uuid"}),e.set("Персона",e.get("ObjectUUID")),C.push(e);else C.push(e)}),r.length){if(r.length>1e3)r=r.slice(0,1e3);var p=r[0].has("EmployeeFilter")?r[0].get("EmployeeFilter")||{}:{};p["Разворот"]="С разворотом",p["ВидДерева"]="Только листья",p["ShowOtherEmployees"]=true,p["ВернутьИдСервисаПрофилей"]=true,p["СтрокаПоиска"]="",t.forEach(r,function(e){var t=e.get("ObjectUUID");p["Раздел"]=t;var n=(new f).where(p).offset(0).limit(1001);h.push(new d({endpoint:"Staff",binding:{query:"BrowserList"}}).query(n).addCallback(function(e){var n=e.getAll();if(-1===n.getFormat().getFieldIndex("Персона"))n.addField({name:"Персона",type:"uuid"});n.forEach(function(e){if(e.getId()!==t)if(!e.get("Раздел@"))e.set("Персона",e.get("ИдСервисаПрофилей")),C.push(new l({rawData:e.getRawData(),adapter:e.getAdapter()}))})}))})}if(u.length){if(u.length>1e3)u=u.slice(0,1e3);var g=u[0].has("MyContactsFilter")?u[0].get("MyContactsFilter")||{}:{};g["Разворот"]="С разворотом",t.forEach(u,function(e){g["Раздел"]=e.get("ИдО");var t=(new f).where(g);h.push(new d({endpoint:"Персона",binding:{query:"МоиКонтактыСписок"}}).query(t).addCallback(function(e){e.getAll().forEach(function(e){if(!e.get("Раздел@"))C.push(new l({rawData:e.getRawData(),adapter:e.getAdapter()}))})}))})}h.done().getResult().addCallback(function(){if(s.hide(),!n.isReady())if(!o&&!C.length)c.alert(rk("Нельзя выбирать пустые подразделения и группы.")).addCallback(function(){n.callback({contacts:[],subdivs:[]})});else{if(this._fixContactsDuplicates(C),C.length>1e3)if(C=C.slice(0,1e3),a)return void c.alert(rk("Выбрано слишком много контактов. Их количество будет сокращено до 1000")).addCallback(function(){n.callback({contacts:C,subdivs:r})});n.callback({contacts:C,subdivs:r})}}.bind(this))},_fixContactsDuplicates:function(e){for(var t=[],n=0;n<e.length;n++){var o=e[n].get("Персона");if(-1===t.indexOf(o))t.push(o);else e.splice(n--,1)}},_appendPersonsForContacts:function(e,n,o){var s=a.get("ИдентификаторКлиента"),i=[];return t.forEach(e,function(e){i.push([parseInt(o?e.get(o):s),parseInt(e.get(n))])}),new d({endpoint:"Персона"}).call("ПолучитьИдПерсон",{"Лица":{s:[{n:"Клиент",t:"Число целое"},{n:"Лицо",t:"Число целое"}],d:i}}).addCallback(function(o){var a=[],s=o.getAll();return t.forEach(e,function(e){var t=s.getIndexByValue("Лицо",e.get(n)),o=e.clone();if(t>-1){if(!o.has("Персона"))o.addField({name:"Персона",type:"uuid"});o.set("Персона",s.at(t).get("Персона")),a.push(o)}}),a})}}});
//# sourceMappingURL=AddresseeChoice.module.js.map
define("html!SBIS3.Contacts.WhomFieldInternal/templates/displayLink",function(){var e=function(e){var t=function(){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},t=/&(?!#?\w+;)|<|>|"|'|\//g;return function(n){return n?n.toString().replace(t,function(t){return e[t]||t}):n}}(),n=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(t){for(;e.test(t);)t=t.replace(e,"&#123;&#123;$1&#125;&#125;");return t}}(),r=function(e){return e.join?e.join(""):e.toString()},i=function(e){return void 0===e?"":e&&"object"==typeof e?r(e):""+e},o="undefined"!=typeof process,a=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,"");return a+=' <span class="contacts-WhomFieldBP_displayLink">'+n(i(t([e.item.get("Фамилия")||"",e.item.get("Имя")||""].join(" ").trim()||e.item.get("НазваниеКраткое")||e.item.get("Название")||rk("[Неизвестный пользователь]"))))+"</span>",(a=n(a))+(o&&-1!==a.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.WhomFieldInternal/templates/displayLink"}},e});
//# sourceMappingURL=displayLink.xhtml.map
define("js!SBIS3.Contacts.WhomFieldInternal",["Core/core-extend","Core/core-instance","Core/constants","Core/helpers/fast-control-helpers","Core/helpers/collection-helpers","Core/IoC","Core/UserInfo","Core/Indicator","Core/helpers/Function/throttle","Core/ParallelDeferred","Core/Deferred","js!SBIS3.CONTROLS.CompoundControl","tmpl!SBIS3.Contacts.WhomFieldInternal/Internal","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonItem","html!SBIS3.Contacts.WhomFieldInternal/templates/displayLink","js!SBIS3.Contacts.AddresseeChoiceOpener","js!SBIS3.Contacts.Models.SuggestModel","js!SBIS3.Contacts.CommonFunctions.Global","js!WS.Data/Source/SbisService","js!WS.Data/Collection/List","js!WS.Data/Collection/RecordSet","js!WS.Data/Entity/Record","js!SBIS3.Contacts.Mixins.Services.Executor.ChangeReceivers","js!SBIS3.Contacts.Mixins.Services.Consumer","js!SBIS3.Contacts.PersonActivityManager","js!SBIS3.Contacts.CachingPersons","js!WS.Data/Chain","Core/detection","css!SBIS3.Contacts.WhomFieldInternal/Internal","css!SBIS3.Contacts.Models.MiniBaseModel/styles/PersonItem","js!SBIS3.CONTROLS.FieldLink","js!SBIS3.CONTROLS.ListView","js!SBIS3.CONTROLS.IconButton","js!SBIS3.CONTROLS.Link","i18n!SBIS3.Contacts.WhomFieldInternal"],function(e,t,i,n,o,s,r,l,a,d,c,h,f,u,g,p,m,y,_,v,C,S,b,F,k,L,I,O){var A=h.extend({_dotTplFn:f,$protected:{_options:{itemTemplate:u,displayLinkTemplate:g,name:"WhomFieldInternal",docGUID:null,themeGUID:null,placeholder:rk("Введите ФИО..."),placeholderMore:void 0,labelPosition:"inline",title:"Кому:",isAddEmptyDepartment:false,showWhomIcon:false,showWhomLink:false,addresseeChoiceOpenerStyle:void 0,titleWidth:44,multiselect:true,showOptLastThemes:false,showSuggestFooter:true,onlyDialogMembers:false,onlyCurrentClient:false,findDisconnectedMembers:false,showPickerWhenEmpty:true,showWarningTooManySelected:true,visibleTabsInAdresseeChoice:{companies:true,employees:true,findContacts:true,groups:false,myContacts:true},addresseeChoiceSelectionType:"all",staffOptions:{display:{}},_cUserInfo:r,_cConstants:i,blObjectSettings:{endpoint:"Персона",query:"ПолучателиСписок",idProperty:"Персона",searchFieldName:"Запрос"},filterAdditionalOptions:void 0,needCheckMyCircle:false,cDetection:O},employers:null,employersOld:null,folders:[],foldersList:null,_selectionRemoveManually:false,_addresseesButtonEnabled:true,_personActivityManager:void 0,_filterAdditionalOptions:[],_initialAddresseeIcon:void 0},_modifyOptions:function(){var e=A.superclass._modifyOptions.apply(this,arguments);if(!e.addresseeChoiceOpenerStyle)if(e.showWhomIcon)e.addresseeChoiceOpenerStyle="iconPeople",s.resolve("ILogger").error("WhomField: option showWhomIcon is deprecated","Use addresseeChoiceOpenerStyle instead.");else if(e.showWhomLink)e.addresseeChoiceOpenerStyle="link",s.resolve("ILogger").error("WhomField: option showWhomLink is deprecated","Use addresseeChoiceOpenerStyle instead.");else e.addresseeChoiceOpenerStyle="none";if(void 0!==e.suggestOnlyForMembers)if(s.resolve("ILogger").error("WhomField: option suggestOnlyForMembers is deprecated! Use onlyDialogMembers instead."),void 0===e.onlyDialogMembers)e.onlyDialogMembers=e.suggestOnlyForMembers;if(e.visibleTabsInAdresseeChoice)if(e.visibleTabsInAdresseeChoice.employees&&!e.visibleTabsInAdresseeChoice.companies&&!e.visibleTabsInAdresseeChoice.findContacts&&!e.visibleTabsInAdresseeChoice.groups&&!e.visibleTabsInAdresseeChoice.myContacts)e.onlyCurrentClient=true;return e},$constructor:function(){this._publish("onClickLatestThemes","onChange","onError","onFocusNeedToBeMovedOut","onNeedFreeSpace","onTextChange","onOpenDictionary")},init:function(){A.superclass.init.call(this),this._initialAddresseeIcon=this._options.addresseeChoiceOpenerStyle,this._updateSearchFieldLinkThrottle=a(this._updateSearchFieldLink.bind(this),200),this.subscribeTo(this,"onInit",function(){var e=this,t=e._getFieldLink();if(e._source=new _({endpoint:e._options.blObjectSettings.endpoint,binding:{query:e._options.blObjectSettings.query},model:m,idProperty:e._options.blObjectSettings.idProperty}),e._filterAdditionalOptions=e._options.filterAdditionalOptions||[],e.subscribeOnceTo(e,"onBeforeShow",e._onBeforeShow),e.subscribeTo(e,"onChange",e._onChange),e.isVisible())t.setDataSource(e._source,true),e.subscribeTo(t.getDataSource(),"onBeforeProviderCall",function(t,i,n){switch(i){case e._options.blObjectSettings.query:if(!e._filterSetted)e._filterSetted=true,n["Фильтр"].set("СброситьКэш",true);else n["Фильтр"].set("СброситьКэш",false)}});if(e._resetFilterFieldLink(true),!y.isInMySbis()&&!i.modules["Биллинг"])require(["js!SBIS3.Employee.ListEmployees"]);e.subscribeTo(e.getLinkedContext(),"onFieldChange",function(t,i,n){if("textself"==i)e._toggleClassHideFooter(!!n)}),e.subscribeTo(e,"onDestroy",e._onDestroy),e.subscribeTo(t,"onPickerClose",function(e){var t=this.getLinkedContext().getValue("LatestThemesPanel");if(t&&t.isOpened())t.close()})})},setVisible:function(){A.superclass.setVisible.apply(this,arguments),this._notifyOnSizeChanged()},resetCacheForSuggest:function(){this._resetFilterFieldLink(false,true)},_onDestroy:function(){this.employers=null,this.employersOld=null,this.folders=null,this.foldersList=null,this._personActivityManager=null,this._filterAdditionalOptions=null,this._source.setModel(null),this._options.itemTemplate=u,this._options.displayLinkTemplate=g,this._options._cUserInfo=null,this._options._cConstants=null},_onBeforeShow:function(){var e=this,t=e._getFieldLink(),i=t.getList();e.employers=new v({items:[]}),e.employersOld=new v({items:[]}),e.foldersList=new v({items:[]}),e._personActivityManager=new k({view:t.getList(),personGUIDGetter:function(){return this.get("Персона")}}),e.subscribeTo(t,"onTextChange",e._onTextChange),e.subscribeTo(i,"onDataLoadError",function(e,t){this._notify("onError",t),y.onDataLoadError(e,t)}.bind(e)),e.subscribeTo(i,"onItemActivate",function(){if(0!=this._getFieldLink().getSelectedKeys().length)this._notify("onFocusNeedToBeMovedOut")}.bind(e)),e.subscribeTo(i,"onDataLoad",function(e,t){if(t){var i=this.getClassName();if(!t.getCount()){if(-1==i.indexOf("footerCentered"))i=i.concat(" footerCentered")}else i=i.replace("footerCentered"," ").trim();this.setClassName(i)}}),this._toggleClassHideFooter()},setActiveFieldLink:function(){var e=this._getFieldLink();if(e)e.setActive(true)},getChildFieldLink:function(){return this._getFieldLink()},getList:function(){return this._getFieldLink().getList()},setDocumentGUID:function(e){var t=this;if(t._isDestroyedWF())return;t._options.docGUID=e,t._resetFilterFieldLink(false)},setPlaceholder:function(e,t){if(e){var i=this._getFieldLink();if(this._options.placeholder=e,this._options.placeholderMore=t||e,i&&!i.isDestroyed()){var n=i.getSelectedItems();if(n&&n.getCount?n.getCount():0)i.setPlaceholder(this._options.placeholder);else i.setPlaceholder(this._options.placeholderMore)}}},setShowOptLastThemes:function(e){this._options.showOptLastThemes=!!e},setSelectorVisibility:function(e){var t=this._getBtnAddressees();if(t)t.setVisible(e),this.setSuggestFooterVisible(e);else this.setDefaultSelectorVisibility(e)},setDefaultSelectorVisibility:function(e){this.getChildFieldLink().toggleShowSelectorButton(e),this.getContainer().removeClass("contacts-WhomFieldInternal__hideSelector")},setAddresseesButtonEnabled:function(e){var t=this,i=this._getBtnAddressees();if(t._addresseesButtonEnabled=e,t._toggleClassHideFooter(),i)i.setEnabled(e);else t.getChildFieldLink().toggleShowSelectorButton(e)},setSuggestFooterVisible:function(e){this._options.showSuggestFooter=!!e,this._toggleClassHideFooter()},setOnlyDialogMembers:function(e){this._options.onlyDialogMembers=e,this._resetFilterFieldLink(false),this.setAddresseesButtonEnabled(!e)},setSuggestOnlyForMembers:function(e){s.resolve("ILogger").error("WhomFieldInternal:setSuggestOnlyForMembers is deprecated! Use setOnlyDialogMembers instead."),this.setOnlyDialogMembers(e)},setOnlyCurrentClient:function(e){this._options.onlyCurrentClient=e,this._resetFilterFieldLink(false)},hideSuggest:function(){var e=this._getFieldLink();if(e)e.hidePicker()},dropAllLink:function(){var e=this._getFieldLink();if(e){if(e.getSelectedKeys().length)this._selectionRemoveManually=true;e.removeItemsSelectionAll()}},isSuggestVisible:function(){var e=this._getFieldLink();if(e)return e.isPickerVisible();return false},markControl:function(e,t){var i=this._getFieldLink();if(i)i.markControl(e,t)},clearMark:function(){var e=this._getFieldLink();if(e)e.clearMark()},setSelection:function(e){var i=this._getFieldLink();if(!i||!t.instanceOfModule(e,"WS.Data/Collection/List"))return;if(!e||!e.length&&!e.getCount())this.dropAllLink();i._notify("onFocusNeedToBeMovedOut"),this._personActivityManager.appendClientsFields(e),i.setSelectedItems(this._replaceModel(e)||e)},addSelection:function(e){var i=this._getFieldLink();if(!i||!t.instanceOfModule(e,"WS.Data/Collection/List"))return;i.addSelectedItems(this._replaceModel(e)||e)},_replaceModel:function(e){if(e&&e.getModel&&t.instanceOfModule(e,"WS.Data/Collection/RecordSet"))if(e.getModel()===this._source.getModel())return e;else{var i=new C({idProperty:this._options.blObjectSettings.idProperty,adapter:"adapter.sbis",model:this._source.getModel()}),n=e.getFormat();if(-1===n.getFieldIndex("Название"))e.addField({name:"Название",type:"string"});if(-1===n.getFieldIndex("НазваниеКраткое"))e.addField({name:"НазваниеКраткое",type:"string"});for(var o=0;o<e.getCount();o++)i.add(e.at(o));return i}else return null},removeSelectedKeys:function(e){var t=this._getFieldLink();if(t)t.removeItemsSelection(e)},getSelectedKeys:function(){var e=this._getFieldLink();if(e)return e.getSelectedKeys()},getSelectedItems:function(){var e=this._getFieldLink();if(e)return e.getSelectedItems()},_isDestroyedWF:function(){var e=this;if(e&&e.isDestroyed)return e.isDestroyed();return true},_getFieldLink:function(){return this.hasChildControlByName("ContactsFieldLink")?this.getChildControlByName("ContactsFieldLink"):void 0},resetFilter:function(e){this._resetFilterFieldLink(false),this.hideSuggest()},setFilterAdditionalOptions:function(e,t){if(e&&e.length){var i=false;if(t)this._filterAdditionalOptions=e,i=true;else{this._filterAdditionalOptions=this._filterAdditionalOptions||[];var n={};this._filterAdditionalOptions.forEach(function(e,t){n[e.name]=t});for(var o=0;o<e.length;o++){var s=e[o];if(s.name&&void 0!==s.value){if(n.hasOwnProperty(s.name))this._filterAdditionalOptions.splice(n[s.name],1,s);else this._filterAdditionalOptions.push(s);i=true}}}if(i)this._resetFilterFieldLink()}},_resetFilterFieldLink:function(e,t){var i=this,n={"Документ":i._options.docGUID,"Тема":i._options.themeGUID,"СброситьКэш":false,Channel:i._options.docGUID,Inheritance:true},o=i._getFieldLink();if(t)i._filterSetted=false;var s=i._filterAdditionalOptions;if(s&&s.length)for(var r=0;r<s.length;r++){var l=s[r];n[l.name]=l.value}if(!o)return;n["ТолькоТекущийКлиент"]=this._options.onlyCurrentClient,n["ТолькоУчастникиТемы"]=this._options.onlyDialogMembers,n["НайтиОтключенныхУчастниковТемы"]=n["ТолькоУчастникиТемы"]&&this._options.findDisconnectedMembers,o.setListFilter(n,!!e)},_updateSearchFieldLink:function(e){if(this._options.blObjectSettings.searchFieldName){var t=this.getList(),i=t.getFilter();i[this._options.blObjectSettings.searchFieldName]=e,t.setFilter(i)}},_onSelectedItemsChange:function(e,i,n){var o=this,s=o.getParent(),r=o.getSelectedItems(),l;if(!n.added.length&&!n.removed.length)return;s._changeEmployers(n,r).addCallback(function(e){if(o.setAutoShow(true),s._options.isAddEmptyDepartment)T("notify on change receivers, empty department"),l=s._notify("onChange",s.employers,e.added,e.removed,r);else if((e.added&&e.added.length||e.removed&&e.removed.length)&&!(s.employersOld&&s.employersOld.isEqual(s.employers))&&!(n.removed.length&&s.employersOld&&s.employers&&s.employersOld.getCount()<s.employers.getCount())){var a=new I(s.employers);if(!s.employersOld)s.employersOld=new v({items:a.toArray()});else s.employersOld.clear(),s.employersOld.append(a.toArray());if(r.getCount()){var d=[];if(r.each(function(e){if(t.instanceOfModule(e,"WS.Data/Entity/Model")&&"string"===typeof e.get("Фото"))d.push(e)}),d.length)L.addPersonsToCache(d)}T("notify on change receivers"),l=s._notify("onChange",s.employers,e.added,e.removed,r);var h=s.employers.getCount();if(s._options.showPickerWhenEmpty&&!h&&!s._selectionRemoveManually)o.setActive(true);if(s._options.placeholderMore&&!o.isDestroyed())o.setPlaceholder(h?s._options.placeholderMore:s._options.placeholder);s._selectionRemoveManually=false}else T("no notify on change receivers, nothing has changed or something went wrong");if(true===l)if(i.length)s.dropAllLink();c.fromTimer(300).addCallback(function(){if(s.getContainer().find(".controls-FieldLink__showAllLinks").hasClass("ws-hidden")){if(!s.employers.getCount())s._notify("onNeedFreeSpace",false)}else s._notify("onNeedFreeSpace",true)})})},_onChange:function(e,t,i,n,o){if(this._options.needCheckMyCircle&&1===o.getCount()&&36===o.at(0).get("Персона").length){var s=this,r=o.at(0).get("Персона");y.checkNeedInviteContact(r).addBoth(function(e){if(!e.allowSend){var t=new c;if(null===e.invitationStatus)y.question(rk("Этот контакт не находится в вашем круге. Чтобы начать общение, необходимо отправить приглашение. Продолжить?")).addCallback(function(e){if(e)t.callback(true);else s.dropAllLink(),s.setActiveFieldLink(),t.callback(false)});else t.callback(true);t.addCallback(function(e){if(e)l.setMessage(""),require(["js!SBIS3.Contacts.InvitationPanel"],function(e){if(e&&e.open)e.open({invitePerson:r,inviteType:"invite_to_my_circle",opener:null,handlers:{onAfterShow:function(){s._closePanel()}}});l.hide()})})}})}},_onTextChange:function(e,t){var i=this.getParentByClass(A);i._notify("onTextChange",e,t),i._updateSearchFieldLinkThrottle(t)},_onDictionaryOpen:function(e){var i=this.getParent(),n=i._notify("onOpenDictionary");if(n&&t.instanceOfModule(n,"Core/Deferred"))e.setResult(n);else e.setResult(i._openContragentsChooser())},_onDoOpenFLDictionary:function(){this.getParent()._getFieldLink().showSelector()},_openContragentsChooser:function(){var e=this,t=y.isInMySbis()||!!i.modules["Биллинг"],n=e._options.onlyCurrentClient?{companies:false,employees:true,findContacts:false,groups:false,myContacts:false}:e._options.visibleTabsInAdresseeChoice;return e._notify("onFocusNeedToBeMovedOut"),p.openDialog(e,{defaultTab:t?"mycontacts":"employee",showWarningTooManySelected:e._options.showWarningTooManySelected,multiselect:e._options.multiselect,visibleTabs:n,selectionType:e._options.addresseeChoiceSelectionType,allowEmptyDepartment:e._options.isAddEmptyDepartment,staffOptions:e._options.staffOptions}).addCallback(function(t){return e._collectPersons(t.contacts,t.subdivs).addCallbacks(function(t){if(t.length>1)t=e.removeDuplicateRecords(t);return t},function(e){return s.resolve("ILogger").error(e),e})})},_onChangeHoveredItem:function(e,t){var i=this,n=t.hasOwnProperty("record")?t.record:null,o=this.getParentByClass("SBIS3.Contacts.WhomFieldInternal"),s,r;if(!n)return;if(r=i.getItemsActions().getItemsInstances(),s=!!n.get("ЕстьТемыВПереписке"),o._options.showOptLastThemes)r["btnLastThemes"].show();else return void r["btnLastThemes"].hide();if(r.hasOwnProperty("btnLastThemes"))r["btnLastThemes"].setTooltip(!s?rk("У вас пока нет ни одной беседы с этим контактом"):rk("Последние темы")),r["btnLastThemes"].setEnabled(s)},_onClickBtnLastThemes:function(e,t,i){var o=this,s=o.getParentByClass("SBIS3.Contacts.WhomFieldInternal"),r=t,l=["latestThemes_",r].join(""),a=s.getLinkedContext(),d=a?a.getValue("LatestThemesPanel"):null,c=function(e,t){var i=this.getParent(),n;if(!t)return;n={themeGUID:t.get("Тема"),messageGUID:t.get("Сообщение")},s.hideSuggest(),s._notify("onClickLatestThemes",n),i.close()};if(d)if(d.getId()===l&&d.isVisible())return;else d.destroy();n.showFloatArea({template:"js!SBIS3.Contacts.LatestThemes",name:"LatestThemesFloatArea",id:l,hoverTarget:s,parent:o,target:e,border:false,verticalAlign:"bottom",fitWindow:true,autoCloseOnHide:true,autoHeight:true,autoShow:true,showDelay:2e3,animation:"fade",animationLength:0,componentOptions:{parent:s,personID:r},catchFocus:false,handlers:{onAfterShow:function(){var e=this;if(e.getChildControlByName("LatestThemes").subscribe("onClickTheme",c),a)a.setValue("LatestThemesPanel",e)},onAfterClose:function(){var e=this,t=e.getChildControlByName("LatestThemes");if(t.unsubscribe("onClickTheme",c),t.destroy(),e.destroy(),a&&a.getValue("LatestThemesPanel"))a.removeValue("LatestThemesPanel")}}}).addCallback(function(e){e.subscribeOnceTo(s._getFieldLink(),"onClick",function(){if(e&&e.isOpened())e.close()})})},_addedEmployers:function(e,t,i){for(var n=this,o=[],s=[],r=[],l=e.added,a=e.removed,d=new I(i),c=new v({items:d.toArray()}),h=[],f=0;f<l.length;f++){var u=l[f];if(0==u.indexOf("000000")){var g=u.split("000000")[1];if(-1==$.inArray(g,o))o.push(u)}else{var p=t.getIndexByValue("Персона",u),m=t.at(p);if(!n._isExistEmployerInFolders(m)||-1!=$.inArray("000000"+n._getSection(m.get("Раздел")),a)){if(-1==$.inArray(u,s))s.push(u);if(-1==i.getIndexByValue("Персона",u))if(-1!=p)h.push(m)}else r.push(u)}}if(c.append(h),r.length)n._removeSelectedItem(r);return n._addedEmployersFromFolders(o,c,s)},_addedEmployersFromFolders:function(e,t,i){var n=this,o=new c;if(e.length)n._getHierarchyDep(e).addCallback(function(e){t.each(function(t){if(t){var o=n._getSection(t.get("Раздел"));if(-1!=$.inArray(o,e)){var s=t.get("Персона");if(-1==$.inArray(s,i))i.push(s)}}}),o.callback({employers:t,added:i})});else o.callback({employers:t});return o},_addedFolders:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i];if(-1==$.inArray(n,t.folders))t.folders.push(n)}},_addedFoldersList:function(e,t){var i=this,n=i.foldersList,o=[];if(!n)n=new v({items:[]});for(var s=0;s<e.length;s++){var r=e[s];if(-1==n.getIndexByValue("Персона",r.get("Персона"))&&-1==$.inArray(i._getSection(r.get("Раздел")),t))o.push(r)}n.prepend(o),i.foldersList=n},_changeEmployers:function(e,t){var i=this,n=i.employers,s=new c;if(!n)n=new v({items:[]});if(e instanceof Array){for(var r=[],l={},a=0;a<e.length;a++){var d=e[a].get("Персона");if(-1==n.getIndexByValue("Персона",d))r.push(d)}o.forEach(e,function(e,t){l[e.get("Персона")]=t}),L.getPersonsFromCache(r).addCallback(function(t){for(var o=0;o<t.length;o++){var r=t[o],a=e[l[r.get("Персона")]];t[o].set("Раздел",parseInt(a.get("Раздел")))}n.append(t),i.employers=n,s.callback()})}else i._changeSelectedItems(e,t,n).addCallback(function(e){i.employers=e.employers,s.callback({removed:e.removed,added:e.added})});return s},_changeSelectedItems:function(e,t,i){var n=this,o=new d,s=new c;if(t){var r=n._addedEmployers(e,t,i);if(e.removed&&e.removed.length)r.addCallback(function(i){var s=new I(i.employers),r=new v({items:s.toArray()});return o.push(n._removedPersons(e,t,r)),i});o.push(r)}else if(e.removed&&e.removed.length)o.push(n._removedPersons(e,t,i));return o.done().getResult().addCallback(function(t){var i=t[0].employers,n=[],o=[];for(var r in t)if(t.hasOwnProperty(r)){if(t[r].added)n=$.merge(n,t[r].added);if(t[r].removed)o=$.merge(o,t[r].removed)}s.callback({employers:i,added:n.length?n:e.added,removed:o.length?o:e.removed})}),s},_checkRealRemovedFolderByMainSection:function(e){for(var t=this,i=[],n=0;n<e.length;n++){var o=e[n],s=t.foldersList.getIndexByValue("Персона","000000"+o),r=t.foldersList.at(s),l=t._getSection(r.get("Раздел"));if(-1==$.inArray(l,t.folders))i.push(o)}return i},_checkSubEmployersBySection:function(){var e=this,t=e._getFieldLink().getSelectedItems(),i=[];if(t)t.each(function(t){var n=t.get("Персона");if(0!=n.indexOf("000000")){var o=e._getSection(t.get("Раздел"));if(-1!=$.inArray(o,e.folders))i.push(n)}});return i},_checkSubFoldersBySection:function(e){var t=this,i=[];return t.foldersList.each(function(n){var o=t._getSection(n.get("Раздел"));if(-1!=$.inArray(o,e))i.push(n.get("Персона"))}),i},_collectPersons:function(e,t){var i=this,n=t.length,s=new c;return i._changeEmployers(e).addCallback(function(){if(n)i._collectPersonsByFolders(t,e).addCallback(function(e){s.callback(e)});else{for(var r=[],l=0;l<e.length;l++){var a=e[l],d=i._getSection(a.get("Раздел")),c=o.find(r,function(e){if(e.get("Персона")===a.get("Персона"))return true});if(-1==Array.indexOf(i.folders,d)&&!c)r.push(a)}s.callback(r)}}),s},_collectPersonsByFolders:function(e,t){for(var i=this,n=new c,s=[],r=[],l=[],a=0;a<e.length;a++){var d=e[a].clone(),h=i._getSection(d.getId());if(-1===i.folders.indexOf(h)){if(!d.has("Персона"))d.addField({name:"Персона",type:"string"});if(d.set("Персона","000000"+h),s.push(d),l.push(d),-1===r.indexOf(h))r.push(h)}}if(i.foldersList&&i.foldersList.getCount())i.foldersList.forEach(function(e,t){var n=i._getSection(e.get("@СвязиПользователя"));if(-1===r.indexOf(n))r.push(n)});if(r.length)i._getHierarchyDep(r).addCallback(function(e){i._addedFolders(e),i._addedFoldersList(l,e);var r=i._checkSubFoldersBySection(e);i._removeSelectedItem(r);var a=i._checkSubEmployersBySection();if(a&&a.length)i._removeSelectedItem(a);var d=i._prepareEmployers(t,e),c=o.filter(s,function(e,t){return-1!=i.foldersList.getIndexByValue("Персона",e.get("Персона"))});c=c.concat(d),n.callback(c)});else n.callback(s);return n},_getBtnAddressees:function(){var e=void 0;switch(this._initialAddresseeIcon){case"iconPeople":e=this.getChildControlByName("iconAddressee");break;case"link":e=this.getChildControlByName("linkAddressee")}return e},_getHierarchyDep:function(e){var t=[],i,n=new c;if(e.length){for(i=0;i<e.length;i++){var o=parseInt(e[i],10);if(o)t.push(o)}var r=new S({adapter:"adapter.sbis"});if(r.addField({name:"WithWorkGroup",type:"boolean"},null,true),r.addField({name:"IgnoreClosed",type:"boolean"},null,false),t.length)new _({endpoint:"СтруктураПредприятия"}).call("HierarchyDepartment",{departments:t,route:"down",options:r}).addCallbacks(function(e){var t=[];e.getAll().each(function(e,i){var n=e.get("Id");if(-1==$.inArray(n,t))t.push(n+"")}),n.callback(t)},function(e){s.resolve("ILogger").error(e),n.callback([])});else n.callback([])}else n.callback([]);return n},_getSection:function(e){return e?(e+"").split(",")[0]:null},_isExistEmployerInFolders:function(e){var t=this,i=t._getSection(e.get("Раздел"));return-1!=$.inArray(i,t.folders)},_prepareEmployers:function(e,t){for(var i=this,n=[],o=0;o<e.length;o++){var s=e[o],r=i._getSection(s.get("Раздел"));if(-1==$.inArray(r,t))n.push(s)}return n},_removedFolders:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i],o=$.inArray(n,t.folders);if(-1!=o)t.folders.splice(o,1)}},_removedFoldersList:function(e){for(var t=this,i=t.foldersList,n=0;n<e.length;n++){var o=e[n],s=i.getIndexByValue("Персона","000000"+o);if(-1!=s)i.removeAt(s)}t.foldersList=i},_removedPersons:function(e,t,i){for(var n=this,o=[],s=[],r=new I(i),l=new v({items:r.toArray()}),a=e.removed,d=e.added,c,h=0;h<a.length;h++){var f=a[h];if(0==f.indexOf("000000")){var u=f.split("000000")[1];if(-1==$.inArray(u,o))o.push(u);a.splice(h--,1)}else{c=l.getIndexByValue("Персона",f);var g=l.at(c),p=g?n._getSection(g.get("Раздел")):null;if(-1!=c&&-1==$.inArray(p,n.folders)&&-1==$.inArray(f,d))if(l.removeAt(c),-1==$.inArray(f,s))s.push(f)}}return n._removedPersonsByFolders(o,i,l,e)},_removedPersonsByFolders:function(e,t,i,n){var o=this,s=new c,r=n.removed,l=n.added;if(e.length){var a=o._checkRealRemovedFolderByMainSection(e);if(o._removedFoldersList(e),a.length)o._getHierarchyDep(e).addCallback(function(e){o._removedFolders(e),t.each(function(t){if(t){var n=o._getSection(t.get("Раздел")),s=t.get("Персона");if(n&&-1!=$.inArray(n,e)&&-1==$.inArray(t.get("Персона"),l)){var a=i.getIndexByValue("Персона",s);if(-1!=a)if(i.removeAt(a),-1==$.inArray(s,r))r.push(s)}}}),s.callback({employers:i,removed:r})});else s.callback({employers:i})}else s.callback({employers:i});return s},_removeSelectedItem:function(e){var t=this._getFieldLink();if(e.length)t.removeItemsSelection(e)},_toggleClassHideFooter:function(e){var t=this,i=t._getFieldLink(),n=i.getList(),o=i.getPicker(),s=n.getClassName(),r=" contacts-WhomField__hideFooter";if(t._options.showSuggestFooter&&!e&&t._addresseesButtonEnabled)s=s.replace(r,"");else if(-1==s.indexOf(r))s=s.concat(r);if(n.setClassName(s),o)o.recalcPosition(true,true)},_closePanel:function(){this.consume("closePanel")}});function T(e){s.resolve("ILogger").log("ILogger|WhomFieldInternal",e)}return e.mixin(A,[b,F])});
//# sourceMappingURL=Internal.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.QuoteMessage",["Core/js-template-doT","Core/IoC","js!SBIS3.Contacts.Mixins.Services.Executor.Base","js!SBIS3.Contacts.QuoteHelpers"],function(e,t,s,o){"use strict";var i=e.template('<div class="contacts-Blockquote controls-RichEditor__noneditable">'+'<blockquote data-msg-id="{{=it.msgId}}" data-msg-date="{{=it.msgDate}}" '+'data-msg-sender="{{=it.msgSender}}" data-msg-theme="{{=it.msgThemeId}}">'+"{{=it.text}}"+"</blockquote>"+'<p class="citationOptions" data-msg-date="{{=it.msgDate}}">{{=it.sender}}</p>'+"</div>"+"<p>{$caret}</p>");return s.mergeMixin(s,{$protected:{},after:{init:function(){this.register(["quoteMsg"])}},seQuoteMsg:function(e){var s=this;if(e.text&&e.sender&&e.dateTime&&e.msgDate&&e.msgThemeId&&e.msgId&&e.msgSender){var n;if(o.isNotEmptyQuoteByText(e.text)||1===$(e.text).find("blockquote:first").length){var r={text:o.clearTextByHighLight(e.text),sender:e.sender+", "+e.dateTime,msgDate:e.msgDate,msgThemeId:e.msgThemeId,msgId:e.msgId,msgSender:e.msgSender};n=i(r)}else n=$(e.text+"<p>{$caret}</p>");return setTimeout(function(){s.setActive(true),s.insertHtml(s._checkTextMessageByQuote(n))},10),{result:true,executed:true}}return t.resolve("ILogger").log("Services.Executor.QuoteMessage","Bad request"),{result:null,executed:false}},_checkTextByNesting:function(e){for(var t=$(e),s=t.find(".contacts-Blockquote"),o=0;o<s.length;o++){var i=$(s[o]);if(!i.find(".contacts-Blockquote").length&&i.parents(".contacts-Blockquote").length>2)i.remove()}return $("<div></div>").append(t).html()},_checkTextMessageByQuote:function(e){e=this._checkTextByNesting(e);var t=$("<div>"+e+"</div>");return t.find(".contacts-Blockquote:first").find(".contacts-Blockquote.controls-RichEditor__noneditable").removeClass("controls-RichEditor__noneditable"),t.html()}})});
//# sourceMappingURL=Message.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.ChangeMessageText",["Core/IoC","js!SBIS3.Contacts.Mixins.Services.Executor.Base"],function(e,t){"use strict";return t.mergeMixin(t,{$protected:{},after:{init:function(){this.register(["setMsgText","insertMsgText"])}},seSetMsgText:function(t){var r=this;if(t.hasOwnProperty("text"))return r.setText(t.text),{result:true,executed:true};else return e.resolve("ILogger").log("Services.Executor.ChangeMessageText","text in params required"),{result:null,executed:false}},seInsertMsgText:function(t){var r=this;if(t.hasOwnProperty("text")){if(1==t.position)r.setCursorToTheEnd();return r.insertHtml(t.text),{result:true,executed:true}}else return e.resolve("ILogger").log("Services.Executor.ChangeMessageText","text in params required"),{result:null,executed:false}}})});
//# sourceMappingURL=ChangeMessageText.module.js.map
define("js!SBIS3.Contacts.SendRichEditor2",["js!SBIS3.CONTROLS.RichEditor","js!SBIS3.Contacts.Mixins.Services.Executor.ChangeMessageText","js!SBIS3.Contacts.Mixins.Services.Executor.QuoteMessage"],function(e,t,s){"use strict";var i=e.extend([t,s],{$protected:{},init:function(){i.superclass.init.call(this)}});return i});
//# sourceMappingURL=Editor.module.js.map
define("js!SBIS3.Contacts.ButtonMixin",["js!SBIS3.CONTROLS.CompoundControl"],function(){"use strict";return{nameBtn:"button",after:{init:function(){var t=this;t.subscribeTo(t,"onActivated",t._handlerActivatedButtonMixin.bind(t))}},before:{_handlerActivatedButtonMixin:function(t){var n=this,i=n.nameBtn,o=n.getParent();if("function"==typeof o._notifyOnButtonClick)if(false!=o._notifyOnButtonClick(i))n._handlerActivatedButton.apply(n,arguments||[])},_handlerActivatedButton:function(){}}}});
//# sourceMappingURL=Mixin.module.js.map
define("js!SBIS3.Contacts.SendMessageInternal.Buttons.NewBtn",["Core/core-extend","Core/helpers/random-helpers","js!SBIS3.CONTROLS.Button","js!SBIS3.Contacts.ButtonMixin"],function(t,e,n,s){"use strict";var i=n.extend({$protected:{},nameBtn:"New",init:function(){i.superclass.init.call(this)},_handlerActivatedButton:function(){var t=this.getParent(),n=t._getSendButton(),s=e.createGUID(),i=t._getDialogID();if(t._getDocumentGUID())t._options.documentDetails={};t._setDialogID(s).addCallback(function(){n._sendMessage()})}});return t.mixin(i,[s])});
//# sourceMappingURL=NewDialog.module.js.map
define("html!SBIS3.Contacts.SendMessageInternal.Buttons.MentionBtn/Mention",function(){var n=function(n){var o=function(){var n=/\{\{([\s\S]+?)\}\}/g;return function(o){for(;n.test(o);)o=o.replace(n,"&#123;&#123;$1&#125;&#125;");return o}}(),e=function(n){return n.join?n.join(""):n.toString()},t=function(n){return void 0===n?"":n&&"object"==typeof n?e(n):""+n},i="undefined"!=typeof process,r=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="mentionBtn__divForMention"> <component data-component="SBIS3.CONTROLS.IconButton" name="mentionMan" unselectable="on" class="mentionIcon"> <option name="icon">sprite:icon-16 icon-MegaphoneMan icon-primary</option> <option name="activableByClick">false</option> <option name="className">controls-IconButton__round-border mentionIcon unSelectable</option> <option name="tooltip">'+o(t(rk("Упомянуть человека/группу")))+'</option> <option name="enabled">false</option> </component> </div>');return(r=o(r))+(i&&-1!==r.indexOf("{{")?String.fromCharCode(8203,8203):"")};return n.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.SendMessageInternal.Buttons.MentionBtn/Mention"}},n});
//# sourceMappingURL=Mention.xhtml.map
define("js!SBIS3.Contacts.SendMessageInternal.Buttons.MentionBtn",["js!SBIS3.CONTROLS.CompoundControl","html!SBIS3.Contacts.SendMessageInternal.Buttons.MentionBtn/Mention","Core/IoC","js!SBIS3.CONTROLS.IconButton","i18n!SBIS3.Contacts.SendMessageInternal.Buttons.MentionBtn"],function(n,e,t){var o=n.extend({_dotTplFn:e,$protected:{_options:{rootName:null}},$constructor:function(){},init:function(){o.superclass.init.call(this)},setVisible:function(n){var e=this,s=e.getContainer();if(!s.find(".sendMessage__mentionManIcon").length&&n)s.append('<div class="sendMessage__mentionManIcon"></div>'),require(["js!SBIS3.Socnet.MentionMan"],function(t){s.find(".mentionIcon").remove(),new t({name:"mentionMan",parent:e,opener:e,element:s.find(".sendMessage__mentionManIcon"),className:"controls-IconButton controls-IconButton__round-border sn-Mention-Man_for-comments unSelectable",tooltip:rk("Упомянуть человека/группу"),editorName:"БогатыйРедакторСообщение",rootName:e._options.rootName,isButton:true}),o.superclass.setVisible.call(e,n)},function(n){t.resolve("ILogger").error(n)});else o.superclass.setVisible.call(e,n)}});return o});
//# sourceMappingURL=Mention.module.js.map
define("js!SBIS3.Contacts.SendMessageInternal.Buttons.DoSendBtn",["Core/core-extend","js!SBIS3.CONTROLS.Button","js!SBIS3.Contacts.ButtonMixin"],function(n,t,e){"use strict";var i=t.extend({nameBtn:"dosend",init:function(){i.superclass.init.call(this)},_handlerActivatedButton:function(){var n=this,t=n.getParent();if(t._options.doSendNewDialog)return t._handlerActivatedNewDialog.call(n,null);else return t._sendMessage()}});return n.mixin(i,[e])});
//# sourceMappingURL=DoSend.module.js.map
define("js!SBIS3.Contacts.SendMessageInternal.Buttons.ApproveBtn",["Core/core-extend","js!SBIS3.CONTROLS.Link","js!SBIS3.Contacts.ButtonMixin"],function(n,t,e){"use strict";var i=t.extend({$protected:{},nameBtn:"approve",$constructor:function(){},init:function(){i.superclass.init.call(this)}});return n.mixin(i,[e])});
//# sourceMappingURL=Approve.module.js.map
define("js!SBIS3.CONTROLS.NotificationPopup",["SBIS3.CONTROLS/NotificationPopup"],function(i){return i});
//# sourceMappingURL=NotificationPopup.module.js.map
define("js!SBIS3.Contacts.Popup",["Core/js-template-doT","js!SBIS3.CONTROLS.NotificationPopup","css!SBIS3.Contacts.Popup/Popup"],function(t,o){var e=t.template('<div class="contacts-Popup__footer">'+"{{=it.message}}"+"</div>"),s=o.extend({$protected:{_options:{footerTemplate:e}},$constructor:function(){},init:function(){s.superclass.init.call(this)}});return s});
//# sourceMappingURL=Popup.module.js.map
define("SBIS3.CONTROLS/Utils/NotificationStackManager",["Core/WindowManager","Core/EventBus","Lib/Control/Control"],function(t,i,e){"use strict";var n=5e3,s=e.Control.extend({$protected:{_items:[],_hiddenItems:[],_windowsIdWithLifeTime:[]},init:function(){s.superclass.init.call(this);var e=this;this._zIndex=t.getMaxZIndex()+1,$(window).on("resize",function(){e._updatePositions()}),this.subscribeTo(i.globalChannel(),"FloatAreaZIndexChanged",function(t,i){e._updateZIndex(i)}),this.subscribeTo(t,"zIndexChanged",function(t,i){e._updateZIndex(i)})},showNotification:function(t,i){if(i=!!i,-1===this._getItemIndexById(t.getId()))this._appendNotification(t,i)},_appendNotification:function(t,i){var e=this,s=t.getId();if(t.show(),t._fixed=true,t._checkFixed=function(){},t.getContainer().css({position:"fixed",top:"",left:"",bottom:"-1000px",right:"-1000px"}),this._items.unshift(t),this.subscribeTo(t,"onClose",function(){e._deleteNotification(s)}),this.subscribeTo(t,"onSizeChange",function(){e._updatePositions()}),!i)setTimeout(function(){e._deleteNotification(s),e._windowsIdWithLifeTime.splice(e._windowsIdWithLifeTime.indexOf(t.getId()),1)},n),this._windowsIdWithLifeTime.push(t.getId());this._updatePositions()},_updateZIndex:function(i){this._zIndex=Math.max(i,t.getMaxZIndex())+1,this._updatePositions()},_deleteNotification:function(t){var i=this._getItemIndexById(t);if(-1!==i)this._items[i].destroy(),this._items.splice(i,1),this._updatePositions()},_updatePositions:function(){for(var t,i,e=function(t,i){return+t.css(i).replace("px","")},n=0,s=this._items.length;n<s;n++){var o=this._items[n].getContainer(),d=o.css("margin"),a=this._zIndex;if(!n)o.css("margin",""),t=e(o,"margin-bottom"),i={bottom:e(o,"margin-bottom"),right:e(o,"margin-right")},o.css("margin",d);if(-1!==this._windowsIdWithLifeTime.indexOf(this._items[n].getId()))a=1e6;if(o.css({bottom:t,right:i.right,display:"block","z-index":a}),this._items[n]._zIndex=a,t+=o.outerHeight()+i.bottom,o.offset().top<=0)o.css("display","none")}},_getItemIndexById:function(t){for(var i=0,e=this._items.length;i<e;i++)if(this._items[i].getId()===t)return i;return-1}});return new s});
//# sourceMappingURL=NotificationStackManager.js.map
define("js!SBIS3.CONTROLS.Utils.NotificationStackManager",["SBIS3.CONTROLS/Utils/NotificationStackManager"],function(i){return i});
//# sourceMappingURL=Utils_NotificationStackManager.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.SignFiles",["Core/core-merge","Core/helpers/collection-helpers","Core/Context","Core/IoC","Core/ParallelDeferred","Core/Deferred","Core/helpers/string-helpers","js!SBIS3.Contacts.Mixins.Services.Executor.Base","is!browser?js!SBIS3.CONTROLS.Utils.NotificationStackManager","js!SBIS3.Contacts.Popup","js!WS.Data/Source/SbisService","js!WS.Data/Entity/Model","js!SBIS3.Contacts.CachingPersons","js!SBIS3.CONTROLS.Utils.InformationPopupManager","js!WS.Data/Chain"],function(e,r,s,a,n,i,t,o,l,c,f,g,u,m,d){"use strict";return o.mergeMixin(o,{$protected:{},_attachFilesFromSbisDiskBL:function(e){var r=new f({endpoint:"Персона"}),s=new i;return r.call("СПрикрепитьФайлИзСБиСДиска",e).addCallbacks(function(e){var r=e.getRow();s.callback(r.getRawData())},function(e){s.errback(e)}),s},seSignFiles:function(e){var t=new i,o=this;if(!e.messageParams||"object"!==typeof e.messageParams)return a.resolve("ILogger").error("Services.Executor.SignFiles","messageParams object in params required"),{result:true,executed:false};if(("for_first_sign"===e.messageParams.serviceType||"for_sign"===e.messageParams.serviceType)&&(e.messageParams.isFromMeToMe||e.messageParams.persons&&1===e.messageParams.persons.length&&Array.indexOf(e.messageParams.persons,s.global.getValue("mypersonid"))>-1))return o._alertErrorSign(new Error(rk("Нельзя отправлять файлы на подпись только самому себе"))),{result:null,executed:false};if("not_sign"===e.messageParams.serviceType)return{result:o.consume("sendMsg",e.messageParams)[0].result,executed:true};var l=e.messageParams.docGUID,c=e.messageParams.documentType,u=null,m=null,p=null,k=null,v=null,b=[],h=e.messageParams.serviceType,S=false;if(!e.files.length)if(2==c)S=true;else return{result:null,executed:false};if(e.messageParams.files_for_sign){var P=new n({maxRunningCount:2});r.forEach(e.messageParams.files_for_sign,function(r){if(e.messageParams.forExistingFile&&"just_sign"!==e.messageParams.serviceType)P.push(o._attachFilesFromSbisDiskBL(r));else{var s=new i;P.push(s),s.callback(r)}},o),P.done().getResult().addCallbacks(function(s){var n=[],i=[];r.forEach(s,function(e){var r="string"==typeof e?JSON.parse(e):e,s={"Файл":r["Файл"]||r["msgFileId"]||r["ИдФайла"],"ДискИдВерсии":r["ДискИдВерсии"]||r["redactionId"]||r["ИдВерсии"]};n.push(s),i.push(r["Файл"]||r["msgFileId"]||r["ИдФайла"])},o),_(function(r){if(e.messageParams.files=i,r)return o._alertErrorSign(r),t.errback(r),false;if(o.checkRequiredMethods()){if(-1!==Array.indexOf(["for_second_sign","sign","not_sign"],e.messageParams.serviceType))e.messageParams.files=[];if("just_sign"===e.messageParams.serviceType)new f({endpoint:"Персона"}).call("СПроверятьПодпись",{"Тема":e.messageParams.themeGUID,"Файлы":e.messageParams.files}).addCallbacks(function(){t.callback(true)},function(e){o._alertErrorSign(e),a.resolve("ILogger").error(e),t.errback(e)});else w(t)}else t.callback(false)})},function(){t.errback(rk("Файлы не подписаны"))})}else _(function(r){if(r)return o._alertErrorSign(r),t.errback(r),false;if(o.checkRequiredMethods())if("just_sign"===e.messageParams.serviceType)new f({endpoint:"Персона"}).call("СПроверятьПодпись",{"Тема":e.messageParams.themeGUID,"Файлы":e.messageParams.files}).addCallbacks(function(){t.callback(true)},function(e){o._alertErrorSign(e),a.resolve("ILogger").error(e),t.errback(e)});else w(t);else t.callback(false)});return{result:t,executed:true};function _(r){if(S){var s=new g({adapter:"adapter.sbis",format:[{name:"ReadVersions",type:"integer"}]});s.set({ReadVersions:1});var a={Id:l,ExtraParams:s.getRawData()};new f({endpoint:"FileSD"}).call("ReadByObject",a).addCallbacks(function(e){var s=e.getRow();m=s.get("Id"),k=s.get("Name"),v=s.get("Size");for(var a=s.get("Version"),n=null,i=0;i<a.getCount();i++){var t=a.at(i),o=t.get("CreationDate");if(null===n||o>n)n=o,p=t.get("Id")}b=[p],C(r)},function(e){r(e)})}else{for(var n=0;n<e.files.length;n++)b.push(e.files[n]["ДискИдВерсии"]?e.files[n]["ДискИдВерсии"]:e.files[n]["ИдВерсии"]);C(r)}}function C(e){if("for_first_sign"!==h&&"not_sign"!==h)require(["js!SBIS3.DOCVIEW.Funcs"],function(r){r.signDocuments(b,{opener:o,objectName:"FileSD",serviceUrl:"/disk/api/v1/"}).addCallbacks(function(r){if(r&&"error"in r&&null!==r.error&&""!==r.error)return void e(r.error);E(e)},function(r){e(r)})});else E(e)}function E(r){if(S){var s={"Документ":l,"Тема":l};new f({endpoint:"Персона"}).call("СПрикрепитьДокумент",s).addCallbacks(function(s){var a=s.getRow().getRawData();e.messageParams.files=[JSON.parse(a).fileID],r(null)},function(e){r(e)})}else{var a=[];if("for_second_sign"!=h&&"sign"!=h&&"not_sign"!=h)for(var n=0;n<e.files.length;n++)a.push(e.files[n]["Файл"]);e.messageParams.files=a,r(null)}}function I(e){var r=e.themeGUID,s=e.files;if(r&&s&&s.length)new f({endpoint:"Сообщение"}).call("УдалитьФайлы",{"Тема":r,"Файлы":s})}function w(r){o.consume("sendMsg",e.messageParams)[0].result.addCallbacks(function(s){if("for_second_sign"!==e.messageParams.serviceType){var a=s&&s.at(0);o._infoExcludePersons(a.get("УжеПодписали"),new d(a).toObject())}r.callback(s)},function(s){if(s&&"object"===typeof s&&32===s.error_code)o._infoExcludePersons(null,{"КоличествоПолучателей":0,"Файлы":e.files});else o._alertErrorSign(s);a.resolve("ILogger").error(s),r.errback(s)})}},_infoExcludePersons:function(e,r){if(!r["КоличествоПолучателей"]){var a=this.getInformationForSubscribe&&this.getInformationForSubscribe().persons.length,n=r["Файлы"];m.showMessageDialog({message:t.format({file:n&&(n.getCount&&n.getCount()>1||n.length>1)>1?rk("файлы"):rk("файл"),user:1===a?rk("этим пользователем"):rk("этими пользователями")},rk("Этот $file$s$ уже подписан $user$s$. Запрос на подпись не будет отправлен."))},null)}else if(e&&e.length){var i=e.indexOf(s.global.getValue("mypersonid"));if(i>=0){if(1===e.length)return;e.splice(i,1)}u.getPersonsFromCache(e).addCallback(function(e){var r=[];e.forEach(function(e){r.push([e.get("Фамилия"),e.get("Имя")].join(" "))}),m.showMessageDialog({message:t.format({persons:r.join(", ")},1===r.length?rk("Пользователь $persons$s$ уже подписал данные файлы"):rk("Пользователи: $persons$s$, уже подписали данные файлы"))},null)})}},_alertErrorSign:function(r){var s=function(s){var n=new c(e({element:$("<div></div>")},{status:"error",caption:rk("Ошибка подписи"),message:s}));l.showNotification(n),a.resolve("ILogger").log("Ошибка при подписании документов",r)};switch(r.toString()){case"Error: 1":s(rk("Нет действительных сертификатов, доступных данному пользователю"));break;case"Error: 2":break;case"Error: 3":s(rk("Указаны неверные параметры, обратитесь в службу технической поддержки"));break;case"Error: 4":s(rk("Криптоапплет не может быть запущен, обратитесь в службу технической поддержки"));break;case"Error: 5":s(rk("Криптоапплет не установлен, обратитесь в службу технической поддержки"));break;case"Error: 99":s(rk("Обратитесь в службу технической поддержки"));break;default:var n="";if(!(r.httpError&&403==r.httpError)){if(r.message)n+=r.message;else if(r.details)n+=r.details;s(n+="<br/>"+rk("Обратитесь в службу технической поддержки"))}}},before:{init:function(){this.setRequiredMethods(["consume"]),this.register(["signFiles"])}}})});
//# sourceMappingURL=SignFiles.module.js.map
define("js!SBIS3.Contacts.SendMessageInternal.PopupSendingMessage",["Core/js-template-doT","Core/helpers/string-helpers","js!SBIS3.CONTROLS.NotificationPopup","js!SBIS3.Contacts.MessagesExchangeEvents","js!SBIS3.Contacts.CoreMiniFunctions","is!browser?js!SBIS3.CONTROLS.Utils.InformationPopupManager","css!SBIS3.Contacts.SendMessageInternal.PopupSendingMessage/Popup"],function(e,n,s,t,o,i){"use strict";var a=e.template('<div class="contacts-PopupSendingMessage__footer">'+'<div class="contacts-PopupSendingMessage__delivered">{{= it.messageDelivered}}</div>'+'<div class="contacts-PopupSendingMessage__percent">{{= it.percent}}</div>'+"</div>"),r=s.extend({$protected:{_options:{footerTemplate:a,icon:"icon-24 icon-primary contacts-PopupSendingMessage__header_icon-customIcon",dialogId:null,messageId:null,paramsSend:{},receiversRS:null,receiversCount:0,localNotify:{}},_containers:{}},$constructor:function(){},init:function(){r.superclass.init.call(this);var e=this;e.subscribeTo(t,"onSendReady",e._handlerOnSendReady.bind(e)),e._containers={delivered:e.getContainer().find(".contacts-PopupSendingMessage__delivered"),percent:e.getContainer().find(".contacts-PopupSendingMessage__percent")}},_handlerOnSendReady:function(e,s){var o=this;if(s.theme!=o._options.dialogId||s.msg!==o._options.messageId)return;switch(s.status){case"sending":var a=s.counter_all,r=s.counter_send;if(!a||!r)return;$(o._containers.delivered).text(n.format({all:a,send:r},rk("Доставлено $send$s$ из $all$s$"))),$(o._containers.percent).text(Math.floor(r/a*100)+"%");break;case"fullSend":o.getContainer().addClass("ws-hidden");var c=o._options.localNotify;if(c)t.doAndNotify(c.event,c.notifyObject);o._successSendMessage(),o.close();break;case"error":o.getContainer().addClass("ws-hidden"),i.showConfirmDialog({message:rk("Сообщение не отправлено. Повторить отправку?"),status:"error"},function(){require(["js!SBIS3.Contacts.Mixins.Services.Executor.SendMessage"],function(e){e.seSendMsg(o._options.paramsSend),o.close()},function(){o.close()})},function(){o.close()})}},_successSendMessage:function(){var e=this,n=e._options.receiversRS.at(0);if(n)var s=o.getFIOFromRec(n),t=e._options.receiversCount-1,i=[s,t>=1?[" (+",t,")"].join(""):""].join("");else i=rk("Сообщение отправлено");o.showPopupNotification({caption:i,tag:"sendMessageSuccess"})}});return r});
//# sourceMappingURL=Popup.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.SendMessage",["Core/core-merge","js!WS.Data/Source/SbisService","js!WS.Data/Entity/Record","js!WS.Data/Format/UuidField","js!WS.Data/Format/StringField","js!WS.Data/Format/BooleanField","js!WS.Data/Format/IntegerField","js!WS.Data/Format/ArrayField","Core/helpers/string-helpers","Core/Indicator","Core/Context","Core/IoC","Core/Deferred","js!SBIS3.Contacts.Mixins.Services.Executor.Base","js!SBIS3.Contacts.MessagesExchangeEvents","js!SBIS3.Contacts.CoreMiniFunctions","is!browser?js!SBIS3.CONTROLS.Utils.NotificationStackManager","js!SBIS3.Contacts.SendMessageInternal.PopupSendingMessage","js!WS.Data/Format/ObjectField","i18n!SBIS3.Contacts.Mixins.Services.Executor.SendMessage","is!browser?js!SBIS3.Contacts.CoreMiniFunctions/string.format"],function(e,s,t,r,n,i,o,a,l,c,d,g,u,f,h,_,p,v,m){"use strict";return f.mergeMixin(f,{$protected:{_options:{popupTextWithoutReceivers:rk("Сообщение отправлено"),popupTextWithReceivers:null,sendMessageService:{endpoint:"Персона",callMethod:"СОтправить"}},_constLimitSendFiles:50},after:{init:function(){this.register(["sendMsg","sendServiceMsg"])}},seSendMsg:function(e){var s=this,t,r,n;return e=s._checkByParams(e,true),t=s._isService(e.serviceType),n=e.isChat&&e.addMemberToChat,r=t||n?true:e.files&&e.files.length||e.msgText,s._sendMsg(r,e)},seSendServiceMsg:function(e){var s=this,t;return e=s._checkByParams(e,true),t=e.serviceObj&&e.serviceObj.serviceMessage&&e.persons&&e.persons.length&&e.serviceType,e["isService"]=true,s._sendMsg(t,e)},_callSend:function(e,s,t){for(var r=this,n=[],i=e.length,o,a=0;a<i;a++)n.push(e[a].Персона);o=s.isService?r._prepareParamsService(n,s):r._prepareParams(n,s),t.needShowIndicator=true,setTimeout(function(){if(r.isDestroyed())return;var e=n.length;if(t.needShowIndicator&&e){var s="{0} {1} {2}".format(rk("Отправка сообщения","send_message"),e,1==e?rk("получателю","send_message"):l.wordCaseByNumber(e,rk("получателям","send_message"),rk("получателю","send_message_many"),rk("получателям","send_message")));c.setMessage(s)}},3e3),r._sendMethodBL(o,t,s)},_checkByParams:function(e,s){var t=this,r=e.serviceType,n=r&&-1!==["dialog_invite"].indexOf(r),i=r&&-1!==Array.indexOf(["not_sign","for_second_sign","sign","for_first_sign","for_sign"],r),o=n?false:i?!e.msgText:!(e.msgText||e.files&&e.files.length);if((s?o:!e.persons||!e.serviceObj||!e.serviceType)&&t.getInformationForSubscribe){var a=t.getInformationForSubscribe();for(var l in a)if(a.hasOwnProperty(l)&&!e.hasOwnProperty(l))e[l]=a[l]}return e},_getLocalNotify:function(e,s){var t=this;if(e&&e.getCount()>0){var r=e.at(0),n="union_with_last_message"===r.get("Статус"),i=d.global.getValue("myfaceinfo"),o=d.global.getValue("mypersonid"),a=r.get("local_event_data"),l;if(n)l={changes_for:[{is_chat:!!s.isChat,text:r.get("Текст"),theme:r.get("Диалог"),msg:r.get("Сообщение")}],localInfo:{"Текст":r.get("Текст")},state:"edited",user:d.global.getValue("mypersonid")};else{for(var c=[],g=[],u=r.get("Получатели"),f=0;f<u.getCount();f++){var p=u.at(f);c.push(p.get("Персона")),g.push([p.get("Фамилия"),p.get("Имя"),p.get("Отчество")])}if(l={text:r.get("Текст"),is_cut_text:false,theme:r.get("Диалог"),msg:r.get("Сообщение"),outgoing:s.isChat?true:-1===s.persons.indexOf(o),sender:{person:d.global.getValue("mypersonid"),partsOfName:i?[i["Фамилия"],i["Имя"],i["Отчество"]]:null,activity:{online:true},department:i?i["Отдел"]:null,post:i?i["Должность"]:null,companyName:i?i["КлиентНазвание"]:null,photo_id:_.getPhotoIdCurrentPerson()},type:a["type"],receivers_count:s.persons.length,receivers:c,receivers_names:g,folders_ido:s.folderId?[s.folderId]:null,files_total_count:r.get("Файлы")?r.get("Файлы").getCount():0,files:null,is_chat:a["is_chat"],is_dialog:0!==s.persons.length,datetime:r.get("ДатаВремя"),document:t._getDocumentGUID&&t._getDocumentGUID()?{id:t._getDocumentGUID(),type:t._getDocumentType()}:void 0,type_chat:a["type_chat"],chat_is_public:a["chat_is_public"],chat_root_reestr:a["chat_root_reestr"],chat_dif:a["chat_dif"],dialog_dif:a["dialog_dif"],invite:a["invite"],is_private:a["is_private"],reestr:a["reestr"],old_msg:a["old_msg"],reply:s.messageGUID},a["read_messages"].length>0)h.doAndNotify("onChangeThemes",{changed_themes:[{id:r.get("Диалог"),msg:a["read_messages"][0],chat:a["is_chat"],type_chat:a["type_chat"],is_private:a["is_private"]}],state:"read",reestr:a["reestr"],folders:a["folders"],chat_root_reestr:a["chat_root_reestr"],user:d.global.getValue("mypersonid")})}return{event:n?"onChangeMessage":"onNewMessage",notifyObject:l}}return false},_isService:function(e){return e&&-1!==Array.indexOf(["not_sign","for_second_sign","sign","dialog_invite","for_first_sign","for_sign"],e)},_notifyEvent:function(e,s){var t=this._getLocalNotify(e,s);if(t)h.doAndNotify(t.event,t.notifyObject)},_sendSuccessMessage:function(e,s,t){var r=this;if(r._options&&true==r._options.showPopupOnSendMsg&&!t){var n=e.at(0),i=r._options.popupTextWithoutReceivers,o=r._options.popupTextWithReceivers,a="";if(n){var c=s-1,d=[_.getFIOFromRec(n),c>=1?[" (+",c,")"].join(""):""].join("");a="string"===typeof o?l.format({receivers:d},rk(o)):d}else a=rk(i);if(a)_.showPopupNotification({caption:a,tag:"sendMessageSuccess"})}},_notifyAfterSend:function(e,s){if(e){if("function"==typeof this._notify)this._notify("onAfterSend",e.get("Диалог"),e.get("Сообщение"),e.get("Получатели"),e.get("Файлы"),e.get("ДатаВремя"),e.get("Текст"));this._sendSuccessMessage(e.get("Получатели"),e.get("КоличествоПолучателей"),s)}},_prepareParams:function(e,s){var l={"Получатели":e,"Текст":void 0!==s.msgText&&null!==s.msgText?s.msgText:null,"Диалог":s.themeGUID?s.themeGUID:null,"Документ":s.docGUID?s.docGUID:null,"Сообщение":s.messageGUID?s.messageGUID:null,"Файлы":s.files?s.files:[]},c=new t({adapter:"adapter.sbis"}),d=function(e,s,t,r){c.addField(new e({name:s,kind:r})),c.set(s,t)};if(s.hasOwnProperty("folderId")&&s.folderId&&"null"!=s.folderId)d(o,"Папка",s.folderId);if(s.hasOwnProperty("serviceType")&&s.serviceType&&"null"!=s.serviceType)d(n,"ТипСообщения",s.serviceType);if(s.hasOwnProperty("massMessage")&&void 0!=s.massMessage)d(i,"МассовоеСообщение",s.massMessage);if(s.hasOwnProperty("joinPrevMessage")&&void 0!=s.joinPrevMessage)d(i,"СлитьСПредыдущим",s.joinPrevMessage);if(s.hasOwnProperty("allReceiversTheme")&&void 0!=s.allReceiversTheme)d(i,"ВсемУчастникамТемы",s.allReceiversTheme);if(s.hasOwnProperty("addMemberToChat")&&void 0!=s.addMemberToChat)d(i,"ДобавитьВУчастникиЧата",s.addMemberToChat);if(s.hasOwnProperty("isFastAnswer")&&s.isFastAnswer){if(d(i,"БыстрыйОтвет",s.isFastAnswer),s.hasOwnProperty("docType")&&void 0!=s.docType)d(o,"ТипДокумента",s.docType);if(s.hasOwnProperty("docGUID")&&void 0!=s.docGUID)d(r,"Документ",s.docGUID)}if(s.hasOwnProperty("excludePersons")&&s.excludePersons&&s.excludePersons.length)d(a,"ИсключитьПолучателей",s.excludePersons,"uuid");if(s.hasOwnProperty("filesRedaction")&&s.filesRedaction&&s.filesRedaction.length)d(m,"РедакцииФайлов",s.filesRedaction);return l["Опции"]=c,l},_prepareParamsService:function(e,s){var r={"Получатели":e,"Диалог":s.themeGUID?s.themeGUID:null,"Документ":s.docGUID?s.docGUID:null,"Сообщение":s.messageGUID?s.messageGUID:null,"Файлы":s.files?s.files:[],"СлужебныйОбъект":s.serviceObj,"СлужебныйТип":s.serviceType,"ИсключитьПолучателей":s.excludePersons,isService:true},n=new t({adapter:"adapter.sbis"});if(s.hasOwnProperty("excludePersons")&&s.excludePersons&&s.excludePersons.length)n.addField(new a({name:"ИсключитьПолучателей",kind:"uuid"})),n.set("ИсключитьПолучателей",s.excludePersons);return r["Опции"]=n,r},_sendMessageErrorOut:function(e,s){var t=e?e.details?e.details:e.message:"",r=g.resolve("ILogger");if(0==t.indexOf("<log>"))r.log("Для информации",t.substring(5));else r.error("Произошла ошибка при отправке сообщения",t);if(30==e.error_code&&s.length)this._visibleQuestionInvite(s);else _.defaultErrorForSend(e,true)},_sendMethodBL:function(e,t,r){var n=this,i=new s({endpoint:this._options.sendMessageService.endpoint}),o=e.isService?"СОтправитьСлужебное":this._options.sendMessageService.callMethod;if(e.isService)e.isService=void 0;i.call(o,e).addCallbacks(function(e){n._successSendMethod(e.getAll(),t,r)},function(e){if(c.hide(),t.needShowIndicator=false,e&&"object"===typeof e&&32!==e.error_code&&!_.msgNotWork(e))n._sendMessageErrorOut(e,r.persons);return t.finalDef.errback(e),e})},_sendMsg:function(e,s){var t=this,r={finalDef:new u};if(e){var n=300;if(s.persons.length>n){if(s.isChat)_.alert(l.format({num:n},rk("Вы не можете отправить адресное сообщение более чем $num$s$ пользователям. Используйте безадресную отправку")));else _.alert(l.format({num:n},rk("Вы не можете отправить сообщение более чем $num$s$ пользователям. Для общения с таким количеством пользователей создайте чат или новость")));return{result:null,executed:false}}else if(s.files&&s.files.length>t._constLimitSendFiles)return _.alert(l.format({num:t._constLimitSendFiles},rk("Невозможно прикрепить к сообщению больше $num$s$ файлов."))),{result:null,executed:false};else{for(var i=[],o=0;o<s.persons.length;o++)i.push({"Персона":s.persons[o]});t._callSend(i,s,r)}}else return g.resolve("ILogger").log("Services.Executor.SendMessage","Bad request"),{result:null,executed:false};return r.finalDef.addCallback(function(e){if(!r.isSending)t._notifyEvent(e,s);return e}),{result:r.finalDef,executed:true}},_successSendMethod:function(s,t,r){var n=this,i=s&&s.getCount()?s.at(0):null,o=i&&i.has("Статус")?i.get("Статус"):null,a="sending"==o;if("message_length_over_limit"==o)c.hide(),t.needShowIndicator=false,_.defaultErrorForSend(rk("Длина введенного текста больше максимально допустимой длины."),true,true),t.finalDef.errback(s);else{if(i&&a){var d=i.get("КоличествоПолучателей"),g=new v(e({element:$("<div></div>")},{status:"default",caption:rk("Отправка сообщения"),messageDelivered:l.format({all:d,send:"0"},rk("Доставлено $send$s$ из $all$s$")),percent:"0%",dialogId:i.get("Диалог"),messageId:i.get("Сообщение"),paramsSend:r,receiversRS:i.get("Получатели"),receiversCount:d,localNotify:n._getLocalNotify(s,r)}));p.showNotification(g,true)}c.hide(),t.needShowIndicator=false,t.isSending=a,t.finalDef.callback(s),n._notifyAfterSend(i,a)}},_visibleQuestionInvite:function(e){var s=this;_.question(rk("Этот контакт не находится в вашем круге. Чтобы начать общение, необходимо отправить приглашение. Продолжить?")).addCallback(function(t){if(t)c.setMessage(""),require(["js!SBIS3.Contacts.InvitationPanel"],function(t){if(t&&t.open)t.open({invitePerson:e[0],inviteType:"invite_to_my_circle",opener:null,handlers:{onAfterShow:function(){s.consume("closePanel")}}});c.hide()}.bind(this));else s.consume("closePanel")})}})});
//# sourceMappingURL=SendMessage.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.SendButtonEnable",["Core/IoC","js!SBIS3.Contacts.Mixins.Services.Executor.Base"],function(e,t){"use strict";return t.mergeMixin(t,{$protected:{_options:{}},after:{init:function(){this.register(["sendButtonEnable"]),this.setRequiredMethods(["_toggleActionButtonsEnabled"])}},seSendButtonEnable:function(t){var n={executed:true,result:true},r={executed:false,result:null};if(!this.checkRequiredMethods())return e.resolve("ILogger").log("Services.Executor.SendButtonEnable","Объект не имеет требуемых методов"),r;var o=this,s;if(t&&t.hasOwnProperty("enabled"))if(s=o.getChildControlByName("DoSend"),s)return this._toggleActionButtonsEnabled(t.enabled),n;return e.resolve("ILogger").log("Services.Executor.SendButtonEnable","Bad request"),r}})});
//# sourceMappingURL=SendButtonEnable.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.ReplyMessage",["Core/IoC","js!SBIS3.Contacts.Mixins.Services.Executor.Base"],function(e,t){"use strict";return t.mergeMixin(t,{$protected:{_options:{lastName:"",lastReceiverUuid:null,lastReplyMsgUuid:null}},after:{init:function(){this.register(["replyMsg","correctReplyingMsg","cancelReplyMsg"]),this.setRequiredMethods(["_getRichEditor","_getSelectorButton","_getWhomField"])}},seReplyMsg:function(t){var s={executed:true,result:true},i={executed:false,result:null};if(!this.checkRequiredMethods())return i;var r=this,n,o;if(t&&t.receiverUuid&&t.name&&t.replyMsgUuid){var l=t.name.substr(t.name.indexOf(" ")+1);if(o=r._getEditor(),o&&o._options.enabled){var u=o.getText().trim(),a=l+",";if(0==u.length)o.setText(a+"  ");else if(null==r._options.lastName)if(-1==u.indexOf("<p>"))o.setText(a+" "+u);else o.setText(u.replace("<p>","<p>"+a+" "));else{var c=u.indexOf(r._options.lastName+",");if(-1!=c)o.setText(u.substr(0,c)+a+" "+u.substr(r._options.lastName.length+c+1).trim())}if(o.setActive(true),o.setCursorToTheEnd(),r.consume("changeReceivers",{receivers:[t.receiverUuid]}),r._options.messageID=t.replyMsgUuid,!r._options.visibleWhomField)if(n=r._getSelectorButton(),n)n.show(),r.getLinkedContext().setValue({recipientName:t.name,recipientId:t.receiverUuid});return r._options.lastName=l,r._options.lastReceiverUuid=t.receiverUuid,r._options.lastReplyMsgUuid=t.replyMsgUuid,s}}return e.resolve("ILogger").log("Services.Executor.ReplyMessage","Bad request"),i},seCorrectReplyingMsg:function(e){var t=this;if(e&&t._options.lastReceiverUuid)if(!e.length||-1==e.indexOf(t._options.lastReceiverUuid))t.consume("cancelReplyMsg");else if(e.length>1)if(t._options.lastName){var s=t._getEditor();s.setText(s.getText().replace(t._options.lastName+",","").trim()),s.setCursorToTheEnd(),s.setActive(true)}return{executed:true,result:true}},seCancelReplyMsg:function(){var t=this,s={executed:true,result:true},i={executed:false,result:null};if(!this.checkRequiredMethods())return i;if(t._options.lastName&&t._options.lastReceiverUuid){t.consume("changeReceivers",{remove:[t._options.lastReceiverUuid]});var r=t._getEditor();if(r&&r._options.enabled)r.setText(r.getText().replace(t._options.lastName+",","").trim()),r.setCursorToTheEnd(),r.setActive(true);return t._options.messageID=null,t.getLinkedContext().setValue({recipientName:null,recipientId:null}),t._options.lastName=null,t._options.lastReceiverUuid=null,t._options.lastReplyMsgUuid=null,s}return e.resolve("ILogger").log("Services.Executor.ReplyMessage","Bad request"),i}})});
//# sourceMappingURL=ReplyMessage.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.ChangeContextQuery",["Core/IoC","js!SBIS3.Contacts.Mixins.Services.Executor.Base"],function(e,t){"use strict";return t.mergeMixin(t,{$protected:{},seChangeContextQuery:function(t){if("object"!==typeof t||!t.context)return e.resolve("ILogger").log("Services.Executor.ChangeContextQuery","context in params required"),{result:null,executed:false};return{result:true,executed:true}}})});
//# sourceMappingURL=Base.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.ChangeContextQuery.Send",["Core/IoC","Core/Deferred","js!SBIS3.Contacts.Mixins.Services.Executor.ChangeContextQuery"],function(e,t,r){"use strict";return r.mergeMixin(r,{$protected:{},after:{init:function(){this.register(["changeContextQuery"])}},seChangeContextQuery:function(t){var r=this;if("object"!==typeof t||!t.context)return e.resolve("ILogger").log("Services.Executor.ChangeContextQuery","context in params required"),{result:null,executed:false};switch(t.context){case"close":return r._changeContextQuery()}return{result:true,executed:true}},_askQuestion:function(e){var t=this;t._functionsCommon.askQuestion(rk("Отправить сообщение?"),rk('Чтобы продолжить редактирование, нажмите "Отмена".')).addCallback(function(r){switch(r){case true:if(t._getAddresseesArr().length||t._options.isChat)t._getSendButton()._handlerActivatedButton().addCallbacks(function(t){e.callback({result:!!t,isSend:true})},function(t){e.callback(false)});else{var n=t._getWhomField(),s=rk("Для отправки сообщения выберите получателя");if(n.isVisible())n.markControl(s),n.setActiveFieldLink(true),e.callback(false);else e.errback(s)}break;case false:t.clear().addBoth(function(){e.callback({result:true,isSend:false})});break;default:e.callback(false)}})},_changeContextQuery:function(){var e=this,r=e._functionsCommon,n=e._getSaveNotSendText(),s=e.isContentSendMessage(),i=n&&e.isContentJustText(),u=new t;if(s)if(i){var a=e._getEditor(),c=e._getReceivers();if(c.length){var o={receivers:c,text:a.getText()};r.setCorrespondenceFilterValue("ОбъектПоследнегоНеотправленногоСообщения",JSON.stringify(o)),a.setText("")}return{result:true,executed:true}}else e._askQuestion(u);else return e._clearNotSendMessage(),{result:true,executed:true};return{result:u,executed:true}}})});
//# sourceMappingURL=Send.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.SendMessageBase",["Core/constants","Core/Deferred","js!SBIS3.Contacts.CoreMiniFunctions","js!WS.Data/Collection/RecordSet","js!WS.Data/Adapter/Json","js!WS.Data/Entity/Model","Core/core-instance","js!WS.Data/Source/SbisService","Core/IoC","Core/detection"],function(e,t,n,i,o,s,a,r,l,c){"use strict";return{$protected:{_options:{dialogID:null,joinPrevMessage:true,attachFileService:{endpoint:"Персона",callMethod:"СПрикрепитьФайл"},deleteFileService:{endpoint:"Сообщение",callMethod:"УдалитьФайлы"}},_newFilesArr:[],_ctxLinkList:"ФайлыDocView"},before:{init:function(){var e=this;e._subscribeOnBeforeUnload.apply(e),e.subscribeTo(e,"onDestroy",e._handlerDestroy.bind(e)),e.subscribeTo(e,"onInit",function(){var t=e._getEditor();e.subscribeTo(t,"onFocusIn",e._handlerOnFocusInBTR.bind(e))})}},clear:function(){var e=this;return e._getEditor().setText(""),this.clearFiles(),e._togglePanelDetailsMainButtons(),t.success()},clearFiles:function(){var e=this._getFilesDocView();if(e&&e.getCount())if(this.getContainer().find("#attachmentsWrapper").css("display","none"),e)e.clear();this._newFilesArr=[]},getText:function(){return this._getEditor().getText().trim()},isActionOnGo:function(){return this.getContext().getValue("actionOnGo")},isContentSendMessage:function(){return!!this.getText()},moveFocusToBtnAttach:function(){var e=this._getAttachmentButton();if(e)e.setActive(true)},moveFocusToBtnSend:function(){var e=this._getSendButton();if(e)e.setActive(true)},moveFocusToEditor:function(){this._setTabIndexToEditor();var e=this._getEditor();if(e){if(e.setActive(true),c.isMobilePlatform&&e._options.focusOnActivatedOnMobiles)e._options.focusOnActivatedOnMobiles=false;return e.isEnabled()&&e.isActive()}else return false},setDialog:function(e){return this._setDialogID(e)},setJoinPrevMessage:function(e){this._options.joinPrevMessage=e},setGoActionFlag:function(e){this.getContext().setValue("actionOnGo",e)},_addDocView:function(e,n,i){return new t},_beforeUnloadHandler:function(){var e=this;if(e.isContentSendMessage())return rk("Вы покидаете редактируемое сообщение, все несохраненные данные будут потеряны");else e._handlerDestroy()},_cleanAfterSend:function(){this.clear()},_collectFileParams:function(e){for(var t=this,i=[],o,s,a=0;a<e.length;a++){o=e[a].fileSize,s=e[a].fileID;var r=e[a].details,l=e[a].message,c=e[a].isEmpty,d=rk("Ошибка при загрузке файла.")+"\n";if(!s&&(r||l)){if(c)d+=e[a].fileName?e[a].fileName+"<br/>":"";var u=r?[rk("Подробности:")," ",c?rk("Файл пуст. Нельзя загружать файлы нулевого размера")+"<br/>"+rk("Попробуйте повторить загрузку"):r?r:l].join(""):[rk("Подробности:")," ",rk("Невозможно прикрепить файл, так как превышен максимальный допустимый размер файла - 100 Mb")].join("");n.alert(d+u);continue}if(-1===t._newFilesArr.indexOf(s))t._newFilesArr.push(s);if("string"===typeof e[a].createDate)e[a].createDate=Date.fromSQL(e[a].createDate);if("string"===typeof e[a].lastChange)e[a].lastChange=Date.fromSQL(e[a].lastChange);if("string"===typeof e[a].ModifyDate)e[a].ModifyDate=Date.fromSQL(e[a].ModifyDate);i.push(e[a])}return i},_deleteAttachedFiles:function(e){var n=this,i=new r({endpoint:this._options.deleteFileService.endpoint}),o={"Тема":n._getDialogID(),"Файлы":e};if(!e||!e.length)return t.success();return i.call(this._options.deleteFileService.callMethod,o).addCallbacks(function(e){},function(e){l.resolve("ILogger").error("Удаление файла завершилось с ошибкой",e)})},_getAttachmentButton:function(){return this.hasChildControlByName("SendMessageInternalAttachTo")?this.getChildControlByName("SendMessageInternalAttachTo"):null},_getAttachmentsSendMessage:function(){return this.hasChildControlByName("attachmentsSendMessage")?this.getChildControlByName("attachmentsSendMessage"):null},_getDialogID:function(){return this._options.dialogID?this._options.dialogID:null},_getEditor:function(){return this.hasChildControlByName("БогатыйРедакторСообщение")&&this.getChildControlByName("БогатыйРедакторСообщение")},_getFilesDocView:function(){return this.getLinkedContext().getValue(this._ctxLinkList)?this.getLinkedContext().getValue(this._ctxLinkList):null},_getSendButton:function(){if(!this._sendButton)this._sendButton=this.hasChildControlByName("DoSend")&&this.getChildControlByName("DoSend");return this._sendButton},_handlerOnFocusInBTR:function(){this._notify("onFocusInRichEditor")},_handlerDeleteAttachment:function(e,t){var n=this,i=$.inArray(e,n._newFilesArr),o=n._getFilesDocView();if(-1!==i)n._newFilesArr.splice(i,1);if(o){var s=t?o.getIndexByValue("attachId",t):o.getIndexByValue("msgFileId",e);if(-1!=s)o.removeAt(s)}n._togglePanelDetailsMainButtons(),n.moveFocusToEditor()},_handlerDestroy:function(){var t=this;if(t._sendButton)t._sendButton=null;e.$win.unbind("beforeunload",t._beforeUnload)},_notifyOnButtonClick:function(e){return this._notify("onButtonClick",e)},_setDialogID:function(e){var n=this;return n._options.dialogID=e,n._setDialogIDChildren(e),t.success()},_setDialogIDChildren:function(e){},_setImagesToDocView:function(e){var t=this,n=t._getFilesDocView()?t._getFilesDocView():new i({rawData:{},idProperty:"attachId",adapter:a.instanceOfModule(e[0],"WS.Data/Entity/Record")?e[0].getAdapter():new o});if(e.length)if(a.instanceOfModule(e[0],"WS.Data/Entity/Record"))n.append(e);else for(var r=0;r<e.length;r++){var l=e[r],c=n.getRecordById(l.attachId),d=new s({rawData:l,adapter:n.getAdapter(),idProperty:"attachId"});if(!c)n.add(d);else n.replace(d,n.getIndex(c))}if(!t._getFilesDocView())t._setFilesDocView(n)},_setTabIndexToEditor:function(){},_setFilesDocView:function(e){this.getLinkedContext().setValue(this._ctxLinkList,e)},_subscribeOnBeforeUnload:function(){var t=this;t._beforeUnload=t._beforeUnloadHandler.bind(t),e.$win.bind("beforeunload",t._beforeUnload)},_toggleActionButtonsEnabled:function(e){function t(e,t,n){if(e.hasChildControlByName(t))for(var i=e.getChildControlByName(t),o=i.getContainer(),s=[o,o.find("button")],a=0;a<s.length;a++)if(s[a].length)if(n)s[a].removeClass("ws-disabled"),i.setEnabled(true);else s[a].removeClass("ws-enabled").addClass("ws-disabled")}var n=this,i=["Task","DoSend","New","Approve"],o;if(e){for(n.setGoActionFlag(false),o=0;o<i.length;++o)t(n,i[o],e);n._togglePanelDetailsMainButtons()}else for(n.setGoActionFlag(true),o=0;o<i.length;++o)t(n,i[o],e)},_togglePanelDetailsMainButtons:function(){var e=this,t=e._sendButton?e._sendButton:e._getSendButton(),n=e.getText(),i=this._newFilesArr&&0!==this._newFilesArr.length,o=e.isEnabled();if(t)t.setEnabled((n||i)&&o)}}});
//# sourceMappingURL=Base.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.SendMessage.DoSendBase",["js!SBIS3.Contacts.Mixins.Interface.SendMessageBase","Core/core-merge","Core/Deferred","Core/detection","Core/IoC","i18n!SBIS3.Contacts.Mixins.Interface.SendMessage.DoSendBase"],function(e,s,n,t,o){"use strict";return s(s({},e,{clone:true}),{$protected:{_options:{consumedServices:["sendMsg","sendServiceMsg"]}},trySend:function(e){var s=this;if(s._options.moveFocusOutOfRichEditor)s.moveFocusToBtnSend();return s._toggleActionButtonsEnabled(false),s._isSend=true,s._sendMessageFunc(e)},_getFilesRedaction:function(){var e=this._getFilesDocView(),s=[];if(e)e.each(function(e){s.push({"Файл":e.get("msgFileId"),"ДискИдФайла":e.get("attachId"),"ДискИдВерсии":e.get("redactionId")})});return s},_isHavePermissionForSend:function(e){var s=this,t=s.getText(),i=s._newFilesArr.length;if(!s.isActionOnGo()&&(t||i)){var r=s._getDialogID(),a={opener:s,persons:[],files:s._newFilesArr,filesRedaction:s._getFilesRedaction(),themeGUID:r,messageGUID:null,msgText:t,isChat:s._options.isChat,joinPrevMessage:s._options.joinPrevMessage};if(s._options.isDialogIDRequired&&!r){var c=s._notify("onDialogIDRequired");if(c instanceof n)c.addCallbacks(function(n){if(n)s.setDialog(n),a.themeGUID=n,e=s.trySend(a);else o.resolve("ILogger").log("DoSendBase::_isHavePermissionForSend - dialogID не пришел")},function(s){o.resolve("ILogger").error(s),e.callback(false)});else o.resolve("ILogger").error("DoSendBase::_isHavePermissionForSend - нельзя отправлять сообщение без dialogID"),e.callback(false)}else e=s.trySend(a)}else e.callback(false)},_sendMessage:function(){var e=new n;return this._isHavePermissionForSend(e),e},_sendMessageFunc:function(e){e.msgText=this._setTextToCrc32Pref(e.msgText);var s=this,o=s.consume("sendMsg",e)[0].result,i=new n;if(o)i=o.addCallbacks(function(n){if(s._sendMessageFuncSuccess(e,n),t.isMobileIOS)s.moveFocusToBtnAttach();if(s._isSend=false,s._options.clearAfterSend)s._toggleActionButtonsEnabled(true);return n},function(e){if(22==e.error_code)s.clearFiles();return s._toggleActionButtonsEnabled(true),s._isSend=false,e});else s._toggleActionButtonsEnabled(true),s._isSend=false,i.callback(false);return i},_sendMessageFuncSuccess:function(e,s){this._cleanAfterSend()},_setTextToCrc32Pref:function(e){return e}})});
//# sourceMappingURL=DoSend.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.SendMessage.DoSendInternal",["Core/helpers/fast-control-helpers","Core/IoC","Core/Deferred","js!SBIS3.Contacts.QuoteHelpers","Core/core-merge","js!SBIS3.Contacts.Mixins.Interface.SendMessage.DoSendBase","js!SBIS3.Contacts.CoreMiniFunctions","js!SBIS3.Contacts.CachingPersons","Core/helpers/string-helpers"],function(e,t,s,n,r,i,o,a,c){"use strict";return r(r({},i,{clone:true}),{_doInvitation:function(){var e=this,t=e._options.isChat,s=e.getText(),n=e._getReceivers();if(!t&&e._foreignPersons.length&&!s&&!e.isContentSendMessage())return{text:"",receivers:n,serviceType:"dialog_invite"};else return{addMemberToChat:true,text:s,receivers:n}},_isHavePermissionForSend:function(e){var t=this;t._isHavePermissionForAction("send").addCallback(function(s){if(!t.isActionOnGo()&&s){var r=t._getDialogID(),i=t._getMessageID(),o=t._getDocumentGUID(),a=t._doInvitation(),c={opener:t,persons:a.receivers,files:t._newFilesArr,filesRedaction:t._getFilesRedaction(),themeGUID:r,docGUID:o,messageGUID:i,folderId:t._options.folderId,msgText:a.text,isChat:t._options.isChat,serviceType:a.serviceType,massMessage:t._isSelectDepartment,joinPrevMessage:t._options.joinPrevMessage&&!n.isTextWithQuote(a.text),allReceiversTheme:!t._options.isChat&&0==a.receivers.length,addMemberToChat:a.addMemberToChat};if(o)t._sendMessageByDocument(c,e);else e=t.trySend(c)}else e.callback(false)})},_sendMessage:function(){var e=new s,t=this;return t._isHavePermissionForAction("send").addCallback(function(s){if(!t.isActionOnGo()&&s){var r=t._getDialogID(),i,o,a=t._getDocumentGUID(),c=t._doInvitation();if(i=t._getMessageID(),o={opener:t,persons:c.receivers,files:t._newFilesArr,filesRedaction:t._getFilesRedaction(),themeGUID:r,docGUID:a,messageGUID:i,folderId:t._options.folderId,msgText:c.text,isChat:t._options.isChat,serviceType:c.serviceType,massMessage:t._isSelectDepartment,joinPrevMessage:t._options.joinPrevMessage&&!n.isTextWithQuote(c.text),allReceiversTheme:!t._options.isChat&&0==c.receivers.length,addMemberToChat:c.addMemberToChat},a)t._sendMessageByDocument(o,e);else e=t.trySend(o)}else e.callback(false)}),e},_sendMessageByDocument:function(e,t){var s=this,n=parseInt(s._getDocumentType());if(s._toggleActionButtonsEnabled(false),-1!==$.inArray(n,[5,6,7]))s._sendMessageByNews(t,e);else s.trySend(e).addCallbacks(function(){t.callback()},function(e){t.errback(e)})},_sendMessageByNews:function(t,s){var n=this;e.question(null,{message:rk("Ваше сообщение будет отправлено в комментарии к новости."),buttons:[{caption:"OK",handlers:{onActivated:function(){this.getParent().close(true)}}},{caption:rk("Отмена"),handlers:{onActivated:function(){n._toggleActionButtonsEnabled(true),this.getParent().close(false)}}}]}).addCallback(function(e){if(true===e)n.trySend(s);else t.callback(false)})},_sendMessageFuncSuccess:function(e,s){var n=this,r=n._options.isChat,i=e.themeGUID;try{n._cleanAfterSend();var l=s&&s.getCount&&s.getCount()?s.at(0):null;if(l){if(!i)i=l.get("Диалог")?l.get("Диалог"):null,n._setDialogID(i);var d=l.get("НеВМоемКруге"),g=d?d.length:0;if(g){var f=[],u;for(u=0;u<3&&!!d[u];u++)f.push(d[u]);a.getPersonsFromCache(f).addCallback(function(e){var t=[];for(u=0;u<e.length;u++)t.push(o.getFIOFromRec(e[u]));o.alert(c.format({receivers:g>1?rk("пользователям"):rk("пользователю"),receiversFound:g>1?rk("они не находятся"):rk("он не находится"),lostCount:g>3?"(+"+(g-3)+")":"",firstReceivers:t.join(",<br />")},rk("Сообщение не может быть отправлено $receivers$s$ $firstReceivers$s$ $lostCount$s$, так как $receiversFound$s$ в вашем круге контактов.")))})}}var _=n._getWhomField();if(_){if(n._getDocumentGUID())_.resetCacheForSuggest();_.dropAllLink()}if(n._clearSelectorButton(),!r)n.getLinkedContext().setValue("messageSend",true)}catch(e){t.resolve("ILogger").error("Ошибка при обработке данных после удачной отправки "+"сообщения",e)}},_setTextToCrc32Pref:function(e){if(e&&0!==e.indexOf("&re_")){if(-1===e.indexOf("<p>"))e="<p>"+e.replace(/\n/g,"<br />")+"</p>";e=o.getStringWithCrc32Pref(e)}return e}},{preferSource:false})});
//# sourceMappingURL=DoSend.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.AttachTo",["Core/core-instance","Core/Indicator","Core/IoC","Core/Deferred","Core/detection","Core/UserInfo","js!SBIS3.Contacts.CommonFunctions.Global","js!WS.Data/Collection/RecordSet","js!WS.Data/Adapter/Json","js!WS.Data/Entity/Model","js!SBIS3.Contacts.MessagesExchangeEvents","js!WS.Data/Source/SbisService","js!SBIS3.DOCVIEW.Funcs"],function(e,t,i,r,s,a,n,o,l,d,c,f,g){"use strict";return{$protected:{_options:{multiSelect:true,allowAttachFoldersFromSbisBuffer:true,mainOptions:{serviceUrl:"/disk/api/v1/",objectName:"FileSD",fixId:"",filter:{catalogId:"messages"}},commandsDocView:{redactions:true,links:true,encrypt:true,rights:true}},_filesArrFromSbisDisk:{},_filesInfoStartSbisDisk:{},_fileBrowseControl:null,_getFileFromPlugin:false,_newFilesArr:[],_defLoadFirstFileOnEmptyTheme:null},after:{init:function(){var e=this;require(["js!SBIS3.EDO.CD.CommonDocsHelpers","js!SBIS3.EDO.CD.UploadManager"],function(t,i){e._uploader=new i({remoteUrl:t.getDiskRestServiceURL()}),e._subscribeOnCompleteFiles()}),e.tz_cookie=$.cookie("tz")?parseInt($.cookie("tz")):0,e.subscribeTo(c,"onNewFileVersion",e._handlerOnNewFileVersion.bind(this)),e.subscribeTo(c,"onFilesProcessed",e._handlerOnFilesProcessed.bind(this)),e.subscribeTo(e.getLinkedContext(),"onFieldChange",function(t,i,r){if(i==e._ctxLinkList)e._getEditor().getInputContainer()[r&&!!r.getCount()?"addClass":"removeClass"]("text_rich_field")})},_setFilesDocView:function(e){this._setVisibleInvisibleSignButton()},_handlerDeleteAttachment:function(){var e=this,t=e.getContainer();if(!e._newFilesArr.length)t.find("#attachmentsWrapper").css("display","none"),e._notifyOnSizeChanged()}},getFilesArray:function(){return this._newFilesArr},_onFinishAttachment:function(e,s,a,o){if(e&&e.result)e=e.result;var l=this,d=new r,c=function(){new f({endpoint:"FileSD"}).call(s?"ReadFolderInfo":"ReadFileInfo",{"ИдО":e}).addCallbacks(function(r){var s=r.getRow(),a={"Тема":l._getDialogID(),"ИдФайла":e.split("_")[0],"ИдВерсии":s.has("redactionId")?s.get("redactionId"):null,"Название":s.get("fileName"),"Размер":s.get("size"),"ЭтоСсылка":l._isLink||(s.has("Flags")?s.get("Flags").get("IsLink"):false)};l._attachFromSbisDiskBL(a).addCallbacks(function(){if(l._drawFilesFromSbisDisk(o),l._getFileFromPlugin)l._getFileFromPlugin=false,t.setMessage(""),t.hide(),l.moveFocusToWhomField();d.callback(),l._defLoadFirstFileOnEmptyTheme=null},function(e){n.alert((l._getFileFromPlugin?rk("Не удалось получить файл от СБИС Плагина.")+"\n":"")+rk("Ошибка при прикреплении файла в Сбис.Диск")+"\n"+e.message,l),i.resolve("ILogger").error("Ошибка при прикреплении файла в Сбис.Диск\n",e),t.setMessage(""),t.hide(),l._getFileFromPlugin=false,d.errback(),l._defLoadFirstFileOnEmptyTheme=null})},function(e){n.alert((l._getFileFromPlugin?rk("Не удалось получить файл от СБИС Плагина.")+"\n":"")+rk("Ошибка при чтении файла в Сбис.Диск")+"\n"+e.message,l),i.resolve("ILogger").error("Ошибка при чтении файла в Сбис.Диск\n",e),t.setMessage(""),t.hide(),l._getFileFromPlugin=false,d.errback()})};if(l._defLoadFirstFileOnEmptyTheme)l._defLoadFirstFileOnEmptyTheme.addBoth(function(){c()});else{if(!l._getDialogID())l._defLoadFirstFileOnEmptyTheme=d;c()}return d},attachFilesByIds:function(e){var i=this,r=function(){i._onFinishAttachment(e.pop()).addBoth(function(){if(e.length>0)r();else t.setMessage(""),t.hide()})};if(e.length>0)t.setMessage(rk("Прикрепление файлов")),t.show(),r()},getFileFromBuffer:function(){var e=this._getAttachmentButton();if(e)try{this._getFileFromPlugin=true,e.attachFromClipboard()}catch(e){this._getFileFromPlugin=false,n.alert(rk("Не удалось получить файл от СБИС Плагина."),this)}},getFileFromPlugin:function(){var e=this;t.setMessage(rk("Получение файла от СБИС Плагина")),t.show(),require(["js!SBIS3.Plugin.Source.LocalService"],function(r){new r({endpoint:{address:"SBISDiskService-1.0.0.1",contract:"SBISDiskService"},options:{}}).call("GetScreenshotMessage",{id:a.get("ИдентификаторСервисаПрофилей")}).addCallbacks(function(r){var s=rk("Не удалось получить файл от СБИС Плагина.");if(r=r&&JSON.parse(r),r)if(r.error||!r.fileid)s=r.message||s,i.resolve("ILogger").error(r.details||s),n.alert(s,e),t.setMessage(""),t.hide(),e._getFileFromPlugin=false;else e._getFileFromPlugin=true,e._onFinishAttachment(r.fileid);else i.resolve("ILogger").error(s),n.alert(s,e),t.setMessage(""),t.hide(),e._getFileFromPlugin=false},function(r){i.resolve("ILogger").error(r),n.alert(r.message,e),t.setMessage(""),t.hide(),e._getFileFromPlugin=false})})},addNewFile:function(t){var i=this,r,s=[];if(e.instanceOfModule(t,"WS.Data/Collection/List"))t.each(function(e){for(var t={},i=e.getRawData(),r=0;r<i.d.length;r++)t[i.s[r]["n"]]=i.d[r];t["fileID"]=t.msgFileId,t["fileSize"]=t.size,t["folder"]=null,s.push(t)});else if("object"===typeof t&&t.disk_version_id)return i._newVersion=true,i._isLink=t.disk_is_link,void i._onFinishAttachment(t.disk_version_id,false,"",false,true).addBoth(function(){i._newVersion=false,i._isLink=void 0});else return;r=i._collectFileParams(s),i._addFiles(r,true)},deleteFile:function(e){var t=this,r=t._deleteAttachedFiles([e]);return r.addCallbacks(function(){return t._handlerDeleteAttachment(e),true},function(e){return i.resolve("ILogger").error(e),null}),r},loadNewFile:function(e){var t=this,i=t._getFilesDocView();if(i?-1==i.getIndexByValue("attachId",e["ИдФайла"]):true)return e["Тема"]=t._getDialogID(),t._attachFromSbisDiskBL(e).addCallback(function(){t._drawFilesFromSbisDisk()});else return(new r).errback(rk("Такой файл уже загружен"))},_attachFromSbisDiskBL:function(e){var t=this,r=new f({endpoint:this._options.attachFileService.endpoint});return e["НоваяВерсия"]=!!t._newVersion,r.call(this._options.attachFileService.callMethod,e).addCallbacks(function(e){var i=e.getRow(),r=i?i.getRawData():"{}",s=JSON.parse(r),a=s.fileID;return t._filesArrFromSbisDisk[a]={result:r},s},function(e){return i.resolve("ILogger").error(e),e})},_handlerLoadedButtonAttach:function(e,t,i){var r=this,s=r._getDialogID(),a=l(t),o;if(!a||!a.length)return;if(o=r._collectFileParams(a),!s)r._setDialogID(a[0].themeID);if(i&&i.needRewriteFile&&i.attachId)r._replaceFile(i.attachId,o[0]);else r._addFiles(o);function l(e){function t(e){return e.createDate=new Date(e.createDate),e.lastChange=new Date(e.lastChange),e}var i=e.result,s=e.error,a,o=[];if(n.isEmpty(e)||s)return c(e),o;if(i){var l=JSON.parse(e.result);if(l.message)return c(e),null;o.push(t(l))}else for(var d in e)if(e.hasOwnProperty(d))if(a=e[d],n.isEmpty(a)||a.error||!a.result){c(e),o=[];break}else o.push(JSON.parse(a.result));return o;function c(e){var t=rk("Ошибка при загрузке файла.")+"\n",i=null,s;try{if(i=e.result&&JSON.parse(e.result).message?JSON.parse(e.result):null,!i&&e.error&&e.error.message)i.message=e.error.message;if(!i)i={}}catch(e){i={}}if(s=i&&i.hasOwnProperty("isEmpty")?i.isEmpty:false,s&&i)t+=i.fileName?i.fileName+"<br/>":"";var a=i&&i.message?[rk("Подробности:")," ",s?rk("Файл пуст. Нельзя загружать файлы нулевого размера")+"<br/>"+rk("Попробуйте повторить загрузку"):i.details?i.details:i.message].join(""):[rk("Подробности:")," ",rk("Невозможно прикрепить файл, так как превышен максимальный допустимый размер файла - 100 Mb")].join("");n.alert(t+" "+a,r)}}},_handlerLoadStartedButtonAttach:function(){var e=this,t=e.getParent()._getDialogID();e.setUploadParams({"ТекущаяТема":t})},_handlerChangeButtonAttach:function(e,t,i,r){e.setResult(false);var a=this.getParent(),o="messages",l=s.isIE8||s.isIE9;if(!l&&i instanceof File&&i.size>104857600)return void n.alert(rk("Ошибка при загрузке файла")+" "+i.name+"<br>"+rk("Не поддерживается загрузка файлов больше 100 Мб"),"","error");if(!l&&i instanceof File&&!i.size)return void n.alert(rk("Ошибка при загрузке файла")+" "+i.name+"<br>"+rk("Файл пуст. Нельзя загружать файлы нулевого размера")+"<br/>"+rk("Попробуйте повторить загрузку"),"","error");if(r)a._uploader.upload("plugin",i.name,i.size,{path:i.path,folder:o,fileName:i.name});else if(!l&&i instanceof File){var d=s.isMobileIOS&&"image"===g.parseFileName(i.name).name?g.generateScreenShotName(i.name):i.name;a._uploader.upload("browser",d,i.size,{file:i,folder:o,fileName:d})}else a._uploader.upload("browser",i.name,i.size,{file:i,path:i.path,folder:o,isFolder:i.isFolder,rootId:i.rootId})},_isRestrictedContent:function(){var e=this._getFilesDocView(),t=false;if(e)e.each(function(e){if(e.get("folder@"))return void(t=true)});return t},_addDocView:function(e,t,i){var a=this,n=new r;return require(["js!SBIS3.DOCVIEW.List"],function(t){new t({element:e,name:"attachmentsSendMessage",parent:a,opener:a,mainOptions:{ctxLinkList:"ФайлыDocView",useOnlyCtx:true,objectName:"FileSD",serviceBLName:"СБИСДиск.Приватный",serviceUrl:"/disk/api/v1/",commands:{rights:a._options.commandsDocView.rights,print:!s.isMobilePlatform,sendMessage:false,deletePermanentlyDoc:false,restore:false,move:false,fullScreen:false,saveToPdf:false,copyToBuffer:true,signDocument:a._options.visibleSignatureBtnOnAttach,redactions:a._options.commandsDocView.redactions,links:a._options.commandsDocView.links,encrypt:a._options.commandsDocView.encrypt}},listOptions:{goToFolder:false,activableByClick:true,calcMargin:false,previewWidth:82,previewHeight:82,visibilityMode:{defaultMode:"bigPreview",folderAsPreview:true},multiselect:false,itemsDragNDrop:false,hasHierarchy:false,hideBreadCrumbs:true,itemsSortMethod:null},handlers:{onReady:function(){if(this.setCommandCfg)this.setCommandCfg("rename",{inList:false});a._setImagesToDocView(i),a.setMaximalHeight(a.getMaximalHeight()),this.getContainer().on("dragover dragenter",function(e){e.stopPropagation(),e.preventDefault()});var e=a._getAttachmentButton(),t=this.getLinkedContext();if(e)e._options.linkedList=this;a.subscribeTo(t,"onFieldChange",a._handlerOnFieldChangeCtxAttach.bind(a)),n.callback(this)},onStartCommand:function(e,t,i,r){if(t&&"deleteDoc"==t){for(var s=i.records,n=0;n<s.length;n++){var o=s[n],l=o.get("msgFileId");a._deleteAttachedFiles([l]).addCallback(function(){a._handlerDeleteAttachment(l,o.get("attachId")),a.setMaximalHeight(a.getMaximalHeight())})}if(r&&r.instance){var d=r.instance._getCommandsManager?r.instance._getCommandsManager():null,c=d.hasChildControlByName("closeFullScreen")?d.getChildControlByName("closeFullScreen"):null;if(d&&c)d.startCommand("closeFullScreen",i.records,{records:i,instance:c})}e.setResult(false)}}}})}),n},_replaceFile:function(e,t){var i=this,r=i._getFilesDocView();if(r){var s=new d({rawData:t,adapter:r.getAdapter(),idProperty:"attachId"}),a=r.getIndexByValue("attachId",e),n=r.at(a).get("msgFileId");r.replace(s,a),i.deleteFile(n)}},_addFiles:function(e,t){var i=this,r=i.getContainer(),a=i._getEditor().getContainer();if(!r.find("#attachmentsWrapper").length)a.after('<div id="attachmentsWrapper"><div></div></div>');var n=i._getAttachmentsSendMessage(),o=r.find("#attachmentsWrapper"),l=o.find("div:first");if(i._waitingDocViewListDeferred)return void i._waitingDocViewListDeferred.addCallback(function(e,t){i._addFiles(e,t)}.bind(i,e.slice(),t));else if(n){if(e.length)i._setImagesToDocView(e)}else i._waitingDocViewListDeferred=i._addDocView(l,t,e),i._waitingDocViewListDeferred.addBoth(function(){i._waitingDocViewListDeferred=null});if(e.length)o.css("display","block"),i._notifyOnSizeChanged();if(i._togglePanelDetailsMainButtons(),!s.isMobilePlatform)i.moveFocusToEditor();i.setMaximalHeight(i.getMaximalHeight())},_collectFileParams:function(e){for(var t=this,i=[],r,s,a=0;a<e.length;a++){r=e[a].fileSize,s=e[a].fileID;var o=e[a].details,l=e[a].message,d=e[a].isEmpty,c=rk("Ошибка при загрузке файла.")+"\n";if(!s&&(o||l)){if(d)c+=e[a].fileName?e[a].fileName+"<br/>":"";var f=o?[rk("Подробности:")," ",d?rk("Файл пуст. Нельзя загружать файлы нулевого размера")+"<br/>"+"Попробуйте повторить загрузку":o?o:l].join(""):[rk("Подробности:")," ",rk("Невозможно прикрепить файл, так как превышен максимальный допустимый размер файла - 100 Mb")].join("");n.alert(c+f,t);continue}var g=t._isExistFile(e[a].attachId);if(-1===t._newFilesArr.indexOf(s)&&!g)t._newFilesArr.push(s);if("string"===typeof e[a].createDate)e[a].createDate=Date.fromSQL(e[a].createDate);if("string"===typeof e[a].lastChange)e[a].lastChange=Date.fromSQL(e[a].lastChange);if("string"===typeof e[a].ModifyDate)e[a].ModifyDate=Date.fromSQL(e[a].ModifyDate);i.push(e[a])}return i},_drawFilesFromSbisDisk:function(e){var t=this,i=t._filesArrFromSbisDisk;if(!$.isEmptyObject(i))t._handlerLoadedButtonAttach(null,i,e),t._filesArrFromSbisDisk={}},_handlerAttachDestroy:function(){var e=this._getAttachmentsSendMessage();if(e)e.destroy()},_handlerOnFieldChangeCtxAttach:function(e,t,i){var r=this;if(t==r._ctxLinkList)r._setVisibleInvisibleSignButton()},_handlerOnFilesProcessed:function(e,t){var i=this,r=i._getDialogID();if(!i._isSend&&t.themeID==r&&t.isProcessed&&t.fileIDs.length&&i._newFilesArr&&i._newFilesArr.length){for(var s=i._getFilesDocView(),a=0;a<t.fileIDs.length;a++){var n=t.fileIDs[a],o=i._newFilesArr.indexOf(n);if(-1!=o){var l=s?s.getIndexByValue("msgFileId",n):-1;if(i._newFilesArr.splice(o,1),-1!=l)s.remove(s.at(l))}}if(!i._newFilesArr.length)i.getContainer().find("#attachmentsWrapper").css("display","none"),i._notifyOnSizeChanged()}},_handlerOnMenuItemActivate:function(e,t,i){var r=this;if(void 0===r._isDemo)r._checkIsDev.addCallback(function(e){r._isDemo=e,r._startLoadFiles(e,t,i)});else r._startLoadFiles(r._isDemo,t,i)},_handlerOnNewFileVersion:function(e,t){var i=this;if(!i.isEnabled())return;if(t.themeID!=i._getDialogID())return;if(t.isRename){var r=i._getFilesDocView(),s=r?r.getRecordById(t.attachId):null;if(s)s.set("fileName",t.fileName),s.set("title",t.fileName)}else i.addNewFile(t)},_isExistFile:function(e){var t=this._getFilesDocView();return t?-1!=t.getIndexByValue("attachId",e):false},_setImagesToDocView:function(t){var i=this,r=i._getFilesDocView()?i._getFilesDocView():new o({rawData:{},idProperty:"attachId",adapter:e.instanceOfModule(t[0],"WS.Data/Entity/Record")?t[0].getAdapter():new l});if(t.length)if(e.instanceOfModule(t[0],"WS.Data/Entity/Record"))r.append(t);else for(var s=0;s<t.length;s++){var a=t[s],n=r.getRecordById(a.attachId),c=new d({rawData:a,adapter:r.getAdapter(),idProperty:"attachId"});if(!n)r.add(c);else r.replace(c,r.getIndex(n))}if(!i._getFilesDocView())i._setFilesDocView(r)},_subscribeOnCompleteFiles:function(){var e=this;e.subscribeTo(e._uploader,"Complete",function(r,s,a){var n=e._filesInfoStartSbisDisk.hasOwnProperty(s)?e._filesInfoStartSbisDisk[s]:null,o=n?n.name:rk("Неизвестное имя"),l=n?n.size:0,d={"Тема":e._getDialogID(),"ИдФайла":a.id,"ИдВерсии":a.versionId,"Название":o,"Размер":l,"ЭтоСсылка":false};if(n)delete e._filesInfoStartSbisDisk[s];e._attachFromSbisDiskBL(d).addCallbacks(function(){if(e._drawFilesFromSbisDisk(),$.isEmptyObject(e._filesInfoStartSbisDisk))t.setMessage(""),t.hide()},function(e){i.resolve("ILogger").error("Ошибка при прикреплении файла в Сбис.Диск\n",e),t.setMessage(""),t.hide()})}),e.subscribeTo(e._uploader,"Start",function(i,r){t.setMessage(rk("Прикрепление файлов")),e._filesInfoStartSbisDisk[r.id]={name:r.name,size:r.size}}),e.subscribeTo(e._uploader,"Error",function(e,r,s){var a=rk("Ошибка при загрузке файла в Сбис.Диск");i.resolve("ILogger").error(a+"\n",s&&s.details?s.details:""),n.alert(s&&s.message?s.message:a,"","error"),t.setMessage(""),t.hide()})}}});
//# sourceMappingURL=AttachTo.module.js.map
define("tmpl!SBIS3.CONTROLS/SelectorButton/resources/defaultItemTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,a,i,n,l){function s(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var d="string"==typeof i?i:"",m=void 0===r?void 0:r,f={id:[],def:void 0},v=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},S=p.getMarkupGenerator(n);try{var y=S.joinElements([S.createTag("span",{class:"controls-ListView__item js-controls-ListView__item controls-SelectorButton__item "+p.wrapUndef(p.utils.escape(p.getDecorators().orEmpty.apply(void 0,[p.getter(o,["className"])]))),"data-hash":""+p.wrapUndef(p.utils.escape(p.getter(o,["projItem","getHash"]).apply(p.getter(o,["projItem"]),[]))),"data-id":""+p.wrapUndef(p.utils.escape(p.getter(o,["item","getId"]).apply(p.getter(o,["item"]),[])))},[S.createControl("resolver",p.getter(o,["itemContent"]),p.uniteScope(p.utils.escape(p.uniteScope(o,{parent:void 0,element:void 0})(p.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},i,m,g,p.config,u,f)],a,f,this)],d,f);f.def&&(y=S.chain(y,f,a),f=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/SelectorButton/resources/defaultItemTemplate.tmpl",e,o)}return y||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/SelectorButton/resources/defaultItemTemplate"}},o});
//# sourceMappingURL=defaultItemTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/SelectorButton/resources/defaultItemContentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},n=function e(n,o,l,i,u){function a(){}var s=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};u&&u.isSetts&&(d=u.fullContext||{});var p="string"==typeof l?l:"",m=void 0===r?void 0:r,f={id:[],def:void 0},v=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,n),S=this&&this.includedTemplates?this.includedTemplates:{},y=c.getMarkupGenerator(i);try{var T=y.joinElements([y.createText(""+c.wrapUndef(c.utils.escape(c.getter(n,["item",c.getter(n,["displayProperty"])]))))],p,f);f.def&&(T=y.chain(T,f,o),f=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/SelectorButton/resources/defaultItemContentTemplate.tmpl",e,n)}return T||""};return n.includedFunctions={},n.stable=!0,n.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/SelectorButton/resources/defaultItemContentTemplate"}},n});
//# sourceMappingURL=defaultItemContentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/SelectorButton/resources/contentTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,n,s,c,l){function i(){}var a=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var p="string"==typeof s?s:"",m=void 0===r?void 0:r,g={id:[],def:void 0},_=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},v=u.getMarkupGenerator(c);try{var S=v.joinElements([u.getter(o,["icon"])?[v.createTag("i",{class:"controls-Button__icon js-controls-Button__icon controls-SelectorButton__icon "+u.wrapUndef(u.utils.escape(u.getter(o,["_iconClass"])))},[],{},g,this)]:v.createText(""),v.createTag("span",{class:"controls-Button__text js-controls-Button__text controls-SelectorButton__text"},[u.getter(o,["_serverRender"])&&u.getter(o,["_records","length"])?[v.createControl("resolver",u.getter(o,["_itemsTemplate"]),{records:u.getter(o,["_records"]),tplData:u.getter(o,["_itemData"])},{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:_},s,m,f,u.config,d,g)]:[v.createText(""+u.wrapUndef(u.utils.escape(u.getter(o,["defaultCaption"]))))]],n,g,this),v.createTag("i",{class:"controls-SelectorButton__cross js-controls__item-cross icon-16 icon-Close icon-disabled action-hover "+u.wrapUndef(u.utils.escape(u.getter(o,["items"])&&u.getter(o,["items","getCount"]).apply(u.getter(o,["items"]),[])&&!u.getter(o,["withoutCross"])?"":"ws-hidden"))},[],n,g,this)],p,g);g.def&&(S=v.chain(S,g,n),g=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/SelectorButton/resources/contentTemplate.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/SelectorButton/resources/contentTemplate"}},o});
//# sourceMappingURL=contentTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/SelectorButton/SelectorButton",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,n,l,i,a){function c(){}var s=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var p="string"==typeof l?l:"",v=void 0===r?void 0:r,S={id:[],def:void 0},f=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},g=u.getMarkupGenerator(i);try{var B=g.joinElements([g.createTag("span",{class:"controls-ButtonBase controls-SelectorButton "+u.wrapUndef(u.utils.escape(u.getter(o,["visible"])?"":" ws-hidden")),title:""+u.wrapUndef(u.utils.escape(u.getter(o,["tooltip"]))),disabled:""+u.wrapUndef(u.utils.escape(u.getter(o,["enabled"])?"":"disabled")),type:"button"},[g.createTag("span",{class:"controls-Button__wrapper"},[g.createControl("resolver",u.getter(o,["contentTemplate"]),u.uniteScope(u.utils.escape(u.uniteScope(o,{parent:void 0,element:void 0})(u.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:f},l,v,m,u.config,d,S)],{},S,this)],n,S,this)],p,S);S.def&&(B=g.chain(B,S,n),S=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/SelectorButton/SelectorButton.tmpl",e,o)}return B||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/SelectorButton/SelectorButton"}},o});
//# sourceMappingURL=SelectorButton.tmpl.map
define("SBIS3.CONTROLS/SelectorButton",["tmpl!SBIS3.CONTROLS/SelectorButton/SelectorButton","tmpl!SBIS3.CONTROLS/SelectorButton/resources/contentTemplate","tmpl!SBIS3.CONTROLS/SelectorButton/resources/defaultItemContentTemplate","tmpl!SBIS3.CONTROLS/SelectorButton/resources/defaultItemTemplate","js!WSControls/Buttons/Button","SBIS3.CONTROLS/Mixins/ItemsControlMixin","SBIS3.CONTROLS/Mixins/MultiSelectable","SBIS3.CONTROLS/Mixins/ActiveMultiSelectable","SBIS3.CONTROLS/Mixins/Selectable","SBIS3.CONTROLS/Mixins/ActiveSelectable","SBIS3.CONTROLS/Mixins/SyncSelectionMixin","SBIS3.CONTROLS/Mixins/ChooserMixin","SBIS3.CONTROLS/Mixins/IconMixin","Core/core-instance","Core/helpers/string-helpers","SBIS3.CONTROLS/Utils/ToSourceModel","SBIS3.CONTROLS/Utils/ItemsSelectionUtil","WS.Data/Collection/List","SBIS3.CONTROLS/Action/SelectorAction","css!SBIS3.CONTROLS/SelectorButton/SelectorButton"],function(t,e,i,o,s,n,l,c,r,a,u,S,d,f,h,p,m,_,I){"use strict";var C=s.extend([n,l,c,r,a,u,S,d],{_dotTplFn:t,$protected:{_options:{clickThrottle:true,contentTemplate:e,_serverRender:true,_defaultItemContentTemplate:i,_defaultItemTemplate:o,_selectorAction:null,defaultCaption:"",dictionaries:[],selectMode:"floatArea",useSelectorAction:false,withoutCross:false}},$constructor:function(){var t=this;if(this.subscribe("onSelectedItemsChange",function(e,i,o){if(o.added.length&&!t._isEmptySelection())t.getSelectedItems(true).addCallback(function(e){return t.validate(),e})}),this._options.useSelectorAction)this.subscribe("onInit",function(){m.initSelectorAction(this._getSelectorAction(),this)})},_modifyOptions:function(t,e,i){var o=C.superclass._modifyOptions.apply(this,arguments);if(-1!==(i&&i.class||o.element&&o.element.className||o.className||"").indexOf("controls-SelectorButton__withoutCross"))o.withoutCross=true;if(o.selectedItem&&f.instanceOfModule(o.selectedItem,"WS.Data/Entity/Model"))o.items=new _({items:[o.selectedItem]});else if(o.selectedItems)o.items=o.selectedItems;if(o.items)o._records=o._getRecordsForRedraw(o._createDefaultProjection(o.items,o),o),o._itemData=o._buildTplArgs(o);return o},_drawSelectedItems:function(){var t=this,e;this.getSelectedItems(true).addCallback(function(i){if(e=t.getItems(),i)t.setItems(i);else if(e)e.clear(),t.setItems(e);else t.setItems(new _);return i})},_toggleEmptyData:function(t){var e=this._getItemsContainer();if(!this._options.withoutCross)this._container.find(".controls-SelectorButton__cross").toggleClass("ws-hidden",t);if(t)e.text(this.getProperty("defaultCaption")).removeAttr("title");else if(!this._options.itemContentTpl&&!this._options.itemTpl)e.attr("title",this.getCaption())},_setSelectedIndex:function(t){if(this.getSelectedIndex()!==t)C.superclass._setSelectedIndex.apply(this,arguments)},_getItemsContainer:function(){return this.getContainer().find(".controls-Button__text")},setSelectedKey:function(t){if(this._options.selectedKey!==t)this._options.selectedKey=t,this._notifySelectedItem(this._options.selectedKey)},setCaption:function(t){throw new Error("SelectorButton::setCaption св-во caption работает только на чтение")},getCaption:function(){var t=[],e=this.getSelectedItems(),i=this;if(e)e.each(function(e){t.push(h.htmlToText(e.get(i._options.displayProperty)||""))});return t.join(", ")},_clickHandler:function(t){var e=this.getDictionaries()[0],i=this;m.clickHandler.call(i,t.target,function(){i.removeItemsSelectionAll()},function(t){if(i.isEnabled()){if(e)i.showSelector(e)}else if(void 0!==t)m.onItemClickNotify.call(i,t)})},_checkEnabledByClick:function(){return true},showSelector:function(t){if(this.getProperty("useSelectorAction")){if(t.multiselect=this.getMultiselect(),t.selectedItems=this.getSelectedItems(),t.opener=this,false!==this._notify("onSelectorClick",t))this._getSelectorAction().execute(t)}else this._showChooser(t.template,t.componentOptions)},_getSelectorAction:function(){if(!this._selectorAction)this._selectorAction=new I({mode:this._getOption("selectMode"),visible:false});return this._selectorAction},setDictionaries:function(t){this._options.dictionaries=t,this._notifyOnPropertyChanged("dictionaries")},getDictionaries:function(){return this._options.dictionaries},_chooseCallback:function(t){if(t&&t.length)f.instanceOfModule(t[0],"WS.Data/Entity/Model")?this.addSelectedItems(t):this.addItemsSelection(t)},_notify:function(){return m.delayedNotify(C.superclass._notify,arguments,this)},_prepareItems:function(){return p(C.superclass._prepareItems.apply(this,arguments),this.getDataSource(),this._options.idProperty,this._options.saveParentRecordChanges)},_getAdditionalChooserConfig:function(){return{multiSelect:this.getMultiselect()}},reload:function(){},_setSelectedItems:function(){},destroy:function(){if(this._selectorAction)this._selectorAction.destroy(),this._selectorAction=null;C.superclass.destroy.call(this)}});return C});
//# sourceMappingURL=SelectorButton.js.map
define("js!SBIS3.CONTROLS.SelectorButton",["SBIS3.CONTROLS/SelectorButton"],function(t){return t});
//# sourceMappingURL=SelectorButton.module.js.map
define("js!SBIS3.CONTROLS.MenuIcon",["SBIS3.CONTROLS/Menu/MenuIcon"],function(n){return n});
//# sourceMappingURL=MenuIcon.module.js.map
define("html!SBIS3.Contacts.SendMessageInternal/Internal",function(){var o=function(o){var n=function(){var o=/\{\{([\s\S]+?)\}\}/g;return function(n){for(;o.test(n);)n=n.replace(o,"&#123;&#123;$1&#125;&#125;");return n}}(),t=function(o){return o.join?o.join(""):o.toString()},i=function(o){return void 0===o?"":o&&"object"==typeof o?t(o):""+o},e="undefined"!=typeof process,a=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="contacts-SendMessageInternal" ');return o.fastRender||(a+=' style="visibility: hidden;" '),a+='> <div class="container-pre-send ',o.visibleContainerPreSend||(a+="ws-hidden"),a+='" id="receiversAndButtons"> <div id="container-for-receivers"> <component data-component=\'SBIS3.Contacts.WhomFieldInternal\' class="whomFieldForResend"> ',o._isNonSafaryAndNonMobile&&!o.focusOnSuggest?a+=' <option name="tabindex">3</option> ':(!o._isNonSafaryAndNonMobile&&o.isNewTheme||o.focusOnSuggest)&&(a+=' <option name="tabindex">1</option> '),a+=" <option name='name'>WhomFieldReSend</option> <option name='visible'>"+n(i(o.visibleWhomField&&o.visibleContainerPreSend))+"</option> <option name='docGUID'>"+n(i(o.documentDetails.docGUID))+"</option> <option name='placeholder'>"+n(i(o.placeholder))+"</option> <option name='placeholderMore'>"+n(i(o.placeholderMore))+'</option> <option name="themeGUID">'+n(i(o.dialogID))+'</option> <option name="showWarningTooManySelected">'+n(i(!(o.dialogID||o.isNewTheme||o.isChat)))+'</option> <option name="addresseeChoiceOpenerStyle">iconPeople</option> <option name="showOptLastThemes">'+n(i(o.showOptLastThemes))+'</option> <option name="activableByClick">false</option> <option name="needCheckMyCircle">'+n(i(o.needCheckMyCircle))+'</option> <options name="visibleTabsInAdresseeChoice"> <option name="companies">'+n(i(o.visibleTabsInAdresseeChoice.companies))+'</option> <option name="employees">'+n(i(o.visibleTabsInAdresseeChoice.employees))+'</option> <option name="myContacts">'+n(i(o.visibleTabsInAdresseeChoice.myContacts))+'</option> <option name="findContacts">'+n(i(o.visibleTabsInAdresseeChoice.findContacts))+'</option> <option name="groups">'+n(i(o.visibleTabsInAdresseeChoice.groups))+"</option> </options> ",o.blObjectSettings&&(a+=' <options name="blObjectSettings"> <option name="endpoint">'+n(i(o.blObjectSettings.endpoint))+'</option> <option name="query">'+n(i(o.blObjectSettings.query))+'</option> <option name="idProperty">'+n(i(o.blObjectSettings.idProperty))+'</option> <option name="searchFieldName">'+n(i(o.blObjectSettings.searchFieldName))+"</option> </options> "),a+=' </component> <component data-component="SBIS3.CONTROLS.SelectorButton" name="Recipient"> <opt name="displayProperty">recipientName</opt> <opt name="visible">false</opt> <opt name="idProperty">recipientId</opt> <opt name="multiselect">false</opt> <opts name="selectedItem"> <opt name="recipientName" bind="recipientName"></opt> <opt name="recipientId" bind="recipientId"></opt> </opts> <opt name="activableByClick">false</opt> </component> </div> <div id="showButtons"> <div class="smallButtons"> <component data-component="SBIS3.CONTROLS.RichEditorRoundToolbar" name="RichEditorRoundToolbar"> <option name="side">left</option> <options name="items" type="array"> <options> <option name="name">image</option> <option name="visible">false</option> </options> <options> <option name="name">list</option> <option name="visible">false</option> </options> ',o.fastRender&&!o.showButtons.mention||(a+=' <options> <option name="name">mention</option> <option name="componentType">SBIS3.Contacts.SendMessageInternal.Buttons.MentionBtn</option> <option name="basic">true</option> <option name="order">1</option> <option name="activableByClick">false</option> <option name="rootName">'+n(i(o.name))+"</option> ",o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=" </options> "),a+=' <options> <option name="name">dialog</option> <option name="componentType">SBIS3.CONTROLS.IconButton</option> <option name="icon">sprite:icon-16 icon-TFDialogue icon-primary</option> <option name="className">controls-IconButton__round-border unSelectable</option> <option name="tooltip">'+n(i(rk("Перейти к диалогу")))+'</option> <option name="basic">true</option> <option name="order">2</option> <option name="activableByClick">false</option> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <option name="visible">'+n(i(!o.fastRender||o.showButtons.dialog))+'</option> </options> <options> <option name="name">styles</option> <option name="tooltip">'+n(i(rk("Форматирование текста")))+'</option> <option name="basic">true</option> <option name="order">3</option> <option name="activableByClick">false</option> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <option name="visible">'+n(i(!o.fastRender||o.showButtons.editortools))+'</option> </options> <options> <option name="name">toggle</option> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <option name="visible">'+n(i(!o.fastRender||!!o.expandableButtons))+'</option> </options> <options> <option name="name">link</option> <option name="basic">true</option> <option name="order">4</option> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <option name="visible">'+n(i(!o.fastRender||o.showButtons.link))+"</option> </options> ",o.fastRender&&!o.visibleSignatureBtnOnAttach||(a+=' <options> <option name="name">signature</option> <option name="icon">sprite:icon-16 icon-Signature icon-primary unSelectable</option> <option name="componentType">SBIS3.CONTROLS.MenuIcon</option> <option name="className">controls-IconButton__round-border</option> <option name="caption">'+n(i(rk("Подписать документы")))+'</option> <option name="basic">true</option> <option name="order">5</option> <option name="idProperty" type="string">id</option> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <options name="items" type="array"> <options> <option name="title">'+n(i(rk("Подписать")))+'</option> <option name="id">Подписать</option> </options> <options> <option name="title">'+n(i(rk("Запросить подпись")))+'</option> <option name="id">ЗапроситьПодпись</option> </options> <options> <option name="title">'+n(i(rk("Подписать и запросить подпись")))+'</option> <option name="id">ПодписатьИЗапроситьПодпись</option> </options> </options> </options> '),a+=' <options> <option name="name">history</option> <option name="icon">icon-16 icon-ExpandList icon-primary</option> <option name="tooltip">'+n(i(rk("История ввода")))+'</option> <option name="caption">'+n(i(rk("История ввода")))+'</option> <option name="pickerClassName">history-span</option> <option name="basic">true</option> <option name="order">6</option> <option name="activableByClick">false</option> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <option name="visible">'+n(i(!o.fastRender||o.showButtons.history))+'</option> </options> <options> <option name="name">smile</option> <option name="tooltip">'+n(i(rk("Вставить смайлик")))+'</option> <option name="basic">true</option> <option name="order">7</option> <option name="activableByClick">false</option> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <option name="visible">'+n(i(!o.fastRender||o.showButtons.smile))+"</option> </options> ",o.fastRender&&!o.showButtons.task||(a+=' <options> <option name="name">task</option> <option name="componentType">SBIS3.EDO2.RulesSelector</option> <option name="lazyLoading">true</option> <option name="basic">true</option> <option name="order">8</option> <option name="enabled">false</option> <option name="activableByClick">true</option> <option name="visible">'+n(i(!o._isInMySbis))+"</option> ",o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <options name="docTypes" type="array"> <options> <option name="docType">СлужЗап</option> <option name="docSubType">null</option> </options> </options> <option name="content" type="content"> <component data-component="SBIS3.CONTROLS.MenuIcon"> <option name="name">task</option> <option name="idProperty">Идентификатор</option> <option name="icon">sprite:icon-24 icon-TFTask icon-primary</option> <option name="className">controls-IconButton__round-border taskIcon</option> <option name="tooltip">'+n(i(rk("Создать задачу")))+'</option> <option name="activableByClick">false</option> </component> </option> </options> '),a+=' </options> </component> </div> <div class="button_big"> <component data-component="SBIS3.Contacts.SendMessageInternal.Buttons.NewBtn" name="New" class="newDialog unSelectable" unselectable="on"> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <option name="caption">'+n(i(rk("Новый диалог")))+'</option> <option name="visible">'+n(i(o.showButtons.New))+'</option> <option name="activableByClick">false</option> </component> <component data-component="SBIS3.Contacts.SendMessageInternal.Buttons.ApproveBtn" name="Approve" class="unSelectable approve" unselectable="on"> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=' <option name="visible">'+n(i(o.showButtons.approve))+'</option> <option name="caption">'+n(i(rk("Согласовать")))+'</option> <option name="activableByClick">false</option> </component> </div> </div> </div> <div class="container-send"> <div class="attach-file"> <component data-component="SBIS3.DOCVIEW.AttachTo" name="SendMessageInternalAttachTo" class="attach-file-button"> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">0</option> '),a+=" <option name='caption'>"+n(i(rk("Прикрепить")))+'</option> <option name="hasLink">true</option> <option name="hasBuffer">'+n(i(o.hasBuffer))+'</option> <option name="hasVideoMessage">'+n(i(o.hasVideoMessage))+"</option> ",o._isNonBilling&&(a+='<option name="hasSbisDiskLink">true</option>'),a+=' <option name="useDefaultWindow">true</option> <option name="allowAttachFoldersFromSbisBuffer">true</option> <option name="allowDragNDrop">true</option> ',o.filesDropElement&&(a+=' <option name="dropElement">'+n(i(o.filesDropElement))+"</option> "),a+=' <option name="tooltip">'+n(i(rk("Прикрепить")))+'</option> <option name="icon">sprite:icon-24 icon-Attach icon-primary</option> <option name="iconSize">24</option> <option name="visible">'+n(i(o.showButtons.attachFile))+'</option> <option name="linkAsUrlFile">false</option> <options name="mainOptions"> <option name="useVersionId">false</option> <option name="fixId">messages</option> <option name="isDisk">true</option> <option name="objectName">FileSD</option> <option name="serviceUrl">/disk/api/v1/</option> <options name="filter"> <option name="catalogId">messages</option> </options> </options> <option name="showCaption">false</option> </component> </div> <div class="do-send"> <component data-component="SBIS3.Contacts.SendMessageInternal.Buttons.DoSendBtn" class="do-send-button controls-Button__withoutCaption unSelectable" name="DoSend" unselectable="on"> ',o._isNonSafaryAndNonMobile&&(a+=' <option name="tabindex">2</option> '),a+=' <option name="icon">sprite:icon-24 icon-Send icon-hover</option> <option name="visible">'+n(i(o.showButtons.dosend))+'</option> <option name="activableByClick">false</option> <option name="primary">true</option> <option name="enabled">false</option> </component> </div> <div class="rich-editor"> <div class="rich-editor__scrollContainer"> <div class="rich-editor__union"> <component data-component="SBIS3.Contacts.SendRichEditor2" name="БогатыйРедакторСообщение"> ',o._isNonSafaryAndNonMobile&&(a+=" ",o.isNewTheme?a+=' <option name="tabindex">20</option> ':a+=' <option name="tabindex">1</option> ',a+=" "),a+=" <option name='className'>ws-disabled_white</option> <option name='maxHeight'>0</option> <option name='spellcheck'>true</option> <option name='focusOnActivatedOnMobiles'>false</option> <option name='uploadImageOnDrop'>false</option> <option name='toolbarVisible' type='boolean'>false</option> <option name='saveState'>true</option> <option name='autoHeight' type='boolean'>true</option> <option name='autoWidth' type='boolean'>true</option> <option name='minimalHeight'>50</option> <option name='maximalHeight'>0</option> <option name='placeholder'>"+n(i(o.tooltip))+"</option> <option name=\"toolbar\">false</option> <options name='items' type=\"array\"> <options> <option name=\"name\">undo</option> <option name='visible'>false</option> </options> <options> <option name=\"name\">redo</option> <option name='visible'>false</option> </options> <options> <option name=\"name\">paste</option> <option name='visible'>false</option> </options> <options> <option name=\"name\">align</option> <option name='visible'>false</option> </options> <options> <option name=\"name\">list</option> <option name='visible'>false</option> </options> <options> <option name=\"name\">link</option> <option name='visible'>false</option> </options> <options> <option name=\"name\">unlink</option> <option name='visible'>false</option> </options> <options> <option name=\"name\">image</option> <option name='visible'>false</option> </options> <options> <option name=\"name\">smile</option> <option name='visible'>false</option> </options> <options> <option name=\"name\">source</option> <option name='visible'>false</option> </options> </options> <options name='handlers'> <option name='onTextChange' value='js!SBIS3.Contacts.SendMessageInternal:prototype._handlerValueChangeRichEditor' type='function'></option> <option name='onInitEditor' value='js!SBIS3.Contacts.SendMessageInternal:prototype._handlerOnInitEditor' type='function'></option> </options> </component> </div> </div> </div> </div> </div>",(a=n(a))+(e&&-1!==a.indexOf("{{")?String.fromCharCode(8203,8203):"")};return o.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.SendMessageInternal/Internal"}},o});
//# sourceMappingURL=Internal.xhtml.map
define("js!SBIS3.Contacts.SendMessageInternal",["Core/core-extend","Core/core-instance","Core/constants","Core/IoC","Core/Deferred","Core/detection","js!SBIS3.CONTROLS.CompoundControl","html!SBIS3.Contacts.SendMessageInternal/Internal","js!SBIS3.Contacts.CommonFunctions.Global","js!WS.Data/Collection/List","js!WS.Data/Source/SbisService","js!SBIS3.Contacts.Mixins.Services.Executor.ChangeContextQuery.Send","js!SBIS3.Contacts.Mixins.Services.Consumer","js!SBIS3.Contacts.Mixins.Interface.AttachTo","js!SBIS3.Contacts.Mixins.Services.Executor.SendMessage","js!SBIS3.Contacts.Mixins.Services.Executor.ReplyMessage","js!SBIS3.Contacts.Mixins.Services.Executor.SendButtonEnable","Core/helpers/string-helpers","js!SBIS3.Contacts.QuoteHelpers","js!SBIS3.Contacts.Mixins.Interface.SendMessage.DoSendInternal","js!SBIS3.Contacts.Mixins.Services.Executor.SignFiles","Core/Indicator","Core/EventBus","js!WS.Data/Chain","Core/helpers/Object/isEmpty","Core/UserInfo","js!SBIS3.CONTROLS.Utils.InformationPopupManager","css!SBIS3.Contacts.SendMessageInternal/Internal","js!SBIS3.Contacts.SendRichEditor2","js!SBIS3.Contacts.WhomFieldInternal","js!SBIS3.Contacts.SendMessageInternal.Buttons.NewBtn","js!SBIS3.Contacts.SendMessageInternal.Buttons.DoSendBtn","js!SBIS3.Contacts.SendMessageInternal.Buttons.ApproveBtn","js!SBIS3.CONTROLS.RichEditorRoundToolbar","js!SBIS3.DOCVIEW.AttachTo","i18n!SBIS3.Contacts.SendMessageInternal","js!SBIS3.CONTROLS.SelectorButton","preload!js!SBIS3.Contacts.MessagePanel","js!SBIS3.CONTROLS.IconButton","optional!js!SBIS3.EDO2.RulesSelector","js!SBIS3.Contacts.SendMessageInternal.Buttons.MentionBtn","js!SBIS3.CONTROLS.MenuIcon"],function(e,t,n,i,s,o,r,a,l,c,d,u,h,g,f,_,p,v,b,S,m,B,C,T,I,A,y){"use strict";var w=r.extend([S],{_dotTplFn:a,$protected:{_options:{_isMobileIOS:o.isMobileIOS,_isMobileAndroid:o.isMobileAndroid,_isInMySbis:l.isInMySbis(),_isNonSafaryAndNonMobile:!o.safari&&!o.isMobilePlatform,_isNonBilling:!n.modules["Биллинг"],name:"SendMessage",clearAfterSend:true,dialogID:null,messageID:null,receivers:[],showButtons:{show:true,dialog:true,attachFile:true,task:true,history:true,editortools:true,link:false,New:true,dosend:true,smile:true,signature:false,approve:false,mention:false},expandableButtons:null,visibleSignatureBtnOnAttach:true,visibleWhomField:false,showPopupOnSendMsg:true,isChat:false,folderId:null,saveNotSendText:false,documentDetails:{},placeholder:rk("Введите ФИО..."),placeholderMore:void 0,showOptLastThemes:false,doSendNewDialog:false,isNewTheme:false,focusOnSuggest:false,isInviteTheme:false,isEmptySend:false,maxHeight:400,visibleTabsInAdresseeChoice:{companies:!n.modules["Биллинг"],employees:!n.modules["Биллинг"],myContacts:true,findContacts:true,groups:false},visibleContainerPreSend:true,hasBuffer:!n.modules["Биллинг"],hasVideoMessage:true,isNeedSaveToHistory:true,tooltip:rk("Введите сообщение..."),filesDropElement:"",needCheckMyCircle:false,blObjectSettings:null,handlers:{onOpenDictionary:null},fastRender:false},_isAfterShowCalled:false,_newFilesArr:[],_addresseesArr:[],_foreignPersons:[],_updateForeignPersons:false,_functionsCommon:l,_isReadyBTR:false,_isNeedSaveToHistory:true,_containers:{editScroller:null,editScrollee:null,rcvAndBtns:null},_editorToolsActivate:false,_isSend:false,_isCanCreateTask:null,_checkAvailableMethodInProgress:false,_iLogger:i.resolve("ILogger"),_containerPreSend:null,_needMoveFocusToRichEditor:false,_isUpdatingNotSendText:false},$constructor:function(){if(this._publish(["onButtonClick","onSaveToHistory","onAfterSend","onAfterResetViewer","onTaskAppended","onChangeAddressees","onErrorSend","onFocusInRichEditor"]),this._options.hiddenTabsInDialogAddresseeChoice)i.resolve("ILogger").error("SBIS3.Contacts.SendMessageInternal._options.hiddenTabsInDialogAddresseeChoice","опция, удалена в 3.17.310, используйте опцию visibleTabsInAdresseeChoice")},_modifyOptions:function(){var e=w.superclass._modifyOptions.apply(this,arguments);return this._prepareOptions(e),e},init:function(){w.superclass.init.call(this),this.subscribeTo(this,"onInit",function(){this._isNeedSaveToHistory=this._options.isNeedSaveToHistory;var e=this,i=e._getAttachmentButton(),s=e._getWhomField(),r=e._getEditor(),a=e._getSelectorButton();if(i)i._onFinish=e._onFinishAttachment.bind(e);if(e._prepareOnInit(),e.subscribeTo(s,"onChange",e._handlerChangeWhomField),e.subscribeTo(r,"onFocusIn",function(){e._needMoveFocusToRichEditor=false}),!o.isMobilePlatform)e.subscribeTo(r,"onFocusOut",function(n,i,s){if(!i&&s&&"attachments"===s.getName()&&t.instanceOfModule(s,"SBIS3.CONTROLS/Tree/CompositeView"))e._needMoveFocusToRichEditor=true,e.subscribeOnceTo(s,"onFocusOut",function(){e.subscribeOnceTo(s,"onFocusIn",function(){setTimeout(function(){if(e._needMoveFocusToRichEditor)e._needMoveFocusToRichEditor=false,e.moveFocusToEditor()},200)})})});if(e.subscribeTo(e,"onBeforeShow",e._handlerOnBeforeShow),e.subscribeTo(e,"onAfterShow",e._handlerOnAfterShow),e.subscribeTo(e,"onResize",e._handlerOnResize),r.getContainer().bind("keyup",function(t){if(t.altKey&&t.keyCode==n.key.down&&e._options.showButtons["history"]){var i=e._getHistoryButton(),s=e._getRichEditorToolbar(),o=i?i.getItems():null,a=o?o.getCount():null;if(i&&s&&!i.isPickerVisible()&&a){if(1===a){var l=o.at(0),c=l?l.get("value"):"";if(c)return void r.setText(c)}if(!s.getExpanded()&&!i.isVisible())i.setVisible(true);i.showPicker(),e._onHistoryActivated()}}}),a)e.subscribeTo(a,"onSelectedItemsChange",e._handlerSelectorButtonReset.bind(this))})},addReceiver:function(e){var n=this,i,s="null"!==n._options.receivers?n._options.receivers:[];if(t.instanceOfModule(e,"WS.Data/Entity/Model"))i=e.get("Персона");else i=e;if(-1==$.inArray(i,s))if(s.push(i),n._options.visibleWhomField)n.setResend(s);else n.setReceivers(s)},clear:function(e,t,n){if(!e&&this._getDocumentGUID())this._options.documentDetails={};var i=this,o=n?s.success():i._deleteNotSendFiles();if(i.clearContentForSend(),t){var r=i._getWhomField();if(r&&r.isVisible())i.setResend([]);else i.setReceivers([]),i._clearSelectorButton()}return o},clearContentForSend:function(){var e=this,t=e._getEditor(),n=e._getFilesDocView();if(t.getText())if(t.setText(""),e._isReadyBTR&&e._options.clearAfterSend)if(t.setCursorToTheEnd(),o.firefox&&!e._options.moveFocusOutOfRichEditor)t.setActive(true);if(e._getSaveNotSendText())e._clearNotSendMessage();if(e._isNewFilesAttached())if(e.getContainer().find("#attachmentsWrapper").css("display","none"),e._notifyOnSizeChanged(),n)n.clear();e._newFilesArr=[],e._togglePanelDetailsMainButtons()},currentMinimalHeight:function(){return this._options.visibleContainerPreSend?98:50},deleteNotSendFiles:function(){return this._deleteNotSendFiles()},getInformation:function(){var e=this,t=e._getFilesDocView(),n=e._getEditor(),i=[];if(t)t.each(function(t){i.push({"Тема":e._getDialogID(),"ИдФайла":t.get("attachId"),"ИдВерсии":t.get("disk_version_id"),"Название":t.get("fileName"),"Размер":t.get("size"),"ЭтоСсылка":t.get("disk_is_link")})});return{receivers:e._getReceivers(),text:n.getText(),files:i}},getInformationForSubscribe:function(){var e=this,t=e._getReceivers(),n=e._getDialogID(),i=e._getMessageID(),s=e.getText();if(s&&0!==s.indexOf("&re_"))s=l.getStringWithCrc32Pref(s);return{opener:e,msgText:s,messageGUID:i,themeGUID:n,docGUID:e._getDocumentGUID(),files:e._newFilesArr,filesRedaction:e._getFilesRedaction(),persons:t,folderId:e._options.folderId,isChat:e._options.isChat,documentType:e._getDocumentType(),allReceiversTheme:!e._options.isChat&&0==t.length}},getMaximalHeight:function(){return this._options.maxHeight},getScrolledContentHeight:function(){if(!this._containers.editScroller)this._containers.editScroller=this.getContainer().find(".rich-editor .rich-editor__scrollContainer");if(!this._containers.editScrollee)this._containers.editScrollee=this._containers.editScroller.children();var e=this._containers.editScrollee.length?this._containers.editScrollee[0].scrollHeight:0;if(0!==e){var t=this._getDeductingHeight(),n=this.getContainer().innerHeight();return e<n-t?n:e+t}else return 0},getReceiversInfo:function(){return this._getAddresseesArr()},getText:function(){var e=this._getEditor(),t=e&&e.getText?e.getText():"";if(t){var n=["message-block","contacts-ThemeMessage-description-container","contacts-ThemeMessage-column","contacts-person-photo","message-time-date","contacts-ThemeMessage-row-content","message-wrapper","message-text","person-thin-name","contacts-ThemeMessage__title","grey-text","person-photo"],i;t=(t=t.replace(/(<[^>]*?) data-component=["'].+?["']([^>]*>)/gim,"$1 $2")).replace(/(<[^>]*?) id=["'].+?["']([^>]*>)/gim,"$1 $2")}if(!t.replace(/(<p>|<\/p>|<br>|<br\/)/g,"").trim())t="";return t?t.replace(/<([^>]+)\s(on\S+\s*=)(.)([^>]+)*>/gm,"<$1 _$2$3$4>"):""},isActiveRichEditor:function(){return this._getEditor().isActive()},isAfterShowCalled:function(){return this._isAfterShowCalled},isContentJustText:function(){var e=this,t=e.getChildControlByName("БогатыйРедакторСообщение"),n=t?!!t.getText().trim():false,i=e._isNewFilesAttached();return n&&!i},isContentSendMessage:function(){var e=this,t=e.getChildControlByName("БогатыйРедакторСообщение"),n=t?!!t.getText().trim():false,i=e._isNewFilesAttached();return n||i},isResend:function(){return this._getWhomField().isVisible()},hideResend:function(){var e=this,t=e._getWhomField();if(e.isResend())t.setVisible(false),t.hideSuggest(),t.dropAllLink(),e.setReceivers([])},moveFocusToWhomField:function(){var e=this,t=e._getWhomField();if(setTimeout(function(){if(o.isMobileSafari||o.isMobileAndroid||o.safari)t.setTabindex(3);else e._setTabIndexToEditor()},400),t)t.setActiveFieldLink(true)},isShowButton:function(e){return this._options.showButtons.hasOwnProperty(e)&&this._options.showButtons[e]},isToolbarButton:function(e){return this._options.expandableButtons&&this._options.expandableButtons.hasOwnProperty(e)&&"boolean"===typeof this._options.expandableButtons[e]},isExpandableButton:function(e){return this.isToolbarButton(e)&&this._options.expandableButtons[e]},reloadButtons:function(e){var t=this._getButtons(),n=this._getRichEditorToolbar(),i=this._options.showButtons,s=this._options.expandableButtons,o=n?n.getExpanded():false,r=function(e,t){return e.hasOwnProperty(t)&&("boolean"===typeof e[t]?true:e[t])};if(!s)this._log("info","The option [expandableButtons] not initialized. The [reloadButtons] method call was aborted.");for(var a in e)if(r(e,a)&&r(t,a)){var l=t[a],c=e[a],d=typeof c;if("object"===d||"boolean"===d){var u=this.isShowButton(a),h=this.isExpandableButton(a),g="object"===d?"boolean"===typeof c.show?c.show:u:!!c,f="object"===d?"boolean"===typeof c.expandable?c.expandable:h:h;if(g!=u)i[a]=g;if(f!=h&&"show"!=a)s[a]=f;var _=l.isVisible(),p=this.isShowButton(a)&&(!this.isExpandableButton(a)||o);if(_!==p||"mention"===a&&p)l.setVisible(p);if(this.isToolbarButton(a)&&"show"!=a)l._options.basic=!this.isShowButton(a)?true:!this.isExpandableButton(a)}else this._log("info","An incorrect data set was sent for [reloadButtons] method. Incorrect value:",c,"for ",a)}},removeReceiver:function(e){var n=this,i,s=n._getReceivers(),o;if(t.instanceOfModule(s,"WS.Data/Entity/Model"))i=e.get("Персона");else i=e;if(o=$.inArray(i,s),-1!==o)s.splice(o,1),n.setReceivers(s)},sendMessageWithCheckParams:function(){return this._sendMessage()},setDialog:function(e,t){var n=this,i=n._getWhomField(),s=n._getDialogID(),o=i&&n._options.visibleWhomField,r=n._setDialogID(e);if(n._setMessageID(t),s&&s!=e)if(o)i.dropAllLink();if(o)i._options.themeGUID=e;return r},setDocument:function(e,t,n){var i=this,s=i._getWhomField();if(void 0===n)n=true;i._options.documentDetails["docGUID"]=e,i._options.documentDetails["docType"]=t,i._options.documentDetails["canSign"]=n,s.setDocumentGUID(e),i._setVisibleInvisibleSignButton()},setEnabledWhomIcon:function(e){var t=this,n=t._getWhomField();if(n)if(n.setOnlyDialogMembers(!e),t._options.visibleWhomField&&!t.isEnabled())n.setAddresseesButtonEnabled(false)},setEnabled:function(e){if(w.superclass.setEnabled.call(this,e),e)this._togglePanelDetailsMainButtons()},setGoActionFlag:function(e){this.getContext().setValue("actionOnGo",e)},setMaximalHeight:function(e){if(!this._containers.editScroller)this._containers.editScroller=this.getContainer().find(".rich-editor .rich-editor__scrollContainer");var t=this,n=this._containers.editScroller&&"none"!=this._containers.editScroller.css("max-height")?parseInt(this._containers.editScroller.css("max-height").split("px")[0]):0;if(t._options.maxHeight=e,!I(this._containers))if(0==e){if(n)this._containers.editScroller.css("max-height","none"),t._notifyOnSizeChanged()}else{var i=e-this._getDeductingHeight();if(n!=i)this._containers.editScroller.css("max-height",i),t._notifyOnSizeChanged()}},_getDeductingHeight:function(){var e=this.getContainer(),t=Math.abs(e.height()-e.innerHeight());if(!this._containers.rcvAndBtns)this._containers.rcvAndBtns=e.find("#receiversAndButtons");return Math.max(this._containers.rcvAndBtns.innerHeight(),this._containers.rcvAndBtns.outerHeight(),this._containers.rcvAndBtns.height())+t},setOptionIsNewTheme:function(e){var t=this;if(t._options.isNewTheme=e,t._getReceivers().length&&!e)t._updateForeignPersons=true;t._togglePanelDetailsMainButtons()},setPlaceholder:function(e,t){var n=this,i=n._getWhomField();if(n._options.placeholder=e,n._options.placeholderMore=t||e,i)i.setPlaceholder(e,t)},getReceivers:function(){return this._getReceivers()},setReceivers:function(e){var n=this;if(t.instanceOfModule(e,"WS.Data/Collection/List")){var s=[];e.each(function(e){s.push(e.get("Персона"))}),n._options.receivers=s,n._addresseesArr=e.toArray(),n._togglePanelDetailsMainButtons().addCallback(function(){n._setTextNotSendToRichEditor()})}else if(n._enableSendButton(false),n._options.receivers=e,n._updateForeignPersons=true,e.length){var o=n._addresseesArr.length?n._addresseesArr[0]:null,r=o?o.get("Персона"):null,a=false;if(-1==e.indexOf(r))a=true;if(!n._addresseesArr.length||a)n._getFistReceiverClient(e[0]).addCallbacks(function(e){e=e.getAll(),n._addresseesArr=new T(e).toArray(),n._togglePanelDetailsMainButtons().addCallback(function(){n._setTextNotSendToRichEditor()})},function(e){i.resolve("ILogger").error(e)});else n._togglePanelDetailsMainButtons().addCallback(function(){n._setTextNotSendToRichEditor()})}else n._addresseesArr=e,n._togglePanelDetailsMainButtons()},setResend:function(e,n){var s=this,o=s._getWhomField();if(!(o?o.isVisible():false))o.setVisible(true),o.setActive(true);if(n)s._existingPersons=n;if(e&&t.instanceOfModule(e,"WS.Data/Collection/List"))o.setSelection(e),s.moveFocusToEditor();else if(e instanceof Array&&e.length){var r=new d({endpoint:"Персона",idProperty:"Персона"}),a=s._getNotExistsPersons(e),l=a.rsRightPersons,c=a.personsNeedMoreInfo,u=function(e){if(e)o.setSelection(e),s.moveFocusToEditor();else s.setReceivers([])};if(c.length)r.call("ПодробнаяИнформация",{"Персоны":c,"ДляДокумента":false,"ПроверитьЧерныйСписок":true}).addCallbacks(function(e){var t=e?e.getAll():null;t.prepend(l),u(t)},function(e){i.resolve("ILogger").error(e)});else u(l)}else o.dropAllLink(),s.setReceivers([])},setShowOptLastThemes:function(e){this._options.showOptLastThemes=!!e,this._getWhomField().setShowOptLastThemes(!!e)},setVisibleContainerPreSend:function(e){var t=this,n=t._getWhomField();if(t._options.visibleContainerPreSend!=e){if(t._options.visibleContainerPreSend=e,!t._containerPreSend)t._containerPreSend=t.getContainer().find(".container-pre-send");return t._containerPreSend[e?"removeClass":"addClass"]("ws-hidden"),n.setVisible(e),true}else return false},_isMethodAvailable:function(e,t){var n=this,o=new s;if(!n._checkAvailableMethodInProgress){var r=new d({endpoint:"ПроверкаПрав"});n._checkAvailableMethodInProgress=true,r.call("ДоступностьМетода",{"ИмяМетода":e,"ЧислоАргументов":t}).addCallbacks(function(e){n._checkAvailableMethodInProgress=false,o.callback(e.getScalar())},function(e){n._checkAvailableMethodInProgress=false,i.resolve("ILogger").error(e)})}return o},setVisibleUnVisibleButtons:function(e){this._log("error","Method [setVisibleUnVisibleButtons] is deprecated and will removed after 3.7.5.30 Use method [reloadButtons] instead. See https://wi.sbis.ru/docs/SBIS3/Contacts/SendMessageInternal/methods/reloadButtons/ for details.")},updateWhomReceivers:function(){this._getWhomField().resetFilter(true)},_onFireSaveToHistory:function(e,t){var n=this._getEditor().getText();if(false!=this._notify("onSaveToHistory",n,this._isNeedSaveToHistory)&&this._isNeedSaveToHistory)this._updateHistory()},_onActivatedToolbarButton:function(e,t){var n=this,i=e.getTarget(),s=i&&i.getName(),o={dialog:n._dialogButtonHandler.bind(n),signature:n._signatureButtonHandler.bind(n),task:n._taskButtonHandler.bind(n)};if("function"===typeof n._notifyOnButtonClick)if(false!=n._notifyOnButtonClick(s)&&s&&o.hasOwnProperty(s)&&"function"===typeof o[s])o[s].apply(n,arguments||[])},_dialogButtonHandler:function(e,t){var n=this;require(["js!SBIS3.Contacts.MessagePanel"],function(e){var t={parent:n,themeGUID:n._getDialogID(),messageGUID:n._getMessageID(),restrictedActions:{isHiddenDeleteDialog:true}};e.open(t)})},_signatureButtonHandler:function(e,t){var n=this._getToolbarButton("signature");this.unsubscribeFrom(n,"onMenuItemActivate"),this.subscribeOnceTo(n,"onMenuItemActivate",this._onMenuItemActivateSignature.bind(this))},_taskButtonHandler:function(e,t){this.moveFocusToBtnAttach()},_onReglamentChoiceHandler:function(e,t){var n=this,i=this._getTaskButton().getChildControlByName("task").getItems();n._isHavePermissionForAction("createTask").addCallback(function(e){if(!n.isActionOnGo()&&e){var s=n._getEditor(),o="",r=n._addresseesArr;if(n._toggleActionButtonsEnabled(false),s)o=s.getText().trim();var a=r[0],l=function(){var e=a.get("Персона");if(e&&i){var s=n._getDocumentGUID(),l=i.getRecordById(t),c=l.get("Идентификатор");require(["js!SBIS3.EDO.DocflowRulesHelpers"],function(t){if(!t.ruleIsFolder(l))n._createTask({comment:o,docId:s,ruleId:c,addresseeArr:r,rec:a,personID:e});else n._toggleActionButtonsEnabled(true)})}};if(n.getReceivers().length>1)y.showConfirmDialog({opener:n,positiveButton:{caption:rk("Создать")},message:[rk("Извините, но создание задачи для нескольких исполнителей из сервиса обмена сообщениями невозможно. Ваша задача будет отправлена первому адресату - это"),n._functionsCommon.getFIOFromRecBP(a)].join(" ")+"."},function(){l()},function(){n._toggleActionButtonsEnabled(true)});else l()}})},_createTask:function(e){var t=this,n=t._getDialogID(),s={"Исполнители":[e.personID],"Комментарий":e.comment,"Тема":n?n:null,"ИдДокумента":e.docId,"ИдРегламента":e.ruleId,"Файлы":t._newFilesArr},o=new d({endpoint:"Персона"}),r=t._functionsCommon,a,c;t._isSend=true,B.setMessage("Создание задания"),o.call("СДатьЗаданиеСФайлами",s).addCallbacks(function(i){if(i=i.getAll(),B.destroy(),t._toggleActionButtonsEnabled(true),t._cleanAfterSend(),a=i.at(0),a){if(!e.docId)t.setDocument(a.get("Идентификатор"),a.get("ТипИД"));t._notify("onTaskAppended",a),C.channel("MessageListActions").notify("onCreateTask",a,n),C.channel("TasksChannel").notify("onCreateSubTask",{"Задача":a,"Тема":n})}r.popupInformerShow(rk("Задание успешно создано"),c,"info",3e3),t._isSend=false},function(e){B.destroy(),l.alert(rk("Не удалось создать задачу:")+" "+e.message),i.resolve("ILogger").error("Не удалось создать задачу",e.details),t._toggleActionButtonsEnabled(true),t._isSend=false})},_onMenuItemActivateSignature:function(e,t){var n=this,i=n.getInformationForSubscribe(),s=n._getFilesDocView(),o=[];n._isHavePermissionForAction("signFiles").addCallback(function(e){if(e){switch(t){case"Подписать":i["serviceType"]="just_sign";break;case"ЗапроситьПодпись":i["serviceType"]="for_first_sign";break;case"ПодписатьИЗапроситьПодпись":i["serviceType"]="for_sign";break;default:return}if(s)s.each(function(e){o.push({"Файл":e.get("msgFileId"),"ДискИдВерсии":e.get("redactionId")})});n._toggleActionButtonsEnabled(false),n._isSend=true;var r=n.consume("signFiles",{messageParams:i,files:o})[0];if(r&&r.executed)r.result.addCallbacks(function(e){if("just_sign"==i.serviceType){var t=n._getAttachmentsSendMessage()?n._getAttachmentsSendMessage().getTreeView().getItems():null,o=function(e){if(e&&e.getCount())for(var t=0;t<i.files.length;t++){var n=e.getIndexByValue("msgFileId",i.files[t]);if(-1!==n)l.fillMySignData(e.at(n))}};if(t)o(t);o(s),n._toggleActionButtonsEnabled(true)}else{if(!e.getCount())n._toggleActionButtonsEnabled(true);n._cleanAfterSend()}n._isSend=false,n.moveFocusToEditor()},function(){n._isSend=false,n._toggleActionButtonsEnabled(true)});else n._isSend=false,n._toggleActionButtonsEnabled(true)}})},_log:function(e,t,n){var i=("string"===typeof n?n:"")||"SBIS3.Contacts.SendMessageInternal";if(t&&"string"===typeof t&&("log"===e||"info"===e||"error"===e)&&"function"===typeof this._iLogger[e])this._iLogger[e](i,t);else if(e&&"string"===typeof e)this._iLogger.log(i,e)},_updateHistory:function(e){var t=this._getEditor(),n=this._getHistoryButton(),i=n?n.getItems():null,s=e||t.getText()||"",o=[],r=function(e){var t,n,i=$("<div/>").append(e);if(t=n=v.escapeHtml(i.text()),t=t.replace("/\n/gi","").replace(/{/g,"&#123;").replace(/}/g,"&#125;"),!t&&e)t=rk("Контент содержит только html-разметку, без текста.");else if(t&&t.length>140)t=t.substr(0,140)+" ...";return t};if(!this._options.showButtons["history"]||!this._isNeedSaveToHistory||!s)return;if(o.push({key:0,title:r(s),value:s}),i)for(var a=0;a<i.getCount();a++){var l=i.at(a);if(l.get("title")==o[0].title&&l.get("value")==o[0].value)return;o.push({key:a+1,title:l.get("title"),value:l.get("value")})}if(o.length>10)o.splice(10,1);if(!i||0===i.getCount())n.setEnabled(true);n.setItems(o),t.saveToHistory(s)},_checkTextOnAllowQuote:function(){return!!this.getText().trim()},_cleanAfterSend:function(){var e=this;if(e._options.clearAfterSend)e.clearContentForSend(),e.setGoActionFlag(false),e._setMessageID(null);else{if(e._getSaveNotSendText())e._clearNotSendMessage();e._newFilesArr=[]}},_clearSelectorButton:function(){var e=this,t=e._getSelectorButton();if(t&&t.isVisible())e.getLinkedContext().setValue({recipientName:null,recipientId:null})},_clearNotSendMessage:function(){var e=this,t=e._options.receivers;if(!t.length)return;e._isUpdatingNotSendText=true,l.getCorrespondenceFilterValue("ОбъектПоследнегоНеотправленногоСообщения").addCallbacks(function(n){if(e._isInReceiversAtJson(n,t).inReceivers)l.setCorrespondenceFilterValue("ОбъектПоследнегоНеотправленногоСообщения",JSON.stringify({})).addCallback(function(){e._isUpdatingNotSendText=false})},function(e){i.resolve("ILogger").error(e)})},_deleteNotSendFiles:function(){var e=this,t=new s;if(e._newFilesArr&&e._getDialogID())t=e._deleteAttachedFiles(e._newFilesArr);else t.callback();return t},_enableSendButton:function(e){var t=this,n=t._getSendButton(),i=t._getNewButton(),s=t._getApproveButton();if(t.isDestroyed())return;n.setEnabled(e),t._setEnableTaskButton(e),i.setEnabled(e),s.setEnabled(e)},_setEnableTaskButton:function(e){var t=this,n=t._getTaskButton();if(n&&e!==n.isEnabled())if("boolean"===typeof t._isCanCreateTask)n.setEnabled(e&&t._isCanCreateTask);else this._isMethodAvailable("СлужЗап.Создать",1).addCallback(function(i){t._isCanCreateTask=i,n.setEnabled(e&&t._isCanCreateTask)})},_fixButtonsFocus:function(){var e=this._getButtons();for(var t in e)if(e.hasOwnProperty(t)&&e[t])e[t].getContainer().on("mousedown focus",function(e){e.preventDefault()})},_getAddresseesArr:function(){return this._addresseesArr},_getAllowedActions:function(){var e=this,t=e._getEditor(),n=e._getAddresseesArr(),i=e._options.isChat,o=t&&e._checkTextOnAllowQuote(),r=i?true:n&&n.length?true:false,a=e._isNewFilesAttached(),l=r?n[0]:void 0,c=new s,d=function(){if(l){var t=parseInt(e._getClientIdFromRecord(l),10);return!isNaN(t)&&t===A.get("ИдентификаторКлиента")}return false},u=function(){var t=e.getText();c.callback({isAllowSend:o||a&&b.isAllowSendMessageByAttach(t)||(e._options.isInviteTheme||e._foreignPersons.length>0&&(!e._options.isNewTheme||e._getDocumentGUID()))&&e._options.isEmptySend,allowCreateTaskObj:{isHaveTextMessage:o&&!e._isRestrictedContent(),isUserFromSameClient:d()},isAllowApprove:e._getReceivers().length>0,isHaveAddressees:r})};if(!e._updateForeignPersons&&!e._options.isChat)u();else e._updateForeignPersons=false,e._getForeignPersons().addCallback(function(){u()});return c},_getButtons:function(){var e=this;return{dialog:e._getDialogButton(),attachFile:e._getAttachmentButton(),task:e._getTaskButton(),editortools:e._getStylesButton(),link:e._getLinkButton(),New:e._getNewButton(),dosend:e._getSendButton(),signature:e._getSignatureButton(),history:e._getHistoryButton(),smile:e._getSmileButton(),approve:e._getApproveButton(),show:e._getShowButton(),mention:e._getMention()}},_getClientIdFromRecord:function(e){var n=void 0;if(t.instanceOfModule(e,"WS.Data/Entity/Model"))n=e.get("Клиент")?e.get("Клиент"):e.get("КлиентЛицо")?parseInt(e.get("КлиентЛицо").split("/")[0],10):void 0;return n},_getDocumentCanSign:function(){return this._options.documentDetails.hasOwnProperty("canSign")?this._options.documentDetails.canSign:true},_getDocumentGUID:function(){return this._options.documentDetails.hasOwnProperty("docGUID")&&"null"!=this._options.documentDetails.docGUID?this._options.documentDetails.docGUID:null},_getDocumentType:function(){return this._options.documentDetails.hasOwnProperty("docType")?this._options.documentDetails.docType:null},_getFistReceiverClient:function(e){return new d({endpoint:"Персона"}).call("ПодробнаяИнформация",{"Персоны":[e],"ДляДокумента":null,"ПроверитьЧерныйСписок":false})},_getForeignPersons:function(){var e=this,t=e._getReceivers(),n=new s;if(t.length){if(!e._options.isChat)e._foreignPersons=t;n.callback()}else e._foreignPersons=[],n.callback();return n},_getMessageID:function(){return this._options.messageID&&"undefined"!==this._options.messageID?this._options.messageID:null},_getNotExistsPersons:function(e){var t=this._existingPersons,n=["Фамилия","Имя","Клиент","КлиентНазвание","КлиентИдентификаторСПП","КлиентИНН","Должность","Отдел","ОргПодтверждена","Активность","ПоследняяАктивность"],i=[],s=[],o=new c({items:[]});if(t)for(var r=0;r<e.length;r++){var a=e[r],l=t.getIndexByValue("Персона",a);if(-1==l)i.push(a);else{for(var d=t.at(l),u=true,h=0;h<n.length;h++)if(!d.has(n[r])){u=false;break}if(u)s.push(d);else i.push(d.get("Персона"))}}else i=i.concat(e);return o.prepend(s),{rsRightPersons:o,personsNeedMoreInfo:i}},_getReceivers:function(){var e=this;return"null"!==e._options.receivers?e._options.receivers:[]},_getRichEditorToolbar:function(){return this.hasChildControlByName("RichEditorRoundToolbar")?this.getChildControlByName("RichEditorRoundToolbar"):null},_getSaveNotSendText:function(){return this._options.saveNotSendText},_getWhomField:function(){return this.hasChildControlByName("WhomFieldReSend")?this.getChildControlByName("WhomFieldReSend"):null},_getToolbarButton:function(e){var t=this._getRichEditorToolbar(),n=t?t.getItems():null;return n&&n.getRecordById(e)?t.getItemInstance(e):null},_getToggleButton:function(){return this._getToolbarButton("toggle")},_getSmileButton:function(){return this._getToolbarButton("smile")},_getDialogButton:function(){return this._getToolbarButton("dialog")},_getTaskButton:function(){return this._getToolbarButton("task")},_getStylesButton:function(){return this._getToolbarButton("styles")},_getLinkButton:function(){return this._getToolbarButton("link")},_getMention:function(){return this._getToolbarButton("mention")},_getSignatureButton:function(){return this._getToolbarButton("signature")},_getShowButton:function(){return this._getToolbarButton("toggle")},_getHistoryButton:function(){return this._getToolbarButton("history")},_getApproveButton:function(){return this.hasChildControlByName("Approve")?this.getChildControlByName("Approve"):null},_getNewButton:function(){return this.hasChildControlByName("New")?this.getChildControlByName("New"):null},_getSelectorButton:function(){return this.hasChildControlByName("Recipient")?this.getChildControlByName("Recipient"):null},_onHistoryActivated:function(e){var t=this._getHistoryButton();if(t&&t._picker){if(t._picker._options.ignoreTabCycles=false,this.subscribeTo(t._picker,"onKeyPressed",this._onHistoryKeyPressed.bind(this)),!t.isPickerVisible())this.subscribeOnceTo(t._picker,"onShow",this._onHistoryShow);else this._onHistoryShow.call(t._picker);this.subscribeOnceTo(t._picker,"onClose",this._onHistoryHide.bind(this))}},_onHistoryKeyPressed:function(e,t){var i=this._getHistoryButton();if(t.which==n.key.up||t.which==n.key.down)t.shiftKey=t.which==n.key.up,t.stopImmediatePropagation(),t.preventDefault(),i._picker.moveFocus(t);else if(t.which==n.key.esc)i.hidePicker()},_onHistoryShow:function(e){this.activateFirstControl()},_onHistoryHide:function(e){var t=this._getHistoryButton(),n=this._getRichEditorToolbar();if(t&&n){if(!n.getExpanded()&&t.isVisible()&&!t._options.basic)t.setVisible(false);this.unsubscribeFrom(t._picker)}this.moveFocusToEditor()},_handlerOnExpandedChange:function(e,t){},_handlerChangeWhomField:function(e,t,n,i,s){var r=this,a=r.getParent(),l=[],c=a._foreignPersons.slice();if(0==t.getCount())return a._options.receivers=[],a._addresseesArr=[],a._foreignPersons=[],a._updateForeignPersons=false,a._togglePanelDetailsMainButtons(),r.consume("cancelReplyMsg"),void a._notify("onChangeAddressees",null);if(t.each(function(e){var t=e.get("Персона");if(-1===l.indexOf(t))l.push(t)}),r.consume("correctReplyingMsg",l),c.length){if(i.length){for(var d=0;d<c.length;d++)if(-1!=i.indexOf(c[d])){var u=a._foreignPersons.indexOf(c[d]);a._foreignPersons.splice(u,1)}if(!a._foreignPersons.length&&(!a._options.isNewTheme||a._getDocumentGUID()))a._updateForeignPersons=true}}else if(n.length&&(!a._options.isNewTheme||a._getDocumentGUID()))a._updateForeignPersons=true;if(a._addresseesArr=new T(t).toArray(),a.setReceivers(l),a._getWhomField().hideSuggest(),o.isMobilePlatform)a._getEditor()._options.focusOnActivatedOnMobiles=true;if(a.moveFocusToEditor(),a._isSelectDepartment=false,s.each(function(e){if(0==e.get("Персона").indexOf("000000"))a._isSelectDepartment=true}),(o.isMobileSafari||o.isMobileAndroid||o.safari)&&3!=r.getTabindex())r.setTabindex(3);a._notify("onChangeAddressees",t,n,i,s)},_handlerDestroy:function(){var e=this,t=e._getAttachmentButton(),i=e._getEditor();if(e._deleteNotSendFiles(),t)e._handlerAttachDestroy();if(e._containers)e._containers={};if(e._functionsCommon=null,e._sendButton)e._sendButton=null;if(i&&i.getContainer())i.getContainer().unbind("keyup");if(n.$win.unbind("beforeunload",e._beforeUnload),e._containerPreSend)e._containerPreSend=null},_handlerSelectorButtonReset:function(e,t){if(t=t||[],!t.length){this._getWhomField().dropAllLink(),this._options.messageID=null;var n=this._getSelectorButton();if(n&&n.isVisible())this.getLinkedContext().setValue({recipientName:null,recipientId:null})}},_handlerOnChangeFormat:function(){},_handlerFocusNeedToBeMovedOut:function(){this.getParent().moveFocusToEditor()},_handlerNeedMoreSpace:function(e,t){var n=this.getParent()._getToggleButton();if(n.isVisible())n.setExpand(!t)},_handlerOnAfterShow:function(){var e=this;e._isAfterShowCalled=true,e.getContainer().find("#showButtons").first().on("mousedown focus",function(e){e.preventDefault()}),e._fixButtonsFocus(),e.setMaximalHeight(this._options.maxHeight);var t=e._getHistoryButton();if(t)e.subscribeTo(t,"onActivated",e._onHistoryActivated.bind(e));if(e._options.handlers.onOpenDictionary&&"function"==typeof e._options.handlers.onOpenDictionary){var n=e._getWhomField();if(n)e.subscribeTo(n,"onOpenDictionary",e._options.handlers.onOpenDictionary.bind(e))}},_handlerOnBeforeShow:function(){var e=this,t=e._getWhomField(),n=e._getEditor(),i=e._getRichEditorToolbar();if(!e._options.fastRender)e.getContainer().css("visibility","inherit");e.subscribeTo(t,"onClickLatestThemes",e._handlerOnRefreshParent),e.subscribeTo(t,"onError",e._handlerOnErrorWhomField),e.subscribeTo(t,"onFocusNeedToBeMovedOut",e._handlerFocusNeedToBeMovedOut),e.subscribeTo(n,"onFormatChangeFireKey",e._handlerOnChangeFormat.bind(e)),e._checkIsDev=l.checkIsDemo(),i.setLinkedEditor(n),e.subscribeTo(i,"onExpandedChange",e._handlerOnExpandedChange.bind(e))},_handlerOnErrorWhomField:function(e,t){var n=this.getParent(),s=i.resolve("ILogger");if(n.moveFocusToEditor(),t&&(t.hasOwnProperty("message")||t.hasOwnProperty("details")))s.error(t.message,t.details);else s.error("error",t)},_handlerOnInitEditor:function(){this.getParent()._isReadyBTR=true},_handlerOnRefreshParent:function(e,t){var n=this.getParent();n._notify("onRefreshLatestThemes",t),n.moveFocusToEditor()},_handlerOnResize:function(){},_handlerValueChangeRichEditor:function(e,t){var n=this,i=n.getParent(),s=i.getContainer(),o=!!t,r=n.getLinkedContext().getValue("isStateTriggered")!==o;if(!i.isDestroyed())i.consume("changeContextQuery",{context:"textEntered"});if(r)i.getLinkedContext().setValue("isStateTriggered",o);i._togglePanelDetailsMainButtons();var a=n.getContainer(),l=a.find(".controls-RichEditor__editorFrame"),c=s.find("#attachmentsWrapper");if(!l.length)return;if(!c.length)a.after('<div id="attachmentsWrapper"><div></div></div>')},_initButtons:function(){var e={},t=this._getButtons();if(t){for(var n in t)if(t.hasOwnProperty(n)&&t[n])if(e[n]={show:this.isShowButton(n),expandable:this.isExpandableButton(n)},this.isToolbarButton(n))this.subscribeTo(t[n],"onActivated",this._onActivatedToolbarButton.bind(this));var i=this._getTaskButton();if(i){var s=i.getChildControlByName("task");if(s)this.subscribeTo(s,"onActivated",this._onActivatedToolbarButton.bind(this)),this.subscribeTo(s,"onMenuItemActivate",this._onReglamentChoiceHandler.bind(this))}if(t.hasOwnProperty("dosend")&&t["dosend"])this.subscribeTo(t["dosend"],"onActivated",this._onFireSaveToHistory.bind(this));this.reloadButtons(e)}},_isHavePermissionForAction:function(e){var t=this,n=i.resolve("ILogger"),o=new s,r;return t._getAllowedActions().addCallback(function(i){if(!t._options.isChat&&!i.isHaveAddressees&&t._options.isNewTheme){var s;if("signFiles"==e)s="Для отправки документа на подпись выберите получателя";return t._setErrorOnWhomField(s),void o.callback(false)}switch(e){case"send":if(!i.isAllowSend)return n.error(["Ошибка при отправке сообщения.\n","Нельзя отправлять сообщения без текста или ","вложенных файлов"].join("")),void o.callback(false);break;case"createTask":if(r=i.allowCreateTaskObj,!r.isHaveTextMessage)return l.alert(rk("Для создания задания необходимо ввести текст сообщения"),t),void o.callback(false);if(!r.isUserFromSameClient)return l.alert(rk("Нельзя создавать задания контактам из другого клиента"),t),void o.callback(false)}o.callback(true)}),o},_isInReceiversAtJson:function(e,t){var n=this,i=t?t:n._getReceivers(),s=e?JSON.parse(e):{},o=s.receivers,r=s.text,a=false;if(!r||!o)return{inReceivers:false};for(var l=0;l<i.length;l++)if(-1!=$.inArray(i[l],o)){a=true;continue}return{inReceivers:a,text:r}},_isNewFilesAttached:function(){return this._newFilesArr&&0!==this._newFilesArr.length},_prepareOptions:function(e){if(e.visibleUnVisibleButtons)this._log("error","Option [visibleUnVisibleButtons] is deprecated and removed in 3.7.5.30 Use option [expandableButtons] instead. See https://wi.sbis.ru/docs/SBIS3/Contacts/SendMessageInternal/options/expandableButtons/ for details.");var t={show:false,dialog:true,editortools:false,link:false,signature:true,history:true,smile:false,task:false};if(e.expandableButtons){var n=typeof e.expandableButtons,i="string"===n?e.expandableButtons.split(","):"object"===n?e.expandableButtons:null;if(e.expandableButtons=t,i){var s;if("string"===n){for(var o=0;o<i.length;o++)if(s=i[o],e.expandableButtons.hasOwnProperty(s)&&"show"!==s)e.expandableButtons[s]=true}else if("object"===n)for(s in i)if(i.hasOwnProperty(s)&&e.expandableButtons.hasOwnProperty(s)&&"show"!==s)e.expandableButtons[s]=!!i[s]}}else if(!e.fastRender)e.expandableButtons=t},_prepareOnInit:function(){var e=this;e._togglePanelDetailsMainButtons().addCallback(function(){e._setAddresseesArr(),e._initButtons()})},_setAddresseesArr:function(){if(this._options.receivers&&this._options.receivers.length!=this._addresseesArr.length)this.setReceivers(this._options.receivers)},_setDialogID:function(e){var t=this,n=t._options.dialogID,o=n?e!=n:false,r=new s;if(t._options.dialogID=e,o&&t._newFilesArr&&t._newFilesArr.length)new d({endpoint:"Сообщение"}).call("ОткрепитьФайлОтТемы",{"Файлы":t._newFilesArr,"ТекущаяТема":n,"НоваяТема":e}).addCallbacks(function(){r.callback()},function(e){i.resolve("ILogger").error("Ошибка в методе Сообщение.ОткрепитьФайлОтТемы \n",e),r.callback()});else r.callback();return r},_setErrorOnWhomField:function(e){var t=this,n=t._getWhomField();if(e=e?e:rk("Для отправки сообщения выберите получателя"),n.isVisible())n.markControl(e),n.setActiveFieldLink(true);else t._notify("onErrorSend",{whomField:e})},_setMessageID:function(e){this._options.messageID=e},checkIsContent:function(){var e=this,t=e._getSaveNotSendText(),n=e.isContentSendMessage(),i=t&&e.isContentJustText(),o=new s;if(n)if(i){var r=e._getEditor(),a=e._getReceivers();if(a.length){var c={receivers:a,text:r.getText()};l.setCorrespondenceFilterValue("ОбъектПоследнегоНеотправленногоСообщения",JSON.stringify(c)),r.setText("")}return false}else l.askQuestion(rk("Отправить сообщение?"),rk('Чтобы продолжить редактирование, нажмите "Отмена".')).addCallback(function(t){switch(t){case true:if(e._getAddresseesArr().length||e._options.isChat||!e._options.isNewTheme){var n=e._getSendButton();if(n)n._handlerActivatedButton.call(n).addCallbacks(function(e){o.callback(true)},function(e){o.callback(false)});else o.callback(true)}else{var i=e._getWhomField(),s=rk("Для отправки сообщения выберите получателя");if(i.isVisible())i.markControl(s),i.setActiveFieldLink(true),o.callback(false);else o.errback(s)}break;case false:e.clear().addBoth(function(){o.callback(true)});break;default:o.callback(false)}});else return e._clearNotSendMessage(),false;return o},_setTabIndexToEditor:function(){var e=this,t=e._getEditor();if(!o.safari&&!o.isMobilePlatform&&t&&e._options.isNewTheme&&!e._options.focusOnSuggest&&t.getTabindex()>1)t.setTabindex(1)},_setTextNotSendToRichEditor:function(){var e=this,t=e._getEditor();if(!(t?t.getText():null)&&e._getSaveNotSendText()&&!e._isUpdatingNotSendText)l.getCorrespondenceFilterValue("ОбъектПоследнегоНеотправленногоСообщения").addCallbacks(function(n){var i=e._isInReceiversAtJson(n);if(i.inReceivers)t.setText(i.text),e.setMaximalHeight(e.getMaximalHeight()),e._togglePanelDetailsMainButtons(),setTimeout(function(){t.setCursorToTheEnd()},100)},function(e){i.resolve("ILogger").error("Ошибка в методе ПользовательскиеПараметры."+"ПолучитьЗначение\n",e)})},_setVisibleInvisibleSignButton:function(){if(!this._options.visibleSignatureBtnOnAttach)return;var e=this,t=e._getDocumentType(),n=e._getDocumentCanSign(),i=e._getSignatureButton(),s=i.isVisible(),o=e._getRichEditorToolbar().getExpanded(),r=false,a=e._getFilesDocView();if(a)a.each(function(e){if(e.get("folder@"))return void(r=true)});if((t&&2==t&&n||!r&&e._newFilesArr.length)&&e._options.visibleSignatureBtnOnAttach){if(!s)l(true)}else if(s||!o)l(false);function l(t){i._options.basic=!t,i.setVisible(t?o:false),e._options.showButtons.signature=t}},_togglePanelDetailsMainButtons:function(){var e=this,t=e._getSendButton(),n=e._getNewButton(),i=e._getTaskButton(),o=e._getApproveButton(),r=new s;return e._getAllowedActions().addCallback(function(s){var a=s.allowCreateTaskObj,l=e.isEnabled();if(t)t.setEnabled(s.isAllowSend&&l);if(n)n.setEnabled(s.isAllowSend&&l);if(o)o.setEnabled(s.isAllowApprove&&l);if(i&&i.isVisible()){var c=a.isHaveTextMessage&&a.isUserFromSameClient&&l;e._setEnableTaskButton(c)}r.callback()}),r},_toggleActionButtonsEnabled:function(e){function t(e,t,n){if(e.hasChildControlByName(t))for(var i=e.getChildControlByName(t),s=i.getContainer(),o=[s,s.find("button")],r=0;r<o.length;r++)if(o[r].length)if(n)$(o[r]).removeClass("ws-disabled"),i.setEnabled(true);else $(o[r]).removeClass("ws-enabled").addClass("ws-disabled")}var n=this,i=["Task","DoSend","New","Approve"],s;if(e){for(n.setGoActionFlag(false),s=0;s<i.length;++s)t(n,i[s],e);n._togglePanelDetailsMainButtons()}else for(n.setGoActionFlag(true),s=0;s<i.length;++s)t(n,i[s],e)}});return e.mixin(w,[u,h,g,f,_,p,m])});
//# sourceMappingURL=Internal.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Site",["Core/core-instance","Core/IoC"],function(e,s){"use strict";return{$protected:{_servicesList:{},_parentSite:null,_options:{passingMode:false}},after:{init:function(){var e=this;e.subscribeTo(e,"onDestroy",function(){e._servicesList={},e._parentSite=null})}},_handlerOnDestroy:function(e){var s=e.getTarget(),i=s.getName(),t=s.getId();if(this._servicesList&&(i||t))for(var r in this._servicesList)if(this._servicesList.hasOwnProperty(r)&&this._servicesList[r]){if(i&&this._servicesList[r].byNames[i])this._servicesList[r].byNames[i]=null;if(t&&this._servicesList[r].byIds[t])this._servicesList[r].byIds[t]=null}},_findParentSite:function(){var s=this.getParent();while(s)if(e.instanceOfMixin(s,"SBIS3.Contacts.Mixins.Services.Site")){this._parentSite=s;break}else s=s.getParent();if(null===this._parentSite)this.parentSiteNotFound=true},registerService:function(e,s,i){var t=this;if(t._options.passingMode&&null===t._parentSite&&true!==t.parentSiteNotFound)t._findParentSite();if(t._parentSite)return t._parentSite.registerService(e,s,i);if(t._servicesList[e]=t._servicesList[e]||{byNames:{},byIds:{}},s)t._servicesList[e].byNames[s]=t._servicesList[e].byNames[s]||null;else if(i)t._servicesList[e].byIds[i]=t._servicesList[e].byIds[i]||null;else throw new Error("serviceObjectName or serviceContainerId required");return true},consumeService:function(e,i,t){var r=this,n=function(e){return e&&("function"!=typeof e.isDestroyed||!e.isDestroyed())};if(r._options.passingMode&&null===r._parentSite&&true!==r.parentSiteNotFound)r._findParentSite();if(r._parentSite)return r._parentSite.consumeService(e,i,t);if(!n(r))return s.resolve("ILogger").log("Services.Site","A calling of consumeService of destroyed site detected!"),[{result:null,executed:false}];var o,l,a,u,c=r._servicesList[e],f=[],d="se"+e.charAt(0).toUpperCase()+e.slice(1),y;if(c){for(o in c.byNames)if(c.byNames.hasOwnProperty(o)){if(a=c.byNames[o],u=true,a){if(a.isDestroyed&&a.isDestroyed())u=false,a=null}else if(r.getName()===o)a=r,c.byNames[o]=a,r.subscribeTo(a,"onDestroy",r._handlerOnDestroy.bind(r));else if(r.hasChildControlByName(o))a=r.getChildControlByName(o),c.byNames[o]=a,r.subscribeTo(a,"onDestroy",r._handlerOnDestroy.bind(r));else u=false;if(y=u?"function"==typeof a[d]?a[d].bind(a)(i,t):null:null,y)f.push(y);else f.push({result:null,executed:u})}for(l in c.byIds)if(c.byIds.hasOwnProperty(l)){if(a=c.byIds[l],u=true,a){if(a.isDestroyed&&a.isDestroyed())u=false,a=null}else if(a=r.getContainer().find("#"+l),a.length)c.byIds[l]=a.wsControl(),this.subscribeTo(a,"onDestroy",r._handlerOnDestroy,r);else u=false;if(y=u?"function"==typeof a[d]?a[d].bind(a)(i,t):null:null,y)f.push(y);else f.push({result:null,executed:u})}}else return s.resolve("ILogger").info("Services.Site","No registered service ("+e+")"),[{result:null,executed:false}];return f}}});
//# sourceMappingURL=Site.module.js.map
define("html!SBIS3.Contacts.Mixins.Services.Executor.CheckReceiversLimits/CheckReceiversLimits",function(){var e=function(e){var t=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(t){for(;e.test(t);)t=t.replace(e,"&#123;&#123;$1&#125;&#125;");return t}}(),n=function(e){return e.join?e.join(""):e.toString()},o=function(e){return void 0===e?"":e&&"object"==typeof e?n(e):""+e},s="undefined"!=typeof process,i=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="contacts-check-receivers-message"> '),a=e.messageData.messageSecondRowAdditional?e.messageData.strFormat({makeChat:e.messageData.strFormat({additional:e.messageData.messageSecondRowAdditional},'<component data-component="SBIS3.CONTROLS.Link"><option name="caption">$additional$s$</option><options name="handlers"><option name="onActivated" type="function">js!SBIS3.Contacts.Mixins.Services.Executor.CheckReceiversLimits:createChatActivate</option></options></component>')},e.messageData.messageSecondRow):e.messageData.messageSecondRow;return i+=" <p>"+t(o(e.messageData.messageFirstRow))+"</p> <p>"+t(o(a))+"</p> </div>",(i=t(i))+(s&&-1!==i.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.Mixins.Services.Executor.CheckReceiversLimits/CheckReceiversLimits"}},e});
//# sourceMappingURL=CheckReceiversLimits.xhtml.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.CheckReceiversLimits",["Core/helpers/String/format","Core/Deferred","js!SBIS3.Contacts.Mixins.Services.Executor.Base","js!WS.Data/Source/SbisService","html!SBIS3.Contacts.Mixins.Services.Executor.CheckReceiversLimits/CheckReceiversLimits","css!SBIS3.Contacts.Mixins.Services.Executor.CheckReceiversLimits/CheckReceiversLimits","js!SBIS3.CONTROLS.Link","i18n!SBIS3.Contacts.Mixins.Services.Executor.CheckReceiversLimits"],function(e,t,s,i,n){"use strict";return s.mergeMixin(s,{$protected:{_options:{themeGUID:null,docGUID:null,dialogMembersCount:null},_makeChatCount:300,_makeNewsCount:800},after:{init:function(){this.register(["checkReceiversLimits"]),this.setRequiredMethods([])}},createChatActivate:function(){var e=this.getParent();e._options.messageData.resDef.callback(void 0),e.close()},seCheckReceiversLimits:function(s){var o=new t,r=this;if(!r._options.themeGUID)return{executed:false,result:null};if(!s||!s.length)return o.callback(null),{result:o,executed:true};var a=s.length+(r._options.dialogMembersCount||0),c=rk("Вы не можете отправить сообщение более чем $count$s$ пользователям."),u=rk("Для общения с таким количеством собеседников создайте новость."),l=false,C=rk("Для общения с таким количеством собеседников $makeChat$s$ или новость."),m=rk("Для общения с таким количеством собеседников $makeChat$s$ или создайте новость."),k=function(){require(["js!SBIS3.CONTROLS.Utils.InformationPopupManager"],function(t){var s=t.showMessageDialog({opener:r,parent:r,messageData:{messageFirstRow:c,messageSecondRow:u,messageSecondRowAdditional:l,strFormat:e,resDef:o},messageTemplate:n,status:"error",useConfirmButtons:true,positiveButton:{caption:rk("Продолжить")},negativeButton:{caption:rk("Отменить выбор")}});r.subscribeTo(s,"onChoose",function(e,t){o.callback(!!t)})})};if(a<=r._makeChatCount)return o.callback(null),{result:o,executed:true};else if(r._options.dialogMembersCount)new i({endpoint:"Персона"}).call("СПроверитьСредиУчастниковТемы",{"Тема":r._options.themeGUID,"Персоны":s}).addCallbacks(function(t){var s=t.getRow().getRawData();if(s.length)if(a=s.length+r._options.dialogMembersCount,a<=r._makeChatCount)o.callback(null);else{if(a>r._makeNewsCount)c=e({count:r._makeNewsCount},c);else if(c=e({count:r._makeChatCount},c),!r._options.docGUID)l=rk("преобразуйте диалог в чат"),u=m;k()}else o.callback(null)},function(e){o.errback(e)});else{if(a>r._makeNewsCount)c=e({count:r._makeNewsCount},c);else if(c=e({count:r._makeChatCount},c),!r._options.docGUID)l=rk("создайте чат"),u=C;k()}return{result:o,executed:true}}})});
//# sourceMappingURL=CheckReceiversLimits.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.PanelFirstShowHelper",["Core/core-clone","Core/IoC","js!WS.Data/Source/SbisService","js!WS.Data/Query/Query","Core/helpers/Function/debounce"],function(e,t,i,o,n){"use strict";var s=20,r=50,a=function(e){var t=e?e.getAll():null,i;if(!t||0==t.getCount()||this.view.isDestroyed())return;if(i=this.view.getFilter(),!(i["Поиск"]||i["ПоискПерсоны"])&&i["Тема"]==this.theme){this.view._pageHelpers=this.page-1,l(this.page-1,this.view,this.theme,this.keepInView);var o=this.view.getItems(),n=[];if(this.view._notify("onDataMerge",t,true),t.each(function(e){if(!o.getRecordById(e.getId))n.push(e)}),n.length&&n[0].get("Тема")==i["Тема"])o.append(n)}},l=function(n,r,l,d){if(n>=0&&!r.isDestroyed()){var h=e(r.getFilter());if(!(h["Поиск"]||h["ПоискПерсоны"])&&h["Тема"]==l){var c=new o,u=r.getDataSource(),f=new i({endpoint:u.getEndpoint(),idProperty:u.getIdProperty(),model:u.getModel(),binding:{query:u.getBinding().query}});c.where(h).limit(s).offset(n*s),f.query(c).addCallbacks(a.bind({page:n,view:r,theme:l,keepInView:d}),function(e){t.resolve("ILogger").error("loadPrevPage",e.details||e.message)})}}};return{$protected:{_options:{startWidthSendMessageVisible:false,baseComponentName:"",switchVisibilityOnLoad:false},_baseControl:null},$constructor:function(){this._publish("onContentVisualized")},after:{init:function(){var e;if(!this._options.baseComponentName||!this.hasChildControlByName(this._options.baseComponentName)||"function"!=typeof(this._baseControl=this.getChildControlByName(this._options.baseComponentName)).getBottomsideControl||"function"!=typeof this._baseControl.getViewControl)t.resolve("ILogger").error("SBIS3.Contacts.Mixins.Interface.PanelFirstShowHelper","Invalid current control or invalid value of this._options.baseComponentName");else if(!!(e=this._baseControl.getViewControl())){var i=this,o=i._baseControl.getUnderUpsideContainer();if(o.length)o=o[0];if(i._options.switchVisibilityOnLoad)o.style.visibility="hidden";i.subscribeTo(e,"onDataLoad",function(){var t=e.getFilter();if(t&&!t["Поиск"])i._baseControl.getBottomsideControl().setVisible(true),i.subscribeOnceTo(e,"onDrawItems",n(function(){if(i.isDestroyed())return;if(i._options.switchVisibilityOnLoad)o.style.visibility="visible";i._notify("onContentVisualized",i._baseControl)},50))}),i.subscribeTo(e,"onDataLoadError",function(){if(i._options.switchVisibilityOnLoad)o.style.visibility="visible"})}}}}});
//# sourceMappingURL=PanelFirstShowHelper.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.AlertTabOnMessages",["js!SBIS3.Contacts.CommonFunctions.Global","Core/helpers/string-helpers","js!SBIS3.Contacts.MessagesExchangeEvents","Core/UserInfo"],function(e,t,n,s){"use strict";return{$protected:{_options:{inWindow:false,messageGUID:null,highlightDate:false},_titleAlertInterval:null,_unreadMessagesCount:0,_titleAlertCount:0,_savedTitle:rk("Просмотр диалога")},before:{init:function(){var e=this;if(e._options.inWindow)e.subscribeTo(n,"onChangeThemes",e._handlerOnChangeThemes.bind(e))}},after:{init:function(){var e=this;if(e._options.inWindow)if(e._options.messageGUID&&e._options.highlightDate){var t=e._getBaseControl?e._getBaseControl():e._getMsgSendViewBase(),n=t?t.getViewControl():null;if(n)e.subscribeTo(n,"onDrawItems",function(){if(!e.messageHighlited){var t=n.getContainer().find("div[data-messageguid="+e._options.messageGUID+"]");if(t&&t.length){var s=t.find(".visible-date");if(s&&s.length)s.addClass("highlight-date")}e.messageHighlited=true}})}}},_getDialogId:function(){return this._options.dialogId},_handlerOnChangeThemes:function(e,t){var n=s.get("ИдентификаторСервисаПрофилей");if(t&&"read"===t.state&&t.changed_themes&&(t.user==n||t.other_user&&-1!=t.other_user.indexOf(n)))for(var i=0;i<t.changed_themes.length;i++)if(t.changed_themes[i].id===this._getDialogId()){if(this._titleAlertInterval)clearInterval(this._titleAlertInterval);document.title=this._savedTitle;break}},_setUnreadToTab:function(t){var n=this;if(n._unreadMessagesCount=t,n._unreadMessagesCount&&!e.isContentVisibleForUser.bind(n)()){if(n._titleAlertCount=0,n._titleAlertInterval)clearInterval(n._titleAlertInterval);n._titleAlertInterval=setInterval(n._titleAlert.bind(n),1e3)}},_titleAlert:function(){var n=this,s=e.isContentVisibleForUser.bind(n)();if(!s&&n._unreadMessagesCount&&n._titleAlertCount<10){var i=[n._unreadMessagesCount,1===n._unreadMessagesCount?rk("сообщение"):t.wordCaseByNumber(n._unreadMessagesCount,rk("сообщений"),rk("сообщение","множественное"),rk("сообщения"))].join(" ");if(i!==document.title)document.title=i;else document.title=n._savedTitle;n._titleAlertCount+=1}else{if(n._titleAlertCount=0,!s&&n._unreadMessagesCount)document.title=["(",n._unreadMessagesCount>99?"99+":n._unreadMessagesCount,") ",n._savedTitle].join("");else document.title=n._savedTitle;clearInterval(n._titleAlertInterval)}}}});
//# sourceMappingURL=AlertTabOnMessages.module.js.map
define("js!SBIS3.Contacts.ScrollButton",["js!SBIS3.CONTROLS.Button","Core/core-instance","Core/helpers/Function/debounce"],function(i,t,o){var n=i.extend({_controlName:"SBIS3.Contacts.ScrollButton",_linkedView:null,_scrollContainer:null,_scrollContent:null,_scrollDirection:"bottom",_scrollPosition:"",$constructor:function(){this._publish("onChangeScrollPosition","onChangeVisibility","onScroll")},_modifyOptions:function(){return this._prepareOptions(n.superclass._modifyOptions.apply(this,arguments))},init:function(){n.superclass.init.call(this),this.subscribeTo(this,"onChangeScrollPosition",this._onChangeScrollPositionHandler),this.subscribeTo(this,"onDestroy",this._onDestroyHandler)},setLinkedView:function(i,n){if(t.instanceOfModule(i,"SBIS3.CONTROLS/ListView")){if(t.instanceOfModule(n,"SBIS3.CONTROLS/ScrollContainer"))this._scrollContainer=n;else{var s=i.getParent();if(t.instanceOfModule(s,"SBIS3.CONTROLS/ScrollContainer"))this._scrollContainer=s}if(this._scrollContainer)this._linkedView=i,this._scrollContent=this._scrollContainer._content,this._scrollContent.on("scroll",o(this._onScrollHandler.bind(this),50)),this.subscribeTo(this._linkedView,"onDestroy",this._onDestroyHandler.bind(this)),this.subscribeTo(this._scrollContainer,"onDestroy",this._onDestroyHandler.bind(this))}},getLinkedView:function(){return this._linkedView},getScrollPosition:function(){var i=this._scrollContent[0],t=0===i.scrollTop,o=i.scrollHeight-i.clientHeight===i.scrollTop,n=t?"top":o?"bottom":"between";if(n!==this._scrollPosition)this._scrollPosition=n,this._notify("onChangeScrollPosition",n);return this._scrollPosition},getScrollDirection:function(){return this._scrollDirection},_prepareOptions:function(i){return i.visible="boolean"===typeof i.visible?i.visible:false,i.className=["contacts-ScrollButton",i.className].join(" "),this._scrollDirection=i.scrollDirection||this._scrollDirection,this._preventChangeVisibility=i.preventChangeVisibility||this._preventChangeVisibility,i},_onScrollHandler:function(i){if(this.isDestroyed())return;this.getScrollPosition(),this._notify("onScroll")},_onChangeScrollPositionHandler:function(i,t){var o=this.isVisible(),n=this.getScrollDirection()!==t;if(o!==n){var s=this._notify("onChangeVisibility",n);if("boolean"===typeof s)n=s;this.setVisible(n)}},_onDestroyHandler:function(i){if(this._scrollContent)this._scrollContent.off("scroll",this._onScrollHandler);this._scrollContent=null,this._scrollContainer=null,this._linkedView=null}});return n});
//# sourceMappingURL=ScrollButton.module.js.map
define("js!SBIS3.CONTROLS.ComponentBinder",["SBIS3.CONTROLS/ComponentBinder"],function(n){return n});
//# sourceMappingURL=ComponentBinder.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.BindSearch",["js!SBIS3.Contacts.Mixins.Services.Executor.Base","js!SBIS3.CONTROLS.ComponentBinder"],function(e,t){"use strict";return e.mergeMixin(e,{$protected:{},after:{init:function(){this.register(["bindSearch","addFilter","startSearch","resetFilter"]),this.setRequiredMethods(["getViewControl"])}},seBindSearch:function(e){var r={executed:true,result:true},i={executed:false,result:null};if(!this.checkRequiredMethods())return i;if("object"!=typeof e||"object"!=typeof e.searchForm)return logger.error("BindSearch","Ошибка!!! Неверные входные параметры"),i;this.subscribeTo(e.searchForm,"onReset",function(){this.getViewControl().resetSearchFlag()}.bind(this));var s=new t({view:this.getViewControl(),searchForm:e.searchForm});return s.bindSearchGrid("Поиск",void 0,void 0,void 0,void 0,false),r.result=s,r},seAddFilter:function(e){var t={executed:true,result:true},r={executed:false,result:null},i=this.getViewControl().getFilter();if(!this.checkRequiredMethods())return r;return i["ПоискПерсоны"]=e["ПоискПерсоны"],this.getViewControl().setFilter(i,true),t},seStartSearch:function(e){var t={executed:true,result:true},r={executed:false,result:null},i=this.getViewControl().getFilter();if(!this.checkRequiredMethods())return r;if(e&&e.hasOwnProperty("ПоискПерсоны")&&i["ПоискПерсоны"]!=e["ПоискПерсоны"])i["ПоискПерсоны"]=e["ПоискПерсоны"],this.getViewControl().setFilter(i);return t},seResetFilter:function(e){var t={executed:true,result:true},r={executed:false,result:null},i=this.getViewControl().getFilter();if(!this.checkRequiredMethods())return r;if(i["ПоискПерсоны"]){i["ПоискПерсоны"]=null;var s=this.getViewControl();s.resetSearchFlag(),s.setFilter(i,!!(e&&e.noReload))}return t}})});
//# sourceMappingURL=BindSearch.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.UnreadMessagesCollector",["Core/core-instance","Core/UserInfo","i18n!SBIS3.Contacts.Mixins.Interface.UnreadMessagesCollector"],function(e,t){"use strict";return{$protected:{_options:{collectUnread:false},_abortCollect:false,_currentTheme:"",_myPersonID:""},after:{init:function(){var e=this.getViewControl(),n=!!e&&this.getProperty("collectUnread");if(this._publish("onChangeUnreadMessages"),this._myPersonID=t.get("ИдентификаторСервисаПрофилей"),n)this.subscribeTo(e,"onDataLoad",this._onDataLoadHandler.bind(this)),this.subscribeTo(e,"onItemsReady",this._onItemsReadyHandler.bind(this))}},collectUnreadMessages:function(t,n){if(!this._abortCollect){var s=this.getLinkedContext(),i=this.getUnreadMessages(s),r=this.getCurrentTheme()===this._getThemeFromItems(t),o=e.instanceOfModule(t,"WS.Data/Collection/RecordSet"),a=o?t.getCount():t.length,c=o?t.each:t.forEach,l=false;if(r&&!!a&&"function"===typeof c)if(c.call(t,function(t){if(e.instanceOfModule(t,"WS.Data/Entity/Record")){var s=t.get("Сообщение"),r=t.get("ПрочитаноВладельцем"),o=t.get("Входящее"),a=!!o&&!!o[0],c=!!r&&!!r[0];if(i[s]&&(c||"rm"===n))delete i[s],l=true;else if("a"===n&&!c&&a)i[s]={id:s,date:new Date(t.get("ДатаВремя")).getTime()},l=true}}),l)this.setUnreadMessages(i,s)}},clearUnreadMessages:function(e){this.setUnreadMessages({},null,e)},getUnreadMessages:function(e){return(e||this.getLinkedContext()).getValue("unreadMessages")||{}},setUnreadMessages:function(e,t,n){if((t||this.getLinkedContext()).setValue("unreadMessages",e),!n)this._notify("onChangeUnreadMessages",this._getObjectKeys(e))},getUnreadCount:function(e){var t=e||this.getLinkedContext(),n=this.getUnreadMessages(t);return this._getObjectKeys(n).length},getCurrentTheme:function(){return this._currentTheme},setCurrentTheme:function(e){if(this._currentTheme!==e)this._hasNewMessages=false;this._currentTheme=e},_initCollector:function(e){if(e&&!e.isDestroyed()){var t=this._getThemeFromItems(e);if(!!t&&t!==this.getCurrentTheme())this.setCurrentTheme(t),this.clearUnreadMessages(),this.collectUnreadMessages(e,"a")}},_onItemsReadyHandler:function(e){var t=this.getViewControl(),n=!!t&&t.getItems();if(n)this._initCollector(n),this.subscribeTo(n,"onCollectionChange",this._onCollectionChangeHandler.bind(this))},_onCollectionChangeHandler:function(e,t,n,s,i,r){this.collectUnreadMessages("rm"===t?i:n,t)},_onDataLoadHandler:function(e,t){this._initCollector(t)},_getThemeFromItems:function(t){var n=e.instanceOfModule(t,"WS.Data/Collection/RecordSet")?!t.isDestroyed()&&t.getCount()?t.at(0):null:t&&t.length?t[0]:null;return!!n&&n.get("Тема")||""},_getObjectKeys:function(e){var t=[];if(e&&"object"===typeof e)try{t=Object.keys(e)}catch(e){}return t},around:{getViewControl:function(e){return e?e():void 0}}}});
//# sourceMappingURL=Collector.module.js.map
define("js!SBIS3.Contacts.DomMessagesHelper",[],function(){"use strict";var t={getItemContainerById:function(t,e){if(t&&"function"===typeof t.getContainer){var i=t.getContainer().children(".controls-ListView__itemsContainer");return i.length?i.find("[data-id="+e+"]"):null}return null},checkItemInViewport:function(e,i,o,n){var r="string"===typeof e?t.getItemContainerById(i,e):e;if(o){if("number"!==typeof o.right)o.right=o.left+o.width;if("number"!==typeof o.bottom)o.bottom=o.top+o.height}if(r&&r.length&&r[0]){var f=r.offset(),l=f.top,h=f.left,s=r.width(),u=r.height(),a=l+(n&&"number"===typeof n.top?n.top:0),p=h+(n&&"number"===typeof n.left?n.left:0),g=p+s+(n&&"number"===typeof n.right?n.right:0),c=a+u+(n&&"number"===typeof n.bottom?n.bottom:0),m=a-o.top,d=p-o.left,b=o.bottom-c,I=o.right-g,w=m<=-1*u,y=b<=-1*u,C=d<=-1*s,v=I<=-1*s,V=!w&&!y,H=!C&&!v;return{left:d,right:I,top:m,bottom:b,aboveViewport:w,belowViewport:y,beforeViewport:C,afterViewport:v,verticalInside:V,horizontalInside:H,inside:V&&H,absoluteInside:d>=0&&I>=0&&m>=0&&b>=0,itemContainer:{width:s,height:u,offsetTop:l,offsetLeft:h}}}return null},isItemInViewport:function(e,i,o,n,r){if(e&&o){var f=o.getContainer().children(".controls-ScrollContainer__content");if(f.length)if(f[0].clientHeight>=f[0].scrollHeight)return true;else{var l={left:f.offset().left,top:f.offset().top,width:f[0].clientWidth,height:f[0].clientHeight},h=t.checkItemInViewport(e,i,l,n);if(h)return r?h.absoluteInside:h.inside}}return false}};return t});
//# sourceMappingURL=DomMessages.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.UnreadMessagesButton",["js!SBIS3.Contacts.DomMessagesHelper","js!SBIS3.Contacts.MessagesExchangeEvents","Core/helpers/String/format"],function(t,e,i){"use strict";return{$protected:{_options:{ctxUnreadCount:null,ctxFirstUnread:null},_hasNewMessages:false,_unreadMessageCount:null},after:{init:function(){if(this.getProperty("ctxUnreadCount"))this._abortCollect=true;this.subscribeOnceTo(this,"onBeforeShow",this._onBeforeShowHandler.bind(this))}},setOptionsUnreadByCtx:function(t){this._options.ctxUnreadCount=t.ctxUnreadCount,this._options.ctxFirstUnread=t.ctxFirstUnread,this._abortCollect=!!t.ctxUnreadCount},_onNewMessageHandler:function(t,e){if(e){var i=e.theme,n=e.outgoing,s=e.sender&&e.sender.person===this._myPersonID;if(i===this.getCurrentTheme()&&!n&&!s)this._hasNewMessages=true}},_onBeforeShowHandler:function(t){var i=this.getViewControl(),n=this.getViewScrollControl(),s=this.getScrollButton(),o=this.getLinkedContext();if(s&&n&&i)s.setLinkedView(i,n),this.subscribeTo(s,"onChangeVisibility",this._onChangeVisibilityHandler.bind(this)),this.subscribeTo(s,"onScroll",this._onScrollHandler.bind(this)),this.subscribeTo(s,"onActivated",this._onActivatedScrollButtonHandler.bind(this)),this.subscribeTo(o,"onFieldChange",this._onFiledChangeHandler.bind(this)),this.subscribeTo(i,"onBeforeReload",function(){this._hasNewMessages=false,this._unreadMessageCount=0}.bind(this)),this.subscribeTo(this,"onChangeUnreadMessages",this._onChangeUnreadMessagesHandler.bind(this)),this.subscribeTo(e,"onNewMessage",this._onNewMessageHandler.bind(this))},_onChangeVisibilityHandler:function(t,e){var i=this._needShowScrollButton();t.setResult(e&&i)},_onScrollHandler:function(t){this._updateScrollButtonVisibility()},_onActivatedScrollButtonHandler:function(t){var e=this.getViewControl(),i=this._getFirstUnreadMessage(),n=i&&i.id;if(n)if(this.moveFocusToEditor(),i.isCtx)e.reloadDialog(e.getCurrentDialogID(),null,"",{beginMessage:n});else if("function"===typeof e.scrollToMessage)e.scrollToMessage(n)},_onFiledChangeHandler:function(t,e,i,n){if(e===this.getProperty("ctxUnreadCount")){if(this._unreadMessageCount=i,i&&!this._getFirstUnreadMessage())if(!this.getViewControl().getListNavigation().hasNextPage("down"))this._abortCollect=false;this._setUnreadButtonCaption(i),this._updateScrollButtonVisibility()}},_onChangeUnreadMessagesHandler:function(t,e){var i=e.length;if(this._unreadMessageCount=i,!this.getProperty("ctxUnreadCount"))this._setUnreadButtonCaption(i),this._updateScrollButtonVisibility();else if(!this._abortCollect&&i&&this._getFirstUnreadMessage()){if(this._abortCollect=true,"function"===typeof this.clearUnreadMessages)this.clearUnreadMessages(true);this._updateScrollButtonVisibility()}},_updateScrollButtonVisibility:function(){var t=this.getScrollButton(),e=this._needShowScrollButton();if(t&&t.isVisible()!==e)t.setVisible(e)},_needShowScrollButton:function(){if(this._hasNewMessages&&this._unreadMessageCount){var t=this.getScrollButton(),e=t&&t.getScrollPosition(),i=!("string"===typeof e&&"bottom"===e)&&this._getFirstUnreadMessage();return!!i&&!this._hasUnreadMessagesInViewport({top:35},i)}return false},_getUnreadMessagesInViewport:function(e,i){var n=this.getViewControl(),s=this.getViewScrollControl(),o=this.getUnreadMessages(),r=[];if(n&&s&&o)for(var a in o)if(o.hasOwnProperty(a)&&t.isItemInViewport(a,n,s,e,i))r.push(a);return r},_hasUnreadMessagesInViewport:function(e,i){var n=i||this._getFirstUnreadMessage(),s=false;if(n){var o=this.getViewControl(),r=this.getViewScrollControl().getContainer().children(".controls-ScrollContainer__content");if(r[0].clientHeight>=r[0].scrollHeight)s=true;else{var a=n.length?n:n.id,l=t.checkItemInViewport(a,o,{left:r.offset().left,top:r.offset().top,width:r[0].clientWidth,height:r[0].clientHeight},e);if(l&&!l.belowViewport)s=true}}return s},_getFirstUnreadMessage:function(){if(this.getProperty("ctxUnreadCount")){var t=this.getViewControl(),e=t.getContainer().find('.contacts-ThemeMessage-row[data-read-owner="false"]:first');if(e.length)return{id:e.attr("data-id")};else if(this.getProperty("ctxFirstUnread")&&!t.isSearching()&&t.getListNavigation().hasNextPage("down")){var i=this.getLinkedContext().getValue(this.getProperty("ctxFirstUnread"));if(i)return{id:i,isCtx:true}}}else{var n=this.getUnreadMessages();if(n){var s=null,o=(new Date).getTime();for(var r in n)if(n.hasOwnProperty(r)&&n[r]){var a=n[r],l="number"===typeof a.date?a.date:new Date(a.date).getTime();if(l<o)s=a,o=l}return s}}return null},_setUnreadButtonCaption:function(t){this.getLinkedContext().setValue("unreadCountMessage",t?i({count:t},rk("$count$s$ новое(-ых) сообщение(-ий, -ия)","unread_count",t)):"")},around:{getViewControl:function(t){return t?t():void 0},getScrollButton:function(t){return t?t():void 0},getViewScrollControl:function(t){return t?t():void 0},moveFocusToEditor:function(t){return t?t():false},getUnreadMessages:function(t,e){return t?t(e):{}}}}});
//# sourceMappingURL=Button.module.js.map
define("js!SBIS3.Contacts.Mixins.Interface.SearchFormSupport",["Lib/Control/Control","Core/constants","Core/Context","Core/IoC"],function(e,n,t,r){"use strict";var o="Contacts.StopSearchViews",i={$protected:{_needSubscribeToEvents:true,_searchFormParentContainer:null,_searchFormContainer:null,_searchControl:null,_options:{searchForm:"browserSearch"}},_keyUpHandler:function(a){if(a.which==n.key.esc){var c=t.global.getValue(o),s=$(a.target),l,d,u=function(e){e.unbind("keydown",i._keyUpHandler),r.resolve("ILogger").log("unbinded keydown in SearchFormSupport._keyUpHandler")};if(s.attr("data-component"))d=s.attr("id");else{var f=s.parents('[data-component="SBIS3.CONTROLS.SearchForm"]');if(f.length)l=f.attr("id")}if(l)d=c[l];else if(d)l=c[d];if(!d||!l)return u(s),true;try{var S=e.ControlStorage.get(d);if(this._notify("onSearchFinished",a,true),!S.isDestroyed()){a.stopImmediatePropagation();var h=S.getUserData("Contacts.StopSearchFunction");if("function"==typeof h)h(S);else if("function"==typeof S.setInfiniteScroll)S.setInfiniteScroll(false,true);else r.resolve("ILogger").error("Не удалось остановить поиск - нет функции нужной у представления данных с id="+d);return false}}catch(e){u(s)}}return true},_keyEventBindUnbind:function(e,n,t){for(var o=[n.getContainer().find("input"),e.getContainer()],a=i._keyUpHandler,c=t?"unbind":"bind",s=0,l=o.length;s<l;s++)o[s][c].call(o[s],"keydown",a);r.resolve("ILogger").log("_keyEventBindUnbind",(t?"un":"")+"binded  keydown in SearchFormSupport._keyUpBindUnbind")},$constructor:function(){this._publish("onSearchStart","onSearchFinished")},around:{getViewControl:function(e){return e?e():void 0}}};return i});
//# sourceMappingURL=SearchFormSupport.module.js.map
define("tmpl!SBIS3.CONTROLS/SearchForm/resources/SearchFormButtons",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={},o=function e(o,s,c,a,n){function i(){}var l=0,u=void 0!==r&&r?r:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};n&&n.isSetts&&(d=n.fullContext||{});var h="string"==typeof c?c:"",m=void 0===t?void 0:t,S={id:[],def:void 0},p=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),v=this&&this.includedTemplates?this.includedTemplates:{},f=u.getMarkupGenerator(a);try{var F=f.joinElements([f.createTag("div",{class:"controls-SearchForm__afterFieldWrapper"},[f.createTag("span",{class:"js-controls-SearchForm__reset controls-SearchForm__reset icon-size icon-Close "+u.wrapUndef(u.utils.escape(u.getter(o,["text"])?"":"ws-hidden")),title:""+global.rk("Очистить результаты поиска")},[],{},S,this),f.createTag("span",{class:"js-controls-SearchForm__search controls-SearchForm__search icon-size icon-primary icon-Search2"},[],{},S,this)],s,S,this)],h,S);S.def&&(F=f.chain(F,S,s),S=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/SearchForm/resources/SearchFormButtons.tmpl",e,o)}return F||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/SearchForm/resources/SearchFormButtons"}},o});
//# sourceMappingURL=SearchFormButtons.tmpl.map
define("SBIS3.CONTROLS/SearchForm",["Core/constants","SBIS3.CONTROLS/TextBox","SBIS3.CONTROLS/Mixins/SearchMixin","SBIS3.CONTROLS/Mixins/SuggestMixin","SBIS3.CONTROLS/Mixins/SuggestTextBoxMixin","SBIS3.CONTROLS/Mixins/ChooserMixin","SBIS3.CONTROLS/Mixins/PickerMixin","tmpl!SBIS3.CONTROLS/SearchForm/resources/SearchFormButtons","css!SBIS3.CONTROLS/SearchForm/SearchForm","css!SBIS3.CONTROLS/Suggest/Suggest"],function(e,s,t,i,n,r,o,c){"use strict";var a=s.extend([t,o,i,n,r],{$protected:{_options:{afterFieldWrapper:c,btnCaption:"",usePicker:false,_paddingClass:"controls-SearchForm_padding"}},$constructor:function(){var e=this;this.subscribe("onTextChange",function(s,t){$(".js-controls-SearchForm__reset",e.getContainer()).toggleClass("ws-hidden",""===t)}),this.getContainer().on("click",".js-controls-SearchForm__reset",function(){e.resetSearch(),e._applyTooltip()}),this.getContainer().on("click",".js-controls-SearchForm__search",function(){if(e.isEnabled())e.hidePicker(),e.applySearch(true)})},_modifyOptions:function(){var e=a.superclass._modifyOptions.apply(this,arguments);return e.className+=" controls-SearchForm",e},_keyUpBind:function(s){if(s.which===e.key.enter){if(this._options.usePicker&&this.isPickerVisible()&&this.getList().getItems().getCount())a.superclass._keyUpBind.apply(this,arguments);else{if(this.isPickerVisible())this.hidePicker();this._checkInputVal(),this.applySearch(true)}s.stopPropagation()}else a.superclass._keyUpBind.apply(this,arguments)},_chooseCallback:function(e){var s=e&&e[0];if(s)this._onListItemSelect(s.getId(),s)},_onListItemSelect:function(){a.superclass._onListItemSelect.apply(this,arguments),this.applySearch(true)},_setPickerConfig:function(){var e=a.superclass._setPickerConfig.apply(this,arguments),s=this.getContainer(),t=this._getInputField(),i=this;return e.parentContainer=this.getContainer().parent(),e.className="controls-searchForm__suggest",e.closeButton=true,e.handlers={onShow:function(){s.css("z-index",parseInt(i._picker.getContainer().css("z-index"),10)+1).addClass("controls-searchForm__suggest-shown"),t.addClass("controls-searchForm__field-suggest-shown")},onClose:function(){s.css("z-index","").removeClass("controls-searchForm__suggest-shown"),t.removeClass("controls-searchForm__field-suggest-shown")}},e},_keyDownBind:function(s){if(a.superclass._keyDownBind.apply(this,arguments),s.which===e.key.enter)s.stopPropagation(),s.preventDefault()}});return a});
//# sourceMappingURL=SearchForm.js.map
define("js!SBIS3.CONTROLS.SearchForm",["SBIS3.CONTROLS/SearchForm"],function(S){return S});
//# sourceMappingURL=SearchForm.module.js.map
define("js!SBIS3.CONTROLS.ScrollContainer",["SBIS3.CONTROLS/ScrollContainer"],function(n){return n});
//# sourceMappingURL=ScrollContainer.module.js.map
define("tmpl!SBIS3.CONTROLS/Browser/Browser",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),r=e[0],t={},o=function e(o,n,i,l,s){function a(){}var c=0,u=void 0!==r&&r?r:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var p="string"==typeof i?i:"",v=void 0===t?void 0:t,f={id:[],def:void 0},m=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),S=this&&this.includedTemplates?this.includedTemplates:{},h=u.getMarkupGenerator(l);try{var y=h.joinElements([h.createTag("div",{class:"controls-Browser"},[h.createControl("resolver",u.getter(o,["contentTpl"]),u.uniteScope(u.utils.escape(u.uniteScope(o,{parent:void 0,element:void 0})(u.plainMerge)),{}),{},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},i,v,S,u.config,d,f)],n,f,this)],p,f);f.def&&(y=h.chain(y,f,n),f=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/Browser/Browser.tmpl",e,o)}return y||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/Browser/Browser"}},o});
//# sourceMappingURL=Browser.tmpl.map
define("SBIS3.CONTROLS/Controllers/ColumnsController",["Core/Abstract"],function(t){"use strict";return t.extend({$protected:{_options:{},_state:null},getColumns:function(t){var e,n=[];return t.each(function(t){if(t.get("fixed"))n=n.concat(t.get("columnConfig"))}),this._state.forEach(function(o){if(e=t.getRecordById(o),e&&!e.get("fixed"))n=n.concat(e.get("columnConfig"))}),n},getState:function(){return this._state},setState:function(t){this._state=t}})});
//# sourceMappingURL=ColumnsController.js.map
define("SBIS3.CONTROLS/Browser",["Core/CommandDispatcher","Core/Deferred","Lib/Control/CompoundControl/CompoundControl","tmpl!SBIS3.CONTROLS/Browser/Browser","SBIS3.CONTROLS/ComponentBinder","SBIS3.CONTROLS/Controllers/ColumnsController","SBIS3.CONTROLS/Utils/TemplateUtil","Core/core-instance","Core/helpers/Object/find"],function(t,i,n,e,o,s,r,l,h){"use strict";var u=function(t){if(t&&l.instanceOfModule(t,"SBIS3.CONTROLS/ListView"))return l.instanceOfMixin(t,"SBIS3.CONTROLS/Mixins/TreeMixin");else throw new Error("Browser: Can't define linkedView")},a={REDRAW:"Redraw",RELOAD:"Reload"},_=n.extend({_dotTplFn:e,$protected:{_view:null,_backButton:null,_breadCrumbs:null,_searchForm:null,_operationsPanel:null,_filterButton:null,_fastDataFilter:null,_columnsController:null,_columnsEditor:null,_hierMode:false,_componentBinder:null,_options:{content:"",searchParam:"СтрокаПоиска",searchCrumbsTpl:void 0,searchMode:"current",keyboardLayoutRevert:true,keyboardLayoutRevertNew:false,historyId:"",updateFilterHistory:false,applyHistoryFilterOnLoad:true,pagingId:"",ignoreFiltersList:[],saveRootInHistory:false,showCheckBoxes:false,contentTpl:null,columnsConfig:null,hierarchyViewMode:true,viewName:"browserView",backButtonTemplate:null}},$constructor:function(){},init:function(){this._publish("onEdit","onEditCurrentFolder","onFiltersReady","onColumnsChange"),_.superclass.init.apply(this,arguments),this._onItemActivateHandler=this._onItemActivate.bind(this),this._folderEditHandler=this._folderEdit.bind(this),this._onApplyFilterHandler=this._onApplyFilter.bind(this),this._onInitBindingsHandler=this._onInitBindings.bind(this),this._bindView(),t.declareCommand(this,"showColumnsEditor",this._showColumnsEditor)},setColumnsConfig:function(t){if(this._options.columnsConfig=t,!this._columnsController)this._initColumnsController();this._columnsController.setState(this._options.columnsConfig.selectedColumns),this._notifyOnPropertyChanged("columnsConfig")},getColumnsConfig:function(){return this._options.columnsConfig},_showColumnsEditor:function(t){var n=t&&"object"===typeof t,e=n&&t.columnsConfig?t.columnsConfig:this._options.columnsConfig;if(!e)return i.fail("ColumnsConfig required");var o=new i;return require(["SBIS3.CONTROLS/Browser/ColumnsEditor/Editor"],function(i){if(!this._columnsEditor)this._columnsEditor=new i;if(o.dependOn(this._columnsEditor.open(e,n?t.editorOptions:null)),n&&t.applyToSelf)o.addCallback(function(t){if(t)this._changeColumns(t.selectedColumns)}.bind(this))}.bind(this)),o},_changeColumns:function(t){var i=this._notify("onColumnsChange",t);this._columnsController.setState(t);var n=this._options.columnsConfig;n.selectedColumns=t;var e=this._getView();if(e.setColumns(this._columnsController.getColumns(n.columns)),i===a.RELOAD)e.reload();else e.redraw()},_modifyOptions:function(){var t=_.superclass._modifyOptions.apply(this,arguments);if(!t.contentTpl)t.contentTpl=r.prepareTemplate(t.content);return t},_folderEdit:function(){this._notify("onEditCurrentFolder",this._componentBinder.getCurrentRootRecord())},addItem:function(t){this._notify("onEdit",{id:null,item:null})},getView:function(){return this._view},setViewName:function(t){this._unbindView(),this._options.viewName=t,this._bindView()},_unbindView:function(){if(this._view)this._view.unsubscribe("onItemActivate",this._onItemActivateHandler);if(this._columnsController)this._columnsController.destroy();if(this._backButton)this._backButton.unsubscribe("onArrowActivated",this._folderEditHandler);if(this._componentBinder)this._componentBinder.destroy();if(this._filterButton)this.unsubscribeFrom(this._filterButton,"onApplyFilter",this._onApplyFilterHandler)},_bindView:function(){var t=this;if(this._view=this._getView(),this._view.subscribe("onItemActivate",this._onItemActivateHandler),this._options.columnsConfig)this._initColumnsController();if(this._hierMode=u(this._view),this._hierMode)if(this._backButton=this._getBackButton(),this._breadCrumbs=this._getBreadCrumbs(),this._backButton&&this._breadCrumbs)this._backButton.subscribe("onArrowActivated",this._folderEditHandler),this._componentBinder=new o({backButton:this._backButton,breadCrumbs:this._breadCrumbs,view:this._view,backButtonTemplate:this._options.backButtonTemplate}),this._componentBinder.bindBreadCrumbs();else this._componentBinder=new o({view:this._view});else this._componentBinder=new o({view:this._view});if(this._searchForm=this._getSearchForm(),this._searchForm)this._componentBinder.bindSearchGrid(this._options.searchParam,this._options.searchCrumbsTpl,this._searchForm,this._options.searchMode,false,this._options.keyboardLayoutRevert,this._options.hierarchyViewMode);if(this._operationsPanel=this._getOperationsPanel(),this._operationsPanel)this._componentBinder.bindOperationPanel(!this._options.showCheckBoxes,this._operationsPanel),this._operationsPanel.subscribe("onToggle",function(){t._container.toggleClass("controls-Browser__operationPanel-opened",this.isVisible())});if(this._filterButton=this._getFilterButton(),this._fastDataFilter=this._getFastDataFilter(),this._filterButton)if(this.subscribeTo(this._filterButton,"onApplyFilter",this._onApplyFilterHandler),this._options.historyId)this._bindFilterHistory();else this._notifyOnFiltersReady();else this._notifyOnFiltersReady();if(this._options.pagingId&&this._view.getProperty("showPaging"))this._componentBinder.bindPagingHistory(this._view,this._options.pagingId);if(this.isInitialized())this._onInitBindingsHandler();else this.subscribe("onInit",this._onInitBindingsHandler)},_initColumnsController:function(){var t;if(this._columnsController=new s,t=this._columnsController.getState(),!t)this._columnsController.setState(this._options.columnsConfig.selectedColumns);this._getView().setColumns(this._columnsController.getColumns(this._options.columnsConfig.columns)),this._getView().redraw()},_onItemActivate:function(t,i){this._notifyOnEditByActivate(i)},_onApplyFilter:function(){this.getView().setActive(true)},_onInitBindings:function(){if((this._filterButton||this._fastDataFilter)&&(!this._filterButton||this._filterButton&&!h(this._filterButton._getOptions().bindings,function(t){return"filterStructure"===t.propName})))this._componentBinder.bindFilters(this._filterButton,this._fastDataFilter,this._view)},setPath:function(t){this._componentBinder.setPath(t)},setHistoryId:function(t){this._options.historyId=t,this._bindFilterHistory()},_bindFilterHistory:function(){if(this._filterButton&&this._options.historyId)this._componentBinder.bindFilterHistory(this._filterButton,this._fastDataFilter,this._options.searchParam,this._options.historyId,this._options.ignoreFiltersList,this._options.applyHistoryFilterOnLoad,this,this._options.updateFilterHistory,this._options.saveRootInHistory)},_notifyOnFiltersReady:function(){var t=this._fastDataFilter;if(t&&t.isVisible())t.getContainer().removeClass("ws-hidden");this._notify("onFiltersReady")},_getLinkedControl:function(t){var i=null;if(this.hasChildControlByName(t))i=this.getChildControlByName(t);return i},_getView:function(){return this._getLinkedControl(this._options.viewName)},_getFilterButton:function(){return this._getLinkedControl("browserFilterButton")},_getSearchForm:function(){return this._getLinkedControl("browserSearch")},_getColumnsEditorButton:function(){return this._getLinkedControl("browserColumnsEditorButton")},_getBackButton:function(){return this._getLinkedControl("browserBackButton")},_getBreadCrumbs:function(){return this._getLinkedControl("browserBreadCrumbs")},_getOperationsPanel:function(){return this._getLinkedControl("browserOperationsPanel")},_getFastDataFilter:function(){return this._getLinkedControl("browserFastDataFilter")},_notifyOnEditByActivate:function(t){this._notify("onEdit",t)},destroy:function(){if(this._columnsController)this._columnsController.destroy(),this._columnsController=null;_.superclass.destroy.apply(this,arguments)}});return _.ChangeColumnsResult=a,_});
//# sourceMappingURL=Browser.js.map
define("js!SBIS3.CONTROLS.Browser",["SBIS3.CONTROLS/Browser"],function(r){return r});
//# sourceMappingURL=Browser.module.js.map
define("html!SBIS3.Contacts.MessagesSendViewBase/Base",function(){var e=function(e){var o=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(o){for(;e.test(o);)o=o.replace(e,"&#123;&#123;$1&#125;&#125;");return o}}(),i=function(e){return e.join?e.join(""):e.toString()},n=function(e){return void 0===e?"":e&&"object"==typeof e?i(e):""+e},t="undefined"!=typeof process,r=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="contacts-MessagesSendViewBase__control"> ');return!e.rightSideUnderTop&&e.rightSide&&(r+=' <div class="msvb__flexRowOrganizer"> <div class="outerRightSide rightSide ws-hidden"> </div> <div class="outerLeftSide msvb__flexColOrganizer"> '),r+=" ",e.topSide&&(r+=' <div class="upSide"> <component data-component="'+o(n(e.topSide.type))+'" name="'+o(n(e.topSide.name))+'"> ',e.topSide.config&&(r+=" "+o(n(e.topSide.config))+" "),r+=" </component> </div> "),r+=" ",e.rightSideUnderTop&&e.rightSide&&(r+=' <div class="msvb__flexRowOrganizer"> <div class="innerRightSide rightSide ws-hidden"> </div> '),r+=' <div class="underUpSideContainer-area msvb__flexColOrganizer ',e.bottomSideUnderView||(r+=" bottomSideAtBottom "),r+=' "> ',e.bottomSideUnderView||(r+=' <div class="bg-filler"></div> '),r+=' <div class="viewerContainer contacts-Modify__view-container"> ',e.middleView&&(r+=' <component data-component="SBIS3.CONTROLS.ScrollContainer" name="scrollContainer"> <option name="className">controls-ScrollContainer__flex ',e.isVisibleScroll||(r+=" controls-ScrollContainer__hiddenScrollbar"),r+='</option> <option name="content"> <component data-component="'+o(n(e.middleView.type))+'" name="',e.middleView.name?r+=o(n(e.middleView.name)):r+="browserView",r+='"> ',e.middleView.config&&(r+=" "+o(n(e.middleView.config))+" "),r+=" </component> </option> </component> ",e.showScrollButton&&(r+=' <div class="contacts-ScrollButton__wrapper"> <component data-component="SBIS3.Contacts.ScrollButton" name="scrollButton"> <option name="icon">sprite:icon-24 icon-TrendDown icon-primary</option> <option name="visible">false</option> <option name="caption" bind="unreadCountMessage"/> </component> </div> '),r+=" "),r+=" </div> ",(e.bottomSide||e.rightSideOpener)&&(r+='   <div class="bottomSide"> ',e.rightSideOpener&&e.rightSide&&(r+=' <div class="rightOpener"> <component data-component="'+o(n(e.rightSideOpener.type))+'" name="'+o(n(e.rightSideOpener.name))+'"> ',e.rightSideOpener.config&&(r+=" "+o(n(e.rightSideOpener.config))+" "),r+=" </component> </div> "),r+=" ",e.bottomSide&&(r+=' <component data-component="'+o(n(e.bottomSide.type))+'" name="'+o(n(e.bottomSide.name))+'"> ',e.bottomSide.config&&(r+=" "+o(n(e.bottomSide.config))+" "),r+=" </component> "),r+=" </div> "),r+=" </div> ",e.rightSideUnderTop&&e.rightSide&&(r+=" </div>  "),r+=" ",!e.rightSideUnderTop&&e.rightSide&&(r+=" </div> </div>  "),r+=" </div>",(r=o(r))+(t&&-1!==r.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.MessagesSendViewBase/Base"}},e});
//# sourceMappingURL=Base.xhtml.map
define("js!SBIS3.Contacts.MessagesSendViewBase",["Core/IoC","Core/Deferred","Core/detection","Core/helpers/Function/debounce","js!SBIS3.CONTROLS.CompoundControl","html!SBIS3.Contacts.MessagesSendViewBase/Base","preload!js!SBIS3.Contacts.MessagesSendViewBase.SideControlContainer","js!SBIS3.Contacts.Mixins.Interface.UnreadMessagesButton","js!SBIS3.Contacts.Mixins.Interface.UnreadMessagesCollector","js!SBIS3.Contacts.Mixins.Interface.SearchFormSupport","js!SBIS3.Contacts.Mixins.Services.Executor.BindSearch","js!SBIS3.Contacts.Mixins.Services.Site","js!SBIS3.Contacts.DomMessagesHelper","js!SBIS3.CONTROLS.ScrollContainer","js!SBIS3.CONTROLS.Browser","js!SBIS3.CONTROLS.SearchForm","js!SBIS3.Contacts.ScrollButton","css!SBIS3.Contacts.MessagesSendViewBase/Base"],function(t,i,e,o,n,s,r,h,l,d,a,g,c){"use strict";var f=18,_=98,S=400,u=150,C=n.extend([d,a,g,h,l],{_dotTplFn:s,$protected:{_options:{minBottomSideHeight:void 0,rightSideUnderTop:true,bottomSideUnderView:true,topSide:void 0,bottomSide:void 0,rightSideOpener:void 0,rightSide:void 0,middleView:void 0,rightSideWidth:250,sideAutoShow:"bottom",isVisibleScroll:true,debug:false,showScrollButton:false},_sideControls:{topSide:null,bottomSide:null,rightSideOpener:null,rightSide:null,middleView:null},_extContainer:null,_rightWasOpened:false,_lastContentHeight:0,_lastScrollContentMaxHeight:0,_lastBottomHeight:0,_rightSideConstructor:null,_minBottomSideHeight:_,_scrollAnimationInProgress:false,_logger:null,_scrollButton:null,_containers:{top:null,right:null,underTop:null,middle:null,bottom:null,view:null,rightOpener:null,viewScrollContent:null},_readyDef:null},$constructor:function(){if(this._publish("onRightAreaShow"),this._options.minBottomSideHeight)this._minBottomSideHeight=this._options.minBottomSideHeight},init:function(){C.superclass.init.call(this),this.register(["setRightSideOpenerVisible"]);var t=this,e=this.getContainer(),n=function(t,i){var e=t.find(i);return e.length>1?e.eq(0):e};if(this._containers.right=n(e,".rightSide"),!this.isRightSideUnderTop())e=n(e,".outerLeftSide");this._containers.top=n(e,".upSide"),this._containers.underTop=n(e,".underUpSideContainer-area"),e=this._containers.underTop,this._containers.bottom=n(e,".bottomSide"),this._containers.middle=n(e,".viewerContainer"),this._containers.view=n(this._containers.middle,'[name="scrollContainer"]'),this._containers.rightOpener=n(e,".rightOpener"),this.once("onDestroy",function(){if(this._sideControls)for(var t in this._sideControls)if(this._sideControls.hasOwnProperty(t))this._sideControls[t]=void 0;if(this._containers)for(t in this._containers)if(this._containers.hasOwnProperty(t))this._containers[t]=void 0;if(this._scrollButton&&this._scrollButton.isDestroyed&&!this._scrollButton.isDestroyed())this._scrollButton.destroy();this._scrollButton=void 0}.bind(this)),this.once("onBeforeShow",function(){var e=this.getBottomsideControl();if(setTimeout(function(){this._handleResizeEvent()}.bind(this),0),e)this.subscribeTo(e,"onResize",this._handleProcessResizeBottom.bind(this));if(this._options.middleView){var n=t.getViewScrollControl();if(this._options.rightSideOpener&&this._options.rightSide)this.subscribeTo(this.getRightsideOpenerControl(),"onSliderShow",this._handleShowOfRight.bind(this));if(this._containers.viewScrollContent=n?n.getContainer().children(".controls-ScrollContainer__content"):null,this._lastScrollContentMaxHeight=this.getScrollContentMaxHeight(),!!this._options.sideAutoShow&&e)i.fromTimer(500).addCallback(function(){if(!this.isDestroyed())this.subscribeTo(e,"onResize",o(this._onResizeBottomHandler.bind(this),250,true))}.bind(this));this.subscribeOnceTo(s,"onDrawItems",r)}if(this._readyDef)this._readyDef.callback()}),this.subscribeTo(this,"onResize",this._handleResizeEvent);var s=this.getViewControl();if(s)this.subscribeTo(s,"onResize",function(i){t.getScrollContentMaxHeight()}),this.subscribeTo(s,"onBeforeReload",function(t){if(this.isAllReady())t.setResult(true);else this._readyDef=new i,t.setResult(this._readyDef)}.bind(this))},getViewerContainer:function(){return this._containers.middle},changeMinimalBottomHeight:function(t,i){if(this._minBottomSideHeight!=t)if(this._minBottomSideHeight=t,!i){var e=this.getContainer().height();this._performMaxHeightsRecalc(e),this.resizeBottomMaxHeight(e)}},getScrollContentMaxHeight:function(){if(!this._containers.viewScrollContent||!this._containers.viewScrollContent.length)return null;var t=this._lastScrollContentMaxHeight,i=this._containers.viewScrollContent[0].clientHeight;if(!t||t<i)this._lastScrollContentMaxHeight=i;return this._lastScrollContentMaxHeight},getScrollButton:function(){if(!this._scrollButton&&this.hasChildControlByName("scrollButton"))this._scrollButton=this.getChildControlByName("scrollButton");return this._scrollButton},getViewScrollControl:function(){if(this.hasChildControlByName("scrollContainer"))return this.getChildControlByName("scrollContainer");return null},getTopsideControl:function(){return this._getSideControl("topSide")},getBottomsideControl:function(){return this._getSideControl("bottomSide")},getBottomsideScrollHeight:function(){var t=this.getBottomsideControl();return t&&"function"===typeof t.getScrolledContentHeight?t.getScrolledContentHeight():0},getRightsideOpenerControl:function(){return this._getSideControl("rightSideOpener")},getViewControl:function(){return this._getSideControl("middleView")},getRightsideControl:function(){var t=this._getSideControl("rightSide");return t?t.getSideControl():t},getUnderUpsideContainer:function(){return this._containers.underTop},hideShowRightSideOpener:function(t){var i=this.getRightsideOpenerControl();if(i)if(t)i.show(),this._containers.rightOpener.removeClass("ws-hidden");else i.hide(),this._containers.rightOpener.addClass("ws-hidden")},isViewBiggerThanViewport:function(){var t=this._getViewControlContentHeight();return this._containers.middle.height()<t},isBottomSideUnderView:function(){return!!this._options.bottomSideUnderView},isRightSideUnderTop:function(){return!!this._options.rightSideUnderTop},resizeBottomMaxHeight:function(t){var i=this.getBottomsideControl();if(i){var o=this.getViewControl(),n=t-(this._containers.top.length?this._containers.top.outerHeight():0),s=o?this._getViewControlContentHeight():0,r=i?this._containers.bottom.innerHeight():0,h=0,l=false,d=i&&this.isBottomSideUnderView(),a=s>=u?u:s;if(o)h=n-a;else h=n;if(!d)h=!d&&e.isMobilePlatform&&window.innerWidth>window.innerHeight&&S>4*window.innerHeight/9?Math.max(Math.ceil(4*window.innerHeight/9),this._minBottomSideHeight):S;if(n-h<a)h=n-a;if(h<this._minBottomSideHeight)h=this._minBottomSideHeight;if(h!==r)l=true;if(l)this._getLogger().log("resize of bottomside max-height required",h),this._changeMaxHeightOfBottomSide(h)}},rightPanelVisibility:function(t){var i=this.getContainer().find(".rightOpener");this._container.right[t?"removeClass":"addClass"]("ws-hidden"),i[!t?"removeClass":"addClass"]("ws-hidden")},scrollViewToRoot:function(t,i){if(this._scrollAnimationInProgress||!this._containers.viewScrollContent||!this._containers.viewScrollContent.length||!t)return;var e=this.getViewControl();if(e&&!e.isDestroyed()?e.isEdit():false)return;var o=this._containers.viewScrollContent,n=o[0].scrollTop,s=-1,r=false;if("top"===t)s=0,r=Math.ceil(s)<Math.ceil(n);else if("bottom"===t)s=o[0].scrollHeight-o[0].clientHeight,r=Math.ceil(s)>Math.ceil(n);if(r)this._scrollAnimationInProgress=true,this._getLogger().log("scrollViewToRoot","doing animate scroll to bottom"),$(o[0]).animate({scrollTop:s},0===i||i?i:150,function(){if(this._scrollAnimationInProgress=false,!(Math.ceil(o[0].scrollTop)===("top"===t?0:o[0].scrollHeight-o[0].clientHeight)))this.scrollViewToRoot(t,50)}.bind(this))},setWidthFiles:function(t,i){if(this._options.rightSideWidth!=t){var e=this._options.rightSide.config;if(this._options.rightSide.config=e.replace(/<opt name="widthFiles">[\s\S]+?<\/opt>/g,'<opt name="widthFiles">'+t+"</opt>"),!i&&this._options.rightSideWidth)this._options.rightSideWidth=t,this._containers.right.css("min-width",this._options.rightSideWidth+"px")}},isNeedScrollCompensation:function(t){var i=this,e=i._containers.viewScrollContent,o=!i._sideControls["middleView"]?i.getViewControl():i._sideControls["middleView"],n=o?o.getContainer().children(".controls-ListView__itemsContainer"):null,s,r,h;if(!e||!e.length||!o||o.isLoading()||!t||!n||!n.length)return null;if("top"===t)s=n.children(".contacts-ThemeMessage-row:not(.ws-hidden)").filter(":first");else if("bottom"===t)s=n.children(".contacts-ThemeMessage-row:not(.ws-hidden)").filter(":last");if(!s||!s.length)return null;return r={left:e.offset().left,top:e.offset().top,width:e[0].clientWidth,height:i.getScrollContentMaxHeight()+5},h=c.checkItemInViewport(s,o,r),h?h[t]>=0&&e[0].clientHeight<e[0].scrollHeight:false},seSetRightSideOpenerVisible:function(t){var i=this.getRightsideControl();if(!t||!i||!i.isVisibleWithParents())this.hideShowRightSideOpener(t);return{executed:true,result:true}},_getSideControl:function(t){if(!this._sideControls.hasOwnProperty(t)||!this._options.hasOwnProperty(t)||"rightSide"===t&&!this._rightWasOpened)return;if(!this._sideControls[t]&&this._options[t]&&this.hasChildControlByName(this._options[t].name))this._sideControls[t]=this.getChildControlByName(this._options[t].name);return this._sideControls[t]},_getViewControlContentHeight:function(){var t=this.getViewControl();return t?t.getContainer().height():0},_getViewControlContent:function(t){var i=this.getViewControl();return i?i.getContainer().children(t):null},moveFocusToEditor:function(){var t=this.getBottomsideControl(),i=t&&"function"===typeof t.isActiveRichEditor&&t.isActiveRichEditor();if(t&&"function"===typeof t.moveFocusToEditor&&!i)return t.moveFocusToEditor();return i},_changeMaxHeightOfBottomSide:function(t){var i=this.getBottomsideControl(),e=t;if(i){var o=this,n=function(t){o._getLogger().log("resize bottomside max-height set",t)};if("function"===typeof i.setMaximalHeight){if("function"!==typeof i.getMaximalHeight||i.getMaximalHeight()!==e||e>0&&this._containers.bottom.height()>e)i.setMaximalHeight(e),n(e)}else{var s=i.getContainer().children(":first");if(s.length)s.css("max-height",e),n(e)}}},_changeSomeSide:function(t,i,e,o){if(e&&e.length&&"function"===typeof e[i]&&t!=e[i]())if(e[i](t),o&&o._notifyOnSizeChanged)o._notifyOnSizeChanged()},_handleShowOfRight:function(){if(!this._options.rightSide||!this._options.rightSide.type)this._getLogger().error("_handleShowOfRight","right side control is not defined correctly in options");var t=new i;if(t.addCallback(function(){var t=this.getContainer();if(!this._sideControls.rightSide){if(!this._options.rightSide)throw'Не указана настройка контрола правой стороны в опции "rightSide"';if(this._options.rightSide&&!this._options.rightSide.config)this._options.rightSide.config={};var i=this._containers.right,e={controlType:this._options.rightSide.type,controlName:this._options.rightSide.name,controlOptions:this._options.rightSide.config,parent:this,visible:false,element:i};this._sideControls.rightSide=new this._rightSideConstructor(e),this._containers.right=this._sideControls.rightSide.getContainer()}if(this.hideShowRightSideOpener(false),this._rightWasOpened=true,this._options.rightSideWidth)this._containers.right.css("min-width",this._options.rightSideWidth+"px");this.subscribeOnceTo(this._sideControls.rightSide.getSideControl(),"onSliderHide",this._handleHideOfRight.bind(this)),this._notify("onRightAreaShow",this._sideControls.rightSide.getSideControl());var o=this.getViewControl().isScrollOnBottom(true);if(this._sideControls.rightSide.show(),o)this.scrollViewToRoot(this._options.sideAutoShow)}.bind(this)),this._rightSideConstructor||this._sideControls.rightSide)t.callback();else{var e=this._options.rightSide.type,o=this;if(-1==e.indexOf("js!"))e="js!"+e;require([e],function(){require(["js!SBIS3.Contacts.MessagesSendViewBase.SideControlContainer"],function(i){o._rightSideConstructor=i,t.callback()})})}},_handleHideOfRight:function(t,i){if(this._sideControls.rightSide)this._sideControls.rightSide.hide();this.getContainer().find(".rightSide").addClass("ws-hidden"),this.hideShowRightSideOpener(!i),this._containers.underTop.css("height","100%")},_handleProcessResizeBottom:function(t){var i=this.getContainer().height();this.resizeBottomMaxHeight(i)},_handleResizeEvent:function(){var t=this;if(t.isDestroyed&&!t.isDestroyed()&&!t._deferredResize&&t.isVisibleWithParents()){var i=t.getContainer().height();if(!e.isMobileIOS&&t._lastTotalHProcessed!==i||e.isMobileIOS&&(void 0===t._lastTotalHProcessed||Math.abs(t._lastTotalHProcessed-i)>1))t._performMaxHeightsRecalc(i),t._lastTotalHProcessed=i;if(void 0===t._deferredResize)t._deferredResize=true,setTimeout(function(){t._deferredResize=false,t._handleResizeEvent(),t._deferredResize=void 0}.bind(t),150)}},_performMaxHeightsRecalc:function(t){if(!(e.isOldWebKit&&(e.isMobileIOS||e.safari||e.isMobilePlatform)))return;var i=t-this._containers.top.outerHeight();if(this._containers.view.length){var o=this._containers.middle.css("max-height"),n=i-(this.getBottomsideControl()?this._minBottomSideHeight:0);if(n!==parseInt(o))this._containers.middle.css("max-height",n+"px")}if(e.isMobileIOS){var s=this._containers.underTop.css("max-height");if(i!==parseInt(s))this._containers.underTop.css("max-height",i+"px")}},_setLimitSizes:function(){if(this.getBottomsideControl())if(this.isBottomSideUnderView())this._changeMaxHeightOfBottomSide(0)},_resizeChecker:function(){var t=this.getContainer();if(this._lastHeight!==t.innerHeight()&&this.isVisibleWithParents())this._getLogger().log("resize контроль",[this._lastHeight,t.innerHeight()].join(" "))},_getLogger:function(){if(!this._logger)this._logger=t.resolve("ILogger");return this._options.debug||document.URL.indexOf("fix-")>0||document.URL.indexOf("test-")>0||document.URL.indexOf("dev-")>0?this._logger:{log:function(){},error:function(){this._logger.error.apply(this._logger,arguments)}}},_onResizeBottomHandler:function(){if(!this._containers.viewScrollContent||!this._options.sideAutoShow||!this._containers.viewScrollContent.length)return;var t=this.getBottomsideControl();if(t){var i=t.getContainer().height();if(void 0!==this._lastBottomControlHeight&&i<this._lastBottomControlHeight)return this._lastBottomControlHeight=i,void(this._lastScrollContentMaxHeight=this._containers.viewScrollContent[0].clientHeight);this._lastBottomControlHeight=i}if(this.isNeedScrollCompensation(this._options.sideAutoShow))this.scrollViewToRoot(this._options.sideAutoShow),this._lastScrollContentMaxHeight=this._containers.viewScrollContent[0].clientHeight}});return C});
//# sourceMappingURL=Base.module.js.map
define("js!Tags/Util/Constant",[],function(){"use strict";return{TYPE:{NOTES:1,TASKS:2,DIALOGS:3,VACANCY:4,NEWS:5,FORUM:6,EVENTS:7,BASE:8},TAG_COLOR:{16053492:"tag-List__color-white",16711680:"tag-List__color-red",16696895:"tag-List__color-yellow",7519812:"tag-List__color-green",5798576:"tag-List__color-blue"},SIMPLE_TAG_COLOR:{16053492:"default",16711680:"red",16696895:"yellow",7519812:"green",5798576:"blue"},ETC_TAG_WIDTH:30,INFOBOX_SHOW_DELAY:500,NEW_TAG_ID:"00000000-0000-0000-0000-000000000000",DEFAULT_COLOR:16053492,KEY_CREATE:13,MIN_HEIGHT:17,PART_TAGS:5,STANDART_TAGS_LINE_HEIGHT:34,SMALL_TAGS_LINE_HEIGHT:30,SERVER_CHANNEL:"tags.update"}});
//# sourceMappingURL=Constant.js.map
define("tmpl!Tags/SimpleList",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},a=function e(a,r,s,l,o){function c(){}var p=0,n=void 0!==t&&t?t:arguments[arguments.length-1];void 0===n&&(eval("var thelpers = null;"),n=global.requirejs("View/Runner/tclosure"));var g={};o&&o.isSetts&&(g=o.fullContext||{});var d="string"==typeof s?s:"",m=void 0===i?void 0:i,u={id:[],def:void 0},v=n.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,a),f=this&&this.includedTemplates?this.includedTemplates:{},h=n.getMarkupGenerator(l);try{var _=h.joinElements([h.createTag("div",{class:"tag-SimpleList "+n.wrapUndef(n.utils.escape(n.getter(a,["isSmallTags"])?"tag-SimpleList__small-tags":""))+" "+n.wrapUndef(n.utils.escape(n.getter(a,["showMilk"])?"tag-SimpleList__no-wrap":""))+" "+n.wrapUndef(n.utils.escape(n.getter(a,["showColor"])?"tag-SimpleList__show-color":""))},[h.createTag("div",{class:"tag-SimpleList__items"},[function(){for(var e=void 0,t=0;t<n.iterators.length&&!e;t++)n.iterators[t].is(n.utils.escape(n.getter(a,["items"])))&&(e=n.iterators[t].iterator);var i=[];return function(){var t=n.createScope(a);if(a=t,e){var r=s,o=0;e(n.utils.escape(n.getter(a,["items"])),function(e,t){n.presetScope(e,a,t,{value:"item"}),s&&void 0!==l&&l&&(s=r+"-for_"+o,o++);var c=[h.createTag("div",{class:"tag-SimpleList__item-container","data-id":""+n.wrapUndef(n.utils.escape(n.getter(a,["item","getId"]).apply(n.getter(a,["item"]),[])))},[h.createTag("div",{class:"tag-SimpleList__item "+n.wrapUndef(n.utils.escape(n.getter(a,["showColor"])?n.getter(a,["_getTagColor"]).apply(a,[n.getter(a,["item","Color"])]):""))+" "+n.wrapUndef(n.utils.escape(n.getter(a,["showBorder"])?"tag-SimpleList__show-border":"")),title:""+n.wrapUndef(n.utils.escape(n.getter(a,["item","ClearName"])||n.getter(a,["item","Name"])))},[h.createTag("div",{class:"tag-SimpleList__tag-name","data-id":""+n.wrapUndef(n.utils.escape(n.getter(a,["item","getId"]).apply(n.getter(a,["item"]),[])))},[h.createText(" "+n.wrapUndef(n.Sanitize.apply(void 0,[n.getDecorators().sanitize.apply(void 0,[n.getter(a,["item","Name"])])]))+" ")],{},u,this),n.getter(a,["canRemoveFromList"])?[h.createTag("div",{class:"tag-SimpleList__icon-close icon-16 icon-Close icon-primary",title:""+global.rk("снять тег"),"data-id":""+n.wrapUndef(n.utils.escape(n.getter(a,["item","getId"]).apply(n.getter(a,["item"]),[])))},[],{},u,this)]:h.createText("")],{},u,this)],{},u,this)];void 0===c[0]&&void 0!==l&&l||(i=i.concat(c))}.bind(a))}else i=""}.call(a),i}()],{},u,this),h.createTag("div",{class:"tag-SimpleList__etc-tag"},[h.createText(""+global.rk("..."))],{},u,this)],r,u,this)],d,u);u.def&&(_=h.chain(_,u,r),u=void 0)}catch(e){n.templateError("resources/Tags/SimpleList.tmpl",e,a)}return _||""};return a.includedFunctions={},a.stable=!0,a.toJSON=function(){return{$serialized$:"func",module:"tmpl!Tags/SimpleList"}},a});
//# sourceMappingURL=SimpleList.tmpl.map
define("js!Tags/SimpleList",["SBIS3.CONTROLS/CompoundControl","tmpl!Tags/SimpleList","js!Tags/Util/Constant","Core/constants","css!Tags/SimpleList"],function(t,i,o,e){"use strict";var n=t.extend({_dotTplFn:i,_renderTag:function(){this.rebuildMarkup(),setTimeout(this._calculateEtcTag.bind(this),0)},_removeFromTooltip:function(){var t=this.getProperty("list"),i=this.getProperty("tag").getId(),o=t.getItems(),e=o&&o.getCount();if(e)if(1===e)t._infobox.once("onHide",n),t._infobox.hide(0);else n();function n(){if(t._infobox)t._infobox.getContainer().find('.tags-SimpleList__tooltip-item[data-id="'+i+'"]').remove();t.getContainer().find('.tag-SimpleList__item-container[data-id="'+i+'"]').remove(),t._calculateEtcTag(),o.remove(o.getRecordById(i)),t._notify("onRemoveTag",i)}},_getTagColor:function(t){return"tags-SimpleList__color-"+o.SIMPLE_TAG_COLOR[t]},_calculateEtcTag:function(){var t=this.getContainer(),i=t[0].firstChild,e=this._options.showMilk,n,s,a;if(i){if(e)(n=$(i)).unbind(),a=i.offsetWidth<i.scrollWidth,t.toggleClass("tag-SimpleList__show-milk",a);else if(s=t.find(".tag-SimpleList__etc-tag"),a=i.scrollHeight>=o.MIN_HEIGHT,s.unbind(),t.toggleClass("tag-SimpleList__show-etc",a),a)n=s;if(a)this._setTooltipList(n)}},_setTooltipList:function(t){var i=this;t.bind({mouseenter:function(){i._showInfobox.apply(i,[t])}})},_showInfobox:function(t){var i=this,e=i._options;if(i._infobox&&"show"===i._infobox._getState())return;global.requirejs(["js!SBIS3.CORE.Infobox","tmpl!Tags/templates/infoboxTpl","Core/helpers/random-helpers"],function(n,s,a){i._infobox=n,n._onMoveTarget=function(){},n.once("onShow",i._onInfoboxShow.bind(i)),n.once("onHide",i._onInfoboxHide.bind(i)),n.once("onClose",i._onInfoboxHide.bind(i)),n.show({control:t,message:s({id:a.randomId(""),items:e.items,canRemoveFromList:e.canRemoveFromList,showColor:e.showColor,isSmallTags:e.isSmallTags,list:i,_getTagColor:e._getTagColor}),delay:o.INFOBOX_SHOW_DELAY,position:e.infoboxPosition||"bc",autoHide:true})})},_setEvents:function(){this.getContainer().on("click",this._clickEvents.bind(this))},_clickEvents:function(t){var i=t.target,o=i.className,e=i.attributes["data-id"],n=!!e,s=false;switch(true){case o.indexOf("tag-SimpleList__icon-close")>-1&&n:this.removeFromList(e.value),s=true;break;case o.indexOf("tag-SimpleList__etc-tag")>-1:this._onEtcClick(),s=true;break;case o.indexOf("tag-SimpleList__tag-name")>-1&&n:case o.indexOf("tag-SimpleList__tooltip-tag-name")>-1&&n:this._onTagClick(e.value),s=true;break;case o.indexOf("tag-SimpleList__item")>-1:case o.indexOf("tag-SimpleList__item-container")>-1:case o.indexOf("tag-SimpleList__items")>-1:}if(s)t.stopPropagation()},_onEtcClick:function(){if(e.browser.isMobilePlatform)this._showInfobox.apply(self,[this.getContainer().find(".tag-SimpleList__etc-tag")])},_onTagClick:function(t){if(this._infobox)this._infobox.hide(0);this._notify("onTagClick",t)},_onInfoboxShow:function(){var t=this;if(this._infobox)this._infobox.getContainer().bind({click:function(){t._clickEvents.apply(t,arguments)}});this._notify("onInfoboxShow")},_onInfoboxHide:function(){if(this._infobox)this._infobox.getContainer().unbind(),this._infobox=void 0;this._notify("onInfoboxHide")},_onResize:function(){this._calculateEtcTag()},_updateOption:function(t,i){this._options[t]=i,this._notifyOnPropertyChanged(t),this._renderTag()},_modifyOptions:function(t){if(void 0===t.canRemoveFromList)t.canRemoveFromList=true;if(void 0===t.isSmallTags)t.isSmallTags=true;return t=n.superclass._modifyOptions.apply(this,arguments),t},init:function(){this._publish("onRemoveTag","onInfoboxShow","onInfoboxHide","onTagClick"),n.superclass.init.apply(this,arguments),this._options._getTagColor=this._getTagColor;var t=this.getContainer(),i=this.getProperty("displayContainer");if(i)if(this._$displayContainer=t.closest(i),this._$displayContainer&&this._$displayContainer.length)this.subscribe("onResize",this._onResize);this._setEvents()},removeFromList:function(t){var i=this.getItems(),o;if(i&&i.getCount())if(o=i.getRecordById(t),o)i.remove(o),this._notify("onRemoveTag",t),this._renderTag()},getItems:function(){return this._options.items},getShowColor:function(){return this._options.showColor},getCanRemoveFromList:function(){return this._options.canRemoveFromList},getIsSmallTags:function(){return this._options.isSmallTags},setItems:function(t){this._updateOption("items",t)},setShowColor:function(t){this._updateOption("showColor",t)},setCanRemoveFromList:function(t){this._updateOption("canRemoveFromList",t)},setIsSmallTags:function(t){this._updateOption("isSmallTags",t)}});return n});
//# sourceMappingURL=SimpleList.js.map
define("tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/TagsBlock",["Core/tmpl/js/tclosure","js!Tags/SimpleList"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],a={};a["js!Tags/SimpleList"]=e[1];var r=function e(r,i,n,o,s){function l(){}var d=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var m={};s&&s.isSetts&&(m=s.fullContext||{});var g="string"==typeof n?n:"",p=void 0===a?void 0:a,h={id:[],def:void 0},u=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),f=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(o);try{var T=v.joinElements([v.createTag("div",{"data-bind":"visible : 'TagManager/"+c.wrapUndef(c.utils.escape(c.getter(r,["themeUUID"])))+"/visible'",class:"contacts-ThemeMessage__themeTags ws-hidden "+c.wrapUndef(c.utils.escape(c.getter(r,["className"])))},[v.createControl("wsControl","ws:Tags/SimpleList",{handlers:{onTagClick:c.getter(r,["activateHandler"]),onRemoveTag:c.getter(r,["removeHandler"]),onInfoboxShow:c.getter(r,["showInfoboxHandler"]),onInfoboxHide:c.getter(r,["hideInfoboxHandler"])},name:"ThemeTagList_"+c.getter(r,["themeUUID"]),className:"contacts-ThemeMessage__themeTags__list",bindings:[{fieldName:"TagManager/"+c.getter(r,["themeUUID"])+"/visible",propName:"visible",propPath:[],fullPropName:"visible",propPathStr:"",oneWay:!0,direction:"fromContext",bindNonExistent:!0},{fieldName:"TagManager/"+c.getter(r,["themeUUID"])+"/items",propName:"items",propPath:[],fullPropName:"items",propPathStr:"",oneWay:!0,direction:"fromContext",bindNonExistent:!0}],visible:!1,items:null,displayContainer:".contacts-ThemeMessage__themeTags",showColor:!0,activableByClick:!1,themeUUID:c.getter(r,["themeUUID"]),infoboxPosition:"br",esc:!1},{name:"ThemeTagList_"+c.getter(r,["themeUUID"]),sbisname:"ThemeTagList_"+c.getter(r,["themeUUID"])},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:u,internal:{__dirtyCheckingVars_0:c.getter(r,["activateHandler"]),__dirtyCheckingVars_1:c.getter(r,["removeHandler"]),__dirtyCheckingVars_2:c.getter(r,["showInfoboxHandler"]),__dirtyCheckingVars_3:c.getter(r,["hideInfoboxHandler"])}},n,p,f,c.config,m)],i,h,this)],g,h);h.def&&(T=v.chain(T,h,i),h=void 0)}catch(e){c.templateError("resources/Contacts.Mini/Models/templates/TagsBlock.tmpl",e,r)}return T||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/TagsBlock"}},r});
//# sourceMappingURL=TagsBlock.tmpl.map
define("js!SBIS3.Contacts.btnFolderTheme",["Core/js-template-doT","Core/helpers/string-helpers","js!SBIS3.CONTROLS.CompoundControl","css!SBIS3.Contacts.btnFolderTheme/MoveToFolder","i18n!SBIS3.Contacts.btnFolderTheme"],function(t,e,n){"use strict";var s=t.template('<div class="contacts-btnFolderTheme">'+"{[Перенести]}"+'<div id="contacts-btnFolderTheme_folderName" class="ws-hidden">'+"{[сейчас]}: <span>{{= it.nameFolder }}</span>"+"</div>"+"</div>"),o=n.extend({$protected:{_options:{nameFolder:""}},_dotTplFn:s,$constructor:function(){},init:function(){o.superclass.init.call(this),this.setData(this._options.nameFolder),this.subscribeTo(this,"onClick",function(){if(this.getParent())this.getParent().getContainer().click()})},setData:function(t){var n=this.getContainer(),s=n.find("#contacts-btnFolderTheme_folderName"),o=s.find("span");if(t)o.html(e.escapeHtml(t)),s.removeClass("ws-hidden"),n.addClass("contacts-btnFolderTheme_folder")},setGradientClass:function(t){(function(e){if(e[0]&&e[0].scrollWidth>e[0].clientWidth)e.addClass(t)})(this.getContainer().find("#contacts-btnFolderTheme_folderName"))}});return o});
//# sourceMappingURL=MoveToFolder.module.js.map
define("js!SBIS3.Contacts.FileAndMediaOpener",["Core/detection","Core/core-instance","Core/Deferred","js!WS.Data/Source/SbisService","js!WS.Data/Query/Query"],function(e,n,t,l,a){"use strict";var i={openFileById:function(e,n){var t;if(n)t=window.open("about:blank","_blank");if(n)i.getFolderLink(e).addCallbacks(function(e){if(e)t.location.href=e.get("url")},function(){t.close()});else i.openFullScreen(e)},openFileByMessage:function(e,n,t,o,r){var c=new l({endpoint:"Персона",binding:{query:"СписокСообщенийДляListView"}}),s={"ТипСписка":"theme","Тема":e,"Сообщение":n},d=(new a).where(s).offset(0).limit(1),u;if(r)u=window.open("about:blank","_blank");c.query(d).addCallback(function(e){var n=e.getAll().at(0);if(n)if(r){var l=n.get("ФайлыДляПревью"),a=l.getIndexByValue("msgFileId",t),o=l.at(a);if(o&&o.get("folder@"))i.getFolderLink(o.getId()).addCallbacks(function(e){if(e)u.location.href=e.get("url")},function(){u.close()})}else i.openFileByMessageRecord(n,t)})},openFileByMessageRecord:function(e,n){var t=e.get("Медиапослания"),l=e.get("МедиаФайлы"),a=e.get("ФайлыДляПревью"),o=t&&t.length?t[0]:null,r=l&&l.length?l[0]:null;if(o&&r&&("video"==o||"audio"==o)&&r==n)require(["vm!VideoContainer"],function(n){n.playModal("/vmsg/get?id="+e.get("МедиаФайлы")[0])});else if(a&&a.getCount()){var c=a.getIndexByValue("msgFileId",n),s=c>=0?a.at(c).get("attachId"):null;if(!s)return;i.openFullScreen(s,a)}},openFileByRecordSet:function(e,l,a,o){var r=new t;if(l&&n.instanceOfModule(e,"WS.Data/Collection/RecordSet")){var c=e.getIndexByValue(a||"attachId",l),s=c>=0&&e.at(c),d=s&&s.get("attachId"),u=s&&s.get("folder@");if(d)if(u){var f=window.open("about:blank","_blank");i.getFolderLink(d).addCallbacks(function(e){if(e)f.location.href=e.get("url");else f.close();r.callback()},function(e){f.close(),r.errback(e)})}else return i.openFullScreen(d,e,o);else r.errback()}else r.errback();return r},openFullScreen:function(n,l,a){var i=new t;return require(["js!SBIS3.DOCVIEW.Funcs"],function(t){t.openFullScreen({_options:{mainOptions:{objectName:"FileSD",serviceUrl:"/disk/api/v1/",isOneRec:!l,isDisk:!l,commands:{upload:true,edit:true,editInApp:true,print:!e.isMobilePlatform,rename:true,sendMessage:false,addPage:false,deleteDoc:false,deletePage:false,deletePermanentlyDoc:false,rights:true,restore:false,move:false,fullScreen:false,saveToPdf:false,copyToBuffer:true,signDocument:false}},listOptions:{defaultRecordPK:n}},handlers:a,recordSet:l}).addCallbacks(function(e){i.callback(e)},function(e){i.errback(e)})}),i},getFolderLink:function(e){return new l({endpoint:{address:"/disk/api/v1/service/",contract:"FileSD"}}).call("GetLinkInfo",{Id:e}).addCallback(function(e){return e&&e.getRow()})}};return i});
//# sourceMappingURL=FileAndMedia.module.js.map
define("js!SBIS3.SBISDISK.Helpers",[],function(){"use strict";return{openDocFromMessage:function(e,s,t){if("new"===t)var n=window.open("about:blank","_blank");require(["js!SBIS3.BL.FileSD","js!SBIS3.EDO.CD.CommonDocsHelpers","SBIS3.CONTROLS/Utils/InformationPopupManager"],function(o,a,i){o.ReadByObject(e).addCallbacks(function(e){if(0===e.get("Type")||2===e.get("Type")||"new"===t)o.GetPublicAccessRight(e.get("Id")).addCallbacks(function(e){if(n)n.location.href=e.get("HRef");else window.open(e.get("HRef"),"_blank")},function(e){n&&n.close(),i.showMessageDialog({status:"error",message:e.message,opener:s})});else s.getLinkedContext().setValue("isAuthorized",true),s.getLinkedContext().setValue("hasAccessRight",true),a.openDocumentViewer(e.get("Id"),s)},function(e){n&&n.close(),i.showMessageDialog({status:"error",message:e.message,opener:s})})})}}});
//# sourceMappingURL=Helpers.module.js.map
define("SBIS3.CONTROLS/Action/List/OpenEditDialog",["SBIS3.CONTROLS/Action/OpenDialog","Core/core-instance","Core/core-merge","Core/Indicator","Core/Deferred","WS.Data/Entity/Record","WS.Data/Di","SBIS3.CONTROLS/Action/Utils/OpenDialogUtil"],function(e,t,o,i,n,r,a,d){"use strict";var s=e.extend({$protected:{_options:{linkedObject:void 0,initializingWay:"remote",urlProperty:""},_linkedModelKey:void 0,_overlay:void 0,_setOpeningModeHandler:void 0,_showedLoading:false,_openInNewTab:false},$constructor:function(){this._publish("onUpdateModel","onDestroyModel","onCreateModel","onReadModel")},init:function(){s.superclass.init.apply(this,arguments),this._setOpeningModeHandler=this._setOpeningMode.bind(this),$(document).bind("keydown keyup",this._setOpeningModeHandler)},setLinkedObject:function(e){this._options.linkedObject=e},getLinkedObject:function(){return this._options.linkedObject},_getEditKey:function(e){},_setOpeningMode:function(e){this._openInNewTab=e.ctrlKey},_needOpenInNewTab:function(){return this._openInNewTab},_openComponent:function(e,t){var o=e.item&&e.item.get(this._options.urlProperty);if(this._needOpenInNewTab()&&o)window.open(o);else if(this._isNeedToRedrawDialog())this._saveRecord().addCallback(function(){s.superclass._openComponent.call(this,e,t)}.bind(this));else s.superclass._openComponent.call(this,e,t)},_saveRecord:function(){var e=this,t=arguments,o=new n,i,r;if(i=this._dialog._getTemplateComponent(),r=i?i.getRecord():null,r&&r.isChanged())return require(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(n){n.showConfirmDialog({message:rk("Сохранить изменения?")},e._confirmDialogHandler.bind(e,true,o,i,t),e._confirmDialogHandler.bind(e,false,o,i,t))}),o;else return o.callback()},_confirmDialogHandler:function(e,t,o){if(e)o.update({hideQuestion:true}).addCallback(function(){t.callback()});else t.callback()},_setModelId:function(e){if(this._linkedModelKey=e.id,e.hasOwnProperty("id"))e.id=this._getEditKey(e.item)||e.id},_createComponent:function(e,t){var o=e.componentOptions.initializingWay,i=e.template,n=this;function r(o){return n._remoteWayCallback(e,t,o).addCallback(function(){s.superclass._createComponent.call(n,e,t)})}function a(o){var i=n._delayedRemoteWayCallback(e,t,o);return s.superclass._createComponent.call(n,e,t),i}if(o==s.INITIALIZING_WAY_REMOTE||o==s.INITIALIZING_WAY_DELAYED_REMOTE)this._showLoadingIndicator(),require([i],function(e){var t;if(o==s.INITIALIZING_WAY_REMOTE)t=r(e);else t=a(e);t.addErrback(function(e){return n._finishExecuteDeferred(e),e}).addBoth(function(e){return n._hideLoadingIndicator(),e})});else s.superclass._createComponent.call(this,e,t)},_delayedRemoteWayCallback:function(e,t,o){var i=this._getRecordDeferred(e,o);if(i)e.componentOptions._receiptRecordDeferred=i;return(new n).callback()},_getRecordDeferred:function(e,t){return t.prototype.getRecordFromSource.call(t.prototype,e.componentOptions)},_remoteWayCallback:function(e,t,o){var i=this,r,a=void 0!==t.isNewRecord?t.isNewRecord:!e.componentOptions.key,s;if(o.prototype.getRecordFromSource){if(s=this._getRecordDeferred(e,o),s)return s.addCallback(function(t){if(e.componentOptions.record=t,e.componentOptions.isNewRecord=a,a)r=d.getOptionsFromProto(o,"getComponentOptions",e.componentOptions),e.componentOptions.key=i._getRecordId(t,r.idProperty);return t});return(new n).callback()}else return(new n).callback()},getEditRecordDeferred:function(e){var t=new n,o=this._getDialogConfig(e),i=this;return require([o.template],function(e){var n=i._getRecordDeferred(o,e);if(n)t.dependOn(n);else t.errback(new Error("Для получения записи необходимо задать опцию dataSource"))}),t},_showLoadingIndicator:function(){this._toggleOverlay(true),i.setMessage(rk("Загрузка"),true)},_hideLoadingIndicator:function(){this._toggleOverlay(false),i.hide()},_handleError:function(e){if(!e.processed)if(!e._isOfflineMode)d.errorProcess(e)},_toggleOverlay:function(e){if(!this._overlay)this._overlay=$('<div class="controls-OpenDialogAction-overlay ws-hidden"></div>'),this._overlay.css({position:"absolute",top:0,left:0,right:0,bottom:0,"z-index":9999,opacity:0}),this._overlay.appendTo("body");this._overlay.toggleClass("ws-hidden",!e)},_buildComponentConfig:function(e){this._setModelId(e);var i=(t.instanceOfModule(e.item,"WS.Data/Entity/Record")?e.item.clone():e.item)||null,n=s.superclass._buildComponentConfig.apply(this,arguments),r={isNewRecord:!!e.isNewRecord,source:e.source,record:i,handlers:this._getFormControllerHandlers(),initializingWay:e.initializingWay||this._options.initializingWay};if(e.readMetaData)r.readMetaData=e.readMetaData;if(e.id)r.key=e.id;if(e.filter)r.initValues=e.filter;if(e.dataSource)r.dataSource=e.dataSource;if(o(r,n),i)i.acceptChanges();return r},_getFormControllerHandlers:function(){return{onReadModel:this._actionHandler.bind(this,"onReadModel"),onUpdateModel:this._actionHandler.bind(this,"onUpdateModel"),onDestroyModel:this._actionHandler.bind(this,"onDestroyModel"),onCreateModel:this._actionHandler.bind(this,"onCreateModel")}},_onUpdateModel:function(e){},_updateModel:function(e,t){if(t.isNewRecord)this._createRecord(e,t.at||0,t);else this._mergeRecords(e,null,t)},_onReadModel:function(e){},_readModel:function(e){},_onDestroyModel:function(e){},_destroyModel:function(e,o){var i=this._getCollectionRecord(e,o),n=this.getLinkedObject();if(!i)return;if(t.instanceOfMixin(n,"SBIS3.CONTROLS/Mixins/MultiSelectable"))n.removeItemsSelection([this._getRecordId(i,o.idProperty)]);if(t.instanceOfModule(n.getItems&&n.getItems(),"WS.Data/Collection/RecordSet"))n=n.getItems();n.remove(i)},_onCreateModel:function(e){},_actionHandler:function(e,t,o,i){var r=Array.prototype.slice.call(arguments,2),a=this._notify.apply(this,[e].concat(r)),d=a,l;if(a!==s.ACTION_CUSTOM)d=(l=this["_"+e].apply(this,r))||a;if(d!==s.ACTION_CUSTOM&&this.getLinkedObject())if(d instanceof n)d.addCallback(function(t){this._processingResult(e,t,o,i)}.bind(this));else this._processingResult(e,d,o,i)},_processingResult:function(e,o,i,n){var r=this,a={onDestroyModel:"_destroyModel",onUpdateModel:"_updateModel",onReadModel:"_readModel"}[e];if(t.instanceOfModule(o,"WS.Data/Collection/RecordSet"))if(n.isNewRecord)n.isNewRecord=false,n.ignoreLinkedModelKey=true,o.each(function(e){r._createRecord(e,0,n)});else if(o.getCount())n.ignoreLinkedModelKey=true,o.each(function(e){r._mergeRecords(e,null,n)});else this._destroyModel(i);else if(t.instanceOfModule(o,"WS.Data/Entity/Record"))if(n.isNewRecord)r._createRecord(o,0,n);else r._mergeRecords(o,null,n);else if(a=o||a,this[a])this[a](i,n)},_createRecord:function(e,o,i){var n=this.getLinkedObject(),r;if(o=o||0,t.instanceOfModule(n.getItems(),"WS.Data/Collection/RecordSet"))r=a.resolve(n.getItems().getModel(),{adapter:n.getItems().getAdapter(),format:n.getItems().getFormat(),idProperty:n.getItems().getIdProperty()}),this._mergeRecords(e,r,i);else r=e.clone();if(t.instanceOfMixin(n,"WS.Data/Collection/IList"))n.add(r,o);else if(n.getItems())n.getItems().add(r,o);else if(n.isLoading())n.once("onItemsReady",function(){this.getItems().add(r,o)});else n.setItems([r])},_deepMergeRecords:function(e,t){t.deepMerge=true,this._updateModel(e,t)},_mergeRecords:function(e,t,o){var i=t||this._getCollectionRecord(e,o);if(i){if(o.isNewRecord)i.set(this._getCollectionData().getIdProperty(),o.key);this._mergeRecord(i,e,o)}},_mergeRecord:function(e,o,i){var n,a={},d=this;r.prototype.each.call(e,function(e,r){if(o.has(e))if(n=o.get(e),i.deepMerge&&t.instanceOfModule(n,"WS.Data/Entity/Record")&&t.instanceOfModule(r,"WS.Data/Entity/Record"))d._mergeRecord(r,n,i);else if(n!=r&&e!==o.getIdProperty()){if(n&&"function"==typeof n.clone)n=n.clone();a[e]=n}});try{e.set(a)}catch(e){if(!(e instanceof ReferenceError))throw e}},_collectionReload:function(){this.getLinkedObject().reload()},_getCollectionRecord:function(e,o){var i=this._getCollectionData(),n,r;if(o.ignoreLinkedModelKey||!this._linkedModelKey)n=this._getRecordId(e,o.idProperty);else n=this._linkedModelKey;if(i&&t.instanceOfMixin(i,"WS.Data/Collection/IList")&&t.instanceOfMixin(i,"WS.Data/Collection/IIndexedCollection"))return r=i.getIndexByValue(i.getIdProperty(),n),i.at(r);return},_getRecordId:function(e,t){if(t)return e.get(t);return e.getId()},_getCollectionData:function(){var e=this.getLinkedObject();if(t.instanceOfMixin(e,"SBIS3.CONTROLS/Mixins/ItemsControlMixin"))e=e.getItems();return e},_getDialogConfig:function(){var e=s.superclass._getDialogConfig.apply(this,arguments),t=this;return o(e,{isFormController:true,handlers:{onAfterClose:function(e,o){t._notifyOnExecuted(o,this._record),t._clearVariables()},onDestroy:t._clearVariables.bind(t)}})},_clearVariables:function(){this._isExecuting=false,this._finishExecuteDeferred(),this._dialog=void 0},destroy:function(){$(document).unbind("keydown keyup",this._setOpeningModeHandler),s.superclass.destroy.apply(this,arguments)}});return s.ACTION_CUSTOM="custom",s.ACTION_MERGE="_mergeRecords",s.ACTION_DEEP_MERGE="_deepMergeRecords",s.ACTION_ADD="_createRecord",s.ACTION_RELOAD="_collectionReload",s.ACTION_DELETE="_destroyModel",s.INITIALIZING_WAY_LOCAL="local",s.INITIALIZING_WAY_REMOTE="remote",s.INITIALIZING_WAY_DELAYED_REMOTE="delayedRemote",s});
//# sourceMappingURL=OpenEditDialog.js.map
define("js!SBIS3.Engine.SBISOpenDialogAction",["SBIS3.CONTROLS/Action/List/OpenEditDialog"],function(e){"use strict";var t=e.extend({$protected:{_options:{folderDialogComponent:"",folderEditMode:""}},execute:function(e){var o=e.itemType?this._options.folderDialogComponent:this._options.dialogComponent,i=e.itemType?this._options.folderEditMode:this._options.mode;return e.template=e.template||o,e.mode=e.mode||i,t.superclass.execute.apply(this,arguments)}});return t});
//# sourceMappingURL=SBISOpenDialogAction.module.js.map
define("js!SBIS3.Contacts.DocOpener",["Core/WindowManager","Core/Indicator","Core/moduleStubs","Core/Deferred","js!WS.Data/Source/SbisService","optional!js!SBIS3.EDO2.OpenDialogAction","js!SBIS3.CONTROLS.Utils.InformationPopupManager","js!SBIS3.SBISDISK.Helpers"],function(e,n,o,i,t,s,a,r){"use strict";var c,l;return c={MsgAccessDenied:function(){l=false,n.hide(),a.showMessageDialog({message:rk("Документ недоступен."),status:"error",details:rk("Возможно, документ был удален, или у вас нет доступа к этому документу компании.")})},MsgAccountChange:function(e){l=false,n.hide();var o=[],i=this,s,r,c;for(var d in e)if(e.hasOwnProperty(d)){if(!s)s=e[d]["userId"],r=e[d]["themeGUID"],c=e[d]["docGUID"];o.push(e[d]["name"])}if(1===o.length)var f=function(){return["<p style='color:#999999; text-align: center;'><strong style=\"color: #000;font-size: 18px;\">",o[0],'</strong><span style="padding-top: 8px;display: block;">',rk("Для просмотра данного документа перейдите в эту компанию."),"</span></p>"].join("")},u=rk("Документ доступен для компании:");else f=function(){return["<p style='color:#999999; text-align: center;'><strong style=\"color: #000;font-size: 18px;\">",o.join('</strong><br/><strong  style="color: #000;font-size: 18px;">'),'</strong><span style="padding-top: 8px;display: block;">',rk("Для просмотра данного документа перейдите в одну из этих компаний."),"<br/>",rk("Переход произойдет в первую из указанных компаний"),"</span></p>"].join("")},u=rk("Документ доступен для одной из компаний:");a.showConfirmDialog({message:u,detailsTemplate:f,positiveButton:{caption:rk("Перейти")}},function(){new t({endpoint:"Пользователь"}).call("ChangeUserProfile",{userId:s}).addCallbacks(function(e){var n=e.getRawData();if(n){var o=n.split("?"),i=o.length>1?o[1]:null;if(n=o[0],r)n+="open_dialog.html?guid="+r;else n+="opendoc.html?guid="+c;if(i)n+="&"+i;document.location.href=n}},function(e){i.MsgAccessDenied()})})},openDocById:function(e,n,o){return this.openDoc({doc:e,browser:n,tab:o})},_isTestStand:function(){var e=false,n;if(!!window&&!!window.location&&!!window.location.host)e=(n=(n=window.location.host).toLowerCase()).lastIndexOf("-")>-1;return e},_getStandPrefix:function(){var e="",n,o;if(!!window&&!!window.location&&!!window.location.host)if(o=String(window.location.host),o=o.toLowerCase(),n=o.lastIndexOf("-"),n>-1)e=o.substring(0,n+1);return e},_openDoc:function(e,i){var t=e.tab||false,a=e.msg?e.msg+e.theme:void 0,c=e.doc,d=null,f=this,u=e.browser||null;switch(e.openMode){case 0:d="new";break;case 1:d="dialog";break;case 2:case 3:d="current";break;case 4:d="float";break;default:d=void 0}if(-1==c.ДокументОбъектТипа)f.MsgAccessDenied(),n.hide(),l=false,i.callback();else try{if(l)l=rk("Открытие документа..."),n.setMessage(l);var p=parseInt(c["ДокументОбъектТипа"],10);if(-1!==[15,16].indexOf(p))return void require(["js!SBIS3.Engine.SBISOpenDialogAction"],function(e){l=false;var n=new e({dialogComponent:16===p?"js!SBIS3.Meetings.MeetingDialogNew":"js!SBIS3.Meetings.WebinarCard",mode:"floatArea",initializingWay:"remote"}),o={id:c.Документ,dialogOptions:{showOnControlsReady:true}};if(15===p)o["dataSource"]={endpoint:"Meeting",idProperty:"Id",binding:{read:"ReadWebinarWithInfo"}};n.execute(o),i.callback()});if(-1!==[5,6,7].indexOf(p))return void o.require(["js!SBIS3.Socnet.NewsHelpers"]).addCallback(function(e){e[0].openNewsDialog({id:c.Документ,comment:a?a:"",subType:c.subType},u),n.hide(),l=false,i.callback()}).addErrback(function(e){e.code=6,e.type="CANT_OPEN_NEWS",i.errback(e)});if(4===p)return void o.require(["TenderUI/Card/TenderCard/TenderCard"]).addCallback(function(e){e[0].getTenderCardByUUID(c.Документ,u),n.hide(),l=false,i.callback()}).addErrback(function(e){e.code=5,e.type="CANT_OPEN_TENDER",i.errback(e)});if(8==p){var g=[window.location.protocol,"//"];return g.push(f._getStandPrefix()),g.push(f._isTestStand()?"wi2.sbis.ru":"wi.sbis.ru"),g.push("/opendoc.html?guid="),g.push(c["Документ"]),window.open(g.join("")),n.hide(),l=false,void i.callback()}if(n.hide(),l=false,i.callback(),2!=c.ДокументОбъектТипа)if(s)(new s).execute({id:c["@Документ"],guid:c.Документ,openMode:e.openMode});else f.MsgAccessDenied();else r.openDocFromMessage(c.Документ,u,d)}catch(e){i.errback()}},openDoc:function(o){var s=this,a=o.doc,r=new i,c=a&&a["ТемаСообщения"],d=a&&a["Документ"];o.browser=o.browser||e.getActiveWindow();var f=function(){new t({endpoint:"Документ"}).call("СписокАккаунтовСДоступом",{"Документ":d}).addCallbacks(function(e){var n={},o=false;if(e.getAll().each(function(e){o=true,n[e.get("ExtId")]={cl:e.get("ClientId"),userId:e.get("UserId"),name:e.get("ClientName"),themeGUID:c,docGUID:d}}),o)s.MsgAccountChange(n);else s.MsgAccessDenied()},function(e){s.MsgAccessDenied()})};l=null,setTimeout(function(){if(l||null==l)l=l||rk("Проверка прав доступа..."),n.setMessage(l)},1e3);var u=function(e,i){new t({endpoint:"Документ"}).call("IsGroupExists",{"Группа":a.Документ}).addCallbacks(function(t){if(t.getRawData())require(["js!SBIS3.Socnet.Helpers"],function(e){l=false,n.hide(),i.callback(),e.openGroup(a.Документ,o.browser||null)});else i.errback(),e()},function(n){i.errback(),e()})};if(a&&null!=a.ДокументОбъектТипа)if(o.hasOwnProperty("openMode")&&0==o.openMode)s._openDoc(o,r);else if([0,1].indexOf(a.ДокументОбъектТипа)>=0)new t({endpoint:"Документ"}).call("КрасивыеНазванияДокументовПоUUID",{uuids:[a.Документ]}).addCallbacks(function(e){if(e){var n=e.getRow();if(n){var i=n.get("Тип");o.doc["ДокументОбъектТипа"]=16===i?0:i,s._openDoc(o,r)}else u(f,r)}else u(f,r)},function(e){u(s.MsgAccessDenied,r)});else if([9,10,11,20].indexOf(a.ДокументОбъектТипа)>=0)u(s.MsgAccessDenied,r);else s._openDoc(o,r);else r.errback(),f();return r}}});
//# sourceMappingURL=Document.module.js.map
define("js!SBIS3.Contacts.OpenerHelper",["js!SBIS3.Contacts.DocOpener","js!SBIS3.Contacts.FileAndMediaOpener"],function(e,n){"use strict";var t={openDocWithMsg:function(n,t,o,r,c,i,s,u,p,d){return e.openDoc({msg:n,theme:t,doc:{"Документ":o,"ДокументОбъектТипа":r,"ТемаСообщения":u,"@Документ":p,subType:d},browser:c,tab:i,openMode:s})},openDocById:function(e,n,o,r){return t.openDocWithMsg(null,null,e["Документ"],e["ДокументОбъектТипа"],n,o,e["ДокументИконка"]&&e["ДокументИконка"].indexOf("TFFolder")>-1?0:e["ДокументРежимОткрытия"],r,e["@Документ"],e["subType"])},openDocByModel:function(e,n){var o=n.getItems().isPairs()?e.get("СообщениеПоследнее"):null,r="chat/2"===e.get("Тип");return t.openDocWithMsg(o||e.get("Сообщение"),e.get("Тема"),r?e.get("ДокументРодитель"):e.get("Документ"),e.get("ДокументИдТипа"),n,true,e.get("ДокументИконка")&&e.get("ДокументИконка").indexOf("TFFolder")>-1?0:e.get("ДокументРежимОткрытия"))},openFileById:function(e,t){n.openFileById(e,t)},openFileByRecordSet:function(e,t,o,r){return n.openFileByRecordSet(e,t,o,r)}};return t});
//# sourceMappingURL=Helper.module.js.map
define("js!SBIS3.Contacts.SmallSearchPanel",["Core/EventBus","Lib/Control/FloatArea/FloatArea","js!SBIS3.CONTROLS.CompoundControl"],function(e,t,n){"use strict";return n.extend({$protected:{panel:null},hidePanel:function(){this.panel.hide()},open:function(n){var a=this,o={template:"js!SBIS3.Contacts.SmallSearchForm",componentOptions:{themeId:n.themeId,expanded:n.expanded,text:n.text},name:"SmallSearchForm",isStack:false,closeButton:true,parent:n.parent,autoHide:false,buildMarkupWithContext:false,showOnControlsReady:true,direction:"left",side:"left",controlsSide:"SmallSearchForm_floatarea_close_button",animation:"fade",animationLength:0,verticalAlign:"top",offset:{x:29,y:-10},target:n.parent.getContainer(),handlers:{onInit:function(){this.subscribeTo(e.channel("ticker"),"onTick",a._handlerOnTick.bind(this))},onBeforeShow:function(){this.getContainer().parent().addClass("SmallSearchForm_floatarea_border")},onCommandCatch:function(e,t){if("hide"===t)a._getSmallSearchForm().resetSearch()},onAfterShow:function(){var e=a._getSmallSearchForm(),t=e&&e.getSearchForm();if(t)t.setActive(true);if("function"==typeof n.onAfterShow)n.onAfterShow.bind(n.opener?n.opener:this)()}}};if(this.panel){if(n.text){var r=a._getSmallSearchForm();r.setText(n.text),r.applySearch()}this.panel.show();var i=this.panel.getChildControlByName("SmallSearchForm-WhomField");i._options.themeGUID=n.themeId,i.resetFilter(true)}else this.panel=new t(o)},resetSearch:function(e){this._getSmallSearchForm().resetSearch(!!e),this.hidePanel()},_getSmallSearchForm:function(){var e=this.panel;return e?e.hasChildControlByName("SmallSearchForm")&&e.getChildControlByName("SmallSearchForm"):null},_handlerOnTick:function(){var e=this;if(e.isVisible()&&!e.getParent().isVisibleWithParents())this.sendCommand("hide")}})});
//# sourceMappingURL=Panel.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.SmallSearch",["js!SBIS3.Contacts.Mixins.Services.Executor.Base","js!SBIS3.Contacts.SmallSearchPanel"],function(e,r){"use strict";return e.mergeMixin(e,{$protected:{_searchPanel:null},after:{init:function(){this.register(["openSmallSearch","closeSmallSearch"])}},seOpenSmallSearch:function(e){var a=this;if(!a._searchPanel)a._searchPanel=new r({});return a._searchPanel.open(e),{result:true,executed:true}},seCloseSmallSearch:function(e){var r=this;if(!r._searchPanel)return{result:null,executed:false};if(r._searchPanel._options.animationLength=0,e&&e.resetSearch)r._searchPanel.resetSearch(!!e.noLoad);else r._searchPanel.hidePanel();return{result:true,executed:true}}})});
//# sourceMappingURL=SmallSearch.module.js.map
define("js!Tags/Model",["WS.Data/Entity/Model","js!Tags/Util/Constant"],function(t,e){"use strict";return t.extend({_moduleName:"Tags/Model",_$idProperty:"Tag",_$properties:{FullColorClass:{get:function(){return"sprite:icon-16 icon-primary tag-List__color "+e.TAG_COLOR[this.get("Color")]}},ColorClass:{get:function(){return e.TAG_COLOR[this.get("Color")]}},IsVisible:{get:function(t){return t||true},set:function(t){return t}},IsTag:{get:function(){return true}}}})});
//# sourceMappingURL=Model.js.map
define("js!SBIS3.Contacts.ListTagManager",["Contacts.Base/Utils/Manager/DataLoaderBase","Core/IoC","js!WS.Data/Chain","js!WS.Data/Source/SbisService","Core/Deferred","js!Tags/Model"],function(t,e,i,n,a,s){"use strict";var r=t.extend({$protected:{_options:{view:null,items:null},_dataHandler:null,_collectFunction:null},init:function(){r.superclass.init.call(this)},_initSource:function(){return this._source=new n({endpoint:"Tag",model:s}),this._source},_prepareComponents:function(){r.superclass._prepareComponents.call(this),this._subscribeView(this.getView()),this._dataHandler=this._processTags,this.subscribe("onDestroy",function(){this._options.view=null,this._dataHandler=null,this._collectFunction=null})},_subscribeView:function(t){if(t.isDestroyed())return;this.subscribeTo(t,"onDataLoad",function(t,e){if(!e.isDestroyed()){var n=new i(e);this._collectFunction(n.toArray())}}.bind(this)),this.subscribeTo(t,"onItemsReady",function(){this._subscribeList(t.getItems())}.bind(this))},_subscribeList:function(t){var e=this;if(e._prevDataSet)e.unsubscribeFrom(e._prevDataSet,"onCollectionChange"),e._prevDataSet=null;e._prevDataSet=t,this.subscribeTo(t,"onCollectionChange",function(t,i,n){if("a"===i||"rp"===i)e._collectFunction(n)})},_collectData:function(t){if(t&&t.length){var i=t.map(function(t){return t.get("Тема")});this.getTagData(i).addCallback(function(t){if(t&&!Object.isEmpty(t)){var i=this.getView();try{if(i&&!i.isDestroyed())this._dataHandler(t)}catch(t){e.resolve("ILogger").error("ListTagManager._collectData",t.stack)}}}.bind(this))}},getTagData:function(t){var e=new a;if(t&&t.length)this._requestService(t).addCallback(function(i){var n=i&&i.getAll(),a={},s=[];if(n&&n.getCount())n.each(function(t){a[t.get("Entity")]=t.get("Tags"),s.push(t.get("Entity"))});t.filter(function(t){return-1===s.indexOf(t)}).forEach(function(t){a[t]=null}),e.callback(a)});else e.callback({});return e},_requestService:function(t){return this._source.call("GetTagsByObjects",{Objects:t,Type:3}).addErrback(function(t){e.resolve("ILogger").error("ListTagManager._requestService",t)})},_processTags:function(t){var e=function(t,e){if(t.getCount()!==e.getCount())return false;for(var i=true,n=["Color","Name"],a=t.getCount();a--;){var s=t.at(a),r=e.getRecordById(s.getId());if(!r)i=false;for(var o=n.length;o--;)if(s.get(n[o])!==r.get(n[o])){i=false;break}if(!i)break}return i},i=this.getView().getLinkedContext();for(var n in t)if(t.hasOwnProperty(n)){var a=t[n],s="TagManager/"+n,r=i.getValue(s);if(!r||!r.items||!a||!e(a,r.items))i.setValue(s,{items:a,visible:a&&!!a.getCount()})}}});return r});
//# sourceMappingURL=ListTagManager.module.js.map
define("js!SBIS3.Contacts.Models.MiniMembersModel",["Transport/prepareGetRPCInvocationURL","Core/helpers/string-helpers","js!SBIS3.Contacts.Models.MiniBaseModel","js!SBIS3.Contacts.CoreMiniFunctions","css!SBIS3.Contacts.Models.MiniBaseModel/styles/MemberItem"],function(t,e,i,o){return i.extend({_moduleName:"SBIS3.Contacts.Models.MiniMembersModel",$protected:{_proportions:null,_options:{isFull:false,photoSize:40,properties:{blockSize:{get:function(){return this._options.isFull},set:function(t){this._options.isFull=t,this._proportions=null}},departmentData:{get:function(){var t=o.isCurrentClient(this.get("Клиент"))&&!o.isInMySbis();return{id:t?this.get("departmentId"):this.get("КлиентИдентификаторСПП"),name:this.get("departmentName"),type:t?"department":"company",needIcon:!t&&this.get("needCheckOrgIcon")}}},departmentName:{get:function(){return o.isCurrentClient(this.get("Клиент"))&&!o.isInMySbis()?this.get("Отдел")?e.escapeHtml(this.get("Отдел")):"":this.get("КлиентНазвание")?e.escapeHtml(this.get("КлиентНазвание")):""}},departmentId:{get:function(){var t=this.get("Подразделение");if(void 0===t)t=this.get("ИдОтдел");if(void 0===t)t=this.get("Раздел");return t}},EmploymentName:{get:function(){return this.get("IsDepartment")?this.get("Отдел")?e.escapeHtml(this.get("Отдел")):"":this.get("КлиентНазвание")?e.escapeHtml(this.get("КлиентНазвание")):""}},IsDepartment:{get:function(){return o.isCurrentClient(this.get("Клиент"))&&!this._isPhysicFace}},needCheckOrgIcon:{get:function(){return o.isCurrentClient(this.get("Клиент"))||!this.get("КлиентНазвание")?false:true!==this.get("ОргПодтверждена")}},personData:{get:function(){var t=this.get("blockSize");return[{photoData:{oid:this.get("Персона"),size:this._options.photoSize},name:t?this.get("personName"):"",isBoldName:true,infoBottom:t?this.get("departmentName"):""}]}},photoData:{get:function(){return{oid:this.get("Персона"),size:this._options.photoSize}}},PersonName:{get:function(){return(this.get("Фамилия")||"")+" "+(this.get("Имя")||"")}},PhotoLink:{get:function(){var e=this.has("Фото")&&this.get("Фото");return e?o.getCachedPhotoUrl(e,this._options.photoSize):this.get("ФотоМини")?o.getCachedPhotoUrl(this.get("ФотоМини"),this._options.photoSize):t("Персона","ФотоПерсоны",{"Персона":this.get("Персона"),"МинСторона":this._options.photoSize})}},SrcSetPhotoLink:{get:function(){var e=this.has("Фото")&&this.get("Фото");return e?o.getCachedPhotoUrl(e,2*this._options.photoSize):this.get("ФотоМини")?o.getCachedPhotoUrl(this.get("ФотоМини"),2*this._options.photoSize):t("Персона","ФотоПерсоны",{"Персона":this.get("Персона"),"МинСторона":2*this._options.photoSize})}},Proportion:{get:function(){return this._proportions},set:function(t){this._proportions=t}}}}}})});
//# sourceMappingURL=Members.module.js.map
define("js!SBIS3.Contacts.Models.MembersModel",["Core/core-extend","js!SBIS3.Contacts.Models.MiniMembersModel","js!SBIS3.Contacts.Models.ExtendedBaseMixin"],function(e,t,o){var n=t.extend({_moduleName:"SBIS3.Contacts.Models.MembersModel",$protected:{_options:{employmentCardMode:"hoverClick",properties:{EmploymentId:{get:function(){return this.get("IsDepartment")?this.get("departmentId"):this.get("КлиентИдентификаторСПП")}}}}}});return e.mixin(n,[o])});
//# sourceMappingURL=Members.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.VideoCall",["Core/helpers/random-helpers","Core/helpers/fast-control-helpers","Core/Context","js!SBIS3.Contacts.Mixins.Services.Executor.Base","i18n!SBIS3.Contacts.Mixins.Services.Executor.VideoCall"],function(e,i,l,r){"use strict";return r.mergeMixin(r,{$protected:{_videoCall:null,_personArray:[]},before:{init:function(){this.subscribeTo(this,"onReady",function(){var e=this;require(["SBIS.VideoCall/Utils"],function(i){e._videoCall=i}),this.register(["videoCall"])})}},seVideoCall:function(r){var t=this,s=r.persons&&r.persons.length?r.persons.slice():t._personArray.slice(),o=s.length,n=l.global.getValue("mypersonid"),a;if(t._videoCall&&t._videoCall.isAvailable()){if(o){if(a=Array.indexOf(s,n),a>=0)s.splice(a,1);if(s.length>15)i.alert(rk("Нельзя звонить более чем 15 контактам"));else if(s.length)t._videoCall.initCall(s,{roomId:r&&r.themeGUID?r.themeGUID:e.createGUID(),dialogType:r&&r.dialogType?r.dialogType:"dialog"});else i.alert(rk("Самому себе звонить нельзя"))}}else i.alert(rk("Сервис видеосвязи недоступен"));return{result:true,executed:true}}})});
//# sourceMappingURL=VideoCall.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.MembersListShowing",["Core/IoC","js!SBIS3.Contacts.Mixins.Services.Executor.Base","i18n!SBIS3.Contacts.Mixins.Services.Executor.MembersListShowing"],function(e,i){"use strict";return i.mergeMixin(i,{$protected:{_allMembersPanel:null},before:{init:function(){this.subscribeTo(this,"onReady",function(){this.register(["membersListShowing"])})}},seMembersListShowing:function(i){var n={result:true,executed:true},t=function(i){e.resolve("ILogger").info("SBIS3.Contacts.Mixins.Services.Executor.MembersListShowing:",i)};if(this._allMembersPanel){if(i.animation)this._allMembersPanel._options.animation=i.animation;if(i.animationLength||0==i.animationLength)this._allMembersPanel._options.animationLength=i.animationLength;switch(i.action){case"show":if(!this._allMembersPanel.isShow())this._allMembersPanel.show();else n.result=false,t("Execution command ["+i.action+"] terminated, the panel already shows.");break;case"hide":if(this._allMembersPanel.isShow())this._allMembersPanel.hide();else n.result=false,t("Execution command ["+i.action+"] terminated, the panel already hidden.");break;case"close":if(!this._allMembersPanel._options.animationLength||"off"==this._allMembersPanel._options.animation)this._allMembersPanel.getContainer().addClass("ws-hidden");this._allMembersPanel.close();break;default:n.result=false,t("Execution command ["+i.action+"] terminated, unknown command.")}}else n.result=false,t("Execution command ["+i.action+"] terminated, panel is not exist.");return n}})});
//# sourceMappingURL=MembersListShowing.module.js.map
define("html!SBIS3.Contacts.Models.MiniBaseModel/templates/MemberItem",function(){var e=function(e){var t=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(t){for(;e.test(t);)t=t.replace(e,"&#123;&#123;$1&#125;&#125;");return t}}(),i=function(e){return e.join?e.join(""):e.toString()},o=function(e){return void 0===e?"":e&&"object"==typeof e?i(e):""+e},r="undefined"!=typeof process,n=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,""),s=(e.item.get("КонтактАктивностьОбъект"),e.item.get("blockSize")),a=e.item.get("photoData"),m=e.item.get("PersonName"),d=e.item.get("departmentName"),c=e.item.get("departmentData"),l=e.item.get("Proportion");return n+=' <div class="contacts-HeaderMember__item-row ',n+=s?"max-row":"mini-row",n+='" ',l&&(n+=' style="max-width: '+t(o(l))+'px" '),n+='> <div class="contacts-HeaderMember__person-info clearfix"> '+t(o(e.item._personPhoto({photoId:"member_photo_"+e.item.getId(),size:a.size,className:"contacts-HeaderMember__person-photo",photoURL:e.item.get("PhotoLink"),srcSetPhotoURL:e.item.get("SrcSetPhotoLink"),activity:e.item.get("ActivityData"),miniCardAttributes:e.item.get("ContactCardAttributes")})))+' <div style="padding-left: '+t(o(a.size+(m?6:0)))+"px; height: "+t(o(a.size))+'px;" ',40==a.size&&(n+=' class="large-photo" '),n+="> ",m&&(n+=' <div class="contacts-HeaderMember__person-name ws-ellipsis"> <div class="person-name ws-ellipsis"> '+t(o(e.item._escapeHtml(m)))+' <div class="contacts-HeaderMember__item-gradient" style="margin-left: -'+t(o(a.size))+"px;"+t(o(l?" left: "+(l-27)+"px":""))+'"></div> </div> </div> '),n+=" ",d&&(n+=' <div class="contacts-HeaderMember__person-info ws-ellipsis',c.needIcon&&(n+=" with-icon"),n+='"> '+t(o(e.item._personEmployment({employmentName:e.item.get("EmploymentName"),isDepartment:e.item.get("IsDepartment"),miniCardAttributes:e.item.get("EmploymentCardAttributes"),className:"person-place"})))+' <div class="contacts-HeaderMember__item-gradient" style="margin-left: -'+t(o(a.size+(c.needIcon?16:0)))+"px;"+t(o(l?" left: "+(l-27)+"px":""))+'"></div> </div> ',c.needIcon&&(n+=' <div class="contacts-HeaderMember__icon-wrapper"> <div class="icon-16 icon-Alert icon-disabled tooltips" title="'+t(o(rk("Организация не подтверждена")))+'"></div> </div> '),n+=" "),n+=" </div> </div> </div> ",(n=t(n))+(r&&-1!==n.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.Models.MiniBaseModel/templates/MemberItem"}},e});
//# sourceMappingURL=MemberItem.xhtml.map
define("html!SBIS3.Contacts.MiniHeaderMembers/HeaderMembers",function(){var e=function(e){var o=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(o){for(;e.test(o);)o=o.replace(e,"&#123;&#123;$1&#125;&#125;");return o}}(),t=function(e){return e.join?e.join(""):e.toString()},n=function(e){return void 0===e?"":e&&"object"==typeof e?t(e):""+e},i="undefined"!=typeof process,a=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="contacts-HeaderMember-container"> <component data-component="SBIS3.CONTROLS.ListView" name="horizontalView" class="contacts-HeaderMember__browser ws-browser-ignore-local-page-size controls-ListView__hideCheckBoxes"> <option name="showPaging">false</option> <option name="pageSize">30</option> <option name="ignoreLocalPageSize">true</option> <option name="imageField">Сообщение</option> <option name="displayField">Название</option> <option name="autoHeight">true</option> <option name="showHead">false</option> <option name="idProperty">Персона</option> <option name="itemContentTpl">html!SBIS3.Contacts.Models.MiniBaseModel/templates/MemberItem</option> <option name="itemsDragNDrop">false</option> <options name="itemsActions" type="array"></options> </component> <div class="contacts-HeaderMember__button-area" data-bind="style: {height: visibleData/height}"> <component data-component="SBIS3.CONTROLS.Link" name="DropListButton" class="contacts-HeaderMember__other-members__button"> <option name="icon">icon-24 icon-TFEmployees icon-primary</option> <option name="visible" bind="visibleData/isVisible">false</option> <option name="caption" bind="visibleData/count"/> <option name="tooltip">'+o(n(rk("Все участники")))+'</option> </component> </div> <div class="contacts-HeaderMember__height-init" data-bind="style: {height: visibleData/height}"></div> </div>');return(a=o(a))+(i&&-1!==a.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.MiniHeaderMembers/HeaderMembers"}},e});
//# sourceMappingURL=HeaderMembers.xhtml.map
define("js!SBIS3.Contacts.MiniHeaderMembers",["Core/core-extend","Core/core-instance","Core/helpers/random-helpers","Core/helpers/fast-control-helpers","Core/Context","Core/IoC","Core/Deferred","Core/helpers/Function/debounce","js!SBIS3.CONTROLS.CompoundControl","js!SBIS3.Contacts.CoreMiniFunctions","js!SBIS3.Contacts.Mixins.Services.Consumer","html!SBIS3.Contacts.MiniHeaderMembers/HeaderMembers","js!WS.Data/Source/Memory","js!SBIS3.Contacts.Models.MiniMembersModel","js!SBIS3.Contacts.CachingPersons","js!WS.Data/Chain","js!SBIS3.Contacts.Mixins.Services.Executor.MembersListShowing","css!SBIS3.Contacts.MiniHeaderMembers/HeaderMembers","js!SBIS3.CONTROLS.ListView","js!SBIS3.CONTROLS.Link","html!SBIS3.Contacts.Models.MiniBaseModel/templates/MemberItem"],function(e,t,i,s,o,n,r,a,l,h,_,f,d,u,m,c,p){"use strict";var b=l.extend({_dotTplFn:f,$protected:{_options:{photoSize:40,rightPadding:0,leftContainer:null,listComponent:"",listComponentContext:null,listComponentOptions:null,showButtonDefault:false,membersCount:null,isNew:false,notClickable:false,maxVisibleElements:0,showOnlyPhoto:false},_personArray:null,_drawPersonArray:[],_memberModel:null,_view:null,_maxWidth:0,_elementsWidth:0,_buttonAreaSize:60,_calculations:false,_rowMask:null,_initSource:false,_onShowDeferred:null,_showed:false,_allMembersPanel:null,_allMembersControl:null,_dropListButton:null,_dropListButtonContainer:null,_loadDef:null,_processedMembers:[],_defaultPhotoName:["default_face","invalid_photo_id","mini_face","Умлч_mini","Умлч_default"]},$constructor:function(){this._publish("onPersonClick","onAfterPersonDraw")},init:function(){b.superclass.init.call(this);var e=this.getChildControlByName("horizontalView");if(this._view=e,this.subscribeTo(e,"onItemClick",function(e,t,i,s){if(!this._options.notClickable){var o=["contacts-HeaderMember__person-photo","contacts-HeaderMember__person-name"];if(h.checkElementByClass(s,o)||h.checkElementByClass(s.parentElement,o))this._setReceivers(i);this._notify("onPersonClick",i)}}.bind(this)),this.subscribeTo(e,"onDataLoad",function(e,t){if(this._rowMask&&t&&t.getCount())this._view.once("onDrawItems",function(){this._rowMask.isApply=false,this.checkMembersMask()}.bind(this))}.bind(this)),this.hasChildControlByName("DropListButton"))this._dropListButton=this.getChildControlByName("DropListButton"),this._dropListButtonContainer=this._dropListButton.getContainer(),this.subscribeTo(this._dropListButton,"onActivated",this._onActivatedAllMembersHandler.bind(this));this.subscribeTo(this,"onResize",a(function(){if(this.recalcContainer()>100)this._startDraw();this.checkMembersMask()},100)),this.subscribeTo(this,"onAfterShow",function(){if(this.recalcContainer()>100)this._startDraw();if(this._initSource)this.checkMembersMask()}),this.subscribeTo(this,"onDestroy",function(){this._view=null}),this.subscribeTo(this,"onResize",function(){this.updateAllMembersList("setMaxSize")})},getViewControl:function(){if(!this._view&&this.hasChildControlByName("horizontalView"))this._view=this.getChildControlByName("horizontalView");return this._view},_startDraw:function(){if(!this._showed)if(this._showed=true,this._onShowDeferred)this._onShowDeferred.callback()},_setReceivers:function(e){var t={};t["addOrReplace"]=[e.get("Персона")||e.get("@Персона")],this.consume("changeReceivers",t)},recalcContainer:function(){var e=this.getContainer(),t=e.parent().width()-this._options.rightPadding;if(this._options.showOnlyPhoto&&this._options.leftContainer)t=e.parent().width()-this._options.rightPadding-this._options.leftContainer.width();return e.css({"max-width":"calc(100% - "+this._options.rightPadding+"px)"}),this._maxWidth=t,t},getMembersCount:function(e,t){return e?this._view.getContainer().find(".controls-ListView__item"+(t?" .max-row":"")).filter(":not(.ws-hidden)").length:null===this._options.membersCount?this._personArray?this._personArray.length:0:this._options.membersCount},setMembersCount:function(e,t){if(e&&"number"===typeof e)if(this._options.membersCount=t?this._options.membersCount+e:e,this._setButtonContextData(e-this.getMembersCount(true,true)),this._elementsWidth<50)if(!this._options.showOnlyPhoto)s.toggleLocalIndicator(this.getContainer(),true)},getPhotoSize:function(){return this._options.photoSize},setPhotoSize:function(e){if(this._options.photoSize===e)return false;return this._options.photoSize=e,this._initMembersModel(),this.recalcContainer(),this._loadMoreMembers(0,Math.floor(this._maxWidth/(e+8)),true),true},setLeftContainer:function(e){this._options.leftContainer=e},setNotClickable:function(e){var t=this,i=t._allMembersPanel?t._allMembersPanel.getName():null,s=t.getLinkedContext(),o=t._options.listComponentContext?s.getValue(t._options.listComponentContext["themeGUID"]):null,n=i&&o?i==="MembersList"+o:false,r=t._getAllMembersControl();if(t._options.notClickable=e,r&&n)r._options.notClickable=e},_executeAfterShow:function(e){if(e&&"function"===typeof e)if(this._showed)e.call(this);else{if(!this._onShowDeferred)this._onShowDeferred=new r;this._onShowDeferred.addCallback(e.bind(this))}},_initMembersModel:function(){var e=this._options.photoSize;this._memberModel=this._getModel().extend({_moduleName:"SBIS3.Contacts.Models.MembersModel",$protected:{_options:{photoSize:e,isFull:false}}})},_getModel:function(){return u},_createStaticSource:function(e){this._initMembersModel();var t=new d({data:e?e:[],model:this._memberModel,idProperty:"Персона"});if(this._initSource=true,this._view&&!this._view.isDestroyed())this._view.setDataSource(t)},_setItems:function(e){if(e&&e instanceof Array&&e.length){var t=this._view.getItems(),i=false;if(s.toggleLocalIndicator(this.getContainer(),true),this._rowMask=null,t&&t.getCount()){var o=new c(t).toArray(),n=this._options.showOnlyPhoto?o:o.filter(function(e){return-1===this._personArray.indexOf(e.getId())}.bind(this)),r=this._options.showOnlyPhoto?e:e.filter(function(e){return!t.getRecordById(e.getId())});if(n.length)this._removeItems(n),i=true;if(r.length)this._addItems(r,!this._options.showOnlyPhoto),i=true}else{var a=e.map(function(e){var t=new c(e).toObject();return t["КонтактАктивностьОбъект"]=null,t});this._createStaticSource(a),i=true}if(i)this.checkMembersMask();else s.toggleLocalIndicator(this.getContainer(),false);return true}return this._logError("_setItems","Переданный параметр не является массивом"),false},_addItems:function(e,i){if(!this._initSource)this._createStaticSource();var s,o=this._view.getItems(),n=this._view.getDataSource(),r=o.getFormat();this.eventsObserving(false);for(var a=0,l=e.length;a<l;a++)if(s=e[a],t.instanceOfModule(e[a],"WS.Data/Entity/Record")&&!o.getRecordById(s.get("Персона"))){var h=new c(e[a]),_=this._createMemberRecord(h.toObject(),r);o.add(_),n.update(_)}if(this.eventsObserving(true),!i)this.checkMembersMask()},_removeItems:function(e){var t=this._view.getItems(),i=this._view.getDataSource(),s=this;if(!t)return;e.forEach(function(e){var o;if("string"===typeof e)o=e,e=t.getRecordById(o);else o=e.getId();if(e&&t.getIndex(e)>=0)t.remove(e),i.destroy(o);else if(s._options.showOnlyPhoto){var n=s._processedMembers.indexOf(o);if(-1!==n)s._processedMembers.splice(n,1)}})},_membersCountGate:function(e,t){var i=e.length,s=[],o=this._options.maxVisibleElements;if(t)i+=this._drawPersonArray.length;if(o>0&&i>o)s=e.slice(0,o-this._drawPersonArray.length);else s=e.slice();return s},getItems:function(){return this._view.getItems()},setMembers:function(e,t,i){if(e&&e instanceof Array){if(i)this._options.maxVisibleElements=i;this._drawPersonArray=[];var s=this._membersCountGate(e);if(this._drawPersonArray=s,this._personArray=e,this._calculations=false,s.length)if(t&&t instanceof Array&&t.length)this._setItems(t);else this._executeAfterShow(function(){this.recalcContainer(),this._loadMoreMembers(0,Math.floor(this._maxWidth/(this._options.photoSize+8)),true)});else{var o=this._view.getItems();if(o&&o.getCount())o.clear();this._options.membersCount=null,this._setButtonContextData(0)}return true}return this._logError("setMembers","Переданный параметр не является массивом"),false},addMembers:function(e,t){var i=this,s=i.getItems();if(!this._options.showOnlyPhoto&&(!s||!s.getCount()))i.setMembers(e,t);if(e&&e instanceof Array&&e.length){for(var o=i._personArray.length,n=0,r=[],a=0,l=e.length;a<l;a++)if(-1===i._personArray.indexOf(e[a]))i._personArray.push(e[a]),r.push(e[a]),n++;var h=i._membersCountGate(r,true);if(this._drawPersonArray=this._drawPersonArray.concat(h),this._calculations=false,o===i._personArray.length)return false;if(t&&t instanceof Array&&t.length)i._addItems(t);else this._executeAfterShow(function(){if(this.recalcContainer(),this.updateAllMembersList("addMembers",e),h.length)m.getPersonsFromCache(h.slice(0,15)).addCallback(function(e){if(i._options.showOnlyPhoto){for(var t=[],s=0;s<e.length;s++)if(i._isPhotoNotDefault(e[s]))t.push(e[s]);else if(-1===i._processedMembers.indexOf(e[s].getId()))i._processedMembers.push(e[s].getId());if(t.length)i._addItems(t)}else i._addItems(e)})});if(null!==this._options.membersCount)this.setMembersCount(this._options.membersCount+n);else if(h.length!==e.length)this._setButtonContextData(h);return true}return this._logError("addMembers","Переданный параметр не является массивом"),false},removeMembers:function(e){if(e&&e instanceof Array){for(var t,i,s=0,o=e.length;o--;){if(i=e[o],"string"!==typeof i){this._logError("removeMembers","Элемент переданного массива не является строчным идентификатором");continue}if(t=this._personArray.indexOf(i),t>=0)this._personArray.splice(t,1),s++;if(t=this._drawPersonArray.indexOf(i),t>=0)this._drawPersonArray.splice(t,1)}if(this._removeItems(e),s){var n=Math.floor((this._maxWidth-this._elementsWidth)/(this._options.photoSize+8));if(n>0)this.recalcContainer(),this._loadMoreMembers(this.getMembersCount(true),n);else this._setButtonContextData(this.getMembersCount(true))}if(null!==this._options.membersCount)this.setMembersCount(this._options.membersCount-s);return this.updateAllMembersList("removeMembers",e),true}else this._logError("removeMembers","Переданный параметр не является массивом");return false},_getMaskData:function(e,t,i){if(!i)i=0;var s=this,o=s._options.photoSize+111+14,n=s._options.photoSize+8,r=t>550?3:2,a=t%o,l=Math.floor(t/n),h=Math.floor(t/o);if(s._options.showOnlyPhoto)h=0,l=l<e?l:e;else{if(e>h)if(l<=e)h=0;else{h=0,l=e;while(t-((h+1)*o+(l-1)*n)>0)h++,l--}if(0===i&&(e<=r||t/e>=o))h=e,l=0;else if(l<=1)h-=1,l=Math.floor((a+o)/n),l-=h+l-e>0?h+l-e:0}return{full:h,mini:l,visible:h+l,width:t,freeSpace:t-h*o-l*n}},_getRowMask:function(e){if(this._maxWidth<=0)return null;var t=this._drawPersonArray.length,i=t,s=this._options.showButtonDefault,o=this._maxWidth,r=this._getMaskData(i,s?o-this._buttonAreaSize:o,e);if(r.mini){if(!s)this._setButtonContextData(r.mini),r=this._getMaskData(i,o-this._buttonAreaSize,e)}else this._setButtonContextData(r.mini);return r["repeat"]=e,r["count"]=t,r["maxWidth"]=this._maxWidth,r["isApply"]=false,this._rowMask=r,n.resolve("ILogger").info("MiniHeaderMembers._getRowMask",r,"при ширине: "+o),r},_applyRowMask:function(e){var t=this._view.getItems();if(!this._view.hasEventHandlers("onDrawItems"))this.subscribeTo(this._view,"onDrawItems",this._onDrawItemsHandler.bind(this));if(e&&t){var i=t.getCount(),s,o,n=this.getContainer();if(i<e.visible&&!this._options.maxVisibleElements)this._loadMoreMembers(i,e.visible-i,false);else{e.isApply=true;for(var r=0,a=t.getCount();r<a;r++){if(s=t.at(r),!s)continue;if(o=n.find('.controls-ListView__item[data-id = "'+s.getId()+'"]').removeClass("ws-hidden").find(".contacts-HeaderMember__item-row"),r<e.full)s.set("blockSize",true),o.removeClass("mini-row").addClass("max-row");else s.set("blockSize",false),o.removeClass("max-row").addClass("mini-row");o.attr("style",""),o.find(".contacts-HeaderMember__item-gradient").css("left","")}this._onDrawItemsHandler()}}},checkMembersMask:function(){if(!this._view)return;var e=this._rowMask,t=this._drawPersonArray.length,i;if(!e||e&&(e.maxWidth<this._maxWidth-this._options.photoSize+8||e.maxWidth>this._maxWidth||e.count!==t||t<e.full))i=this._getRowMask(0),this._applyRowMask(i);else if(!e.isApply)this._applyRowMask(e)},_onDrawItemsHandler:function(){var e=this,t=e._rowMask,i=e._view.getContainer(),o=i.find(".controls-ListView__item");if(e._options.showOnlyPhoto)$(o[0])[1===o.length?"addClass":"removeClass"]("ws-hidden");if(!t)return;var n=e.getContainer(),r=e._view.getItems(),a=[],l=0,h=e._options.photoSize,_=o.find(".max-row").length===t.full,f,d,u=0,m=e._personArray.length&&t.mini||e._options.maxVisibleElements&&e._personArray-e._drawPersonArray;e._setButtonContextData(m);var c=e._maxWidth-e._buttonAreaSize,p=false;if(o.length){if(o.each(function(i,s){var o=$(s),n=o.outerWidth();if(i>=t.visible&&u+n>c)o.addClass("ws-hidden");else if(_){var r=o.children(".max-row");if(r.length){var f=r.find(".contacts-HeaderMember__person-name").width(),d=r.find(".contacts-HeaderMember__person-info .person-place").width()||0,m=f>d?f:d,p=r.outerWidth(),b=e._options.photoSize+107+14;l+=m+h,a.push({id:o.data("id"),el:r,width:m+h,outerWidth:p>b?b:p})}}u+=n}),p=!e._elementsWidth,p||Math.abs(e._elementsWidth-u)>10)e._elementsWidth=u;if(t.freeSpace>5&&t.width-e._elementsWidth>10)for(var b=a.length;b--;)d=a[b].width/(l/100),f=a[b].outerWidth+t.freeSpace/100*d,a[b].el.css({"max-width":f+"px"}),a[b].el.find(".contacts-HeaderMember__item-gradient").css({left:f-27+"px"}),r.getRecordById(a[b].id).set("Proportion",f);var M=i.find(".controls-ListView__item").filter(":not(.ws-hidden)").length;if(e._options.showButtonDefault)e._setButtonContextData(e._personArray.length-M);else if(p)e._setButtonContextData(m);s.toggleLocalIndicator(n,false),e._notify("onAfterPersonDraw")}},updateAllMembersList:function(e,t){if(this._allMembersPanel){var i=this._allMembersPanel.isShow(),s;switch(e){case"removeMembers":case"addMembers":if(s=this._getAllMembersControl(),s){if(this._options.isNew){var o=s.getMembersList(true);if(o){var n=o.getFilter();n["Персоны"]=this._personArray,o.setFilter(n,true)}}if("function"===typeof s.updateMembers)s.updateMembers(t,e,this.getMembersCount())}break;case"setMaxSize":if(i)if(s=this._getAllMembersControl(true),s&&this._dropListButtonContainer){var r=this._dropListButtonContainer.offset();s.setMaxSize({width:r.left+this._dropListButtonContainer.width(),height:document.body.clientHeight-r.top})}}}},_setAllMembersPanel:function(e,t){var i=this;this._allMembersPanel=e,this.subscribeOnceTo(this._allMembersPanel,"onAfterShow",function(){if(i._allMembersControl=i._getAllMembersControl(),t)for(var e in t)if(t.hasOwnProperty(e))i._allMembersControl._options[e]=t[e];i.updateAllMembersList("setMaxSize")})},_getAllMembersControl:function(e){if(this._allMembersControl&&e)return this._allMembersControl;else if(this._allMembersPanel)if(this._allMembersPanel.hasChildControlByName("AllMemberContactList"))return this._allMembersControl=this._allMembersPanel.getChildControlByName("AllMemberContactList"),this._allMembersControl;return null},_onActivatedAllMembersHandler:function(){var e=this;if(e._options.listComponent&&"string"===typeof e._options.listComponent){if(e._allMembersPanel&&e._allMembersPanel.isShow&&e._allMembersPanel.isShow()&&e._allMembersPanel.isDestroyed&&!e._allMembersPanel.isDestroyed())return void e._allMembersPanel.hide();var t=e._options.listComponentContext,n=e._options.listComponentOptions||{};if(Object.isEmpty(n)&&t&&"object"===typeof t){var r=e.getLinkedContext();for(var a in t)if(t.hasOwnProperty(a))n[a]=r.getValue(t[a])}if(n["isMember"]=e._personArray.indexOf(o.global.getValue("mypersonid"))>=0,n["contextFields"]={counterVisible:"visibleData/isVisible",counterCaption:"visibleData/count"},n["handlers"]={onClickDialogMembers:function(e,t){if(!this._options.notClickable&&!this._options.isNew)this._setReceivers(t)}.bind(e)},e._options.isNew)n["contacts"]=e._personArray,n["notClickable"]=true;else n["notClickable"]=e._options.notClickable;s.showFloatArea({template:e._options.listComponent,name:"MembersList"+(n.hasOwnProperty("themeGUID")?n.themeGUID:i.createGUID()),fitWindow:"horizontal",flipWindow:false,autoHide:true,parent:e.getChildControlByName("DropListButton"),target:this._dropListButtonContainer,direction:"bottom",side:"right",verticalAlign:"top",offset:{x:0,y:0},componentOptions:n}).addCallback(function(t){e._setAllMembersPanel(t,n)})}},_setButtonContextData:function(e){var t=this.getMembersCount(),i=this.getContainer(),s=this._options.showOnlyPhoto?true:this._elementsWidth>50&&(this._options.showButtonDefault||!!e);this.getLinkedContext().setValue("visibleData",{count:t>999?"999+":t,isVisible:s,height:this._options.photoSize+8});var o=i.children(".contacts-HeaderMember__button-area").outerWidth(true)||42;if(i.css({"padding-right":s?o+"px":"0px"}),this._buttonAreaSize!==o)if(this._buttonAreaSize=o,this._drawPersonArray.length)this._applyRowMask(this._getRowMask());if(this._dropListButton)this._dropListButton.setTooltip(rk("Все участники"))},_createMemberRecord:function(e,t,i){if(!this._memberModel)this._initMembersModel();return new this._memberModel({adapter:"adapter.json",rawData:e,idProperty:"Персона",format:t,photoSize:this._options.photoSize,isFull:i})},_isPhotoNotDefault:function(e){for(var t=e.get("ФотоМини"),i=0;i<this._defaultPhotoName.length;i++)if(!t||-1!==t.indexOf(this._defaultPhotoName[i]))return false;return true},_loadMoreMembers:function(e,t,i){if(i)this._processedMembers=[];var o=this._processedMembers.length;if(this._options.showOnlyPhoto&&!i&&this._drawPersonArray.length<=e+o)return s.toggleLocalIndicator(this.getContainer(),false),void this._notify("onAfterPersonDraw");var n=this,r=this._view.getItems(),a=!this._options.showOnlyPhoto&&r&&!i?n._drawPersonArray.filter(function(e){return!r.getRecordById(e)}):n._drawPersonArray,l=n._options.showOnlyPhoto&&!i?e+o:0,h=a.slice(l,l+t),_=this._getMemberRecords(h);if(_)_.addCallback(function(e){if(!this.isDestroyed())if(this._loadDef=null,e.length)if(n._options.showOnlyPhoto){for(var s=[],o=0;o<e.length;o++)if(n._isPhotoNotDefault(e[o]))s.push(e[o]);else if(-1===n._processedMembers.indexOf(e[o].getId()))n._processedMembers.push(e[o].getId());if(i&&r&&r.getCount())n._removeItems(new c(r).toArray());if(s.length)n[i?"_setItems":"_addItems"](s);else if(i&&n._drawPersonArray.length<=t)this._notify("onAfterPersonDraw")}else n[i?"_setItems":"_addItems"](e)}.bind(this));else if(!this._loadDef)this.checkMembersMask()},_getMemberRecords:function(e){if(e.length&&!this._loadDef)return this._loadDef=m.getPersonsFromCache(e),this._loadDef;return null},eventsObserving:function(e){var t=this._view.getItems();if(t.isEventRaising()!==e)return t.setEventRaising(e,true),true;return false},_logError:function(e,t){n.resolve("ILogger").log("MiniHeaderMembers."+e,t)}});return e.mixin(b,[_,p])});
//# sourceMappingURL=HeaderMembers.module.js.map
define("js!SBIS3.Contacts.HeaderMembers",["Core/core-extend","js!SBIS3.Contacts.MiniHeaderMembers","js!SBIS3.Contacts.Models.MembersModel","js!SBIS3.Contacts.PersonActivityManager","js!SBIS3.Contacts.Mixins.Services.Executor.VideoCall"],function(t,e,s,n,i){"use strict";var o=e.extend({$protected:{_options:{},_pa:null},$constructor:function(){},init:function(){o.superclass.init.call(this),this._pa=new n({view:this._view,personGUIDGetter:function(){return this.get("Персона")}}),this.subscribeTo(this,"onDestroy",function(){if(this._pa)this._pa.destroy(),this._pa=null})},_getModel:function(){return s}});return t.mixin(o,[i])});
//# sourceMappingURL=Members.module.js.map
define("js!SBIS3.CONTROLS.ContextMenu",["SBIS3.CONTROLS/Menu/ContextMenu"],function(n){return n});
//# sourceMappingURL=ContextMenu.module.js.map
define("js!SBIS3.CONTROLS.CommandsButton",["SBIS3.CONTROLS/Commands/CommandsButton"],function(n){return n});
//# sourceMappingURL=CommandsButton.module.js.map
define("SBIS3.CONTROLS/Action/List/Mixin/ListMixin",["Core/core-instance"],function(t){"use strict";return{$protected:{_options:{linkedObject:void 0,dataSource:void 0}},getLinkedObject:function(){return this._options.linkedObject},setLinkedObject:function(t){this._options.linkedObject=t},getDataSource:function(){if(this._options.dataSource)return this._options.dataSource;if(t.instanceOfMixin(this.getLinkedObject(),"SBIS3.CONTROLS/Mixins/ItemsControlMixin"))return this.getLinkedObject().getDataSource()},setDataSource:function(t){this._options.dataSource=t},getSelectedItems:function(){if(!this.getLinkedObject())return[];if(t.instanceOfMixin(this.getLinkedObject(),"SBIS3.CONTROLS/Mixins/MultiSelectable")){var e=this.getLinkedObject().getSelectedItems(false),i=[];if(e&&e.getCount())return e.each(function(t){i.push(t)}),i}if(t.instanceOfMixin(this.getLinkedObject(),"SBIS3.CONTROLS/Mixins/Selectable")){var n=this.getLinkedObject().getSelectedKey(),c=this.getLinkedObject().getItems().getRecordById(n);return c?[c]:void 0}},_getItems:function(){var e=this.getLinkedObject();if(t.instanceOfModule(e,"SBIS3.CONTROLS/ListView"))return this.getLinkedObject().getItems();return this.getLinkedObject()},_getListView:function(){var e=this.getLinkedObject();if(t.instanceOfModule(e,"SBIS3.CONTROLS/ListView"))return e;return}}});
//# sourceMappingURL=ListMixin.js.map
define("SBIS3.CONTROLS/Action/List/Move",["SBIS3.CONTROLS/Action","SBIS3.CONTROLS/Action/List/Mixin/ListMixin","SBIS3.CONTROLS/ListView/resources/Mover","WS.Data/Di","Core/core-instance"],function(t,e,o,i,r){"use strict";return t.extend([e],{$protected:{_options:{moveStrategy:void 0},_mover:null},$constructor:function(){this._publish("onBeginMove","onEndMove")},_move:function(){},getMoveStrategy:function(){return this._moveStrategy||(this._moveStrategy=this._makeMoveStrategy())},setMoveStrategy:function(t){if(!r.instanceOfMixin(t,"WS.Data/MoveStrategy/IMoveStrategy"))throw new Error("The strategy must implemented interfaces the WS.Data/MoveStrategy/IMoveStrategy.");this._moveStrategy=t},_getMover:function(){if(!this._mover){var t=this._getListView();if(t)this._mover=t;else this._mover=o.make(this,{moveStrategy:this.getMoveStrategy(),items:this._getItems(),parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty,dataSource:this.getDataSource()})}return this._mover},_makeMoveStrategy:function(){if(this._options.moveStrategy)return i.resolve(this._options.moveStrategy,{dataSource:this.getDataSource(),hierField:this._options.parentProperty,parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty,listView:this._getListView()})}})});
//# sourceMappingURL=Move.js.map
define("SBIS3.CONTROLS/Action/List/InteractiveMove",["SBIS3.CONTROLS/Action/List/Move","SBIS3.CONTROLS/Action/Mixin/DialogMixin","Core/helpers/string-helpers","Core/Indicator","Core/core-merge","Core/IoC","Core/core-instance","Core/constants","SBIS3.CONTROLS/Utils/InformationPopupManager"],function(e,t,o,i,n,s,r,p,c){"use strict";var l=e.extend([t],{$protected:{_options:{template:"SBIS3.CONTROLS/Action/resources/SelectionDialog",parentProperty:void 0,nodeProperty:void 0,componentOptions:null}},_modifyOptions:function(e){if(e.hierField)s.resolve("ILogger").log("InteractiveMove","Опция hierField является устаревшей, используйте parentProperty"),e.parentProperty=e.hierField;if(e.parentProperty&&!e.nodeProperty)e.nodeProperty=e.parentProperty+"@";if(e.componentOptions&&e.componentOptions.keyField)s.resolve("ILogger").log("InteractiveMove","Опция componentOptions.keyField является устаревшей, используйте componentOptions.idProperty"),e.componentOptions.idProperty=e.componentOptions.keyField;if(e.componentOptions&&e.componentOptions.displayField)s.resolve("ILogger").log("InteractiveMove","Опция componentOptions.displayField является устаревшей, используйте componentOptions.displayProperty"),e.componentOptions.displayProperty=e.componentOptions.displayField;return l.superclass._modifyOptions.apply(this,arguments)},_doExecute:function(e){if(e=e||{},e.movedItems=e.movedItems||e.records||this.getSelectedItems(),!e.movedItems||e.movedItems instanceof Array&&0==e.movedItems.length)return void c.showMessageDialog({message:rk("Не выбрано ни одной записи для перемещения."),status:"default"});return l.superclass._doExecute.call(this,e)},_buildComponentConfig:function(e){var t=n(e.componentOptions||{},this._getComponentOptions()),o=e.movedItems;if(n(t,{linkedView:this._getListView(),dataSource:this.getDataSource(),parentProperty:this._options.parentProperty,nodeProperty:this._options.nodeProperty,records:o,handlers:{onSelectComplete:function(e,t){this.sendCommand("close",t.at(0))}}}),t.filter=t.filter||{},!t.filter.hasOwnProperty("ВидДерева"))t.filter["ВидДерева"]="Только узлы";if(t.pageSize)t.infiniteScroll="demand";return t},init:function(){l.superclass.init.call(this),this._syncOptions()},_move:function(e,t){if(i.show(),t&&null==t.getId())t=null;return this._getMover().move(e,t,"on").addCallback(function(e){if(false!==e&&this._getListView())this._getListView().removeItemsSelectionAll()}.bind(this)).addBoth(function(){i.hide()})},_getDialogConfig:function(e){var t=l.superclass._getDialogConfig.call(this,e),i=e.movedItems;return n(t,{title:rk("Перенести")+" "+i.length+o.wordCaseByNumber(i.length," "+rk("записей")," "+rk("запись")," "+rk("записи"))+" "+rk("в"),opener:this._getListView()},{preferSource:true}),t},_getComponentOptions:function(){var e=["displayField","partialyReload","keyField","idProperty","hierField","displayProperty"],t=this._getListView(),o=this._options.componentOptions||{};if(t)e.forEach(function(e){if(!o.hasOwnProperty(e))try{o[e]=t.getProperty(e)}catch(t){o[e]=void 0}},this);return o},_notifyOnExecuted:function(e,t){if(void 0!==t)this._move(e.movedItems,t).addBoth(function(){l.superclass._notifyOnExecuted.call(this,e,t)}.bind(this));else l.superclass._notifyOnExecuted.call(this,e,t)},_syncOptions:function(){if(r.instanceOfMixin(this._options.linkedObject,"SBIS3.CONTROLS/Mixins/TreeMixin"))n(this._options,{parentProperty:this._options.linkedObject.getParentProperty(),nodeProperty:this._options.linkedObject.getNodeProperty()},{preferSource:true}),this.subscribeTo(this._options.linkedObject,"onKeyPressed",this._keyPressHandler.bind(this))},setLinkedObject:function(e){l.superclass.setLinkedObject.call(this,e),this._syncOptions()},_keyPressHandler:function(e,t){switch(t.which){case p.key.m:t.ctrlKey&&this.execute(),e.setResult(false)}}});return l});
//# sourceMappingURL=InteractiveMove.js.map
define("js!SBIS3.CONTROLS.Action.List.InteractiveMove",["SBIS3.CONTROLS/Action/List/InteractiveMove"],function(t){return t});
//# sourceMappingURL=Action_List_InteractiveMove.module.js.map
define("html!SBIS3.Contacts.HeaderDialog/Dialog",function(){var o=function(o){var n=function(){var o=/\{\{([\s\S]+?)\}\}/g;return function(n){for(;o.test(n);)n=n.replace(o,"&#123;&#123;$1&#125;&#125;");return n}}(),i=function(o){return o.join?o.join(""):o.toString()},t=function(o){return void 0===o?"":o&&"object"==typeof o?i(o):""+o},e="undefined"!=typeof process,a=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="contacts-HeaderDialog-container');return"invitation"==o.dialogType&&(a+=" contacts-invitation"),o.inWindow&&(a+=" in-window"),a+='"> <div id="contacts-HeaderDialog_docPreview" class="ws-hidden"></div> <div class="invitation-HeaderInvitation-company-info ws-hidden"> <div class="invitation-HeaderInvitation-company-image ws-hidden"></div> <div class="invitation-HeaderInvitation-company-name ws-hidden"></div> <div class="invitation-HeaderInvitation-company-phone ws-hidden"></div> </div> <div class="invitation-HeaderInvitation-title ws-hidden">'+n(t(rk("Приглашение в круг контактов")))+'</div> <div class="invitation-HeaderInvitation-person-photo ws-hidden"></div> <div class="invitation-HeaderInvitation-person-info ws-hidden"> <div class="invitation-HeaderInvitation-person-name ws-hidden"></div> <div class="invitation-HeaderInvitation-person-place ws-hidden"></div> <div class="invitation-HeaderInvitation-person-position ws-hidden"></div> </div> <div class="invitation-HeaderInvitation-buttons',o.inWindow&&(a+=" in-window"),a+='"> <component data-component="SBIS3.CONTROLS.Button"> <option name="name">declineButton</option> <option name="visible">false</option> <option name="className">invitation-HeaderInvitation-buttons-decline</option> <option name="caption">'+n(t(rk("Отклонить")))+'</option> </component> <component data-component="SBIS3.CONTROLS.Button"> <option name="name">acceptButton</option> <option name="visible">false</option> <option name="primary">true</option> <option name="className">invitation-HeaderInvitation-buttons-accept</option> <option name="caption">'+n(t(rk("Принять")))+'</option> </component> <component data-component="SBIS3.CONTROLS.Button"> <option name="name">resendButton</option> <option name="visible">false</option> <option name="primary">true</option> <option name="className">invitation-HeaderInvitation-buttons-resend</option> <option name="caption">'+n(t(rk("Отправить повторно")))+'</option> </component> </div> <div id="contacts-HeaderDialog_docHeader"> <component data-component="SBIS3.CONTROLS.Link"> <option name="tabindex">0</option> <option name="name">КнопкаОткрытьДокумент</option> <option name="id">contacts-SendViewDialog_btnLinkDoc</option> <option name="caption">'+n(t(rk("Если не задать значение ведет себя странно")))+'</option> <option name="visible">false</option> <option name=\'className\'>controls-Button__ellipsis</option> <options name="handlers"> <option name="onActivated" type="function"> js!SBIS3.Contacts.HeaderDialog:prototype.onActivatedButtonDocLink </option> </options> </component> </div> <component data-component="SBIS3.Contacts.HeaderMembers"> <option name="name">DialogHeaderMembers</option> <option name="tabindex">0</option> <option name="photoSize">'+n(t(o.docGUID?36:40))+'</option> <option name="rightPadding">'+n(t(o.docGUID?90:o.isNew?40:152))+'</option> <option name="isNew">'+n(t(o.isNew||o.isChat))+'</option> <option name="className">contacts-HeaderDialog-HeaderMembers</option> <option name="listComponent">js!SBIS3.Contacts.DialogMembersList</option> <option name="notClickable">'+n(t(o.notClickable))+'</option> <option name="visible">'+n(t(o.isNew))+'</option> <options name="listComponentOptions"> <option name="themeGUID">'+n(t(o.themeGUID))+"</option> </options> </component> <div class=\"contacts-HeaderDialog__tags\" data-bind=\"style: {width: 'HeaderDialogTagsWidth'}, visible : 'TagManager/"+n(t(o.themeGUID))+"/visible'\"> ",o.tagsTemplate&&(a+=" "+n(t(o.tagsTemplate({themeUUID:o.themeGUID})))+" "),a+=' </div> <div class="contacts-HeaderDialog-buttons-container',o.inWindow&&(a+=" in-window"),a+="\"> <component data-component='SBIS3.CONTROLS.IconButton' class=\"contacts-HeaderDialog-buttons__delete\"> <option name='name'>КнопкаУдалитьДиалог</option> <option name=\"tabindex\">0</option> <option name='icon'>sprite:icon-24 icon-Erase icon-error</option> <option name='id'>deleteDialog</option> <option name='visible'>false</option> <option name=\"tooltip\">"+n(t(rk("Перенести в удаленные")))+'</option> <options name=\'handlers\'> <option name=\'onActivated\' type=\'function\'> js!SBIS3.Contacts.HeaderDialog:prototype.onActivatedButtonDeleteDialog </option> </options> </component> <component data-component="SBIS3.CONTROLS.IconButton" unselectable="on"> <option name="name">КнопкаПоиск</option> <option name=\'visible\'>false</option> <option name="tabindex">0</option> <option name="icon">icon-24 icon-Search2 icon-primary</option> <option name="id">contacts-HeaderDialog-search</option> <option name="tooltip">'+n(t(rk("Поиск")))+"</option> <options name=\"handlers\"> <option name=\"onActivated\" type=\"function\"> js!SBIS3.Contacts.HeaderDialog:prototype.onActivatedButtonSearch </option> </options> </component> <component data-component='SBIS3.CONTROLS.CommandsButton'> <option name='name'>СписокДействийТемы</option> <option name=\"tabindex\">0</option> <option name=\"className\">controls-Menu__hide-menu-header</option> <option name='id'>menuCommandsTheme</option> <option name='visible'>false</option> <options name='items' type='array'> <options> <option name='icon'>icon-24 icon-Chat icon-primary</option> <option name='id' type='string'>cmdMakeChat</option> <option name='title'>"+n(t(rk("Преобразовать в чат")))+"</option> <option name='visible'>false</option> <option name='tooltip'>"+n(t(rk("Преобразовать диалог в чат")))+"</option> </options> <options> <option name='icon'>sprite:icon-24 icon-VideoCallNull icon-primary</option> <option name='id' type='string'>cmdVideoCall</option> <option name='visible'>false</option> <option name='title'>"+n(t(rk("Видеозвонок")))+"</option> <option name='tooltip'>"+n(t(rk("Видеовызов до 10 участников диалога")))+"</option> </options> <options> <option name='icon'>sprite:icon-24 icon-Tag icon-primary</option> <option name='id' type='string'>cmdAddTag</option> <option name='title'>"+n(t(rk("Теги")))+"</option> <option name='visible'>true</option> <option name='tooltip'>"+n(t(rk("Добавить теги")))+"</option> </options> <options> <option name='icon'>sprite:icon-24 icon-Move icon-primary</option> <option name='id' type='string'>cmdMoveTheme</option> <option name='visible'>false</option> <option name='className'>contacts-SenderViewerBP_btnMoveTheme</option> <option name='title'> <component data-component='SBIS3.Contacts.btnFolderTheme'> <option name=\"name\">btnFolderTheme</option> </component> </option> <option name='tooltip'>"+n(t(rk("Перенести переписку в папку")))+"</option> </options> <options> <option name=\"icon\">sprite:icon-24 icon-Link icon-primary</option> <option name='id' type='string'>cmdLinkRoot</option> <option name='visible'>false</option> <option name=\"tooltip\">"+n(t(rk("Получить ссылку")))+'</option> <option name="title">'+n(t(rk("Получить ссылку")))+"</option> </options> <options> <option name='icon'>sprite:icon-24 icon-Link icon-primary</option> <option name='id' type='string'>cmdLinkTheme</option> <option name=\"parent\" type=\"string\">cmdLinkRoot</option> <option name='visible'>false</option> <option name='title'>"+n(t(rk("Скопировать в буфер")))+"</option> </options> <options> <option name='icon'>sprite:icon-24 icon-NewTab icon-primary</option> <option name='id' type='string'>cmdNewTab</option> <option name=\"parent\" type=\"string\">cmdLinkRoot</option> <option name='visible'>false</option> <option name='title'>"+n(t(rk("Открыть в новой вкладке")))+"</option> </options> <options> <option name='icon'>sprite:icon-24 icon-AddNote icon-primary</option> <option name='id' type='string'>cmdNewNote</option> <option name=\"parent\" type=\"string\">cmdLinkRoot</option> <option name='visible'>false</option> <option name='title'>"+n(t(rk("Скопировать в заметку")))+"</option> </options> <options> <option name='icon'>sprite:icon-24 icon-Erase icon-error</option> <option name='id' type='string'>cmdDeleteDialog</option> <option name='visible'>false</option> <option name='title'>"+n(t(rk("Перенести в удаленные")))+"</option> <option name='tooltip'>"+n(t(rk("Перенести в удаленные")))+"</option> </options> </options> <option name='idProperty' type='string'>id</option> <option name=\"parentProperty\">parent</option> <options name='handlers'> <option name='onMenuItemActivate' type='function'> js!SBIS3.Contacts.HeaderDialog:prototype.onMenuItemActivate </option> </options> </component> </div> <div id=\"contacts-HeaderDialog_viewForFolder\" class=\"contacts-HeaderDialog__display-none\"></div> </div>",(a=n(a))+(e&&-1!==a.indexOf("{{")?String.fromCharCode(8203,8203):"")};return o.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.HeaderDialog/Dialog"}},o});
//# sourceMappingURL=Dialog.xhtml.map
define("js!SBIS3.Contacts.HeaderDialog",["Core/core-extend","Core/core-instance","Core/helpers/fast-control-helpers","Core/Indicator","Core/IoC","Core/utf8-base64","Core/detection","Core/UserInfo","Core/EventBus","js!SBIS3.CONTROLS.CompoundControl","html!SBIS3.Contacts.HeaderDialog/Dialog","js!SBIS3.Contacts.MessagesExchangeEvents","js!SBIS3.Contacts.Mixins.Services.Consumer","js!SBIS3.Contacts.CommonFunctions.Global","js!WS.Data/Source/SbisService","js!SBIS3.Contacts.Mixins.Services.Executor.SmallSearch","js!WS.Data/Entity/Model","js!SBIS3.CONTROLS.Action.List.InteractiveMove","Core/Deferred","js!SBIS3.Contacts.OpenerHelper","js!SBIS3.Contacts.ListTagManager","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/TagsBlock","js!SBIS3.Contacts.ActionSets.Tags","js!SBIS3.Contacts.HeaderMembers","js!SBIS3.CONTROLS.Link","js!SBIS3.CONTROLS.CommandsButton","js!SBIS3.CONTROLS.ContextMenu","js!SBIS3.Contacts.btnFolderTheme","js!SBIS3.CONTROLS.IconButton","js!SBIS3.CONTROLS.Button","css!SBIS3.Contacts.HeaderDialog/Dialog"],function(e,t,i,n,o,s,a,r,l,d,c,h,u,m,g,f,C,_,p,v,b,D,T){var I=d.extend({_dotTplFn:c,_documentDetails:void 0,$protected:{_options:{inWindow:false,tagsTemplate:D}},_headerMembers:void 0,_menuItems:{cmdMakeChat:[false,true,null],cmdVideoCall:[false,true,null],cmdMoveTheme:[false,true,null],cmdLinkRoot:[false,true,null],cmdLinkTheme:[false,true,null],cmdNewTab:[false,true,null],cmdNewNote:[false,true,null],cmdDeleteDialog:[false,true,null]},_menuReady:null,_canChangeTagsVisibility:false,_containersInvitation:{personPhoto:null,personInfo:null},$constructor:function(){this._publish("onConvertToChat")},init:function(){I.superclass.init.call(this);var e=this,t=e._getCommandsButton(),i=e.hasChildControlByName("КнопкаПоиск")?e.getChildControlByName("КнопкаПоиск"):null;if(e._menuReady=new p,"invitation"===e._options.dialogType)this._containersInvitation.personPhoto=this.getContainer().children(".invitation-HeaderInvitation-person-photo"),this._containersInvitation.personInfo=this.getContainer().children(".invitation-HeaderInvitation-person-info"),t.setVisible(false);else if(i)i.setVisible(true);if(e._options.docGUID&&(!e._options.restrictedActions||!e._options.restrictedActions.isHiddenLinkDocument))e.getContainer().addClass("contacts-HeaderDialog_document");e.subscribeOnceTo(t,"onPickerOpen",function(){e._menuReady.callback()}),e.subscribeTo(e,"onDestroy",function(){e._headerMembers=void 0,e._menuItems=[],e._menuReady=null,e._tagManager=null,e._containersInvitation.personPhoto=null,e._containersInvitation.personInfo=null}),this._tagManager=new b;var n=this._options.themeGUID;this._updateTagsData(n);var o=this._getHeaderMembersControl();if(o)this.subscribeTo(o,"onResize",this._onResizeMembersHandler.bind(this)),this.subscribeTo(o,"onAfterPersonDraw",this._onAfterPersonDrawHandler.bind(this));if(this.hasChildControlByName("ThemeTagList_"+n))this.subscribeTo(this.getChildControlByName("ThemeTagList_"+n),"onRemoveTag",function(e,t){T.executeUnlink(n,[t])}),this.subscribeTo(h,"taglistchange",function(e,t){if(t&&t.theme&&t.theme.indexOf(n)>=0)this._updateTagsData(n,true)}.bind(this)),this.subscribeTo(h,"tagupdate",function(e,t){this._updateTagsData(n,true)}.bind(this));this.subscribeTo(this,"onClick",this._onClickEventHandler.bind(this))},_onClickEventHandler:function(e,t){var i=t.target,n=i&&i.dataset,o=n&&n.personguid;if(n&&"true"===n.clickable&&o&&"function"===typeof this.consume)this.consume("changeReceivers",{addOrReplace:[o]})},_updateTagsData:function(e,t){this._tagManager.getTagData([e]).addCallback(function(i){var n=i[e];if(this.getLinkedContext().setValue("TagManager/"+e,{items:n,visible:false}),t)this._calcTagsControl()}.bind(this))},setSearchButtonVisible:function(e){var t=this.hasChildControlByName("КнопкаПоиск")?this.getChildControlByName("КнопкаПоиск"):null;if(t)t.setVisible(e)},_onResizeMembersHandler:function(e){this._calcTagsControl()},_onAfterPersonDrawHandler:function(e){this._canChangeTagsVisibility=true,this._calcTagsControl()},_calcTagsControl:function(){var e=this._options.themeGUID,t=this.getLinkedContext(),i=this._getHeaderMembersControl(),n="invitation"===this._options.dialogType?this._containersInvitation.personPhoto.outerWidth()+this._containersInvitation.personInfo.outerWidth():0,o=t.getValue("TagManager/"+e+"/items"),s=o&&o.getCount()||0,a=this.getContainer().innerWidth()-i.getContainer().outerWidth()-8-n,r=s&&i?a<226?226:a:0;if(i){if(!r)i._options.rightPadding=260;else i._options.rightPadding=n+r;if(t.setValue("HeaderDialogTagsWidth",r+"px"),this._canChangeTagsVisibility)t.setValue("TagManager/"+e+"/visible",!!s)}},_showMenuItems:function(){var e=this;if(!e.isDestroyed())e._menuReady.addCallback(function(){var t=e._getCommandsButton(),i=t.getPicker();for(var n in e._menuItems)if(e._menuItems.hasOwnProperty(n)){var o=e._menuItems[n],s=!!o[0],a=!!o[1],r=o[2],l=t.getItemInstance(n),d=l.isVisible(),c=l.isEnabled();if(d!==s)l.setVisible(s),i.recalcPosition(true);if(c!==a)l.setEnabled(a);if(r)l.setTooltip(r)}})},showBtnDelDialog:function(){var e=this,t=e._options.restrictedActions.isHiddenDeleteDialog,i=e._options.isChat,n=e._options.isDeleteForever,o=e._getDeleteButton(),s=e._getCommandsButton(),a;if(!o||t||i)return void e.getContainer().removeClass("hidden-delete-button").addClass("hidden-delete-button");if(n)a=rk("Удалить навсегда");else a=rk("Перенести в удаленные");if(o)o.show(),o.setEnabled(true),o.setTooltip(a);e._menuReady.addCallback(function(){var e=s?s.getItemInstance("cmdDeleteDialog"):null;if(e)e.show(),e.setEnabled(true),e.setTooltip(a),e.setCaption(a)})},showCommandsButton:function(){var e=this._getCommandsButton();if(e)e.setVisible(true)},showHideButtonsFromOptions:function(){var e=this,t=e._getCommandsButton();if(t&&e._options&&e._options.restrictedActions)if(e._options.restrictedActions.isHiddenConvertToChat&&e._options.restrictedActions.isHiddenVideoMessage&&e._options.restrictedActions.isHiddenMoveToFolder&&e._options.restrictedActions.isHiddenDeleteDialog&&e._options.restrictedActions.isHiddenLinkTheme)t.setVisible(false);else{e.setVisibleElementMenu("cmdMakeChat",!e._options.restrictedActions.isHiddenConvertToChat,true),e.setVisibleElementMenu("cmdVideoCall",!e._options.restrictedActions.isHiddenVideoMessage);var i=e._options.restrictedActions.isHiddenMoveToFolder&&e._options.isDeleteForever;if(e.setVisibleElementMenu("cmdMoveTheme",i||!e._options.restrictedActions.isHiddenMoveToFolder,!e._options.restrictedActions.isHiddenMoveToFolder,i?rk("Перемещение в папку невозможно - диалог удален."):""),!e._options.restrictedActions.isHiddenDeleteDialog)e.showBtnDelDialog();else{var n=e._getDeleteButton();if(n)n.hide();e.getContainer().removeClass("hidden-delete-button").addClass("hidden-delete-button"),e.setVisibleElementMenu("cmdDeleteDialog",!e._options.restrictedActions.isHiddenDeleteDialog)}e.setVisibleElementMenu("cmdLinkRoot",!e._options.restrictedActions.isHiddenLinkTheme),e.setVisibleElementMenu("cmdLinkTheme",!e._options.restrictedActions.isHiddenLinkTheme),e.setVisibleElementMenu("cmdNewTab",!e._options.restrictedActions.isHiddenLinkTheme),e.setVisibleElementMenu("cmdNewNote",!e._options.restrictedActions.isHiddenLinkTheme&&!e._options.restrictedActions.isHiddenNewNote)}},hideAllButtons:function(){var e=this.hasChildControlByName("КнопкаПоиск")?this.getChildControlByName("КнопкаПоиск"):null,t=this._getCommandsButton(),i=this._getDeleteButton();if(e)e.setVisible(false);if(t)t.setVisible(false);if(i)i.setVisible(false)},docHeaderRender:function(e,t){var n=this,o=e._documentDetails,a=e.getChildControlByName("КнопкаОткрытьДокумент"),r=e.getChildControlByName("DialogHeaderMembers"),l="",d=!this._options.restrictedActions||!this._options.restrictedActions.isHiddenLinkDocument;if(e._options.isNew)e.getContainer().addClass("contacts-HeaderDialog_newDialog");if(!d)t.removeClass("ws-hidden").addClass("ws-hidden"),e.getContainer().removeClass("contacts-HeaderDialog_document");if(o){if(l=o["ДокументКрасивоеНазвание"],a.setCaption(l),a.setTooltip(l.replace(/&#x27;/g,"'")),d)e.getContainer().removeClass("contacts-HeaderDialog_document").addClass("contacts-HeaderDialog_document");r.setPhotoSize(d?36:40);var c=o["ДокументИконка"],h=false;if(c){if(h=-1!==c.indexOf("TFFolder"),h)a.setIcon("sprite:icon-16 icon-primary "+c.replace("TFFolder","TFFolder2"))}else a.setIcon("sprite:icon-16 icon-primary icon-Document");if(2==o["ДокументОбъектТипа"]&&!h){r._options.rightPadding=90,e.getContainer().addClass("contacts-HeaderDialog_doc");var u=function(e){if(d){var i={Service:"/disk/api/v1/",Object:"FileSD",ID:e,IDRedaction:null,Version:"",Width:64,Height:64},o="/docview/service/sbis-rpc-service300.dll?method=DocView.ReadAttachmentAsPreviewSync&params="+encodeURIComponent(s.encode(JSON.stringify(i)))+"&id=1";t.removeClass("ws-hidden"),t.html('<img class="contacts-HeaderDialog_docPreview_img" src="'+o+'"/>'),t.click(function(){if(n._documentDetails)return v.openDocById(n._documentDetails,n)})}};if(o["ДокументФайлИд"])u(o["ДокументФайлИд"]);else{t.removeClass("ws-hidden");var m=new C({adapter:"adapter.sbis",format:[{name:"ReadVersions",type:"integer"}]});m.set({ReadVersions:1});var f={Id:o["Документ"],ExtraParams:m.getRawData()};new g({endpoint:"FileSD"}).call("ReadByObject",f).addCallbacks(function(t){var i=t.getRow().get("Id");e._documentDetails["ДокументФайлИд"]=i,u(i)},function(t){i.alert(t.message,{opener:e})})}}else{if(d)e.getContainer().addClass("contacts-HeaderDialog_formDoc");t.hide(),r._options.rightPadding=d?20:110}a.setVisible(d)}else if(a.isVisible())a.setCaption(l),a.setVisible(false)},setDocumentDetailsToRender:function(){var e=this,t=e.hasChildControlByName("КнопкаОткрытьДокумент")?e.getChildControlByName("КнопкаОткрытьДокумент"):null,i=e.getContainer().find("#contacts-HeaderDialog_docPreview"),n=null;if(!t)return;if(e._documentDetails||t.isVisible())e.docHeaderRender(e,i);else i.addClass("ws-hidden");if(e._documentDetails)n=e._documentDetails["Документ"];e._options.docGUID=n},getDocumentDetails:function(e){var i=null,n,o,s,a,r,l=true,d=void 0,c=null,h=null;if(t.instanceOfModule(e,"WS.Data/Entity/Model"))n=e.has("ДокументПк")?e.get("ДокументПк"):e.has("@Документ")?e.get("@Документ"):null,o=e.has("Документ")?e.get("Документ"):e.has("Идентификатор")?e.get("Идентификатор"):null,s=e.has("ДокументТип")?e.get("ДокументТип"):null,a=e.has("ДокументОбъектТипа")?e.get("ДокументОбъектТипа"):e.has("ТипИД")?e.get("ТипИД"):null,r=e.has("ДокументКрасивоеНазвание")?e.get("ДокументКрасивоеНазвание"):e.has("КрасивоеНазвание")?e.get("КрасивоеНазвание"):"Документ недоступен",l=e.has("МожноПодписать")?e.get("МожноПодписать"):l,d=e.has("ДокументИконка")?e.get("ДокументИконка"):d,h=e.has("ДокументФайлИд")?e.get("ДокументФайлИд"):h,c=e.has("ДокументРежимОткрытия")?e.get("ДокументРежимОткрытия"):e.has("РежимОткрытия")?e.get("РежимОткрытия"):c;else if(e)n=e.docDocumentPk,o=e.docDocument,s=e.documentType,a=e.docObjectType,r=e.docCaption;if(n||o)i=u(n,o,s,a,r,l,d,h,c);return i;function u(e,t,i,n,o,s,a,r){return{"ДокументПк":e,"Документ":t,"ДокументТип":i,"ДокументОбъектТипа":n,"ДокументФайлИд":r,"ДокументКрасивоеНазвание":o,"ДокументМожноПодписать":s,"ДокументИконка":a?-1===a.indexOf("icon-")?"icon-"+a:a:null,"ДокументРежимОткрытия":c}}},setNameFolder:function(e){var t=this;if(!t.isDestroyed())t._menuReady.addCallback(function(){var i=t.hasChildControlByName("btnFolderTheme")?t.getChildControlByName("btnFolderTheme"):void 0;if(i&&e)i.setData(e)})},_getCommandsButton:function(){return this.hasChildControlByName("СписокДействийТемы")?this.getChildControlByName("СписокДействийТемы"):void 0},_getDeleteButton:function(){return this.hasChildControlByName("КнопкаУдалитьДиалог")?this.getChildControlByName("КнопкаУдалитьДиалог"):void 0},setVisibleElementMenu:function(e,t,i,n){if(!this._getCommandsButton())return;var o=this._menuItems[e];if(o){if(o[0]=t,void 0!==i)o[1]=i;o[2]=n,this._showMenuItems()}},onActivatedButtonDocLink:function(){var e=this.getParent();if(e._documentDetails)return v.openDocById(e._documentDetails,e,void 0,e._options.themeGUID)},onActivatedButtonSearch:function(){var e=this,t=e.getParent();t.consume("openSmallSearch",{parent:e,themeId:t._options.dialogId})},onActivatedButtonCloseWindow:function(){if(window)try{window.close()}catch(e){}},makeChat:function(){var e=this;n.show(),require(["js!SBIS3.CONTROLS.OpenDialogAction"],function(t){n.hide(),new t({name:"singleChatEditPanel",dialogComponent:"js!SBIS3.Contacts.EditChat2",mode:"floatArea",handlers:{onExecuted:function(t,i,n){if(n&&i)e._notify("onConvertToChat",n)}}}).execute({id:e._options.themeGUID,dialogOptions:{isStack:false,target:e.getContainer(),direction:"left",side:"right",animation:"slide"}})})},onMenuItemActivate:function(e,t){var i=this.getParent();switch(t){case"cmdMakeChat":i.makeChat();break;case"cmdAddTag":var n=i._options.themeGUID,o=[],s=i.getLinkedContext().getValue("TagManager/"+n+"/items");if(s)s.each(function(e){o.push({Tag:e.getId()})});T.openTagDialog.call(i,this.getContainer(),n,o);break;case"cmdVideoCall":var a={themeGUID:i._options.themeGUID,dialogType:i._options.dialogType};if("invitation"===i._options.dialogType&&i._options.invitePerson)a["persons"]=[i._options.invitePerson];i.consume("videoCall",a);break;case"cmdMoveTheme":i.onActivatedThemeToFolder();break;case"cmdDeleteDialog":i.onActivatedButtonDeleteDialog.bind(this)();break;case"cmdLinkTheme":i.onActivatedLinkTheme();break;case"cmdNewNote":i.onActivatedNewNote();break;case"cmdNewTab":i.onActivatedNewTab()}},getThemeLink:function(){return["https://",String(window.location.host),"/open_dialog.html?guid=",this._options.themeGUID].join("")},onActivatedThemeToFolder:function(){var e=this,t=e._options.themeGUID,i=e.getContainer();require(["js!SBIS3.CONTROLS.TreeDataGridView"],function(n){var o=e._viewForFolder,s;if(!o)o=new n({name:"ViewForFolder",parent:e,element:i.find("#contacts-HeaderDialog_viewForFolder"),idProperty:"ИдО",pageSize:20,displayField:"Название",hierField:"Раздел",visible:false}),s=new g({endpoint:"Персона",binding:{update:"АТЗаписатьДляListView",query:"АТListViewДляПеремещения"},idProperty:"ИдО"}),o.setDataSource(s,true),e._viewForFolder=o;o.setFilter({"Тема":t}),o.once("onDrawItems",function(){var i=this.getItems(),n=i?i.getIndexByValue("Тема",t):null,s=n>=0?i.at(n):null;if(s?s.getId():null)e.subscribeOnceTo(o,"onBeginMove",function(e,t,i){s.set("Раздел",i&&i.getId()),e.setResult(new g({endpoint:"Персона"}).call("АТЗаписатьДляListView",{"Запись":s}).addCallback(function(){return"MoveInItems"}))}),new _({linkedObject:o}).execute({movedItems:[s]})})})},onActivatedLinkTheme:function(){var e=this.getThemeLink();m.copyTextToClipBoard(e)},onActivatedNewTab:function(){var e=this.getThemeLink();if(window&&window.open){var t=this.getParentByClass("SBIS3.Contacts.SendViewDialog")._getBaseControl(),i=t?t.getBottomsideControl():null,n=i?i.checkIsContent():null,o="dialog"+this._options.themeGUID;if(localStorage&&localStorage.setItem)localStorage.setItem(o,JSON.stringify(i.getReceivers()));if(n){var s=window.open("about:blank","_blank");n.addBoth(function(){s.location.href=e,s.focus()})}else window.open(e,o).focus()}},onActivatedNewNote:function(){var e={};l.channel("ChannelUserAccount").notify("onAddNote",{text:this.getThemeLink()||"",panelData:e,opener:this})},onActivatedButtonDeleteDialog:function(){var e=this.getParent();if(e._options.isDeleteForever)i.question(rk("Удалить безвозвратно все сообщения в этом диалоге?"),{opener:e}).addCallback(function(t){if(true===t)e._delBLThemeByGUID()});else e._delBLThemeByGUID()},_getHeaderMembersControl:function(){if(!this._headerMembers)this._headerMembers=this.hasChildControlByName("DialogHeaderMembers")?this.getChildControlByName("DialogHeaderMembers"):null;return this._headerMembers},addMembers:function(e){var t=this._getHeaderMembersControl();if(t)t.addMembers(e)},removeMembers:function(e){var t=this._getHeaderMembersControl();if(t)t.removeMembers(e)},setMembers:function(e,t,i){var n=this._getHeaderMembersControl(),o=r.get("ИдентификаторСервисаПрофилей"),s=rk("Видеовызов до 10 участников диалога"),l=false;if(n)n.setVisible(true),n.setMembers(e,t);if(i&&n){if(n.setMembersCount(i),1==e.length&&e[0]==o)s=rk("Самому себе звонить нельзя"),l=true;if(!this._options.isChat&&!a.isMobilePlatform&&i<10&&!l)this.setVisibleElementMenu("cmdVideoCall",true,true,s);else this.setVisibleElementMenu("cmdVideoCall",true,false,s)}},_delBLThemeByGUID:function(){var e=this,t=e._options,n=t.themeGUID,s=t.isDeleteForever,a=o.resolve("ILogger"),r=s?"АТУдалитьНавсегда":"АТУдалить",l,d;return l=s?{"Тема":n}:{"Темы":[n]},d=new g({endpoint:"Персона"}).call(r,l).addCallbacks(function(){h.notify("onDeleteTheme",{erased_themes:[n],is_local:true})},function(t){a.error(t.message,t.details),i.alert([rk("Не удалось удалить переписку"),": ",t.message].join(),{opener:e}),m.errorMessageService(t)}),d}});return e.mixin(I,[u,f])});
//# sourceMappingURL=Dialog.module.js.map
define("tmpl!SBIS3.CONTROLS/OperationsPanel/resources/ItemTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,n,i,a,s){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var m={};s&&s.isSetts&&(m=s.fullContext||{});var u="string"==typeof i?i:"",d=void 0===r?void 0:r,g={id:[],def:void 0},v=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),y=this&&this.includedTemplates?this.includedTemplates:{},f=c.getMarkupGenerator(a);try{var h=f.joinElements([f.createControl("resolver",c.getter(o,["item","componentType"]),c.uniteScope(c.utils.escape(c.getter(o,["item","options"])),{className:c.getter(o,["item","options","className"])+" controls-ListView__item js-controls-ListView__item js-controls-operationsPanel__action controls-operationsPanel__action controls-operationsPanel__actionType-"+c.getter(o,["getItemType"]).apply(o,[c.getter(o,["item","type"])])}),c.plainMerge({"data-hash":c.getter(o,["projItem","getHash"]).apply(c.getter(o,["projItem"]),[]),"data-id":c.getter(o,["item",c.getter(o,["idProperty"])])},{}),{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v},i,d,y,c.config,m,g)],u,g);g.def&&(h=f.chain(h,g,n),g=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/OperationsPanel/resources/ItemTemplate.tmpl",e,o)}return h||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/OperationsPanel/resources/ItemTemplate"}},o});
//# sourceMappingURL=ItemTemplate.tmpl.map
define("tmpl!SBIS3.CONTROLS/OperationsPanel/OperationsPanel",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],n={},r=function e(r,a,o,s,i){function l(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};i&&i.isSetts&&(d=i.fullContext||{});var u="string"==typeof o?o:"",v=void 0===n?void 0:n,f={id:[],def:void 0},m=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),h=this&&this.includedTemplates?this.includedTemplates:{},O=p.getMarkupGenerator(s);try{var P=O.joinElements([O.createTag("div",{class:"controls-operationsPanel controls-operationsPanel__massMode "+p.wrapUndef(p.utils.escape(p.getter(r,["visible"])?" ws-hidden":""))+" "+p.wrapUndef(p.utils.escape(p.getter(r,["hasItemsMenu"])?" controls-operationsPanel_withItemsMenu":""))},[O.createTag("div",{class:"controls-operationsPanel__actions"},[],{},f,this)],a,f,this)],u,f);f.def&&(P=O.chain(P,f,a),f=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/OperationsPanel/OperationsPanel.tmpl",e,r)}return P||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/OperationsPanel/OperationsPanel"}},r});
//# sourceMappingURL=OperationsPanel.tmpl.map
define("SBIS3.CONTROLS/OperationsPanel",["Lib/Control/CompoundControl/CompoundControl","tmpl!SBIS3.CONTROLS/OperationsPanel/OperationsPanel","SBIS3.CONTROLS/Mixins/ItemsControlMixin","Core/core-instance","tmpl!SBIS3.CONTROLS/OperationsPanel/resources/ItemTemplate","Core/moduleStubs","css!SBIS3.CONTROLS/OperationsPanel/OperationsPanel"],function(e,t,i,n,s,o){var a=28,r=function(e){var t=e._buildTplArgsSt.call(this,e);return t.getItemType=l,t},l=function(e){var t="selection";if(e)if(e.mark)t="mark";else if(e.mass&&e.selection)t="all";else if(e.mass)t="mass";return t},c=e.extend([i],{_dotTplFn:t,$protected:{_options:{_buildTplArgs:r,_defaultItemTemplate:s,_serverRender:true,items:[{name:"delete",componentType:"SBIS3.CONTROLS/OperationsPanel/Delete",type:{mass:true,selection:true},options:{}},{name:"operationsMark",componentType:"SBIS3.CONTROLS/OperationsPanel/Mark",type:{mark:true},options:{}}],idProperty:"name",hasMarkBlock:true,visible:false,hasItemsMenu:false}},$constructor:function(){this._publish("onToggle")},init:function(){c.superclass.init.call(this);var e=this;if(this.isVisible())this.redraw();this.subscribe("onDrawItems",function(){if(e._itemsMenu)e._updateActionsMenuButtonItems();if(e._options.hasItemsMenu)e.getItems().each(function(t){var i=e.getItemInstance(t.get("name"));if(i)e.subscribeTo(i,"onPropertyChanged",function(t,i){if("visible"===i)e._checkCapacity()})})}),this._getItemsContainer().on("scroll",function(e){$(this).scrollLeft(0)})},getItems:function(){var e=c.superclass.getItems.call(this);return e?e:this._options.items},setItems:function(){this._itemsLoadDeferred=null,this._itemsWidth=null,c.superclass.setItems.apply(this,arguments)},_updateActionsMenuButtonItems:function(){var e=this,t=[],i=function(n,s,o){n.each(function(n){var a=l(n.get("type"));if(s||"mark"!==a){var r={parent:s||null};if(s)r.id=n.get("id")||n.get("title"),r.icon=n.get("icon"),r.caption=n.get("title"),r.instance=o,r.visible=o.isVisible();else{var c=n.get("name");if(o=e.getItemInstance(c),r.id=c,r.icon=o.getIcon(),r.caption=o.getCaption(),r.instance=o,r.className="controls-operationsPanel__actionType-"+l(n.get("type")),r.visible=o.isVisible(),"function"===typeof o.getItems){var u=o.getItems();if(u.getCount()>1)i(u,c,o)}}t.push(r)}if("mark"===a){var h=e.getItemInstance(n.get("name"));e.subscribeTo(h,"onMarkUpdated",function(){e._checkCapacity()})}})};i(this.getItems()),this._itemsMenu.setItems(t)},_setVisibility:function(e){if(this.isVisible()!==e){if(this._isVisible=e,this._container.toggleClass("ws-hidden",!e),e)this.redraw();this._notifyOnSizeChanged(true),this._notify("onToggle")}},onSelectedItemsChange:function(e){if(this._container.toggleClass("controls-operationsPanel__massMode",!e.length).toggleClass("controls-operationsPanel__selectionMode",!!e.length),this.isVisible())this._onSelectedItemsChange(e);else this.once("onDrawItems",function(){this._onSelectedItemsChange(e)}.bind(this));if(this._options.hasItemsMenu){var t=$(".controls-operationsPanel__itemsMenu_picker");t.toggleClass("controls-operationsPanel__massMode",!e.length),t.toggleClass("controls-operationsPanel__selectionMode",!!e.length),this._checkCapacity()}},_onSelectedItemsChange:function(e){var t=this.getItemsInstances(),i;for(i in t)if(t.hasOwnProperty(i))if("function"===typeof t[i].onSelectedItemsChange)t[i].onSelectedItemsChange(e)},_onResizeHandler:function(){if(this.isVisible())this._checkCapacity()},_checkCapacity:function(){if(!this._options.hasItemsMenu){if(!this._itemsWidth)this._itemsWidth=this._getItemsContainer().width();var e=this.getContainer().width();if(this._withoutCaptionsMode){if(e>this._itemsWidth)this._toggleWithoutCaptionsMode(false)}else if(e<=this._itemsWidth)this._toggleWithoutCaptionsMode(true);return}var t=this.getContainer().width()-a,i=this._getItemsContainer().find("> .js-controls-operationsPanel__action:visible"),n=0,s=false;this._getItemsContainer().css("width","");for(var o=0,r=i.length;o<r;o++){var l=$(i[o]).outerWidth(true);if(n+l>t){s=true,this._getItemsContainer().css("width",n);break}else n+=l}if(s)this._createItemsMenu();if(this._itemsMenu)this._itemsMenu.getContainer().toggleClass("ws-hidden",!s)},_toggleWithoutCaptionsMode:function(e){this._withoutCaptionsMode=e,this.getContainer().toggleClass("controls-operationsPanel__mode-withoutCaptions",e)},redraw:function(){var e=this;if(this.isVisible())this.requireButtons().addCallback(function(){e.once("onDrawItems",function(){e._checkCapacity()}),c.superclass.redraw.call(e)})},requireButtons:function(){if(!this._itemsLoadDeferred){var e=[];this.getItems().each(function(t){e.push(t.get("componentType"))}),this._itemsLoadDeferred=o.require(e)}return this._itemsLoadDeferred},_createItemsMenu:function(){var e=this;if(!this._itemsMenuCreated)this._itemsMenuCreated=true,o.require(["SBIS3.CONTROLS/Menu/MenuIcon"]).addCallback(function(t){var i=e._container.hasClass("controls-operationsPanel__massMode"),s=e._container.hasClass("controls-operationsPanel__selectionMode");e._itemsMenu=new t[0]({parent:e,element:$("<span>").insertAfter(e._getItemsContainer()),name:"itemsMenu",className:"controls-Menu__hide-menu-header controls-operationsPanel__itemsMenu",idProperty:"id",parentProperty:"parent",displayProperty:"caption",icon:"sprite:icon-size icon-ExpandDown icon-primary action-hover",pickerConfig:{closeButton:true,className:"controls-operationsPanel__itemsMenu_picker"+(i?" controls-operationsPanel__massMode":"")+(s?" controls-operationsPanel__selectionMode":""),horizontalAlign:{side:"right",offset:48},locationStrategy:"bodyBounds"}}),e._itemsMenu._setPickerContent=function(){$(".controls-PopupMixin__closeButton",this._picker.getContainer()).addClass("icon-24 icon-size icon-ExpandUp icon-primary action-hover")},e.subscribeTo(e._itemsMenu,"onMenuItemActivate",function(e,t,i){var s=this.getItems().getRecordById(t);if(s){var o=s.get("instance");if(n.instanceOfModule(o,"SBIS3.CONTROLS/Menu/MenuLink")&&o.getItems().getCount()>1)o._notify("onMenuItemActivate",t);else if(n.instanceOfMixin(o,"SBIS3.CONTROLS/Mixins/Clickable"))o._onClickHandler(i);else o._clickHandler();return false}}),e._updateActionsMenuButtonItems(),e._itemsMenu.getContainer().toggleClass("ws-hidden",false)})},_getItemsContainer:function(){if(!this._actions)this._actions=this.getContainer().find(".controls-operationsPanel__actions");return this._actions}});return c});
//# sourceMappingURL=OperationsPanel.js.map
define("js!SBIS3.DOCVIEW.OperationPanel",["Core/EventBus","Core/helpers/Object/isEmpty","SBIS3.CONTROLS/OperationsPanel","js!SBIS3.DOCVIEW.CommandsManager","js!SBIS3.DOCVIEW.Command","js!SBIS3.DOCVIEW.DocviewModel","WS.Data/Collection/RecordSet","Core/core-instance"],function(e,t,s,i,n,o,a,r){"use strict";var l=s.extend([i],{$protected:{_options:{mainOptions:{objectName:"",serviceUrl:"/",ctxLinkId:null,fixId:null,filter:null,useOnlyCtx:true,ctxLinkList:null,redactionWindow:{renderPhotos:true},commands:{},multiPage:true,directLinkRouting:"disk",userCommands:[],isDisk:true},viewOptions:{mode:"view",autoWidth:false,justAttach:false},folderRecord:null,linkedView:null,hasItemsMenu:true},_savedFolder:null,_typeCmd:"mas",records:[],_selIts:null},setLinkedView:function(e){if(this._options.linkedView)this.unsubscribeFrom(this._getLinkedList());this._options.linkedView=e,this._subscribeToList()},_subscribeToList:function(){var e=this;if(this._options.linkedView){var t=this._getLinkedList();this.subscribeTo(t,"onAccessReady",function(){e._updatePanelButtons()}),this.subscribeTo(t,"onGoToZip",function(t,s){if(s&&s.mainOptions)e._options.mainOptions.objectName=s.mainOptions.objectName,e._options.mainOptions.serviceUrl=s.mainOptions.serviceUrl})}},_appendItems:function(e){var t=[{componentType:"SBIS3.CONTROLS/OperationsPanel/Mark",name:"markOperations",options:{className:"controls-operationsPanel__actionType-mark"},type:{mark:true}}];if(this.records=[],e&&e.getCount()>0){var s=e.at(0),i=this.getCommands(s);this.records.push(s),t=t.concat(i.map(function(e){return{componentType:e.cmdClass||"js!SBIS3.DOCVIEW."+e.name,name:e.name,options:{isOperationPanel:true},type:{mass:true,selection:true}}},this));for(var n=1;n<e.getCount();n++){var o=e.at(n),a=this.getCommands(o);this.records.push(o);for(var r=1;r<t.length;r++){for(var l=false,d=0;d<a.length;d++)if(a[d].name===t[r].name){l=true;break}if(!l)t.splice(r,1),r--}}}t=this.sort(t,"mas"),this.setItems(t)},setItems:function(e){var t=this.getItems(),s=false;if(t&&e&&t.length===e.length){for(var i=0,n=e.length;i<n;i++)if(e[i].name!==t[i].name){s=true;break}}else s=true;if(s)l.superclass.setItems.call(this,e)},init:function(){l.superclass.init.call(this);var t=this;function s(e,s,i){t.startCommand(s,t.records,i)}this.subscribeTo(e.channel("luntik"),"onInit",function(e,i){if(i.getParent()===t&&i instanceof n)t.subscribeTo(i,"onCommandActivated",s)}),this.subscribe("onFinishCommand",function(e,s,i){var n=this._getLinkedList();if(n)n._notify("onFinishCommand",s,i);t._options.linkedView.setSelectedKeys([])}),this._subscribeToList()},destroy:function(){if(l.superclass.destroy.call(this),this._options&&this._options.linkedView)this._options.linkedView=null;this._savedFolder=this.records=this._selIts=null},_updatePanelButtons:function(){var e=this._selIts=this._options.linkedView.getSelectedItems(),s=Boolean(e&&e.getCount()),i=this._savedFolder=this._options.folderRecord;if(this._typeCmd="mas",!s&&i&&!t(i)){var n=new o({rawData:i}),r=this._getLinkedList();n.set("folder@",true);var l=new a({idProperty:"attachId",model:r._getMyModel()});l.add(n),this._selIts=l,this._typeCmd="single"}this._appendItems(this._selIts),this.toggle(s)},onSelectedItemsChange:function(e){this._updatePanelButtons(),l.superclass.onSelectedItemsChange.call(this,e)},setProperties:function(e){if(l.superclass.setProperties.call(this,e),e.mainOptions&&e.mainOptions.commands&&this._selIts)this._appendItems(this._selIts);if(e.folderRecord&&!t(e.folderRecord)||this._savedFolder)this._updatePanelButtons()},_getLinkedList:function(){var e=this._options.linkedView&&this._options.linkedView.getParent();while(e&&!r.instanceOfModule(e,"SBIS3.DOCVIEW.List"))e=e.getParent();return e}});return l});
//# sourceMappingURL=OperationPanel.module.js.map
define("js!SBIS3.Contacts.Mixins.Services.Executor.FileListUpdate",["Core/core-instance","js!SBIS3.Contacts.Mixins.Services.Executor.Base"],function(e,t){"use strict";return t.mergeMixin(t,{$protected:{_options:{}},after:{init:function(){this.register(["fileListUpdate"]),this.setRequiredMethods(["_loadFiles","refreshCount","_showPanel","getFileRecordSet","getFilesGUID","_addRecordFormat","_updateInfoFile","_mergeFiles","_addFiles","_deleteFiles"])}},seFileListUpdate:function(e){if(this.checkRequiredMethods()){var t=this,r=e.hasOwnProperty("mode")&&"replace"==e.mode,i=e.hasOwnProperty("mode")&&"delete"==e.mode,s=e.hasOwnProperty("mode")&&"add"==e.mode,o=[],n,d;if(r&&e.search){if(t._options.themeGUID)t.savedThemeGUID=t._options.themeGUID,t._options.themeGUID=void 0;return t.showPanelWithSources(e.sources,void 0),{executed:true,result:true}}if(!t._options.themeGUID&&t.savedThemeGUID)t._options.themeGUID=t.savedThemeGUID,t.savedThemeGUID=void 0;if(!t._currentRecordSet&&t._options.themeGUID||r)if(t._loadFiles(r),r)return{executed:true,result:true};if(e&&e.files&&e.files.length)for(var l=0;l<e.files.length;l++)if(d=e.files[l].get("attachId"),d&&-1==Array.indexOf(o,d))o.push(d);if(s)return t._addFiles(o,e.search),{executed:true,result:true};if(i)return t._deleteFiles(o,e.search),{executed:true,result:true};if(r)t._isFilesTheme=true;if(n=t._fileListUpdate(e),t.refreshCount(),t._currentCount)t._showPanel();else if(!t._currentCount&&t._status)t._hidePanel();return{executed:true,result:!!n}}else return{executed:false,result:null}},_fileListUpdate:function(t){var r=this,i=r.getFileRecordSet(),s=r.getFilesGUID(),o=false,n,d,l,u;if(!t)return;if(n=t.hasOwnProperty("files")?t.files:null,u=t.hasOwnProperty("mode")?t.mode:null,!(e.instanceOfModule(n,"WS.Data/Collection/RecordSet")&&n.getCount())||!u)return;switch(u){case"add":if(!i)i=n;else n.each(function(e){if(l=e.get("msgFileId"),!(s.length&&Array.indexOf(s,l)>=0))if(d=e?e.getId():null,e&&!i.getRecordById(d))r._addRecordFormat(e,i)});break;case"replace":i=n,o=true}if(!i)return;if(o)r.getLinkedContext().setValue("ctxSliderFilesList",i);else r._mergeFiles(i);return r._updateInfoFile(i),true}})});
//# sourceMappingURL=FileListUpdate.module.js.map
define("html!SBIS3.Contacts.DOCVIEW.cmdSaveToDocs/SaveToDocs",function(){var o=function(o){var n=function(){var o=/\{\{([\s\S]+?)\}\}/g;return function(n){for(;o.test(n);)n=n.replace(o,"&#123;&#123;$1&#125;&#125;");return n}}(),e=function(o){return o.join?o.join(""):o.toString()},t=function(o){return void 0===o?"":o&&"object"==typeof o?e(o):""+o},i="undefined"!=typeof process,r=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="docview-cmdSaveToDocs"> <component name="mainBtn" data-component="SBIS3.CONTROLS.Link"> <option name="id">docview_cmdSaveToDocs</option> <option name="tooltip">'+n(t(rk("Сохранить в документы")))+'</option> <option name="caption"></option> <option name="enable">true</option> <option name="icon">icon-16 icon-SaveAs icon-primary</option> </component> </div>');return(r=n(r))+(i&&-1!==r.indexOf("{{")?String.fromCharCode(8203,8203):"")};return o.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.DOCVIEW.cmdSaveToDocs/SaveToDocs"}},o});
//# sourceMappingURL=SaveToDocs.xhtml.map
define("js!SBIS3.Contacts.DOCVIEW.cmdSaveToDocs",["js!SBIS3.DOCVIEW.Command","html!SBIS3.Contacts.DOCVIEW.cmdSaveToDocs/SaveToDocs","js!SBIS3.CONTROLS.Link","i18n!SBIS3.Contacts.DOCVIEW.cmdSaveToDocs"],function(t,n){"use strict";var o=t.extend({$protected:{_options:{id:"cmdSaveToDocs"},idCmd:"cmdSaveToDocs",_play:function(){var t=this._options.records;if(this._finishParams=[],t&&t.length)for(var n=0;n<t.length;n++)this._finishParams.push(t[n].get("attachId"))}},_dotTplFn:n,init:function(){o.superclass.init.call(this)},getIcon:function(){return"sprite:icon-16 icon-SaveAs icon-primary"},getCaption:function(){return rk("Сохранить в документы")}});return o});
//# sourceMappingURL=SaveToDocs.module.js.map
define("html!SBIS3.Contacts.DOCVIEW.cmdAttachMsg/AttachMsg",function(){var n=function(n){var t=function(){var n=/\{\{([\s\S]+?)\}\}/g;return function(t){for(;n.test(t);)t=t.replace(n,"&#123;&#123;$1&#125;&#125;");return t}}(),o=function(n){return n.join?n.join(""):n.toString()},e=function(n){return void 0===n?"":n&&"object"==typeof n?o(n):""+n},i="undefined"!=typeof process,r=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div class="docview-cmdAttachMsg"> <component name="mainBtn" data-component="SBIS3.CONTROLS.Link"> <option name="id">docview_cmdAttachMsg</option> <option name="tooltip">'+t(e(rk("Прикрепить к диалогу")))+'</option> <option name="caption"></option> <option name="enable">true</option> <option name="icon">icon-16 icon-Attach icon-primary</option> </component> </div>');return(r=t(r))+(i&&-1!==r.indexOf("{{")?String.fromCharCode(8203,8203):"")};return n.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.DOCVIEW.cmdAttachMsg/AttachMsg"}},n});
//# sourceMappingURL=AttachMsg.xhtml.map
define("js!SBIS3.Contacts.DOCVIEW.cmdAttachMsg",["js!SBIS3.DOCVIEW.Command","html!SBIS3.Contacts.DOCVIEW.cmdAttachMsg/AttachMsg","js!SBIS3.CONTROLS.Link","i18n!SBIS3.Contacts.DOCVIEW.cmdAttachMsg"],function(t,n){"use strict";var i=t.extend({$protected:{_options:{id:"cmdAttachMsg"},idCmd:"cmdAttachMsg",_play:function(){var t=this._options.records,n,i;if(this._finishParams=[],t&&t.length)for(var c=0;c<t.length;c++)i={"ИдФайла":(n=t[c]).get("attachId"),"ИдВерсии":n.get("redactionId"),"Название":n.get("fileName"),"Размер":n.get("size"),"ЭтоСсылка":!!n.get("msgFileIsLink")},this._finishParams.push(i)}},_dotTplFn:n,$constructor:function(){},init:function(){i.superclass.init.call(this)},getIcon:function(){return"sprite:icon-16 icon-Attach icon-primary"},getCaption:function(){return rk("Прикрепить к диалогу")}});return i});
//# sourceMappingURL=AttachMsg.module.js.map
define("html!SBIS3.Contacts.FileViewerSlider/templates/secondRow",function(){var e=function(e){var t=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(t){for(;e.test(t);)t=t.replace(e,"&#123;&#123;$1&#125;&#125;");return t}}(),r=function(e){return e.join?e.join(""):e.toString()},n=function(e){return void 0===e?"":e&&"object"==typeof e?r(e):""+e},o="undefined"!=typeof process,i=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,"<div> "),a=!!e.item.get("msgIsRedaction"),s=e.item.get("msgSendDate"),d=a?e.item.get("lastChange"):s,l=new Date,u=d||l,f=l.getYear()==u.getYear()?u.strftime("%e %b %H:%M").toLowerCase().replace(".",""):u.strftime("%e %b %Y").toLowerCase().replace(/\//g,"."),c=e.item.getSizeHtml();return f=s?[a?rk("редакция"):rk("отправлено")," ",f].join(""):"",c="&mdash;"!==c?"("+c+")":"",i+=" "+t(n(f))+" "+t(n(c))+" </div>",(i=t(i))+(o&&-1!==i.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.FileViewerSlider/templates/secondRow"}},e});
//# sourceMappingURL=secondRow.xhtml.map
define("html!SBIS3.Contacts.FileViewerSlider/templates/PanelTemplate",function(){var e=function(e){var i=function(){var e=/\{\{([\s\S]+?)\}\}/g;return function(i){for(;e.test(i);)i=i.replace(e,"&#123;&#123;$1&#125;&#125;");return i}}(),t=function(e){return e.join?e.join(""):e.toString()},r=function(e){return void 0===e?"":e&&"object"==typeof e?t(e):""+e},d="undefined"!=typeof process,n=(("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,'<div> <div class="contacts-FileViewerSlider-document-list__wrapper"> <div class="contacts-FileViewerSlider-document-list" id="'+i(r(e.viewerID))+'"></div> </div> <div class="contacts-FileViewerSlider__massOperations"></div> <div class="contacts-FileViewerSlider-controls"> <div class="contacts-FileViewerSlider-count"> '+i(r(rk("Всего")))+": "+i(r(e.countFiles))+' </div> <div class="contacts-FileViewerSlider-buttons"> <div class="hideButtons"> <div id="'+i(r(e.saveID))+'"></div> <div class="contacts-FileViewerSlider-download" id="'+i(r(e.downloadID))+'"></div> <div id="'+i(r(e.modeVisibilityID))+'"></div> </div> <div id="'+i(r(e.hideID))+'"></div> </div> </div> </div>');return(n=i(n))+(d&&-1!==n.indexOf("{{")?String.fromCharCode(8203,8203):"")};return e.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.FileViewerSlider/templates/PanelTemplate"}},e});
//# sourceMappingURL=PanelTemplate.xhtml.map
define("js!SBIS3.Contacts.FileViewerSlider",["Core/js-template-doT","Core/core-extend","Core/core-instance","Core/helpers/string-helpers","Core/IoC","Core/EventBus","Core/Deferred","Core/detection","js!SBIS3.CONTROLS.CompoundControl","html!SBIS3.Contacts.FileViewerSlider/templates/PanelTemplate","html!SBIS3.Contacts.FileViewerSlider/templates/secondRow","js!SBIS3.DOCVIEW.List","js!SBIS3.DOCVIEW.OperationPanel","js!SBIS3.CONTROLS.ComponentBinder","js!SBIS3.Contacts.MessagesExchangeEvents","js!SBIS3.Contacts.CommonFunctions.Global","js!WS.Data/Source/SbisService","js!WS.Data/Query/Query","js!WS.Data/Entity/Model","js!SBIS3.CONTROLS.Link","js!SBIS3.Contacts.Mixins.Services.Executor.FileListUpdate","js!SBIS3.Contacts.Mixins.Services.Consumer","js!SBIS3.Contacts.MessagesExchangeEvents","css!SBIS3.Contacts.FileViewerSlider/Slider","is!browser?js!SBIS3.Contacts.CoreMiniFunctions/string.format","i18n!SBIS3.Contacts.FileViewerSlider","js!SBIS3.Contacts.DOCVIEW.cmdAttachMsg","js!SBIS3.Contacts.DOCVIEW.cmdSaveToDocs"],function(e,t,i,n,o,r,s,a,l,c,d,u,f,h,_,g,m,p,S,w,v,C,F){"use strict";var I=e.template('<div class="contacts-FileViewerSlider">'+'<div class="contacts-FileViewerSlider-slide-button ws-hidden">'+'<div class="contacts-FileViewerSlider-slide-label">{[0]}</div>'+'<div class="icon-16 icon-Attach icon-primary"></div>'+"</div>"+"</div>"),P=l.extend({_dotTplFn:I,$protected:{_options:{name:"FileViewerSlider",themeGUID:"",fileToViewSources:[],slideContainerID:"",defaultShow:false,signShow:false,widthFiles:250,docviewMode:false,isLocked:false,hideIfEmpty:true},_currentFilesIds:[],_needLoadScrollTop:600,_prevScrollPosition:void 0,_hasAny:false,_nextPageLoading:false,_pageSize:10,_currentPage:0,_openButton:null,_status:false,_currentCount:0,_currentSize:0,_slideContainer:null,_documentViewer:null,_currentRecordSet:null,_getFileSizeRender:g.getFormattedSizeString,_fileSources:[],_isFilesTheme:false,_isBilling:g.isBilling(),_optionsUsr:{cmdAttachMsg:{name:"cmdAttachMsg",icon:"sprite:icon-16 icon-Attach icon-primary",tooltip:rk("Прикрепить к диалогу"),caption:rk("Прикрепить к диалогу"),isMainAction:false,weight:230,weightlist:30,weightmas:320,inList:true,inMas:true,typeCmd:"r",cmdClass:"js!SBIS3.Contacts.DOCVIEW.cmdAttachMsg"},cmdSaveToDocs:{name:"cmdSaveToDocs",icon:"sprite:icon-16 icon-Attach icon-primary",tooltip:rk("Сохранить в документы"),caption:rk("Сохранить в документы"),isMainAction:false,weight:240,weightlist:40,weightmas:330,inList:true,inMas:true,typeCmd:"r",cmdClass:"js!SBIS3.Contacts.DOCVIEW.cmdSaveToDocs"}}},$constructor:function(){this._publish("onSliderShow","onSliderHide","onAttachMsg")},init:function(){if(P.superclass.init.call(this),this._options.widthFiles<190){var e=[rk("Не верные параметры")," FileViewerSlider. ",rk("Миниимальная ширина панели файлов")," 190px"].join("");return void o.resolve("ILogger").error(e)}var t=this,i=t.getContainer(),n=t._getOpenBtn();t._openButton=n,n.click(function(){if(!t._status)t._loadFiles(false),t._options.defaultShow=true,t._showPanel(false)});var s=r.channel("ticker"),a=function(){if(t._hasAny&&!t._nextPageLoading&&t.isVisibleWithParents()){if(t._scrollableContainer=t._scrollableContainer&&t._scrollableContainer.length||i.find(".contacts-FileViewerSlider-document-list__wrapper"),t._scrollableContainer&&t._scrollableContainer.length)t._prevScrollPosition=t._scrollableContainer.scrollTop();if(void 0!==t._prevScrollPosition&&t._prevScrollPosition<=t._needLoadScrollTop){if(t._listContainer=t._listContainer||i.find(".contacts-FileViewerSlider-document-list"),t._listContainer)t._prevScrollPosition=t._listContainer.height()-t._prevScrollPosition;t._nextPageLoading=true,t._hasAny=false,t._loadNextPage()}}};t.subscribeTo(s,"onTick",a),t.subscribeTo(_,"onFilesSign",t.onFilesSign.bind(t))},hidePanel:function(){if(this.isVisibleWithParents())this._hidePanel()},setBlockFiles:function(e){if(this._options.isLocked=e,this._documentViewer)this._documentViewer.setEnabled(!e),this._documentViewer.setUserCommands(this._getOptionsUsrArr())},refreshCount:function(){var e=this,t=new m({endpoint:"PublicMsgApi"}),i=function(){var t=e._getOpenBtn().find(".contacts-FileViewerSlider-slide-label"),i=e._slideContainer?e._slideContainer.find(".contacts-FileViewerSlider-count"):null;if(!e._currentCount&&e._options.hideIfEmpty)e._hidePanel();else if(t.html(e._currentCount>99?"99+":e._currentCount),e._setButtonVisible(!!e._currentCount),i)i.html([rk("Всего")+": ",e._currentCount," ",1==e._currentCount?rk("файл","fvs"):n.wordCaseByNumber(e._currentCount,rk("файлов","fvs"),rk("файл","fvsMany"),rk("файла","fvs"))," (",e._getFileSizeRender(e._currentSize),")"].join(""))};if(!e._options.themeGUID)return void i();t.call("getCountFileByTheme",{"Тема":e._options.themeGUID,"ПолучитьИдентифаторы":true}).addCallbacks(function(t){var n=t?t.getRow():null;if(n)e._currentCount=n.get("Итого"),e._currentSize=n.get("Размер"),e._currentFilesIds=n.get("Идентификаторы");else e._currentCount=0;i()},function(t){o.resolve("ILogger").error(t),e._hidePanel()})},setThemeGUID:function(e){if(e)if(this._options.themeGUID=e,this._loadFiles(true),this._options.docviewMode)this._showPanel(true)},showPanelWithSources:function(e,t){this.setSources(e,t),this._showPanel(true)},setSources:function(e,t){var i=this;if(!(e&&e.length))return;this._options.themeGUID=t,i._currentCount=0,i._currentRecordSet=null,i._currentSize=0,i._options.fileToViewSources=e,i.subscribeToFileChanges(void 0,true),i._loadFiles(true)},setSignOption:function(e){var t=this,i;if(e!=t._options.signShow&&t._documentViewer)t._options.signShow=e,i=t._getOptionsUsrArr(),t.getChildControlByName("ПросмотрщикВложений").setUserCommands(i)},getFilesGUID:function(){var e=this,t=e._currentRecordSet?e._currentRecordSet:null,i=[],n;if(t)t.each(function(e){if(n=e.get("msgFileId"),n)i.push(n)});return i},getFileRecordSet:function(){return this._currentRecordSet},subscribeToFileChanges:function(e,t){function i(e,t){if(n._isDestroyedPanel())return;n._checkAllFileResources(this,t),n.consume("fileListUpdate",{files:t,mode:"add"})}var n=this,o=n.getComponentSources(),r;if(t)n._fileSources=[];for(var s=o.length;s--;)(r=o[s]).addCallback(function(e){n._fileSources.push(e),n.subscribeTo(e,"onFileListChanged",i.bind(n))});n.subscribeTo(F,"onNewFileVersion",n.onNewFileVersion.bind(n))},getComponentSources:function(){for(var e=this,t=e.getParent(),i=e._options.fileToViewSources,n=[],o,r,a=0;a<i.length;a++)if(o=i[a],"string"===typeof o){if(r=t.waitChildControlByName(o),r)n.push(r)}else(r=new s).addCallback(function(){return o}),n.push(r),r.callback();return n},_getOpenBtn:function(){return this.getContainer().find(".contacts-FileViewerSlider-slide-button")},_loadFiles:function(e){var t=this,i=t._documentViewer;if(t._currentPage=0,t._hasAny=false,t._nextPageLoading=true,t._prevScrollPosition=void 0,t._options.themeGUID){if(t._currentRecordSet&&t._isFilesTheme&&!e)return;t._getBLFilesFromTheme().addCallback(function(e){if(t._isDestroyedPanel())return void(t._nextPageLoading=false);if(e){if(i)i.getLinkedContext().setValue("ctxSliderFilesList",e);t.getLinkedContext().setValue("ctxSliderFilesList",e),t._updateInfoFile(e),t.refreshCount(),t._goToBottom(),t._isFilesTheme=true,t._nextPageLoading=false}})}else{if(t._checkAllFileResources(void 0,void 0),0===t._currentCount){var n=t.getLinkedContext().getValue("ctxSliderFilesList");n&&n.clear()}t.refreshCount()}},_removeFilesFromRecordSet:function(e,t){var i=0,n;for(t.sort(),n=0;n<t.length;n++)e.removeAt(t[n]-i),i+=1;return e},_clearRecordSet:function(e,t){var i=[];return t.each(function(t,n){if(e.getRecordById(t.getId()))i.push(n)}),this._removeFilesFromRecordSet(t,i)},_loadNextPage:function(){var e=this,t=e._documentViewer.getLinkedContext().getValue("ctxSliderFilesList");e._getBLFilesFromTheme().addCallback(function(i){t.prepend(e._clearRecordSet(t,i)),e._nextPageLoading=false})},_addFiles:function(e,t){var i=this,n=i._documentViewer.getLinkedContext().getValue("ctxSliderFilesList"),o,r,s=[];if(i._options.themeGUID)i._getBLFilesFromTheme(e).addCallback(function(e){if(e.each(function(e,t){if(r=e.getId(),o=n.getIndexByValue("attachId",r),o>-1)n.replace(e,o),s.push(t)}),s.length)i._removeFilesFromRecordSet(e,s);n.append(e),i.refreshCount()});else{if(t)i._checkAllFileResources(void 0,void 0);i.refreshCount()}},_deleteFiles:function(e,t){if(e&&e.length){var i=this,n=i._documentViewer.getLinkedContext().getValue("ctxSliderFilesList"),o,r;if(t)i._checkAllFileResources(void 0,void 0),i.refreshCount();else i._getBLFilesFromTheme(e).addCallback(function(t){if(t.each(function(t){if(r=t.getId(),o=n.getIndexByValue("attachId",r),o>-1)if(n.replace(t,o),o=Array.indexOf(e,r),o>-1)e.splice(o,1)}),e.length){var s=[],a;for(a=0;a<e.length;a++)if(o=n.getIndexByValue("attachId",e[a]),o>-1)s.push(o);if(s.length){if(i._currentPage-=Math.floor(s.length/i._pageSize)+1,i._currentPage<0)i._currentPage=0;i._removeFilesFromRecordSet(n,s)}}i.refreshCount()})}},_updateInfoFile:function(e){var t=this;if(!i.instanceOfModule(e,"WS.Data/Collection/RecordSet"))return;t._currentCount=e.getCount(),t._currentRecordSet=e,t._currentFilesIds=[],t._currentSize=0,e.each(function(e){var i=e.get("attachId");if(t._currentSize+=e.get("size"),i)t._currentFilesIds.push(i)})},_checkAllFileResources:function(e,t){var n=this,o=n._fileSources,r=n._currentRecordSet,s=n._documentViewer,a=n.getFilesGUID(),l=[],c=[],d=[],u=[],f,h,_,g,m,p,S,w,v,C;function F(){return S=n._getRecordInfoByValue(r,"attachId",p),S&&S.hasOwnProperty("index")?S.index:-1}if(e&&t){if(f=t.hasOwnProperty("RecordSet")?t.RecordSet:null,t.hasOwnProperty("changedKeys"))u=(_=t.changedKeys).hasOwnProperty("added")?_.added:[],d=_.hasOwnProperty("removed")?_.removed:[];if(!i.instanceOfModule(f,"WS.Data/Collection/RecordSet")||!u.length&&!d.length)return;if(u.length)if(!r){if(f.getCount())r=f}else for(C=0;C<u.length;C++)if(w=u[C],-1===Array.indexOf(a,w))if(S=n._getRecordInfoByValue(f,"msgFileId",w),g=S&&S.hasOwnProperty("record")?S.record:null,p=S&&S.hasOwnProperty("attachId")?S.attachId:null,v=F(),g&&v<0)n._addRecordFormat(g,r);if(d.length&&r)for(C=0;C<d.length;C++)if(w=d[C],v=F(),v>=0)r.removeAt(v)}else for(var I=0;I<o.length;I++){if(m=o[I],f=m.getFilesList(),!i.instanceOfModule(f,"WS.Data/Collection/RecordSet"))continue;if(!r){r=f;continue}for(h=f.toArray(),C=0;C<h.length;C++){if(g=h[C],w=g.get("msgFileId"),p=g.get("attachId"),c.push(w),Array.indexOf(l,p)>=0)continue;if(l.push(p),-1===Array.indexOf(a,w))n._addRecordFormat(g,r)}}if(!r)return;if(s)s.getLinkedContext().setValue("ctxSliderFilesList",r);n.getLinkedContext().setValue("ctxSliderFilesList",r),n._updateInfoFile(r)},_getNewFilesUser:function(){for(var e=this._fileSources,t,n,o,r,s,a,l,c,d=0;d<e.length;d++){if(s=e[d],a=s.filesCanBeDeleted(),!a)continue;if(n=s.getFilesList(),!i.instanceOfModule(n,"WS.Data/Collection/RecordSet"))continue;for(t=n.toArray(),c=0;c<t.length;c++)if(r=t[c],o=!!r.get("msgIsRedaction"),o)n.remove(r);if(!l&&n.getCount()){l=n;break}}return l},_isOnlyNewFilesUser:function(){var e=this,t=e._currentRecordSet,i,n,o,r,s,a;if(!t)return false;if(n=e._getNewFilesUser(),!n)return false;i=t.toArray();for(var l=0;l<i.length;l++)if(o=i[l],r=o.get("attachId"),s=e._getRecordInfoByValue(n,"attachId",r),a=s&&s.hasOwnProperty("index")?s.index:-1,a<0)return false;return true},_mergeFiles:function(e){var t=this,i,n,o,r,s,a,l,c;if(n=t._getNewFilesUser(),!n)r=e;else{r=e,i=n.toArray();for(var d=0;d<i.length;d++)if(o=i[d],l=o.get("msgFileId"),s=o.get("attachId"),a=t._getRecordInfoByValue(r,"attachId",s),c=a&&a.hasOwnProperty("index")?a.index:-1,o&&c<0)t._addRecordFormat(o,r)}return r},_setButtonVisible:function(e){if(e&&!this._options.docviewMode){if(this._currentCount&&!this._status)this._openButton.removeClass("ws-hidden")}else this._openButton.addClass("ws-hidden")},_showPanel:function(e){if(!this._options.defaultShow&&!e)return;if(false===this._notify("onSliderShow"))return;if(e)if(this._status=true,!this._documentViewer)this._createPanel(),this._setButtonVisible(false),this._goToBottom();if(this._options.docviewMode)this._setButtonVisible(false);if(this._documentViewer)this._documentViewer.setEnabled(!this._options.isLocked)},_hidePanel:function(e){this._notify("onSliderHide",!!e),this._status=false},_getOptionsUsrArr:function(e){var t=this,i=t._optionsUsr,n=[];if(!t._options.isLocked)if(n.push(i["cmdAttachMsg"]),e)n.push(i["cmdSaveToDocs"]);return n},_setWidthFilesAfterShow:function(){this.setWidthFiles(this.needwidthFiles),this.needwidthFiles=null},setWidthFiles:function(e){if(isNaN(e))return;if(e=parseInt(e,10),e<190)e=190;var t=this;if(!t.isVisibleWithParents()){if(!t.needwidthFiles)t.once("onaftervisibilitychange",t._setWidthFilesAfterShow);return void(t.needwidthFiles=e)}if(t._documentViewer){var i=t.getContainer();i.css("width",e).width(),i.find(".contacts-FileViewerSlider-controls").css("width",e-1).width();var n=i.find(".contacts-FileViewerSlider-document-list");if(n.css("width",e-22).width(),t._documentViewer._options.listOptions.previewWidth=e-38,t._documentViewer._options.listOptions.previewHeight=e-58,t._documentViewer._options.listOptions.calcMargin=true,t._documentViewer._calcMargin(),t._documentViewer._options.listOptions.calcMargin=false,n.css("width",e).width(),e<=215){if(e>200)var o="font1";else if(e<=200)o="font2";i.find(".contacts-FileViewerSlider-count").removeClass("font1").removeClass("font2").addClass(o)}i.find(".contacts-FileViewerSlider__massOperations").css("width",e+2)}else t._options.widthFiles=width},_createPanel:function(){var e=this,t=o.resolve("ILogger"),i=e._options.themeGUID,r=e._options.widthFiles,s=e.getContainer(),l="mode_visibility_"+i,_="document-list_"+r+"_"+i,m="save_"+i,p="download_"+i,S="hide_"+i,v,C,F;if(!s.length)return;if(e._slideContainer=s,F=c.apply(e,[{viewerID:_,countFiles:[e._currentCount,1==e._currentCount?rk("файл","fvs"):n.wordCaseByNumber(e._currentCount,rk("файлов","fvs"),rk("файл","fvsMany"),rk("файла","fvs")),"(",e._getFileSizeRender(e._currentSize),")"].join(" "),saveID:m,downloadID:p,hideID:S,modeVisibilityID:l}]),s.addClass("contacts-FileViewerSlider contacts-FileViewerSlider-slide-container").append(F),s.css("width",r),s.find(".contacts-FileViewerSlider-controls").css("width",r-1),s.find(".contacts-FileViewerSlider-document-list").css("width",r),r<=215){if(r>200)C="font1";else if(r<=200)C="font2";s.find(".contacts-FileViewerSlider-count").addClass(C)}v=e._getOptionsUsrArr(),e._documentViewer=new u({parent:e,opener:e,linkedContext:e.getLinkedContext(),objectName:"ДокументДляОтображения",name:"ПросмотрщикВложений",element:_,className:"sliderFilesList docview-fullinfo docview-short-list controls-Scroll__container",mainOptions:{serviceBLName:"СБИСДиск.Приватный",ctxLinkList:"ctxSliderFilesList",useOnlyCtx:true,objectName:"FileSD",serviceUrl:"/disk/api/v1/",userParams:{themeGUID:i},commands:{print:!a.isMobilePlatform,rights:true,sendMessage:false,deletePermanentlyDoc:false,deleteDoc:false,restore:false,move:false,fullScreen:false,saveToPdf:false,copyToBuffer:true,signDocument:false},userCommands:v},listOptions:{goToFolder:false,previewWidth:r-30,previewHeight:r-50,multiselect:true,calcMargin:false,hideBreadCrumbs:true,includedTemplates:{subtitle:d},visibilityMode:{defaultMode:"bigPreview",folderAsPreview:true},itemsSortMethod:function(e,t){return e.index-t.index}},handlers:{onFinishCommand:function(t,i,n){if(n&&n.hasOwnProperty("finishParams")&&!e._options.isLocked)if("cmdAttachMsg"===i)for(var o=0;o<n.finishParams.length;o++)e._notify("onAttachMsg",n.finishParams[o])},onDrawItems:function(){if(e._scrollableContainer&&e._prevScrollPosition&&e._listContainer&&"function"==typeof e._scrollableContainer.scrollTop)e._scrollableContainer.scrollTop(e._listContainer.height()-e._prevScrollPosition);else e._goToBottom()},onReady:function(){var t=this;if(!g.isBilling()&&e._options.signShow&&t.setUserCommands)g.getSignOptionsForDocView().addCallback(function(i){var n=i.commands;if(!e._options.isLocked)n.push(e._optionsUsr.cmdAttachMsg);t.setUserCommands(n),t.subscribeTo(t,"onFinishCommand",i.handler)})}}});var I=s.find(".contacts-FileViewerSlider__massOperations"),P=s.find(".contacts-FileViewerSlider-buttons").find(".hideButtons");I.css("width",r+2),e._operationPanel=new f({name:"browserOperationsPanel",hasItemsMenu:true,parent:e,opener:e,linkedContext:e.getLinkedContext(),element:I,mainOptions:{serviceBLName:"СБИСДиск.Приватный",ctxLinkList:"ctxSliderFilesList",useOnlyCtx:true,objectName:"FileSD",serviceUrl:"/disk/api/v1/",userParams:{themeGUID:i},commands:{print:!a.isMobilePlatform,rights:false,sendMessage:false,deletePermanentlyDoc:false,deleteDoc:false,restore:false,move:false,fullScreen:false,saveToPdf:false,copyToBuffer:true,signDocument:true,encrypt:false},userCommands:e._getOptionsUsrArr(true)},handlers:{onToggle:function(){var t=e._operationPanel&&e._operationPanel.isVisible();P[t?"hide":"show"]()},onFinishCommand:function(t,i,n){if(n&&n.hasOwnProperty("finishParams")&&!e._options.isLocked)if("cmdSaveToDocs"===i)y(n.finishParams)}}});var V=e._documentViewer.getTreeView();new h({view:V,operationPanel:e._operationPanel}).bindOperationPanel(false),e._operationPanel.setLinkedView(V);try{if(!e._options.isLocked)e._documentViewer.setCommandCfg("rename",{inList:false})}catch(e){t.error("Ошибка при установки опции rename либо шаблона bigPreview в Docview.List (FileViewerSlider).\n"+e)}if(new w({parent:e,element:m,name:"СохранитьФайлыНаДиск",caption:"",tooltip:rk("Сохранить в документы","fvs"),icon:"sprite:icon-16 icon-SaveAs icon-primary",handlers:{onActivated:e.onActivatedButtonSave}}),!a.isMobilePlatform)new w({parent:e,element:p,name:"СкачатьФайлыАрхивом",caption:"",tooltip:rk("Скачать архивом","fvs"),icon:"sprite:icon-16 icon-Save icon-primary",handlers:{onActivated:e.onActivatedButtonDownload}});new w({parent:e,element:S,name:"СвернутьПанельФайлов",caption:rk("Свернуть","fvs"),tooltip:rk("Свернуть","fvs"),handlers:{onActivated:function(){e._hidePanel()}}})},_goToBottom:function(){if(!this._slideContainer)return;var e=this._slideContainer.find(".contacts-FileViewerSlider-document-list__wrapper"),t=this._slideContainer.find(".contacts-FileViewerSlider-document-list");if(e.height()<t.height())e.scrollTop(t.height())},_getSelectedFiles:function(){var e=this,t=e._documentViewer,n=t?t.getSelectedItems():null,o=[],r=[],s;if(e._currentRecordSet)o=e._currentFilesIds;if(i.instanceOfModule(n,"WS.Data/Collection/List"))if(n.each(function(e){if(s=e.get("attachId"),s)r.push(s)}),r.length)o=r;return o},_addRecordFormat:function(e,t){var i;i=new S({adapter:t.getAdapter()}),t.getFormat().each(function(t){i.addField(t,void 0,e.get(t.getName()))}),t.add(i)},_getRecordInfoByValue:function(e,t,i){var n,o,r,s,a;if(!e)return;n=e.toArray();for(var l=0;l<n.length;l++)if(o=n[l],a=o.get(t),a===i){s={index:l,attachId:r=o.get("attachId"),record:o};break}return s},_isDestroyedPanel:function(){var e=this;if(e&&e.isDestroyed)return e.isDestroyed();return true},onActivatedButtonSave:function(){y(this.getParent()._getSelectedFiles())},onActivatedButtonDownload:function(){var e=this.getParent()._getSelectedFiles();if(e.length)V(e);else o.resolve("ILogger").info("Нет прикрепленных файлов")},onFilesSign:function(e,t){if(this._isDestroyedPanel())return;var i=this._documentViewer.getTreeView().getItems(),n,o,r;for(o=0;o<t.length;o++)if(n=t[o],n.hasOwnProperty("redactionId"))if(r=i.getIndexByValue("redactionId",n.redactionId),r>-1)g.fillMySignData(i.at(r))},onNewFileVersion:function(e,t){if(this._isDestroyedPanel())return;if(!(t&&t.hasOwnProperty("fileID")&&t.hasOwnProperty("themeID")&&t.hasOwnProperty("fileName")))return;var i=this,n=i._documentViewer,o=i._currentRecordSet,r=t.fileName,s=t.hasOwnProperty("isRename")?t.isRename:false,a=false,l,c,d,u,f,h,_;if(!o)return;if(t.hasOwnProperty("attachId"))d=t.attachId,h=(u=i._getRecordInfoByValue(o,"attachId",d))&&u.hasOwnProperty("index")?u.index:-1,f=u&&u.hasOwnProperty("record")?u.record:null;if(s&&f&&f.get("fileName")&&f.get("fileName")!==r)f.set("fileName",r),f.set("title",r),a=true;else if(!s&&f)if(l=t.hasOwnProperty("redactionId")?t.redactionId:null,_=t.hasOwnProperty("hash")?t.hash:null,c=t.hasOwnProperty("lastChange")?t.lastChange:null,l&&_&&c&&f.get("hash")&&_!=f.get("hash")){if(f.set("redactionId",l),f.set("hash",_),f.set("lastChange",c),t.hasOwnProperty("msgIsRedaction"))f.set("msgIsRedaction",true);if(t.hasOwnProperty("Editor")&&t.Editor)f.set("Editor",t.Editor);if(t.hasOwnProperty("size")&&t.size)f.set("size",t.size);if(t.hasOwnProperty("lastRedactionId")&&t.lastRedactionId)f.set("lastRedactionId",t.lastRedactionId);if(t.hasOwnProperty("lastRedactionSize")&&t.lastRedactionSize)f.set("lastRedactionSize",t.lastRedactionSize);if(t.hasOwnProperty("lastRedactionOwner")&&t.lastRedactionOwner)f.set("lastRedactionOwner",t.lastRedactionOwner);if(t.hasOwnProperty("hasNewVersion")&&t.hasNewVersion)f.set("hasNewVersion",t.hasNewVersion);a=true}if(a){if(o.replace(f,h),n)n.getLinkedContext().setValue("ctxSliderFilesList",o);i.getLinkedContext().setValue("ctxSliderFilesList",o)}},_getBLFilesFromTheme:function(e){var t=this,n=t._options.themeGUID,r=o.resolve("ILogger"),a=new s,l="ДокументДляОтображения",c="AttachList",d,u,f;if(!n)return u="Плохие параметры FileViewerSlider._getBLFilesFromTheme",r.error(u),a.errback(u),a;if(t.scrollIndicator=t.scrollIndicator&&t.scrollIndicator.length?t.scrollIndicator:t.getContainer().find(".controls-AjaxLoader"),t.scrollIndicator.removeClass("ws-hidden"),f=new p,void 0===e)f.offset(t._pageSize*t._currentPage).limit(t._pageSize).where({catalogId:n});else f.where({catalogId:n,attachIds:e});return a=new m({endpoint:l,binding:{query:c},idProperty:"attachId"}).query(f).addCallbacks(function(n){if(d=n.getAll(),t.scrollIndicator.addClass("ws-hidden"),void 0===e)t._currentPage+=1,t._hasAny=d.getMetaData().more;if(i.instanceOfModule(d,"WS.Data/Collection/RecordSet"))return d},function(e){t.scrollIndicator.addClass("ws-hidden"),r.error("Ошибка при получении файлов по теме",["Ошибка вызова метода: ",l,".",c,"\nПодробности: ",e.details].join(""))}),a}});function y(e){requirejs(["js!SBIS3.EDO.CD.SaveToSbisDisk"],function(t){t.show(e)})}function V(e){require(["js!SBIS3.EDO.CD.CommonDocsHelpers"],function(t){for(var i=[],n=[window.location.protocol,"//",window.location.host,t.getDiskRestServiceURL()].join(""),o=0,r=e.length;o<r;o++)i.push(n+e[o]);t.downloadFiles(i)})}return t.mixin(P,[v,C])});
//# sourceMappingURL=Slider.module.js.map
define("js!SBIS3.Contacts.FileViewerButton",["Core/js-template-doT","Core/core-extend","Core/IoC","js!SBIS3.CONTROLS.CompoundControl","js!SBIS3.Contacts.Mixins.Services.Executor.Base","js!WS.Data/Source/SbisService","js!SBIS3.Contacts.Mixins.Services.Consumer","css!SBIS3.Contacts.FileViewerButton/Button"],function(e,t,i,s,n,o,r){"use strict";var l=e.template('<div class="contacts-FileViewerSlider">'+'<div class="contacts-FileViewerSlider-slide-button ws-hidden">'+'<div class="contacts-FileViewerSlider-slide-label">{[0]}</div>'+'<div class="icon-16 icon-Attach icon-primary"></div>'+"</div>"+"</div>"),u=s.extend({_dotTplFn:l,$protected:{_options:{autoUpdateCount:true},_lastCount:0},$constructor:function(){this._publish("onSliderShow")},init:function(){u.superclass.init.call(this),this.register(["fileListUpdate"]);var e=this;e._openButton=e._getOpenBtn(),e._openButton.click(function(){e._notify("onSliderShow")})},refreshCount:function(e,t){if(this._getOpenBtn().find(".contacts-FileViewerSlider-slide-label").html(e>99?"99+":e),!t||!this._lastCount||this._lastCount&&!e)this._setButtonVisible(!!e),this.consume("setRightSideOpenerVisible",!!e);this._lastCount=e},setThemeGUID:function(e,t){if(e)if(this._options.themeGUID=e,void 0===t)this._getFilesCountFromBL();else this.refreshCount(t)},_getOpenBtn:function(){return this.getContainer().find(".contacts-FileViewerSlider-slide-button")},_setButtonVisible:function(e){if(e)this._openButton.removeClass("ws-hidden");else this._openButton.addClass("ws-hidden")},_getFilesCountFromBL:function(){var e=this,t=new o({endpoint:"PublicMsgApi"});if(e._options.themeGUID)t.call("getCountFileByTheme",{"Тема":e._options.themeGUID}).addCallbacks(function(t){var i=t?t.getScalar():0;if(!e.isDestroyed())e.refreshCount(i,true)},function(e){i.resolve("ILogger").error(e)})},seFileListUpdate:function(e){if(e&&e.search){var t=[],i,s=false;if(e&&e.files&&e.files.length)for(var n=0;n<e.files.length;n++)if(i=e.files[n].get("attachId"),i&&-1==Array.indexOf(t,i))t.push(i);var o=this._lastCount;if("replace"===e.mode)o=t.length;else if("delete"===e.mode){if(void 0!==e.count)o=e.count;else o-=t.length;s=true}else if("add"===e.mode)o+=t.length,s=true;this.refreshCount(o,s)}else if(this._options.autoUpdateCount||"replace"===e.mode||"delete"===e.mode)this._getFilesCountFromBL();return{executed:true,result:true}}});return t.mixin(u,[n,r])});
//# sourceMappingURL=Button.module.js.map
define("html!SBIS3.Contacts.SendViewDialog/Dialog",function(){var o=function(o){var n=function(){var o=/\{\{([\s\S]+?)\}\}/g;return function(n){for(;o.test(n);)n=n.replace(o,"&#123;&#123;$1&#125;&#125;");return n}}(),e=function(o){return o.join?o.join(""):o.toString()},i=function(o){return void 0===o?"":o&&"object"==typeof o?e(o):""+o},t="undefined"!=typeof process,a=("undefined"!=typeof _randomHelpers?_randomHelpers:void 0)||global.requirejs("Core/helpers/random-helpers"),p=function(){return this||(0,eval)("this")}().wsDotVarStorage.storage,s='<div class="contacts-SendViewDialog__control" data-bind="style: {width: '+n(i(o.widthBindedContext))+'}"> ',d="private"==o.dialogType,m="lock-private"==o.dialogType,r=d||m,l="invitation"==o.dialogType,c=!r&&!o.restrictedActions.isHiddenCreateTask,g=o.isChat||o.restrictedActions.isHiddenChangeAddressee,u=!r&&!o.restrictedActions.isHiddenChangeAddressee,h=!o.isChat&&!r&&!o.isBilling;return l&&("invite_to_my_circle"==o.inviteType&&(u=!1),r=!0,c=!1,h=!1),s+=' <component data-component="SBIS3.Contacts.MessagesSendViewBase" name="SendViewDialogBase"> <option name="passingMode">true</option> <option name="bottomSideUnderView">'+n(i(o.bottomSideUnderView))+"</option> ",o.hideHeader||(s+=' <options name="topSide"> <option name="name">header</option> <option name="type">SBIS3.Contacts.HeaderDialog</option> <option name="config"> <option name="themeGUID" value="'+n(i(o.themeGUID))+'"/> <option name="isOutComeInvite">'+n(i(o.isOutComeInvite))+'</option> <option name="inviteType">'+n(i(o.inviteType))+'</option> <option name="inviteStatus">'+n(i(o.inviteStatus))+'</option> <option name="invitePerson" type="ref">'+n(i(function(o,n){var e=a.randomId();return o[e]=n,e}(p,o.invitePersonRecord)))+'</option> <option name="dialogType">'+n(i(o.dialogType))+'</option> <option name="isNew">'+n(i(o.isNew))+'</option> <option name="isChat">'+n(i(o.isChat))+'</option> <option name="notClickable">'+n(i(g))+"</option> <option name='docGUID'>"+n(i(o.docGUID))+"</option> <option name='inWindow'>"+n(i(o.inWindow))+"</option> <option name='restrictedActions' type=\"ref\">"+n(i(function(o,n){var e=a.randomId();return o[e]=n,e}(p,o.restrictedActions)))+"</option> </option> </options> "),s+=" ",o.isNew||(s+=' <options name="middleView"> <option name="name">view</option> <option name="type">SBIS3.Contacts.Views.DialogView</option> <option name="config"> <option name="dialogID" value="'+n(i(o.themeGUID))+'"/> <option name="pageSize">20</option> <option name="tabindex">0</option> <option name="notClickable">'+n(i(g))+"</option> ",o.scrollToMessage&&(s+=' <option name="messageID">'+n(i(o.messageGUID))+"</option> "),s+=' </option> </options> <options name="rightSideOpener"> <option name="name">filesPanel</option> <option name="type">SBIS3.Contacts.FileViewerButton</option> <option name="config"> <option name="visible">'+n(i(!o.restrictedActions.isHiddenFileSlider))+'</option> <option name="docviewMode" value="false"/> <option name="autoUpdateCount" value="false"/> <option name="tabindex">0</option> </option> </options> <option name="rightSideWidth">'+n(i(o.widthFiles))+'</option> <options name="rightSide"> <option name="name">filesPanelRight</option> <option name="type">SBIS3.Contacts.FileViewerSlider</option> <option name="config"> <option name="docviewMode" value="true"/> <option name="tabindex">0</option> <option name="widthFiles">'+n(i(o.widthFiles))+'</option> <option name="signShow">'+n(i(!r))+'</option> <option name="hideIfEmpty">false</option> </option> </options> '),s+=' <options name="bottomSide"> <option name="name">sendMessage</option> <option name="type">SBIS3.Contacts.SendMessageInternal</option> <option name="config"> <option name="activableByClick">false</option> <option name="isRefreshHistoryAfterSend">'+n(i(o.isChat))+"</option> <option name='showOptLastThemes'>"+n(i(o.isNew))+'</option> <option name="isNewTheme">'+n(i(o.isNew))+'</option> <option name="focusOnSuggest">'+n(i(o.focusOnSuggest))+'</option> <option name="isEmptySend">'+n(i(!(o.isNew&&!o.docGUID)||l))+'</option> <option name="isInviteTheme">'+n(i(l))+'</option> <option name="clearAfterSend">'+n(i(!(!o.isChat&&!o.clearAfterSendMessage)))+"</option> <option name='placeholder'> ",o.isNew?s+=n(i(rk("Введите ФИО или выберите адресата"))):s+=n(i(rk("Кому: всем участникам или введите ФИО"))),s+="... </option> <option name='placeholderMore'>"+n(i(rk("Добавьте еще адресата")))+"...</option> <option name='moveFocusOutOfRichEditor'>"+n(i(!o.isChat&&o.isMobileIOS))+"</option> <options name='documentDetails'> <option name='docGUID'>"+n(i(o.docGUID))+"</option> </options> <option name='folderId'>"+n(i(o.folderId))+'</option> <option name="tabindex">2</option> <option name="saveNotSendText">true</option> <option name="showPopupOnSendMsg">'+n(i(o.showPopupOnSendMsg))+"</option> <option name='enabled' type='boolean'>"+n(i(o.isNew))+'</option> <option name="visibleWhomField">'+n(i(u))+'</option> <option name="isPrivate">'+n(i(r))+"</option> <options name='showButtons'> <option name=\"task\">"+n(i(c))+"</option> <option name='dialog'>false</option> <option name='New'>false</option> <option name='attachFile'>"+n(i(!o.restrictedActions.isHiddenAttachFile))+"</option> </options> <option name='visibleSignatureBtnOnAttach'>"+n(i(h))+'</option> <option name="expandableButtons">editortools</option> <option name="dialogID">'+n(i(o.themeGUID))+'</option> <option name="visible" type=\'boolean\' value="'+n(i(o.startWidthSendMessageVisible))+'"/> <options name="visibleTabsInAdresseeChoice"> <option name="companies">'+n(i(!o.isBilling))+'</option> <option name="employees">'+n(i(!o.isBilling))+'</option> <option name="myContacts">true</option> <option name="findContacts">false</option> <option name="groups">false</option> </options> <option name=\'hasVideoMessage\'>'+n(i(!o.restrictedActions.isHiddenVideoMessage))+'</option> <option name="filesDropElement">.contacts-SendViewDialog__control</option> <option name="needCheckMyCircle">'+n(i(o.isNew&&!o.docGUID))+'</option> </option> </options> <option name="bottomPosition" value="underview"/> </component> </div>',(s=n(s))+(t&&-1!==s.indexOf("{{")?String.fromCharCode(8203,8203):"")};return o.toJSON=function(){return{$serialized$:"func",module:"html!SBIS3.Contacts.SendViewDialog/Dialog"}},o});
//# sourceMappingURL=Dialog.xhtml.map
define("js!SBIS3.Contacts.SendViewDialog",["Core/detection","Core/helpers/String/escapeHtml","Core/Indicator","Core/Context","Core/IoC","Core/Deferred","Core/CommandDispatcher","js!SBIS3.CONTROLS.CompoundControl","html!SBIS3.Contacts.SendViewDialog/Dialog","js!SBIS3.Contacts.MessagesExchangeEvents","js!SBIS3.Contacts.CoreMiniFunctions","js!WS.Data/Source/SbisService","js!SBIS3.Contacts.Mixins.Services.Site","js!SBIS3.Contacts.Mixins.Services.Consumer","js!SBIS3.Contacts.Mixins.Services.Executor.Base","js!SBIS3.Contacts.Mixins.Interface.PanelFirstShowHelper","js!SBIS3.Contacts.Mixins.Services.Executor.CheckReceiversLimits","js!SBIS3.Contacts.CachingPersons","js!WS.Data/Query/Query","js!WS.Data/Entity/Model","js!SBIS3.Contacts.Mixins.Interface.AlertTabOnMessages","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonPhoto","tmpl!SBIS3.Contacts.Models.MiniBaseModel/templates/PersonEmployment","js!SBIS3.Contacts.PersonActivityManager","Core/UserInfo","js!WS.Data/Entity/Record","js!SBIS3.Contacts.MessagesSendViewBase","js!SBIS3.Contacts.HeaderDialog","js!SBIS3.Contacts.Views.DialogView","js!SBIS3.Contacts.SendMessageInternal","js!SBIS3.Contacts.FileViewerSlider","js!SBIS3.Contacts.FileViewerButton","js!SBIS3.ENGINE.LinkValidator","css!SBIS3.Contacts.SendViewDialog/Dialog","css!SBIS3.Contacts.Models.MiniBaseModel/styles/PersonEmployment"],function(e,t,i,o,n,s,a,r,l,d,c,f,h,u,g,_,p,m,C,v,b,S,D,T,w,I){var y;return y=r.extend([h,u,g,_,p,b],{_dotTplFn:l,$protected:{_options:{name:"SendViewDialog",handlers:{},handlersPanel:{},themeGUID:null,messageGUID:null,scrollToMessage:false,docGUID:null,folderId:null,isNew:false,isMobileAndroid:false,isChat:false,clearAfterSendMessage:false,isExistTheme:false,showPopupOnSendMsg:true,isDeleteForever:false,bottomSideUnderView:true,restrictedActions:{isHiddenVideoMessage:false,isHiddenAudioMessage:false,isHiddenAttachFile:false,isHiddenFileSlider:false,isHiddenCreateTask:false,isHiddenLinkDocument:false,isHiddenDeleteDialog:false,isHiddenMoveToFolder:false,isHiddenChangeAddressee:false,isHiddenLinkTheme:false,isHiddenConvertToChat:false},messageRecievers:[],minWidthMemberHeader:120,widthFixed:678,widthBindedContext:"widthBindedContext",widthFiles:250,canChangeSelfWidth:true,defIndicator:null,getFileFromPlugin:false,getFileFromBuffer:false,messageText:void 0,focusOnSuggest:false,baseComponentName:"SendViewDialogBase",hideHeader:false,isBilling:false,dialogMembersCount:null,fileIdsForAttach:[],switchVisibilityOnLoad:true,inWindow:false,dialogType:"dialog",isMobileIOS:e.isMobileIOS,inviteObject:{},readOnly:false},_sendViewReady:false,_baseControl:void 0,_docRedactionListLoadDef:null,_docRedactionList:null,_savedTitle:"Просмотр диалога"},$constructor:function(){this._publish("onSuccessSend","onSuccessCreateTask","reloadView");var e=this.getLinkedContext();e.setValue(this._options.widthBindedContext,this._options.widthFixed),this.subscribeTo(e,"onFieldChange",this._onContextFieldChanged.bind(this))},init:function(){y.superclass.init.call(this);var e=this;if(e.register(["closePanel"]),e._options.handlers&&e._options.handlers.onReadyPanelTemplate)e._options.handlers.onReadyPanelTemplate(e);if(this._options.inWindow)e.getContainer().css("height",$("#contentAreaEdit").height()),e.subscribeTo(e,"onResize",function(){e.getContainer().css("height",$("#contentAreaEdit").height())}),e._loadData();else c.loadDialogsSettings().addCallback(function(){e._loadData()});if(e._options.isNew&&!e._options.messageRecievers.length){var t=e._getBaseControl().getBottomsideControl();t.once("onAfterShow",function(){if(e._options.getFileFromPlugin||e._options.fileIdsForAttach.length)e._options.getFileFromPlugin=false,t.moveFocusToEditor(),setTimeout(function(){if(i.hide(),e._options.fileIdsForAttach.length)t.attachFilesByIds(e._options.fileIdsForAttach),e._options.fileIdsForAttach=[];else t.getFileFromPlugin()},300);else if(e._options.getFileFromBuffer)e._options.getFileFromBuffer=false,t.moveFocusToEditor(),setTimeout(function(){i.hide(),t.getFileFromBuffer()},300);else t.moveFocusToWhomField()})}this.subscribeTo(this.getChildControlByName("SendViewDialogBase"),"onRightAreaShow",this._onRightAreaShow.bind(this))},seClosePanel:function(){this.closePanel()},setMessageRecievers:function(e){if(e&&e.length){var t=this,i=t._getBaseControl(),o=i?i.getTopsideControl():null,n=i?i.getBottomsideControl():null,s=t._options.isChat||t._options.restrictedActions.isHiddenChangeAddressee||t._options.isOpenByCall,a=[];t._options.messageRecievers=e;for(var r=0;r<e.length;r++)a.push(e[r].personID);if(n)if(s)n.setReceivers(a);else t.consume("changeReceivers",{receivers:a});if(t._options.isOpenByCall&&o)o.setMembers(a)}},_onRightAreaShow:function(e,t){a.sendCommand(this,"reactOnShowFileSlider",t)},_getDialogId:function(){return this._options.themeGUID},getCurrentDialogID:function(){return this._options.themeGUID},getCurrentSearch:function(){var e=this._getBaseControl().getViewControl().getFilter();return e?e["Поиск"]:""},_onContextFieldChanged:function(e,t,i){if(t===this._options.widthBindedContext&&this._options.canChangeSelfWidth){this.getContainer().css({width:i});var o=this._getBaseControl(),n=o?o.getViewControl():null;if(n)n.getContainer().css("width",i)}},_getFixedWidth:function(){return this.getLinkedContext().getValue(this._options.widthBindedContext)},_setDocumentDetails:function(e){if(this._documentDetails=e._documentDetails,e._documentDetails&&e._documentDetails["Документ"])e.setVisibleElementMenu("cmdMakeChat",false,false,"")},_sendInvite:function(){var e=this,t=e._getBaseControl().getBottomsideControl(),i=new I({adapter:"adapter.sbis"});i.addField({name:"Тема",type:"uuid",defaultValue:null}),i.set("Тема",e._options.themeGUID);var o={"ТипПриглашения":e._options.inviteType,"Получатель":e._options.invitePerson,"Текст":c.getStringWithCrc32Pref(t.getText()),"СлужебныйОбъект":null,"Файлы":t.getFilesArray(),"Документ":e._options.docGUID||null,"Опции":i};new f({endpoint:"ПриглашениеКонтакта"}).call("Отправить",o).addCallbacks(function(){if(c.showPopupNotification({caption:rk("Приглашение отправлено"),tag:"sendMessageSuccess"}),t.clearContentForSend(),e._notify("onSuccessSend",o),e.panelFloatArea)e.panelFloatArea._notify("onSuccessSend",o);e.closePanel()},function(e){c.defaultErrorForSend(e)})},_onAccept:function(){var e=this,t=e._getBaseControl().getBottomsideControl(),i=t.getFilesArray();e.getChildControlByName("acceptButton").setEnabled(false),new f({endpoint:"ПриглашениеКонтакта"}).call("Принять",{"Тема":e._options.themeGUID,"Текст":c.getStringWithCrc32Pref(t.getText()),"Файлы":i}).addCallbacks(function(){if("invite_to_my_circle"===e._options.inviteType)c.showPopupNotification({caption:rk("Приглашение принято"),tag:"sendMessageSuccess"});else c.showCompanyAcceptMessage();var t={"ТипПриглашения":e._options.inviteType,"Получатель":e._options.invitePerson,"Текст":c.getStringWithCrc32Pref("Приглашение принято"),"СлужебныйОбъект":{},"Файлы":i,"Документ":e._options.docGUID||null,"Опции":null};if(e._notify("onSuccessSend",t),e.panelFloatArea)e.panelFloatArea._notify("onSuccessSend",t);e.closePanel()},function(e){c.defaultErrorForSend(e)})},_onDecline:function(){var e=this,t=e._getBaseControl().getBottomsideControl(),i=t.getFilesArray();e.getChildControlByName("declineButton").setEnabled(false),new f({endpoint:"ПриглашениеКонтакта"}).call("Отклонить",{"Тема":e._options.themeGUID,"Текст":c.getStringWithCrc32Pref(t.getText()),"Файлы":i}).addCallbacks(function(){c.showPopupNotification({caption:rk("Приглашение отклонено"),tag:"sendMessageSuccess"});var t={"ТипПриглашения":e._options.inviteType,"Получатель":e._options.invitePerson,"Текст":c.getStringWithCrc32Pref("Приглашение отклонено"),"СлужебныйОбъект":{},"Файлы":i,"Документ":e._options.docGUID||null,"Опции":null};if(e._notify("onSuccessSend",t),e.panelFloatArea)e.panelFloatArea._notify("onSuccessSend",t);e.closePanel()},function(e){c.defaultErrorForSend(e)})},_onResend:function(){this.getChildControlByName("resendButton").setEnabled(false),this._sendInvite()},_prepareForInvitation:function(i){if("invitation"!==this._options.dialogType)return;var o=this,n=o._getBaseControl(),s=n?n.getTopsideControl():null,a=n?n.getBottomsideControl():null,r=o._options.invitePersonRecord,l="invite_to_my_circle"===o._options.inviteType,d=parseInt(w.get("ИдентификаторКлиента"),10),h=d===parseInt(r.get("Клиент"),10),u=o.getContainer(),g=true,_=e.isMobilePlatform||e.isMobileAndroid||e.isMobileIOS||e.isMacOSMobile||e.isMobileSafari,p=u.find(".invitation-HeaderInvitation-title");if(i=i||3==o._options.inviteStatus,s)if(i)s.showCommandsButton(),s.setSearchButtonVisible(true);else s.setSearchButtonVisible(false);if(o._options.invitePerson=r.get("Персона"),s&&!i)s.getContainer().removeClass("contacts-invitation").addClass("contacts-invitation"),s.hideAllButtons();if(l){o._options.restrictedActions.isHiddenVideoMessage=!i;var m=o.hasChildControlByName("WhomFieldReSend")&&o.getChildControlByName("WhomFieldReSend"),C=u.find(".invitation-HeaderInvitation-person-photo"),v=u.find(".invitation-HeaderInvitation-person-info"),b=u.find(".invitation-HeaderInvitation-person-name"),I=u.find(".invitation-HeaderInvitation-person-position"),y=u.find(".invitation-HeaderInvitation-person-place");if(o._options.restrictedActions.isHiddenChangeAddressee=true,m)if(!o._options.isNew){var B=s&&s.getChildControlByName("DialogHeaderMembers");if(!o._options.isOutComeInvite){if(c.isInMySbis())m.setVisible(false);else m.setOnlyCurrentClient(true),m.setVisible(true),m.setEnabled(true),o._options.restrictedActions.isHiddenChangeAddressee=false;a.setEnabled(true),o._options.needShowHeaderMembers=true,B._options.rightPadding=260}else if(o._options.dialogMembersCount>1)m.setOnlyDialogMembers(true),m.setVisible(true),m.setEnabled(true),a.setEnabled(true),o._options.needShowHeaderMembers=true,o._options.restrictedActions.isHiddenChangeAddressee=false,B._options.rightPadding=260;else m.setVisible(false)}else m.setVisible(false);if(C)C.html(S({item:r,photoURL:c.getCachedPhotoUrl(r.has("Фото")?r.get("Фото"):r.get("ФотоМини"),62,d),srcSetPhotoURL:c.getCachedPhotoUrl(r.has("Фото")?r.get("Фото"):r.get("ФотоМини"),124,d),size:62,className:"invitation-HeaderInvitation_personPhoto",activity:r.get("ActivityData"),miniCardAttributes:{oid:o._options.invitePerson,template:"js!SBIS3.PersonalOffice.MiniCard",mode:_?"click":"hoverClick"}})),(new T).getActivityData([r.get("Персона")]),C.removeClass("ws-hidden");if(p.html(rk("Приглашение в круг контактов")),v.removeClass("ws-hidden"),b.html(t(r.get("Фамилия")+" "+r.get("Имя"))),b.removeClass("ws-hidden"),!o._options.isOutComeInvite||o._options.dialogMembersCount>1){var F=r.get("Персона");if(F)b[0].dataset.personguid=F,b[0].dataset.clickable=true,b.addClass("contacts-isClickable")}if(c.isCurrentClient(r.get("Клиент")))I.html(t(r.get("Должность")||"")),I.removeClass("ws-hidden");if(y.replaceWith(D({item:r,employmentName:t((h?r.get("Отдел"):r.get("КлиентНазвание"))||""),isDepartment:h,className:"invitation-HeaderInvitation-person-place",miniCardAttributes:_?null:{oid:h?r.get("Раздел"):-r.get("КлиентИдентификаторСПП"),template:h?"js!SBIS3.Staff.DepartmentMiniCard":"js!SBIS3.Contragents.ContragentMiniCard",mode:"hoverClick"}})),y.removeClass("ws-hidden"),o._options.isNew)if(a)o.subscribeOnceTo(a,"onAfterShow",function(){o.consume("setMsgText",{text:rk("Здравствуйте! Я хочу внести вас в свой список контактов.")})})}else{if(!o.companyRendered){if(a)if(a.isVisible())setTimeout(function(){if(a.setEnabledWhomIcon(false),o._options.readOnly)a.setEnabled(false)},500);else o.subscribeOnceTo(a,"onAfterShow",function(){if(a.setEnabledWhomIcon(false),o._options.readOnly)a.setEnabled(false)});u.addClass("contacts-invitation-company");var A=o._options.inviteObject["org_name"]||"",M=u.find(".invitation-HeaderInvitation-company-info"),R=u.find(".invitation-HeaderInvitation-company-name"),k=o._options.inviteObject["client_id"],V=d===parseInt(k||0,10),L=o._options.inviteObject["invited_user"],H=u.find(".invitation-HeaderInvitation-company-image");if(M.removeClass("ws-hidden"),R.html(t(A)),R.removeClass("ws-hidden"),H.html('<img src="resources/Contacts.Base/Header/images/Icon_Company.v1516270649826335cf4508dd597be4bfc9caa3e08b901.png"/>'),H.removeClass("ws-hidden"),!V)g=false;if(k&&L)new f({endpoint:"AccountInvite"}).call("GetAccountInfo",{client_id:k,invited_user:L}).addCallbacks(function(e){var i=e.getRow();if(i){var o=i.get("org_name"),n=i.get("photo_url");if(o)R.html(t(o));if(n)H.html('<img src="/previewer/'+n+'"/>')}},function(e){c.defaultErrorForSend(e,true)});o.companyRendered=true}p.html(rk("Приглашение на подключение в аккаунт"))}p.removeClass("ws-hidden");var P=o.getChildControlByName("acceptButton"),U=o.getChildControlByName("declineButton"),O=o.getChildControlByName("resendButton");if(P.setVisible(false),U.setVisible(false),O.setVisible(false),!o._options.readOnly){if(1==o._options.inviteStatus&&!o._options.isOutComeInvite)P.setCaption(rk("Принять")),P.setVisible(true),U.setCaption(rk("Отклонить")),U.setVisible(true);else if(4==o._options.inviteStatus){if(o._options.isOutComeInvite&&g)O.setCaption(rk("Отправить повторно")),O.setVisible(true);else if(l)P.setCaption(rk("Принять")),P.setVisible(true)}else if(l&&5==o._options.inviteStatus)O.setCaption(rk("Отправить повторно")),O.setVisible(true);o.unsubscribeFrom(P,"onActivated"),o.unsubscribeFrom(U,"onActivated"),o.unsubscribeFrom(O,"onActivated"),o.subscribeTo(P,"onActivated",o._onAccept.bind(o)),o.subscribeTo(U,"onActivated",o._onDecline.bind(o)),o.subscribeTo(O,"onActivated",o._onResend.bind(o))}o._sendViewReady=true},_loadData:function(){var e=this,t=e._getBaseControl(),o=t?t.getViewControl():null,s=t?t.getRightsideOpenerControl():null,a=t?t.getBottomsideControl():null,r=t?t.getTopsideControl():null,l=e._options.isChat||e._options.restrictedActions.isHiddenChangeAddressee||e._options.dialogType&&-1!==e._options.dialogType.indexOf("private");if(e._createSubscriptions.bind(e)(),e._sendViewReady=true,e._options.canChangeSelfWidth)e.getContainer().css({width:e._getFixedWidth()});if(!e._options.isNew&&e._options.themeGUID){if(t){if(s&&!e._options.restrictedActions.isHiddenFileSlider)e._subscribeToRightAreaEvents();if(e._options.themeGUID){if(o){if(e._options.canChangeSelfWidth)o.getContainer().css("width",e._getFixedWidth());e.once("onContentVisualized",e.onDrawItemsDialogView.bind(e))}if(r&&"invitation"!==e._options.dialogType)r.showCommandsButton()}}e._sendViewReady=false;var d=function(t){setTimeout(function(){if(e&&e.isDestroyed&&!e.isDestroyed()&&!e._sendViewReady&&!l){if(e.panelFloatArea&&e.panelFloatArea.isShow())i.setMessage(""),i.show();d(100)}else if(a&&a.isDestroyed&&!a.isDestroyed())if(i.hide(),"lock-private"!==e._options.dialogType)if(a.setEnabled(true),"invitation"===e._options.dialogType&&"invite_to_my_circle"!==e._options.inviteType)if(a.setEnabledWhomIcon(false),e._options.readOnly)a.setEnabled(false)},t)};if(!l)d(2e3);else if(a&&a.isDestroyed&&!a.isDestroyed()&&"lock-private"!==e._options.dialogType)a.setEnabled(true);e._loadThemeData(r,a,true)}else{if(r)if(r.hideAllButtons(),r._options.isNew=true,r._options.dialogType=e._options.dialogType,e._options.docGUID)e._getBLDocumentInformationByGUID().addCallback(function(t){if(t)r._documentDetails=r.getDocumentDetails(t),e._setDocumentDetails(r),r.setDocumentDetailsToRender(),e._setDocumentSendMessage(),e.onDrawItemsDialogView(null,null)});else e.onDrawItemsDialogView(null,null);if(e._options.isNew=true,e._options.messageRecievers&&a){for(var c=[],f=0;f<e._options.messageRecievers.length;f++){var h=e._options.messageRecievers[f].personID;if(h)c.push(h);else n.resolve("ILogger").error("Передан массив получателей, без идентификатора персоны. "+"С версии 3.17.20 автоматическое определение песоны по связке Клиент-Лицо не работает. "+"Пожалуйста, укажите идентификатор персоны.")}if(!c.length)if(e._sendViewReady=true,i.hide(),a&&"lock-private"!==e._options.dialogType)a.setEnabled(true);if(l){if(i.hide(),a.setReceivers(c),"lock-private"!==e._options.dialogType)a.setEnabled(true);if(r)r.setMembers(c)}else{if(c.length)e.consume("changeReceivers",{receivers:c});if(e._options.messageText)if(e.consume("setMsgText",{text:e._options.messageText}),e._options.messageText=void 0,e._options.focusOnSuggest&&a)setTimeout(function(){a.moveFocusToWhomField()},100),e._options.focusOnSuggest=false}}if("invitation"===e._options.dialogType)e._prepareForInvitation()}if(e._options.isChat&&e._options.themeGUID)e._options.isExistTheme=true},_addRedactionToList:function(e){var i=this,o=e.getCount(),n=new Date,s=n.getYear(),a=n.getTime(),r=function(e){return s===e.getYear()||a-e.getTime()<7776e6},l=function(e,t){return!(e.get("СлужебныйТип")[0]===t.get("СлужебныйТип")[0]&&e.get("КонтактПерсона")&&t.get("КонтактПерсона")&&e.get("КонтактПерсона")[0]===t.get("КонтактПерсона")[0])};if(o&&i._docRedactionList&&i._docRedactionList.length){var d=e.at(0),c=d.get("ДатаВремя")[0],f=e.at(o-1).get("ДатаВремя")[0],h=e.getAdapter(),u=d.getFormat(),g=[],_=[],p=this._getBaseControl().getViewControl().getDialogController(),m=e.getMetaData().more,C=false,b=null,S,D,T,w;if(!i._minDate)i._minDate=c;for(S=0;S<i._docRedactionList.length;S++)if(D=i._docRedactionList[S],D.date<i._minDate&&D.date>f||!m&&D.date<=f||!i._maxDate&&D.date>=c)g.push(D),_.push(S);for(S=0;S<_.length;S++)i._docRedactionList.splice(_[S]-S,1);if(!i._alreadyAddRedactions)i._alreadyAddRedactions=true,C=true;while(g.length){if(D=g.pop(),o=e.getCount(),T=new v({adapter:h,format:p.fillDefaultFormat(u),idProperty:"Сообщение"}),T.set("Сообщение",D.redactionId),T.set("Текст",['<a target="_blank" class="contacts-doc-redaction" href="'+D.openUrl+'">'+rk("Новая редакция документа от")+" "+t(D.name)+"</a>",null]),T.set("ТетАТет",true),T.set("ФайлыДляПревью",null),T.set("ДатаДляОтображения",[D.date.strftime(r(D.date)?"%e %b":"%e %b %Y").toLowerCase().replace(".",""),null]),T.set("Я",[false,null]),T.set("ДатаВремя",[D.date,null]),T.set("Курсор",{field:"ДатаВремя",value:D.date,timestamp:D.date}),T.set("ТипСписка","theme"),T.set("Входящее",[true,null]),T.set("ПрочитаноВладельцем",[true,null]),T.set("ПрочитаноПолучателем",[true,null]),T.set("СлужебныйТип",["document-redaction",null]),T.set("КонтактПерсона",[D.person,null]),D.date>c){if(o)e.add(T,0),c=D.date}else if(D.date<f){if(o){var I=e.at(o-1);if(l(T,I))e.add(T,o)}else e.add(T,o);f=D.date}else{for(w=-1,S=0;S<o;S++)if(D.date<e.at(S).get("ДатаВремя")[0]&&(S===o-1||D.date>e.at(S+1).get("ДатаВремя")[0])){w=S+1;break}if(w>0)if(I=e.at(w-1),l(T,I))e.add(T,w)}if(C&&!b)b=T}if(f<i._minDate)i._minDate=f;if(!i._maxDate||c>i._maxDate)i._maxDate=c;if(b)i._recordForScroll=b}},_onDataMergeHandler:function(e,t){if(this._docRedactionList&&this._docRedactionList.length)this._addRedactionToList(t)},_onDataLoadHandler:function(e,t){if(this._docRedactionListLoadDef){var i=this;i._docRedactionListLoadDef.addBoth(function(){if(i._docRedactionList&&i._docRedactionList.length)i._addRedactionToList(t);if(i._recordForScroll){var e=i._getBaseControl();(e?e.getViewControl():null).scrollToItem(i._recordForScroll),i._recordForScroll=null}})}},_loadThemeData:function(e,t,o){var a=this,r=a._getBLDialogInformation(),l=a._getBaseControl(),d=l?l.getViewControl():null;function h(){if(a._docRedactionListLoadDef&&!a._docRedactionListLoadDef.isSuccessful())a._docRedactionList=[],a._docRedactionListLoadDef.callback()}r.addCallbacks(function(l){if(a.isDestroyed())return;var u=l.get("Участники"),g=[],_=[],p=l.get("УчастникиПодробно"),v=[],b=l.get("Сообщение"),S=l.get("Тип");if("invite"===S)S="invitation",a._options.dialogType=S;var D=l.get("СовпадаютУчастникиИАдресаты"),T="private"===S,I="lock-private"===S,y=l.get("Приглашение"),B="invitation"===S,F=y&&3==y.get("Статус"),A=y&&y.get("ТипПриглашения"),M=B&&"invite_to_my_circle"===A,R=y&&y.has("ПерсонаОтправитель")&&y.get("ПерсонаОтправитель"),k=y&&y.has("ПерсонаПолучатель")&&y.get("ПерсонаПолучатель"),V=w.get("ИдентификаторСервисаПрофилей"),L=l.get("Доступность"),H=l.get("ОтредактированныеФайлы"),P=l.get("АдресатПодробно"),U=l.get("ЯВСообщении"),O=l.get("МежсхемнаяПереписка"),N=l.get("КоличествоФайлов"),E=[],x;if(!S)return a._sendViewReady=true,i.hide(),void c.alert("Не найдена информация по запрошенному диалогу!",a).addCallback(function(){a.closePanel()});if(M&&R!==V&&k!==V){if(M=false,B=false,a._options.dialogType="dialog",S="dialog",F=true,a._options.restrictedActions.isHiddenVideoMessage=false,a._options.restrictedActions.isHiddenCreateTask=true,a._options.restrictedActions.isHiddenLinkDocument=true,a._options.restrictedActions.isHiddenConvertToChat=true,a._options.restrictedActions.isHiddenLinkTheme=true,e)e.showCommandsButton(),e.setSearchButtonVisible(true),e.getContainer().removeClass("contacts-invitation");var G=a.hasChildControlByName("WhomFieldReSend")&&a.getChildControlByName("WhomFieldReSend");if(G)G.setOnlyDialogMembers(true)}switch(a._options.needShowHeaderMembers=!M,a._options.dialogMembersCount=l.get("КоличествоУчастников"),L){case"unavailable":if(I=true,!a._options.isOpenByCall&&!B)a.hide(),c.alert(rk("Диалог недоступен."),a).addCallback(function(){a.closePanel()});break;case"archive":a._options.isDeleteForever=true,a._options.restrictedActions.isHiddenMoveToFolder=true;break;case"others":a._options.restrictedActions.isHiddenDeleteDialog=true,a._options.restrictedActions.isHiddenMoveToFolder=true}if(a._options.dialogType!==S)if(a._options.inWindow){if("chat"===S)a._onThemeTransformToChatInWindow()}else return void a._notify("reloadView",S,a,a._options);if(t&&o&&H&&H.getCount())t.addNewFile(H);if(a._options.restrictedActions.isHiddenLinkTheme="dialog"!==S&&!F||a._options.restrictedActions.isHiddenLinkTheme,I||T||B&&!F)a._options.restrictedActions.isHiddenCreateTask=true,a._options.restrictedActions.isHiddenLinkDocument=true,a._options.restrictedActions.isHiddenMoveToFolder=true,a._options.restrictedActions.isHiddenDeleteDialog=true,a._options.restrictedActions.isHiddenChangeAddressee=true,a._options.restrictedActions.isHiddenConvertToChat=true,a._options.restrictedActions.isHiddenLinkTheme=true;if(B){var W=y?y.get("СлужебныйОбъект"):{};try{a._options.inviteObject="string"==typeof W?JSON.parse(W):W}catch(e){a._options.inviteObject={}}if(a._options.inviteType=A,a._options.isOutComeInvite=y.has("Входящее")&&!y.get("Входящее"),!a._options.invitePersonRecord){var j=a._options.isOutComeInvite?k:R;if(j)a._options.invitePersonRecord=p.getRecordById(j);if(!a._options.invitePersonRecord)a._options.invitePersonRecord=P.at(0)}a._options.inviteStatus=y.get("Статус"),a._prepareForInvitation(F)}if(a._folderGUID=l.get("Папка"),a._nameFolder=l.get("ПапкаНазвание"),!a._options.isOpenByCall)p.each(function(e){if(x=e.get("Персона"),E.push(e.get("Фамилия")+" "+e.get("Имя")),x)g.push(x),v.push(e)});if(v.length)m.addPersonsToCache(p);if(!a._options.isOpenByCall)u.each(function(e){if(x=e.get("Персона"),x)g.push(x)});var z=function(e){if(x=e.get("Персона"),x)_.push(x)};if(!a._options.isOpenByCall)P.each(z);if(_.length)m.addPersonsToCache(P);if(!a._options.isOpenByCall)l.get("Адресат").each(z);var $=a._options.isChat||a._options.restrictedActions.isHiddenChangeAddressee;if((!_.length&&!g.length||$)&&a._options.messageRecievers.length)for(var Y=0;Y<a._options.messageRecievers.length;Y++){var q=a._options.messageRecievers[Y].personID;if(-1===g.indexOf(q))g.push(q);if(-1===_.indexOf(q))_.push(q)}if(!_.length||D)if(a._sendViewReady=true,i.hide(),t&&"lock-private"!==a._options.dialogType)t.setEnabled(true);if(localStorage&&localStorage.getItem){var J="dialog"+a._options.themeGUID,Q=localStorage.getItem(J);if(Q)D=false,_=JSON.parse(Q),localStorage.removeItem(J)}if(!a._options.restrictedActions.isHiddenFileSlider)a._showBtnFileViewerSlider(O?void 0:N);if(t&&!t.getLinkedContext().getValue("isStateTriggered")&&($||!D||1===_.length)){if(o||U)if(a.adrArr=_,$){if(t)t.setReceivers(g),i.hide()}else a.consume("changeReceivers",{receivers:_})}else if($&&t)if(t.setReceivers([]),a._sendViewReady=true,i.hide(),"lock-private"!==a._options.dialogType)t.setEnabled(true);if(e){if(e._documentDetails=e.getDocumentDetails(l),a._setDocumentDetails(e),e._documentDetails&&e._documentDetails["Документ"]){if(a._options.restrictedActions.isHiddenConvertToChat=true,o)a._options.docGUID=e._documentDetails["Документ"],a._docRedactionListLoadDef=new s,a.subscribeTo(d,"onDataMerge",a._onDataMergeHandler.bind(a)),a.subscribeTo(d,"onDataLoad",a._onDataLoadHandler.bind(a));if(a._options.inWindow&&document&&e._documentDetails["ДокументКрасивоеНазвание"])a._savedTitle=rk("Просмотр диалога по документу")+" "+e._documentDetails["ДокументКрасивоеНазвание"],document.title=a._savedTitle;var K=e._documentDetails["ДокументИконка"]&&-1!==e._documentDetails["ДокументИконка"].indexOf("Folder");if(o&&!K&&2==e._documentDetails["ДокументОбъектТипа"]&&e._documentDetails["ДокументФайлИд"]){var X=(new C).where({attachId:e._documentDetails["ДокументФайлИд"]});new f({endpoint:{address:"/disk/api/v1/service/",contract:"FileSD"},binding:{query:"RedactionsList"}}).query(X).addCallbacks(function(e){var t=e.getAll();if(a._docRedactionList=[],t.each(function(e){a._docRedactionList.push({person:e.get("responsibleProfileId"),redactionId:e.get("redactionId"),name:e.get("responsibleName"),date:e.get("lastChange"),openUrl:e.get("openUrl")})}),a._docRedactionList.length>1)a._docRedactionList.reverse();else a._docRedactionList=[];var i=d.getItems();if(i){i.eventsObserving(false);try{a._addRedactionToList(i)}catch(e){n.resolve("ILogger").error(e)}i.eventsObserving(true)}if(!a._docRedactionListLoadDef.isSuccessful())a._docRedactionListLoadDef.callback()},function(){h()})}else h()}else{if(a._options.inWindow&&document&&E.length)a._savedTitle=rk("Просмотр диалога c")+" "+E.join(","),document.title=a._savedTitle;h()}if(a._options.inWindow&&document&&!o)a._setUnreadToTab(l.get("КоличествоНепрочитанных"));if(e._options=a._options,e._options.dialogType=a._options.dialogType,b)e._options.messageGUID=b;if(e.setDocumentDetailsToRender(),a._setDocumentSendMessage(),a._nameFolder)e.setNameFolder(a._nameFolder);e.showBtnDelDialog(),e.showHideButtonsFromOptions()}if(a._options.needShowHeaderMembers){var Z=a._options.invitePersonRecord&&a._options.invitePersonRecord.getId();if(Z){var ee=g.indexOf(Z);if(ee>-1)g.splice(ee,1);for(ee=-1,Y=0;Y<v.length;Y++)if(v[Y].getId()===Z){ee=Y;break}if(ee>-1)v.splice(ee,1)}if(v.length||g.length)a._setMembersInHeader(g,v,a._options.dialogMembersCount)}if(o)if(a._runUnreadMessagesDialogHistory(),b)if(d&&a._options.scrollToMessage)d.scrollToMessage(b);r=void 0},function(e){if(a._sendViewReady=true,c.defaultErrorForSend(e,true),t&&t.isDestroyed&&!t.isDestroyed())if(i.hide(),"lock-private"!==a._options.dialogType)t.setEnabled(true)})},reloadDialog:function(e,t,i){var o=this,n=o._getBaseControl();if(e&&n){this._options.themeGUID=e,this._options.messagGUID=t;var s=n.getTopsideControl(),a=n.getViewControl(),r=n.getBottomsideControl(),l=n.getRightsideControl(),d=n.getRightsideOpenerControl();if(d)if(d.setThemeGUID(e),l)l.setThemeGUID(e);else if(!o._options.restrictedActions.isHiddenFileSlider)o._subscribeToRightAreaEvents();if(a)a.reloadDialog(e,null,i,{beginMessage:t}).addCallback(function(){if(o._runUnreadMessagesDialogHistory(),t)a.scrollToMessage(t)});if(r)r.setDialog(e);this._loadThemeData(s,r,true)}},_createSubscriptions:function(){var e=this._getBaseControl(),t=e?e.getBottomsideControl():null,i=e?e.getTopsideControl():null,o=e?e.getViewControl():null;if(this.subscribeTo(this,"onDestroy",function(){if(this._baseControl=null,this._titleAlertInterval)clearInterval(this._titleAlertInterval)}.bind(this)),this.subscribeTo(d,"onMoveTheme",this.onNotifyMoveTheme.bind(this)),this.subscribeTo(d,"onDeleteTheme",this.onNotifyDeleteTheme.bind(this)),this.subscribeTo(d,"onThemeTransform",this.onNotifyThemeTransform.bind(this)),t)this.subscribeTo(t,"onAfterSend",this.onAfterSendMessage.bind(this)),this.subscribeTo(t,"onTaskAppended",this.onTaskAppendedSendMessage.bind(this)),this.subscribeTo(t,"onRefreshLatestThemes",this.onRefreshLatestThemes.bind(this)),this.subscribeTo(t,"onChangeAddressees",this.onChangeAddresseesSendMessage.bind(this)),this.subscribeTo(t,"onButtonClick",this.onButtonClickSendMessage.bind(this));if(i)this.subscribeTo(i,"onConvertToChat",this.onConvertToChat.bind(this));if(o){this.subscribeTo(o,"onNewMessage",this.onNewMessage.bind(this));var n=this;this.subscribeTo(o,"onDeleteAllMessages",function(){if(n.panelFloatArea)n.closePanel();else{var e=n._getBaseControl(),t=e?e.getTopsideControl():null,i=e?e.getBottomsideControl():null;n._loadThemeData(t,i,false)}})}},_runUnreadMessagesDialogHistory:function(){var e=this._getBaseControl(),t=e?e.getViewControl():null;if(!t)return;if(this.isVisibleWithParents())t.runUnreadMessages();else this.once("onResize",function(){t.runUnreadMessagesToCall.call(t)})},onChangeAddresseesSendMessage:function(e,t,o,n){var a=this,r=a._getBaseControl(),l=r?r.getBottomsideControl():null,d=r?r.getTopsideControl():null;if(a._options.isNew&&d){if(null===t)d.setMembers([]);else if(n.length)d.removeMembers(n);else if(o.length)d.addMembers(o)}else a._sendViewReady=true,i.hide();if(l&&"lock-private"!==a._options.dialogType&&!l.isEnabled())l.setEnabled(true);if((!n||!n.length)&&!a._options.isChat&&l&&"dialog"==a._options.dialogType){var f=l.getReceivers(),h=false;if(f&&f.length)if(a.adrArr&&a.adrArr.length){for(var u=0;u<f.length;u++)if(-1===a.adrArr.indexOf(f[u])){h=true;break}}else h=true;if(h){var g=a.consume("checkReceiversLimits",f)[0];if(g.executed&&g.result instanceof s)g.result.addCallbacks(function(e){if(false===e){if(a.consume("changeReceivers",{receivers:a.adrArr||[]}),a._options.isNew)l.moveFocusToWhomField()}else if(true===e)l.moveFocusToWhomField();else if(void 0===e)d.makeChat()},function(e){c.defaultErrorForSend(e,true)})}}},onButtonClickSendMessage:function(e,t){var i=this,o=i._getBaseControl(),n=o?o.getBottomsideControl():null,a=o?o.getTopsideControl():null;if(n._options.clearAfterSend=i._options.isChat||i._options.inWindow||!i.canCloseAfterSend(),!i._options.isChat&&n&&"dosend"==t)if("dialog"===i._options.dialogType){e.setResult(false);var r=i.consume("checkReceiversLimits",n.getReceivers())[0];if(r.executed&&r.result instanceof s)r.result.addCallbacks(function(e){if(false===e)i.consume("changeReceivers",{receivers:i.adrArr||[]});else if(true===e)n.moveFocusToWhomField();else if(void 0===e)a.makeChat();else if(null===e){var t=n.sendMessageWithCheckParams();if(i._options.isNew&&!i.canCloseAfterSend())t.addCallback(function(e){if(false!==e)i._options.isNew=false,i._notify("reloadView",i._options.dialogType,i,i._options)});t.addErrback(c.defaultErrorForSend)}},function(e){c.defaultErrorForSend(e,true)});else n.sendMessageWithCheckParams()}else if("invitation"===i._options.dialogType&&i._options.isNew)e.setResult(false),i._sendInvite()},onTaskAppendedSendMessage:function(e,t){var i={},o;if(this._options.inWindow||!this.canCloseAfterSend())if(this._options.isNew)this.closePanel(true);else this.onNewMessage(null,null,true);else if(this.panelFloatArea){if(t&&"function"===typeof t.get){o={"ДокументПк":"@Документ","Документ":"Идентификатор","Название":"КрасивоеНазвание","Тип":"ТипИД"};for(var n in o)if(o.hasOwnProperty(n))i[n]=t.get(o[n]);this._notify("onSuccessCreateTask",i)}this.closePanel()}},onRefreshLatestThemes:function(e,t){this._notify("reloadView",t.dialogType,this,t)},onConvertToChat:function(e,t){if(i.hide(),t)d.doAndNotify("onThemeTransform",{is_local:true,theme:t.get("Тема"),type:"chat",user:t.get("Автор")})},onNewMessage:function(e,t,i){var o=this._getBaseControl(),n=o?o.getTopsideControl():null,s=o?o.getBottomsideControl():null;if(this._options.messageGUID=null,!i)this._runUnreadMessagesDialogHistory();this._loadThemeData(n,s,false)},canCloseAfterSend:function(){var e=o.global.getValue("dialogSettings");if(e)return e.closeAfterSend;else return true},closePanel:function(e){if(!this._options.isChat&&this.panelFloatArea)if(e||this.canCloseAfterSend()||"invitation"===this._options.dialogType)this.getLinkedContext().setValue("ClosingInProgress",true),this.panelFloatArea.close();else this._getBaseControl().getBottomsideControl().clearContentForSend()},onAfterSendMessage:function(t,i,n,s,a,r,l){var d={"Документ":this._options.docGUID,"Адресаты":s,"Пользователь":o.global.getValue("myuserid"),"ПользовательПерсона":w.get("ИдентификаторСервисаПрофилей"),"Тема":i,"Сообщение":n,"СообщениеДатаВремя":r,"СообщениеТекст":l,"Файлы":a},c=this.canCloseAfterSend(),f=this._getBaseControl(),h=f?f.getBottomsideControl():null;if(this._options.messageGUID=n,this._options.inWindow||!c){h&&h.clearContentForSend();var u=[],g;if(s.each(function(e){if(g=e.get("Персона"),g)u.push(g)}),u.length)if(this.consume("changeReceivers",{receivers:u}),h)if(e.isMobilePlatform||e.isMobileAndroid||e.isMobileIOS||e.isMacOSMobile||e.isMobileSafari)h.moveFocusToBtnAttach();else h.moveFocusToEditor()}if(this._notify("onSuccessSend",d),this.panelFloatArea)this.panelFloatArea._notify("onSuccessSend",d);if(!this._options.isChat&&this.panelFloatArea)this.getLinkedContext().setValue("messageSend",true),this.closePanel()},onAttachMsg:function(e,t){var i=this._getBaseControl(),o=i?i.getBottomsideControl():null;if(o&&t)o.loadNewFile(t)},getFilesList:function(){var e=this._getBaseControl(),t=e?e.getViewControl():null;if(t){var i=t.getItems();return c.getFilesFromMessagesList(i)}},_subscribeToRightAreaEvents:function(){var e=this._getBaseControl();this.subscribeOnceTo(e,"onRightAreaShow",function(){var t=e?e.getRightsideControl():null;if(t)this.subscribeTo(t,"onAttachMsg",this.onAttachMsg.bind(this)),this.subscribeTo(t,"onSliderHide",this._onHideFileSlider.bind(this))}.bind(this)),this.subscribeTo(e,"onRightAreaShow",this._onShowFileSlider.bind(this))},_onShowFileSlider:function(){var e=this._getBaseControl(),t=e?e.getRightsideControl():null;if(t)if(this.getCurrentSearch())t.showPanelWithSources([this],void 0);else if(t._options.themeGUID!==this._options.themeGUID)t.setThemeGUID(this._options.themeGUID),t._showPanel(true);this._resizeSendView(this._getFixedWidth()+this._options.widthFiles)},_onHideFileSlider:function(){this._resizeSendView(this._getFixedWidth())},_resizeSendView:function(e){if(this._options.canChangeSelfWidth)this.getContainer().width(e)},_setDocumentSendMessage:function(){var e=this._getBaseControl(),t=e?e.getBottomsideControl():null,i=this._documentDetails;if(!t||!i)return;t.setDocument(i["Документ"],i["ДокументОбъектТипа"],!this.isChat&&i["ДокументМожноПодписать"])},_showBtnFileViewerSlider:function(e){var t=this._getBaseControl(),i=t?t.getRightsideOpenerControl():null;if(!i||this._options.restrictedActions.isHiddenFileSlider)return;i.setThemeGUID(this._options.themeGUID,e)},onDrawItemsDialogView:function(t,i){var o=(i=i||this._getBaseControl())?i.getBottomsideControl():null;if(this._runUnreadMessagesDialogHistory(),o){if(this._options.isNew&&!this._options.messageRecievers.length){if(this._options.docGUID&&o.isAfterShowCalled())o.moveFocusToWhomField()}else if(!(e.isMobileIOS||e.isMobileAndroid))o.moveFocusToEditor();o.setVisible(true)}},_getBaseControl:function(){if(void 0===this._baseControl)this._baseControl=this.hasChildControlByName("SendViewDialogBase")?this.getChildControlByName("SendViewDialogBase"):null;return this._baseControl},getViewerContainer:function(){var e=this._getBaseControl();if(e)return e.getViewerContainer();else return null},_setMembersInHeader:function(e,t,i){var o=this._getBaseControl();if(o){var n=o.getTopsideControl();if(n)n.setMembers(e,t,i)}},_getBLDocumentInformationByGUID:function(){var e=n.resolve("ILogger"),t=new s,i;if(!this._options.docGUID)return i=rk("Плохие параметры")+" SenderViewerBP._getBLDocumentInformationByGUID",e.error(i),t.errback(i),t;var o="Документ",a="КрасивыеНазвания",r={"Документы":[this._options.docGUID]};return t=new f({endpoint:o}).call(a,r).addCallbacks(function(e){return e.getRow()},function(t){return e.error(rk("Произошла ошибка при запросе данных по документу из опций компонента")+"SendViewDialog"),c.defaultErrorForSend(t,true),t}),t},_getBLDialogInformation:function(){var e=this._options.themeGUID?this._options.themeGUID:null,t=this._options.messageGUID?this._options.messageGUID:null,o=n.resolve("ILogger"),a;if(!e){a=new s;var r=[["SendViewDialog: ",rk("Попытка вызова"),"_getBLDialogInformation",rk("без необходимых параметров"),"\n"].join(),"themeGUID: ",e,"\n","messageGUID: ",t].join("");return o.error(r),a.errback(r),a}var l="Персона",d="СИнформацияПоДиалогу2",h={"Тема":e,"Сообщение":t};return a=new f({endpoint:l,idProperty:"Сообщение"}).call(d,h).addCallbacks(function(e){return e.getRow()},function(e){return o.error(rk("Ошибка при получении"),rk("информации по диалогу"),[rk("Ошибка вызова метода"),": ",l,".",d,"\n",rk("Подробности"),": ",e.details].join("")),c.defaultErrorForSend(e,true),i.hide(),e}),a},checkSendMessageContent:function(){var e=this._getBaseControl(),t=e?e.getBottomsideControl():null;return t?t.checkIsContent():false},_onThemeTransformToChatInWindow:function(){var e=this,t=e._getBaseControl(),o=t?t.getBottomsideControl():null,n=function(){if(window&&window.location)window.location.href="/open_chat.html?guid="+e._options.themeGUID};i.setMessage(""),i.hide(),c.alert(rk("Диалог преобразован в чат."),e).addCallback(function(){o.moveFocusToBtnAttach();var e=o.checkIsContent();if(e)e.addBoth(function(){n()});else n()})},onNotifyThemeTransform:function(e,t){var o=this,n=o._getBaseControl(),s=n?n.getBottomsideControl():null,a=function(){i.setMessage(""),i.hide(),o._notify("reloadView",o._options.dialogType,o,o._options)};if(t&&t.theme&&t.type&&t.theme===o._options.themeGUID&&t.type!==o._options.dialogType)if(o._options.inWindow){if("chat"===t.type)o._onThemeTransformToChatInWindow()}else if(o._options.dialogType=t.type,o.panelFloatArea&&s)if(o.panelFloatArea.informationForRestore=s.getInformation(),o._options.isNew&&o.panelFloatArea.informationForRestore.receivers.length){i.setMessage(rk("Добавление участников чата")),i.show();var r=new f({endpoint:"Чат"});def=r.call("ИзменитьСписокУчастников",{"Чат":o._options.themeGUID,"ПерсонаАдресаты":o.panelFloatArea.informationForRestore.receivers,"Команда":"add"}).addCallbacks(function(){o.panelFloatArea.informationForRestore.receivers=[],a()},function(e){return c.defaultErrorForSend(e,true),e})}else a()},onNotifyDeleteTheme:function(e,t){if(!(t&&t.erased_themes))return;for(var i=this._options,o=t.erased_themes,n=0;n<o.length;n++)if(i.themeGUID==o[n]){if(this._options.inWindow||!this.canCloseAfterSend())this.onNewMessage(null,null,true);else this.closePanel();return}},onNotifyMoveTheme:function(e,t){if(!(t&&t.moved_themes&&t.hasOwnProperty("to_folder")))return;var i=this,o=i._options,s=this._getBaseControl(),a=s?s.getTopsideControl():null,r=t.moved_themes,l=t.to_folder,d=n.resolve("ILogger"),h=function(e,t){i._folderGUID=e,i._nameFolder=t,a.setNameFolder(t)};if(!a)return;for(var u=0;u<r.length;u++)if(o.themeGUID==r[u]&&i._folderGUID!=l){if(!l){h(null,rk("Корень"));break}new f({endpoint:"Персона"}).call("АТПапкаПрочитать",{"Папка":l}).addCallbacks(function(e){var t=e.getRow(),i=t?t.get("Название"):"";h(l,i)},function(e){d.error(rk("Ошибка при сохранении настроек папки"),[rk("Ошибка вызова метода"),": Персона.СписокСообщенийДляListView \n",rk("Подробности"),": ",e.details].join("")),c.defaultErrorForSend(e,true)});break}}}),y});
//# sourceMappingURL=Dialog.module.js.map
requirejs(["Core/core-init-min"],function(coreInit){coreInit.addCallback(function(){requirejs(["js!SBIS3.Contacts.DialogView","js!SBIS3.Contacts.SendViewDialog"],function(){});});});