define("Deprecated/Controls/FieldAbstract/FieldAbstract",["Core/helpers/Function/callNext","Deprecated/helpers/functional-helpers","Core/constants","Lib/Control/Control","Lib/Control/Infobox/Infobox","Core/detection","css!Deprecated/Controls/FieldAbstract/FieldAbstract"],function(t,e,i,n,s){"use strict";var l=50,a=n.DataBoundControl.extend({$protected:{_curval:"",_inputControl:null,_pasteProcessing:0,_changed:false,_editAtPlace:false,_editAtPlaceElement:null,_editAtPlaceElementInner:null,_editAtPlaceHasAuto:false,_wsField:null,_textAlign:null,_options:{width:"120px",margin:"",readOnly:false,maxLength:null,editAtPlaceTooltip:"",cssClass:"ws-field-abstract",focusOnActivatedOnMobiles:false}},$constructor:function(){this._bindInternals(),this._publish("onActivated"),this._initEvents(),this.subscribe("onChange",function(){this._changed=true})},getInputContainer:function(){return this._inputControl},_initEvents:function(){var t=this,e=this.getName(),i=this._getLinkedLabel();if("undefined"!==typeof t._inputControl){if(i)i.click(function(e){e.preventDefault(),t.setActive(true)});if(e)t._inputControl.attr("id","fld-"+e)}if(this._inputControl&&void 0!==this._inputControl)this._passthroughControlButtons(),this._inputControl.bind("keyup change blur",function(e){if(t._isChangeable()){if(!t._pasteProcessing)t._onValueChangeHandler(void 0,"keyup"===e.type,e.which);t._fireOnActivated(e)}})},_fireOnActivated:function(t){if(t&&t.keyCode==i.key.enter)this._notify("onActivated")},_initConfig:function(){},_bindInternals:function(){},_getDefaultValue:function(){if(""!==this._options.value&&typeof this._options.value in{string:0,function:0})return"function"===typeof this._options.value?this._options.value():this._options.value},_onContextValueReceived:function(t){if(void 0!==t)if(!e.compareValues(t,this._notFormatedVal())){if(this._setValueInternal(t),this.isMarked())this.validate();this._notifyOnValueChange(this._notFormatedVal())}},_passthroughControlButtons:function(){var t=this;this._inputControl.bind("keypress.readonly, change.readonly, keyup.readonly, keydown.readonly",function(e){if(!t._isChangeable()&&e.which!=i.key.tab&&e.which!=i.key.esc&&!e.ctrlKey)e.preventDefault(),e.stopImmediatePropagation()})},_isChangeable:function(){return!this._options.readOnly&&this._options.enabled},isReadOnly:function(){return this._options.readOnly},setReadOnly:function(t){if(this._options.readOnly=t,t)this._container.addClass("readonly"),this._inputControl.attr("readonly","readonly");else this._container.removeClass("readonly"),this._inputControl.removeAttr("readonly")},_onValueChangeHandler:function(t,e,i){this._curval=this._curValue();var n=this._notFormatedVal(void 0,e,i),l=this.getValue(),a;if(n&&n.equals)a=n.equals(l);else if(""===n||""===l)a=n===l;else a=n==l;if(!a)if(this._notifyOnChange(n),this.clearMark(),s.hasTarget()&&!s.isCurrentTarget(this._getExtendedTooltipTarget()))s.hide(0)},_notifyOnChange:function(t){this._updateSelfContextValue(t),this._notify("onChange",t),this._notifyOnValueChange(t)},_setEnabled:function(t){this._setDisableAttr(t),a.superclass._setEnabled.apply(this,arguments)},setEditAtPlace:function(t){this._editAtPlace=false!==t;var e=this.getStringValue();if(!this._editAtPlaceElement)this._initEditAtPlace();this._updateInPlaceValue(e),this.getContainer().toggleClass("ws-field-underline",this._editAtPlace),this._editAtPlaceElement.toggleClass("ws-hidden",!this._editAtPlace),this._wsField.toggleClass("ws-hidden",this._editAtPlace)},setEditAtPlaceTooltip:function(t){this._options.editAtPlaceTooltip=t;var e=this.getStringValue();if(!this._editAtPlaceElement)this._initEditAtPlace();this._updateInPlaceValue(e)},getEditAtPlaceTooltip:function(){return this._options.editAtPlaceTooltip},_handleInPlaceTooltip:function(t){if(!!t)this._editAtPlaceElement.attr("title",t);else if(!this._options.tooltip)this._editAtPlaceElement.attr("title","");else this._editAtPlaceElement.attr("title",this._options.tooltip)},_updateInPlaceValue:function(t){if(this._editAtPlace){if(this._handleInPlaceTooltip(t),this._options.editAtPlaceTooltip&&!t)t=this._options.editAtPlaceTooltip,this._editAtPlaceElement.addClass("editAtPlace-empty");else this._editAtPlaceElement.removeClass("editAtPlace-empty");if(i.browser.isIE8&&t&&t.length>l)t=t.substr(0,l-1)+"…";this._editAtPlaceHasAuto=!!t&&"right"!==this._textAlign,this.getContainer().toggleClass("ws-editAtPlace-empty",!t).toggleClass("ws-editAtPlace-autowidth",this._editAtPlaceHasAuto),this._editAtPlaceElementInner.text(t||" ")}},_setEditAtPlaceStyles:function(){this._editAtPlaceElementInner.css({lineHeight:parseFloat(this._container.innerHeight())-2+"px"})},_initEditAtPlace:function(){this._wsField=this.getContainer().find(".ws-field"),this._editAtPlaceElement=$('<span class="ws-editAtPlace ws-hidden"><span class="ws-editAtPlace-inner"></span></span>'),this._editAtPlaceElementInner=this._editAtPlaceElement.find(".ws-editAtPlace-inner"),this._setEditAtPlaceStyles(),this._wsField.after(this._editAtPlaceElement),this._textAlign=this.getContainer().css("textAlign");var e=this;this._handleInPlaceTooltip(this.getStringValue()),this.setTooltip=t.call(this.setTooltip,function(t){e._handleInPlaceTooltip(e.getStringValue())})},_setDisableAttr:function(t){if(false===t)this._inputControl.attr("disabled","disabled");else this._inputControl.removeAttr("disabled")},_notFormatedVal:function(){return this._curval},_extractKey:function(t){return t.which||t.charCode||t.keyCode},setValue:function(t,e,i){if(this._setValueInternal(t),this._updateSelfContextValue(this._notFormatedVal()),this._notifyOnValueChange(this.getValue()),true!==i)this.validate()},_setValueInternal:function(t){this._updateInPlaceValue(t),this._curval=t},_curValue:function(){return this._curval},destroy:function(){if(a.superclass.destroy.apply(this,arguments),this._inputControl)this._inputControl.empty().remove(),this._inputControl=$()},getStringValue:function(){return this._curValue()},setActive:function(t){if(!t&&this._changed)this.validate();a.superclass.setActive.apply(this,arguments)}});return a});
//# sourceMappingURL=FieldAbstract.js.map