define("js!SBIS3.Staff.StaffBrowser.RenderHelper",["js!SBIS3.Employee.Util","optional!js!SBIS3.EDO.Photo","html!SBIS3.Person.PersonPhoto/resources/photoTpl","html!SBIS3.PersonCore.Photo/photoTpl","optional!SBIS.VideoCall/Utils","optional!js!SBIS3.Activity.ActivityHelper","Core/IoC","Core/helpers/string-helpers","Core/core-instance","Core/core-merge","Core/core-functions","Transport/Record","Core/SessionStorage"],function(e,t,a,o,i,r,l,s,n,c,f,p,m){var h,u="Нет названия";function g(e,t){if(e&&!t)return 1;if(!e&&t)return 2;if(e&&t)return 3;return 0}function d(e,t){return t?"listEmpl-fio-"+String(e):"listEmpl-icon-"+String(e)}return DEPARTMENT_TYPE_SIMPLE=0,DEPARTMENT_TYPE_OFFICE=1,DEPARTMENT_TYPE_BRANCH=2,DEPARTMENT_TYPE_WORK_GROUP=3,h={prepareCfgEmployeeRender:function(l,n,c,f){if(!c)c={};if(c["ОтобразитьПодразделение"]=c["ОтобразитьПодразделение"]||false,c["ОтобразитьВСтроку"]=c["ОтобразитьВСтроку"]||false,c["БезФото"]=c["БезФото"]||false,c["ОтобразитьОпцииСтроки"]=c["ОтобразитьОпцииСтроки"]||false,c["ОтобразитьТелефон"]=c["ОтобразитьТелефон"]||false,c["ОтобразитьДолжность"]=c["ОтобразитьДолжность"]||true,c["ТекущаяЗадача"]=c["ТекущаяЗадача"]||"",c["PhotoClassName"]=c["PhotoClassName"]||c["PhotoCssClasses"]||"",void 0===c["EscapeHtml"])c["EscapeHtml"]=true;if(void 0===c["ShowMiniCard"])c["ShowMiniCard"]=true;if(n["Должность"]=e.coalesceFunc(n["Должность"],""),n["Подразделение"]=e.coalesceFunc(n["Подразделение"],""),n["ФИО"]=e.coalesceFunc(n["ФИО"],"Нет ФИО"),n["Телефон"]=e.coalesceFunc(n["Телефон"],""),n["ДоговорГПХ"]=n["ДоговорГПХ"]||false,c["EscapeHtml"]){var p=["Должность","Подразделение","Телефон","ФИО"];for(var h in p)n[p[h]]=s.escapeHtml(n[p[h]])}if(n.title=n["ФИО"],n["СтрокаПоиска"])n["ФИО"]=e.highlightSearchStr(n["ФИО"],n["СтрокаПоиска"]);if(Boolean(n["Активность"]))if(n["Активность"]=e.getActivityStatus(n["Пользователь"],n["Активность"],n["Пол"]),"online"==n["Активность"]&&(null==n["Online"]||null==n["atWorkplace"]))n["Online"]=true,n["atWorkplace"]=true;if(r){var u=n["atWorkplace"],S=n["Online"],T=n["Пользователь"];if(n["ActivityData"])u=n["ActivityData"].get("atWorkplace"),S=n["ActivityData"].get("online"),T=n["ActivityData"].get("user");n["activityIndicatorHtml"]=r.activityMarker({atWorkplace:u,online:S,user:T},{className:"employee_online_indicator",useBorder:true})}if(n.photoTemplate="",!c["БезФото"])if(n["PhotoData"])n.photoTemplate=o({cssClasses:"photo-employee "+c["PhotoClassName"],photoData:n["PhotoData"]});else if(void 0!==n["ИдФото"])n.photoTemplate=a({photoData:{personId:n["Лицо"],photoId:n["ИдФото"]},settingsView:{showMiniCard:c["ShowMiniCard"],size:c["PhotoSize"]||32,cssClasses:"photo-employee "+c["PhotoClassName"]}});else if(t)n.photoTemplate=t.createPhotoFace(l,{Id:n["Лицо"]},n["ИдФотоМини"]||void 0===n["ИдФотоМини"]?true:false,"employee_photo_wrap",c["ShowMiniCard"]);if(Boolean(n["ДатаРождения"])){var C=new Date,E=n["ДатаРождения"];if(E.getDate()===C.getDate()&&E.getMonth()===C.getMonth())n.birthday=true,n.title+=", День рождения"}if(n.markShortTitle="","МеткаТипСостояния"in n&&null!==n["МеткаТипСостояния"]){var y="";switch(n["МеткаТипСостояния"]){case 0:y="icon-Vacation",n.markShortTitle=rk("Отпуск");break;case 1:y="icon-Sick",n.markShortTitle=rk("Болеет");break;case 2:y="icon-Nipple",n.markShortTitle=rk("Отпуск по уходу");break;case 3:y="icon-statusDeparted",n.markShortTitle=rk("Командировка");break;case 4:y="icon-Sick",n.markShortTitle=rk("Декрет")}if(y)if(n.mark=y,n.title+=", "+n["РасшифровкаМетки"],n.markDateTo="",n["МеткаДатаКонца"]){var D;if((new Date).getFullYear()==n["МеткаДатаКонца"].getFullYear())D=n["МеткаДатаКонца"].strftime("%d %b");else D=n["МеткаДатаКонца"].strftime("%d %b '%y");D=D.toLowerCase().replace("май","мая"),n.markDateTo=rk("по","реестрСотрудников")+" "+D}}var P=(new Date).setHours(0,0,0,0);if(!!n["ДатаПринятия"]&&n["ДатаПринятия"]>P||!!n["ДатаУвольнения"]&&n["ДатаУвольнения"]<=P||n["Контрагент"]&&-2!==parseInt(n["Контрагент"],10)&&!n["ДолжностьСотрудника"]&&hasZP())n.dismiss=true;if(Boolean(n["ДатаУвольнения"])&&!n["ДоговорГПХ"]){var k="Муж"===n["Пол"]?rk("Уволен"):rk("Уволена");n.dismissDate=n["ДатаУвольнения"].strftime("%d.%m.%y"),n.title+=", "+k+" "+n.dismissDate,n.dismissText=k}if(c["ОтобразитьДолжность"]&&Boolean(n["Должность"]))n.title+=", "+s.escapeHtml(n["Должность"]);if(c["ОтобразитьПодразделение"]&&Boolean(n["Подразделение"]))n.title+=", "+s.escapeHtml(n["Подразделение"]);if(c["ОтобразитьТелефон"]&&Boolean(n["Телефон"]))n.title+=", Телефон: "+s.escapeHtml(n["Телефон"]);if(n.isVideoCallAvailable=i&&i.needRenderVideoCallButton(),n.isPhoneCallAvailable=!!n.Телефон,"True"!==m.get("Dialer.CanDial"))n.isPhoneCallAvailable=false;var v=g(Boolean(n.birthday),Boolean(n["Метка"]));if("FloatStaff"===c["ТекущаяЗадача"])if(4!=v&&5!=v)n.fioIconClass="listEmpl-fio-2-icons";else n.fioIconClass="listEmpl-fio-3-icons";else n.fioIconClass=d(v,true);return n.iconClass=d(v,false),n.hasIcons=Boolean(v),n.options=c,n.css_class=f,n},prepareCfgRenderDepartment:function(t,a){if(t instanceof p||n.instanceOfModule(t,"WS.Data/Entity/Model")){var o={id:t.get("Лицо"),name:s.escapeHtml(t.get("Название"))||u,managerFIO:s.escapeHtml(t.get("ФИОРуководителя")),employeeNumber:s.escapeHtml(t.get("КолЧел")),phone:s.escapeHtml(t.get("РабочийТелефон")),closingDate:t.get("ДатаУвольнения"),type:DEPARTMENT_TYPE_SIMPLE,address:t.get("Адрес"),showMiniCard:"object"==typeof a&&false===a.minicard?false:true};if(t.hasColumn("ТипПодразделения")&&t.get("ТипПодразделения"))o.type=t.get("ТипПодразделения").get?t.get("ТипПодразделения").get():t.get("ТипПодразделения");if("object"==typeof a)c(o,a);return h.prepareCfgRenderDepartment(o)}else a=t;var i={searchString:"",name:u,managerFIO:"",employeeNumber:"",titleNumber:"",phone:"",closingDate:"",showFolder:false,type:DEPARTMENT_TYPE_SIMPLE,tooltip:"",miniCardOnName:false};if("object"!=typeof a)return l.resolve("ILogger").error("SBIS3.Employee.ListEmployees","first argument  must be an object");if(a=f.clone(a),c(a,i,{preferSource:true}),a.employeeNumber)a.titleNumber=a.employeeNumber+" "+s.wordCaseByNumber(a.employeeNumber,rk("сотрудников"),rk("сотрудник"),rk("сотрудника"));if(a.type==DEPARTMENT_TYPE_OFFICE){if(a.officeTitle=rk("Обособленное подразделение"),a.address)a.officeTitle+=" "+a.address}else if(a.type==DEPARTMENT_TYPE_BRANCH)a.officeTitle=rk("Филиал");if(a.tooltip=a.tooltip||function(){var e="";if(e+=a.name,"офис"==a.type)e+="("+rk("Офис")+")";if(a.managerFIO)e+=" "+rk("Руководитель")+": "+a.managerFIO;if(a.titleNumber)e+=" "+a.titleNumber;if(a.phone)e+=" "+rk("Телефон")+": "+a.phone;return e}(),a.name=a.searchString?e.highlightSearchStr(a.name,a.searchString):a.name,a.closingDate instanceof Date)a.closingDate=a.closingDate.strftime("%d.%m.%y");return a}}});
//# sourceMappingURL=RenderHelper.module.js.map