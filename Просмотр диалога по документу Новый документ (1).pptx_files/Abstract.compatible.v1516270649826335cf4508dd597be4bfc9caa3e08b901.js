define("Core/Abstract.compatible",["Core/EventBus","Core/helpers/Object/find","Core/IoC"],function(t,n,e){"use strict";function i(t,n,e){if(e._getChannel)e._getChannel().once(t,n,e);else e.once(t,n,e)}function s(t,n,e){if(e._getChannel)e._getChannel().subscribe(t,n,e);else e.subscribe(t,n,e)}function r(t,n,e){if(e._getChannel)e._getChannel().unsubscribe(t,n);else e.unsubscribe(t,n)}return{_getOptions:function(){return this._options||{}},_setOptions:function(t,n){if(t instanceof Object){var e=Object.keys(t),i;for(i=0;i<e.length;i++)this._setOption(e[i],t[e[i]],n)}},_getOption:function(t){if(this._options&&t in this._options)return this["_$"+t]=this._options[t];if("_$"+t in this)return this["_$"+t];e.resolve("ILogger").info(this._moduleName||"Abstract",'Метод _getOption вызвали для несуществующей опции "'+t+'"')},_setOption:function(t,n,i){var s=this._options&&t in this._options||"_$"+t in this;if(!i&&!s)e.resolve("ILogger").info(this._moduleName||"Abstract",'Метод _setOption вызвали для несуществующей опции "'+t+'"');if(s)if(this["_$"+t]=n,this._options)this._options[t]=n},_hasOption:function(t){if(this._options&&t in this._options)return true;return"_$"+t in this},subscribeTo:function(t,n,e){return this._subscribeTo(t,n,e,false)},subscribeOnceTo:function(t,n,e){return this._subscribeTo(t,n,e,true)},_subscribeTo:function(t,e,r,o){if(!t.isDestroyed||!t.isDestroyed()&&!this.isDestroyed()){if("function"!==typeof r)throw new Error(rk("Аргумент handler у метода subscribeTo должен быть функцией"));var u,h,c;if(o)i(e,r,t);else s(e,r,t);if(o)h=function(){this._unsubscribeFrom(t,e,r,h)}.bind(this),this._subscriptions.push({handler:r,control:t,event:e,onceWrapper:h}),i(e,h,t);else if(u=n(this._subscriptions,function(n){return n.control===t&&n.handler===r&&n.event===e&&void 0===n.onceWrapper}),!u)this._subscriptions.push({handler:r,control:t,event:e});if(!t.hasEvent||!t.hasEvent("onDestroy"))return;if(c=n(this._subDestroyControls,function(n){return n.control===t}),!c){var l=function(n){if(n.getTarget()===t){if(h)t.unsubscribe(n,h);this.unsubscribeFrom(t)}}.bind(this);this._subDestroyControls.push({control:t,handler:l}),s("onDestroy",l,t)}}return this},unsubscribeFrom:function(t,n,e){return this._unsubscribeFrom(t,n,e)},_unsubscribeFrom:function(t,e,i,s){var o=this;function u(n){return o._subscriptions.filter(function(r){var o=(void 0===t||t===r.control)&&(void 0===e||e===r.event)&&(void 0===i||i===r.handler)&&(void 0===s||s===r.onceWrapper);return n?o:!o})}function h(t){return o._subDestroyControls.filter(function(e){var i=!n(o._subscriptions,function(t){return t.control===e.control});return t?i:!i})}var c=u(true);if(this._subscriptions=u(false),!s)c.forEach(function(t){if(!t.control.isDestroyed||!t.control.isDestroyed())r(t.event,t.handler,t.control)});var l=h(true);return this._subDestroyControls=h(false),l.forEach(function(t){if(!t.control.isDestroyed||!t.control.isDestroyed())r("onDestroy",t.handler,t.control)}),this},_allowEvents:function(){this._getChannel().allowEvents()},_eventsAllowed:function(){return this._getChannel().eventsAllowed()},_getChannel:function(){if(!this._eventBusChannel)this._eventBusChannel=t.channel(this._getOption("eventBusId"),{waitForPermit:true});return this._eventBusChannel},isDestroyed:function(){return this._isDestroyed},_publish:function(){for(var t=0,n=arguments.length;t<n;t++){var e=arguments[t],i=this._handlers[e],s,r;if(i)if("function"===typeof i)this.subscribe(e,i),this._handlers[e]=null;else if(r=i.length,r){for(s=0;s<r;s++)this.subscribe(e,i[s]);this._handlers[e]=null}}},_notify:function(n){var e=this._getChannel(),i=Array.prototype.slice.call(arguments,1),s=e._notifyWithTarget(n,this,i);return t.globalChannel()._notifyWithTarget(n,this,i),s},once:function(t,n){this.subscribeOnceTo(this,t,n)},subscribe:function(t,n){return this.subscribeTo(this,t,n),this},unsubscribe:function(t,n){return this._getChannel().unsubscribe(t,n),this.unsubscribeFrom(this,t,n),this},unbind:function(t){return this._getChannel().unbind(t),this},destroy:function(){if(this._eventBusChannel)this._notify("onDestroy"),this._eventBusChannel.unsubscribeAll(),this._eventBusChannel.destroy();this.unsubscribeFrom(),this._handlers={},this._isDestroyed=true},hasEvent:function(t){return this._getChannel().hasEvent(t)},hasEventHandlers:function(t){return this._getChannel().hasEventHandlers(t)},isInitialized:function(){return this._isInitialized},getEvents:function(){return this._getChannel().getEvents()},getEventHandlers:function(t){return this._getChannel().getEventHandlers(t)}}});
//# sourceMappingURL=Abstract.compatible.js.map