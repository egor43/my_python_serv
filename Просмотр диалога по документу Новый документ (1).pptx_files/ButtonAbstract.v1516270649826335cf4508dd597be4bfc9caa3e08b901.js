define("Deprecated/Controls/ButtonAbstract/ButtonAbstract",["Core/core-instance","Core/helpers/Function/forAliveOnly","Core/helpers/vital/processImagePath","Core/Deferred","Core/CommandDispatcher","Core/constants","Lib/Control/Control","css!Deprecated/Controls/ButtonAbstract/ButtonAbstract","css!Deprecated/Controls/LinkButton/LinkButton"],function(t,e,i,n,s,o,a){"use strict";var r=a.DataBoundControl.extend({$protected:{_aliasForContent:"caption",_keysWeHandle:[o.key.enter,o.key.space],_checkClickByTap:true,_tooltipSettings:{handleFocus:false},_options:{caption:"",image:"",imageAlign:"left",defaultButton:false,renderStyle:"classic",cssClassName:"ws-field-button"},_hasProcess:false,_isSpriteImage:false,_text:void 0,_bodyContainer:void 0,_menuControl:void 0,_onDblClickHandler:void 0,_defaultPlace:true},$constructor:function(t){if(this._publish("onActivated"),void 0!==t.img)this._options.image=t.img;if(void 0!==t.imgAlign)this._options.imageAlign=t.imgAlign;if(void 0!==t.isDefault)this._options.defaultButton=!!t.isDefault;if("string"!==typeof this._options.image)this._options.image="";if(this._isCorrectContainer())this._container.bind("selectstart",false),this._redraw();this._onDblClickHandler=function(t){t.stopPropagation()},this._container.bind("dblclick",this._onDblClickHandler).bind("focusin",function(t){t.stopPropagation()})},setDefaultButton:function(t,e){if(void 0===t)t=true;if(this._options.defaultButton!==t){if(this._container.toggleClass("ws-default-button",t),!e)if(t)this._registerDefaultButton();else this._unregisterDefaultButton();this._options.defaultButton=t}},isDefaultButton:function(){return this._options.defaultButton},_unregisterDefaultButton:function(){this.sendCommand("unregisterDefaultButtonAction")},_registerDefaultButton:function(){function t(t){if(e&&e.isEnabled())return e._onClickHandler(t),false;else return true}var e=this;if(this.isVisible())this._unregisterDefaultButton(),this.sendCommand("registerDefaultButtonAction",t,this)},_redraw:function(){if(this._bodyContainer="asLink"===this._options.renderStyle?this._container.find(".ws-link-body"):this._container,this._applyImageChange(),this._options.defaultButton)this._registerDefaultButton()},_onClickHandler:function(t){if(this.isEnabled())r.superclass._onClickHandler.apply(this,arguments),this._activate(t)},_initFocusCatch:function(){},_keyboardHover:function(t){if(this.isEnabled())if(t.which==o.key.enter||t.which==o.key.space)return this._activate(t),t.stopImmediatePropagation(),false;return true},_toggleProcess:function(t){this._hasProcess=t,this.setEnabled(!t),this._applyImageChange()},_activate:e(function(t){var e=this,i=this.getOwner(),o=this.getLinkedContext(),a=i?i.getLinkedContext():null,r=this._options.command,l=this.hasEventHandlers("onActivated"),h;if(o&&!o.isGlobal())o.setValue("Event",t,true);if(a&&!a.isGlobal())a.setValue("Event",t,true);if(r)l|=false!==(h=s.sendCommand(this,r));if(l&&t)t.stopPropagation();var c=this._notify("onActivated");if(!this.isDestroyed()&&c instanceof n)this._toggleProcess(true),c.addBoth(function(t){return e._toggleProcess(false),t})}),_onContextValueReceived:function(t){if(t)this.setCaption(t)},_insertImage:function(t){if("right"!==this._options.imgAlign&&"right"!==this._options.imageAlign)this._bodyContainer.prepend(t);else this._bodyContainer.append(t);return t},_setRedIcon:function(t){return t},_applyImageChange:function(){var t,e,n,s,a,r,l;if(this._hasProcess)r=(o.modules["WS.Deprecated"]?o.resourceRoot+"WS.Deprecated/":o.wsRoot+"deprecated")+"/Controls/Button/resources/images/process.v1516270649826335cf4508dd597be4bfc9caa3e08b901.gif";else r=this._options.image;if(this._isSpriteImage=-1!==r.indexOf("sprite:"),t=this._container.find(".ws-button-image"),l=t.find(".ws-button-image-container"),""!==r)if(this._isSpriteImage&&l.length||!this._isSpriteImage&&!l.length)t.empty().remove().length=0;if(0===t.length){if(""!==r)if(this._isSpriteImage)t=$('<div class="ws-button-image ws-hover-target"/>'),l=this._insertImage(t);else t=this._insertImage($('<div class="ws-button-image icon-16 ws-button-image-wrapper ws-hover-target"/>')),l=$('<img class="ws-button-image-container" onload="$(this).parent().toggleClass(\'icon-offset\', this.height === 16);"/>').appendTo(t)}else if(""===r)return t.remove(),void this._container.removeClass("ws-button-image-left").removeClass("ws-button-image-right");if(this._isSpriteImage){e=r.indexOf("sprite:");var h=t.data("current-sprite-class");if(h)t.removeClass(h);var c=this._setRedIcon(r.substr(e+"sprite:".length).replace(/_/g," "));t.addClass(c),t.data("current-sprite-class",c)}else l.attr("src",i(r));if(!r)n=s=false;else n=!(s="right"===this._options.imageAlign);if(this._container.toggleClass("ws-button-image-left",n).toggleClass("ws-button-image-right",s),"asLink"===this._options.renderStyle)if(this._container.find(".ws-button-caption").length&&"right"===this._options.imageAlign)t.appendTo(this._bodyContainer);else t.prependTo(this._bodyContainer)},setImage:function(t){this._options.image=t.replace(/&amp;/gi,"&"),this._applyImageChange()},hasImage:function(){return!!this._options.image},getImage:function(){return this._options.image},setImageAlign:function(t){this._options.imageAlign=t,this._applyImageChange()},getImageAlign:function(){return this._options.imageAlign},setCaption:function(t){if(void 0===t||null===t||false===t)t="";else if("string"!==typeof t)t+="";var e=this._container.find(".ws-button-caption");if(t.length){if(!e.length)if(e=$('<div class="ws-button-caption"/>'),"right"!==this._options.imgAlign&&"right"!==this._options.imageAlign)this._bodyContainer.append(e);else this._bodyContainer.prepend(e);e.text(t)}else if(e.length)e.detach().remove();this._options.caption=t},getCaption:function(){return this._options.caption},_setEnabled:function(e){if(r.superclass._setEnabled.apply(this,arguments),!t.instanceOfModule(this,"Deprecated/Controls/Button/Button"))this._container.toggleClass("ws-hover-target",this.isEnabled())},destroy:function(){if(this._container.unbind("dblclick",this._onDblClickHandler),this._bodyContainer)this._bodyContainer.empty().remove(),this._bodyContainer=$();this._unregisterDefaultButton(),r.superclass.destroy.apply(this,arguments)}});return r});
//# sourceMappingURL=ButtonAbstract.js.map