define("Lib/StickyHeader/StickyHeaderMediator/StickyHeaderMediator",["Core/Abstract","Core/EventBus","Core/core-instance","Core/helpers/Function/runDelayed","Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager","Core/constants"],function(e,i,n,t,r){"use strict";var o=false,a=[],s=[],c=[],d=function(e,i){return function(n,t){var r=$(t).closest(i);return!r.length||r[0]===e}},l=new(e.extend({$constructor:function(){},documentReady:function(){this._subscribeCommonEvents(),this._initFixation()},_subscribeCommonEvents:function(){if(!o){var e=this,n=i.globalChannel(),t=function i(){e._resizeHandler()};$(window).bind("resize",t),this.subscribeTo(i.channel("navigation"),"onAccTransform",t),this.subscribeTo(n,"onWindowCreated",function(i,n){e.subscribeTo(n,"onAfterShow",function(){if(n.getContainer().find(".ws-sticky-header__scrollable-container").length>0)e._initFixation(n.getContainer()),e.subscribeTo(n,"onBeforeClose",function(i){if(false!==i.getResult())e._unfixChildren(n.getContainer().find(".ws-sticky-header__scrollable-container"),true)})})}),this.subscribeTo(n,"onFloatAreaCreating",function(i,n){if(e.subscribeTo(n,"onAfterShow",function(){if(n.getProperty("isStack")&&1===n.getContainer().closest(".ws-sticky-header__scrollable-container").length)e._initFixation(n.getContainer()),e.subscribeTo(n,"onBeforeClose",function(i){if(false!==i.getResult())e._unfixChildren(n.getContainer().closest(".ws-sticky-header__scrollable-container"),true)}),e.subscribeTo(n,"onChangeMaximizeState",function(i){e._resizeHandler(n.getContainer())})}),n.getProperty("showOnControlsReady"))e.subscribeTo(n,"onBeforeShow",function(i){this.getContainer().find(".ws-sticky-header__scrollable-container").each(function(i,n){e._findHeaderElements($(n))})})}),this.subscribeTo(i.channel("stickyHeader"),"onForcedStickHeader",function(i,n){e._initFixation(n)}),o=true}},_initFixation:function(e){var i=this,n=function e(n,t){i._findHeaderElements($(t))};if(e){this._initChangeableAreas(e);var t=e.closest(".ws-sticky-header__scrollable-container");if(t.length)n(0,t[0]);e.find(".ws-sticky-header__scrollable-container").each(n)}else this._initChangeableAreas($("body")),$(".ws-sticky-header__wrapper > .ws-sticky-header__scrollable-container").each(n)},_findHeaderElements:function(e){if(!e.hasClass("ws-sticky-header__scrollable-container"))throw new Error("Lib/StickyHeader/StickyHeaderMediator/StickyHeaderMediator::_findHeaderElements - incorrect container fixation");var i=this,o=e.find(".ws-sticky-header__block:not(.ws-sticky-header__registered), .ws-sticky-header__table:not(.ws-sticky-header__registered)"),s=d(e[0],".ws-sticky-header__scrollable-container");(o=o.filter(s)).each(function(e,o){var s=$(o),c=s.hasClass("ws-sticky-header__table"),d=s.wsControl(),l;if(d){if(i.subscribeTo(d,"onDestroy",function(){i._unfixOne(s,true);var e=a.indexOf(d);a.splice(e,1)}),-1===a.indexOf(d)){if(i.subscribeTo(d,"onAfterVisibilityChange",function(e,n){if(n)i._initFixation(d.getContainer());else i._unfixChildren(d.getContainer(),true)}),i.subscribeTo(d,"onResize",function(){d._runBatchDelayedFunc("stickyResize",i._resizeHandler.bind(this,d.getContainer()))}),n.instanceOfModule(d,"SBIS3.CONTROLS/Browser"))if(l=d.getView(),n.instanceOfMixin(l,"SBIS3.CONTROLS/Mixins/TreeMixin")||n.instanceOfMixin(l,"SBIS3.CONTROLS/Mixins/hierarchyMixin"))i.subscribeTo(l,"onSetRoot",function(){i._resizeHandler(d.getContainer())});if(c&&n.instanceOfModule(d,"SBIS3.CONTROLS/DataGridView"))if(i.subscribeTo(d,"onDrawHead",function(){t(function(){i._dataGridViewDrawHeadHandler(s),i._updateTableHeaderVisibility(s),i._resizeHandler.bind(this,s)})}),i.subscribeTo(d,"onDrawItems",function(){t(function(){r.synchronizeTableHeaderColumnWidth(s)})}),i.subscribeTo(d,"onChangeHeadVisibility",function(){i._initFixation(d.getContainer()),i._updateTableHeaderVisibility(s)}),n.instanceOfMixin(d,"SBIS3.CONTROLS/Mixins/CompositeViewMixin"))i.subscribeTo(d,"onViewModeChanged",function(e){if("table"===d.getViewMode())i._initFixation(d.getContainer());else i._unfixChildren(d.getContainer(),true)})}a.push(d)}}),i._initChangeableAreas(e),this._fixChildren(e,o)},_initChangeableAreas:function(e){var i=this,n=d(e[0],".ws-sticky-header__scrollable-container");e.find(".ws-SwitchableArea").filter(n).each(function(e,n){var t=$(n).wsControl();if(-1===s.indexOf(t))s.push(t),i.subscribeTo(t,"onBeforeChangeActiveArea",function(e,n){if(n)i._unfixChildren(n.getContainer(),true)}),i.subscribeTo(t,"onAfterChangeActiveArea",function(e,n){i._initFixation(n.getContainer())}),i.subscribeTo(t,"onDestroy",function(){var e=s.indexOf(t);s.splice(e,1)})}),e.find(".ws-templatedArea").filter(n).each(function(e,n){var t=$(n).wsControl();if(-1===c.indexOf(t))c.push(t),i.subscribeTo(t,"onAfterShow",function(){i._initFixation(t.getContainer())}),i.subscribeTo(t,"onDestroy",function(){var e=c.indexOf(t);c.splice(e,1)}),i.subscribeTo(t,"onBeforeChangeActiveArea",function(){i._unfixChildren(t.getContainer(),true)})})},_fixChildren:function(e,i){if(!i||!i.length||1===i.length&&$(i[0]).is("#header"))return;r.fixAllChildren(e,i)},_unfixOne:function(e,i){r.unfixOne(e,i)},_unfixChildren:function(e,i){r.unfixAllChildren(e,i)},_resizeHandler:function(e){r.checkStickyHeaderSize(e)},_dataGridViewDrawHeadHandler:function(e){r.tableHeadRedrawn(e)},_updateTableHeaderVisibility:function(e){r.updateTableHeaderVisibility(e)}}));if("undefined"!==typeof window)if("complete"===document.readyState||"interactive"===document.readyState)l.documentReady();else if(document.addEventListener)document.addEventListener("DOMContentLoaded",l.documentReady);else document.attachEvent("onload",l.documentReady)});
//# sourceMappingURL=StickyHeaderMediator.js.map