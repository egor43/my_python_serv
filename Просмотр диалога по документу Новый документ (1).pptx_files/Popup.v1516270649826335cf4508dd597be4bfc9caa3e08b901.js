(function() {
   var availableDict = {"en-US":true},
      langMatch = String(typeof document === 'undefined' ? '' : document.cookie).match(/lang=([A-z-]+)/),
      langName = langMatch ? langMatch[1] : 'ru-RU',
      langModule = 'text!SBIS3.CONTROLS/lang/' + langName + '/' + langName + '.json';
   if (langName in availableDict) {
      define('SBIS3.CONTROLS_localization', ['Core/i18n', langModule], function(i18n, data) {
         if (data){
            i18n.setDict(JSON.parse(data), langModule, langName);
         }
      });
   } else {
      define('SBIS3.CONTROLS_localization', function() {});
   }
})();

(function() {
   var availableDict = {"en-US":true},
      langMatch = String(typeof document === 'undefined' ? '' : document.cookie).match(/lang=([A-z-]+)/),
      langName = langMatch ? langMatch[1] : 'ru-RU',
      langModule = 'text!SBIS3.ENGINE/lang/' + langName + '/' + langName + '.json';
   if (langName in availableDict) {
      define('SBIS3.ENGINE_localization', ['Core/i18n', langModule], function(i18n, data) {
         if (data){
            i18n.setDict(JSON.parse(data), langModule, langName);
         }
      });
   } else {
      define('SBIS3.ENGINE_localization', function() {});
   }
})();

define('SBIS3.CONTROLS/LongOperations/HistoryItem',['Core/core-extend','SBIS3.CONTROLS_localization'],function(e){'use strict';var n={title:'string',id:['string','number'],endedAt:'Date',errorMessage:'string',isFailed:'boolean'},t={isFailed:false},r=e.extend({_moduleName:'SBIS3.CONTROLS/LongOperations/HistoryItem',constructor:function e(r){if(!r||'object'!==typeof r)throw new TypeError('Argument "options" must be object');var o=['id','title','endedAt'];for(var a in n){var s=null;if(r.hasOwnProperty(a))s=r[a];var f=n[a],u;if(null!=s){var l=Array.isArray(f);if(u=l?f.some(function(e){return i(s,e);}):i(s,f),!u)if(l?-1!==f.indexOf('Date'):'Date'===f)s=new Date(s),u=true;}if(null==s||!u)if(-1!==o.indexOf(a))throw new TypeError('Argument "options.'+a+'" must be '+(Array.isArray(f)?f.join(' or '):'a '+f));else s=a in t?t[a]:null;this[a]=s;}},toSnapshot:function(){var e={};for(var r in n){var i=this[r];if(null!=i&&!(r in t&&i===t[r]))e[r]=i instanceof Date?i.getTime():i;}return e;}}),i=function(e,n){return typeof e===n||-1===['boolean','number','string','object'].indexOf(n)&&'function'===typeof window[n]&&e instanceof window[n];};return r;});
define("tmpl!SBIS3.CONTROLS/LongOperations/History/LongOperationHistory",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Browser","js!SBIS3.CONTROLS/Link","js!SBIS3.CONTROLS/Filter/FastData","js!SBIS3.CONTROLS/DataGridView"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Browser"]=e[1],r["js!SBIS3.CONTROLS/Link"]=e[2],r["js!SBIS3.CONTROLS/Filter/FastData"]=e[3],r["js!SBIS3.CONTROLS/DataGridView"]=e[4];var o=function e(o,i,a,s,n){function l(){}var c=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var u={};n&&n.isSetts&&(u=n.fullContext||{});var p="string"==typeof a?a:"",S=void 0===r?void 0:r,O={id:[],def:void 0},v=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},f=d.getMarkupGenerator(s);try{var g=f.joinElements([f.createTag("div",{class:"controls-LongOperations controls-LongOperationHistory"},[f.createControl("wsControl","ws:SBIS3.CONTROLS/Browser",{content:(new function(){var e=Object.create(o),t=function e(t,r,o,i,a){if(void 0===o)var o=arguments[2];var s=0,n="content";if(void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure")),a&&a.isSetts)var l=a.fullContext||{};t=d.isolateScope(Object.create(this),t,n);var c="string"==typeof o?o:"",u={id:[],def:void 0},p=this&&this.includedTemplates?this.includedTemplates:{},O=d.getMarkupGenerator(i);try{var m=O.joinElements([d.getter(t,["resultHandler"])?[O.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{caption:(new function(){var e=Object.create(t),r=function e(t,r,o,i,a){if(void 0===o)var o=arguments[2];var s=0,n="caption";if(void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure")),a&&a.isSetts)var l=a.fullContext||{};t=d.isolateScope(Object.create(this),t,n);var c="string"==typeof o?o:"",u={id:[],def:void 0},p=this&&this.includedTemplates?this.includedTemplates:{},S=d.getMarkupGenerator(i);try{var O=S.joinElements([d.getter(t,["resultWayOfUse"])?[S.createText(" "+d.wrapUndef(d.utils.escape(d.getter(t,["resultWayOfUse"])))+" ")]:[S.createText(" "+global.rk("Частичный результат")+" ")]],c,u);u.def&&(O=S.chain(O,u,r),u=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/LongOperations/History/LongOperationHistory.tmpl",e,t)}return O||""};this.func=d.makeFunctionSerializable(r,e)}).func,name:"resultButton",className:"controls-LongOperationsHistory__resultButton",esc:!1},{name:"resultButton",sbisname:"resultButton"},{data:t,ctx:this,pName:void 0!==n?n:void 0,viewController:v,internal:{__dirtyCheckingVars_0:d.getter(t,["resultWayOfUse"]),__dirtyCheckingVars_1:d.getter(t,["resultWayOfUse"])}},o,S,p,d.config,l)]:O.createText(""),O.createTag("div",{class:"controls-Browser__table"},[O.createTag("div",{class:"controls-Browser__tableRow"},[O.createTag("div",{class:"controls-Browser__tableCell-fastDataFilter"},[O.createControl("wsControl","ws:SBIS3.CONTROLS/Filter/FastData",{filterStructure:[{internalValueField:"key",internalCaptionField:"title",value:void 0}],name:"browserFastDataFilter",className:"controls-Browser__fastDataFilter",esc:!1,bindings:[{fieldName:"filter/onlyErrors",propName:"filterStructure/0/value",propPath:["0","value"],fullPropName:"filterStructure/0/value",propPathStr:"0/value",oneWay:!1,direction:"fromContext",bindNonExistent:!1}]},{name:"browserFastDataFilter",sbisname:"browserFastDataFilter"},{data:t,ctx:this,pName:void 0!==n?n:void 0,viewController:v},o,S,p,d.config,l)],{},u,this)],{},u,this)],r,u,this),O.createTag("div",{class:"controls-Browser__view"},[O.createControl("wsControl","ws:SBIS3.CONTROLS/DataGridView",{columns:[{title:global.rk("Дата"),cellTemplate:"tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryDateTemplate",width:"60"},{title:global.rk("Время"),cellTemplate:"tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryTimeTemplate",width:"60"},{title:global.rk("ОперацииНадЗаписями@@Наименование"),field:"title"},{title:global.rk("Статус"),cellTemplate:"tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryStatusTemplate"}],idProperty:"id",name:"browserView",pageSize:"2000",infiniteScroll:"down",itemsActions:[],displayProperty:"title",itemsDragNDrop:!1,bindings:[{fieldName:"filter",propName:"filter",propPath:[],fullPropName:"filter",propPathStr:"",oneWay:!1,direction:"fromContext",bindNonExistent:!1}],filter:void 0,className:"controls-Browser__view controls-DataGridView__hasSeparator controls-DataGridView__overflow-ellipsis",ladder:["Date"],esc:!1},{name:"browserView",sbisname:"browserView"},{data:t,ctx:this,pName:void 0!==n?n:void 0,viewController:v},o,S,p,d.config,l)],r,u,this)],c,u);u.def&&(m=O.chain(m,u,r),u=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/LongOperations/History/LongOperationHistory.tmpl",e,t)}return m||""};this.func=d.makeFunctionSerializable(t,e)}).func,name:"brows",className:"controls-Browser__view",esc:!1},{name:"brows",sbisname:"brows"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:v,internal:{__dirtyCheckingVars_0:d.getter(o,["resultWayOfUse"]),__dirtyCheckingVars_1:d.getter(o,["resultWayOfUse"]),__dirtyCheckingVars_3:d.getter(o,["resultHandler"])}},a,S,m,d.config,u)],i,O,this)],p,O);O.def&&(g=f.chain(g,O,i),O=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/LongOperations/History/LongOperationHistory.tmpl",e,o)}return g||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/History/LongOperationHistory"}},o});
if(typeof window !== "undefined" && window.atob && document.cookie.indexOf("thmname") === -1){define("css!SBIS3.CONTROLS/LongOperations/History/LongOperationHistory", function() {var style = document.createElement("style"),head = document.head || document.getElementsByTagName("head")[0];style.type = "text/css";style.appendChild(document.createTextNode(".controls-LongOperationHistory__view_errorOperation,.controls-LongOperationHistory__view_errorOperation .controls-LongOperationHistory__view_time{color:#ef463a}.controls-LongOperationHistory__view_time{color:#999}.controls-LongOperationHistory .controls-DataGridView__tr{height:40px}.controls-LongOperationHistory .controls-ListView__ItemsToolbar-container{margin-bottom:12px}.controls-LongOperationHistory .controls-DataGridView__tr .controls-DataGridView__td .controls-DataGridView__columnValue{white-space:normal}.controls-LongOperationHistory .controls-Browser,.controls-LongOperationHistory .controls-Browser .controls-Browser__view{min-height:0;height:100%;clear:both;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column}.controls-LongOperationHistory .controls-Browser .controls-Browser__table{-webkit-flex-shrink:0;-ms-flex-negative:0;-ms-flex-shrink:0;flex-shrink:0}.ws-is-old-webkit .controls-LongOperationHistory .controls-Browser,.ws-is-old-webkit .controls-LongOperationHistory .controls-Browser .controls-Browser__view{-webkit-flex-basis:0;-ms-flex-preferred-size:0;-ms-flex-basis:0;flex-basis:0;-webkit-flex-grow:1;-ms-flex-positive:1;-ms-flex-grow:1;flex-grow:1}.ws-is-ie .controls-LongOperationHistory .controls-Browser,.ws-is-ie .controls-LongOperationHistory .controls-Browser .controls-Browser__view{-webkit-flex-shrink:1;-ms-flex-negative:1;-ms-flex-shrink:1;flex-shrink:1}.controls-LongOperationHistory .controls-Browser__table{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.controls-LongOperationHistory .controls-Browser__tableRow{height:auto;display:inline-flex;display:-ms-flexbox;display:-ms-inline-flexbox;display:-webkit-inline-flex;-webkit-justify-content:flex-end;-ms-justify-content:flex-end;justify-content:flex-end;-ms-flex-pack:end;white-space:nowrap;overflow:hidden;width:100%;-webkit-flex-shrink:1;-ms-flex-negative:1;-ms-flex-shrink:1;flex-shrink:1}.controls-LongOperationHistory .controls-Browser__tableCell-fastDataFilter{-webkit-box-ordinal-group:2;-moz-box-ordinal-group:2;-ms-flex-order:2;-webkit-order:2;order:2;overflow:hidden;min-width:30px;max-width:100%;margin-right:8px}.controls-LongOperationHistory .controls-Browser__table.controls-Browser__table-fullFilterBlock .controls-Browser__tableCell-fastDataFilter{margin-right:4px}.controls-LongOperationHistory .controls-Browser__table .controls-Browser__fastDataFilter{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-justify-content:flex-start;justify-content:flex-start;-ms-flex-pack:start;-webkit-flex-shrink:1;-ms-flex-negative:1;-ms-flex-shrink:1;flex-shrink:1}.controls-LongOperationHistory .controls-Browser__fastDataFilter .controls-DropdownList{margin-top:8px;overflow:hidden}.controls-LongOperationHistory .ws-sticky-header__block.ws-sticky-header__fixed.controls-Browser__table{z-index:3}.controls-LongOperationsHistory__resultButton{width:auto;margin:0 auto 0 12px}"));head.appendChild(style);});}
define("tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryDateTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,n,a,s){function l(){}var p=0,d=void 0!==t&&t?t:arguments[arguments.length-1];void 0===d&&(eval("var thelpers = null;"),d=global.requirejs("View/Runner/tclosure"));var c={};s&&s.isSetts&&(c=s.fullContext||{});var u="string"==typeof n?n:"",g=void 0===r?void 0:r,m={id:[],def:void 0},y=d.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},v=d.getMarkupGenerator(a);try{var O=v.joinElements([v.createTag("div",{},[v.createText(""+d.wrapUndef(d.utils.escape(d.getter(o,["decorators","applyOnly"]).apply(d.getter(o,["decorators"]),[d.getter(d.getter(o,["item","get"]).apply(d.getter(o,["item"]),["endedAt"]),["strftime"]).apply(d.getter(o,["item","get"]).apply(d.getter(o,["item"]),["endedAt"]),["%d.%m"]),{ladder:d.getter(o,["field"])}]))))],i,m,this)],u,m);m.def&&(O=v.chain(O,m,i),m=void 0)}catch(e){d.templateError("resources/SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryDateTemplate.tmpl",e,o)}return O||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryDateTemplate"}},o});
define("tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryTimeTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,o,n,s,a){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};a&&a.isSetts&&(u=a.fullContext||{});var d="string"==typeof n?n:"",m=void 0===r?void 0:r,g={id:[],def:void 0},v=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),y=this&&this.includedTemplates?this.includedTemplates:{},f=c.getMarkupGenerator(s);try{var O=f.joinElements([f.createTag("div",{},[f.createTag("span",{class:"controls-LongOperationHistory__view_time"},[f.createText(""+c.wrapUndef(c.utils.escape(c.getter(c.getter(i,["item","get"]).apply(c.getter(i,["item"]),["endedAt"]),["strftime"]).apply(c.getter(i,["item","get"]).apply(c.getter(i,["item"]),["endedAt"]),["%H:%M"]))))],{},g,this)],o,g,this)],d,g);g.def&&(O=f.chain(O,g,o),g=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryTimeTemplate.tmpl",e,i)}return O||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryTimeTemplate"}},i});
define("tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryStatusTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,n,s,a){function l(){}var u=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var c={};a&&a.isSetts&&(c=a.fullContext||{});var d="string"==typeof n?n:"",g=void 0===r?void 0:r,m={id:[],def:void 0},v=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),y=this&&this.includedTemplates?this.includedTemplates:{},f=p.getMarkupGenerator(s);try{var S=f.joinElements([f.createText(""+p.wrapUndef(p.utils.escape(p.getter(o,["item","get"]).apply(p.getter(o,["item"]),["isFailed"])?p.getter(o,["item","get"]).apply(p.getter(o,["item"]),["errorMessage"])||"Ошибка":"Успешно")))],d,m);m.def&&(S=f.chain(S,m,i),m=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryStatusTemplate.tmpl",e,o)}return S||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryStatusTemplate"}},o});
define('SBIS3.CONTROLS/LongOperations/History',['Lib/Control/CompoundControl/CompoundControl','SBIS3.CONTROLS/LongOperations/Manager','SBIS3.CONTROLS/LongOperations/HistoryItem','WS.Data/Source/DataSet','WS.Data/Collection/RecordSet','WS.Data/Entity/Record','Core/Sanitize','tmpl!SBIS3.CONTROLS/LongOperations/History/LongOperationHistory','css!SBIS3.CONTROLS/LongOperations/History/LongOperationHistory','SBIS3.CONTROLS/Browser','tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryDateTemplate','tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryTimeTemplate','tmpl!SBIS3.CONTROLS/LongOperations/History/resources/LongOperationHistoryStatusTemplate','SBIS3.CONTROLS/Filter/FastData','SBIS3.CONTROLS/DataGridView','SBIS3.CONTROLS_localization'],function(t,e,i,o,s,r,n,a){var l=t.extend({_dotTplFn:a,$protected:{_options:{tabKey:null,producer:null,operationId:null,isFailed:null,failedOperation:null},_data:[{idProperty:'key',displayProperty:'title',multiselect:false,values:[{key:false,title:rk('Все')},{key:true,title:rk('C ошибками')}]}],_view:null},_modifyOptions:function(){var t=l.superclass._modifyOptions.apply(this,arguments);if(t.resultHandler&&!t.resultWayOfUse&&t.failedOperation)t.resultWayOfUse=t.failedOperation.get('resultWayOfUse');return t;},$constructor:function(){this.getLinkedContext().setValue('filter',{onlyErrors:!!this._options.isFailed});},init:function(){l.superclass.init.call(this),this._view=this.getChildControlByName('browserView'),this.getChildControlByName('browserFastDataFilter').setItems(this._data),this._bindEvents(),this._reload();},_bindEvents:function(){var t=this;this.subscribeTo(this._view,'onPropertyChanged',function(e,i){if('filter'===i)t._reload();}),this.subscribeTo(this._view,'onDrawItems',function(){var e=t._view.getContainer();t._view.getItems().each(function(t,i){if(t.get('isFailed'))e.find('.js-controls-ListView__item[data-id="'+t.getId()+'"]').addClass('controls-LongOperationHistory__view_errorOperation');});});var e=this._options.resultHandler;if(e&&this.hasChildControlByName('resultButton'))this.subscribeTo(this.getChildControlByName('resultButton'),'onActivated',function(){e.call();});},_reload:function(){var t=this._options.failedOperation;if(!t)e.history(this._options.tabKey,this._options.producer,this._options.operationId,this._view._getOption('pageSize'),this._view.getFilter()).addCallbacks(function(t){this._view.setItems(t&&t instanceof o?t.getAll():t);}.bind(this),function(t){});else{var a=new s({idProperty:'id'}),l=new i({title:t.get('title'),id:t.get('id'),endedAt:new Date(t.get('startedAt').getTime()+(t.get('timeSpent')||0)+(t.get('timeIdle')||0)),errorMessage:n(t.get('resultMessage'),null)||'Ошибка',isFailed:true});a.assign([new r({rawData:l,idProperty:'id'})]),this._view.setItems(a);}}});return l.dimensions={width:'680px',height:'100px',resizeable:false},l;});
define("tmpl!SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter/LongOperationsFilter",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/DropdownList","optional!js!SBIS3.Staff.Choice"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={};o["js!SBIS3.CONTROLS/DropdownList"]=e[1],o["optional!js!SBIS3.Staff.Choice"]=e[2];var r=function e(r,i,l,n,a){function s(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};a&&a.isSetts&&(d=a.fullContext||{});var m="string"==typeof l?l:"",y=void 0===o?void 0:o,u={id:[],def:void 0},g=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),N=this&&this.includedTemplates?this.includedTemplates:{},f=c.getMarkupGenerator(n);try{var P=f.joinElements([f.createTag("div",{class:"controls-LongOperationsFilter"},[f.createTag("div",{class:"controls-LongOperationsFilter__block"},[f.createControl("wsControl","ws:SBIS3.CONTROLS/DropdownList",{selectedKeys:[],items:[{key:null,title:global.rk("В любом состоянии")},{key:"running",title:global.rk("В процессе")},{key:"ended",title:global.rk("Завершенные")},{key:"success-ended",title:global.rk("Успешно"),parent:"ended"},{key:"error-ended",title:global.rk("С ошибками"),parent:"ended"},{key:"suspended",title:global.rk("Приостановленные")}],name:"StateFilter",className:"controls-LongOperationsFilter__stateDropdown controls-DropdownList__withoutArrow controls-DropdownList__linkStyle controls-DropdownList__withoutCross",mode:"click",idProperty:"key",displayProperty:"title",parentProperty:"parent",multiselect:!1,bindings:[{fieldName:"StateTitle",propName:"text",propPath:[],fullPropName:"text",propPathStr:"",oneWay:!1,direction:"fromContext",bindNonExistent:!1},{fieldName:"StateKey",propName:"selectedKeys/0",propPath:["0"],fullPropName:"selectedKeys/0",propPathStr:"0",oneWay:!1,direction:"fromContext",bindNonExistent:!1}],text:void 0,esc:!1},{name:"StateFilter",sbisname:"StateFilter"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},l,y,N,c.config,d),f.createControl("wsControl","ws:SBIS3.CONTROLS/DropdownList",{selectedKeys:[],items:[{key:null,title:global.rk("За все время")},{key:"PT1H",title:global.rk("За час")},{key:"P1D",title:global.rk("За сегодня")},{key:"P7D",title:global.rk("За неделю")},{key:"P30D",title:global.rk("За месяц")},{key:"P180D",title:global.rk("За полгода")}],name:"PeriodFilter",className:"controls-DropdownList__withoutArrow controls-DropdownList__linkStyle controls-DropdownList__withoutCross",mode:"click",idProperty:"key",displayProperty:"title",multiselect:!1,bindings:[{fieldName:"PeriodTitle",propName:"text",propPath:[],fullPropName:"text",propPathStr:"",oneWay:!1,direction:"fromContext",bindNonExistent:!1},{fieldName:"PeriodKey",propName:"selectedKeys/0",propPath:["0"],fullPropName:"selectedKeys/0",propPathStr:"0",oneWay:!1,direction:"fromContext",bindNonExistent:!1}],text:void 0,esc:!1},{name:"PeriodFilter",sbisname:"PeriodFilter"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},l,y,N,c.config,d)],{},u,this),f.createTag("div",{class:"controls-LongOperationsFilter__block"},[f.createTag("div",{class:"controls-LongOperationsFilter__durationTitle"},[f.createText(""+global.rk("Длительность операции"))],{},u,this),f.createControl("wsControl","ws:SBIS3.CONTROLS/DropdownList",{selectedKeys:[],items:[{key:null,title:global.rk("Все")},{key:"PT5M",title:global.rk("Дольше 5 минут")},{key:"PT10M",title:global.rk("Дольше 10 минут")},{key:"PT30M",title:global.rk("Дольше 30 минут")},{key:"PT1H",title:global.rk("Дольше часа")}],name:"DurationFilter",className:"controls-DropdownList__withoutArrow controls-DropdownList__linkStyle controls-DropdownList__withoutCross",mode:"click",idProperty:"key",displayProperty:"title",multiselect:!1,bindings:[{fieldName:"DurationTitle",propName:"text",propPath:[],fullPropName:"text",propPathStr:"",oneWay:!1,direction:"fromContext",bindNonExistent:!1},{fieldName:"DurationKey",propName:"selectedKeys/0",propPath:["0"],fullPropName:"selectedKeys/0",propPathStr:"0",oneWay:!1,direction:"fromContext",bindNonExistent:!1}],text:void 0,esc:!1},{name:"DurationFilter",sbisname:"DurationFilter"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},l,y,N,c.config,d)],{},u,this),c.getter(r,["hideStaffFilter"])?f.createText(""):[f.createTag("div",{class:"controls-LongOperationsFilter__block"},[f.createTag("div",{class:"controls-LongOperationsFilter__responsibleTitle"},[f.createText(""+global.rk("Ответственный"))],{},u,this),f.createControl("template","optional!js!SBIS3.Staff.Choice",{selectedKeys:[],selectionType:"leaf",withAccess:!0,multiselect:!1,entityType:"Пользователь",name:"FilterResponsibleFace",bindings:[{fieldName:"UserName",propName:"caption",propPath:[],fullPropName:"caption",propPathStr:"",oneWay:!1,direction:"fromContext",bindNonExistent:!1},{fieldName:"UserId",propName:"selectedKeys/0",propPath:["0"],fullPropName:"selectedKeys/0",propPathStr:"0",oneWay:!1,direction:"fromContext",bindNonExistent:!1}],caption:void 0,placeholder:global.rk("укажите ФИО"),className:"controls-LongOperationsFilter__responsibleChooser",esc:!1},{name:"FilterResponsibleFace",sbisname:"FilterResponsibleFace"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},n?l+"part_"+p+++"_":l,y,N,c.config,d)],{},u,this)]],i,u,this)],m,u);u.def&&(P=f.chain(P,u,i),u=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter/LongOperationsFilter.tmpl",e,r)}return P||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter/LongOperationsFilter"}},r});
if(typeof window !== "undefined" && window.atob && document.cookie.indexOf("thmname") === -1){define("css!SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter/LongOperationsFilter", function() {var style = document.createElement("style"),head = document.head || document.getElementsByTagName("head")[0];style.type = "text/css";style.appendChild(document.createTextNode(".controls-LongOperationsFilter__durationTitle,.controls-LongOperationsFilter__responsibleTitle{float:left;min-height:24px;margin-right:8px;line-height:24px;color:#8991a9}.controls-LongOperationsFilter__responsibleChooser{margin-left:104px}.controls-LongOperationsFilter__responsibleChooser .StaffChoice__fieldLink{width:246px}.controls-LongOperationsFilter .controls-DropdownList__picker .controls-DropdownList__item{font-size:14px}.controls-LongOperationsFilter__stateDropdown{width:150px}.controls-LongOperationsFilter__block{height:30px}"));head.appendChild(style);});}
define('SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter',['Lib/Control/CompoundControl/CompoundControl','tmpl!SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter/LongOperationsFilter','css!SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter/LongOperationsFilter','SBIS3.CONTROLS/DropdownList','optional!js!SBIS3.Staff.Choice','SBIS3.CONTROLS_localization'],function(o,t){var e=o.extend({_dotTplFn:t,$protected:{_options:{hideStaffFilter:false}},init:function(){e.superclass.init.call(this);}});return e;});
define('SBIS3.CONTROLS/LongOperations/List/resources/model',['WS.Data/Entity/Model','SBIS3.CONTROLS/LongOperations/Entry','SBIS3.CONTROLS_localization'],function(t,e){var r=function(t){var r=t.get('timeSpent');if('number'!==typeof r||r<=0){var n=e.STATUSES;if(t.get('status')===n.running){var i=t.get('timeIdle');r=new Date().getTime()-t.get('startedAt')-('number'===typeof i&&0<i?i:0);}else r=0;}return r;},n=t.extend({$protected:{_options:{properties:{fullId:{get:function(){return n.getFullId(this.get('tabKey'),this.get('producer'),this.get('id'));}},strTimeSpent:{get:function(){return n.timeSpentAsString(r(this),2);}},shortTimeSpent:{get:function(){return n.timeSpentAsString(r(this),1);}},userFullName:{get:function(){for(var t=[],e=0,r=['userLastName','userFirstName','userPatronymicName'];e<r.length;e++){var n=this.get(r[e]);if(!n)break;t.push(0===e?n:n.charAt(0)+'.');}return t.length?t.join(' '):rk('Пользователь удален');}}}}}});return n.timeSpentAsString=function(t,e){var r=[];if('number'===typeof t&&0<t){e=1<e?e:1;for(var n=Math.round(t/1000),i=0,u=[86400,3600,60,1],o=['д.','ч.','мин.','сек.'];i<u.length;i++){var s=u[i],a=Math.floor(n/s);if(n%=s,a)if(r.push(a+' '+rk(o[i],'ДлительныеОперации')),e<=r.length)break;}}return r.length?r.join(' '):'0 сек.';},n.getFullId=function(t,e,r){return(t||'')+':'+e+':'+r;},n;});
define('SBIS3.CONTROLS/LongOperations/List/resources/DataSource',['Core/core-extend','Core/Deferred','WS.Data/Source/ISource','WS.Data/Entity/ObservableMixin','WS.Data/Source/DataSet','SBIS3.CONTROLS/LongOperations/Manager','SBIS3.CONTROLS/LongOperations/Entry','Core/TimeInterval','SBIS3.CONTROLS_localization'],function(e,t,n,r,i,o,s,a){'use strict';var u=4;return e.extend({},[n,r],{_moduleName:'SBIS3.CONTROLS/LongOperations/List/resources/DataSource',$protected:{_options:{customConditions:[],navigationType:'Page'}},$constructor:function e(){this._publish('onBeforeProviderCall');},getOptions:function(){return this._options;},setOptions:function(e){this._options=e;},query:function(e){var n={},r=e.getWhere();if(r){var d={};if(r.status){var c=s.STATUSES;switch(r.status){case'running':case'suspended':case'ended':d.status=c[r.status];break;case'not-suspended':d.status=[c.running,c.ended];break;case'success-ended':d.status=c.ended,d.isFailed=null;break;case'error-ended':d.status=c.ended,d.isFailed=true;}}if(r.period)d.startedAt={condition:'>=',value:new a(r.period).subFromDate(new Date())};if(r.duration)d.timeSpent={condition:'>=',value:new a(r.duration).getTotalMilliseconds()};if(r['СтрокаПоиска'])d.title={condition:'contains',value:r['СтрокаПоиска'],sensitive:false};if(r.UserId)d.userId=r.UserId;if(Object.keys(d).length)n.where=d;}var f=this._options.customConditions,l=!!(f&&f.length),g=e.getOrderBy();if(g&&g.length)n.orderBy=g;var S=e.getOffset();if(0<=S)n.offset=S;var p=e.getLimit();if(0<p)n.limit=l?p+f.length*u:p;if(r.needUserInfo)n.extra={needUserInfo:true};this._notify('onBeforeProviderCall');var v=new t();return o.fetch(Object.keys(n).length?n:null).addCallbacks(function(e){var t=e.getMetaData(),r=e.getRawData();if(l&&r.length)if(r=r.filter(function(e){var t=e.custom;return!t||!f.some(function(e){return Object.keys(e).every(function(n){return e[n]===t[n];});});}),0<p&&!n.offset)r=r.slice(0,p);v.callback(new i({rawData:{items:r,more:t&&t.more},idProperty:e.getIdProperty(),itemsProperty:'items',totalProperty:'more',model:e.getModel()}));},function(e){}),v;}});});
define("tmpl!SBIS3.CONTROLS/LongOperations/List/LongOperationsList",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/DataGridView"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/DataGridView"]=e[1];var i=function e(i,o,s,n,a){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var m={};a&&a.isSetts&&(m=a.fullContext||{});var d="string"==typeof s?s:"",u=void 0===r?void 0:r,L={id:[],def:void 0},g=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),S=this&&this.includedTemplates?this.includedTemplates:{},O=c.getMarkupGenerator(n);try{var f=O.joinElements([O.createTag("div",{class:"controls-LongOperationsList"},[O.createControl("wsControl","ws:SBIS3.CONTROLS/DataGridView",{name:c.getter(i,["listName"]),idProperty:"fullId",showHead:!1,displayProperty:"title",itemsActions:[],pageSize:c.getter(i,["pageSize"]),scrollPaging:!1,itemsDragNDrop:!1,bindings:[{fieldName:"filter",propName:"filter",propPath:[],fullPropName:"filter",propPathStr:"",oneWay:!1,direction:"fromContext",bindNonExistent:!1}],filter:void 0,className:c.getter(i,["className"])||"",infiniteScroll:c.getter(i,["infiniteScroll"]),easyGroup:c.getter(i,["useGroupByEasyGroup"]),columns:[c.getter(i,["columns","status"])?{field:"status",cellTemplate:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStateTemplate",width:c.getter(i,["narrowTmpl"])?"":"40"}:void 0,c.getter(i,["columns","startedAt"])?{field:"startedAt",cellTemplate:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStartTimeTemplate",width:"110",className:"controls-LongOperationsList__startTimeContainer"}:void 0,c.getter(i,["columns","title"])?{field:"title",cellTemplate:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListNameTemplate",width:c.getter(i,["narrowTmpl"])?"":"100%",className:"controls-LongOperationsList__nameColumn controls-DataGridView-cell-overflow-ellipsis"}:void 0,c.getter(i,["columns","timeSpent"])?{field:"timeSpent",cellTemplate:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListExecuteTimeTemplate",width:c.getter(i,["narrowTmpl"])?"":"130",className:"controls-LongOperationsList__executeTimeContainer"}:void 0,c.getter(i,["columns","userPic"])?{field:"userPic",cellTemplate:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListUserPhotoTemplate",width:c.getter(i,["narrowTmpl"])?"":"200",className:"controls-DataGridView-cell-overflow-ellipsis"}:void 0]},{name:c.getter(i,["listName"]),sbisname:c.getter(i,["listName"])},{data:i,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:g},s,u,S,c.config,m)],o,L,this)],d,L);L.def&&(f=O.chain(f,L,o),L=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/List/LongOperationsList.tmpl",e,i)}return f||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/List/LongOperationsList"}},i});
if(typeof window !== "undefined" && window.atob && document.cookie.indexOf("thmname") === -1){define("css!SBIS3.CONTROLS/LongOperations/List/LongOperationsList", function() {var style = document.createElement("style"),head = document.head || document.getElementsByTagName("head")[0];style.type = "text/css";style.appendChild(document.createTextNode(".controls-LongOperationsList__startTime_time{margin-left:8px}.controls-LongOperationsList .controls-DataGridView__tr.controls-ListView__hoveredItem .controls-LongOperationsList__executeTimeContainer.controls-DataGridView__td,.controls-LongOperationsList .controls-LongOperationsList__executeTimeContainer.controls-DataGridView__td,.controls-LongOperationsList__startTime_time,.controls-LongOperationsList__view_stoppedOperation{color:#999}.controls-LongOperationsList .controls-LongOperationsList__executeTimeContainer.controls-DataGridView__td{text-align:right}.controls-LongOperationsList .controls-LongOperationsList__executeTimeContainer,.controls-LongOperationsList .controls-LongOperationsList__startTimeContainer{font-size:inherit}.controls-LongOperationsList__user_image{float:left;border-radius:6px;width:34px;height:34px}.controls-LongOperationsList__user_userNameContainer{line-height:32px;margin-left:4px}.controls-LongOperationsList__groupTpl_separator{border-top:1px solid #eaeaea;position:relative;top:-8px}.controls-LongOperationsList__groupTpl_title{position:relative;display:inline-block;margin:0 auto;padding:0 8px;z-index:10;background:#fff;color:#999;text-align:center;font-size:14px}.controls-LongOperationsList__groupTpl_td{text-align:center}.controls-LongOperationsList__stateContainer{margin-left:10px;margin-top:4px}.controls-LongOperationsList .controls-LongOperationsList__nameColumn.controls-DataGridView__td{height:34px;line-height:34px}.controls-LongOperationsList__emptyHTMLTpl_separatorBlock{text-align:center}.controls-LongOperationsList__emptyHTMLTpl_title{color:#000}.controls-LongOperationsList__nameContainer{overflow:hidden;text-overflow:ellipsis}.controls-LongOperationsList .controls-ItemActions .controls-ItemActions__itemsContainer .controls-ItemActions__item .controls-ItemActions__icon{vertical-align:bottom;margin-bottom:0}"));head.appendChild(style);});}
define("tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStateTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],i={},r=function e(r,a,o,n,s){function l(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var d={};s&&s.isSetts&&(d=s.fullContext||{});var u="string"==typeof o?o:"",g=void 0===i?void 0:i,v={id:[],def:void 0},m=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),h=this&&this.includedTemplates?this.includedTemplates:{},T=p.getMarkupGenerator(n);try{var L=T.joinElements([T.createTag("div",{class:"controls-LongOperationsList__stateContainer"},[void(h.resultTpl=function(e,t){this&&this.includedTemplates&&this.includedTemplates;var i=p.getMarkupGenerator(n);try{var r=i.joinElements([0===p.getter(e,["value"])?[i.createTag("div",{class:"icon-16 icon-size icon-Refresh icon-disabled",title:""+global.rk("В процессе")},[],{},v,this)]:1===p.getter(e,["value"])?[i.createTag("div",{title:""+global.rk("Приостановлено")},[],{},v,this)]:2===p.getter(e,["value"])?[p.getter(e,["item","get"]).apply(p.getter(e,["item"]),["isFailed"])?[i.createTag("div",{class:"icon-16 icon-size icon-Alert icon-error",title:""+global.rk("Завершено с ошибками")},[],{},v,this)]:[i.createTag("div",{class:"icon-16 icon-size icon-ChangeAccount icon-done",title:""+global.rk("Завершено")},[],{},v,this)]]:i.createText("")],u,v);v.def&&(r=i.chain(r,v,t),v=void 0)}catch(t){p.templateError("resources/SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStateTemplate.tmpl",t,e)}return r||""}.bind({includedTemplates:h})),function(e,t){p.prepareAttrsForFocus(t,e,"0");this&&this.includedTemplates&&this.includedTemplates;var i=p.getMarkupGenerator(n);try{var r=i.joinElements([0===p.getter(e,["value"])?[i.createTag("div",{class:"icon-16 icon-size icon-Refresh icon-disabled",title:""+global.rk("В процессе")},[],{},v,this)]:1===p.getter(e,["value"])?[i.createTag("div",{title:""+global.rk("Приостановлено")},[],{},v,this)]:2===p.getter(e,["value"])?[p.getter(e,["item","get"]).apply(p.getter(e,["item"]),["isFailed"])?[i.createTag("div",{class:"icon-16 icon-size icon-Alert icon-error",title:""+global.rk("Завершено с ошибками")},[],{},v,this)]:[i.createTag("div",{class:"icon-16 icon-size icon-ChangeAccount icon-done",title:""+global.rk("Завершено")},[],{},v,this)]]:i.createText("")],u,v);v.def&&(r=i.chain(r,v,t),v=void 0)}catch(t){p.templateError("resources/SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStateTemplate.tmpl",t,e)}return r||""}(p.calculateScope(p.uniteScope(p.utils.escape(p.uniteScope(r,{parent:void 0,element:void 0})(p.plainMerge)),{value:p.getter(r,["item","get"]).apply(p.getter(r,["item"]),[p.getter(r,["field"])])}),p.plainMerge),{})],a,v,this)],u,v);v.def&&(L=T.chain(L,v,a),v=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStateTemplate.tmpl",e,r)}return L||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStateTemplate"}},r});
define("tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStartTimeTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,a,s,n,o){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var g={};o&&o.isSetts&&(g=o.fullContext||{});var m="string"==typeof s?s:"",u=void 0===r?void 0:r,d={id:[],def:void 0},f=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),L=this&&this.includedTemplates?this.includedTemplates:{},T=c.getMarkupGenerator(n);try{var v=T.joinElements([T.createTag("span",{},[T.createText(""+c.wrapUndef(c.utils.escape(c.getter(c.getter(i,["item","get"]).apply(c.getter(i,["item"]),[c.getter(i,["field"])]),["strftime"]).apply(c.getter(i,["item","get"]).apply(c.getter(i,["item"]),[c.getter(i,["field"])]),["%d.%m"]))))],a,d,this),T.createTag("span",{class:"controls-LongOperationsList__startTime_time"},[T.createText(""+c.wrapUndef(c.utils.escape(c.getter(c.getter(i,["item","get"]).apply(c.getter(i,["item"]),[c.getter(i,["field"])]),["strftime"]).apply(c.getter(i,["item","get"]).apply(c.getter(i,["item"]),[c.getter(i,["field"])]),["%H:%M"]))))],a,d,this)],m,d);d.def&&(v=T.chain(v,d,a),d=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStartTimeTemplate.tmpl",e,i)}return v||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStartTimeTemplate"}},i});
define("tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListExecuteTimeTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,n,o,s,a){function l(){}var u=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var p={};a&&a.isSetts&&(p=a.fullContext||{});var d="string"==typeof o?o:"",m=void 0===r?void 0:r,v={id:[],def:void 0},L=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},g=c.getMarkupGenerator(s);try{var O=g.joinElements([g.createText(""+c.wrapUndef(c.utils.escape(c.getter(i,["item","get"]).apply(c.getter(i,["item"]),["strTimeSpent"]))))],d,v);v.def&&(O=g.chain(O,v,n),v=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListExecuteTimeTemplate.tmpl",e,i)}return O||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListExecuteTimeTemplate"}},i});
define("tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListUserPhotoTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},s=function e(s,i,o,n,a){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};a&&a.isSetts&&(u=a.fullContext||{});var g="string"==typeof o?o:"",d=void 0===r?void 0:r,m={id:[],def:void 0},L=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,s),f=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(n);try{var O=v.joinElements([c.getter(s,["item","get"]).apply(c.getter(s,["item"]),[c.getter(s,["field"])])?[v.createTag("img",{class:"controls-LongOperationsList__user_image",src:""+c.wrapUndef(c.utils.escape(c.getter(s,["item","get"]).apply(c.getter(s,["item"]),[c.getter(s,["field"])])))},[],{},m,this)]:v.createText(""),v.createTag("span",{class:"controls-LongOperationsList__user_userNameContainer"},[v.createText(""+c.wrapUndef(c.utils.escape(c.getter(s,["item","get"]).apply(c.getter(s,["item"]),["userFullName"]))))],i,m,this)],g,m);m.def&&(O=v.chain(O,m,i),m=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListUserPhotoTemplate.tmpl",e,s)}return O||""};return s.includedFunctions={},s.stable=!0,s.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListUserPhotoTemplate"}},s});
define("tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListNameTemplate",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},i=function e(i,n,o,s,a){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};a&&a.isSetts&&(u=a.fullContext||{});var d="string"==typeof o?o:"",m=void 0===r?void 0:r,g={id:[],def:void 0},L=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,i),f=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(s);try{var O=v.joinElements([v.createTag("div",{class:"controls-LongOperationsList__nameContainer",title:""+c.wrapUndef(c.utils.escape(c.getter(i,["item","get"]).apply(c.getter(i,["item"]),["resultUrl"])?"Открыть ссылку":""))},[v.createText(""+c.wrapUndef(c.utils.escape(c.getter(i,["item","get"]).apply(c.getter(i,["item"]),[c.getter(i,["field"])]))))],n,g,this)],d,g);g.def&&(O=v.chain(O,g,n),g=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListNameTemplate.tmpl",e,i)}return O||""};return i.includedFunctions={},i.stable=!0,i.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListNameTemplate"}},i});
define('SBIS3.CONTROLS/LongOperations/List',['Core/Deferred','Lib/Control/CompoundControl/CompoundControl','SBIS3.CONTROLS/LongOperations/Entry','SBIS3.CONTROLS/LongOperations/List/resources/model','SBIS3.CONTROLS/LongOperations/Manager','SBIS3.CONTROLS/LongOperations/List/resources/DataSource','SBIS3.CONTROLS/Utils/InformationPopupManager','Lib/Control/FloatArea/FloatArea','tmpl!SBIS3.CONTROLS/LongOperations/List/LongOperationsList','css!SBIS3.CONTROLS/LongOperations/List/LongOperationsList','tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStateTemplate','tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListStartTimeTemplate','tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListExecuteTimeTemplate','tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListUserPhotoTemplate','tmpl!SBIS3.CONTROLS/LongOperations/List/resources/LongOperationsListNameTemplate','SBIS3.CONTROLS/DataGridView','SBIS3.CONTROLS_localization'],function(e,t,i,n,s,o,r,a,l){'use strict';var u=5000,c=400,d=3,g=1000,h=t.extend({_dotTplFn:l,$protected:{_options:{columns:{status:true,startedAt:true,title:true,timeSpent:true,userPic:true},pageSize:50,infiniteScroll:'down',hasSeparator:false,listName:'browserView',userId:null,noLoad:false},_view:null,_spentTiming:null,_animQueue:[],_animating:null,_notFirst:null},$constructor:function(){var e=this.getLinkedContext();if(!e.getValue('filter'))e.setValue('filter',{});if(this._options.userId)e.setValue('filter/UserId',this._options.userId);if(this._options.columns.userPic)e.setValue('filter/needUserInfo',true);this._publish('onlongoperationstarted','onlongoperationchanged','onlongoperationended','onlongoperationdeleted','onproducerregistered','onproducerunregistered','ontimespentchanged');},init:function(){h.superclass.init.call(this),this._view=this.getChildControlByName(this._options.listName),this._bindEvents(),this._view.setDataSource(new o(),true);},_bindEvents:function(){var e=this,t=i.STATUSES;['onlongoperationstarted','onlongoperationchanged','onlongoperationended','onlongoperationdeleted','onproducerregistered','onproducerunregistered'].forEach(function(i){e.subscribeTo(s,i,function(i,n){var s;if(-1!==['onlongoperationchanged','onlongoperationended','onlongoperationdeleted'].indexOf(i.name)){var o=e.lookupItem(n);if(s=!o,o)switch(i.name){case'onlongoperationchanged':if('progress'===n.changed)o.set('progressCurrent',n.progress.value),o.set('progressTotal',n.progress.total),s=true;else{if('status'===n.changed){if(n.status===t.running&&o.get('status')===t.suspended)o.set('timeIdle',new Date().getTime()-o.get('startedAt').getTime()-o.get('timeSpent'));}else if('notification'===n.changed&&n.notification)o.set('notification',n.notification),s=true;o.set(n.changed,n[n.changed]);}e._checkItems();break;case'onlongoperationended':e._animationAdd(o.getId(),!n.error),e._animationRun();}}if(e._notify(i.name,n),!s)e.reload();});}),this.subscribeTo(this._view,'onDrawItems',function(){var i=e._view.getItems();if(i){var n=e._view.getContainer();i.each(function(e,i){if(e.get('status')===t.suspended)n.find('.js-controls-ListView__item[data-id="'+e.getId()+'"]').addClass('LongOperationsList__view_stoppedOperation');});}}),this.subscribeTo(this._view,'onChangeHoveredItem',function(t,i){var n=i.record;if(n){var s=e._makeItemsActions(n),o=e._view.getItemsActions();if(o)o.setItems(s);else if(s&&s.length)e._view.setItemsActions(s);}});},_makeItemsActions:function(e){var t={};if(e){var n=i.STATUSES,s='Favourite',o=e.get('status'),r=this._getCustomActions(e);if(r)for(var a in r){var l=r[a];if(l&&'object'===typeof l&&!l.main&&this._isCustomActionAllowed(l,o))t[a]={title:l.title||a,icon:'sprite:icon-16 icon-'+(l.ico||s)+' icon-done'};}if(e.get('canSuspend')&&o===n.running)t['suspend']={title:rk(e.get('resumeAsRepeat')?'Отменить':'Приостановить','ДлительныеОперации'),icon:'sprite:icon-16 icon-Pause icon-primary action-hover'};if(e.get('canSuspend')&&o===n.suspended)t['resume']={title:rk(e.get('resumeAsRepeat')?'Повторить':'Возобновить','ДлительныеОперации'),icon:'sprite:icon-16 icon-DayForward icon-primary action-hover'};if(e.get('canDelete'))t['delete']={title:rk('Удалить'),icon:'sprite:icon-16 icon-Erase icon-error'};}return Object.keys(t).map(function(e){var i=t[e];return{name:e,icon:i.icon,caption:i.title,tooltip:i.title,isMainAction:true,onActivated:this._onUserAction.bind(this,e)};}.bind(this));},_onUserAction:function(e,t,i,n){this.applyUserAction(e,n);},getView:function(){return this._view;},getItems:function(){return this._view.getItems();},_checkItems:function(){var e,t=this._view.getItems();if(t&&t.getCount()){var n=i.STATUSES,s=!this._notFirst?new Date().getTime()-g:null;t.each(function(t){var i=t.get('status');if(!this._notFirst&&i===n.ended&&s<t.get('startedAt').getTime()+t.get('timeSpent')+t.get('timeIdle'))this._animationAdd(t.getId(),!t.get('isFailed'));if(!e&&i===n.running)e=true;}.bind(this));}if(this._notFirst=true,e){if(!this._spentTiming)this._spentTiming=setInterval(this._changeTimeSpent.bind(this),u);}else if(this._spentTiming)clearInterval(this._spentTiming),this._spentTiming=null;this._animationRun();},_changeTimeSpent:function(){var e=this._view.getItems();if(e&&e.each){var t=i.STATUSES,n=this._view.getContainer(),s=this._view._getItemsProjection();s.setEventRaising(false);var o=new Date().getTime();e.each(function(e){if(e.get('status')===t.running)e.set('timeSpent',o-e.get('startedAt').getTime()-e.get('timeIdle')),n.find('.js-controls-ListView__item[data-id="'+e.getId()+'"]').find('.controls-LongOperationsList__executeTimeContainer').html(e.get('strTimeSpent'));}),s.setEventRaising(true);}this._notify('ontimespentchanged');},reload:function(){var e=this._view.reload().addCallback(function(){this._checkItems();}.bind(this));return this._view.getContainer().find('.controls-AjaxLoader').addClass('ws-hidden').removeClass('controls-AjaxLoader__showIndication'),e;},setCustomConditions:function(e){if(!(e&&Array.isArray(e)&&e.every(function(e){return!!e&&'object'===typeof e&&!!Object.keys(e).length;})))throw new Error('Array of objects required');var t=this._view.getDataSource(),i=t.getOptions();i.customConditions=e,t.setOptions(i);},canHasHistory:function(e){return!!e&&s.canHasHistory(e.get('tabKey'),e.get('producer'));},applyUserAction:function(t,i){var n,o;switch(t){case'suspend':case'resume':n=i.get('canSuspend');break;case'delete':n=i.get('canDelete');break;default:var r=this._getCustomActions(i);if(r&&r[t]&&'object'===typeof r[t])o=r[t],n=true;}if(!n)return e.fail('Action not allowed');var a;if(o)a=this._execHandler(o.call,o.args);else if(a=s.callAction(t,i.get('tabKey'),i.get('producer'),i.get('id')),'delete'===t)a.addCallback(this.reload.bind(this));return a;},describeMainAction:function(e){var t=this._getMainAction(e);if(t){var i={type:t.type};if('custom'===t.type)i.title=t.action.title;return i;}},applyMainAction:function(e){var t=this._getMainAction(e);if(t)switch(t.type){case'result':this._showResult(e);break;case'history':this._showHistory(e,t.allowResultButton);break;case'custom':this._execHandler(t.action.call,t.action.args);}},_getMainAction:function(e){if(e){var t=i.STATUSES,n=e.get('status');if(n===t.ended||e.get('isFailed'))if(!e.get('isFailed')||e.get('useResult')){if(e.get('resultHandler')||e.get('resultUrl'))return{type:'result'};else if(this.canHasHistory(e)&&1<e.get('progressTotal')||e.get('useResult'))return{type:'history'};}else return{type:'history',allowResultButton:true};else{var s=this._getCustomActions(e);if(s)for(var o in s){var r=s[o];if(r.main&&this._isCustomActionAllowed(r,n))return{type:'custom',action:r};}}}},_getCustomActions:function(e){var t=e.get('custom');if(t){var i=t.actions;return i&&'object'===typeof i?i:null;}},_isCustomActionAllowed:function(e,t){var i=e.when;return Array.isArray(i)&&-1!==i.indexOf(t);},_showResult:function(e){if(e&&(e.get('status')===i.STATUSES.ended||e.get('isFailed'))){var t=e.get('resultHandler'),n=e.get('resultUrl');if(t||n){var s=e.get('resultValidUntil');if(s&&s<new Date())return this._obsoleteResult(),true;}if(t){var o=e.get('resultChecker');if(o)this._execHandler(o,e.get('resultCheckerArgs')).addCallbacks(function(i){if(i)this._execHandler(t,e.get('resultHandlerArgs'));else this._obsoleteResult();}.bind(this),this._obsoleteResult.bind(this));else this._execHandler(t,e.get('resultHandlerArgs'));return true;}if(n){if(e.get('resultUrlAsDownload')){var r=document.createElement('a');r.setAttribute('href',n),r.setAttribute('download',''),r.style.display='none',document.body.appendChild(r),r.click(),document.body.removeChild(r);}else window.open(n,'_blank');return true;}}return false;},_obsoleteResult:function(){r.showMessageDialog({message:rk('Операция устарела.','ДлительныеОперации'),details:rk('Выполните повторно.','ДлительныеОперации')});},_execHandler:function(t,i){var n=t.split(':'),s=new e();return require([n.shift()],function(t){var o;if(i){if('string'===typeof i)try{i=JSON.parse(i);}catch(e){}if(!Array.isArray(i))i=[i];}else i=[];if(1<n.length&&!(0===i.length||i.length===n.length))throw new Error('Method and its arguments are not compatible');if(n.length){var r=t;if(1===n.length)i=[i];for(;n.length;){if(!r||'object'!==typeof r)throw new Error('Submethod is or not valid');var a=n.shift();if('function'!==typeof r[a])throw new Error('Submethod is or not valid');var l=i.length?i.shift():[];r=r[a].apply(r,Array.isArray(l)?l:[l]);}o=r;}else{if(!t||'function'!==typeof t)throw new Error('Method is or not valid');o=t.apply(null,i);}if(void 0!==o)if(o instanceof e)s.dependOn(o);else s.callback(o);else s.callback();}),s;},_showHistory:function(e,t){if(e&&(e.get('status')===i.STATUSES.ended||e.get('isFailed'))){var n=t&&(e.get('resultHandler')||e.get('resultUrl'))?this._showResult.bind(this,e):null,s=n?e.get('resultWayOfUse'):null,o=new a({title:rk('Журнал выполнения операции','ДлительныеОперации'),template:'SBIS3.CONTROLS/LongOperations/History',componentOptions:this.canHasHistory(e)?{tabKey:e.get('tabKey'),producer:e.get('producer'),operationId:e.get('id'),isFailed:e.get('isFailed'),resultHandler:n,resultWayOfUse:s}:{failedOperation:e,resultHandler:n},opener:this,direction:'left',animation:'slide',isStack:true,autoCloseOnHide:true,maxWidth:680});this._notify('onSizeChange'),this.subscribeOnceTo(o,'onAfterClose',this._notify.bind(this,'onSizeChange'));}},lookupItem:function(e){var t=this._view.getItems();if(t&&t.getCount()){var i=e.producer;if(!i)throw new Error('Property "producer" required');var n=!!e.operationId,s=n?e.operationId:e.workflowId;if(!s)throw new Error('Property "operationId" or "workflowId" required');for(var o=0,r=t.getCount();o<r;o++){var a=t.at(o);if(a.get('producer')===i&&(n?a.get('id')===s:a.get('extra')&&a.get('extra').workflow===s))return a;}}},animationStart:function(){this._animationRun();},animationClear:function(){if(this._animating)clearTimeout(this._animating),this._animating=null;if(this._animQueue.length){for(var e=0;e<this._animQueue.length;e++)this._animQueue[e].remain=1;this._animationStep();}},_animationAdd:function(e,t){if(!this._animQueue.length||!this._animQueue.some(function(t){return t.id===e;}))this._animQueue.push({id:e,isSuccess:t,remain:2*d});},_animationRun:function(e){var t=!e&&!!this._animating;if(this._animating)clearTimeout(this._animating),this._animating=null;if(this._view.getContainer().is(':visible'))if(this._animationStep(t),this._animQueue.length)this._animating=setTimeout(this._animationRun.bind(this,true),c);},_animationStep:function(e){if(this._animQueue.length)for(var t=this.getContainer(),i=this._animQueue.length-1;0<=i;i--){var n=this._animQueue[i],s=t.find('.js-controls-ListView__item[data-id="'+n.id+'"]');if(!s.length)this._animQueue.splice(i,1);if(e)n.remain++;if(s.toggleClass(n.isSuccess?'controls-LongOperationsPopup__successCompletedOperation':'controls-LongOperationsPopup__errorCompletedOperation',n.remain%2===0),n.remain--,n.remain<=0)this._animQueue.splice(i,1);}},destroy:function(){if(this._spentTiming)clearInterval(this._spentTiming),this._spentTiming=null;if(this._animating)clearTimeout(this._animating),this._animating=null;h.superclass.destroy.call(this);}});return h;});
define("tmpl!SBIS3.CONTROLS/LongOperations/Popup/resources/headerTemplate",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Link"],function(){var e=Array.prototype.slice.call(arguments),o=e[0],t={};t["js!SBIS3.CONTROLS/Link"]=e[1];var r=function e(r,n,a,s,i){function p(){}var c=0,l=void 0!==o&&o?o:arguments[arguments.length-1];void 0===l&&(eval("var thelpers = null;"),l=global.requirejs("View/Runner/tclosure"));var d={};i&&i.isSetts&&(d=i.fullContext||{});var u="string"==typeof a?a:"",g=void 0===t?void 0:t,h={id:[],def:void 0},O=l.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),_=this&&this.includedTemplates?this.includedTemplates:{},m=l.getMarkupGenerator(s);try{var S=m.joinElements([m.createTag("div",{class:"controls-NotificationPopup__header_icon"+l.wrapUndef(l.utils.escape(l.getter(r,["icon"])?" icon-size "+l.getter(r,["icon"]):"success"===l.getter(r,["status"])?" icon-size icon-24 icon-Yes icon-done":"error"===l.getter(r,["status"])?" icon-size icon-24 icon-Alert icon-error":""))},[],n,h,this),m.createTag("div",{class:"controls-NotificationPopup__header_caption controls-LongOperationsPopup__header_caption"},[m.createText(""+l.wrapUndef(l.utils.escape(l.getter(r,["caption"]))))],n,h,this),m.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{caption:global.rk("Скачать"),name:"downloadButton",className:"controls-LongOperationsPopup__header_downloadButton",escapeCaptionHtml:!1},l.plainMerge(n,{name:"downloadButton",sbisname:"downloadButton"}),{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:O},a,g,_,l.config,d),m.createTag("div",{class:"controls-LongOperationsPopup__header_stoppedOperationsButton controls-LongOperationsPopup__header_stoppedOperations-show"},[m.createTag("span",{class:"controls-LongOperationsPopup__header_hideStoppedOperations",title:""+global.rk("Скрыть прерванные")},[m.createText(""+global.rk("Скрыть прерванные"))],{},h,this),m.createTag("span",{class:"controls-LongOperationsPopup__header_showStoppedOperations",title:""+global.rk("Показать прерванные")},[m.createText(""+global.rk("Показать прерванные"))],{},h,this)],n,h,this)],u,h);h.def&&(S=m.chain(S,h,n),h=void 0)}catch(e){l.templateError("resources/SBIS3.CONTROLS/LongOperations/Popup/resources/headerTemplate.tmpl",e,r)}return S||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/Popup/resources/headerTemplate"}},r});
define("tmpl!SBIS3.CONTROLS/LongOperations/Popup/resources/contentTemplate",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/LongOperations/List","js!SBIS3.CONTROLS/Link"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],o={};o["js!SBIS3.CONTROLS/LongOperations/List"]=e[1],o["js!SBIS3.CONTROLS/Link"]=e[2];var r=function e(r,n,i,s,a){function l(){}var p=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var u={};a&&a.isSetts&&(u=a.fullContext||{});var d="string"==typeof i?i:"",O=void 0===o?void 0:o,S={id:[],def:void 0},m=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),L=this&&this.includedTemplates?this.includedTemplates:{},g=c.getMarkupGenerator(s);try{var v=g.joinElements([g.createTag("div",{class:"controls-LongOperationsPopup__content"},[g.createControl("wsControl","ws:SBIS3.CONTROLS/LongOperations/List",{pageSize:4,noLoad:!0,userId:c.getter(r,["userId"]),name:"operationList",narrowTmpl:!0,showPaging:!1,infiniteScroll:null,listName:"operationListDataGrid",className:"controls-LongOperationsPopup__content_list controls-ListView__withoutMarker controls-DataGridView__hasSeparator",columns:{startedAt:!1,userPic:!1}},{name:"operationList",sbisname:"operationList"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},i,O,L,c.config,u),g.createTag("div",{class:"controls-LongOperationsPopup__content_showRegistryButtonContainer"},[g.createControl("wsControl","ws:SBIS3.CONTROLS/Link",{name:"registryOperationButton",className:"controls-LongOperationsPopup__content_showRegistryButton",caption:global.rk("Все операции")},{name:"registryOperationButton",sbisname:"registryOperationButton"},{data:r,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:m},i,O,L,c.config,u)],{},S,this)],n,S,this)],d,S);S.def&&(v=g.chain(v,S,n),S=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/Popup/resources/contentTemplate.tmpl",e,r)}return v||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/Popup/resources/contentTemplate"}},r});
define("tmpl!SBIS3.CONTROLS/LongOperations/Popup/resources/footerTemplate",["Core/tmpl/js/tclosure"],function(){var o=Array.prototype.slice.call(arguments),e=o[0],t={},r=function o(r,s,n,a,i){function c(){}var p=0,l=void 0!==e&&e?e:arguments[arguments.length-1];void 0===l&&(eval("var thelpers = null;"),l=global.requirejs("View/Runner/tclosure"));var u={};i&&i.isSetts&&(u=i.fullContext||{});var d="string"==typeof n?n:"",g=void 0===t?void 0:t,_={id:[],def:void 0},f=l.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,r),T=this&&this.includedTemplates?this.includedTemplates:{},h=l.getMarkupGenerator(a);try{var O=h.joinElements([h.createTag("div",{class:"controls-LongOperationsPopup__footer"},[h.createTag("span",{class:"controls-LongOperationsPopup__footer_progress_container"},[h.createTag("span",{class:"controls-LongOperationsPopup__footer_executeTime"},[],{},_,this),h.createTag("span",{class:"controls-LongOperationsPopup__footer_execTasks"},[],{},_,this),h.createTag("span",{class:"controls-LongOperationsPopup__footer_progress"},[],{},_,this)],{},_,this),h.createTag("span",{class:"controls-LongOperationsPopup__footer_notification ws-hidden"},[],{},_,this),h.createTag("span",{class:"controls-LongOperationsPopup__footer__actionsContainer"},[h.createTag("span",{class:"controls-LongOperationsPopup__hideContentIcon icon-16 icon-size icon-TFExpand icon-disabled"},[],{},_,this),h.createTag("span",{class:"controls-LongOperationsPopup__footer_pauseIcon icon-16 icon-size icon-Pause icon-primary"},[],{},_,this)],{},_,this)],s,_,this)],d,_);_.def&&(O=h.chain(O,_,s),_=void 0)}catch(o){l.templateError("resources/SBIS3.CONTROLS/LongOperations/Popup/resources/footerTemplate.tmpl",o,r)}return O||""};return r.includedFunctions={},r.stable=!0,r.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/Popup/resources/footerTemplate"}},r});
if(typeof window !== "undefined" && window.atob && document.cookie.indexOf("thmname") === -1){define("css!SBIS3.CONTROLS/LongOperations/Popup/LongOperationsPopup", function() {var style = document.createElement("style"),head = document.head || document.getElementsByTagName("head")[0];style.type = "text/css";style.appendChild(document.createTextNode(".controls-LongOperationsPopup.controls-InformationPopup.controls-FloatArea .controls-PopupMixin__closeButton{position:absolute;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-ms-flex-align:center;-ms-align-items:center;align-items:center;-webkit-justify-content:center;-ms-justify-content:center;justify-content:center;-ms-flex-pack:center;border:none;top:8px;cursor:pointer;z-index:1;right:6px;color:#ccc!important;background:0 0;box-shadow:none!important;font-size:24px!important;line-height:24px!important;width:24px;height:24px;font-family:cbuc-icons24!important}.controls-LongOperationsPopup.controls-LongOperationsPopup__hidden{visibility:hidden}.controls-LongOperationsPopup.controls-LongOperationsPopup__hiddenContentMode{min-width:260px;max-width:400px}.controls-LongOperationsPopup:not(.controls-LongOperationsPopup__hiddenContentMode){min-width:400px;max-width:500px}.controls-LongOperationsPopup .controls-NotificationPopup{max-width:none;border-right:0 none}.controls-LongOperationsPopup__hiddenContentMode .controls-LongOperationsPopup__content,.controls-LongOperationsPopup__hiddenContentMode .controls-LongOperationsPopup__header_stoppedOperationsButton{display:none}.controls-NotificationPopup__header_icon.controls-LongOperationsPopup__runOperationIcon{cursor:pointer}.controls-LongOperationsPopup .controls-NotificationPopup__header{height:auto}.controls-LongOperationsPopup .controls-NotificationPopup__header.controls-NotificationPopup__header-withCloseButton{padding-top:8px;padding-right:41px;padding-bottom:8px;line-height:normal}.controls-LongOperationsPopup .controls-NotificationPopup__header_icon.icon-24{margin-right:6px}.controls-LongOperationsPopup .controls-NotificationPopup__header_icon.icon-size{width:24px;height:24px;font-size:24px!important}.controls-NotificationPopup__header_icon.controls-LongOperationsPopup__header_icon-customIcon{background:url(/resources/SBIS3.CONTROLS/LongOperations/Popup/resources/load.v1516270649826335cf4508dd597be4bfc9caa3e08b901.gif);background-size:cover}.controls-LongOperationsPopup .controls-LongOperationsPopup__header_caption{font-size:15px;line-height:inherit;color:inherit;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal}.controls-LongOperationsPopup.controls-LongOperationsPopup__hiddenContentMode .controls-LongOperationsPopup__header_caption{font-size:15px;line-height:inherit;color:inherit}.controls-LongOperationsPopup__header_downloadButton,.controls-LongOperationsPopup__header_stoppedOperationsButton{padding-top:1px;line-height:normal;font-size:inherit}.controls-LongOperationsPopup.controls-LongOperationsPopup__hiddenContentMode .controls-LongOperationsPopup__header_downloadButton,.controls-LongOperationsPopup.controls-LongOperationsPopup__hiddenContentMode .controls-LongOperationsPopup__header_stoppedOperationsButton{padding-top:1px}.controls-LongOperationsPopup__header_downloadButton{max-width:150px;min-width:64px;margin-left:8px;overflow:hidden;text-overflow:ellipsis}.controls-LongOperationsPopup__header_downloadButton .controls-Button__text{white-space:nowrap}.controls-LongOperationsPopup__header_stoppedOperationsButton{margin-left:8px;cursor:pointer;white-space:nowrap;color:#999}.controls-LongOperationsPopup__header_stoppedOperationsButton:hover{text-decoration:underline}.controls-LongOperationsPopup__header_hideStoppedOperations,.controls-LongOperationsPopup__header_stoppedOperations-show .controls-LongOperationsPopup__header_showStoppedOperations{display:none}.controls-LongOperationsPopup__header_stoppedOperations-show .controls-LongOperationsPopup__header_hideStoppedOperations{display:block}.controls-LongOperationsPopup__content .controls-DataGridView__table{width:auto;min-width:100%}.controls-LongOperationsPopup__content .controls-LongOperationsList__nameColumn{max-width:369px;overflow:hidden}.controls-LongOperationsPopup__content .controls-LongOperationsList__executeTimeContainer{width:105px}.controls-LongOperationsPopup__content .controls-LongOperationsList .controls-DataGridView__tr.controls-ListView__hoveredItem .controls-LongOperationsList__executeTimeContainer.controls-DataGridView__td,.controls-LongOperationsPopup__content .controls-LongOperationsList .controls-LongOperationsList__executeTimeContainer.controls-DataGridView__td{color:#ccc;font-size:12px}.controls-LongOperationsPopup__content .controls-LongOperationsList .controls-DataGridView__firstContentCell{width:26px;padding-left:7px;padding-right:2px}.controls-LongOperationsPopup__content .controls-LongOperationsList .controls-LongOperationsList__stateContainer{margin-left:0}.controls-LongOperationsPopup__content_showRegistryButtonContainer{height:24px}.controls-LongOperationsPopup__content_showRegistryButton{float:right;margin-right:12px}.controls-LongOperationsPopup__content_list{border-bottom:1px solid #f5f5f5}.controls-LongOperationsPopup__content_list .controls-LongOperationsList__nameColumn{height:24px!important;line-height:24px!important}.controls-LongOperationsPopup .controls-LongOperationsPopup__successCompletedOperation.controls-DataGridView__tr{background:#efffed}.controls-LongOperationsPopup .controls-LongOperationsPopup__errorCompletedOperation.controls-DataGridView__tr{background:#fbeeef}.controls-LongOperationsPopup__footer{height:32px;padding-right:24px;line-height:32px;background:#f3f3f3;text-align:center}.controls-LongOperationsPopup__footer_execTasks,.controls-LongOperationsPopup__footer_executeTime,.controls-LongOperationsPopup__footer_notification,.controls-LongOperationsPopup__footer_progress{font-size:12px;color:#999}.controls-LongOperationsPopup__footer_execTasks{margin-left:5px}.controls-LongOperationsPopup__footer_progress{color:#333}.controls-LongOperationsPopup__footer_progress{display:inline-block;width:30px;margin-left:5px;text-align:right}.controls-LongOperationsPopup__footer__actionsContainer{position:absolute;margin-right:8px;right:0}.controls-LongOperationsPopup__footer_pauseIcon,.controls-LongOperationsPopup__hideContentIcon{margin-top:8px;cursor:pointer}.controls-LongOperationsPopup__hideContentIcon:hover{color:#313e78!important}.controls-LongOperationsPopup__hiddenContentMode .controls-LongOperationsPopup__hideContentIcon{transform:rotate(180deg)}.controls-LongOperationsPopup__footer_pauseIcon{display:none}.controls-LongOperationsPopup__footer_firstOperationMode .controls-LongOperationsPopup__footer_pauseIcon{display:inline-block}.controls-LongOperationsPopup__footer_firstOperationMode .controls-LongOperationsPopup__hideContentIcon{display:none}"));head.appendChild(style);});}
define('SBIS3.CONTROLS/LongOperations/Popup',['Core/UserInfo','Core/core-merge','Core/Deferred','Core/EventBus','Lib/TabMessage/TabMessage','SBIS3.CONTROLS/NotificationPopup','SBIS3.CONTROLS/LongOperations/Entry','tmpl!SBIS3.CONTROLS/LongOperations/Popup/resources/headerTemplate','tmpl!SBIS3.CONTROLS/LongOperations/Popup/resources/contentTemplate','tmpl!SBIS3.CONTROLS/LongOperations/Popup/resources/footerTemplate','Lib/Control/FloatArea/FloatArea','css!SBIS3.CONTROLS/LongOperations/Popup/LongOperationsPopup','SBIS3.CONTROLS_localization'],function(t,o,e,n,i,s,a,r,p,l,c){'use strict';var d='not-suspended',u=rk('Пожалуйста, подождите\u2026'),_={download:'Скачать',open:'Открыть',viewLog:'Журнал'},g=s.extend({$protected:{_options:{userId:t.get('Пользователь'),isHint:false,headerTemplate:r,bodyTemplate:p,footerTemplate:l,caption:'',className:'controls-LongOperations controls-LongOperationsPopup controls-LongOperationsPopup__hidden controls-LongOperationsPopup__hiddenContentMode',customConditions:null,withAnimation:null,waitIndicatorText:null},_activeOperation:null,_firstOperationMode:false,_floatAreaMode:false,_longOpList:null,_notificationContainer:null,_progressContainer:null,_tabChannel:null,_loadingIndicator:null,_isInStartAnimation:null},$constructor:function(){this._publish('onSizeChange');},init:function(){g.superclass.init.call(this),this._longOpList=this.getChildControlByName('operationList');var t=this._options.customConditions;if(!t||!Array.isArray(t))throw new Error('customConditions required');if(this._longOpList.setCustomConditions(t),this._options.withAnimation)this.animationAtStart();var o=this.getContainer();this._notificationContainer=o.find('.controls-LongOperationsPopup__footer_notification'),this._progressContainer=o.find('.controls-LongOperationsPopup__footer_progress_container'),this._tabChannel=new i(),this._bindEvents(),this._longOpList.reload();},_bindEvents:function(){var t=this;this.subscribeTo(this,'onClose',function(){if(t.isVisible())t._tabChannel.notify('LongOperations:Popup:onClosed');}),this.subscribeTo(this._tabChannel,'LongOperations:Popup:onClosed',function(){if(!t._isDestroyed)t.close();}),['onlongoperationstarted','onlongoperationchanged','onlongoperationended','onlongoperationdeleted','onproducerregistered','onproducerunregistered'].forEach(function(o){t.subscribeTo(t._longOpList,o,function(e,n){t._onOperation(o,n);});});var o=this._longOpList.getView();this.subscribeTo(o,'onDrawItems',function(){var o=t._longOpList.getItems(),e=o?o.getCount():0;if(e){if(t._activeOperation=null,1===e)t._setFirstOperationMode(true),t._activeOperation=o.getRecordById(o.at(0).getId());else if(t._setFirstOperationMode(false),o.each(function(o,e){if(!t._activeOperation&&o.get('status')===a.STATUSES.running)return t._activeOperation=o,false;}),!t._activeOperation)t._activeOperation=o.getRecordById(o.at(0).getId());t._updateState();var n='controls-LongOperationsPopup__hidden',i=t.getContainer();if(i.hasClass(n))i.css('opacity',0),i.removeClass(n),i.animate({opacity:1},800);t._notify('onSizeChange');}else t.close();}),this.subscribeTo(o,'onItemActivate',function(o,e){t._longOpList.applyMainAction(e.item);}),this.subscribeTo(this.getChildControlByName('downloadButton'),'onActivated',function(){if(t._activeOperation)t._longOpList.applyMainAction(t._activeOperation);}),this.subscribeTo(this.getChildControlByName('registryOperationButton'),'onActivated',function(){t._showFloatArea({title:rk('Все операции'),template:'SBIS3.CONTROLS/LongOperations/Registry',componentOptions:{columns:{userPic:false},userId:t._options.userId}});});var e=this.getContainer();e.find('.controls-LongOperationsPopup__hideContentIcon').on('click',function(){t._toggleContent(),t._longOpList[t._isContentHidden()?'animationClear':'animationStart']();}),e.find('.controls-LongOperationsPopup__footer_pauseIcon').on('click',function(){t._longOpList.applyUserAction($(this).hasClass('icon-Pause')?'suspend':'resume',t._activeOperation);}),e.find('.controls-NotificationPopup__header').on('click','.controls-LongOperationsPopup__runOperationIcon',function(){t._longOpList.applyUserAction('resume',t._activeOperation);});var i=e.find('.controls-LongOperationsPopup__header_stoppedOperationsButton');i.on('click',function(){if(i.hasClass('controls-LongOperationsPopup__header_stoppedOperations-show'))t._longOpList.getLinkedContext().setValue('filter/status',d);else t._longOpList.getLinkedContext().setValue('filter',{});i.toggleClass('controls-LongOperationsPopup__header_stoppedOperations-show');}),this.subscribeTo(this._longOpList,'ontimespentchanged',function(){if(t._activeOperation)t._setFooterTimeSpent(t._activeOperation.get('shortTimeSpent'));}),this.subscribeTo(n.globalChannel(),'onwakeup',function(){if(!t.isDestroyed()&&t.isVisible())t._longOpList.reload();});},_showFloatArea:function(t){var e=this,n=new c(o({opener:e,direction:'left',animation:'slide',isStack:true,autoCloseOnHide:true,maxWidth:1000},t));e._toggleFloatAreaMode(true),e._notify('onSizeChange'),e.subscribeOnceTo(n,'onAfterClose',function(){e._toggleFloatAreaMode(false),e._notify('onSizeChange');});},_toggleFloatAreaMode:function(t){this._floatAreaMode=!!t,this.setVisible(!t);},reload:function(){return this._longOpList.reload();},setCaption:function(t){if(g.superclass.setCaption.call(this,t),'string'===typeof t)this.getContainer().find('.controls-NotificationPopup__header_caption').attr('title',t);},_setHeader:function(t,o,e){this.setCaption(t),this.setStatus(o),this.setIcon(e);var n=this._getResultButtonCaption(this._activeOperation),i=!!n,s=this.getChildControlByName('downloadButton');if(s.setVisible(i),i)s.setCaption(rk(n));},_getResultButtonCaption:function(t){if(t){var o=this._longOpList.describeMainAction(t);if(o)switch(o.type){case'result':return t.get('resultWayOfUse')||_[t.get('resultHandler')?'open':'download'];case'history':return _.viewLog;case'custom':return o.title;}}},_updateState:function(){var t=this._activeOperation;if(t){var o=a.STATUSES,e=t.get('title'),n=this.getContainer().find('.controls-LongOperationsPopup__footer_pauseIcon'),i=t.get('status');switch(i){case o.running:if(this._setHeader(e,'default','icon-size icon-24 controls-LongOperationsPopup__header_icon-customIcon'),t.get('canSuspend'))n.removeClass('ws-hidden').addClass('icon-Pause').removeClass('icon-DayForward');else n.addClass('ws-hidden');break;case o.suspended:if(this._setHeader(e,'default','icon-size icon-24 icon-DayForward icon-primary controls-LongOperationsPopup__runOperationIcon'),t.get('canSuspend'))n.removeClass('ws-hidden').removeClass('icon-Pause').addClass('icon-DayForward');else n.addClass('ws-hidden');break;case o.ended:var s=!t.get('isFailed');this._setHeader(e,s?'success':'error',s?'icon-size icon-24 icon-Yes icon-done':'icon-size icon-24 icon-Alert icon-error'),n.addClass('ws-hidden');}var r=t.get('notification');if(r)this._setNotification(r);else this._setProgress(t.get('progressCurrent'),t.get('progressTotal'),i===o.ended);this._setFooterTimeSpent(t.get('shortTimeSpent'));}},_isContentHidden:function(){return this.getContainer().hasClass('controls-LongOperationsPopup__hiddenContentMode');},_toggleContent:function(t){this.getContainer().toggleClass('controls-LongOperationsPopup__hiddenContentMode',void 0===t?void 0:!t),this._notify('onSizeChange');},_setFirstOperationMode:function(t){if(t!==this._isFirstOperationMode()){if(t)this._toggleContent(false);this._toggleFirstOperationMode();}},_isFirstOperationMode:function(){return this.getContainer().find('.controls-LongOperationsPopup__footer').hasClass('controls-LongOperationsPopup__footer_firstOperationMode');},_toggleFirstOperationMode:function(){this.getContainer().find('.controls-LongOperationsPopup__footer').toggleClass('controls-LongOperationsPopup__footer_firstOperationMode');},_setProgress:function(t,o,e){if(this._notificationContainer.addClass('ws-hidden'),this._progressContainer.removeClass('ws-hidden'),!(0<o))o=1,t=e?1:0<t?1:0;var n=1!==o,i=this.getContainer().find('.controls-LongOperationsPopup__footer_execTasks');if(i[n?'removeClass':'addClass']('ws-hidden'),n)i.text(Math.floor(t)+' '+(100<=o?'/':rk('из'))+' '+o+' '+rk('операций'));this.getContainer().find('.controls-LongOperationsPopup__footer_progress').text(Math.floor(100*t/o)+'%');},_setNotification:function(t){this._progressContainer.addClass('ws-hidden'),this._notificationContainer.text(t).removeClass('ws-hidden');},_setFooterTimeSpent:function(t){this.getContainer().find('.controls-LongOperationsPopup__footer_executeTime').text(t);},_onOperation:function(t,o){switch(t){case'onlongoperationstarted':this._setProgress(0,o.progress?o.progress.total:1,false);break;case'onlongoperationchanged':var e=this._activeOperation,n=this._longOpList;switch(o.changed){case'status':switch(o.status){case a.STATUSES.running:this._setProgress(o.progress?o.progress.value:0,o.progress?o.progress.total:1,false);case a.STATUSES.suspended:}break;case'progress':if(e&&e===n.lookupItem(o))this._setProgress(o.progress.value,o.progress.total,false);break;case'notification':if(o.notification&&e&&e===n.lookupItem(o))this._setNotification(o.notification);}break;case'onlongoperationended':this._setProgress(o.progress?o.progress.value:1,o.progress?o.progress.total:1,true);var i=this._longOpList.lookupItem(o);if(i)this._activeOperation=i,this._updateState();}},animationAtStart:function(t){var o=600,n=800,i=600;if(this._isInStartAnimation)return;this._isInStartAnimation=true;var s=this,a=t||this._options.waitIndicatorText||u,r=new e();if(!this._loadingIndicator)require(['Deprecated/Controls/LoadingIndicator/LoadingIndicator'],function(t){s._loadingIndicator=new t({message:a}),s._loadingIndicator.show(),r.callback();});else this._loadingIndicator.setMessage(a),this._loadingIndicator.show(),r.callback();r.addCallback(function(){setTimeout(function(){if(!s.isDestroyed()&&s.isVisible()&&!s._floatAreaMode){var t=function(t,o,e){var a=t.offset();e.clone().appendTo('body').css({position:'absolute','z-index':o,top:e.offset().top,left:e.offset().left}).animate({top:a.top-4,left:a.left-4},n,function(){$(this).remove(),s._isInStartAnimation=null,t.animate({opacity:0},i/2,function(){t.animate({opacity:1},i/2);});});},o=s.getContainer();t(o.find('.controls-NotificationPopup__header_icon'),+o.css('z-index')+1,s._loadingIndicator.getWindow().getContainer().find('.ws-loadingimg'));}var e=+s._loadingIndicator.getWindow().getContainer().closest('.ws-LoadingIndicator__window').css('z-index');s._loadingIndicator.close(),s._loadingIndicator=null,require('Core/WindowManager').releaseZIndex(e),s.moveToTop();},o);});},destroy:function(){this._tabChannel.destroy(),this._tabChannel=null;var t=this.getContainer();['.controls-NotificationPopup__header_caption','.controls-LongOperationsPopup__hideContentIcon','.controls-LongOperationsPopup__footer_pauseIcon','.controls-NotificationPopup__header','.controls-LongOperationsPopup__header_stoppedOperationsButton'].forEach(function(o){t.find(o).off('click');}),g.superclass.destroy.call(this);}});return g.resizable=false,g;});
define("tmpl!SBIS3.CONTROLS/LongOperations/Registry/resources/groupTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,a,l,s,i){function n(){}var c=0,u=void 0!==t&&t?t:arguments[arguments.length-1];void 0===u&&(eval("var thelpers = null;"),u=global.requirejs("View/Runner/tclosure"));var p={};i&&i.isSetts&&(p=i.fullContext||{});var g="string"==typeof l?l:"",d=void 0===r?void 0:r,v={id:[],def:void 0},T=u.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),m=this&&this.includedTemplates?this.includedTemplates:{},h=u.getMarkupGenerator(s);try{var O=h.joinElements([h.createTag("div",{class:"controls-LongOperationsList__groupTpl_td"},[h.createTag("div",{class:"controls-LongOperationsList__groupTpl_title"},[void(m.ValueTpl=function(e,t){this&&this.includedTemplates&&this.includedTemplates;var r=u.getMarkupGenerator(s);try{var o=r.joinElements([0===u.getter(e,["value"])?[r.createText(" "+global.rk("В процессе")+" ")]:1===u.getter(e,["value"])?[r.createText(" "+global.rk("Приостановленные")+" ")]:[r.createText(" "+global.rk("Завершенные")+" ")]],g,v);v.def&&(o=r.chain(o,v,t),v=void 0)}catch(t){u.templateError("resources/SBIS3.CONTROLS/LongOperations/Registry/resources/groupTpl.tmpl",t,e)}return o||""}.bind({includedTemplates:m})),function(e,t){u.prepareAttrsForFocus(t,e,"0");this&&this.includedTemplates&&this.includedTemplates;var r=u.getMarkupGenerator(s);try{var o=r.joinElements([0===u.getter(e,["value"])?[r.createText(" "+global.rk("В процессе")+" ")]:1===u.getter(e,["value"])?[r.createText(" "+global.rk("Приостановленные")+" ")]:[r.createText(" "+global.rk("Завершенные")+" ")]],g,v);v.def&&(o=r.chain(o,v,t),v=void 0)}catch(t){u.templateError("resources/SBIS3.CONTROLS/LongOperations/Registry/resources/groupTpl.tmpl",t,e)}return o||""}(u.calculateScope({value:u.getter(o,["item","get"]).apply(u.getter(o,["item"]),["status"])},u.plainMerge),{})],{},v,this),h.createTag("div",{class:"controls-LongOperationsList__groupTpl_separator"},[],{},v,this)],a,v,this)],g,v);v.def&&(O=h.chain(O,v,a),v=void 0)}catch(e){u.templateError("resources/SBIS3.CONTROLS/LongOperations/Registry/resources/groupTpl.tmpl",e,o)}return O||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/Registry/resources/groupTpl"}},o});
define("tmpl!SBIS3.CONTROLS/LongOperations/Registry/resources/emptyHTMLTpl",["Core/tmpl/js/tclosure"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={},o=function e(o,i,n,s,l){function a(){}var c=0,p=void 0!==t&&t?t:arguments[arguments.length-1];void 0===p&&(eval("var thelpers = null;"),p=global.requirejs("View/Runner/tclosure"));var u={};l&&l.isSetts&&(u=l.fullContext||{});var d="string"==typeof n?n:"",v=void 0===r?void 0:r,m={id:[],def:void 0},T=p.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),g=this&&this.includedTemplates?this.includedTemplates:{},y=p.getMarkupGenerator(s);try{var f=y.joinElements([y.createTag("div",{class:"controls-LongOperationsList__emptyHTMLTpl_title"},[y.createText(""+global.rk("Нет записей"))],i,m,this)],d,m);m.def&&(f=y.chain(f,m,i),m=void 0)}catch(e){p.templateError("resources/SBIS3.CONTROLS/LongOperations/Registry/resources/emptyHTMLTpl.tmpl",e,o)}return f||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/Registry/resources/emptyHTMLTpl"}},o});
define("tmpl!SBIS3.CONTROLS/LongOperations/Registry/LongOperationsRegistry",["Core/tmpl/js/tclosure","js!SBIS3.CONTROLS/Browser","js!SBIS3.CONTROLS/SearchForm","js!SBIS3.CONTROLS/Filter/Button","js!SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter","js!SBIS3.CONTROLS/Filter/FastData","js!SBIS3.CONTROLS/LongOperations/List"],function(){var e=Array.prototype.slice.call(arguments),t=e[0],r={};r["js!SBIS3.CONTROLS/Browser"]=e[1],r["js!SBIS3.CONTROLS/SearchForm"]=e[2],r["js!SBIS3.CONTROLS/Filter/Button"]=e[3],r["js!SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter"]=e[4],r["js!SBIS3.CONTROLS/Filter/FastData"]=e[5],r["js!SBIS3.CONTROLS/LongOperations/List"]=e[6];var o=function e(o,i,a,n,l){function s(){}var u=0,c=void 0!==t&&t?t:arguments[arguments.length-1];void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure"));var d={};l&&l.isSetts&&(d=l.fullContext||{});var p="string"==typeof a?a:"",g=void 0===r?void 0:r,v={id:[],def:void 0},S=c.configResolver.calcParent(this,"undefined"==typeof currentPropertyName?void 0:currentPropertyName,o),f=this&&this.includedTemplates?this.includedTemplates:{},m=c.getMarkupGenerator(n);try{var O=m.joinElements([m.createTag("div",{class:"controls-LongOperations controls-LongOperationsRegistry"},[m.createControl("wsControl","ws:SBIS3.CONTROLS/Browser",{content:c.createDataArray([(new function(){var e=Object.create(o),t=function e(t,r,o,i,a){if(void 0===o)var o=arguments[2];var n=0,l="content";if(void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure")),a&&a.isSetts)var s=a.fullContext||{};t=c.isolateScope(Object.create(this),t,l);var u="string"==typeof o?o:"",d={id:[],def:void 0},p=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(i);try{var f=v.joinElements([v.createTag("div",{class:"controls-Browser__table controls-LongOperationsRegistry__table controls-Browser__table-fullFilterBlock controls-LongOperationsRegistry__table-fullFilterBlock"},[v.createTag("div",{class:"controls-Browser__tableCell-search controls-LongOperationsRegistry__tableCell-search"},[v.createControl("wsControl","ws:SBIS3.CONTROLS/SearchForm",{tabindex:"2",name:"browserSearch",allowChangeEnable:!1,placeholder:global.rk("искать@@найти..."),className:"controls-Browser__search controls-LongOperationsRegistry__search ws-bootup-autofocus"},{name:"browserSearch",sbisname:"browserSearch"},{data:t,ctx:this,pName:void 0!==l?l:void 0,viewController:S},o,g,p,c.config,s)],{},d,this),v.createTag("div",{class:"controls-Browser__tableRow controls-LongOperationsRegistry__tableRow"},[v.createTag("div",{class:"controls-Browser__tableCell-filterButton controls-LongOperationsRegistry__tableCell-filterButton"},[v.createControl("wsControl","ws:SBIS3.CONTROLS/Filter/Button",{filterStructure:[{internalValueField:"StateKey",internalCaptionField:"StateTitle",value:void 0,resetValue:null,itemTemplate:null},{internalValueField:"PeriodKey",internalCaptionField:"PeriodTitle",value:void 0,resetValue:null},{internalValueField:"DurationKey",internalCaptionField:"DurationTitle",value:void 0,resetValue:null},{internalValueField:"UserId",internalCaptionField:"UserName",value:void 0,resetValue:c.getter(t,["userId"])?c.getter(t,["userId"]):null,visibilityValue:!c.getter(t,["userId"]),itemTemplate:c.getter(t,["userId"])?"":void 0}],template:c.createDataArray([(new function(){var e=Object.create(t),r=function e(t,r,o,i,a){if(void 0===o)var o=arguments[2];var n=0,l="template";if(void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure")),a&&a.isSetts)var s=a.fullContext||{};t=c.isolateScope(Object.create(this),t,l);var u="string"==typeof o?o:"",d={id:[],def:void 0},p=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(i);try{var f=v.joinElements([v.createControl("wsControl","ws:SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter",{hideStaffFilter:c.getter(t,["hideStaffFilter"])},c.plainMerge(r,{}),{data:t,ctx:this,pName:void 0!==l?l:void 0,viewController:S},o,g,p,c.config,s)],u,d);d.def&&(f=v.chain(f,d,r),d=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/Registry/LongOperationsRegistry.tmpl",e,t)}return f||""};this.func=c.makeFunctionSerializable(r,e)}).func]),name:"browserFilterButton",className:"controls-Browser__filterButton controls-LongOperationsRegistry__filterButton",tabindex:"0",esc:!1,bindings:[{fieldName:"filter/status",propName:"filterStructure/0/value",propPath:["0","value"],fullPropName:"filterStructure/0/value",propPathStr:"0/value",oneWay:!1,direction:"fromContext",bindNonExistent:!1},{fieldName:"filter/period",propName:"filterStructure/1/value",propPath:["1","value"],fullPropName:"filterStructure/1/value",propPathStr:"1/value",oneWay:!1,direction:"fromContext",bindNonExistent:!1},{fieldName:"filter/duration",propName:"filterStructure/2/value",propPath:["2","value"],fullPropName:"filterStructure/2/value",propPathStr:"2/value",oneWay:!1,direction:"fromContext",bindNonExistent:!1},{fieldName:"filter/UserId",propName:"filterStructure/3/value",propPath:["3","value"],fullPropName:"filterStructure/3/value",propPathStr:"3/value",oneWay:!1,direction:"fromContext",bindNonExistent:!1}]},{name:"browserFilterButton",sbisname:"browserFilterButton"},{data:t,ctx:this,pName:void 0!==l?l:void 0,viewController:S,internal:{__dirtyCheckingVars_4:c.getter(t,["userId"])?c.getter(t,["userId"]):null,__dirtyCheckingVars_5:!c.getter(t,["userId"]),__dirtyCheckingVars_6:c.getter(t,["userId"])?"":void 0,__dirtyCheckingVars_7:c.getter(t,["hideStaffFilter"])}},o,g,p,c.config,s)],{},d,this),v.createTag("div",{class:"controls-Browser__tableCell-fastDataFilter controls-LongOperationsRegistry__tableCell-fastDataFilter"},[v.createControl("wsControl","ws:SBIS3.CONTROLS/Filter/FastData",{items:[{idProperty:"key",displayProperty:"title",parentProperty:"parent",multiselect:!1,values:[{key:null,title:global.rk.apply(t,["В любом состоянии"])},{key:"running",title:global.rk.apply(t,["В процессе"])},{key:"ended",title:global.rk.apply(t,["Завершенные"])},{key:"success-ended",title:global.rk.apply(t,["Успешно"]),parent:"ended"},{key:"error-ended",title:global.rk.apply(t,["С ошибками"]),parent:"ended"},{key:"suspended",title:global.rk.apply(t,["Приостановленные"])}]}],filterStructure:[{internalValueField:"key",internalCaptionField:"title",value:void 0}],name:"browserFastDataFilter",className:"controls-Browser__fastDataFilter controls-LongOperationsRegistry__fastDataFilter",tabindex:"0",esc:!1,bindings:[{fieldName:"filter/status",propName:"filterStructure/0/value",propPath:["0","value"],fullPropName:"filterStructure/0/value",propPathStr:"0/value",oneWay:!1,direction:"fromContext",bindNonExistent:!1}]},{name:"browserFastDataFilter",sbisname:"browserFastDataFilter"},{data:t,ctx:this,pName:void 0!==l?l:void 0,viewController:S},o,g,p,c.config,s)],{},d,this)],{},d,this)],r,d,this)],u,d);d.def&&(f=v.chain(f,d,r),d=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/Registry/LongOperationsRegistry.tmpl",e,t)}return f||""};this.func=c.makeFunctionSerializable(t,e)}).func,(new function(){var e=Object.create(o),t=function e(t,r,o,i,a){if(void 0===o)var o=arguments[2];var n=0,l="content";if(void 0===c&&(eval("var thelpers = null;"),c=global.requirejs("View/Runner/tclosure")),a&&a.isSetts)var s=a.fullContext||{};t=c.isolateScope(Object.create(this),t,l);var u="string"==typeof o?o:"",d={id:[],def:void 0},p=this&&this.includedTemplates?this.includedTemplates:{},v=c.getMarkupGenerator(i);try{var f=v.joinElements([v.createTag("div",{class:"controls-Browser__view controls-LongOperationsRegistry__view"},[v.createControl("wsControl","ws:SBIS3.CONTROLS/LongOperations/List",{name:"operationList",columns:c.getter(t,["columns"]),userId:c.getter(t,["userId"]),narrowTmpl:!1,useGroupByEasyGroup:c.getter(t,["useGroupByEasyGroup"])},{name:"operationList",sbisname:"operationList"},{data:t,ctx:this,pName:void 0!==l?l:void 0,viewController:S},o,g,p,c.config,s)],r,d,this)],u,d);d.def&&(f=v.chain(f,d,r),d=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/Registry/LongOperationsRegistry.tmpl",e,t)}return f||""};this.func=c.makeFunctionSerializable(t,e)}).func]),name:"longOperationsBrowser",className:"controls-Browser__view controls-LongOperationsRegistry__view",esc:!1},{name:"longOperationsBrowser",sbisname:"longOperationsBrowser"},{data:o,ctx:this,pName:"undefined"!=typeof currentPropertyName?currentPropertyName:void 0,viewController:S,internal:{__dirtyCheckingVars_6:c.getter(o,["userId"])?c.getter(o,["userId"]):null,__dirtyCheckingVars_7:!c.getter(o,["userId"]),__dirtyCheckingVars_8:c.getter(o,["userId"])?"":void 0,__dirtyCheckingVars_9:c.getter(o,["hideStaffFilter"]),__dirtyCheckingVars_12:c.getter(o,["columns"]),__dirtyCheckingVars_13:c.getter(o,["userId"]),__dirtyCheckingVars_15:c.getter(o,["useGroupByEasyGroup"])}},a,g,f,c.config,d)],i,v,this)],p,v);v.def&&(O=m.chain(O,v,i),v=void 0)}catch(e){c.templateError("resources/SBIS3.CONTROLS/LongOperations/Registry/LongOperationsRegistry.tmpl",e,o)}return O||""};return o.includedFunctions={},o.stable=!0,o.toJSON=function(){return{$serialized$:"func",module:"tmpl!SBIS3.CONTROLS/LongOperations/Registry/LongOperationsRegistry"}},o});
if(typeof window !== "undefined" && window.atob && document.cookie.indexOf("thmname") === -1){define("css!SBIS3.CONTROLS/LongOperations/Registry/LongOperationsRegistry", function() {var style = document.createElement("style"),head = document.head || document.getElementsByTagName("head")[0];style.type = "text/css";style.appendChild(document.createTextNode(".controls-LongOperationsRegistry .controls-LongOperationsRegistry__search{width:200px}.controls-LongOperationsRegistry .controls-ListView__EmptyData{padding-top:0}.controls-LongOperationsList__emptyHTMLTpl_title{margin-top:8px}.controls-LongOperationsRegistry .controls-Browser,.controls-LongOperationsRegistry .controls-Browser .controls-LongOperationsRegistry__view{min-height:0;height:100%;clear:both;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column}.controls-LongOperationsRegistry .controls-Browser .controls-LongOperationsRegistry__table{-webkit-flex-shrink:0;-ms-flex-negative:0;-ms-flex-shrink:0;flex-shrink:0}.ws-is-old-webkit .controls-LongOperationsRegistry .controls-Browser,.ws-is-old-webkit .controls-LongOperationsRegistry .controls-Browser .controls-LongOperationsRegistry__view{-webkit-flex-basis:0;-ms-flex-preferred-size:0;-ms-flex-basis:0;flex-basis:0;-webkit-flex-grow:1;-ms-flex-positive:1;-ms-flex-grow:1;flex-grow:1}.ws-is-ie .controls-LongOperationsRegistry .controls-Browser,.ws-is-ie .controls-LongOperationsRegistry .controls-Browser .controls-LongOperationsRegistry__view{-webkit-flex-shrink:1;-ms-flex-negative:1;-ms-flex-shrink:1;flex-shrink:1}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__table{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__tableRow{height:auto;display:inline-flex;display:-ms-flexbox;display:-ms-inline-flexbox;display:-webkit-inline-flex;-webkit-justify-content:flex-end;-ms-justify-content:flex-end;justify-content:flex-end;-ms-flex-pack:end;white-space:nowrap;overflow:hidden;width:100%;-webkit-flex-shrink:1;-ms-flex-negative:1;-ms-flex-shrink:1;flex-shrink:1}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__search{margin:8px 0 8px 8px;width:335px;display:block}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__tableCell-search{display:inline-flex;display:-ms-flexbox;display:-ms-inline-flexbox;display:-webkit-inline-flex;-webkit-flex-shrink:0;-ms-flex-negative:0;-ms-flex-shrink:0;flex-shrink:0}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__table .controls-LongOperationsRegistry__tableCell-fastDataFilter{-webkit-box-ordinal-group:2;-moz-box-ordinal-group:2;-ms-flex-order:2;-webkit-order:2;order:2;overflow:hidden;min-width:30px;max-width:100%;margin-right:8px}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__table.controls-LongOperationsRegistry__table-fullFilterBlock .controls-LongOperationsRegistry__tableCell-fastDataFilter{margin-right:4px}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__table .controls-LongOperationsRegistry__fastDataFilter{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-justify-content:flex-start;justify-content:flex-start;-ms-flex-pack:start;-webkit-flex-shrink:1;-ms-flex-negative:1;-ms-flex-shrink:1;flex-shrink:1}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__fastDataFilter .controls-DropdownList{margin-top:10px;overflow:hidden}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__tableCell-filterButton{max-width:100%}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__table.controls-LongOperationsRegistry__table-fullFilterBlock .controls-LongOperationsRegistry__tableCell-filterButton{width:auto;overflow:hidden;-webkit-box-ordinal-group:3;-moz-box-ordinal-group:3;-ms-flex-order:3;-webkit-order:3;order:3;max-width:100%}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__tableCell-filterButton .controls-LongOperationsRegistry__filterButton{max-width:100%;float:right;margin:2px 0}.controls-LongOperationsRegistry .controls-LongOperationsRegistry__filterButton .controls__filterButton__filterLine-text{height:19px}.controls-LongOperationsRegistry .ws-sticky-header__block.ws-sticky-header__fixed.controls-LongOperationsRegistry__table{z-index:3}.controls-LongOperationsRegistry .controls-LongOperationsList .controls-ItemActions .controls-ItemActions__itemsContainer .controls-ItemActions__item .controls-ItemActions__icon{margin-bottom:3px}"));head.appendChild(style);});}
define('SBIS3.CONTROLS/LongOperations/Registry',['Lib/Control/CompoundControl/CompoundControl','Core/RightsManager','tmpl!SBIS3.CONTROLS/LongOperations/Registry/resources/groupTpl','tmpl!SBIS3.CONTROLS/LongOperations/Registry/resources/emptyHTMLTpl','tmpl!SBIS3.CONTROLS/LongOperations/Registry/LongOperationsRegistry','css!SBIS3.CONTROLS/LongOperations/Registry/LongOperationsRegistry','SBIS3.CONTROLS/Action/List/OpenEditDialog','SBIS3.CONTROLS/Browser','SBIS3.CONTROLS/SearchForm','SBIS3.CONTROLS/Filter/Button','SBIS3.CONTROLS/Filter/FastData','SBIS3.CONTROLS/LongOperations/List','SBIS3.CONTROLS/LongOperations/Registry/resources/LongOperationsFilter','SBIS3.CONTROLS_localization'],function(t,e,s,i,n){'use strict';var o={null:rk('В любом состоянии'),running:rk('В процессе'),suspended:rk('Приостановленные'),ended:rk('Завершенные'),'success-ended':rk('Успешно'),'error-ended':rk('С ошибками')},r=t.extend({_dotTplFn:n,$protected:{_options:{className:'',userId:null,useGroupByEasyGroup:true},_longOpList:null,_previousGroupBy:null},$constructor:function(){var t=this.getLinkedContext();if(t.setValue('filter',{status:null,period:null,duration:null}),'userId'in this._options)t.setValue('filter/UserId',this._options.userId);},init:function(){r.superclass.init.call(this);var t=this;this._longOpList=this.getChildControlByName('operationList'),this._longOpList.getView().setGroupBy({field:'status',contentTemplate:s}),this._bindEvents(),this._longOpList.reload();},_modifyOptions:function(){var t=r.superclass._modifyOptions.apply(this,arguments);return t.hideStaffFilter=!!t.userId||!(e.getRights(['Long_requests_config'])['Long_requests_config']&e.ADMIN_MASK),t;},_bindEvents:function(){var t=this,e=this.getChildControlByName('longOperationsBrowser'),s=this._longOpList.getView();this.subscribeTo(e,'onEdit',function(e,s){t._longOpList.applyMainAction(s.item);}),this.subscribeTo(s,'onDataLoad',function(e,n){t._previousGroupBy=null;var r=t._longOpList.getLinkedContext().getValue('filter/status');s.setEmptyHTML(i({title:o[void 0===r?null:r]}));});}});return r;});
define('SBIS3.CONTROLS/LongOperations/Tools/Bunch',['Core/core-extend','Core/core-merge','SBIS3.CONTROLS_localization'],function(e,r){'use strict';var t=e.extend({_moduleName:'SBIS3.CONTROLS/LongOperations/Tools/Bunch',constructor:function e(){this._keys={},this._values={},this._counter=0;},set:function(e,t){var n=this.getId(e)||++this._counter;return this._keys[n]=r({},e,{clone:true}),this._values[n]=t,n;},get:function(e){var r=this.getId(e);return r?this._values[r]:void 0;},getId:function(e){if(!e||'object'!==typeof e)throw new TypeError('Argument "key" must be an object');for(var r in this._keys)if(u(this._keys[r],e))return+r;},getById:function(e){if('number'!==typeof e||e<=0)throw new TypeError('Argument "id" must be positive number');return this._values[e];},list:function(e){if(!Array.isArray(e))throw new TypeError('Argument "keys" must be an array');return e.map(this.get.bind(this));},listIds:function(e){if(!Array.isArray(e))throw new TypeError('Argument "keys" must be an array');return e.map(this.getId.bind(this));},listByIds:function(e){if(!Array.isArray(e))throw new TypeError('Argument "ids" must be an array');return e.map(this.getById.bind(this));},search:function(e,r){return i(this,e,r,false);},searchIds:function(e){if(e&&'object'!==typeof e)throw new TypeError('Argument "pattern" must be an object');var r=[],t=!e;for(var n in this._keys)if(t||s(this._keys[n],e))r.push(+n);return r;},remove:function(e){var r=this.getId(e);if(r)return n(this,r);},removeById:function(e){if('number'!==typeof e||e<=0)throw new TypeError('Argument "id" must be positive number');if(e in this._keys)return n(this,e);},removeAll:function(e,r){return i(this,e,r,true);}}),n=function(e,r){var t=e._values[r];return delete e._keys[r],delete e._values[r],t;},i=function(e,r,t,n){if(r&&'object'!==typeof r)throw new TypeError('Argument "pattern" must be an object');if(n&&'boolean'!==typeof n)throw new TypeError('Argument "andRemove" must be a boolean');if(t&&!(Array.isArray(t)&&t.every(function(e){return'number'===typeof e&&0<e;})))throw new TypeError('Argument "inIds" must be an array of numbers');var i=[],u=!r,o=!t;for(var a in e._keys)if((o||-1!==t.indexOf(+a))&&(u||s(e._keys[a],r)))if(i.push(e._values[a]),n)delete e._keys[a],delete e._values[a];return i;},s=function(e,r){if(!e||'object'!==typeof e)return false;for(var t in r){if(!(t in e))return false;var n=e[t],i=r[t];if(i&&'object'===typeof i?!s(n,i):!u(n,i))return false;}return true;},u=function(e,r){if(null==e&&null==r)return true;if(!(e&&'object'===typeof e&&r&&'object'===typeof r))return e===r;if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return false;for(var t=0;t<e.length;t++)if(!u(e[t],r[t]))return false;}else{if(Array.isArray(r))return false;var n=Object.keys(e);if(n.length!=Object.keys(r).length)return false;for(var t=0;t<n.length;t++){var i=n[t];if(!u(e[i],r[i]))return false;}}return true;};return t;});
define('SBIS3.CONTROLS/LongOperations/Tools/CallsPool',['Core/core-extend','Core/Deferred','SBIS3.CONTROLS_localization'],function(r,e){'use strict';var t=r.extend({_moduleName:'SBIS3.CONTROLS/LongOperations/Tools/CallsPool',constructor:function(r,e,t){if(!r||!Array.isArray(r)||!r.length||r.some(function(r){return'string'!==typeof r;}))throw new TypeError('Argument "fields" must be string array');if('function'!==typeof e)throw new TypeError('Argument "handlePartial" must be a function');if('function'!==typeof t)throw new TypeError('Argument "handleComplete" must be a function');this._fields=r,this._handlePartial=e,this._handleComplete=t,this._calls={},this._outputs={},this._counter=0;},addList:function(r,e,t){if(!Array.isArray(e))throw new TypeError('Argument "members" must be an array');if(!Array.isArray(t))throw new TypeError('Argument "promises" must be an array');if(e.length!==t.length)throw new TypeError('Not equals array sizes');for(var n=l(this,r,true),i=0;i<e.length;i++)o(this,n,e[i],t[i]);},add:function(r,e,t){if(!r||'object'!==typeof r)throw new TypeError('Argument "pool" must be an object');o(this,l(this,r,true),e,t);},replace:function(r,e,t){if(!r||'object'!==typeof r)throw new TypeError('Argument "pool" must be an object');var n=l(this,r);if(!n)throw new TypeError('Pool not found');o(this,n,e,t,true);},getResult:function(r,t){if(!r||'object'!==typeof r)throw new TypeError('Argument "pool" must be an object');if(t&&'boolean'!==typeof t)throw new TypeError('Argument "dontSkip" must be boolean if present');var o=l(this,r);if(!o)throw new Error('Pool not found');var n=new e();if(!(o in this._outputs))this._outputs[o]=[];return this._outputs[o].push({promise:n,dontSkip:!!t}),f(this,o),n;},has:function(r){if(!r||'object'!==typeof r)throw new TypeError('Argument "pool" must be an object');var e=l(this,r);return!!e&&n(this,e);},remove:function(r,e){if(r&&'object'!==typeof r)throw new TypeError('Argument "pool" must be an object or null');if(e&&'object'!==typeof e)throw new TypeError('Argument "member" must be an object or null');var t;if(r)if(t=l(this,r),!t)throw new TypeError('Pool not found');i(this,t,e);},listPools:function(r,e){if(r&&'object'!==typeof r)throw new TypeError('Argument "member" must be an object or null');if(e&&'boolean'!==typeof e)throw new TypeError('Argument "completedOnly" must be boolean or null');var t=[],o=this._fields;for(var n in this._calls)if(!r||this._calls[n].list.some(function(t){return h(t.member,o,r)&&(!e||!t.promise);}))t.push(this._calls[n].pool);return t;}}),o=function(r,t,o,i,l){if(!(i instanceof e))throw new TypeError('Argument "promise" must be a Deferred');if(!(o&&'object'===typeof o&&r._fields.every(function(r){return r in o;})))throw new TypeError('Argument "member" must be an object and have specified fields');var f=r._fields.reduce(function(r,e){return r[e]=o[e],r;},{}),u;if(!l){if(n(r,t,f))throw new Error('Already exists');u={member:f,promise:i},r._calls[t].list.push(u);}else{for(var a=r._calls[t].list,h=0;h<a.length;h++){var m=a[h];if(p(m.member,f)){var y=m.promise;m.promise=i,c(y),u=m;break;}}if(!u)throw new Error('Not found');}i.addBoth(s.bind(null,r,t,u,i));},n=function(r,e,t){var o=r._calls[e];if(o)if(t)for(var n=0;n<o.list.length;n++){var i=o.list[n];if(h(i.member,r._fields,t))return true;}else return true;return false;},i=function(r,e,t){for(var o=0,n=e?[e]:Object.keys(r._calls);o<n.length;o++){for(var i=n[o],l=r._calls[i].list,s=l.length-1;0<=s;s--){var u=l[s];if(!t||h(u.member,r._fields,t))l.splice(s,1),c(u.promise);}if(!l.length)delete r._calls[i];}f(r,e);},l=function(r,e,t){for(var o in r._calls)if(p(r._calls[o].pool,e))return o;if(t){var o=++r._counter;return r._calls[o]={pool:e,list:[]},o;}},s=function(r,e,t,o,n){if(t.promise===o){if(delete t.promise,n instanceof Error)t.error=n;else{var i=r._calls[e];if(i)try{t.result=r._handlePartial(i.pool,t.member,n);}catch(r){t.error=r;}else t.error=new Error('Pool not found');}f(r,e);}},f=function(r,e){for(var t=0,o=e?[e]:Object.keys(r._calls);t<o.length;t++){var n=o[t];if(u(r,n))a(r,n);}},u=function(r,e){if(!(r._outputs[e]&&r._outputs[e].length))return false;var t=r._calls[e];if(!(t&&t.list.length))return false;for(var o=0;o<t.list.length;o++)if(t.list[o].promise)return false;return true;},a=function(r,e){var t=r._calls[e],o=r._outputs[e];if(!t||!t.list.length||!o||!o.length)return;delete r._calls[e],delete r._outputs[e];for(var n,i=0;i<t.list.length;i++){var l=t.list[i];if(!l.error&&l.result){if(!n)n=[];n.push(l.result);}}n=r._handleComplete(t.pool,n);for(var i=0;i<o.length;i++){var s=o[i];if(s.dontSkip||i===o.length-1)s.promise.callback(n);else if(!s.promise.isReady())s.promise.errback(new Error('Call is outdated'));}},c=function(r){if(r&&r.cancel&&!r.isReady());},h=function(r,e,t){for(var o=0;o<e.length;o++){var n=e[o];if(n in t&&t[n]!==r[n])return false;}return true;},p=function(r,e){if(null==r&&null==e)return true;if(!(r&&'object'===typeof r&&e&&'object'===typeof e))return r===e;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return false;for(var t=0;t<r.length;t++)if(!p(r[t],e[t]))return false;}else{if(Array.isArray(e))return false;var o=Object.keys(r);if(o.length!=Object.keys(e).length)return false;for(var t=0;t<o.length;t++){var n=o[t];if(!p(r[n],e[n]))return false;}}return true;};return t;});
define('SBIS3.CONTROLS/LongOperations/Tools/TabCalls',['Core/core-extend','Core/Deferred','Lib/TabMessage/TabMessage','WS.Data/Source/DataSet','WS.Data/Collection/RecordSet','WS.Data/Chain','SBIS3.CONTROLS_localization'],function(t,r,e,n,s,o){'use strict';var a=t.extend({_moduleName:'SBIS3.CONTROLS/LongOperations/Tools/TabCalls',constructor:function(t,r,n,s){if(!t||'string'!==typeof t)throw new TypeError('Argument "tabKey" must be a string');if('function'!==typeof r)throw new TypeError('Argument "router" must be a function');if(n&&'function'!==typeof n)throw new TypeError('Argument "packer" must be a function');if(s&&!(s instanceof e))throw new TypeError('Argument "channel" must be a TabMessage');this._tabKey=t,this._router=r,this._packer=n||null,this._channel=s?s:new e(),this._list=[],this._isDestroyed=false,this._channel.subscribe('LongOperations:TabCalls:onCall',this._onCall_b=this.onCall.bind(this)),this._channel.subscribe('LongOperations:TabCalls:onResult',this._onResult_b=this.onResult.bind(this));},destroy:function(){if(!this._isDestroyed)this._isDestroyed=true,this._channel.unsubscribe('LongOperations:TabCalls:onCall',this._onCall_b),this._channel.unsubscribe('LongOperations:TabCalls:onResult',this._onResult_b),this._tabKey=null,this._router=null,this._packer=null,this._channel=null,this._list=null;},callBatch:function(t,e,n,s){if(!t||'object'!==typeof t)throw new TypeError('Argument "targets" must be an object');if(!e||'string'!==typeof e)throw new TypeError('Argument "method" must be a string');if(n&&!Array.isArray(n))throw new TypeError('Argument "args" must be an array');if(s&&'function'!==typeof s)throw new TypeError('Argument "resultClass" must be a constructor');var o=[],a=[];for(var i in t){if(!i)throw new TypeError('Argument "targets" must have none empty keys');for(var l=0,u=t[i];l<u.length;l++){var h={tab:i,target:u[l],method:e,args:n,resultClass:s,promise:new r()};o.push(h),a.push(h.promise);}}if(o.length)this._list.push.apply(this._list,o),this._channel.notify('LongOperations:TabCalls:onCall',{from:this._tabKey,targets:t,method:e,args:f(n)});return a;},call:function(t,e,n,s,o){if(!t||'string'!==typeof t)throw new TypeError('Argument "tabKey" must be a string');if(!e||'string'!==typeof e)throw new TypeError('Argument "target" must be a string');if(!n||'string'!==typeof n)throw new TypeError('Argument "method" must be a string');if(s&&!Array.isArray(s))throw new TypeError('Argument "args" must be an array');if(o&&'function'!==typeof o)throw new TypeError('Argument "resultClass" must be a constructor');var a={tab:t,target:e,method:n,args:s,resultClass:o,promise:new r()};this._list.push(a);var i={};return i[t]=[e],this._channel.notify('LongOperations:TabCalls:onCall',{from:this._tabKey,targets:i,method:n,args:f(s)}),a.promise;},onCall:function(t,e){if(!(e&&'object'===typeof e&&e.from&&'string'===typeof e.from&&e.targets&&'object'===typeof e.targets&&e.method&&'string'===typeof e.method))throw new TypeError('Unknown event');if(this._tabKey in e.targets)for(var n=e.from,s=e.method,o,a=0,l=e.targets[this._tabKey];a<l.length;a++){var f=l[a],h=this._router(f),y=null;if(!h||'object'!==typeof h)y='Target not found or invalid';else if(!(s in h))y='Method not found';else{if(!o)o=e.args&&Array.isArray(e.args)?u(e.args):[];try{var g=h[s].apply(h,o);if(g instanceof r)g.addBoth(i.bind(null,this,n,f,s,e.args));else i(this,n,f,s,e.args,g);}catch(t){y=t.message||''+t;}}if(y)this._channel.notify('LongOperations:TabCalls:onResult',{from:this._tabKey,to:n,target:f,method:s,args:e.args,error:y});}},onResult:function(t,r){if(!(r&&'object'===typeof r&&r.from&&'string'===typeof r.from&&r.to&&'string'===typeof r.to&&r.target&&'string'===typeof r.target&&r.method&&'string'===typeof r.method&&(!r.error||'string'===typeof r.error)))throw new TypeError('Unknown event');if(r.to===this._tabKey){var e=l(this,r.from,r.target,r.method,u(r.args),true);if(!e)throw new Error('Not found');if(!r.error){var n=r.result,s=e.resultClass;if(s){if(null==n)throw new Error('Result required');var o=function(t){return new s(t);};n=Array.isArray(n)?n.map(o):o(n);}e.promise.callback(n);}else e.promise.errback(new Error(r.error));}}}),i=function(t,r,e,a,i,l){var f={from:t._tabKey,to:r,target:e,method:a,args:i};if(l instanceof Error)f.error=l.message||''+l;else{if(l&&'object'===typeof l){if(l instanceof n)l=l.getAll();if(l instanceof s)l=o(l).values();if(t._packer)if(Array.isArray(l))l=l.map(t._packer);else l=t._packer(l);}f.result=l;}t._channel.notify('LongOperations:TabCalls:onResult',f);},l=function(t,r,e,n,s,o){for(var a=0;a<t._list.length;a++){var i=t._list[a];if(i.tab===r&&i.target===e&&i.method===n&&h(i.args,s)){if(o)t._list.splice(a,1);return i;}}},f=function(t){if(!t||'object'!==typeof t)return t;else if(Array.isArray(t))return t.map(function(t){return f(t);});else if(t instanceof Date)return{':dt':t.getTime()};else return Object.keys(t).reduce(function(r,e){return r[e]=f(t[e]),r;},{});},u=function(t){if(!t||'object'!==typeof t)return t;else if(Array.isArray(t))return t.map(function(t){return u(t);});else if('number'===typeof t[':dt']&&1===Object.keys(t).length)return new Date(t[':dt']);else return Object.keys(t).reduce(function(r,e){return r[e]=u(t[e]),r;},{});},h=function(t,r){if(null==t&&null==r)return true;if(!(t&&'object'===typeof t&&r&&'object'===typeof r))return t===r;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return false;for(var e=0;e<t.length;e++)if(!h(t[e],r[e]))return false;}else{if(Array.isArray(r))return false;var n=Object.keys(t);if(n.length!=Object.keys(r).length)return false;for(var e=0;e<n.length;e++){var s=n[e];if(!h(t[s],r[s]))return false;}}return true;};return a;});
define('SBIS3.CONTROLS/LongOperations/ManagerLib',['WS.Data/Chain','WS.Data/Collection/RecordSet','WS.Data/Source/DataSet','SBIS3.CONTROLS/LongOperations/Const','SBIS3.CONTROLS/LongOperations/Entry','SBIS3.CONTROLS/LongOperations/HistoryItem','SBIS3.CONTROLS/LongOperations/Tools/Bunch','SBIS3.CONTROLS/LongOperations/Tools/CallsPool','SBIS3.CONTROLS/LongOperations/Tools/TabCalls','SBIS3.CONTROLS/LongOperations/List/resources/model','SBIS3.CONTROLS_localization'],function(r,e,t,n,o,a,i,s,f,u){'use strict';var l,c={fetch:function(r){var e=l(this);if(e._isDestroyed)return Deferred.fail(n.ERR_UNLOAD);var t={where:null,orderBy:this.DEFAULT_FETCH_SORTING,offset:0,limit:this.DEFAULT_FETCH_LIMIT,extra:null},o=Object.keys(t),a=arguments.length;if(4<=a){var i=arguments;o.forEach(function(r,e){if(ars[e])t[r]=ars[e];});}else if(1===a){if(r){if('object'!==typeof r)throw new TypeError('Argument "options" must be an object if present');o.forEach(function(e){if(r[e])t[e]=r[e];});}}else if(0!==a)throw new Error('Wrong arguments number');if(null!=t.where&&'object'!==typeof t.where)throw new TypeError('Argument "where" must be an object');if(null!=t.orderBy&&'object'!==typeof t.orderBy&&Object.keys(t.orderBy).every(function(r){var e=t.orderBy[r];return null==e||'boolean'===typeof e;}))throw new TypeError('Argument "orderBy" must be an array');if(!('number'===typeof t.offset&&0<=t.offset))throw new TypeError('Argument "offset" must be not negative number');if(!('number'===typeof t.limit&&0<t.limit))throw new TypeError('Argument "limit" must be positive number');if(null!=t.extra&&'object'!==typeof t.extra)throw new TypeError('Argument "extra" must be an object');if(!e._fetchCalls)b(this);if(!e._fetchCalls.has(t)){var s=!!Object.keys(e._producers).length,f=!!Object.keys(e._tabManagers).length;if(s||f){var u=0<t.offset,c={where:t.where,orderBy:t.orderBy,limit:t.limit},y;if(u)y=e._offsetBunch.searchIds(c);else e._offsetBunch.removeAll(c);if(s)for(var p in e._producers){var d={tab:e._tabKey,producer:p};e._fetchCalls.add(t,d,e._producers[p].fetch(u?h({},t,{offset:e._offsetBunch.search(d,y).shift()||0}):t));}if(f){var g;for(var _ in e._tabManagers)g=e._tabTargets(g,_,e._tabManagers[_]);if(g){var m=e._fetchFromTabs(g,t,true);e._fetchCalls.addList(t,e._expandTargets(g),m);}}}}if(e._fetchCalls.has(t))return e._fetchCalls.getResult(t,false);else return Deferred.success(null);},callAction:function(r,e,t,o){if(!r||'string'!==typeof r)throw new TypeError('Argument "action" must be a string');if(e&&'string'!==typeof e)throw new TypeError('Argument "tabKey" must be a string');if(!t||'string'!==typeof t)throw new TypeError('Argument "prodName" must be a string');if(!o||!('string'===typeof o||'number'===typeof o))throw new TypeError('Argument "operationId" must be string or number');var a=l(this);if(a._isDestroyed)return Deferred.fail(n.ERR_UNLOAD);if(!e||e===a._tabKey){var i=a._producers[t];if(!i)throw new Error('Producer not found');return i.callAction(r,o);}else{if(!(e in a._tabManagers&&t in a._tabManagers[e]))throw new Error('Producer not found');if(!a._tabCalls)b(this);return a._tabCalls.call(e,t,'callAction',[r,o],null);}},history:function(r,e,t,o,i){if(r&&'string'!==typeof r)throw new TypeError('Argument "tabKey" must be a string');if(!e||'string'!==typeof e)throw new TypeError('Argument "prodName" must be a string');if(!t||!('string'===typeof t||'number'===typeof t))throw new TypeError('Argument "operationId" must be string or number');if(!('number'===typeof o&&0<o))throw new TypeError('Argument "count" must be positive number');if(i&&'object'!==typeof i)throw new TypeError('Argument "filter" must be an object if present');var s=l(this);if(s._isDestroyed)return Deferred.fail(n.ERR_UNLOAD);if(!r||r===s._tabKey){var f=s._producers[e];if(!f)throw new Error('Producer not found');if(!s._canHasHistory(f))throw new Error('Producer is not supported history');return f.history(t,o,i);}else if(r in s._tabManagers&&e in s._tabManagers[r]){if(!s._tabCalls)b(this);return s._tabCalls.call(r,e,'history',i?[t,o,i]:[t,o],a);}return Deferred.fail('Not available');}},b=function(n){l(n)._tabCalls=new f(l(n)._tabKey,n.getByName.bind(n),function(r){return r&&'function'===typeof r.toSnapshot?r.toSnapshot():r;},l(n)._tabChannel),l(n)._fetchCalls=new s(['tab','producer'],function(r,a,i){if(!(null==i||Array.isArray(i)||i instanceof t||i instanceof e))throw new Error('Unknown result type');var s=l(n),f=(a.tab===s._tabKey?s._producers[a.producer]:a.tab in s._tabManagers&&a.producer in s._tabManagers[a.tab])?a.producer:null;if(f){var u=i instanceof t?i.getAll():i,c,b;if(Array.isArray(u))c='forEach',b=u.length;else if(u instanceof e)c='each',b=u.getCount();if(!c)throw new Error('Unknown result type');if(b){var h=a.tab===s._tabKey?!s._producers[a.producer].hasCrossTabData():!s._producers[a.producer]||!s._tabManagers[a.tab][a.producer].hasCrossTabData();return u[c](function(r){if(!(r instanceof o&&r.producer===f))throw new Error('Invalid result');if(r.tabKey){if(r.tabKey!==s._tabKey&&!(s._tabManagers[r.tabKey]&&s._tabManagers[r.tabKey][a.producer]))r.tabKey=null;}else if(h)r.tabKey=a.tab;}),u;}}return null;},function(t,o){var a;if(o&&o.length)for(var i=0;i<o.length;i++)for(var s=0,f=o[i];s<f.length;s++){var c=f[s];if(!a)a={};if(!(c.producer in a))a[c.producer]={};if(c.id in a[c.producer]){if(!a[c.producer][c.id].tabKey&&c.tabKey)a[c.producer][c.id]=c;}else a[c.producer][c.id]=c;}var b=new e({model:u,idProperty:'fullId'});if(a){var h,y=0;for(var p in a){var f=a[p];f=Object.keys(f).map(function(r){return f[r];}),h=!h?r(f):h.concat(f),y+=f.length;}if(t.orderBy){var d=t.orderBy;h=h.sort(function(r,e){for(var t in d){var n=r[t],o=e[t];if(n<o)return d[t]?-1:+1;else if(o<n)return d[t]?+1:-1;}return 0;});}var g={where:t.where,orderBy:t.orderBy,limit:t.limit,tab:null,producer:null};b.assign(h.first(t.limit).map(function(r){var e=l(n);return g.tab=r.tabKey||e._tabKey,g.producer=r.producer,e._offsetBunch.set(g,(e._offsetBunch.get(g)||0)+1),new u({rawData:r,idProperty:'fullId'});}).value()),b.setMetaData({more:t.limit<=y});}return b;}),l(n)._offsetBunch=new i(),l(n)._fetchFromTabs=function(r,e,t){var n=l(this);if(0<e.offset){var a=[];for(var i in r)for(var s=r[i],f=0;f<s.length;f++){var u=s[f],c=t?n._offsetBunch.search({tab:i,producer:u},offsetIds).shift()||0:0;a.push(n._tabCalls.call(i,u,'fetch',[h({},e,{offset:c})],o));}return a;}else return n._tabCalls.callBatch(r,'fetch',[e],o);}.bind(n);},h=Object.assign||function(r){return[].slice.call(arguments,1).reduce(function(r,e){return Object.keys(e).reduce(function(r,t){return r[t]=e[t],r;},r);},r);};return function(r){return l=r,c;};});
define('js!SBIS3.Engine.LongOperations.LRSProducerLib',['Core/TimeInterval','WS.Data/Chain','WS.Data/Query/Query','WS.Data/Source/SbisService','SBIS3.CONTROLS/LongOperations/Entry','SBIS3.CONTROLS/LongOperations/HistoryItem','SBIS3.ENGINE_localization'],function(e,t,r,n,o,i){'use strict';var s={running:0,suspended:1,success:2,error:3,deleted:4,deleting:5},a='/long-requests/service/',u='LongRequests',f={query:'List',destroy:'CancelLR',suspend:'Stop',resume:'Resume',history:'OperationHistory'},l,d={fetch:function(n){if(n&&'object'!==typeof n)throw new TypeError('Argument "options" must be an object if present');if(n&&'where'in n&&'object'!==typeof n.where)throw new TypeError('Argument "options.where" must be an object');if(n&&'orderBy'in n&&'object'!==typeof n.orderBy)throw new TypeError('Argument "options.orderBy" must be an array');if(n&&'offset'in n&&!('number'===typeof n.offset&&0<=n.offset))throw new TypeError('Argument "options.offset" must be not negative number');if(n&&'limit'in n&&!('number'===typeof n.limit&&0<n.limit))throw new TypeError('Argument "options.limit" must be positive number');if(n&&'extra'in n&&'object'!==typeof n.extra)throw new TypeError('Argument "options.extra" must be an object if present');var i;if((n=n||{}).where)i=Object.keys(n.where).reduce(function(e,t){var r=n.where[t];if('status'===t){var i=o.STATUSES;if(Array.isArray(r)){if(-1===r.indexOf(i.running)||-1===r.indexOf(i.ended))throw new Error('Unsupported status condition');r=3;}else{var s=n.where.isFailed;r=r===i.ended?void 0===s?2:!s?4:5:r;}e.State=r;}else if('isFailed'===t);else if('startedAt'===t){if(r&&'object'===typeof r&&'string'===typeof r.condition){var a=Math.round((new Date().getTime()-r.value)/86400000);e.Period={0:0,1:1,7:2,30:3,180:4}[a];}}else if('timeSpent'===t){if(r&&'object'===typeof r&&'string'===typeof r.condition){var u=Math.round(r.value/60000);e.Duration={5:0,10:1,30:2,60:3}[u];}}else if('title'===t){if(r&&'object'===typeof r&&'string'===typeof r.condition)e.title=r.value,e.usePages='full';}else if('userId'===t)e.UserId=r;else e[t]=r;return e;},{});if(n.extra){i=i||{};var a={needUserInfo:'NeedProfileData'};for(var u in n.extra)i[a[u]||u]=n.extra[u];}var f=n.orderBy||{status:true,startedAt:false},l={},a={startedAt:'StartTime',status:'State'};for(var u in f)l[a[u]||u]=f[u];var d=this.getName(),c=o.STATUSES;return m().query(new r().where(i).orderBy(l).offset(n.offset).limit(n.limit).meta({hasMore:true})).addCallback(function(r){return t(r.getAll()).filter(function(e){var t=e.get('State').get();return t!==s.deleted||t!==s.deleting;}).map(function(t){var r={producer:d,status:t.get('State').get(),timeSpent:new e(t.get('ExecuteTime')).getTotalMilliseconds()};if(r.status===s.error)r.status=c.ended,r.isFailed=true;for(var n={Name:'title',Id:'id',StartTime:'startedAt',TotalOperationCount:'progressTotal',ExecutedOperationCount:'progressCurrent',PauseEnabled:'canSuspend',DeleteEnabled:'canDelete',FirstName:'userFirstName',PatronymicName:'userPatronymicName',LastName:'userLastName',PhotoData:'userPic',MethodCheckResult:'resultChecker',MethodCheckResultParams:'resultCheckerArgs',ResultLinkText:'resultWayOfUse',ResultTmpl:'resultHandler',ResultTmplParams:'resultHandlerArgs',ResultLink:'resultUrl',ResultLinkCurrentTarget:'resultUrlAsDownload'},i=['State','ExecuteTime','Workflow','CustomData','HasErrors'],a=t.getEnumerator();a.moveNext();){var u=a.getCurrent();if(-1===i.indexOf(u))r[u in n?n[u]:u.charAt(0).toLowerCase()+u.substring(1)]=t.get(u);}r.timeIddle=(r.startedAt instanceof Date?r.startedAt.getTime():+r.startedAt)-r.timeSpent;var f=t.get('Workflow');if(f)r.extra={workflow:f};var l=t.get('CustomData');if(l&&Object.keys(l).length)r.custom=l;return new o(r);}).value();});},callAction:function(e,t){if(!('number'===typeof t&&0<t))throw new TypeError('Argument "operationId" must be positive number');if(-1===['suspend','resume','delete'].indexOf(e))throw new Error('Unknown action');var r='delete'===e;return m().call(f[r?'destroy':e],r?{'ИдО':[t.toString()]}:{Id:t});},history:function(e,n,o){if(!('number'===typeof e&&0<e))throw new TypeError('Argument "operationId" must be positive number');if(!('number'===typeof n&&0<n))throw new TypeError('Argument "count" must be positive number');if(o&&'object'!==typeof o)throw new TypeError('Argument "filter" must be an object if present');var s={onlyErrors:'Error'},a={LRId:e};if(o)for(var u in s)if(u in o)a[s[u]]=o[u];var l=new r().where(a).offset(0).limit(n).meta({hasMore:true}),d=this.getName();return m().call(f.history,m()._prepareQueryArguments(l)).addCallback(function(e){return t(e.getAll()).map(function(e){for(var t={producer:d,isFailed:!!e.get('State').get()},r={Name:'title',Id:'id',FinishTime:'endedAt'},n=['State'],o=e.getEnumerator();o.moveNext();){var s=o.getCurrent();if(-1===n.indexOf(s))t[s in r?r[s]:s.charAt(0).toLowerCase()+s.substring(1)]=e.get(s);}return new i(t);}).value();});}},m=function(){if(!c)c=new n({endpoint:{address:a,contract:u},binding:{query:f.query}});return c;},c;return function(e){return l=e,d;};});