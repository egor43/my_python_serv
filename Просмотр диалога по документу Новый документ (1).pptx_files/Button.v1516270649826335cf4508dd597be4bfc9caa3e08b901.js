define("Deprecated/Controls/Button/Button",["Core/core-instance","Core/IoC","Core/Deferred","Core/constants","Deprecated/Controls/ButtonAbstract/ButtonAbstract","html!Deprecated/Controls/Button/Button","html!Deprecated/Controls/Button/Button_image","Core/helpers/vital/processImagePath","css!Deprecated/Controls/Button/Button","i18n!Deprecated/Controls/Button/Button"],function(t,e,n,i,s,o,u,a){"use strict";var d=12,r=20;i.Button={offsetClassicButton:{left:0,top:6},offsetLinkButton:{left:-6,top:-10},offsetLinkButtonWithoutImage:{left:-10,top:-10},offsetAddButton:{left:-2,top:6},additionalMenuWidth:24,initializedMenu:{}};var l=s.extend({$protected:{_options:{menu:"",openLink:"",openLinkInNewTab:true,displayCaptionForAddButton:false,cssClassName:"ws-field-button",imageTemplate:u,processImagePath:a},_menuInitialized:false,_menuContent:void 0,_menuMouseHandler:void 0,_menuHeaderLeft:void 0,_menuHeaderRight:void 0,_menuOpenHandler:void 0,_menuCloseHandler:void 0,_menuToggleHandler:void 0,_menuAfterRenderHandler:void 0,_menuStyle:"classic",_menuProcessed:false,_drawAddButton:false,_cloneContainer:void 0,_isUseCaptionInTitle:true},_dotTplFn:o,$constructor:function(t){var e=this;if(void 0!==t.menuName)this._options.menu=t.menuName;this._drawAddButton=-1!==this._options.image.indexOf("icon-AddButton")&&!this._options.displayCaptionForAddButton,this._container.toggleClass("ws-add-button",this._drawAddButton),this._setRenderStyleClass()},_setRenderStyleClass:function(){if("asLink"===this._options.renderStyle&&!this._drawAddButton)this._menuStyle="iconDropdown";else this._menuStyle="classic"},_updateMenuClasses:function(t){this._menuControl.getContainer().find(".menu-ul").toggleClass("classic"===this._menuStyle?"ws-button-menu-content":this._container.find(".icon-16").length?"menu-ul-24":"menu-ul-32",t)},getOpenLink:function(){return this._options.openLink},setOpenLink:function(t){this._options.openLink=t},useCaptionInTitle:function(t){this._isUseCaptionInTitle=!!t},_prepareMenuTitle:function(){var t=this._options.image,e=$('<li class="ws-menu-item ws-menu-button-title'+(t?' ws-button-with-image"><div class="ws-menu-button-title-image"></div>':' ws-menu-item-without-image">')+'<div class="ws-menu-button-title-text">'+(this._isUseCaptionInTitle&&this._options.caption||this._options.tooltip)+"</div>"+"</li>"),n=e.find(".ws-menu-button-title-image");if(t)if(t.indexOf("sprite:")>-1)n.addClass(t.split("sprite:")[1]);e.bind("click",function(){this._toggleSubMenu()}.bind(this)),this._menuContent.prepend(e)},_onMenuOpen:function(){var t=this.getContainer(),e,n;if(this._menuControl.isShow()&&!this._menuProcessed)if(this._menuProcessed=true,"classic"===this._menuStyle){if(e=t.find(".ws-header-element"),t.addClass("ws-field-button-element-active"),this._cloneContainer=this._menuControl.getContainer().find(".ws-button-menu-clone-container"),n=t.outerWidth(),this._cloneContainer.empty().append($("<div></div>").css("width","100%").addClass(t.attr("class")).append($(t.html()).clone(true))),this._cloneContainer.width()<n)this._cloneContainer.width(n);if(0===e.length)this._prepareMenuHeader();else e.removeClass("ws-hidden");this._menuContent.addClass("ws-button-menu-content")}},_onCloseMenu:function(){if(this.getContainer().trigger("wsSubWindowClose"),this._menuControl.isShow())if(this._menuProcessed=false,"classic"===this._menuStyle)this._container.removeClass("ws-field-button-element-active"),this._menuContent.removeClass("ws-button-menu-content"),this._container.removeClass("ws-button-menu-header-content").find(".ws-header-element").addClass("ws-hidden"),this._updateMenuClasses(false);else if(this._menuContent.children(".ws-menu-button-title").remove(),this._menuContent.data("added-class"))this._menuContent.removeClass("ws-menu-image-padding")},_prepareMenu:function(t){return this._menuControl=t,this._initializeMenuContent(),t.subscribe("onOpen",this._menuOpenHandler=this._onMenuOpen.bind(this)),t.subscribe("onClose",this._menuCloseHandler=this._onCloseMenu.bind(this)),t.subscribe("onAfterRender",this._menuAfterRenderHandler=this._initializeMenuContent.bind(this)),t},_initializeMenuContent:function(){this._menuContent=this._menuControl.getContainer().find(".ws-main-menu")},_waitMenuInstance:function(){var t=this.getTopParent();if(-1!==this._options.menu.indexOf("/"))return t.waitChildControlByName(this._options.menu.split("/").pop());else if(t.hasChildControlByName(this._options.menu))return(new n).callback(t.getChildControlByName(this._options.menu));else return t.waitChildControlById(this._options.menu)},_initMenu:function(){var t=this;this._waitMenuInstance().addCallback(function(n){if(i.Button.initializedMenu[n.getId()])e.resolve("ILogger").log(this._options.menu.split("/")[1]+" (id: "+n.getId()+")",rk("Данное меню уже привязано к другой кнопке"));else{if(this._menuMouseHandler=function(e){if(t._menuControl&&t._menuControl.isShow instanceof Function&&!t._menuControl.isShow())$(this).toggleClass("ws-field-button-element-active","mousedown"==e.type)},this._container.bind("mousedown mouseup mouseleave",this._menuMouseHandler),i.Button.initializedMenu[n.getId()]=true,this._menuInitialized)return;this._menuInitialized=true,this.subscribe("onActivated",this._menuToggleHandler=function(){this._toggleSubMenu()}.bind(this)),this.getContainer().attr("data-menu-id",this._options.menu),this._prepareMenu(n)}}.bind(this))},_redraw:function(){if(l.superclass._redraw.apply(this,arguments),this._options.menu)this._initMenu()},_getTopParentContainer:function(){var t=this.getTopParent();if(t===this)return i.$body;return t.getContainer()},_getOffsetContainer:function(){if("classic"===this._menuStyle)return this._container;if(this._options.image)return this._container.find(".ws-button-image");return this._container.find(".ws-button-caption")},_toggleSubMenu:function(){var t=this._container,e=this;if("classic"!==this._menuStyle){if(this._menuControl.isShow instanceof Function&&!this._menuControl.isShow())this._prepareMenuTitle();if(this._options.image&&!this._menuContent.hasClass("ws-menu-image-padding"))this._menuContent.addClass("ws-menu-image-padding").data("added-class",true)}this._menuContent.css("min-width",""),this._updateMenuClasses(true),this._waitMenuInstance().addCallback(function(n){var s="asLink"===e._options.renderStyle,o=t.width()+(s?e._drawAddButton?24:0:i.Button.additionalMenuWidth),u=t.find(".ws-button-image"),a=!!u.length;return n.getContainer().css("min-width",o).toggleClass("menu-left-turn",e._drawAddButton),n.getMenuUL().css("min-width",o+(s&&!e._drawAddButton?-i.Button.offsetLinkButton.left:0)),n.setEnabled(this.isEnabled()),n.toggle(s&&a?u:t,this._drawAddButton?i.Button.offsetAddButton:s?a?i.Button.offsetLinkButton:i.Button.offsetLinkButtonWithoutImage:i.Button.offsetClassicButton,{targetTop:s&&!this._drawAddButton,targetLeft:!e._drawAddButton,objectLeft:!e._drawAddButton},{vertical:s&&!e._drawAddButton,doFit:false}),this.getContainer().trigger(n.isShow()?"wsSubWindowOpen":"wsSubWindowClose"),n}.bind(this))},destroy:function(){if(this._options.menu&&t.instanceOfModule(this._menuControl,"Deprecated/Controls/Menu/Menu"))delete i.Button.initializedMenu[this._menuControl.getId()];l.superclass.destroy.apply(this,arguments)},setMenu:function(e){if(this._menuControl)this._menuControl.unsubscribe("onOpen",this._menuOpenHandler),this._menuControl.unsubscribe("onClose",this._menuCloseHandler);if(this._menuInitialized)this.unsubscribe("onActivated",this._menuToggleHandler);if(this._menuInitialized=false,this._menuContent=void 0,this._options.menu&&t.instanceOfModule(this._menuControl,"Deprecated/Controls/Menu/Menu"))delete i.Button.initializedMenu[this._menuControl.getId()];if(this._menuControl=void 0,!e)this._container.unbind("mousedown mouseup mouseleave",this._menuMouseHandler);if(this._options.menu=t.instanceOfModule(e,"Deprecated/Controls/Menu/Menu")?e.getId():e,this._container.removeAttr("data-menu-id"),this._container.toggleClass("ws-button-with-menu",!!e),e)this._initMenu()},getMenu:function(){return this._options.menu},getMenuControl:function(){return this._menuControl},_setEnabled:function(e){if(t.instanceOfModule(this._menuControl,"Deprecated/Controls/Menu/Menu"))this._menuControl.setEnabled(e);l.superclass._setEnabled.apply(this,arguments)},_prepareMenuHeader:function(){var t=this.getContainer().width(),e=r/2;this._cloneContainer.prepend(['<div class="ws-header-element ws-button-menu-header-left"></div>','<div style="width:'+(t-d-e)+'px;" class=" ws-header-element ws-button-menu-header-center"></div>','<div class="ws-header-element ws-button-menu-header-right"></div>'].join("")),this._cloneContainer.toggleClass("ws-add-button-menu","asLink"===this._options.renderStyle&&this._drawAddButton)}});return l});
//# sourceMappingURL=Button.js.map