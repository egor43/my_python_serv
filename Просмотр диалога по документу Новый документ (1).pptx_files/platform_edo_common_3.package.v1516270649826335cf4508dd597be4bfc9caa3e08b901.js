(function() {
   var availableDict = {"en-US":true,"ru-RU":true},
      langMatch = String(typeof document === 'undefined' ? '' : document.cookie).match(/lang=([A-z-]+)/),
      langName = langMatch ? langMatch[1] : 'ru-RU',
      langModule = 'text!Bazovyj_komponent_dokument/lang/' + langName + '/' + langName + '.json';
   if (langName in availableDict) {
      define('Bazovyj_komponent_dokument_localization', ['Core/i18n', langModule], function(i18n, data) {
         if (data){
            i18n.setDict(JSON.parse(data), langModule, langName);
         }
      });
   } else {
      define('Bazovyj_komponent_dokument_localization', function() {});
   }
})();

define('js!SBIS3.EDO2.DialogUtils',['Core/constants','Core/moduleStubs','Core/Deferred','Core/Indicator','WS.Data/Chain','Core/helpers/Function/shallowClone','Bazovyj_komponent_dokument_localization'],function(e,n,t,r,i,o){'use strict';function a(t,r,i){var o=r.split('!')[1]+'EventHandlers';if(e.jsModules[o])n.requireModule(o).addCallback(function(e){for(var n=e[0],r=0;r<t.length;r++){var i=t[r];if(n[i])this.subscribeTo(this,i,n[i].bind(this)),this._$hasExternalHandlers=true;}}.bind(i||this));}function u(e,n){var t=[window.location.protocol,'//'];if(t.push(String(window.location.host)),window.location.href.match('/debug/'))t.push('/debug');if(t.push('/opendoc.html?guid=',e),n)t.push('&componentOptions=',window.encodeURIComponent(JSON.stringify(n)));return t.join('');}function s(e){var t=false,i=e.replace(/^js!/,''),o,a=n.requireModule([i]);if(a.addCallback(function(e){var n;try{if(n=e[0].prototype.getComponentOptions().dataSource.endpoint.address||'',!t)o=n;}catch(e){o='';}if(t)r.hide();return n;}),t=true,'string'!==typeof o)o=a,r.setMessage(rk('Пожалуйста, подождите...'));return o||'';}function c(e){var n={},r=function(){var r=JSON.stringify(arguments),i='';if(r in n)return n[r];else if(i=e.apply(this,arguments),!(i instanceof t))n[r]=i;return i;};return r._$cache=function(){return n.remove||(n.remove=function(){return delete n[JSON.stringify(arguments)];}),n;}.bind(this)(),r;}function l(e,n,t){return Object.defineProperty(e,n,{get:function(){var r=['__$',n,'Instantiate'].join('');if(!e[r])Object.defineProperty(e,r,{enumerable:false,value:t()});return e[r];},enumerable:true});}function f(e,n){if(e&&n)return document.cookie='ActivePhase_Document='+e+'; path=/;',document.cookie='ActivePhase_Event='+n+'; path=/;',true;else return false;}function d(e){var r=h(e);if(r.length)return n.requireModule(['SBIS3.EDO2.DraftsSaver']).addCallback(function(e){return e[0].save(r);});else return new t().callback();}function h(e){return i(e).filter(function(e){var n=e.get('РП.Документ');return n&&n.get('Черновик');}).map(function(e){return e.get('РП.Документ');}).value();}function p(e){return n.requireModule('SBIS3.CONTROLS/Utils/InformationPopupManager').addCallback(function(n){n[0].showMessageDialog({status:'error',message:e});});}function g(e,n){return Boolean(e&&n&&e.get('Идентификатор')===n.get('Идентификатор'));}function v(e,n){var t=e.getChanged();return 1===t.length&&t[0]===n;}function m(e){var n=o(e);return[n.pop(),n];}function b(e,n){var t=m(n.split('/')),r;while(t[0]){if(r=e.getModelField(t[1].join('/')),!v(r,t[0]))return r.acceptChanges([t[0]]),false;r.acceptChanges([t[0]]),t=m(t[1]);}return true;}function C(e,n){var t=e.get('encrypted'),r=void 0===n.isArchive?false:n.isArchive,i=void 0===n.inMainList?true:n.inMainList,o=!!(e.get('fileName')||'').match('.xml');return!!(i&&!r&&!e.get('link')&&e.get('typeDoc')&&2!==t&&3!==t&&(o||e.get('isScan')));}return{defineExternalHandlers:a,buildDocumentLink:u,getEndpointAddress:c(s),memoize:c,defineLazyProperty:l,setEventCookies:f,saveDrafts:d,showAlert:p,isPhasesEquals:g,cleanupRecordPath:b,isSwitchableToScan:C};});
define('js!SBIS3.EDO2.RemoteSourceMixin',['WS.Data/Source/SbisService','WS.Data/Adapter/Sbis','js!SBIS3.EDO2.DialogUtils','Bazovyj_komponent_dokument_localization'],function(e,t,n){'use strict';function r(n,r,s){var a={adapter:r?r:new t(),endpoint:{contract:n?n:'Документ'}},c=i.call(this);if(s)a.model=s;if('string'===typeof c)return a.endpoint.address=c,new e(a);else return new o(c,a);}function i(){var e;if('function'===typeof this.getContext)if(e=this.getContext().getValue('record/РП.Документ/Регламент/ВизуальноеПредставление/ИмяДиалога'),e)return n.getEndpointAddress(e);return'';}function o(e,t){this.deferred=e,this.serviceParams=t;}function s(t){return function(){var n=this.serviceParams,r=arguments,i;return this.deferred.addCallback(function(o){return n.endpoint.address=o,i=new e(n),i[t].apply(i,r);});};}var a=Object.keys(e.prototype._$binding);return a.push('call'),a.forEach(function(e){o.prototype[e]=s(e);}),{getRemoteSource:r};});
define('js!SBIS3.EDO2.OpenDialogAction',['Core/core-extend','js!SBIS3.EDO2.RemoteSourceMixin','Core/Deferred','js!SBIS3.Engine.SBISOpenDialogAction','WS.Data/Collection/RecordSet','WS.Data/Entity/Record','js!SBIS3.EDO2.DialogUtils','SBIS3.CONTROLS/Utils/InformationPopupManager','Core/moduleStubs','Core/base64','Bazovyj_komponent_dokument_localization'],function(e,t,i,n,o,r,a,l,d,s){'use strict';var c=rk('Ваш браузер заблокировал всплывающее окно. Для корректной работы нашего сайта необходимо разрешить всплывающие окна.'),g=rk('У операции не указан вид диалога. Перейдите в раздел конфигурации реестра и выберите его на карточке операции.'),u='Отображение документа невозможно. Не удалось определить имя диалога.',p=rk('Отображение документа невозможно. Не передан идентификатор документа.'),m=rk('Документ недоступен. Возможно, документ был удален, или у вас нет доступа к этому документу компании.'),f=e(n,[t],{$protected:{_options:{objectName:null,dialogComponent:null,editMode:null},_idProperty:'@Документ',_openedDialog:null},__createDocument:function(e){if(e.template)return this.__openDocument(e);else return this.__openDocumentAsync(e);},__openDocument:function(e){var t=this,n;if(4===e.openMode||1===e.openMode){if(!e.item)e.initializingWay='remote';if(e.mode=f.OPEN_MODE[e.openMode],(e.id||e.create)&&e.template)if(e.id=String(e.id||''),t._dialog&&!t._dialog.isDestroyed())t._dialog.once('onAfterClose',function(){return t._dialog=null,t.once('onAfterShow',function(e,i){t._dialog=i;}),f.superclass.execute.call(t,e);}),t._dialog.sendCommand('close');else return t.once('onAfterShow',function(e,i){t._dialog=i;}),f.superclass.execute.call(t,e);else if(e.config&&!e.template)return t.__openNP(e);else return this.__openDocumentAsync(e);}else if(0===e.openMode){if(n=window.open(e.link),!!n)n.opener=null;else l.showMessageDialog({status:'error',message:f.CONSTANTS.POP_WINDOW_ERROR});return new i().callback(n);}else if(3===e.openMode)if(e.id&&e.template)return new i().callback({key:e.id,template:e.template});else if(e.config&&e.link)return new i().callback({link:e.link});else if(e.guid||e.guid2||e.id)return this.__getConfig(e).addCallback(function(e){if(!e.id&&!e.create&&e.config&&!e.configOptions)return new i().errback(new Error(f.CONSTANTS.INCORRECT_ID_ERROR));else if(e.configOptions&&e.configOptions.docLink)return new i().callback({link:e.configOptions.docLink});else if(e.id&&e.template)return new i().callback({key:e.id,template:e.template});else return this.__openNP(e);}.bind(this));else return new i().errback(new Error(f.CONSTANTS.ID_ERROR));else return this.__openDocumentAsync(e);},__openDocumentAsync:function(e){if(!e.config)return this.__getConfig(e).addCallback(function(e){return this.__openDocument(e);}.bind(this));else return l.showMessageDialog({status:'error',message:this.__getErrorMessage(e)}),new i().callback();},__getErrorMessage:function(e){return!e.id&&!e.guid&&f.CONSTANTS.ID_ERROR||!e.template&&f.CONSTANTS.TEMPLATE_ERROR||'';},__prepareOptions:function(e){if(e.guid=e.guid||e.item&&e.item.get('ИдентификаторДокумента')||e.item&&e.item.get('РП.Документ')&&e.item.get('РП.Документ').get('ИдентификаторПереписки'),e.template=this.__getTemplate(e),e.docType=e.docType||e.filter&&e.filter['ТипДокумента.ТипДокумента']||e.item&&e.item.get('РП.Документ')&&e.item.get('РП.Документ').get('ТипДокумента').get('ТипДокумента')||null,e.docSubType=e.docSubType||e.filter&&e.filter['ТипДокумента.ПодТипДокумента']||null,e.linkedObject=e.linkedObject||e.filter&&e.filter['ТипДокумента.ИмяОбъекта']||e.item&&e.item.get('РП.Документ')&&e.item.get('РП.Документ').get('ИмяОбъекта')||e.item&&e.item.get('ТипДокумента.ТипДокумента')||'',e.ruleId=e.ruleId||e.filter&&e.filter['ИдРегламента']||null,e.create=!e.id&&!e.guid,e.openMode=this.__getOpenMode(e),e.link=this.__getLink(e),e.item&&e.item.get('РП.Документ')&&e.item.get('РП.Документ').get('ТипДокумента')&&e.item.get('РП.Документ').get('ТипДокумента').get('Настройки'))e.dialogOptions.showOnControlsReady=!!e.item.get('РП.Документ').get('ТипДокумента').get('Настройки').get('showOnControlsReady');if(e.event)this.__setCookie(e);},__getTemplate:function(e){return e.template||this._options.dialogComponent||e.dialogComponent||e.filter&&e.filter['ТипДокумента.ИмяДиалога']||e.item&&e.item.get('РП.Документ')&&e.item.get('РП.Документ').get('Регламент').get('ВизуальноеПредставление')&&e.item.get('РП.Документ').get('Регламент').get('ВизуальноеПредставление').get('ИмяДиалога')||'';},__getLink:function(e){return e.link||e.guid&&'/opendoc.html?guid='+e.guid+(!!e.event?'&event='+e.event:'')||e.id&&'/opendoc.html?ido='+e.id+(!!e.event?'&event='+e.event:'')||!e.id&&e.template&&(0===e.openMode||3===e.openMode)&&'opendoc.html?create='+true+'&template='+encodeURIComponent(s.encode(e.template));},__getOpenMode:function(e){var t=void 0!==e.openMode&&null!==e.openMode||e.inNewTab,i=this._options.editMode,n=e.template&&!e.create&&4||e.inNewTab||this._options.editMode;switch(n){case'newWindow':case'new':n=0;break;case'newDialog':case'dialog':n=1;break;case'thisWindow':n=2;break;case'current':case'thisPage':n=3;break;case'newFloatArea':case'floatArea':case'float':n=4;}if(t)return void 0!==e.openMode&&null!==e.openMode?e.openMode:n;else if(i)return n;else return e.item?e.item.get('РП.Документ')&&e.item.get('РП.Документ').get('Регламент')&&e.item.get('РП.Документ').get('Регламент').get('ВизуальноеПредставление')&&e.item.get('РП.Документ').get('Регламент').get('ВизуальноеПредставление').get('РежимОткрытия')&&e.item.get('РП.Документ').get('Регламент').get('ВизуальноеПредставление').get('РежимОткрытия').get()||e.item&&e.item.get('ТипДокумента.РежимОткрытия')&&e.item.get('ТипДокумента.РежимОткрытия').get()||f.DEFAULT_OPEN_MODE:null;},__getConfig:function(e){return this.getRemoteSource('Документ',e.serviceAddress||'').call('ПолучитьДанныеОДокументе',{guid:e.guid||'',ido:parseInt(e.id,10)||-1,'ВИИд':e.guid2||'','ТипДок':e.docType||null,'ПодТипДок':e.docSubType||null,incoming:null,reglId:e.ruleId||null}).addCallback(function(t){var i=t.getRow(),n=i.get('RCOptions'),o;if(e.config=true,e.configOptions=n,e.guid=e.guid||i.get('ИдентификаторДокумента'),!n||!n.dialogComponent)o=i.get('@Документ')||void 0;else o=i.get('@Документ')||e.guid;if(e.id=String(o||e.id||''),e.template=e.template||n&&n.dialogComponent,e.dialogName=n&&n.dialogName,e.linkedObject=e.linkedObject||n&&n.linkedObject,e.openMode=e.openMode||n&&n.openMode||(e.create?f.DEFAULT_CREATE_MODE:f.DEFAULT_OPEN_MODE),e.mode=f.OPEN_MODE[e.openMode],n&&void 0!==n.showOnControlsReady)e.dialogOptions&&(e.dialogOptions.showOnControlsReady=n.showOnControlsReady);if(n&&null!==n.maximized)e.dialogOptions&&(e.dialogOptions.maximized=n.maximized);return e;}).addErrback(function(e){return e;});},__openNP:function(e){var t=this,n=new i();return d.require(['js!SBIS3.NP.DocOpenerHelpers']).addCallback(function(i){var o=i[0];if(1===e.openMode)n.callback(o.showDistributionsDialog(e.id));else if(3===e.openMode)if(e.dialogName)return e.link='/'+o.generatePageURL(e.linkedObject,e.id,e.dialogName),e.config=true,t.__openDocument(e);else return o.getComplectUrlAsync(e.id,e.linkedObject).addCallback(function(i){return e.link=i+(!!e.tabid?'&tabid='+e.tabid:''),e.config=true,t.__openDocument(e);});else{if('РассылкаЭО'===e.linkedObject)e.list='Список';else if('ПенсияПФР'===e.linkedObject)e.linkedObject='КомплектПенсии',e.readParam={readMethodName:'ПрочитатьРеквизиты'};else if('РетроконверсияПФР'===e.linkedObject)e.linkedObject='Комплект',e.readParam={readMethodName:'ПрочитатьДляПоказа'};else if('ПредставлениеФНС'===e.linkedObject)e.linkedObject='Requirement',e.list='AttachList',e.readParam={readMethodName:'ReadAttachedDocumentByDoc'};d.require(['Deprecated/helpers/transport-helpers']).addCallback(function(i){i[0].newRecordSet(e.linkedObject,e.list,{},void 0,false,'','',e.readParam).addCallback(function(i){(n=i.readRecord(e.id)).addCallback(function(i){if('Requirement'===e.linkedObject&&i&&i.hasColumn('СостояниеТребования')&&23===i.get('СостояниеТребования'))e.dialogName='js!SBIS3.NP.EncryptedListOfRequirements';var n={template:e.dialogName,record:i,opener:t,parent:null,name:'doc-float-area',componentOptions:e.componentOptions,side:'right',autoHide:false,isStack:true,newRecord:!!e.create||!!e.isNewRecord};return d.require(['Deprecated/Controls/RecordFloatArea/RecordFloatArea']).addCallback(function(e){var i=new e[0](n);return t.subscribeTo(i,'onAfterClose',function(){t._notify('onExecuted');}),i;});});});});}return n;});},_getEditKey:function(e){return e&&e.get('РП.Документ')?e.get('РП.Документ').get('ИдО'):void 0;},_buildComponentConfig:function(e){var t=f.superclass._buildComponentConfig.call(this,e);return t.isNewRecord=e.isNewRecord,t;},_onUpdateModel:function(e,t){if(t&&t.isNewRecord&&this._options.linkedObject||this._options.isCopyAction)return this._options.linkedObject.sendCommand('edoUpdateRows',[e.getId()]),'custom';else return null;},__setDefaultMetaOptions:function(e){var t=e.item&&e.item.get('РП.Документ')&&e.item.get('РП.Документ').get('ТипДокумента')&&e.item.get('РП.Документ').get('ТипДокумента').get('Настройки'),i,n,o;if(!e.dialogOptions)e.dialogOptions={};if(!e.componentOptions)e.componentOptions={};if(t){i=t.getEnumerator();while(!!(n=i.moveNext()&&i.getCurrent()))e.dialogOptions[n]=void 0===e.dialogOptions[n]?t.get(n):e.dialogOptions[n];}if(e.dialogOptions.autoHide=false,e.componentOptions.diffOnly=true,e.dialogOptions.block_by_task_1173286428=true,e.dialogOptions.canMaximize=true,e.dialogOptions&&(e.dialogOptions.maximized=this.__getMaximizeMode(e)),e.dialogOptions.className)e.dialogOptions.className+=' ws-float-area__block-layout';else e.dialogOptions.className='ws-float-area__block-layout';if(o=window&&window.sessionStorage&&window.sessionStorage.getItem('edoViewerFocus'),o){if(!e.componentOptions.context)e.componentOptions.context={};e.componentOptions.context.viewerFocus=o,window.sessionStorage.removeItem('edoViewerFocus');}},__setCookie:function(e){if(e&&e.id){var t=e.item&&e.item.get('РП.Документ')&&e.item.get('РП.Документ').get('ИдО')||e.item&&e.item.get('@Документ')||parseInt(e.id,10);a.setEventCookies(t,e.event);}},__getMaximizeMode:function(e){var t=false;if(e&&e.item&&e.item.get('РП.Документ')&&e.item.get('РП.Документ')&&e.item.get('РП.Документ').get('ТипДокумента')&&e.item.get('РП.Документ').get('ТипДокумента').get('Настройки')&&null!==e.item.get('РП.Документ').get('ТипДокумента').get('Настройки').get('maximized'))t=e.item.get('РП.Документ').get('ТипДокумента').get('Настройки').get('maximized');else try{t=window?!!JSON.parse(window.localStorage.getItem('maximizeMode')):false;}catch(e){}return t;},init:function(){f.superclass.init.call(this);var e=function(e,t){var i,n;if(e.has(t))return i=e.getFormat(),n=i.at(i.getFieldIndex(t)),{type:n.getType(),name:n.getName()};return n;};this.subscribeTo(this,'onUpdateModel',function(t,i,n){if(n.fieldsForMerge){var a=i.getIdProperty(),l=[e(i,a)],d=n.fieldsForMerge.map(function(t){return e(i,t);}).filter(function(e){return e;}),s,c,g;l.push.apply(l,d),s=new o(g={idProperty:a,adapter:'adapter.sbis',format:l}),(c=new r(g)).set('РП.Документ',i.get('РП.Документ')),c.set(a,i.getId()),s.add(c),t.setResult(s);}});},execute:function(e){if(this.__setDefaultMetaOptions(e),e.itemType)return f.superclass.execute.call(this,e);else if(this.__prepareOptions(e),e.id||e.guid)return this.__openDocument(e);else return this.__createDocument(e);}});return f.prototype.openDocument=function(e){return f.prototype.__openDocument(e);},f.CONSTANTS={POP_WINDOW_ERROR:c,PRESENTATION_DIALOG_ERROR:g,TEMPLATE_ERROR:u,ID_ERROR:p,INCORRECT_ID_ERROR:m},f.DEFAULT_CREATE_MODE=4,f.DEFAULT_OPEN_MODE=0,f.OPEN_MODE={0:'new',1:'dialog',3:'current',4:'floatArea'},f;});